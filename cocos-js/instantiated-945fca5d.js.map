{"version":3,"file":"instantiated-945fca5d.js","sources":["../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/utils.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/3d/misc/buffer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/utils/asserts.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/utilities.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/animation/types.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/serialization-metadata.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/curve.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/x-deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/bits.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/global-exports.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/debug.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/mutable-forward-iterator.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/array.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/id-generator.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/js-typed.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/pool.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/js.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/value-types/bitmask.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/value-types/enum.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/settings.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/value-types/value-type.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/macro.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/misc.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/utils/attribute.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/utils/preprocess-class.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/utils/requiring-frame.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/class-stash.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/class.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/vec4.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/color.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/vec3.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/mat3.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/quat.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/mat4.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/vec2.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/affine-transform.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/size.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/rect.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/define.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/math/math-base.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/garbage-collection.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/gc-object.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/buffer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/command-buffer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/device.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/swapchain.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/framebuffer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/murmurhash2_gc.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/input-assembler.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/descriptor-set.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/descriptor-set-layout.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/pipeline-layout.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/pipeline-state.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/render-pass.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/states/sampler.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/shader.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/texture.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/states/general-barrier.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/states/texture-barrier.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/base/states/buffer-barrier.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/polyfill-legacy-cc.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/deprecated-3.0.0.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/deprecated-3.5.0.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/memop/container-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/memop/scalable-container.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/memop/pool.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/memop/recycle-pool.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/memop/cached-array.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/editor-extras-tag.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/object.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/event/callbacks-invoker.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/event/eventify.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/event/event-target.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/enum-type/browser-type.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/enum-type/language.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/enum-type/network-type.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/enum-type/operating-system.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/enum-type/platform.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/enum-type/feature.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/event/async-delegate.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/screen-adapter/enum-type/orientation.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/system-info/web/system-info.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/screen-adapter/web/screen-adapter.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/screen.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/gfx/device-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/sys.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/distance.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/enums.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/line.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/ray.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/sphere.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/spec.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/triangle.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/intersect.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/plane.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/aabb.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/obb.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/capsule.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/frustum.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/algorithm/binary-search.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/keyframe-curve.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/real-curve-param.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/solve-cubic.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/utils.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/ccclass.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/component.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/property.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/serializable.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/editable.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/type.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/decorators/override.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/editor-extendable.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/cache.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/pipeline.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/weak-cache.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/shared.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/task.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/decode-uuid.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/helper.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/path.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/scripts.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/component-event-handler.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/component.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/missing-script.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/custom-serializable.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/ccon.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/deserialize-dynamic.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/deserialize.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/report-missing-class.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/instantiate.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/utils/compact-value-type-array.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/easing/easing.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/index.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/easing-method.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/curve.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/bezier.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/quat-curve.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/curves/object-curve.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/spline.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/geometry/deprecated-3.0.0.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/layers.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/define.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/pass-utils.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/program-lib.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/effect-asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/asset-enum.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/texture-base.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/image-asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/depend-maps.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/deserialize.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/depend-util.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/simple-texture.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/texture-cube.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/texture-2d.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/config.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/release-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/bundle.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/download-dom-image.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/download-file.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/download-script.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/downloader.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/json-asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/text-asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/buffer-asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/factory.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/pack-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/fetch.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/plist-parser.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/parser.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/load.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/preprocess.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/request-item.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/url-transformer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/asset-manager/asset-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pass-phase.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/pass.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/builtin/builtin-res-mgr.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/instanced-buffer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/batched-buffer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pipeline-state-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pipeline-funcs.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/material.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/utils/compiler.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/deprecated-3.6.0.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/data/instantiate-jit.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/node-event.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/node-ui-properties.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/base-node-dev.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/base-node.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/node-enum.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/node.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/component-event-handler.schema.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/system.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/render-texture.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/camera.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/camera-component.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/pass-instance.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/material-instance.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/renderer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/model-renderer.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/components/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event-enum.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-acceleration.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-keyboard.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-mouse.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-touch.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/key-code.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-gamepad.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/acceleration.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-handle.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/event/event-hmd.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/types/touch.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/node-event-processor.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/ambient.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/shadows.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/skybox.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/fog.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/scene-globals.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/deprecated-3.3.0.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/deprecated-3.4.0.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/accelerometer-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/input-source.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/gamepad-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/handle-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/hmd-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/keyboard-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/mouse-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/touch-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/input/web/touch-input.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/system-event.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/input/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/prefab/utils.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/scene.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/find.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/component-scheduler.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scene-graph/node-activator.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/prefab/prefab-info.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/prefab.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/prefab-link.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/utils/coordinates-converts-utils.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/scene-culling.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/global-descriptor-set-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/light.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/debug-view.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pipeline-ubo.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pipeline-event.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-flow.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/enum.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pipeline-serialization.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-pipeline.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/model.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-batched-queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-instanced-queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/submodel.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/octree.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/directional-light.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/spot-light.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/scene/sphere-light.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-additive-light-queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/planar-shadow-queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/ui-phase.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/forward/forward-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/forward/forward-flow.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/render-shadow-map-batched-queue.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/shadow/shadow-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/shadow/shadow-flow.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/deprecation.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/rendering-sub-mesh.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/assets/scene-asset.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/shadow/csm-layers.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/deferred-pipeline-scene-data.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/pipeline-scene-data.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/forward/forward-pipeline.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/gbuffer-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/lighting-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/postprocess-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/bloom-stage.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/main-flow.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/deferred/deferred-pipeline.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/pipeline/index.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/splash-screen.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/scheduler.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/render-scene.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/renderer/core/render-window.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/root.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/pacer/pacer-web.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/2d/framework/ui-renderer-manager.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/director.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/game.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/pal/env/web/env.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/visible-rect.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/view.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/core/platform/deprecated.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/physics/bullet/bullet-env.ts","../../../../../../../../../../Applications/CocosCreator/Creator/3.6.2/CocosCreator.app/Contents/Resources/resources/3d/engine/cocos/physics/bullet/instantiated.ts"],"sourcesContent":["/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ValueType } from '../value-types';\nimport { IVec3Like } from './type-define';\n\nconst _d2r = Math.PI / 180.0;\n\nconst _r2d = 180.0 / Math.PI;\n\nexport const EPSILON = 0.000001;\n\n/**\n * @en Tests whether or not the arguments have approximately the same value, within an absolute<br/>\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less<br/>\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n * @zh 在glMatrix的绝对或相对容差范围内，测试参数是否具有近似相同的值。<br/>\n * EPSILON(小于等于1.0的值采用绝对公差，大于1.0的值采用相对公差)\n * @param a The first number to test.\n * @param b The second number to test.\n * @return True if the numbers are approximately equal, false otherwise.\n */\nexport function equals (a: number, b: number) {\n    return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\n\n/**\n * @en Tests whether or not the arguments have approximately the same value by given maxDiff<br/>\n * @zh 通过给定的最大差异，测试参数是否具有近似相同的值。\n * @param a The first number to test.\n * @param b The second number to test.\n * @param maxDiff Maximum difference.\n * @return True if the numbers are approximately equal, false otherwise.\n */\nexport function approx (a: number, b: number, maxDiff: number) {\n    maxDiff = maxDiff || EPSILON;\n    return Math.abs(a - b) <= maxDiff;\n}\n\n/**\n * @en Clamps a value between a minimum float and maximum float value.<br/>\n * @zh 返回最小浮点数和最大浮点数之间的一个数值。可以使用 clamp 函数将不断变化的数值限制在范围内。\n * @param val\n * @param min\n * @param max\n */\nexport function clamp (val: number, min: number, max: number) {\n    if (min > max) {\n        const temp = min;\n        min = max;\n        max = temp;\n    }\n\n    return val < min ? min : val > max ? max : val;\n}\n\n/**\n * @en Clamps a value between 0 and 1.<br/>\n * @zh 将值限制在0和1之间。\n * @param val\n */\nexport function clamp01 (val: number) {\n    return val < 0 ? 0 : val > 1 ? 1 : val;\n}\n\n/**\n * @param from\n * @param to\n * @param ratio - The interpolation coefficient.\n */\nexport function lerp (from: number, to: number, ratio: number) {\n    return from + (to - from) * ratio;\n}\n\n/**\n * @en Convert Degree To Radian<br/>\n * @zh 把角度换算成弧度。\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian (a: number) {\n    return a * _d2r;\n}\n\n/**\n * @en Convert Radian To Degree<br/>\n * @zh 把弧度换算成角度。\n * @param {Number} a Angle in Radian\n */\nexport function toDegree (a: number) {\n    return a * _r2d;\n}\n\n/**\n * @method random\n */\nexport const random = Math.random;\n\n/**\n * @en Returns a floating-point random number between min (inclusive) and max (exclusive).<br/>\n * @zh 返回最小(包含)和最大(不包含)之间的浮点随机数。\n * @method randomRange\n * @param min\n * @param max\n * @return The random number.\n */\nexport function randomRange (min: number, max: number) {\n    return Math.random() * (max - min) + min;\n}\n\n/**\n * @en Returns a random integer between min (inclusive) and max (exclusive).<br/>\n * @zh 返回最小(包含)和最大(不包含)之间的随机整数。\n * @param min\n * @param max\n * @return The random integer.\n */\nexport function randomRangeInt (min: number, max: number) {\n    return Math.floor(randomRange(min, max));\n}\n\n/**\n * @en\n * Linear congruence generator using Hull-Dobell Theorem.\n * @zh\n * 使用 Hull-Dobell 算法的线性同余生成器构造伪随机数\n *\n * @param seed The random seed.\n * @return The pseudo random.\n */\nexport function pseudoRandom (seed: number) {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed / 233280.0;\n}\n\n/**\n * @en\n * Returns a floating-point pseudo-random number between min (inclusive) and max (exclusive).\n * @zh\n * 返回一个在范围内的浮点伪随机数，注意，不包含边界值\n *\n * @param seed\n * @param min\n * @param max\n * @return The random number.\n */\nexport function pseudoRandomRange (seed: number, min: number, max: number) {\n    return pseudoRandom(seed) * (max - min) + min;\n}\n\n/**\n * @en Returns a pseudo-random integer between min (inclusive) and max (exclusive).<br/>\n * @zh 返回最小(包含)和最大(不包含)之间的浮点伪随机数。\n * @param seed\n * @param min\n * @param max\n * @return The random integer.\n */\nexport function pseudoRandomRangeInt (seed: number, min: number, max: number) {\n    return Math.floor(pseudoRandomRange(seed, min, max));\n}\n\n/**\n * @en\n * Returns the next power of two for the value.<br/>\n * @zh\n * 返回下一个最接近的 2 的幂\n *\n * @param val\n * @return The the next power of two.\n */\nexport function nextPow2 (val: number) {\n    --val;\n    val |= (val >> 1);\n    val |= (val >> 2);\n    val |= (val >> 4);\n    val |= (val >> 8);\n    val |= (val >> 16);\n    ++val;\n    return val;\n}\n\n/**\n * @en Returns float remainder for t / length.<br/>\n * @zh 返回t / length的浮点余数。\n * @param t Time start at 0.\n * @param length Time of one cycle.\n * @return The Time wrapped in the first cycle.\n */\nexport function repeat (t: number, length: number) {\n    return t - Math.floor(t / length) * length;\n}\n\n/**\n * @en\n * Returns time wrapped in ping-pong mode.\n * @zh\n * 返回乒乓模式下的相对时间\n *\n * @param t Time start at 0.\n * @param length Time of one cycle.\n * @return The time wrapped in the first cycle.\n */\nexport function pingPong (t: number, length: number) {\n    t = repeat(t, length * 2);\n    t = length - Math.abs(t - length);\n    return t;\n}\n\n/**\n * @en Returns ratio of a value within a given range.<br/>\n * @zh 返回给定范围内的值的比率。\n * @param from Start value.\n * @param to End value.\n * @param value Given value.\n * @return The ratio between [from, to].\n */\nexport function inverseLerp (from: number, to: number, value: number) {\n    return (value - from) / (to - from);\n}\n\n/**\n * @en Compare the absolute values of all components and the component with the largest absolute value will be returned.\n * @zh 对所有分量的绝对值进行比较大小，返回绝对值最大的分量。\n * @param v vec3 like value\n * @returns max absolute component\n */\nexport function absMaxComponent (v: IVec3Like) {\n    if (Math.abs(v.x) > Math.abs(v.y)) {\n        if (Math.abs(v.x) > Math.abs(v.z)) {\n            return v.x;\n        } else {\n            return v.z;\n        }\n    } else if (Math.abs(v.y) > Math.abs(v.z)) {\n        return v.y;\n    } else {\n        return v.z;\n    }\n}\n\n/**\n * @en Compare the absolute value of two values and return the value with the largest absolute value\n * @zh 对 a b 的绝对值进行比较大小，返回绝对值最大的值。\n * @param a number\n * @param b number\n */\nexport function absMax (a: number, b: number) {\n    if (Math.abs(a) > Math.abs(b)) {\n        return a;\n    } else {\n        return b;\n    }\n}\n\n/**\n * @en\n * Make the attributes of the specified class available to be enumerated\n * @zh\n * 使指定类的特定属性可被枚举\n * @param prototype Inherit the prototype chain of the ValueType class\n * @param attrs List of attributes that need to be enumerated\n */\nexport function enumerableProps (prototype: ValueType, attrs: string[]) {\n    attrs.forEach((key) => {\n        Object.defineProperty(prototype, key, { enumerable: true });\n    });\n}\n","/*\r\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n */\r\n\r\nimport { Format, FormatInfos, FormatType, FormatInfo } from '../../core/gfx';\r\nimport { sys } from '../../core/platform/sys';\r\n\r\nconst _typeMap: Record<string, string> = {\r\n    [FormatType.UNORM]: 'Uint',\r\n    [FormatType.SNORM]: 'Int',\r\n    [FormatType.UINT]: 'Uint',\r\n    [FormatType.INT]: 'Int',\r\n    [FormatType.UFLOAT]: 'Float',\r\n    [FormatType.FLOAT]: 'Float',\r\n    default: 'Uint',\r\n};\r\nfunction _getDataViewType (info: FormatInfo) {\r\n    const type = _typeMap[info.type] || _typeMap.default;\r\n    const bytes = info.size / info.count * 8;\r\n    return `${type}${bytes}`;\r\n}\r\n\r\n// default params bahaves just like on an plain, compact Float32Array\r\nexport function writeBuffer (target: DataView, data: number[], format: Format = Format.R32F, offset = 0, stride = 0) {\r\n    const info = FormatInfos[format];\r\n    if (!stride) { stride = info.size; }\r\n    const writer = `set${_getDataViewType(info)}`;\r\n    const componentBytesLength = info.size / info.count;\r\n    const nSeg = Math.floor(data.length / info.count);\r\n    const isLittleEndian = sys.isLittleEndian;\r\n\r\n    for (let iSeg = 0; iSeg < nSeg; ++iSeg) {\r\n        const x = offset + stride * iSeg;\r\n        for (let iComponent = 0; iComponent < info.count; ++iComponent) {\r\n            const y = x + componentBytesLength * iComponent;\r\n            target[writer](y, data[info.count * iSeg + iComponent], isLittleEndian);\r\n        }\r\n    }\r\n}\r\nexport function readBuffer (\r\n    target: DataView, format: Format = Format.R32F, offset = 0,\r\n    length: number = target.byteLength - offset, stride = 0, out: number[] = [],\r\n) {\r\n    const info = FormatInfos[format];\r\n    if (!stride) { stride = info.size; }\r\n    const reader = `get${_getDataViewType(info)}`;\r\n    const componentBytesLength = info.size / info.count;\r\n    const nSeg = Math.floor(length / stride);\r\n    const isLittleEndian = sys.isLittleEndian;\r\n\r\n    for (let iSeg = 0; iSeg < nSeg; ++iSeg) {\r\n        const x = offset + stride * iSeg;\r\n        for (let iComponent = 0; iComponent < info.count; ++iComponent) {\r\n            const y = x + componentBytesLength * iComponent;\r\n            out[info.count * iSeg + iComponent] = target[reader](y, isLittleEndian);\r\n        }\r\n    }\r\n    return out;\r\n}\r\nexport function mapBuffer (\r\n    target: DataView, callback: (cur: number, idx: number, view: DataView) => number, format: Format = Format.R32F,\r\n    offset = 0, length: number = target.byteLength - offset, stride = 0, out?: DataView,\r\n) {\r\n    if (!out) { out = new DataView(target.buffer.slice(target.byteOffset, target.byteOffset + target.byteLength)); }\r\n    const info = FormatInfos[format];\r\n    if (!stride) { stride = info.size; }\r\n    const writer = `set${_getDataViewType(info)}`;\r\n    const reader = `get${_getDataViewType(info)}`;\r\n    const componentBytesLength = info.size / info.count;\r\n    const nSeg = Math.floor(length / stride);\r\n    const isLittleEndian = sys.isLittleEndian;\r\n\r\n    for (let iSeg = 0; iSeg < nSeg; ++iSeg) {\r\n        const x = offset + stride * iSeg;\r\n        for (let iComponent = 0; iComponent < info.count; ++iComponent) {\r\n            const y = x + componentBytesLength * iComponent;\r\n            const cur = target[reader](y, isLittleEndian);\r\n            // iComponent is usually more useful than y\r\n            out[writer](y, callback(cur, iComponent, target), isLittleEndian);\r\n        }\r\n    }\r\n    return out;\r\n}\r\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { DEBUG } from 'internal:constants';\n\n/**\n * Asserts that the expression is non-nullable, i.e. is neither `null` nor `undefined`.\n * @param expr Testing expression.\n * @param message Optional message.\n */\nexport function assertIsNonNullable<T> (expr: T, message?: string): asserts expr is NonNullable<T> {\n    assertIsTrue(!(expr === null || expr === undefined), message);\n}\n\n/**\n * Asserts that the expression evaluated to `true`.\n * @param expr Testing expression.\n * @param message Optional message.\n */\nexport function assertIsTrue (expr: unknown, message?: string): asserts expr {\n    if (DEBUG && !expr) {\n        // eslint-disable-next-line no-debugger\n        // debugger;\n        throw new Error(`Assertion failed: ${message ?? '<no-message>'}`);\n    }\n}\n\nexport function assertsArrayIndex<T> (array: T[], index: number) {\n    assertIsTrue(index >= 0 && index < array.length, `Array index ${index} out of bounds: [0, ${array.length})`);\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport { legacyCC } from '../global-exports';\nimport { error } from '../platform/debug';\nimport { js } from '../utils/js';\nimport { callInNextTick } from '../utils/misc';\nimport Config from './config';\nimport { dependMap, nativeDependMap } from './depend-maps';\nimport dependUtil from './depend-util';\nimport { isScene } from './helper';\nimport RequestItem from './request-item';\nimport { assets, AssetType, CompleteCallbackNoData, CompleteCallback, IOptions, ProgressCallback, references } from './shared';\nimport Task from './task';\n\nlet defaultProgressCallback: ProgressCallback | null = null;\n\ndeclare class WeakRef {\n    constructor (obj: any);\n}\n\nexport function setDefaultProgressCallback (onProgress: ProgressCallback) {\n    defaultProgressCallback = onProgress;\n}\n\nexport function clear (task: Task, clearRef: boolean) {\n    for (let i = 0, l = task.input.length; i < l; i++) {\n        const item = task.input[i] as RequestItem;\n        if (clearRef) {\n            if (!item.isNative && item.content instanceof Asset) {\n                item.content.decRef(false);\n            }\n        }\n        item.recycle();\n    }\n    task.input = null;\n}\n\nexport function urlAppendTimestamp (url: string, append: boolean): string {\n    if (append) {\n        if (/\\?/.test(url)) {\n            return `${url}&_t=${Date.now()}`;\n        }\n\n        return `${url}?_t=${Date.now()}`;\n    }\n    return url;\n}\n\nexport type RetryFunction = (times: number, done: CompleteCallback) => void;\n\nexport function retry (process: RetryFunction, times: number, wait: number, onComplete: CompleteCallback, index = 0) {\n    process(index, (err, result) => {\n        index++;\n        if (!err || index > times) {\n            if (onComplete) {\n                onComplete(err, result);\n            }\n        } else {\n            setTimeout(() => {\n                retry(process, times, wait, onComplete, index);\n            }, wait);\n        }\n    });\n}\n\nexport function getDepends (uuid: string, data: Asset | Record<string, any>, exclude: Record<string, any>,\n    depends: any[], config: Config): void {\n    try {\n        const info = dependUtil.parse(uuid, data);\n        for (let i = 0, l = info.deps.length; i < l; i++) {\n            const dep = info.deps[i];\n            if (!(dep in exclude)) {\n                exclude[dep] = true;\n                depends.push({ uuid: dep, bundle: config && config.name });\n            }\n        }\n        if (info.nativeDep) {\n            if (config) {\n                info.nativeDep.bundle = config.name;\n            }\n            depends.push({ ...info.nativeDep });\n        }\n    } catch (e) {\n        error((e as Error).message, (e as Error).stack);\n    }\n}\n\nexport function cache (id: string, asset: Asset, cacheAsset?: boolean) {\n    if (!asset) { return; }\n    cacheAsset = cacheAsset !== undefined ? cacheAsset : legacyCC.assetManager.cacheAsset;\n    if (!isScene(asset) && cacheAsset && !asset.isDefault) {\n        assets.add(id, asset);\n    }\n}\n\nexport function setProperties (uuid: string, asset: Asset, assetsMap: Record<string, any>) {\n    let missingAsset = false;\n    const depends = dependMap.get(asset);\n    if (depends) {\n        let missingAssetReporter: any = null;\n        for (let i = 0, l = depends.length; i < l; i++) {\n            const depend = depends[i];\n            const dependAsset = assetsMap[`${depend.uuid}@import`];\n            if (!dependAsset) {\n                if (EDITOR) {\n                    if (!missingAssetReporter) {\n                        // eslint-disable-next-line new-cap\n                        missingAssetReporter = new EditorExtends.MissingReporter.object(asset);\n                    }\n                    missingAssetReporter.stashByOwner(depend.owner, depend.prop, EditorExtends.serialize.asAsset(depend.uuid));\n                } else {\n                    error(`The asset ${depend.uuid} is missing!`);\n                }\n                if (depend.type && depend.type !== Asset) {\n                    // eslint-disable-next-line new-cap\n                    const placeHolder = new depend.type();\n                    placeHolder.initDefault(depend.uuid);\n                    depend.owner[depend.prop] = placeHolder;\n                }\n                missingAsset = true;\n            } else {\n                depend.owner[depend.prop] = dependAsset.addRef();\n                if (EDITOR) {\n                    let reference = references!.get(dependAsset);\n                    if (!reference || isScene(asset)) {\n                        reference = [];\n                        references!.add(depend.uuid, reference);\n                    }\n                    reference.push([new WeakRef(asset), new WeakRef(depend.owner), depend.prop]);\n                }\n            }\n        }\n\n        if (missingAssetReporter) {\n            missingAssetReporter.reportByOwner();\n        }\n        dependMap.delete(asset);\n    }\n\n    if (nativeDependMap.has(asset)) {\n        if (assetsMap[`${uuid}@native`]) {\n            asset._nativeAsset = assetsMap[`${uuid}@native`];\n        } else {\n            missingAsset = true;\n            console.error(`the native asset of ${uuid} is missing!`);\n        }\n        nativeDependMap.delete(asset);\n    }\n    return missingAsset;\n}\n\nexport function gatherAsset (task: Task) {\n    const source = task.source;\n    if (!task.options!.__outputAsArray__ && source.length === 1) {\n        task.output = source[0].content;\n    } else {\n        const output: any[] = task.output = [];\n        for (let i = 0, l = source.length; i < l; i++) {\n            output.push(source[i].content);\n        }\n    }\n}\n\ntype ForEachFunction<T> = (item: T, done: CompleteCallbackNoData) => void;\n\nexport function forEach<T = any> (array: T[], process: ForEachFunction<T>, onComplete: (errs: Error[]) => void) {\n    let count = 0;\n    const errs: Error[] = [];\n    const length = array.length;\n    if (length === 0 && onComplete) {\n        onComplete(errs);\n    }\n    const cb = (err) => {\n        if (err) {\n            errs.push(err);\n        }\n        count++;\n        if (count === length) {\n            if (onComplete) {\n                onComplete(errs);\n            }\n        }\n    };\n    for (let i = 0; i < length; i++) {\n        process(array[i], cb);\n    }\n}\n\ninterface IParameters<T> {\n    options: IOptions;\n    onProgress: ProgressCallback | null;\n    onComplete: T | null;\n}\n\ninterface ILoadResArgs<T> {\n    type: AssetType | null;\n    onProgress: ProgressCallback | null;\n    onComplete: T | null;\n}\n\nexport function parseParameters<T extends (...args) => void> (\n    options: IOptions | ProgressCallback | T | null | undefined,\n    onProgress: ProgressCallback | T | null | undefined,\n    onComplete: T | null | undefined): IParameters<T> {\n    let optionsOut: any = options;\n    let onProgressOut: any = onProgress;\n    let onCompleteOut: any = onComplete;\n    if (onComplete === undefined) {\n        const isCallback = typeof options === 'function';\n        if (onProgress) {\n            onCompleteOut = onProgress as T;\n            if (!isCallback) {\n                onProgressOut = null;\n            }\n        } else if (onProgress === undefined && isCallback) {\n            onCompleteOut = options as T;\n            optionsOut = null;\n            onProgressOut = null;\n        }\n        if (onProgress !== undefined && isCallback) {\n            onProgressOut = options as ProgressCallback;\n            optionsOut = null;\n        }\n    }\n\n    return { options: optionsOut || Object.create(null), onProgress: onProgressOut, onComplete: onCompleteOut };\n}\n\nexport function parseLoadResArgs<T extends (...args) => void> (\n    type: AssetType | ProgressCallback | T | null | undefined,\n    onProgress: ProgressCallback | T | null | undefined,\n    onComplete: T | null | undefined): ILoadResArgs<T> {\n    let typeOut: any = type;\n    let onProgressOut: any = onProgress;\n    let onCompleteOut: any = onComplete;\n    if (onComplete === undefined) {\n        const isValidType = js.isChildClassOf(type as AssetType, Asset);\n        if (onProgress) {\n            onCompleteOut = onProgress as T;\n            if (isValidType) {\n                onProgressOut = null;\n            }\n        } else if (onProgress === undefined && !isValidType) {\n            onCompleteOut = type as T;\n            onProgressOut = null;\n            typeOut = null;\n        }\n        if (onProgress !== undefined && !isValidType) {\n            onProgressOut = type as ProgressCallback;\n            typeOut = null;\n        }\n    }\n\n    return { type: typeOut, onProgress: onProgressOut || defaultProgressCallback, onComplete: onCompleteOut };\n}\n\nexport function checkCircleReference (owner: string, uuid: string, map: Record<string, any>, checked: Record<string, boolean> = {}): boolean {\n    const item = map[uuid];\n    if (!item || checked[uuid]) {\n        return false;\n    }\n    checked[uuid] = true;\n    let result = false;\n    const deps = dependUtil.getDeps(uuid);\n    if (deps) {\n        for (let i = 0, l = deps.length; i < l; i++) {\n            const dep = deps[i];\n            if (dep === owner || checkCircleReference(owner, dep, map, checked)) {\n                result = true;\n                break;\n            }\n        }\n    }\n    return result;\n}\n\nexport function asyncify (cb: ((p1?: any, p2?: any) => void) | null): (p1?: any, p2?: any) => void {\n    return (p1, p2) => {\n        if (!cb) { return; }\n        const refs: Asset[] = [];\n        if (Array.isArray(p2)) {\n            p2.forEach((x) => x instanceof Asset && refs.push(x.addRef()));\n        } else if (p2 instanceof Asset) {\n            refs.push(p2.addRef());\n        }\n        callInNextTick(() => {\n            refs.forEach((x) => x.decRef(false));\n            cb(p1, p2);\n        });\n    };\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccenum } from '../value-types/enum';\n\nexport enum WrapModeMask {\n    Default = 0,\n    Normal = 1 << 0,\n    Loop = 1 << 1,\n    ShouldWrap = 1 << 2,\n    Clamp = 1 << 3,\n    PingPong = 1 << 4 | 1 << 1 | 1 << 2,  // Loop, ShouldWrap\n    Reverse = 1 << 5 | 1 << 2,      // ShouldWrap\n}\n\n/**\n * 动画使用的循环模式。\n */\nexport enum WrapMode {\n    /**\n     * 向 Animation Component 或者 AnimationClip 查找 wrapMode\n     */\n    Default = WrapModeMask.Default,\n\n    /**\n     * 动画只播放一遍\n     */\n    Normal = WrapModeMask.Normal,\n\n    /**\n     * 从最后一帧或结束位置开始反向播放，到第一帧或开始位置停止\n     */\n    Reverse = WrapModeMask.Reverse,\n\n    /**\n     * 循环播放\n     */\n    Loop = WrapModeMask.Loop,\n\n    /**\n     * 反向循环播放\n     */\n    LoopReverse = WrapModeMask.Loop | WrapModeMask.Reverse,\n\n    /**\n     * 从第一帧播放到最后一帧，然后反向播放回第一帧，到第一帧后再正向播放，如此循环\n     */\n    PingPong = WrapModeMask.PingPong,\n\n    /**\n     * 从最后一帧开始反向播放，其他同 PingPong\n     */\n    PingPongReverse = WrapModeMask.PingPong | WrapModeMask.Reverse,\n}\n\nccenum(WrapMode);\n\n/**\n * For internal\n */\nexport class WrappedInfo {\n    public ratio = 0;\n    public time = 0;\n    public direction = 1;\n    public stopped = true;\n    public iterations = 0;\n    public frameIndex: number = undefined as unknown as number;\n\n    constructor (info?: WrappedInfo) {\n        if (info) {\n            this.set(info);\n        }\n    }\n\n    public set (info: WrappedInfo) {\n        this.ratio = info.ratio;\n        this.time = info.time;\n        this.direction = info.direction;\n        this.stopped = info.stopped;\n        this.iterations = info.iterations;\n        this.frameIndex = info.frameIndex;\n    }\n}\n\nexport interface ILerpable {\n    /**\n     * 在当前曲线值与目标曲线值之间插值。\n     * @param to 目标曲线值。\n     * @param t 插值比率。\n     * @param dt 当前曲线值与目标曲线值的时间间隔，单位为秒。\n     * @returns 插值结果。\n     */\n    lerp (to: any, t: number, dt: number): any;\n\n    /**\n     * 当直接使用曲线值作为采样结果时的结果值，它应该等同于插值比率为 0 时的插值结果。\n     * @returns 插值比率为 0 时的插值结果。\n     */\n    getNoLerp? (): any;\n}\n\nexport function isLerpable (object: any): object is ILerpable {\n    return typeof object.lerp === 'function';\n}\n","const sMetadataTag = Symbol('cc:SerializationMetadata');\n\n/**\n * @internal DO NOT USE IT IN YOUR CODES.\n * @param constructor\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function getSerializationMetadata (constructor: Function): SerializationMetadata | undefined {\n    return (constructor as MayBeInjected)[sMetadataTag];\n}\n\n/**\n * @internal\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function getOrCreateSerializationMetadata (constructor: Function): SerializationMetadata {\n    return (constructor as MayBeInjected)[sMetadataTag] ??= {};\n}\n\n/**\n * @internal For internal usage only. DO NOT USE IT IN YOUR CODES.\n */\nexport interface SerializationMetadata {\n    uniquelyReferenced?: boolean;\n}\n\ninterface MayBeInjected {\n    [sMetadataTag]?: SerializationMetadata;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { CCClass } from '../data/class';\nimport { clamp, inverseLerp, pingPong, repeat } from '../math/utils';\nimport { WrapModeMask } from '../animation/types';\nimport { ExtrapolationMode, RealCurve, RealInterpolationMode, RealKeyframeValue } from '../curves';\nimport { ccclass, serializable } from '../data/decorators';\n\nconst LOOK_FORWARD = 3;\n\n/**\n * @en\n * A key frame in the curve.\n * @zh\n * 曲线中的一个关键帧。\n */\nexport class Keyframe {\n    /**\n     * @en Current frame time.\n     * @zh 当前帧时间。\n     */\n    public time = 0;\n\n    /**\n     * @en Current frame value.\n     * @zh 当前帧的值。\n     */\n    public value = 0;\n\n    /**\n     * @en In tangent value.\n     * @zh 左切线。\n     */\n    public inTangent = 0;\n\n    /**\n     * @en Out tangent value.\n     * @zh 右切线。\n     */\n    public outTangent = 0;\n}\n\nCCClass.fastDefine('cc.Keyframe', Keyframe, {\n    time: 0,\n    value: 0,\n    inTangent: 0,\n    outTangent: 0,\n});\n\nexport class OptimizedKey {\n    public index: number;\n    public time: number;\n    public endTime: number;\n    public coefficient: Float32Array;\n    constructor () {\n        this.index = -1;\n        this.time = 0;\n        this.endTime = 0;\n        this.coefficient = new Float32Array(4);\n    }\n\n    public evaluate (T: number) {\n        const t = T - this.time;\n        return evalOptCurve(t, this.coefficient);\n    }\n}\n\nexport function evalOptCurve (t: number, coefs: Float32Array | number[]) {\n    return (t * (t * (t * coefs[0] + coefs[1]) + coefs[2])) + coefs[3];\n}\n\n/**\n * @en\n * Describe a curve in which three times Hermite interpolation is used for each adjacent key frame.\n * @zh\n * 描述一条曲线，其中每个相邻关键帧采用三次hermite插值计算。\n */\nexport class AnimationCurve {\n    private _curve!: RealCurve;\n\n    private static defaultKF: Keyframe[] = [{\n        time: 0,\n        value: 1,\n        inTangent: 0,\n        outTangent: 0,\n    }, {\n        time: 1,\n        value: 1,\n        inTangent: 0,\n        outTangent: 0,\n    }];\n\n    /**\n     * For internal usage only.\n     * @internal\n     */\n    get _internalCurve () {\n        return this._curve;\n    }\n\n    /**\n     * @en\n     * The key frame of the curve.\n     * @zh\n     * 曲线的关键帧。\n     */\n    get keyFrames () {\n        return Array.from(this._curve.keyframes()).map(([time, value]) => {\n            const legacyKeyframe = new Keyframe();\n            legacyKeyframe.time = time;\n            legacyKeyframe.value = value.value;\n            legacyKeyframe.inTangent = value.leftTangent;\n            legacyKeyframe.outTangent = value.rightTangent;\n            return legacyKeyframe;\n        });\n    }\n\n    set keyFrames (value) {\n        this._curve.assignSorted(value.map((legacyCurve) => [\n            legacyCurve.time,\n            {\n                interpolationMode: RealInterpolationMode.CUBIC,\n                value: legacyCurve.value,\n                leftTangent: legacyCurve.inTangent,\n                rightTangent: legacyCurve.outTangent,\n            },\n        ]));\n    }\n\n    /**\n     * @en\n     * Loop mode [[AnimationClip.WrapMode]] when the sampling time exceeds the left end.\n     * @zh\n     * 当采样时间超出左端时采用的循环模式[[AnimationClip.WrapMode]]。\n     */\n    get preWrapMode () {\n        return toLegacyWrapMode(this._curve.preExtrapolation);\n    }\n\n    set preWrapMode (value) {\n        this._curve.preExtrapolation = fromLegacyWrapMode(value);\n    }\n\n    /**\n     * @en\n     * Cycle mode [[AnimationClip.WrapMode]] when the sampling time exceeds the right end.\n     * @zh\n     * 当采样时间超出右端时采用的循环模式[[AnimationClip.WrapMode]]。\n     */\n    get postWrapMode () {\n        return toLegacyWrapMode(this._curve.postExtrapolation);\n    }\n\n    set postWrapMode (value) {\n        this._curve.postExtrapolation = fromLegacyWrapMode(value);\n    }\n\n    private cachedKey: OptimizedKey;\n\n    /**\n     * @en Construct a curve with key frames\n     * @zh 通过关键帧构造一条曲线。\n     * @param keyFrames @zh 关键帧 @en Key frames\n     */\n    constructor (keyFrames: Keyframe[] | null | RealCurve = null) {\n        if (keyFrames instanceof RealCurve) {\n            this._curve = keyFrames;\n        } else {\n            const curve = new RealCurve();\n            this._curve = curve;\n            curve.preExtrapolation = ExtrapolationMode.LOOP;\n            curve.postExtrapolation = ExtrapolationMode.CLAMP;\n            if (!keyFrames) {\n                curve.assignSorted([\n                    [0.0, { interpolationMode: RealInterpolationMode.CUBIC, value: 1.0 }],\n                    [1.0, { interpolationMode: RealInterpolationMode.CUBIC, value: 1.0 }],\n                ]);\n            } else {\n                curve.assignSorted(keyFrames.map((legacyKeyframe) => [legacyKeyframe.time, {\n                    interpolationMode: RealInterpolationMode.CUBIC,\n                    value: legacyKeyframe.value,\n                    leftTangent: legacyKeyframe.inTangent,\n                    rightTangent: legacyKeyframe.outTangent,\n                }]));\n            }\n        }\n        this.cachedKey = new OptimizedKey();\n    }\n\n    /**\n     * @en\n     * Add a keyframe.\n     * @zh\n     * 添加一个关键帧。\n     * @param keyFrame @en A keyframe. @zh 关键帧。\n     */\n    public addKey (keyFrame: Keyframe | null) {\n        if (!keyFrame) {\n            this._curve.clear();\n        } else {\n            this._curve.addKeyFrame(keyFrame.time, {\n                interpolationMode: RealInterpolationMode.CUBIC,\n                value: keyFrame.value,\n                leftTangent: keyFrame.inTangent,\n                rightTangent: keyFrame.outTangent,\n            });\n        }\n    }\n\n    /**\n     * @ignore\n     * @param time\n     */\n    public evaluate_slow (time: number) {\n        return this._curve.evaluate(time);\n    }\n\n    /**\n     * @en\n     * Calculate the curve interpolation at a given point in time.\n     * @zh\n     * 计算给定时间点的曲线插值。\n     * @param time @en The time. @zh 时间。\n     */\n    public evaluate (time: number) {\n        const { cachedKey, _curve: curve } = this;\n        const nKeyframes = curve.keyFramesCount;\n        const lastKeyframeIndex = nKeyframes - 1;\n        let wrappedTime = time;\n        const extrapolationMode = time < 0 ? curve.preExtrapolation : curve.postExtrapolation;\n        const startTime = curve.getKeyframeTime(0);\n        const endTime = curve.getKeyframeTime(lastKeyframeIndex);\n        switch (extrapolationMode) {\n        case ExtrapolationMode.LOOP:\n            wrappedTime = repeat(time - startTime, endTime - startTime) + startTime;\n            break;\n        case ExtrapolationMode.PING_PONG:\n            wrappedTime = pingPong(time - startTime, endTime - startTime) + startTime;\n            break;\n        case ExtrapolationMode.CLAMP:\n        default:\n            wrappedTime = clamp(time, startTime, endTime);\n            break;\n        }\n        if (wrappedTime >= cachedKey.time && wrappedTime < cachedKey.endTime) {\n            return cachedKey.evaluate(wrappedTime);\n        }\n        const leftIndex = this.findIndex(cachedKey, wrappedTime);\n        const rightIndex = Math.min(leftIndex + 1, lastKeyframeIndex);\n        this.calcOptimizedKey(cachedKey, leftIndex, rightIndex);\n        return cachedKey.evaluate(wrappedTime);\n    }\n\n    /**\n     * @ignore\n     * @param optKey\n     * @param leftIndex\n     * @param rightIndex\n     */\n    public calcOptimizedKey (optKey: OptimizedKey, leftIndex: number, rightIndex: number) {\n        const lhsTime = this._curve.getKeyframeTime(leftIndex);\n        const rhsTime = this._curve.getKeyframeTime(rightIndex);\n        const { value: lhsValue, leftTangent: lhsOutTangent } = this._curve.getKeyframeValue(leftIndex);\n        const { value: rhsValue, rightTangent: rhsInTangent  } = this._curve.getKeyframeValue(rightIndex);\n        optKey.index = leftIndex;\n        optKey.time = lhsTime;\n        optKey.endTime = rhsTime;\n\n        const dx = rhsTime - lhsTime;\n        const dy = rhsValue - lhsValue;\n        const length = 1 / (dx * dx);\n        const d1 = lhsOutTangent * dx;\n        const d2 = rhsInTangent * dx;\n\n        optKey.coefficient[0] = (d1 + d2 - dy - dy) * length / dx;\n        optKey.coefficient[1] = (dy + dy + dy - d1 - d1 - d2) * length;\n        optKey.coefficient[2] = lhsOutTangent;\n        optKey.coefficient[3] = lhsValue;\n    }\n\n    /**\n     * @ignore\n     * @param optKey\n     * @param t\n     */\n    private findIndex (optKey: OptimizedKey, t: number) {\n        const { _curve: curve } = this;\n        const nKeyframes = curve.keyFramesCount;\n        const cachedIndex = optKey.index;\n        if (cachedIndex !== -1) {\n            const cachedTime = curve.getKeyframeTime(cachedIndex);\n            if (t > cachedTime) {\n                for (let i = 0; i < LOOK_FORWARD; i++) {\n                    const currIndex = cachedIndex + i;\n                    if (currIndex + 1 < nKeyframes && curve.getKeyframeTime(currIndex + 1) > t) {\n                        return currIndex;\n                    }\n                }\n            } else {\n                for (let i = 0; i < LOOK_FORWARD; i++) {\n                    const currIndex = cachedIndex - i;\n                    if (currIndex >= 0 && curve.getKeyframeTime(currIndex - 1) <= t) {\n                        return currIndex - 1;\n                    }\n                }\n            }\n        }\n        let left = 0;\n        let right = nKeyframes;\n        let mid;\n        while (right - left > 1) {\n            mid = Math.floor((left + right) / 2);\n            if (curve.getKeyframeTime(mid) >= t) {\n                right = mid;\n            } else {\n                left = mid;\n            }\n        }\n        return left;\n    }\n}\n\nCCClass.fastDefine('cc.AnimationCurve', AnimationCurve, {\n    _curve: null,\n});\n\nfunction fromLegacyWrapMode (legacyWrapMode: WrapModeMask): ExtrapolationMode {\n    switch (legacyWrapMode) {\n    default:\n    case WrapModeMask.Default:\n    case WrapModeMask.Normal:\n    case WrapModeMask.Clamp: return ExtrapolationMode.CLAMP;\n    case WrapModeMask.PingPong: return ExtrapolationMode.PING_PONG;\n    case WrapModeMask.Loop: return ExtrapolationMode.LOOP;\n    }\n}\n\nfunction toLegacyWrapMode (extrapolationMode: ExtrapolationMode): WrapModeMask {\n    switch (extrapolationMode) {\n    default:\n    case ExtrapolationMode.LINEAR:\n    case ExtrapolationMode.CLAMP: return WrapModeMask.Clamp;\n    case ExtrapolationMode.PING_PONG: return WrapModeMask.PingPong;\n    case ExtrapolationMode.LOOP: return WrapModeMask.Loop;\n    }\n}\n\n/**\n * Same as but more effective than `new LegacyCurve()._internalCurve`.\n */\nexport function constructLegacyCurveAndConvert () {\n    const curve = new RealCurve();\n    curve.assignSorted([\n        [0.0, { interpolationMode: RealInterpolationMode.CUBIC, value: 1.0 }],\n        [1.0, { interpolationMode: RealInterpolationMode.CUBIC, value: 1.0 }],\n    ]);\n    return curve;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/* eslint-disable @typescript-eslint/ban-types */\n/* eslint-disable import/no-mutable-exports */\n/* eslint-disable func-names */\n/* eslint-disable @typescript-eslint/no-unsafe-return */\n/* eslint-disable prefer-const */\n\nimport { error, errorID, warn, warnID } from '../platform/debug';\n\nlet defaultLogTimes = 10;\n\n/**\n * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n */\nexport function setDefaultLogTimes (times: number): void {\n    if (times > 0) {\n        defaultLogTimes = times;\n    }\n}\n\ninterface IReplacement {\n    /** 废弃属性的名称 */\n    name: string;\n    /** 警告的次数 */\n    logTimes?: number;\n    /** 替换属性的名称 */\n    newName?: string;\n    /** 废弃属性的所属对象 */\n    target?: object;\n    /** 废弃属性的所属对象的名称 */\n    targetName?: string;\n    /** 自定义替换属性（函数） */\n    customFunction?: Function;\n    /** 自定义替换属性的 setter */\n    customSetter?: (v: any) => void;\n    /** 自定义替换属性的 getter */\n    customGetter?: () => any;\n    /** 额外建议 */\n    suggest?: string;\n}\n\ninterface IRemoveItem {\n    /** 废弃属性的名称 */\n    name: string;\n    /** 警告的次数 */\n    logTimes?: number;\n    /** 额外建议 */\n    suggest?: string;\n}\n\ninterface IMarkItem {\n    /** 废弃属性的名称 */\n    name: string;\n    /** 警告的次数 */\n    logTimes?: number;\n    /** 额外建议 */\n    suggest?: string;\n}\n\n/**\n * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n */\nexport let replaceProperty: (owner: object, ownerName: string, properties: IReplacement[]) => void;\n\n/**\n * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n */\nexport let removeProperty: (owner: object, ownerName: string, properties: IRemoveItem[]) => void;\n\n/**\n * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n */\nexport let markAsWarning: (owner: object, ownerName: string, properties: IMarkItem[]) => void;\n\nlet replacePropertyLog: (n: string, dp: string, n2: string, newp: string, f: Function, id: number, s: string) => void;\n\nlet markAsWarningLog: (n: string, dp: string, f: Function, id: number, s: string) => void;\n\nlet removePropertyLog: (n: string, dp: string, f: Function, id: number, s: string) => void;\n\n// if (DEBUG) {\n\ninterface IMeessageItem {\n    id: Readonly<number>;\n    logTimes: Readonly<number>;\n    count: number;\n}\n\nlet messageID = 0;\nconst messageMap: Map<number, IMeessageItem> = new Map<number, IMeessageItem>();\n\nreplacePropertyLog = (n: string, dp: string, n2: string, newp: string, f: Function, id: number, s: string) => {\n    const item = messageMap.get(id);\n    if (item && item.logTimes > item.count) {\n        f(`'%s' is deprecated, please use '%s' instead. ${s}`, `${n}.${dp}`, `${n2}.${newp}`);\n        item.count++;\n    }\n};\n\nreplaceProperty = (owner: object, ownerName: string, properties: IReplacement[]) => {\n    if (owner == null) return;\n\n    properties.forEach((item: IReplacement) => {\n        const id = messageID++;\n        messageMap.set(id, { id, count: 0, logTimes: item.logTimes !== undefined ? item.logTimes : defaultLogTimes });\n        const target = item.target != null ? item.target : owner;\n        const newName = item.newName != null ? item.newName : item.name;\n        const targetName = item.targetName != null ? item.targetName : ownerName;\n        const sameTarget = target === owner;\n        const suggest = item.suggest ? `(${item.suggest})` : '';\n        if (item.customFunction != null) {\n            owner[item.name] = function (this: any) {\n                replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                return item.customFunction!.call(this, ...arguments);\n            };\n        } else if (item.customSetter != null || item.customGetter != null) {\n            const hasSetter = item.customSetter != null;\n            const hasGetter = item.customGetter != null;\n            if (hasSetter && hasGetter) {\n                Object.defineProperty(owner, item.name, {\n                    get (this) {\n                        replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                        return item.customGetter!.call(this);\n                    },\n                    set (this, v: any) {\n                        replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                        item.customSetter!.call(this, v);\n                    },\n                    enumerable: false,\n                });\n            } else if (hasSetter) {\n                Object.defineProperty(owner, item.name, {\n                    set (this, v: any) {\n                        replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                        item.customSetter!.call(this, v);\n                    },\n                    enumerable: false,\n                });\n            } else if (hasGetter) {\n                Object.defineProperty(owner, item.name, {\n                    get (this) {\n                        replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                        return item.customGetter!.call(this);\n                    },\n                    enumerable: false,\n                });\n            }\n        } else {\n            Object.defineProperty(owner, item.name, {\n                get (this) {\n                    replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                    return sameTarget ? this[newName] : target[newName];\n                },\n                set (this, v: any) {\n                    replacePropertyLog(ownerName, item.name, targetName, newName, warn, id, suggest);\n                    if (sameTarget) {\n                        this[newName] = v;\n                    } else {\n                        target[newName] = v;\n                    }\n                },\n                enumerable: false,\n            });\n        }\n    });\n};\n\nremovePropertyLog = (n: string, dp: string, f: Function, id: number, s: string) => {\n    const item = messageMap.get(id);\n    if (item && item.logTimes > item.count) {\n        f(`'%s' has been removed. ${s}`, `${n}.${dp}`);\n        item.count++;\n    }\n};\n\nremoveProperty = (owner: object, ownerName: string, properties: IRemoveItem[]) => {\n    if (owner == null) return;\n\n    properties.forEach((item: IRemoveItem) => {\n        const id = messageID++;\n        messageMap.set(id, { id, count: 0, logTimes: item.logTimes !== undefined ? item.logTimes : defaultLogTimes });\n        const suggest = item.suggest ? `(${item.suggest})` : '';\n        Object.defineProperty(owner, item.name, {\n            get (this) {\n                return removePropertyLog(ownerName, item.name, error, id, suggest);\n            },\n            set (this) {\n                removePropertyLog(ownerName, item.name, error, id, suggest);\n            },\n            enumerable: false,\n        });\n    });\n};\n\nmarkAsWarningLog = (n: string, dp: string, f: Function, id: number, s: string) => {\n    const item = messageMap.get(id);\n    if (item && item.logTimes > item.count) {\n        f(`'%s' is deprecated. ${s}`, `${n}.${dp}`);\n        item.count++;\n    }\n};\n\nmarkAsWarning = (owner: object, ownerName: string, properties: IMarkItem[]) => {\n    if (owner == null) return;\n\n    const _defaultGetSet = (d: PropertyDescriptor, n: string, dp: string, f: Function, id: number, s: string) => {\n        if (d.get) {\n            const oldGet = d.get;\n            d.get = function (this) {\n                markAsWarningLog(n, dp, f, id, s);\n                return oldGet.call(this);\n            };\n        }\n        if (d.set) {\n            const oldSet = d.set;\n            d.set = function (this, v: any) {\n                markAsWarningLog(n, dp, f, id, s);\n                oldSet.call(this, v);\n            };\n        }\n        Object.defineProperty(owner, dp, d);\n    };\n\n    properties.forEach((item: IMarkItem) => {\n        const deprecatedProp = item.name;\n        const descriptor = Object.getOwnPropertyDescriptor(owner, deprecatedProp);\n        if (!descriptor || !descriptor.configurable) { return; }\n        const id = messageID++;\n        messageMap.set(id, { id, count: 0, logTimes: item.logTimes !== undefined ? item.logTimes : defaultLogTimes });\n        const suggest = item.suggest ? `(${item.suggest})` : '';\n        if (typeof descriptor.value !== 'undefined') {\n            if (typeof descriptor.value === 'function') {\n                const oldValue = descriptor.value as Function;\n                owner[deprecatedProp] = function (this) {\n                    markAsWarningLog(ownerName, deprecatedProp, warn, id, suggest);\n                    return oldValue.call(this, ...arguments);\n                };\n            } else {\n                let oldValue = descriptor.value;\n                Object.defineProperty(owner, deprecatedProp, {\n                    configurable: true,\n                    get () {\n                        markAsWarningLog(ownerName, deprecatedProp, warn, id, suggest);\n                        return oldValue;\n                    },\n                });\n                if (descriptor.writable) {\n                    Object.defineProperty(owner, deprecatedProp, {\n                        set (value) {\n                            markAsWarningLog(ownerName, deprecatedProp, warn, id, suggest);\n                            oldValue = value;\n                        },\n                    });\n                }\n            }\n        } else {\n            _defaultGetSet(descriptor, ownerName, deprecatedProp, warn, id, suggest);\n        }\n        Object.defineProperty(owner, deprecatedProp, { enumerable: false });\n    });\n};\n\n// } else {\n//     // for compatible\n\n//     replaceProperty = () => { };\n//     removeProperty = () => { };\n//     markAsWarning = () => { };\n\n//     replacePropertyLog = () => { };\n//     removePropertyLog = () => { };\n//     markAsWarningLog = () => { };\n// }\n\n/**\n * @engineInternal\n */\ninterface IDeprecateInfo {\n    newName?: string;\n    since: string;\n    removed: boolean,\n}\n\n/**\n * @engineInternal\n */\ninterface TopLevelDeprecateList {\n    [name: string]: IDeprecateInfo | undefined;\n}\n\nconst topLevelDeprecateList: TopLevelDeprecateList = {\n};\n\n/**\n * This is an internal method to register the deprecate info of module exported binding name.\n * DO NOT USE THIS INTERFACE.\n *\n * @example\n * ```ts\n * deprecateModuleExportedName({\n *     ButtonComponent: {\n *         newName: 'Button',\n *         since: '1.2.0',\n *         removed: false,\n *     },\n * });\n * ```\n * @engineInternal\n */\nexport function deprecateModuleExportedName (deprecateList: TopLevelDeprecateList) {\n    for (let deprecateName in deprecateList) {\n        const deprecateInfo = deprecateList[deprecateName];\n        topLevelDeprecateList[deprecateName] = deprecateInfo;\n    }\n}\n\nfunction _checkObsoleteByName (checkName: string) {\n    const deprecateInfo = topLevelDeprecateList[checkName];\n    if (!deprecateInfo) {\n        return;\n    }\n    const { newName, since, removed } = deprecateInfo;\n    if (removed) {\n        if (newName) {\n            errorID(16003, checkName, since, newName);\n        } else {\n            errorID(16002, checkName, since);\n        }\n    } else if (newName) {\n        warnID(16001, checkName, since, newName);\n    } else {\n        warnID(16000, checkName, since);\n    }\n}\n\n/**\n * An internal method to check whether the top level interface is deprecated.\n * DO NOT USE THIS INTERFACE.\n *\n * @example\n * ```ts\n * // print deprecate info of ButtonComponent and ToggleComponent\n * import { ButtonComponent, ToggleComponent } from 'cc';\n * ```\n * @engineInternal\n */\nexport function __checkObsolete__ (checkList: string[]) {\n    for (let checkName of checkList) {\n        _checkObsoleteByName(checkName);\n    }\n}\n\nlet _cachedProxy;\n/**\n * An internal method to check whether the top level interface is deprecated in namespace.\n * DO NOT USE THIS INTERFACE.\n *\n * @example\n * ```ts\n * import * as cc from 'cc';\n * console.log(cc.ButtonComponent);  // print deprecate info of ButtonComponent\n * ```\n * @engineInternal\n */\nexport function __checkObsoleteInNamespace__ (ccNamespace: object) {\n    if (!_cachedProxy) {\n        if (typeof Proxy === 'undefined') {\n            _cachedProxy = {};\n        } else {\n            _cachedProxy = new Proxy(ccNamespace, {\n                get (target, name, receiver) {\n                    // @ts-expect-error name could be a symbol\n                    _checkObsoleteByName(name);\n                    return Reflect.get(target, name, receiver);\n                },\n            });\n        }\n    }\n    return _cachedProxy;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * Bit twiddling hacks for JavaScript.\n *\n * Author: Mikola Lysenko\n *\n * Ported from Stanford bit twiddling hack library:\n *    http://graphics.stanford.edu/~seander/bithacks.html\n */\n\n/**\n * @en\n * Number of bits in an integer\n * @zh\n * 整型类型的 bit 数\n */\nexport const INT_BITS = 32;\n/**\n * @en\n * The maximal signed integer number\n * @zh\n * 最大有符号整型数\n */\nexport const INT_MAX = 0x7fffffff;\n/**\n * @en\n * The minimal signed integer number\n * @zh\n * 最小有符号整型数\n */\nexport const INT_MIN = -1 << (INT_BITS - 1);\n\n/**\n * @en Returns -1, 0, +1 depending on sign of x.\n * @zh 根据x的符号返回 -1，0，+1。\n */\nexport function sign (v: number) {\n    return ((v > 0) as unknown as number) - ((v < 0) as unknown as number);\n}\n\n/**\n * @en Computes absolute value of integer.\n * @zh 计算整数的绝对值。\n */\nexport function abs (v: number) {\n    const mask = v >> (INT_BITS - 1);\n    return (v ^ mask) - mask;\n}\n\n/**\n * @en Computes minimum of integers x and y.\n * @zh 计算整数x和y中的最小值。\n */\nexport function min (x: number, y: number) {\n    return y ^ ((x ^ y) & -(x < y));\n}\n\n/**\n * @en Computes maximum of integers x and y.\n * @zh 计算整数x和y中的最大值。\n */\nexport function max (x: number, y: number) {\n    return x ^ ((x ^ y) & -(x < y));\n}\n\n/**\n * @en Checks if a number is a power of two.\n * @zh 检查一个数字是否是2的幂。\n */\nexport function isPow2 (v: number) {\n    return !(v & (v - 1)) && (!!v);\n}\n\n/**\n * @en Computes log base 2 of v.\n * @zh 计算以 2 为底的 v 的对数。\n */\nexport function log2 (v: number) {\n    let r: number;\n    let shift: number;\n    r = ((v > 0xFFFF) as unknown as number) << 4; v >>>= r;\n    shift = ((v > 0xFF) as unknown as number) << 3; v >>>= shift; r |= shift;\n    shift = ((v > 0xF) as unknown as number) << 2; v >>>= shift; r |= shift;\n    shift = ((v > 0x3) as unknown as number) << 1; v >>>= shift; r |= shift;\n    return r | (v >> 1);\n}\n\n/**\n * @en Computes log base 10 of v.\n * @zh 计算以 10 为底的 v 的对数。\n */\nexport function log10 (v: number) {\n    return (v >= 1000000000) ? 9 : (v >= 100000000) ? 8 : (v >= 10000000) ? 7\n        : (v >= 1000000) ? 6 : (v >= 100000) ? 5 : (v >= 10000) ? 4\n            : (v >= 1000) ? 3 : (v >= 100) ? 2 : (v >= 10) ? 1 : 0;\n}\n\n/**\n * @en Counts number of bits.\n * @zh 计算传入数字二进制表示中 1 的数量。\n */\nexport function popCount (v: number) {\n    v -= ((v >>> 1) & 0x55555555);\n    v = (v & 0x33333333) + ((v >>> 2) & 0x33333333);\n    return ((v + (v >>> 4) & 0xF0F0F0F) * 0x1010101) >>> 24;\n}\n\n/**\n * @en Counts number of trailing zeros.\n * @zh 计算传入数字二进制表示尾随零的数量。\n */\nexport function countTrailingZeros (v: number) {\n    let c = 32;\n    v &= -v;\n    if (v) { c--; }\n    if (v & 0x0000FFFF) { c -= 16; }\n    if (v & 0x00FF00FF) { c -= 8; }\n    if (v & 0x0F0F0F0F) { c -= 4; }\n    if (v & 0x33333333) { c -= 2; }\n    if (v & 0x55555555) { c -= 1; }\n    return c;\n}\n\n/**\n * @en Rounds to next power of 2.\n * @zh 计算大于等于v的最小的二的整数次幂的数字。\n */\nexport function nextPow2 (v: number) {\n    --v;\n    v |= v >>> 1;\n    v |= v >>> 2;\n    v |= v >>> 4;\n    v |= v >>> 8;\n    v |= v >>> 16;\n    return v + 1;\n}\n\n/**\n * @en Rounds down to previous power of 2.\n * @zh 计算小于等于v的最小的二的整数次幂的数字。\n */\nexport function prevPow2 (v: number) {\n    v |= v >>> 1;\n    v |= v >>> 2;\n    v |= v >>> 4;\n    v |= v >>> 8;\n    v |= v >>> 16;\n    return v - (v >>> 1);\n}\n\n/**\n * @en Computes parity of word.\n * @zh 奇偶校验。\n */\nexport function parity (v: number) {\n    v ^= v >>> 16;\n    v ^= v >>> 8;\n    v ^= v >>> 4;\n    v &= 0xf;\n    return (0x6996 >>> v) & 1;\n}\n\nconst REVERSE_TABLE: number[] = new Array(256);\n\n((tab: number[]) => {\n    for (let i = 0; i < 256; ++i) {\n        let v = i;\n        let r = i;\n        let s = 7;\n        for (v >>>= 1; v; v >>>= 1) {\n            r <<= 1;\n            r |= v & 1;\n            --s;\n        }\n        tab[i] = (r << s) & 0xff;\n    }\n})(REVERSE_TABLE);\n\n/**\n * @en Reverse bits in a 32 bit word.\n * @zh 翻转 32 位二进制数字。\n */\nexport function reverse (v: number) {\n    return (REVERSE_TABLE[v & 0xff] << 24)\n        | (REVERSE_TABLE[(v >>> 8) & 0xff] << 16)\n        | (REVERSE_TABLE[(v >>> 16) & 0xff] << 8)\n        | REVERSE_TABLE[(v >>> 24) & 0xff];\n}\n\n/**\n * @en Interleave bits of 2 coordinates with 16 bits. Useful for fast quadtree codes.\n * @zh 将两个 16 位数字按位交错编码。有利于在快速四叉树中使用。\n */\nexport function interleave2 (x: number, y: number) {\n    x &= 0xFFFF;\n    x = (x | (x << 8)) & 0x00FF00FF;\n    x = (x | (x << 4)) & 0x0F0F0F0F;\n    x = (x | (x << 2)) & 0x33333333;\n    x = (x | (x << 1)) & 0x55555555;\n\n    y &= 0xFFFF;\n    y = (y | (y << 8)) & 0x00FF00FF;\n    y = (y | (y << 4)) & 0x0F0F0F0F;\n    y = (y | (y << 2)) & 0x33333333;\n    y = (y | (y << 1)) & 0x55555555;\n\n    return x | (y << 1);\n}\n\n/**\n * @en Extracts the nth interleaved component.\n * @zh 提取第 n 个交错分量。\n */\nexport function deinterleave2 (v: number, n: number) {\n    v = (v >>> n) & 0x55555555;\n    v = (v | (v >>> 1)) & 0x33333333;\n    v = (v | (v >>> 2)) & 0x0F0F0F0F;\n    v = (v | (v >>> 4)) & 0x00FF00FF;\n    v = (v | (v >>> 16)) & 0x000FFFF;\n    return (v << 16) >> 16;\n}\n\n/**\n * @en Interleave bits of 3 coordinates, each with 10 bits.  Useful for fast octree codes.\n * @zh 将三个数字按位交错编码，每个数字占十位。有利于在八叉树中使用。\n */\nexport function interleave3 (x: number, y: number, z: number) {\n    x &= 0x3FF;\n    x = (x | (x << 16)) & 4278190335;\n    x = (x | (x << 8)) & 251719695;\n    x = (x | (x << 4)) & 3272356035;\n    x = (x | (x << 2)) & 1227133513;\n\n    y &= 0x3FF;\n    y = (y | (y << 16)) & 4278190335;\n    y = (y | (y << 8)) & 251719695;\n    y = (y | (y << 4)) & 3272356035;\n    y = (y | (y << 2)) & 1227133513;\n    x |= (y << 1);\n\n    z &= 0x3FF;\n    z = (z | (z << 16)) & 4278190335;\n    z = (z | (z << 8)) & 251719695;\n    z = (z | (z << 4)) & 3272356035;\n    z = (z | (z << 2)) & 1227133513;\n\n    return x | (z << 2);\n}\n\n/**\n * @en Extracts nth interleaved component of a 3-tuple.\n * @zh 提取三个数字中的第n个交错分量。\n */\nexport function deinterleave3 (v: number, n: number) {\n    v = (v >>> n) & 1227133513;\n    v = (v | (v >>> 2)) & 3272356035;\n    v = (v | (v >>> 4)) & 251719695;\n    v = (v | (v >>> 8)) & 4278190335;\n    v = (v | (v >>> 16)) & 0x3FF;\n    return (v << 22) >> 22;\n}\n\n/**\n * @en Compute the lexicographically next bit permutation\n * @zh 计算下一组字典序的比特排列\n */\nexport function nextCombination (v: number) {\n    const t = v | (v - 1);\n    return (t + 1) | (((~t & -~t) - 1) >>> (countTrailingZeros(v) + 1));\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV } from 'internal:constants';\n\nconst _global = typeof window === 'undefined' ? global : window;\n\n/**\n * @en\n * The main namespace of Cocos2d-JS, all engine core classes, functions, properties and constants are defined in this namespace.\n * @zh\n * Cocos 引擎的主要命名空间，引擎代码中所有的类，函数，属性和常量都在这个命名空间中定义。\n * @deprecated\n */\nexport const legacyCC: Record<string, any> & {\n    _global: typeof globalThis;\n} = {\n    _global,\n};\n\n// For internal usage\nlegacyCC.internal = {};\n\nif (DEV) {\n    legacyCC._Test = {};\n}\n\nconst engineVersion = '3.6.2';\n\n/**\n * The current version of Cocos2d being used.<br/>\n * Please DO NOT remove this String, it is an important flag for bug tracking.<br/>\n * If you post a bug to forum, please attach this flag.\n */\n_global.CocosEngine = legacyCC.ENGINE_VERSION = engineVersion;\n\n_global.cc = legacyCC;\n\nexport { engineVersion as VERSION };\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/* eslint-disable no-console */\nimport { EDITOR, JSB, DEV, DEBUG } from 'internal:constants';\nimport debugInfos from '../../../DebugInfos';\nimport { legacyCC } from '../global-exports';\n\nconst ERROR_MAP_URL = 'https://github.com/cocos-creator/engine/blob/develop/EngineErrorMap.md';\n\n// The html element displays log in web page (DebugMode.INFO_FOR_WEB_PAGE)\nlet logList: HTMLTextAreaElement | null = null;\n\nlet ccLog = console.log.bind(console);\n\nlet ccWarn = ccLog;\n\nlet ccError = ccLog;\n\nlet ccAssert = (condition: any, message?: any, ...optionalParams: any[]) => {\n    if (!condition) {\n        console.log(`ASSERT: ${formatString(message, ...optionalParams)}`);\n    }\n};\n\nlet ccDebug = ccLog;\n\nfunction formatString (message?: any, ...optionalParams: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return legacyCC.js.formatStr.apply(null, [message].concat(optionalParams));\n}\n\n/**\n * @en Outputs a message to the Cocos Creator Console (editor) or Web Console (runtime).\n * @zh 输出一条消息到 Cocos Creator 编辑器的 Console 或运行时 Web 端的 Console 中。\n * @param message - A JavaScript string containing zero or more substitution strings.\n * @param optionalParams - JavaScript objects with which to replace substitution strings within msg.\n * This gives you additional control over the format of the output.\n */\nexport function log (message?: any, ...optionalParams: any[]) {\n    return ccLog(message, ...optionalParams);\n}\n\n/**\n * @en\n * Outputs a warning message to the Cocos Creator Console (editor) or Web Console (runtime).\n * - In Cocos Creator, warning is yellow.\n * - In Chrome, warning have a yellow warning icon with the message text.\n * @zh\n * 输出警告消息到 Cocos Creator 编辑器的 Console 或运行时 Web 端的 Console 中。<br/>\n * - 在 Cocos Creator 中，警告信息显示是黄色的。<br/>\n * - 在 Chrome 中，警告信息有着黄色的图标以及黄色的消息文本。<br/>\n * @param message - A JavaScript string containing zero or more substitution strings.\n * @param optionalParams - JavaScript objects with which to replace substitution strings within msg.\n * This gives you additional control over the format of the output.\n */\nexport function warn (message?: any, ...optionalParams: any[]) {\n    return ccWarn(message, ...optionalParams);\n}\n\n/**\n * @en\n * Outputs an error message to the Cocos Creator Console (editor) or Web Console (runtime).<br/>\n * - In Cocos Creator, error is red.<br/>\n * - In Chrome, error have a red icon along with red message text.<br/>\n * @zh\n * 输出错误消息到 Cocos Creator 编辑器的 Console 或运行时页面端的 Console 中。<br/>\n * - 在 Cocos Creator 中，错误信息显示是红色的。<br/>\n * - 在 Chrome 中，错误信息有红色的图标以及红色的消息文本。<br/>\n * @param message - A JavaScript string containing zero or more substitution strings.\n * @param optionalParams - JavaScript objects with which to replace substitution strings within msg.\n * This gives you additional control over the format of the output.\n */\nexport function error (message?: any, ...optionalParams: any[]) {\n    return ccError(message, ...optionalParams);\n}\n\n/**\n * @en\n * Assert the condition and output error messages if the condition is not true.\n * @zh\n * 对检查测试条件进行检查，如果条件不为 true 则输出错误消息\n * @param value - The condition to check on\n * @param message - A JavaScript string containing zero or more substitution strings.\n * @param optionalParams - JavaScript objects with which to replace substitution strings within msg.\n * This gives you additional control over the format of the output.\n */\nexport function assert (value: any, message?: string, ...optionalParams: any[]): asserts value {\n    return ccAssert(value, message, ...optionalParams);\n}\n\n/**\n * @en Outputs a message at the \"debug\" log level.\n * @zh 输出一条“调试”日志等级的消息。\n */\nexport function debug (...data: any[]) {\n    return ccDebug(...data);\n}\n\nexport function _resetDebugSetting (mode: DebugMode) {\n    // reset\n    ccLog = ccWarn = ccError = ccAssert = ccDebug = () => {\n    };\n\n    if (mode === DebugMode.NONE) {\n        return;\n    }\n\n    if (mode > DebugMode.ERROR) {\n        // Log to web page.\n        const logToWebPage = (msg: string) => {\n            if (!legacyCC.game.canvas) {\n                return;\n            }\n\n            if (!logList) {\n                const logDiv = document.createElement('Div');\n                logDiv.setAttribute('id', 'logInfoDiv');\n                logDiv.setAttribute('width', '200');\n                logDiv.setAttribute('height', legacyCC.game.canvas.height);\n                const logDivStyle = logDiv.style;\n                logDivStyle.zIndex = '99999';\n                logDivStyle.position = 'absolute';\n                logDivStyle.top = logDivStyle.left = '0';\n\n                logList = document.createElement('textarea');\n                logList.setAttribute('rows', '20');\n                logList.setAttribute('cols', '30');\n                logList.setAttribute('disabled', 'true');\n                const logListStyle = logList.style;\n                logListStyle.backgroundColor = 'transparent';\n                logListStyle.borderBottom = '1px solid #cccccc';\n                logListStyle.borderTopWidth = logListStyle.borderLeftWidth = logListStyle.borderRightWidth = '0px';\n                logListStyle.borderTopStyle = logListStyle.borderLeftStyle = logListStyle.borderRightStyle = 'none';\n                logListStyle.padding = '0px';\n                logListStyle.margin = '0px';\n\n                logDiv.appendChild(logList);\n                legacyCC.game.canvas.parentNode.appendChild(logDiv);\n            }\n\n            logList.value = `${logList.value + msg}\\r\\n`;\n            logList.scrollTop = logList.scrollHeight;\n        };\n\n        ccError = (message?: any, ...optionalParams: any[]) => {\n            logToWebPage(`ERROR :  ${formatString(message, ...optionalParams)}`);\n        };\n        ccAssert = (condition: any, message?: any, ...optionalParams: any[]) => {\n            if (!condition) {\n                logToWebPage(`ASSERT: ${formatString(message, ...optionalParams)}`);\n            }\n        };\n        if (mode !== DebugMode.ERROR_FOR_WEB_PAGE) {\n            ccWarn = (message?: any, ...optionalParams: any[]) => {\n                logToWebPage(`WARN :  ${formatString(message, ...optionalParams)}`);\n            };\n        }\n        if (mode === DebugMode.INFO_FOR_WEB_PAGE) {\n            ccLog = (message?: any, ...optionalParams: any[]) => {\n                logToWebPage(formatString(message, ...optionalParams));\n            };\n        }\n    } else if (console) {\n        // Log to console.\n\n        // For JSB\n        if (!console.error) {\n            console.error = console.log;\n        }\n        if (!console.warn) {\n            console.warn = console.log;\n        }\n\n        if (EDITOR || console.error.bind) {\n            // use bind to avoid pollute call stacks\n            ccError = console.error.bind(console);\n        } else {\n            ccError = JSB ? console.error : (message?: any, ...optionalParams: any[]) => console.error.apply(console, [message, ...optionalParams]);\n        }\n        ccAssert = (condition: any, message?: any, ...optionalParams: any[]) => {\n            if (!condition) {\n                const errorText = formatString(message, ...optionalParams);\n                if (DEV) {\n                    // eslint-disable-next-line no-debugger\n                    debugger;\n                } else {\n                    throw new Error(errorText);\n                }\n            }\n        };\n    }\n\n    if (mode !== DebugMode.ERROR) {\n        if (EDITOR) {\n            ccWarn = console.warn.bind(console);\n        } else if (console.warn.bind) {\n            // use bind to avoid pollute call stacks\n            ccWarn = console.warn.bind(console);\n        } else {\n            ccWarn = JSB ? console.warn : (message?: any, ...optionalParams: any[]) => console.warn.apply(console, [message, ...optionalParams]);\n        }\n    }\n\n    if (EDITOR) {\n        ccLog = console.log.bind(console);\n    } else if (mode <= DebugMode.INFO) {\n        if (JSB) {\n            // @ts-expect-error We have no typing for this\n            if (scriptEngineType === 'JavaScriptCore') {\n                // console.log has to use `console` as its context for iOS 8~9. Therefore, apply it.\n                ccLog = (message?: any, ...optionalParams: any[]) => console.log.apply(console, [message, ...optionalParams]);\n            } else {\n                ccLog = console.log;\n            }\n        } else if (console.log.bind) {\n            // use bind to avoid pollute call stacks\n            ccLog = console.log.bind(console);\n        } else {\n            ccLog = (message?: any, ...optionalParams: any[]) => console.log.apply(console, [message, ...optionalParams]);\n        }\n    }\n\n    if (mode <= DebugMode.VERBOSE) {\n        if (typeof console.debug === 'function') {\n            const vendorDebug = console.debug.bind(console);\n            ccDebug = (...data: any[]) => vendorDebug(...data);\n        }\n    }\n}\n\nexport function _throw (error_: any) {\n    if (EDITOR) {\n        return error(error_);\n    } else {\n        const stack = error_.stack;\n        if (stack) {\n            error(JSB ? (`${error_}\\n${stack}`) : stack);\n        } else {\n            error(error_);\n        }\n        return undefined;\n    }\n}\n\nfunction getTypedFormatter (type: 'Log' | 'Warning' | 'Error' | 'Assert') {\n    return (id: number, ...args: any[]) => {\n        const msg = DEBUG ? (debugInfos[id] || 'unknown id') : `${type} ${id}, please go to ${ERROR_MAP_URL}#${id} to see details.`;\n        if (args.length === 0) {\n            return msg;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return DEBUG ? formatString(msg, ...args) : `${msg} Arguments: ${args.join(', ')}`;\n    };\n}\n\nconst logFormatter = getTypedFormatter('Log');\nexport function logID (id: number, ...optionalParams: any[]) {\n    log(logFormatter(id, ...optionalParams));\n}\n\nconst warnFormatter = getTypedFormatter('Warning');\nexport function warnID (id: number, ...optionalParams: any[]) {\n    warn(warnFormatter(id, ...optionalParams));\n}\n\nconst errorFormatter = getTypedFormatter('Error');\nexport function errorID (id: number, ...optionalParams: any[]) {\n    error(errorFormatter(id, ...optionalParams));\n}\n\nconst assertFormatter = getTypedFormatter('Assert');\nexport function assertID (condition: any, id: number, ...optionalParams: any[]) {\n    if (condition) {\n        return;\n    }\n    assert(false, assertFormatter(id, ...optionalParams));\n}\n\n/**\n * @en Enum for debug modes.\n * @zh 调试模式。\n */\nexport enum DebugMode {\n    /**\n     * @en The debug mode none.\n     * @zh 禁止模式，禁止显示任何日志消息。\n     */\n    NONE = 0,\n\n    /**\n     * @en The debug mode none.\n     * @zh 调试模式，显示所有日志消息。\n     */\n    VERBOSE = 1,\n\n    /**\n     * @en Information mode, which display messages with level higher than \"information\" level.\n     * @zh 信息模式，显示“信息”级别以上的日志消息。\n     */\n    INFO = 2,\n\n    /**\n     * @en Information mode, which display messages with level higher than \"warning\" level.\n     * @zh 警告模式，显示“警告”级别以上的日志消息。\n     */\n    WARN = 3,\n\n    /**\n     * @en Information mode, which display only messages with \"error\" level.\n     * @zh 错误模式，仅显示“错误”级别的日志消息。\n     */\n    ERROR = 4,\n\n    /**\n     * @en The debug mode info for web page.\n     * @zh 信息模式（仅 WEB 端有效），在画面上输出所有信息。\n     */\n    INFO_FOR_WEB_PAGE = 5,\n\n    /**\n     * @en The debug mode warn for web page.\n     * @zh 警告模式（仅 WEB 端有效），在画面上输出 warn 级别以上的（包含 error）信息。\n     */\n    WARN_FOR_WEB_PAGE = 6,\n\n    /**\n     * @en The debug mode error for web page.\n     * @zh 错误模式（仅 WEB 端有效），在画面上输出 error 信息。\n     */\n    ERROR_FOR_WEB_PAGE = 7,\n}\n\n/**\n * @en Gets error message with the error id and possible parameters.\n * @zh 通过 error id 和必要的参数来获取错误信息。\n */\nexport function getError (errorId: number, ...param: any[]): string {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return errorFormatter(errorId, ...param);\n}\n\n/**\n * @en Returns whether or not to display the FPS and debug information.\n * @zh 是否显示 FPS 信息和部分调试信息。\n * @deprecated Since v3.6, Please use profiler.isShowingStates instead\n */\nexport function isDisplayStats (): boolean {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return legacyCC.profiler ? legacyCC.profiler.isShowingStats() : false;\n}\n\n/**\n * @en Sets whether display the FPS and debug informations on the bottom-left corner.\n * @zh 设置是否在左下角显示 FPS 和部分调试。\n * @deprecated Since v3.6, Please use profiler.showStats instead\n */\nexport function setDisplayStats (displayStats: boolean) {\n    if (legacyCC.profiler) {\n        displayStats ? legacyCC.profiler.showStats() : legacyCC.profiler.hideStats();\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/**\n * @example\n * ```\n * import { js } from 'cc';\n * var array = [0, 1, 2, 3, 4];\n * var iterator = new js.array.MutableForwardIterator(array);\n * for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n *     var item = array[iterator.i];\n *     ...\n * }\n * ```\n */\nexport default class MutableForwardIterator<T> {\n    public i = 0;\n\n    constructor (public array: T[]) {\n    }\n\n    get length () {\n        return this.array.length;\n    }\n\n    set length (value: number) {\n        this.array.length = value;\n        if (this.i >= value) {\n            this.i = value - 1;\n        }\n    }\n\n    public remove (value: T) {\n        const index = this.array.indexOf(value);\n        if (index >= 0) {\n            this.removeAt(index);\n        }\n    }\n\n    public removeAt (i: number) {\n        this.array.splice(i, 1);\n\n        if (i <= this.i) {\n            --this.i;\n        }\n    }\n\n    public fastRemove (value: T) {\n        const index = this.array.indexOf(value);\n        if (index >= 0) {\n            this.fastRemoveAt(index);\n        }\n    }\n\n    public fastRemoveAt (i: number) {\n        const array = this.array;\n        array[i] = array[array.length - 1];\n        --array.length;\n\n        if (i <= this.i) {\n            --this.i;\n        }\n    }\n\n    public push (item: T) {\n        this.array.push(item);\n    }\n}\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { logID } from '../platform/debug';\n\nexport { default as MutableForwardIterator } from './mutable-forward-iterator';\n\n/**\n * @zh\n * 移除指定索引的数组元素。\n * @en\n * Removes the array item at the specified index.\n * @param array 数组。\n * @param index 待移除元素的索引。\n */\nexport function removeAt<T> (array: T[], index: number) {\n    array.splice(index, 1);\n}\n\n/**\n * @zh\n * 移除指定索引的数组元素。\n * 此函数十分高效，但会改变数组的元素次序。\n * @en\n * Removes the array item at the specified index.\n * It's faster but the order of the array will be changed.\n * @param array 数组。\n * @param index 待移除元素的索引。\n */\nexport function fastRemoveAt<T> (array: T[], index: number) {\n    const length = array.length;\n    if (index < 0 || index >= length) {\n        return;\n    }\n    array[index] = array[length - 1];\n    array.length = length - 1;\n}\n\n/**\n * @zh\n * 移除首个指定的数组元素。判定元素相等时相当于于使用了 `Array.prototype.indexOf`。\n * @en\n * Removes the first occurrence of a specific object from the array.\n * Decision of the equality of elements is similar to `Array.prototype.indexOf`.\n * @param array 数组。\n * @param value 待移除元素。\n */\nexport function remove<T> (array: T[], value: T) {\n    const index = array.indexOf(value);\n    if (index >= 0) {\n        removeAt(array, index);\n        return true;\n    } else {\n        return false;\n    }\n}\n\n/**\n * @zh\n * 移除首个指定的数组元素。判定元素相等时相当于于使用了 `Array.prototype.indexOf`。\n * 此函数十分高效，但会改变数组的元素次序。\n * @en\n * Removes the first occurrence of a specific object from the array.\n * Decision of the equality of elements is similar to `Array.prototype.indexOf`.\n * It's faster but the order of the array will be changed.\n * @param array 数组。\n * @param value 待移除元素。\n */\nexport function fastRemove<T> (array: T[], value: T) {\n    const index = array.indexOf(value);\n    if (index >= 0) {\n        array[index] = array[array.length - 1];\n        --array.length;\n    }\n}\n\n/**\n * @zh\n * 移除首个使谓词满足的数组元素。\n * @en\n * Removes the first occurrence of a specific object from the array where `predicate` is `true`.\n * @param array 数组。\n * @param predicate 谓词。\n */\nexport function removeIf<T> (array: T[], predicate: (value: T) => boolean) {\n    const index = array.findIndex(predicate);\n    if (index >= 0) {\n        const value = array[index];\n        removeAt(array, index);\n        return value;\n    }\n}\n\n/**\n * @zh\n * 验证数组的类型。\n * 此函数将用 `instanceof` 操作符验证每一个元素。\n * @en\n * Verify array's Type.\n * This function tests each element using `instanceof` operator.\n * @param array 数组。\n * @param type 类型。\n * @returns 当每一个元素都是指定类型时返回 `true`，否则返回 `false`。\n */\nexport function verifyType<T extends Function> (array: any[], type: T): array is T[] {\n    if (array && array.length > 0) {\n        for (const item of array) {\n            if (!(item instanceof type)) {\n                logID(1300);\n                return false;\n            }\n        }\n    }\n    return true;\n}\n\n/**\n * @zh\n * 移除多个数组元素。\n * @en\n * Removes multiple array elements.\n * @param array 源数组。\n * @param removals 所有待移除的元素。此数组的每个元素所对应的首个源数组的元素都会被移除。\n */\nexport function removeArray<T> (array: T[], removals: T[]) {\n    for (let i = 0, l = removals.length; i < l; i++) {\n        remove(array, removals[i]);\n    }\n}\n\n/**\n * @zh\n * 在数组的指定索引上插入对象。\n * @en\n * Inserts some objects at specified index.\n * @param array 数组。\n * @param objects 插入的所有对象。\n * @param index 插入的索引。\n * @returns `array`。\n */\nexport function appendObjectsAt<T> (array: T[], objects: T[], index: number) {\n    array.splice.apply(array, [index, 0, ...objects]);\n    return array;\n}\n\n/**\n * @zh\n * 返回数组是否包含指定的元素。\n * @en\n * Determines whether the array contains a specific element.\n * @returns 返回数组是否包含指定的元素。\n */\nexport function contains<T> (array: T[], value: T) {\n    return array.indexOf(value) >= 0;\n}\n\n/**\n * @zh\n * 拷贝数组。\n * @en\n * Copy an array.\n * @param 源数组。\n * @returns 数组的副本。\n */\nexport function copy<T> (array: T[]) {\n    const len = array.length;\n    const cloned = new Array<T>(len);\n    for (let i = 0; i < len; i += 1) {\n        cloned[i] = array[i];\n    }\n    return cloned;\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR } from 'internal:constants';\n\nconst NonUuidMark = '.';\n\n/**\n * @en\n * ID generator for runtime.\n *\n * @zh\n * 运行时 ID 生成器\n */\nexport default class IDGenerator {\n    /**\n    * @en\n    * The global id generator might have a conflict problem once every 365 days,\n    * if the game runs at 60 FPS and each frame 4760273 counts of new id are requested.\n    *\n    * @zh\n    * 全局的 id 生成器，如果游戏以 60 FPS 运行，每帧获取 4760273 个新 id, 则可能在 365 天后发生冲突。\n    */\n    public static global = new IDGenerator('global');\n\n    public id: number;\n\n    public prefix: string;\n\n    /**\n     * @en Construct a new id generator\n     * @zh 构造一个新的 id 生成器\n     *\n     * @param [category] @en You can specify a unique category to avoid id collision with other instance of IdGenerator. @zh 你能指定一个唯一的标识用于避免与其他 id 生成器冲突\n     */\n    constructor (category?: string) {\n        // Tnit with a random id to emphasize that the returns id should not be stored in persistence data.\n        this.id = 0 | (Math.random() * 998);\n        this.prefix = category ? (category + NonUuidMark) : '';\n    }\n\n    public getNewId () {\n        if (EDITOR && (this.prefix === 'Node.' || this.prefix === 'Comp.')) {\n            return EditorExtends.UuidUtils.uuid();\n        }\n        return this.prefix + (++this.id);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, DEV, TEST } from 'internal:constants';\nimport { warnID, error, errorID } from '../platform/debug';\nimport IDGenerator from './id-generator';\n\nconst tempCIDGenerator = new IDGenerator('TmpCId.');\n\nconst aliasesTag = typeof Symbol === 'undefined' ? '__aliases__' : Symbol('[[Aliases]]');\nconst classNameTag = '__classname__';\nconst classIdTag = '__cid__';\n\n/**\n * @en\n * Check the object whether is number or not\n * If a number is created by using 'new Number(10086)', the typeof it will be \"object\"...\n * Then you can use this function if you care about this case.\n * @zh\n * 检查对象是否是 number 类型，如果通过 'new Number(10086)' 创建了一个数字，则使用 typeof 判断此数字时，将返回 'object' 类型，此时你可以通过此方法来进行判断\n * @param object object to be checked\n * @return whether this object is number or not\n */\nexport function isNumber (object: any) {\n    return typeof object === 'number' || object instanceof Number;\n}\n\n/**\n * @en\n * Check the object whether is string or not.\n * If a string is created by using 'new String(\"blabla\")', the typeof it will be \"object\"...\n * Then you can use this function if you care about this case.\n * @zh\n * 检查对象是否是 string 类型，如果通过 'new String(\"blabla\")' 创建了一个字符串，则使用 typeof 判断此字符串时，将返回 'object' 类型，此时你可以通过此方法来进行判断\n * @param object object to be checked\n * @return whether this object is string or not\n */\nexport function isString (object: any) {\n    return typeof object === 'string' || object instanceof String;\n}\n\n/**\n * @en\n * Checks if the object `obj` does not have one or more enumerable properties (including properties from proto chain).\n * @zh\n * 检查此对象是否为空对象\n * @param obj The object.\n * @returns The result. Note that if the `obj` is not of type `'object'`, `true` is returned.\n */\nexport function isEmptyObject (obj: any) {\n    for (const key in obj) {\n        return false;\n    }\n    return true;\n}\n\n/**\n * @en\n * Define value, just help to call Object.defineProperty.<br>\n * The configurable will be true.\n * @zh\n * 定义值，帮助调用 Object.defineProperty.\n * 该属性默认可读写\n * @param [writable=false]\n * @param [enumerable=false]\n */\nexport const value = (() => {\n    const descriptor: PropertyDescriptor = {\n        value: undefined,\n        enumerable: false,\n        writable: false,\n        configurable: true,\n    };\n    return (object: Record<string | number, any>, propertyName: string, value_: any, writable?: boolean, enumerable?: boolean) => {\n        descriptor.value = value_;\n        descriptor.writable = writable;\n        descriptor.enumerable = enumerable;\n        Object.defineProperty(object, propertyName, descriptor);\n        descriptor.value = undefined;\n    };\n})();\n\n/**\n * @en\n * Define get set accessor, just help to call Object.defineProperty(...).\n * @zh\n * 定义 get set 访问器，帮助调用 Object.defineProperty()\n * @param [setter=null]\n * @param [enumerable=false]\n * @param [configurable=false]\n */\nexport const getset = (() => {\n    const descriptor: PropertyDescriptor = {\n        get: undefined,\n        set: undefined,\n        enumerable: false,\n    };\n    return (object: Record<string | number, any>, propertyName: string, getter: Getter, setter?: Setter | boolean, enumerable = false, configurable = false) => {\n        if (typeof setter === 'boolean') {\n            enumerable = setter;\n            setter = undefined;\n        }\n        descriptor.get = getter;\n        descriptor.set = setter;\n        descriptor.enumerable = enumerable;\n        descriptor.configurable = configurable;\n        Object.defineProperty(object, propertyName, descriptor);\n        descriptor.get = undefined;\n        descriptor.set = undefined;\n    };\n})();\n\n/**\n * @en\n * Define get accessor, just help to call Object.defineProperty(...).\n * @zh\n * 定义 get 访问器，帮助调用 Object.defineProperty()\n * @param [enumerable=false]\n * @param [configurable=false]\n */\nexport const get = (() => {\n    const descriptor: PropertyDescriptor = {\n        get: undefined,\n        enumerable: false,\n        configurable: false,\n    };\n    return (object: Record<string | number, any>, propertyName: string, getter: Getter, enumerable?: boolean, configurable?: boolean) => {\n        descriptor.get = getter;\n        descriptor.enumerable = enumerable;\n        descriptor.configurable = configurable;\n        Object.defineProperty(object, propertyName, descriptor);\n        descriptor.get = undefined;\n    };\n})();\n\n/**\n * @en\n * Define set accessor, just help to call Object.defineProperty(...)\n * @zh\n * 定义 set 访问器，帮助调用 Object.defineProperty\n * @param [enumerable=false]\n * @param [configurable=false]\n */\nexport const set = (() => {\n    const descriptor: PropertyDescriptor = {\n        set: undefined,\n        enumerable: false,\n        configurable: false,\n    };\n    return (object: Record<string | number, any>, propertyName: string, setter: Setter, enumerable?: boolean, configurable?: boolean) => {\n        descriptor.set = setter;\n        descriptor.enumerable = enumerable;\n        descriptor.configurable = configurable;\n        Object.defineProperty(object, propertyName, descriptor);\n        descriptor.set = undefined;\n    };\n})();\n\n/**\n * @en\n * A simple wrapper of `Object.create(null)` which ensures the return object have no prototype (and thus no inherited members).\n * This eliminates the need to make `hasOwnProperty` judgments when we look for values by key on the object,\n * which is helpful for performance in this case.\n * @zh\n * 该方法是对 `Object.create(null)` 的简单封装。\n * `Object.create(null)` 用于创建无 prototype （也就无继承）的空对象。\n * 这样我们在该对象上查找属性时，就不用进行 `hasOwnProperty` 判断，此时对性能提升有帮助。\n *\n * @param [forceDictMode=false] Apply the delete operator to newly created map object.\n * This causes V8 to put the object in \"dictionary mode\" and disables creation of hidden classes\n * which are very expensive for objects that are constantly changing shape.\n */\nexport function createMap (forceDictMode?: boolean): any {\n    const map = Object.create(null);\n    if (forceDictMode) {\n        const INVALID_IDENTIFIER_1 = '.';\n        const INVALID_IDENTIFIER_2 = '/';\n        // assign dummy values on the object\n        map[INVALID_IDENTIFIER_1] = 1;\n        map[INVALID_IDENTIFIER_2] = 1;\n        delete map[INVALID_IDENTIFIER_1];\n        delete map[INVALID_IDENTIFIER_2];\n    }\n    return map;\n}\n\n/**\n * @en\n * Get class name of the object, if object is just a {} (and which class named 'Object'), it will return \"\".\n * (modified from <a href=\"http://stackoverflow.com/questions/1249531/how-to-get-a-javascript-objects-class\">the code from this stackoverflow post</a>)\n * @zh\n * 获取对象的类型名称，如果对象是 {} 字面量，将会返回 \"\"\n * @param objOrCtor instance or constructor\n */\nexport function getClassName (objOrCtor: any): string {\n    if (typeof objOrCtor === 'function') {\n        const prototype = objOrCtor.prototype;\n        // eslint-disable-next-line no-prototype-builtins\n        if (prototype && prototype.hasOwnProperty(classNameTag) && prototype[classNameTag]) {\n            return prototype[classNameTag] as string;\n        }\n        let retval = '';\n        //  for browsers which have name property in the constructor of the object, such as chrome\n        if (objOrCtor.name) {\n            retval = objOrCtor.name;\n        }\n        if (objOrCtor.toString) {\n            let arr;\n            const str = objOrCtor.toString();\n            if (str.charAt(0) === '[') {\n                // str is \"[object objectClass]\"\n                // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\n                arr = /\\[\\w+\\s*(\\w+)\\]/.exec(str);\n            } else {\n                // str is function objectClass () {} for IE Firefox\n                // eslint-disable-next-line @typescript-eslint/prefer-regexp-exec\n                arr = /function\\s*(\\w+)/.exec(str);\n            }\n            if (arr && arr.length === 2) {\n                retval = arr[1];\n            }\n        }\n        return retval !== 'Object' ? retval : '';\n    } else if (objOrCtor && objOrCtor.constructor) {\n        return getClassName(objOrCtor.constructor);\n    }\n    return '';\n}\n\n/**\n * @en\n * Defines a polyfill field for obsoleted codes.\n * @zh\n * 为废弃代码定义一个填充字段\n * @param object - YourObject or YourClass.prototype\n * @param obsoleted - \"OldParam\" or \"YourClass.OldParam\"\n * @param newExpr - \"NewParam\" or \"YourClass.NewParam\"\n * @param  [writable=false]\n */\nexport function obsolete (object: any, obsoleted: string, newExpr: string, writable?: boolean) {\n    const extractPropName = /([^.]+)$/;\n    const oldProp = extractPropName.exec(obsoleted)![0];\n    const newProp = extractPropName.exec(newExpr)![0];\n    function getter (this: any) {\n        if (DEV) {\n            warnID(5400, obsoleted, newExpr);\n        }\n        return this[newProp] as unknown;\n    }\n    function setter (this: any, value_: any) {\n        if (DEV) {\n            warnID(5401, obsoleted, newExpr);\n        }\n        this[newProp] = value_;\n    }\n\n    if (writable) {\n        getset(object, oldProp, getter, setter);\n    } else {\n        get(object, oldProp, getter);\n    }\n}\n\n/**\n * @en\n * Defines all polyfill fields for obsoleted codes corresponding to the enumerable properties of props.\n * @zh\n * 为所有可废弃属性定义填充字段\n * @param obj - YourObject or YourClass.prototype\n * @param objName - \"YourObject\" or \"YourClass\"\n * @param props\n * @param [writable=false]\n */\nexport function obsoletes (obj, objName, props, writable) {\n    for (const obsoleted in props) {\n        const newName = props[obsoleted];\n        obsolete(obj, `${objName}.${obsoleted}`, newName, writable);\n    }\n}\n\nconst REGEXP_NUM_OR_STR = /(%d)|(%s)/;\nconst REGEXP_STR = /%s/;\n\n/**\n * @en\n * A string tool to construct a string with format string.\n * @zh\n * 通过格式字符串构造一个字符串\n * @param msg - A JavaScript string containing zero or more substitution strings (%s).\n * @param subst - JavaScript objects with which to replace substitution strings within msg.\n * This gives you additional control over the format of the output.\n * @example\n * ```\n * import { js } from 'cc';\n * js.formatStr(\"a: %s, b: %s\", a, b);\n * js.formatStr(a, b, c);\n * ```\n */\nexport function formatStr (msg: string, ...subst: any[]) {\n    if (arguments.length === 0) {\n        return '';\n    }\n    if (subst.length === 0) {\n        return `${msg}`;\n    }\n\n    const hasSubstitution = typeof msg === 'string' && REGEXP_NUM_OR_STR.test(msg);\n    if (hasSubstitution) {\n        for (const arg of subst) {\n            const regExpToTest = typeof arg === 'number' ? REGEXP_NUM_OR_STR : REGEXP_STR;\n            if (regExpToTest.test(msg)) {\n                const notReplaceFunction = `${arg}`;\n                msg = msg.replace(regExpToTest, notReplaceFunction);\n            } else {\n                msg += ` ${arg}`;\n            }\n        }\n    } else {\n        for (const arg of subst) {\n            msg += ` ${arg}`;\n        }\n    }\n    return msg;\n}\n\n// see https://github.com/petkaantonov/bluebird/issues/1389\nexport function shiftArguments () {\n    const len = arguments.length - 1;\n    const args = new Array(len);\n    for (let i = 0; i < len; ++i) {\n        args[i] = arguments[i + 1];\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return args;\n}\n\n/**\n * Get property descriptor in object and all its ancestors.\n */\nexport function getPropertyDescriptor (object: any, propertyName: string) {\n    while (object) {\n        const pd = Object.getOwnPropertyDescriptor(object, propertyName);\n        if (pd) {\n            return pd;\n        }\n        object = Object.getPrototypeOf(object);\n    }\n    return null;\n}\n\nfunction _copyprop (name: string, source: any, target: any) {\n    const pd = getPropertyDescriptor(source, name);\n    if (pd) {\n        Object.defineProperty(target, name, pd);\n    }\n}\n\nexport function copyAllProperties (source: any, target: any, excepts: Array<string>) {\n    const propertyNames: Array<string> = Object.getOwnPropertyNames(source);\n    for (let i = 0, len = propertyNames.length; i < len; ++i) {\n        const propertyName: string = propertyNames[i];\n        if (excepts.indexOf(propertyName) !== -1) {\n            continue;\n        }\n\n        _copyprop(propertyName, source, target);\n    }\n}\n\n/**\n * @en\n * Copy all properties not defined in object from arguments[1...n].\n * @zh\n * 如果目标对象上没有该属性，则将源对象属性拷贝到目标对象上\n * @param object Object to extend its properties.\n * @param sources Source object to copy properties from.\n * @return The result object.\n */\nexport function addon (object?: Record<string | number, any>, ...sources: any[]) {\n    object = object || {};\n    for (const source of sources) {\n        if (source) {\n            if (typeof source !== 'object') {\n                errorID(5402, source);\n                continue;\n            }\n            for (const name in source) {\n                if (!(name in object)) {\n                    _copyprop(name, source, object);\n                }\n            }\n        }\n    }\n    return object;\n}\n\n/**\n * @en\n * Copy all properties from arguments[1...n] to object.\n * @zh\n * 拷贝源对象所有属性到目标对象上，如果有属性冲突，则以源对象为准\n * @return The result object.\n */\nexport function mixin (object?: Record<string | number, any>, ...sources: any[]) {\n    object = object || {};\n    for (const source of sources) {\n        if (source) {\n            if (typeof source !== 'object') {\n                errorID(5403, source);\n                continue;\n            }\n            for (const name in source) {\n                _copyprop(name, source, object);\n            }\n        }\n    }\n    return object;\n}\n\n/**\n * @en\n * Derive the class from the supplied base class.\n * Both classes are just native javascript constructors, not created by `Class`, so\n * usually you will want to inherit using [[CCClass]] instead.\n * @zh\n * 将一个类型继承另一个类型\n * 两个类型都需要是 javascript 的构建函数，而不是 `Class`, 所以你通常可以用 [[CCClass]] 来代替\n * @param base The baseclass to inherit.\n * @return The result class.\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function extend (cls: Function, base: Function) {\n    if (DEV) {\n        if (!base) {\n            errorID(5404);\n            return;\n        }\n        if (!cls) {\n            errorID(5405);\n            return;\n        }\n        if (Object.keys(cls.prototype).length > 0) {\n            errorID(5406);\n        }\n    }\n    // eslint-disable-next-line no-prototype-builtins\n    for (const p in base) { if (base.hasOwnProperty(p)) { cls[p] = base[p]; } }\n    cls.prototype = Object.create(base.prototype, {\n        constructor: {\n            value: cls,\n            writable: true,\n            configurable: true,\n        },\n    });\n    // eslint-disable-next-line consistent-return\n    return cls;\n}\n\n/**\n * @en\n * Get super class.\n * @zh\n * 获取父类\n * @param constructor The constructor of subclass.\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function getSuper (constructor: Function) {\n    const proto = constructor.prototype; // binded function do not have prototype\n    const dunderProto = proto && Object.getPrototypeOf(proto);\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return dunderProto && dunderProto.constructor;\n}\n\n/**\n * @en\n * Checks whether subclass is child of superclass or equals to superclass.\n * @zh\n * 判断一类型是否是另一类型的子类或本身\n * @param subclass sub class to be checked\n * @param superclass super class to be checked\n * @return whether subclass is child of superclass\n */\nexport function isChildClassOf (subclass: unknown, superclass: unknown) {\n    if (subclass && superclass) {\n        if (typeof subclass !== 'function') {\n            return false;\n        }\n        if (typeof superclass !== 'function') {\n            if (DEV) {\n                warnID(3625, superclass);\n            }\n            return false;\n        }\n        if (subclass === superclass) {\n            return true;\n        }\n        for (; ;) {\n            // eslint-disable-next-line @typescript-eslint/ban-types\n            subclass = getSuper(subclass as Function);\n            if (!subclass) {\n                return false;\n            }\n            if (subclass === superclass) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n/**\n * @en\n * Removes all enumerable properties from object.\n * @zh\n * 移除对象中所有可枚举属性\n */\nexport function clear (object: Record<string | number, any>) {\n    for (const key of Object.keys(object)) {\n        delete object[key];\n    }\n}\n\nfunction isTempClassId (id) {\n    return typeof id !== 'string' || id.startsWith(tempCIDGenerator.prefix);\n}\n\n// id registration\n/**\n * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n */\nexport const _idToClass: Record<string, Constructor> = createMap(true);\n/**\n * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n */\nexport const _nameToClass: Record<string, Constructor> = createMap(true);\n\nfunction setup (tag: string, table: Record<string | number, any>, allowExist: boolean) {\n    return function (id: string, constructor: Constructor) {\n        // deregister old\n        // eslint-disable-next-line no-prototype-builtins\n        if (constructor.prototype.hasOwnProperty(tag)) {\n            delete table[constructor.prototype[tag]];\n        }\n        value(constructor.prototype, tag, id);\n        // register class\n        if (id) {\n            const registered = table[id];\n            if (!allowExist && registered && registered !== constructor) {\n                let err = `A Class already exists with the same ${tag} : \"${id}\".`;\n                if (TEST) {\n                    // eslint-disable-next-line no-multi-str\n                    err += ' (This may be caused by error of unit test.) \\\nIf you dont need serialization, you can set class id to \"\". You can also call \\\njs.unregisterClass to remove the id of unused class';\n                }\n                error(err);\n            } else {\n                table[id] = constructor;\n            }\n            // if (id === \"\") {\n            //    console.trace(\"\", table === _nameToClass);\n            // }\n        }\n    };\n}\n\n/**\n * @en\n * Register the class by specified id, if its classname is not defined, the class name will also be set.\n * @zh\n * 通过 id 注册类型\n * @method _setClassId\n * @param classId\n * @param constructor\n * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n */\nexport const _setClassId = setup('__cid__', _idToClass, false);\n\nconst doSetClassName = setup('__classname__', _nameToClass, true);\n\n/**\n * @en\n * Register the class by specified name manually\n * @zh\n * 通过指定的名称手动注册类型\n * @method setClassName\n * @param className\n * @param constructor\n */\nexport function setClassName (className: string, constructor: Constructor) {\n    doSetClassName(className, constructor);\n    // auto set class id\n    // eslint-disable-next-line no-prototype-builtins\n    if (!constructor.prototype.hasOwnProperty(classIdTag)) {\n        const id = className || tempCIDGenerator.getNewId();\n        if (id) {\n            _setClassId(id, constructor);\n        }\n    }\n}\n\n/**\n * @en Set an alias name for class.\n * If `setClassAlias(target, alias)`, `alias` will be a single way short cut for class `target`.\n * If you try `js.getClassByName(alias)`, you will get target.\n * But `js.getClassName(target)` will return the original name of `target`, not the alias.\n * @zh 为类设置别名。\n * 当 `setClassAlias(target, alias)` 后，\n * `alias` 将作为类 `target`的“单向 ID” 和“单向名称”。\n * 因此，`getClassById(alias)` 和 `getClassByName(alias)` 都会得到 `target`。\n * 这种映射是单向的，意味着 `getClassName(target)` 和 `getClassId(target)` 将不会是 `alias`。\n * @param target Constructor of target class.\n * @param alias Alias to set. The name shall not have been set as class name or alias of another class.\n */\nexport function setClassAlias (target: Constructor, alias: string) {\n    const nameRegistry = _nameToClass[alias];\n    const idRegistry = _idToClass[alias];\n    let ok = true;\n    if (nameRegistry && nameRegistry !== target) {\n        error(`\"${alias}\" has already been set as name or alias of another class.`);\n        ok = false;\n    }\n    if (idRegistry && idRegistry !== target) {\n        error(`\"${alias}\" has already been set as id or alias of another class.`);\n        ok = false;\n    }\n    if (ok) {\n        let classAliases = target[aliasesTag];\n        if (!classAliases) {\n            classAliases = [];\n            target[aliasesTag] = classAliases;\n        }\n        classAliases.push(alias);\n        _nameToClass[alias] = target;\n        _idToClass[alias] = target;\n    }\n}\n\n/**\n * @en\n * Unregister a class from cocos.\n *\n * If you dont need a registered class anymore, you should unregister the class so that cocos will not keep its reference anymore.\n * Please note that its still your responsibility to free other references to the class.\n * @zh\n * 取消注册类型，如果你不再需要一个注册的类，你应该取消注册这个类，这样 cocos 就不会再保留它的引用。\n * 请注意，你仍然有责任释放对该类的其他引用。\n *\n * @param ...constructor - the class you will want to unregister, any number of classes can be added\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function unregisterClass (...constructors: Function[]) {\n    for (const constructor of constructors) {\n        const p = constructor.prototype;\n        const classId = p[classIdTag];\n        if (classId) {\n            delete _idToClass[classId];\n        }\n        const classname = p[classNameTag];\n        if (classname) {\n            delete _nameToClass[classname];\n        }\n        const aliases = p[aliasesTag];\n        if (aliases) {\n            for (let iAlias = 0; iAlias < aliases.length; ++iAlias) {\n                const alias = aliases[iAlias];\n                delete _nameToClass[alias];\n                delete _idToClass[alias];\n            }\n        }\n    }\n}\n\n/**\n * @en\n * Get the registered class by id\n * @zh\n * 通过 id 获取已注册的类型\n * @param classId\n * @return constructor\n * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n */\nexport function _getClassById (classId) {\n    return getClassById(classId);\n}\n\n/**\n * @en\n * Get the registered class by id\n * @zh\n * 通过 id 获取已注册的类型\n * @param classId\n * @return constructor\n */\nexport function getClassById (classId) {\n    return _idToClass[classId];\n}\n\n/**\n * @en\n * Get the registered class by name\n * @zh\n * 通过名字获取已注册的类型\n * @param classname\n * @return constructor of the class\n */\nexport function getClassByName (classname) {\n    return _nameToClass[classname];\n}\n\n/**\n * @en\n * Get class id of the object\n * @zh\n * 获取对象的 class id\n * @param obj - instance or constructor\n * @param [allowTempId = true]   - can return temp id in editor\n * @return\n * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n */\nexport function _getClassId (obj, allowTempId?: boolean) {\n    return getClassId(obj, allowTempId);\n}\n\n/**\n * @en\n * Get class id of the object\n * @zh\n * 获取对象的 class id\n * @param obj - instance or constructor\n * @param [allowTempId = true]   - can return temp id in editor\n * @return\n */\nexport function getClassId (obj, allowTempId?: boolean) {\n    allowTempId = (typeof allowTempId !== 'undefined' ? allowTempId : true);\n\n    let res;\n    // eslint-disable-next-line no-prototype-builtins\n    if (typeof obj === 'function' && obj.prototype.hasOwnProperty(classIdTag)) {\n        res = obj.prototype[classIdTag];\n        if (!allowTempId && (DEV || EDITOR) && isTempClassId(res)) {\n            return '';\n        }\n        return res as string;\n    }\n    if (obj && obj.constructor) {\n        const prototype = obj.constructor.prototype;\n        // eslint-disable-next-line no-prototype-builtins\n        if (prototype && prototype.hasOwnProperty(classIdTag)) {\n            res = obj[classIdTag];\n            if (!allowTempId && (DEV || EDITOR) && isTempClassId(res)) {\n                return '';\n            }\n            return res as string;\n        }\n    }\n    return '';\n}\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\ntype CleanUpFunction<T> = (value: T) => boolean | void;\n\n/**\n * @en\n * A fixed-length object pool designed for general type.<br>\n * The implementation of this object pool is very simple,\n * it can helps you to improve your game performance for objects which need frequent release and recreate operations<br/>\n * @zh\n * 长度固定的对象缓存池，可以用来缓存各种对象类型。<br/>\n * 这个对象池的实现非常精简，它可以帮助您提高游戏性能，适用于优化对象的反复创建和销毁。\n * @class js.Pool\n * @example\n * ```\n *\n * Example 1:\n *\n * function Details () {\n *     this.uuidList = [];\n * };\n * Details.prototype.reset = function () {\n *     this.uuidList.length = 0;\n * };\n * Details.pool = new js.Pool(function (obj) {\n *     obj.reset();\n * }, 5);\n * Details.pool.get = function () {\n *     return this._get() || new Details();\n * };\n *\n * var detail = Details.pool.get();\n * ...\n * Details.pool.put(detail);\n *\n * Example 2:\n *\n * function Details (buffer) {\n *    this.uuidList = buffer;\n * };\n * ...\n * Details.pool.get = function (buffer) {\n *     var cached = this._get();\n *     if (cached) {\n *         cached.uuidList = buffer;\n *         return cached;\n *     }\n *     else {\n *         return new Details(buffer);\n *     }\n * };\n *\n * var detail = Details.pool.get( [] );\n * ...\n * ```\n */\nexport default class Pool<T> {\n    /**\n     * @en\n     * The current number of available objects, the default is 0, it will gradually increase with the recycle of the object,\n     * the maximum will not exceed the size specified when the constructor is called.\n     * @zh\n     * 当前可用对象数量，一开始默认是 0，随着对象的回收会逐渐增大，最大不会超过调用构造函数时指定的 size。\n     * @default 0\n     */\n    public count: number;\n\n    /**\n     * @en\n     * Get and initialize an object from pool. This method defaults to null and requires the user to implement it.\n     * @zh\n     * 获取并初始化对象池中的对象。这个方法默认为空，需要用户自己实现。\n     * @param args - parameters to used to initialize the object\n     */\n    public get () {\n        return this._get();\n    }\n\n    private _pool: Array<T | null>;\n    private _cleanup: CleanUpFunction<T> | null;\n\n    /**\n     * 使用构造函数来创建一个指定对象类型的对象池，您可以传递一个回调函数，用于处理对象回收时的清理逻辑。\n     * @method constructor\n     * @param {Function} [cleanupFunc] - the callback method used to process the cleanup logic when the object is recycled.\n     * @param {Object} cleanupFunc.obj\n     * @param {Number} size - initializes the length of the array\n     */\n    constructor (cleanup: CleanUpFunction<T>, size: number);\n\n    /**\n     * 使用构造函数来创建一个指定对象类型的对象池，您可以传递一个回调函数，用于处理对象回收时的清理逻辑。\n     * @method constructor\n     * @param {Function} [cleanupFunc] - the callback method used to process the cleanup logic when the object is recycled.\n     * @param {Object} cleanupFunc.obj\n     * @param {Number} size - initializes the length of the array\n     */\n    constructor (size: number);\n\n    constructor (_0: CleanUpFunction<T> | number, _1?: number) {\n        const size = (_1 === undefined) ? (_0 as number) : _1;\n        const cleanupFunc = (_1 === undefined) ? null : (_0 as CleanUpFunction<T>);\n        this.count = 0;\n        this._pool = new Array(size);\n        this._cleanup = cleanupFunc;\n    }\n\n    /**\n     * @en\n     * Get an object from pool, if no available object in the pool, null will be returned.\n     * @zh\n     * 获取对象池中的对象，如果对象池没有可用对象，则返回空。\n     *\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _get () {\n        if (this.count > 0) {\n            --this.count;\n            const cache = this._pool[this.count];\n            this._pool[this.count] = null;\n            return cache;\n        }\n        return null;\n    }\n\n    /**\n     * @en Put an object into the pool.\n     * @zh 向对象池返还一个不再需要的对象。\n     */\n    public put (obj: T) {\n        const pool = this._pool;\n        if (this.count < pool.length) {\n            if (this._cleanup && this._cleanup(obj) === false) {\n                return;\n            }\n            pool[this.count] = obj;\n            ++this.count;\n        }\n    }\n\n    /**\n     * @en Resize the pool.\n     * @zh 设置对象池容量。\n     */\n    public resize (length: number) {\n        if (length >= 0) {\n            this._pool.length = length;\n            if (this.count > length) {\n                this.count = length;\n            }\n        }\n    }\n}\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport * as jsarray from './array';\nimport IDGenerator from './id-generator';\nimport {\n    _idToClass,\n    _nameToClass,\n    _getClassById,\n    _getClassId,\n    _setClassId,\n    addon,\n    clear,\n    createMap,\n    extend,\n    formatStr,\n    get,\n    getClassByName,\n    getClassById,\n    getClassName,\n    getClassId,\n    getPropertyDescriptor,\n    getset,\n    getSuper,\n    isChildClassOf,\n    isNumber,\n    isString,\n    isEmptyObject,\n    mixin,\n    obsolete,\n    obsoletes,\n    set,\n    setClassName,\n    setClassAlias,\n    shiftArguments,\n    unregisterClass,\n    value,\n} from './js-typed';\nimport Pool from './pool';\n\nimport { legacyCC } from '../global-exports';\n\nexport * from './js-typed';\nexport { default as IDGenerator } from './id-generator';\nexport { default as Pool } from './pool';\nexport const array = jsarray;\n\nexport const js = {\n    IDGenerator,\n    Pool,\n    array: jsarray,\n    isNumber,\n    isString,\n    isEmptyObject,\n    getPropertyDescriptor,\n    addon,\n    mixin,\n    extend,\n    getSuper,\n    isChildClassOf,\n    clear,\n    value,\n    getset,\n    get,\n    set,\n    unregisterClass,\n    getClassName,\n    setClassName,\n    setClassAlias,\n    getClassByName,\n    getClassById,\n    /**\n     * @en All classes registered in the engine, indexed by name.\n     * @zh 引擎中已注册的所有类型，通过名称进行索引。\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     * @example\n     * ```\n     * import { js } from 'cc';\n     * // save all registered classes before loading scripts\n     * let builtinClassIds = js._registeredClassIds;\n     * let builtinClassNames = js._registeredClassNames;\n     * // load some scripts that contain CCClass\n     * ...\n     * // clear all loaded classes\n     * js._registeredClassIds = builtinClassIds;\n     * js._registeredClassNames = builtinClassNames;\n     * ```\n     *\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    get _registeredClassNames (): typeof _nameToClass {\n        return { ..._nameToClass };\n    },\n    set _registeredClassNames (value: typeof _nameToClass) {\n        clear(_nameToClass);\n        Object.assign(_nameToClass, value);\n    },\n    /**\n     * @en All classes registered in the engine, indexed by ID.\n     * @zh 引擎中已注册的所有类型，通过 ID 进行索引。\n     * @example\n     * ```\n     * import { js } from 'cc';\n     * // save all registered classes before loading scripts\n     * let builtinClassIds = js._registeredClassIds;\n     * let builtinClassNames = js._registeredClassNames;\n     * // load some scripts that contain CCClass\n     * ...\n     * // clear all loaded classes\n     * js._registeredClassIds = builtinClassIds;\n     * js._registeredClassNames = builtinClassNames;\n     * ```\n     *\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    get _registeredClassIds (): typeof _idToClass {\n        return { ..._idToClass };\n    },\n    set _registeredClassIds (value: typeof _idToClass) {\n        clear(_idToClass);\n        Object.assign(_idToClass, value);\n    },\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    _getClassId,\n    getClassId,\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    _setClassId,\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    _getClassById,\n    obsolete,\n    obsoletes,\n    formatStr,\n    shiftArguments,\n    createMap,\n};\n\n/**\n * @en This module provides some JavaScript utilities. All members can be accessed via `import { js } from 'cc'`.\n * @zh 这个模块封装了 JavaScript 相关的一些实用函数，你可以通过 `import { js } from 'cc'` 来访问这个模块。\n */\nlegacyCC.js = js;\n","/*\r\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { EDITOR, TEST } from 'internal:constants';\r\nimport { value } from '../utils/js';\r\nimport { legacyCC } from '../global-exports';\r\nimport { errorID } from '../platform/debug';\r\n\r\n/**\r\n * @en\r\n * Define an BitMask type.\r\n * @zh\r\n * 定义一个位掩码类型。\r\n * @param obj\r\n * @en A JavaScript literal object containing BitMask names and values.\r\n * @zh 包含 BitMask 名称和值的 JavaScript 文字对象。\r\n * @return @en The defined BitMask type @zh 定义的位掩码类型。\r\n */\r\nexport function BitMask<T> (obj: T): T {\r\n    if ('__bitmask__' in obj) {\r\n        return obj;\r\n    }\r\n    value(obj, '__bitmask__', null, true);\r\n\r\n    let lastIndex = -1;\r\n    const keys: string[] = Object.keys(obj);\r\n\r\n    for (let i = 0; i < keys.length; i++) {\r\n        const key = keys[i];\r\n        let val = obj[key];\r\n        if (val === -1) {\r\n            val = ++lastIndex;\r\n            obj[key] = val;\r\n        } else if (typeof val === 'number') {\r\n            lastIndex = val;\r\n        } else if (typeof val === 'string' && Number.isInteger(parseFloat(key))) {\r\n            continue;\r\n        }\r\n        const reverseKey = `${val}`;\r\n        if (key !== reverseKey) {\r\n            if ((EDITOR || TEST) && reverseKey in obj && obj[reverseKey] !== key) {\r\n                errorID(7100, reverseKey);\r\n                continue;\r\n            }\r\n            value(obj, reverseKey, key);\r\n        }\r\n    }\r\n    return obj;\r\n}\r\n\r\nBitMask.isBitMask = (BitMaskType) => BitMaskType && BitMaskType.hasOwnProperty('__bitmask__');\r\n\r\nBitMask.getList = (BitMaskDef) => {\r\n    if (BitMaskDef.__bitmask__) {\r\n        return BitMaskDef.__bitmask__;\r\n    }\r\n\r\n    const bitlist: any[] = BitMaskDef.__bitmask__ = [];\r\n\r\n    for (const name in BitMaskDef) {\r\n        const v = BitMaskDef[name];\r\n        if (Number.isInteger(v)) {\r\n            bitlist.push({ name, value: v });\r\n        }\r\n    }\r\n    bitlist.sort((a, b) => a.value - b.value);\r\n    return bitlist;\r\n};\r\n\r\nexport function ccbitmask (bitmaskx) {\r\n    if ('__bitmask__' in bitmaskx) {\r\n        return;\r\n    }\r\n    value(bitmaskx, '__bitmask__', null, true);\r\n}\r\n\r\nlegacyCC.BitMask = BitMask;\r\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, TEST, DEV } from 'internal:constants';\nimport { value } from '../utils/js';\nimport { legacyCC } from '../global-exports';\nimport { errorID } from '../platform/debug';\nimport { assertIsTrue } from '../data/utils/asserts';\n\n/**\n * @en\n * Define an enum type. <br/>\n * If a enum item has a value of -1, it will be given an Integer number according to it's order in the list.<br/>\n * Otherwise it will use the value specified by user who writes the enum definition.\n *\n * @zh\n * 定义一个枚举类型。<br/>\n * 用户可以把枚举值设为任意的整数，如果设为 -1，系统将会分配为上一个枚举值 + 1。\n *\n * @param obj\n * @en A JavaScript literal object containing enum names and values, or a TypeScript enum type.\n * @zh 包含枚举名和值的 JavaScript literal 对象，或者是一个 TypeScript enum 类型。\n * @return @en The defined enum type. @zh 定义的枚举类型。\n */\nexport function Enum<T> (obj: T): T {\n    if ('__enums__' in obj) {\n        return obj;\n    }\n    value(obj, '__enums__', null, true);\n    return Enum.update(obj);\n}\n\n/**\n * @en\n * Update the enum object properties.\n * @zh\n * 更新枚举对象的属性列表。\n * @param obj @en The enum object to update. @zh 需要更新的枚举对象。\n */\nEnum.update = <T> (obj: T): T => {\n    let lastIndex = -1;\n    const keys: string[] = Object.keys(obj);\n\n    for (let i = 0; i < keys.length; i++) {\n        const key = keys[i];\n        let val = obj[key];\n        if (val === -1) {\n            val = ++lastIndex;\n            obj[key] = val;\n        } else if (typeof val === 'number') {\n            lastIndex = val;\n        } else if (typeof val === 'string' && Number.isInteger(parseFloat(key))) {\n            continue;\n        }\n        const reverseKey = `${val}`;\n        if (key !== reverseKey) {\n            if ((EDITOR || TEST) && reverseKey in obj && obj[reverseKey] !== key) {\n                errorID(7100, reverseKey);\n                continue;\n            }\n            value(obj, reverseKey, key);\n        }\n    }\n    // auto update list if __enums__ is array\n    // @ts-expect-error Injected properties\n    if (Array.isArray(obj.__enums__)) {\n        updateList(obj);\n    }\n    return obj;\n};\n\nnamespace Enum {\n    export interface Enumerator<EnumT> {\n        /**\n         * The name of the enumerator.\n         */\n        name: keyof EnumT;\n\n        /**\n         * The value of the numerator.\n         */\n        value: EnumT[keyof EnumT];\n    }\n}\n\ninterface EnumExtras<EnumT> {\n    __enums__: null | Enum.Enumerator<EnumT>[];\n}\n\n/**\n * Determines if the object is an enum type.\n * @param enumType @en The object to judge. @zh 需要判断的对象。\n */\nEnum.isEnum = <EnumT extends {}>(enumType: EnumT) => enumType && enumType.hasOwnProperty('__enums__');\n\nfunction assertIsEnum <EnumT extends {}> (enumType: EnumT): asserts enumType is EnumT & EnumExtras<EnumT> {\n    assertIsTrue(enumType.hasOwnProperty('__enums__'));\n}\n\n/**\n * Get the enumerators from the enum type.\n * @param enumType @en An enum type. @zh 枚举类型。\n */\nEnum.getList = <EnumT extends {}>(enumType: EnumT): readonly Enum.Enumerator<EnumT>[] => {\n    assertIsEnum(enumType);\n\n    if (enumType.__enums__) {\n        return enumType.__enums__;\n    }\n\n    return updateList(enumType as EnumT);\n};\n\n/**\n * Update the enumerators from the enum type.\n * @param enumType @en The enum type defined from [[Enum]] @zh 从[[Enum]]定义的枚举类型。\n * @return {Object[]}\n */\nfunction updateList<EnumT extends {}> (enumType: EnumT): readonly Enum.Enumerator<EnumT>[] {\n    assertIsEnum(enumType);\n    const enums: any[] = enumType.__enums__ || [];\n    enums.length = 0;\n\n    for (const name in enumType) {\n        const v = enumType[name];\n        if (Number.isInteger(v)) {\n            enums.push({ name, value: v });\n        }\n    }\n    enums.sort((a, b) => a.value - b.value);\n    enumType.__enums__ = enums;\n    return enums;\n}\n\nif (DEV) {\n    // check key order in object literal\n    const _TestEnum = Enum({\n        ZERO: -1,\n        ONE: -1,\n        TWO: -1,\n        THREE: -1,\n    });\n    if (_TestEnum.ZERO !== 0 || _TestEnum.ONE !== 1 || _TestEnum.THREE !== 3) {\n        errorID(7101);\n    }\n}\n\n/**\n * Make the enum type `enumType` as enumeration so that Creator may identify, operate on it.\n * Formally, as a result of invocation on this function with enum type `enumType`:\n * - `Enum.isEnum(enumType)` returns `true`;\n * - `Enum.getList(enumType)` returns the enumerators of `enumType`.\n * @param\n * @en enumType An enum type, eg, a kind of type with similar semantic defined by TypeScript.\n * @zh 枚举类型，例如 TypeScript 中定义的类型。\n */\nexport function ccenum<EnumT extends {}> (enumType: EnumT) {\n    if (!('__enums__' in enumType)) {\n        value(enumType, '__enums__', null, true);\n    }\n}\n\nlegacyCC.Enum = Enum;\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\nimport { HTML5 } from 'internal:constants';\nimport { legacyCC } from './global-exports';\n\ndeclare const fsUtils: any;\n\n/**\n * @zh\n * Settings 中的默认分组，通常与模块一一对应。\n *\n * @en\n * The default grouping in Settings, which usually corresponds to the module.\n */\nenum Category {\n    PATH = 'path',\n    ENGINE = 'engine',\n    ASSETS = 'assets',\n    SCRIPTING = 'scripting',\n    PHYSICS = 'physics',\n    RENDERING = 'rendering',\n    LAUNCH = 'launch',\n    SCREEN = 'screen',\n    SPLASH_SCREEN = 'splashScreen',\n    ANIMATION = 'animation',\n    PROFILING = 'profiling',\n    PLUGINS = 'plugins',\n}\n\n/**\n * @zh\n * 配置模块用于获取 settings.json 配置文件中的配置信息，同时你可以覆盖一些配置从而影响引擎的启动和运行，可参考 [game.init] 的参数选项说明。你可以通过 [settings] 访问此模块单例。\n * @en\n * The Settings module is used to get the configuration information in the settings.json configuration file,\n * and you can override some of the configuration to affect the launch and running of the engine, as described in the [game.init] parameter options.\n * You can access this single instance of the module via [settings].\n */\nexport class Settings {\n    static Category = Category;\n\n    /**\n     * Initialization\n     * @internal\n     */\n    init (path = '', overrides: Record<string, any> = {}): Promise<void> {\n        for (const categoryName in overrides) {\n            const category = overrides[categoryName];\n            if (category) {\n                for (const name in category) {\n                    this.overrideSettings(categoryName, name, category[name]);\n                }\n            }\n        }\n        if (!path) return Promise.resolve();\n        return new Promise((resolve, reject) => {\n            if (!HTML5 && !path.startsWith('http')) {\n                const result = fsUtils.readJsonSync(path);\n                if (result instanceof Error) {\n                    reject(result);\n                } else {\n                    this._settings = result;\n                    resolve();\n                }\n            } else {\n                const xhr = new XMLHttpRequest();\n                xhr.open('GET', path);\n                xhr.responseType = 'text';\n                xhr.onload = () => {\n                    this._settings = JSON.parse(xhr.response);\n                    resolve();\n                };\n                xhr.onerror = () => {\n                    reject(new Error('request settings failed!'));\n                };\n                xhr.send(null);\n            }\n        });\n    }\n\n    /**\n     * @zh\n     * 覆盖一部分配置数据。\n     *\n     * @en\n     * Override some configuration info in Settings module.\n     *\n     * @param category @en The category you want to override. @zh 想要覆盖的分组。\n     * @param name @en The name of the configuration in the category you want to override. @zh 分组中想要覆盖的具体配置名称。\n     * @param value @en The value of the configuration you want to override. @zh 想要覆盖的具体值。\n     *\n     * @example\n     * ```ts\n     * console.log(settings.querySettings(Settings.Category.ASSETS, 'server')); // print https://www.cocos.com\n     * settings.overrideSettings(Settings.Category.ASSETS, 'server', 'http://www.test.com');\n     * console.log(settings.querySettings(Settings.Category.ASSETS, 'server')); // print http://www.test.com\n     * ```\n     */\n    overrideSettings<T = any> (category: Category | string, name: string, value: T) {\n        if (!(category in this._override)) {\n            this._override[category] = {};\n        }\n        this._override[category][name] = value;\n    }\n\n    /**\n     * @zh\n     * 查询配置模块中具体分组中的具体配置值。\n     *\n     * @en\n     * Query specific configuration values in specific category in the settings module.\n     *\n     * @param category @en The name of category to query. @zh 想要查询的分组名称。\n     * @param name @en The name of configuration in category to query. @zh 分组中想要查询的具体的配置名称。\n     * @returns @en The value of configuration to query. @zh 想要查询的具体配置值。\n     *\n     * @example\n     * ```ts\n     * console.log(settings.querySettings(Settings.Category.ENGINE, 'debug')); // print false\n     * ```\n     */\n    querySettings<T = any> (category: Category | string, name: string): T | null {\n        if (category in this._override) {\n            const categorySettings = this._override[category];\n            if (categorySettings && name in categorySettings) {\n                return categorySettings[name] as T;\n            }\n        }\n        if (category in this._settings) {\n            const categorySettings = this._settings[category];\n            if (categorySettings && name in categorySettings) {\n                return categorySettings[name] as T;\n            }\n        }\n        return null;\n    }\n\n    private _settings: Record<string, any> = {};\n    private _override: Record<string, any> = {};\n}\n\nexport declare namespace Settings {\n    export type Category = typeof Category;\n}\n\n/**\n * @zh\n * Settings 模块单例，你能通过此单例访问 settings.json 中的配置数据。\n * @en\n * Settings module singleton, through this you can access the configuration data in settings.json.\n */\nexport const settings = new Settings();\nlegacyCC.settings = settings;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { errorID } from '../platform/debug';\nimport * as js from '../utils/js';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en The base class of all value types.\n * @zh 所有值类型的基类。\n */\nexport class ValueType {\n    /**\n     * @en\n     * Clone the current object. The clone result of the object should be equal to the current object,\n     * i.e. satisfy `this.equals(this, value.clone())`.\n     * The base version of this method do nothing and returns `this'.\n     * The derived class **must** rewrite this method and the returned object should not be `this`, i.e. satisfy `this !== this.clone()`.\n     * @zh\n     * 克隆当前值。克隆的结果值应与当前值相等，即满足 `this.equals(this, value.clone())`。\n     * 本方法的基类版本简单地返回 `this`；\n     * 派生类**必须**重写本方法，并且返回的对象不应当为 `this`，即满足 `this !== this.clone()`。\n     * @returns @en The cloned object. @zh 克隆的对象。\n     */\n    public clone (): ValueType {\n        errorID(100, `${js.getClassName(this)}.clone`);\n        return this;\n    }\n\n    /**\n     * @en\n     * Check whether the current object is equal to the specified object.\n     * This check should be interchangeable, i.e. satisfy `this.equals(other) === other.equals(this)`.\n     * The base version of this method will returns `false'.\n     * @zh\n     * 判断当前值是否与指定值相等。此判断应当具有交换性，即满足 `this.equals(other) === other.equals(this)`。\n     * 本方法的基类版本简单地返回 `false`。\n     * @param other @en The other object @zh 指定值。\n     * @returns @en `true` if equal, otherwise returns `false` @zh 如果相等，则返回 `true`，否则返回 `false`。\n     */\n    public equals (other: this) {\n        // errorID(100, js.getClassName(this) + '.equals');\n        return false;\n    }\n\n    /**\n     * @en\n     * Set the property values of the current object with the given object.\n     * The base version of this method will returns `this' and the derived class **must** rewrite this method.\n     * @zh\n     * 赋值当前值使其与指定值相等。\n     * 本方法的基类版本简单地返回 `this`，派生类**必须**重写本方法。\n     * @param other @en The other object. @zh 指定值。\n     */\n    public set (other: this) {\n        errorID(100, `${js.getClassName(this)}.set`);\n    }\n\n    /**\n     * @en\n     * Convert the current object to a string.\n     * The base version of this method will returns an empty string.\n     * @zh\n     * 返回当前值的字符串表示。\n     * 本方法的基类版本返回空字符串。\n     * @returns @en The string representation of the current value. @zh 当前值的字符串表示。\n     */\n    public toString () {\n        return `${''}`;\n    }\n}\njs.setClassName('cc.ValueType', ValueType);\n\nlegacyCC.ValueType = ValueType;\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, MINIGAME, NATIVE, PREVIEW, RUNTIME_BASED } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport { Settings, settings } from '../settings';\n\nconst SUPPORT_TEXTURE_FORMATS = ['.astc', '.pkm', '.pvr', '.webp', '.jpg', '.jpeg', '.bmp', '.png'];\n\nconst KEY = {\n    /**\n     * @en None\n     * @zh 没有分配\n     * @readonly\n     */\n    none: 0,\n\n    // android\n    /**\n     * @en The back key on mobile phone\n     * @zh 移动端返回键\n     * @readonly\n     * @deprecated since v3.3, please use KeyCode.MOBILE_BACK instead.\n     */\n    back: 6,\n    /**\n     * @en The menu key on mobile phone\n     * @zh 移动端菜单键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    menu: 18,\n\n    /**\n     * @en The backspace key\n     * @zh 退格键\n     * @readonly\n     */\n    backspace: 8,\n\n    /**\n     * @en The tab key\n     * @zh Tab 键\n     * @readonly\n     */\n    tab: 9,\n\n    /**\n     * @en The enter key\n     * @zh 回车键\n     * @readonly\n     */\n    enter: 13,\n\n    /**\n     * @en The shift key\n     * @zh Shift 键\n     * @readonly\n     * @deprecated since v3.3, please use KeyCode.SHIFT_LEFT instead.\n     */\n    shift: 16, // should use shiftkey instead\n\n    /**\n     * @en The ctrl key\n     * @zh Ctrl 键\n     * @readonly\n     * @deprecated since v3.3, please use KeyCode.CTRL_LEFT instead.\n     */\n    ctrl: 17, // should use ctrlkey\n\n    /**\n     * @en The alt key\n     * @zh Alt 键\n     * @readonly\n     * @deprecated since v3.3, please use KeyCode.ALT_LEFT instead.\n     */\n    alt: 18, // should use altkey\n\n    /**\n     * @en The pause key\n     * @zh 暂停键\n     * @readonly\n     */\n    pause: 19,\n\n    /**\n     * @en The caps lock key\n     * @zh 大写锁定键\n     * @readonly\n     */\n    capslock: 20,\n\n    /**\n     * @en The esc key\n     * @zh ESC 键\n     * @readonly\n     */\n    escape: 27,\n\n    /**\n     * @en The space key\n     * @zh 空格键\n     * @readonly\n     */\n    space: 32,\n\n    /**\n     * @en The page up key\n     * @zh 向上翻页键\n     * @readonly\n     */\n    pageup: 33,\n\n    /**\n     * @en The page down key\n     * @zh 向下翻页键\n     * @readonly\n     */\n    pagedown: 34,\n\n    /**\n     * @en The end key\n     * @zh 结束键\n     * @readonly\n     */\n    end: 35,\n\n    /**\n     * @en The home key\n     * @zh 主菜单键\n     * @readonly\n     */\n    home: 36,\n\n    /**\n     * @en The left key\n     * @zh 向左箭头键\n     * @readonly\n     */\n    left: 37,\n\n    /**\n     * @en The up key\n     * @zh 向上箭头键\n     * @readonly\n     */\n    up: 38,\n\n    /**\n     * @en The right key\n     * @zh 向右箭头键\n     * @readonly\n     */\n    right: 39,\n\n    /**\n     * @en The down key\n     * @zh 向下箭头键\n     * @readonly\n     */\n    down: 40,\n\n    /**\n     * @en The select key\n     * @zh Select 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    select: 41,\n\n    /**\n     * @en The insert key\n     * @zh 插入键\n     * @readonly\n     */\n    insert: 45,\n\n    /**\n     * @en The Delete key\n     * @zh 删除键\n     * @readonly\n     */\n    Delete: 46,\n\n    /**\n     * @en The '0' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 0 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    0: 48,\n\n    /**\n     * @en The '1' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 1 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    1: 49,\n\n    /**\n     * @en The '2' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 2 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    2: 50,\n\n    /**\n     * @en The '3' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 3 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    3: 51,\n\n    /**\n     * @en The '4' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 4 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    4: 52,\n\n    /**\n     * @en The '5' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 5 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    5: 53,\n\n    /**\n     * @en The '6' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 6 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    6: 54,\n\n    /**\n     * @en The '7' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 7 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    7: 55,\n\n    /**\n     * @en The '8' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 8 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    8: 56,\n\n    /**\n     * @en The '9' key on the top of the alphanumeric keyboard.\n     * @zh 字母键盘上的 9 键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    9: 57,\n\n    /**\n     * @en The a key\n     * @zh A 键\n     * @readonly\n     */\n    a: 65,\n\n    /**\n     * @en The b key\n     * @zh B 键\n     * @readonly\n     */\n    b: 66,\n\n    /**\n     * @en The c key\n     * @zh C 键\n     * @readonly\n     */\n    c: 67,\n\n    /**\n     * @en The d key\n     * @zh D 键\n     * @readonly\n     */\n    d: 68,\n\n    /**\n     * @en The e key\n     * @zh E 键\n     * @readonly\n     */\n    e: 69,\n\n    /**\n     * @en The f key\n     * @zh F 键\n     * @readonly\n     */\n    f: 70,\n\n    /**\n     * @en The g key\n     * @zh G 键\n     * @readonly\n     */\n    g: 71,\n\n    /**\n     * @en The h key\n     * @zh H 键\n     * @readonly\n     */\n    h: 72,\n\n    /**\n     * @en The i key\n     * @zh I 键\n     * @readonly\n     */\n    i: 73,\n\n    /**\n     * @en The j key\n     * @zh J 键\n     * @readonly\n     */\n    j: 74,\n\n    /**\n     * @en The k key\n     * @zh K 键\n     * @readonly\n     */\n    k: 75,\n\n    /**\n     * @en The l key\n     * @zh L 键\n     * @readonly\n     */\n    l: 76,\n\n    /**\n     * @en The m key\n     * @zh M 键\n     * @readonly\n     */\n    m: 77,\n\n    /**\n     * @en The n key\n     * @zh N 键\n     * @readonly\n     */\n    n: 78,\n\n    /**\n     * @en The o key\n     * @zh O 键\n     * @readonly\n     */\n    o: 79,\n\n    /**\n     * @en The p key\n     * @zh P 键\n     * @readonly\n     */\n    p: 80,\n\n    /**\n     * @en The q key\n     * @zh Q 键\n     * @readonly\n     */\n    q: 81,\n\n    /**\n     * @en The r key\n     * @zh R 键\n     * @readonly\n     */\n    r: 82,\n\n    /**\n     * @en The s key\n     * @zh S 键\n     * @readonly\n     */\n    s: 83,\n\n    /**\n     * @en The t key\n     * @zh T 键\n     * @readonly\n     */\n    t: 84,\n\n    /**\n     * @en The u key\n     * @zh U 键\n     * @readonly\n     */\n    u: 85,\n\n    /**\n     * @en The v key\n     * @zh V 键\n     * @readonly\n     */\n    v: 86,\n\n    /**\n     * @en The w key\n     * @zh W 键\n     * @readonly\n     */\n    w: 87,\n\n    /**\n     * @en The x key\n     * @zh X 键\n     * @readonly\n     */\n    x: 88,\n\n    /**\n     * @en The y key\n     * @zh Y 键\n     * @readonly\n     */\n    y: 89,\n\n    /**\n     * @en The z key\n     * @zh Z 键\n     * @readonly\n     */\n    z: 90,\n\n    /**\n     * @en The numeric keypad 0\n     * @zh 数字键盘 0\n     * @readonly\n     */\n    num0: 96,\n\n    /**\n     * @en The numeric keypad 1\n     * @zh 数字键盘 1\n     * @readonly\n     */\n    num1: 97,\n\n    /**\n     * @en The numeric keypad 2\n     * @zh 数字键盘 2\n     * @readonly\n     */\n    num2: 98,\n\n    /**\n     * @en The numeric keypad 3\n     * @zh 数字键盘 3\n     * @readonly\n     */\n    num3: 99,\n\n    /**\n     * @en The numeric keypad 4\n     * @zh 数字键盘 4\n     * @readonly\n     */\n    num4: 100,\n\n    /**\n     * @en The numeric keypad 5\n     * @zh 数字键盘 5\n     * @readonly\n     */\n    num5: 101,\n\n    /**\n     * @en The numeric keypad 6\n     * @zh 数字键盘 6\n     * @readonly\n     */\n    num6: 102,\n\n    /**\n     * @en The numeric keypad 7\n     * @zh 数字键盘 7\n     * @readonly\n     */\n    num7: 103,\n\n    /**\n     * @en The numeric keypad 8\n     * @zh 数字键盘 8\n     * @readonly\n     */\n    num8: 104,\n\n    /**\n     * @en The numeric keypad 9\n     * @zh 数字键盘 9\n     * @readonly\n     */\n    num9: 105,\n\n    /**\n     * @en The numeric keypad '*'\n     * @zh 数字键盘 *\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '*': 106,\n\n    /**\n     * @en The numeric keypad '+'\n     * @zh 数字键盘 +\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '+': 107,\n\n    /**\n     * @en The numeric keypad '-'\n     * @zh 数字键盘 -\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '-': 109,\n\n    /**\n     * @en The numeric keypad 'delete'\n     * @zh 数字键盘删除键\n     * @readonly\n     */\n    numdel: 110,\n\n    /**\n     * @en The numeric keypad '/'\n     * @zh 数字键盘 /\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '/': 111,\n\n    /**\n     * @en The F1 function key\n     * @zh F1 功能键\n     * @readonly\n     */\n    f1: 112, // f1-f12 dont work on ie\n\n    /**\n     * @en The F2 function key\n     * @zh F2 功能键\n     * @readonly\n     */\n    f2: 113,\n\n    /**\n     * @en The F3 function key\n     * @zh F3 功能键\n     * @readonly\n     */\n    f3: 114,\n\n    /**\n     * @en The F4 function key\n     * @zh F4 功能键\n     * @readonly\n     */\n    f4: 115,\n\n    /**\n     * @en The F5 function key\n     * @zh F5 功能键\n     * @readonly\n     */\n    f5: 116,\n\n    /**\n     * @en The F6 function key\n     * @zh F6 功能键\n     * @readonly\n     */\n    f6: 117,\n\n    /**\n     * @en The F7 function key\n     * @zh F7 功能键\n     * @readonly\n     */\n    f7: 118,\n\n    /**\n     * @en The F8 function key\n     * @zh F8 功能键\n     * @readonly\n     */\n    f8: 119,\n\n    /**\n     * @en The F9 function key\n     * @zh F9 功能键\n     * @readonly\n     */\n    f9: 120,\n\n    /**\n     * @en The F10 function key\n     * @zh F10 功能键\n     * @readonly\n     */\n    f10: 121,\n\n    /**\n     * @en The F11 function key\n     * @zh F11 功能键\n     * @readonly\n     */\n    f11: 122,\n\n    /**\n     * @en The F12 function key\n     * @zh F12 功能键\n     * @readonly\n     */\n    f12: 123,\n\n    /**\n     * @en The numlock key\n     * @zh 数字锁定键\n     * @readonly\n     */\n    numlock: 144,\n\n    /**\n     * @en The scroll lock key\n     * @zh 滚动锁定键\n     * @readonly\n     */\n    scrolllock: 145,\n\n    /**\n     * @en The ';' key.\n     * @zh 分号键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    ';': 186,\n\n    /**\n     * @en The ';' key.\n     * @zh 分号键\n     * @readonly\n     */\n    semicolon: 186,\n\n    /**\n     * @en The '=' key.\n     * @zh 等于号键\n     * @readonly\n     */\n    equal: 187,\n\n    /**\n     * @en The '=' key.\n     * @zh 等于号键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '=': 187,\n\n    /**\n     * @en The ',' key.\n     * @zh 逗号键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    ',': 188,\n\n    /**\n     * @en The ',' key.\n     * @zh 逗号键\n     * @readonly\n     */\n    comma: 188,\n\n    /**\n     * @en The dash '-' key.\n     * @zh 中划线键\n     * @readonly\n     */\n    dash: 189,\n\n    /**\n     * @en The '.' key.\n     * @zh 句号键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '.': 190,\n\n    /**\n     * @en The '.' key\n     * @zh 句号键\n     * @readonly\n     */\n    period: 190,\n\n    /**\n     * @en The forward slash key\n     * @zh 正斜杠键\n     * @readonly\n     */\n    forwardslash: 191,\n\n    /**\n     * @en The grave key\n     * @zh 按键 `\n     * @readonly\n     */\n    grave: 192,\n\n    /**\n     * @en The '[' key\n     * @zh 按键 [\n     * @readonly\n     * @deprecated since v3.3\n     */\n    '[': 219,\n\n    /**\n     * @en The '[' key\n     * @zh 按键 [\n     * @readonly\n     */\n    openbracket: 219,\n\n    /**\n     * @en The '\\' key\n     * @zh 反斜杠键\n     * @readonly\n     */\n    backslash: 220,\n\n    /**\n     * @en The ']' key\n     * @zh 按键 ]\n     * @readonly\n     * @deprecated since v3.3\n     */\n    ']': 221,\n\n    /**\n     * @en The ']' key\n     * @zh 按键 ]\n     * @readonly\n     */\n    closebracket: 221,\n\n    /**\n     * @en The quote key\n     * @zh 单引号键\n     * @readonly\n     */\n    quote: 222,\n\n    // gamepad controll\n\n    /**\n     * @en The dpad left key\n     * @zh 导航键 向左\n     * @readonly\n     * @deprecated since v3.3\n     */\n    dpadLeft: 1000,\n\n    /**\n     * @en The dpad right key\n     * @zh 导航键 向右\n     * @readonly\n     * @deprecated since v3.3\n     */\n    dpadRight: 1001,\n\n    /**\n     * @en The dpad up key\n     * @zh 导航键 向上\n     * @readonly\n     * @deprecated since v3.3\n     */\n    dpadUp: 1003,\n\n    /**\n     * @en The dpad down key\n     * @zh 导航键 向下\n     * @readonly\n     * @deprecated since v3.3\n     */\n    dpadDown: 1004,\n\n    /**\n     * @en The dpad center key\n     * @zh 导航键 确定键\n     * @readonly\n     * @deprecated since v3.3\n     */\n    dpadCenter: 1005,\n};\n/**\n * @en\n * Predefined constants, see [[Macro]] for detailed contents.\n * @zh\n * 预定义常量，具体内容参考 [[Macro]] 文档。\n */\n/**\n * @en Interface declaration for predefined constants, for usage you should be importing [[macro]] directly.\n * @zh 预定义常量的接口声明，实际使用应该直接导入 [[macro]]。\n */\ninterface Macro {\n    /**\n     * @en\n     * The image format supported by the engine, the actual supported formats may differ in different build platforms and device types.\n     * Currently contains ['.astc', '.pkm', '.pvr', '.webp', '.jpg', '.jpeg', '.bmp', '.png'].\n     * @zh\n     * 引擎默认支持的图片格式，实际运行时支持的格式可能在不同的构建平台和设备类型上有所差别。\n     * 目前包含的格式有 ['.astc', '.pkm', '.pvr', '.webp', '.jpg', '.jpeg', '.bmp', '.png']。\n     */\n    SUPPORT_TEXTURE_FORMATS: string[];\n\n    /**\n     * @en Key map for keyboard event\n     * @zh 键盘事件的按键值。\n     * @example {@link cocos/core/platform/CCCommon/KEY.js}\n     * @deprecated since v3.3 please use [[KeyCode]] instead\n     */\n    KEY: typeof KEY;\n\n    /**\n     * @en One angle in radian, equals to PI / 180\n     * @zh 弧度制中的单位角度，等同于 PI / 180\n     */\n    RAD: number;\n\n    /**\n     * @en One radian in angle, equals to 180 / PI\n     * @zh 角度制中的单位弧度，等同于 180 / PI\n     */\n    DEG: number;\n\n    /**\n     * @en A maximum value of number representing infinity repeat times\n     * @zh 重复执行的最大值，实际取值为数字的最大值\n     */\n    REPEAT_FOREVER: number;\n\n    /**\n     * @en A float value for representing a minimum error in comparison\n     * @zh 用于比较时可忽略的浮点误差值\n     */\n    FLT_EPSILON: number;\n\n    // Possible device orientations\n    /**\n     * @en Oriented vertically\n     * @zh 竖屏朝向\n     */\n    ORIENTATION_PORTRAIT: number;\n\n    /**\n     * @en Oriented horizontally\n     * @zh 横屏朝向\n     */\n    ORIENTATION_LANDSCAPE: number;\n\n    /**\n     * @en Oriented automatically\n     * @zh 自动适配朝向\n     */\n    ORIENTATION_AUTO: number;\n\n    /**\n     * @en\n     * Whether or not enabled tiled map auto culling. If you set the TiledMap skew or rotation,\n     * then need to manually disable this, otherwise, the rendering will be wrong.\n     * Currently not used in 3D engine\n     * @zh\n     * 是否开启瓦片地图的自动裁减功能。瓦片地图如果设置了 skew, rotation 的话，需要手动关闭，否则渲染会出错。\n     * 在 3D 引擎中暂时无效。\n     * @default true\n     * @deprecated since v3.0\n     */\n    ENABLE_TILEDMAP_CULLING: boolean;\n\n    /**\n     * @en\n     * The timeout to determine whether a touch is no longer active and should be removed.\n     * The reason to add this timeout is due to an issue in X5 browser core,\n     * when X5 is presented in wechat on Android, if a touch is glissed from the bottom up, and leave the page area,\n     * no touch cancel event is triggered, and the touch will be considered active forever.\n     * After multiple times of this action, our maximum touches number will be reached and all new touches will be ignored.\n     * So this new mechanism can remove the touch that should be inactive if it's not updated during the last 5000 milliseconds.\n     * Though it might remove a real touch if it's just not moving for the last 5 seconds,\n     * which is not easy with the sensibility of mobile touch screen.\n     * You can modify this value to have a better behavior if you find it's not enough.\n     * @zh\n     * 用于甄别一个触点对象是否已经失效并且可以被移除的延时时长\n     * 添加这个时长的原因是 X5 内核在微信浏览器中出现的一个 bug。\n     * 在这个环境下，如果用户将一个触点从底向上移出页面区域，将不会触发任何 touch cancel 或 touch end 事件，而这个触点会被永远当作停留在页面上的有效触点。\n     * 重复这样操作几次之后，屏幕上的触点数量将达到我们的事件系统所支持的最高触点数量，之后所有的触摸事件都将被忽略。\n     * 所以这个新的机制可以在触点在一定时间内没有任何更新的情况下视为失效触点并从事件系统中移除。\n     * 当然，这也可能移除一个真实的触点，如果用户的触点真的在一定时间段内完全没有移动（这在当前手机屏幕的灵敏度下会很难）。\n     * 你可以修改这个值来获得你需要的效果，默认值是 5000 毫秒。\n     * @default 5000\n     */\n    TOUCH_TIMEOUT: number;\n\n    /**\n     * @en\n     * Boolean that indicates if the canvas contains an alpha channel, default sets to false for better performance.\n     * Though if you want to make your canvas background transparent and show other dom elements at the background,\n     * you can set it to true before [[game.init]].\n     * Web only.\n     * @zh\n     * 用于设置 Canvas 背景是否支持 alpha 通道，默认为 false，这样可以有更高的性能表现。\n     * 如果你希望 Canvas 背景是透明的，并显示背后的其他 DOM 元素，你可以在 [[game.init]] 之前将这个值设为 true。\n     * 仅支持 Web\n     * @default false\n     */\n    ENABLE_TRANSPARENT_CANVAS: boolean;\n\n    /**\n     * @en\n     * Boolean that indicates if the GL context is created with `antialias` option turned on, default value is false.\n     * Set it to true could make your game graphics slightly smoother, like texture hard edges when rotated.\n     * Whether to use this really depend on your game design and targeted platform,\n     * device with retina display usually have good detail on graphics with or without this option,\n     * you probably don't want antialias if your game style is pixel art based.\n     * Also, it could have great performance impact with some browser / device using software MSAA.\n     * You can set it to true before [[game.init]].\n     * Only affect OpenGL ES and WebGL backend\n     * @zh\n     * 用于设置在创建 GL Context 时是否开启抗锯齿选项，默认值是 false。\n     * 将这个选项设置为 true 会让你的游戏画面稍稍平滑一些，比如旋转硬边贴图时的锯齿。是否开启这个选项很大程度上取决于你的游戏和面向的平台。\n     * 在大多数拥有 retina 级别屏幕的设备上用户往往无法区分这个选项带来的变化；如果你的游戏选择像素艺术风格，你也多半不会想开启这个选项。\n     * 同时，在少部分使用软件级别抗锯齿算法的设备或浏览器上，这个选项会对性能产生比较大的影响。\n     * 你可以在 [[game.init]] 之前设置这个值，否则它不会生效。\n     * 仅影响 WebGL 后端\n     * @default true\n     */\n    ENABLE_WEBGL_ANTIALIAS: boolean;\n\n    /**\n     * @en\n     * Used to set FXAA post-processing anti-aliasing, the default value is false.\n     * @zh\n     * 用于开启 FXAA 后处理抗锯齿, 默认值为 false。\n     * @default false\n     */\n    ENABLE_ANTIALIAS_FXAA: boolean;\n\n    /**\n     * @en\n     * Used to set bloom, the default value is false.\n     * @zh\n     * 用于开启 bloom, 默认值为 false。\n     * @default false\n     */\n    ENABLE_BLOOM: boolean;\n\n    /**\n     * @en\n     * Whether to clear the original image cache after uploaded a texture to GPU.\n     * If cleared, [Dynamic Atlas](https://docs.cocos.com/creator/manual/en/advanced-topics/dynamic-atlas.html) will not be supported.\n     * Normally you don't need to enable this option on the web platform, because Image object doesn't consume too much memory.\n     * But on Wechat Game platform, the current version cache decoded data in Image object, which has high memory usage.\n     * So we enabled this option by default on Wechat, so that we can release Image cache immediately after uploaded to GPU.\n     * Currently not useful in 3D engine\n     * @zh\n     * 是否在将贴图上传至 GPU 之后删除原始图片缓存，删除之后图片将无法进行 [动态合图](https://docs.cocos.com/creator/manual/zh/advanced-topics/dynamic-atlas.html)。\n     * 在 Web 平台，你通常不需要开启这个选项，因为在 Web 平台 Image 对象所占用的内存很小。\n     * 但是在微信小游戏平台的当前版本，Image 对象会缓存解码后的图片数据，它所占用的内存空间很大。\n     * 所以我们在微信平台默认开启了这个选项，这样我们就可以在上传 GL 贴图之后立即释放 Image 对象的内存，避免过高的内存占用。\n     * 在 3D 引擎中暂时无效。\n     * @default false\n     */\n    CLEANUP_IMAGE_CACHE: boolean;\n\n    /**\n     * @en\n     * Whether to enable multi-touch.\n     * @zh\n     * 是否开启多点触摸\n     * @default true\n     */\n    ENABLE_MULTI_TOUCH: boolean;\n\n    /**\n     * @en\n     * The maximum size of the canvas pool used by Label, please adjust according to the number of label component in the same scene of the project\n     * @zh\n     * Label 使用的 canvas pool 的最大大小，请根据项目同场景的 label 数量进行调整\n     * @default 20\n     */\n    MAX_LABEL_CANVAS_POOL_SIZE: number;\n\n    /**\n     * @en\n     * Boolean that indicates if enable highp precision data in structure with fragment shader.\n     * Enable this option will make the variables defined by the HIGHP_VALUE_STRUCT_DEFINE macro in the shader more accurate, such as position.\n     * Enable this option can avoid some distorted lighting effects. That depends on whether your game has abnormal lighting effects on this platform.\n     * There will be a slight performance loss if enable this option, but the impact is not significant.\n     * Only affect WebGL backend\n     * @zh\n     * 用于设置是否在片元着色器中使用结构体的时候，允许其中的数据使用highp精度\n     * 将这个选项设置为 true 会让shader中使用HIGHP_VALUE_STRUCT_DEFINE宏定义的变量精度更高，比如位置信息等，避免出现一些失真的光照效果。是否开启这个选项很大程度上取决于你的游戏在此平台上是否出现了异常的表现。\n     * 开启后会有轻微的性能损失，但影响不大。\n     * 仅影响 WebGL 后端\n     * @default false\n     */\n    ENABLE_WEBGL_HIGHP_STRUCT_VALUES: boolean;\n\n    /**\n     * @zh Batcher2D 中内存增量的大小（KB）\n     * 这个值决定了当场景中存在的 2d 渲染组件的顶点数量超过当前 batcher2D 中可容纳的顶点数量时，内存扩充的增加量\n     * 这个值越大，共用同一个 meshBuffer 的 2d 渲染组件数量会更多，但每次扩充所占用的内存也会更大\n     * 默认值在标准格式（[[VertexFormat.vfmtPosUvColor]]）下可容纳 4096 个顶点（4096*9*4/1024），你可以增加容量来提升每个批次可容纳的元素数量\n     * @en The MeshBuffer chunk size in Batcher2D (KB)\n     * This value determines the increase in memory expansion,\n     * when the number of vertices of 2d rendering components present in the scene exceeds the number of vertices,\n     * that can be accommodated in the current batcher2D.\n     * The larger this value is, the more 2d rendering components will share the same meshBuffer, but the more memory will be used for each expansion\n     * The default size can contain 4096 standard vertex ([[VertexFormat.vfmtPosUvColor]]) in one buffer,\n     * you can user larger buffer size to increase the elements count per 2d draw batch.\n     * @default 144 KB\n     */\n    BATCHER2D_MEM_INCREMENT: number;\n\n    /**\n     * @zh 自定义渲染管线的名字（实验性）\n     * 引擎会根据名字创建对应的渲染管线（仅限Web平台）。如果名字为空，则不启用自定义渲染管线。\n     * 目前仅支持'Forward', 'Deferred'两种。\n     * @en The name of custom rendering pipeline (experimental)\n     * Engine will use the name to create the custom pipeline (Web only). If the name is empty, custom pipeline will be disabled.\n     * Currently only 'Forward' and 'Deferred' are supported.\n     */\n    CUSTOM_PIPELINE_NAME: string;\n\n    /**\n     * @internal\n     */\n    init (): void;\n}\n\n/**\n * @en\n * Predefined constants, see [[Macro]] for detailed contents.\n * @zh\n * 预定义常量，具体内容参考 [[Macro]] 文档。\n */\nconst macro: Macro = {\n    SUPPORT_TEXTURE_FORMATS,\n    KEY,\n    RAD: Math.PI / 180,\n    DEG: 180 / Math.PI,\n    REPEAT_FOREVER: (Number.MAX_VALUE - 1),\n    FLT_EPSILON: 0.0000001192092896,\n    ORIENTATION_PORTRAIT: 1,\n    ORIENTATION_LANDSCAPE: 2,\n    ORIENTATION_AUTO: 3,\n    ENABLE_TILEDMAP_CULLING: true,\n    TOUCH_TIMEOUT: 5000,\n    ENABLE_TRANSPARENT_CANVAS: false,\n    ENABLE_WEBGL_ANTIALIAS: true,\n    ENABLE_ANTIALIAS_FXAA: false,\n    ENABLE_BLOOM: false,\n    CLEANUP_IMAGE_CACHE: false,\n    ENABLE_MULTI_TOUCH: true,\n    MAX_LABEL_CANVAS_POOL_SIZE: 20,\n    ENABLE_WEBGL_HIGHP_STRUCT_VALUES: false,\n    BATCHER2D_MEM_INCREMENT: 144,\n    CUSTOM_PIPELINE_NAME: '',\n    init () {\n        if (NATIVE || MINIGAME || RUNTIME_BASED) {\n            this.CLEANUP_IMAGE_CACHE = true;\n        }\n        const defaultValues = settings.querySettings(Settings.Category.ENGINE, 'macros');\n        if (defaultValues) {\n            for (const key in defaultValues) {\n                macro[key] = defaultValues[key];\n            }\n        }\n        if (PREVIEW || EDITOR) {\n            this.ENABLE_WEBGL_ANTIALIAS = true;\n        }\n        if (EDITOR) {\n            this.ENABLE_TRANSPARENT_CANVAS = false;\n        }\n    },\n};\n\nlegacyCC.macro = macro;\nexport { macro };\nexport type { Macro };\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/* eslint-disable no-new-func */\n\nimport { EDITOR, DEV } from 'internal:constants';\nimport { getClassName, getset, isEmptyObject } from './js';\nimport { legacyCC } from '../global-exports';\nimport { warnID } from '../platform/debug';\nimport { macro } from '../platform/macro';\n\nexport const BUILTIN_CLASSID_RE = /^(?:cc|dragonBones|sp|ccsg)\\..+/;\n\nconst BASE64_KEYS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst values:number[] = new Array(123); // max char code in base64Keys\nfor (let i = 0; i < 123; ++i) { values[i] = 64; } // fill with placeholder('=') index\nfor (let i = 0; i < 64; ++i) { values[BASE64_KEYS.charCodeAt(i)] = i; }\n\n// decoded value indexed by base64 char code\nexport const BASE64_VALUES = values;\n\n/**\n * @engineInternal\n * @param ctor\n * @param sameNameGetSets\n * @param diffNameGetSets\n */\nexport function propertyDefine (ctor, sameNameGetSets, diffNameGetSets) {\n    function define (np, propName, getter, setter) {\n        const pd = Object.getOwnPropertyDescriptor(np, propName);\n        if (pd) {\n            if (pd.get) { np[getter] = pd.get; }\n            if (pd.set && setter) { np[setter] = pd.set; }\n        } else {\n            const getterFunc = np[getter];\n            if (DEV && !getterFunc) {\n                const clsName = (legacyCC.Class._isCCClass(ctor) && getClassName(ctor))\n                    || ctor.name\n                    || '(anonymous class)';\n                warnID(5700, propName, getter, clsName);\n            } else {\n                getset(np, propName, getterFunc, np[setter]);\n            }\n        }\n    }\n    let propName; const np = ctor.prototype;\n    for (let i = 0; i < sameNameGetSets.length; i++) {\n        propName = sameNameGetSets[i];\n        const suffix = (propName[0].toUpperCase() as string) + (propName.slice(1) as string);\n        define(np, propName, `get${suffix}`, `set${suffix}`);\n    }\n    for (propName in diffNameGetSets) {\n        const gs = diffNameGetSets[propName];\n        define(np, propName, gs[0], gs[1]);\n    }\n}\n\n// set value to map, if key exists, push to array\nexport function pushToMap (map, key, value, pushFront) {\n    const exists = map[key];\n    if (exists) {\n        if (Array.isArray(exists)) {\n            if (pushFront) {\n                exists.push(exists[0]);\n                exists[0] = value;\n            } else {\n                exists.push(value);\n            }\n        } else {\n            map[key] = (pushFront ? [value, exists] : [exists, value]);\n        }\n    } else {\n        map[key] = value;\n    }\n}\n\nexport function contains (refNode, otherNode) {\n    if (typeof refNode.contains === 'function') {\n        return refNode.contains(otherNode) as boolean;\n    } else if (typeof refNode.compareDocumentPosition === 'function') {\n        return !!(refNode.compareDocumentPosition(otherNode) & 16);\n    } else {\n        let node = otherNode.parentNode;\n        if (node) {\n            do {\n                if (node === refNode) {\n                    return true;\n                } else {\n                    node = node.parentNode;\n                }\n            } while (node !== null);\n        }\n        return false;\n    }\n}\n\nexport function isDomNode (obj) {\n    if (typeof window === 'object' && typeof Node === 'function') {\n        // If \"TypeError: Right-hand side of 'instanceof' is not callback\" is thrown,\n        // it should because window.Node was overwritten.\n        return obj instanceof Node;\n    } else {\n        return !!obj\n            && typeof obj === 'object'\n            && typeof obj.nodeType === 'number'\n            && typeof obj.nodeName === 'string';\n    }\n}\n\nexport function callInNextTick (callback, p1?: any, p2?: any) {\n    if (callback) {\n        setTimeout(() => {\n            callback(p1, p2);\n        }, 0);\n    }\n}\n\n// use anonymous function here to ensure it will not being hoisted without EDITOR\nexport function tryCatchFunctor_EDITOR (funcName) {\n    // eslint-disable-next-line @typescript-eslint/no-implied-eval\n    return Function('target',\n        `${'try {\\n'\n        + '  target.'}${funcName}();\\n`\n        + `}\\n`\n        + `catch (e) {\\n`\n        + `  cc._throw(e);\\n`\n        + `}`);\n}\n\nexport function isPlainEmptyObj_DEV (obj) {\n    if (!obj || obj.constructor !== Object) {\n        return false;\n    }\n    return isEmptyObject(obj);\n}\n\n/**\n * @en Clamp a value between from and to. </br>\n * if the original value is larger than max_inclusive, return max_inclusive. </br>\n * if the original value is smaller than min_inclusive, return min_inclusive. </br>\n * else return the original value.\n * @zh 限定浮点数的最大最小值。<br/>\n * 数值大于 max_inclusive 则返回 max_inclusive。<br/>\n * 数值小于 min_inclusive 则返回 min_inclusive。<br/>\n * 否则返回自身。\n * @param value @en Original value @zh 初始值\n * @param min_inclusive @en Minimum value in between @zh 最小值\n * @param max_inclusive @en Maximum value in between @zh 最大值\n * @return {Number} @en The value clamped @zh 目标值\n * @example\n * var v1 = clampf(20, 0, 20); // 20;\n * var v2 = clampf(-1, 0, 20); //  0;\n * var v3 = clampf(10, 0, 20); // 10;\n */\nexport function clampf (value: number, min_inclusive: number, max_inclusive: number) {\n    if (min_inclusive > max_inclusive) {\n        const temp = min_inclusive;\n        min_inclusive = max_inclusive;\n        max_inclusive = temp;\n    }\n    return value < min_inclusive ? min_inclusive : value < max_inclusive ? value : max_inclusive;\n}\n\n/**\n * @en converts degrees to radians\n * @zh 角度转弧度\n * @param angle @en The degree to convert @zh 角度\n * @return {Number} The radian. @zh 弧度\n */\nexport function degreesToRadians (angle: number) {\n    return angle * macro.RAD;\n}\n\n/**\n * @en converts radians to degrees\n * @zh 弧度转角度\n * @param angle @en The radian to convert @zh 弧度\n * @return {Number} @en The degree @zh 角度\n */\nexport function radiansToDegrees (angle) {\n    return angle * macro.DEG;\n}\n\n// if (TEST) {\n//     // editor mocks using in unit tests\n//     if (typeof Editor === 'undefined') {\n//         window.Editor = {\n//             UuidUtils: {\n//                 NonUuidMark: '.',\n//                 uuid () {\n//                     return '' + ((new Date()).getTime() + Math.random());\n//                 },\n//             },\n//         };\n//     }\n// }\n\nlegacyCC.misc = {\n    BUILTIN_CLASSID_RE,\n    BASE64_VALUES,\n    propertyDefine,\n    pushToMap,\n    contains,\n    isDomNode,\n    callInNextTick,\n    isPlainEmptyObj_DEV,\n    clampf,\n    degreesToRadians,\n    radiansToDegrees,\n};\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR } from 'internal:constants';\nimport { log, warnID } from '../../platform/debug';\nimport { formatStr, get, getClassName, isChildClassOf, value } from '../../utils/js';\nimport { isPlainEmptyObj_DEV } from '../../utils/misc';\nimport { legacyCC } from '../../global-exports';\n\nexport const DELIMETER = '$_$';\n\nexport function createAttrsSingle (owner: Object, superAttrs?: any) {\n    const attrs = superAttrs ? Object.create(superAttrs) : {};\n    value(owner, '__attrs__', attrs);\n    return attrs;\n}\n\n/**\n * @param subclass Should not have '__attrs__'.\n */\nexport function createAttrs (subclass: any) {\n    if (typeof subclass !== 'function') {\n        // attributes only in instance\n        const instance = subclass;\n        return createAttrsSingle(instance, getClassAttrs(instance.constructor));\n    }\n    let superClass: any;\n    const chains: any[] = legacyCC.Class.getInheritanceChain(subclass);\n    for (let i = chains.length - 1; i >= 0; i--) {\n        const cls = chains[i];\n        const attrs = cls.hasOwnProperty('__attrs__') && cls.__attrs__;\n        if (!attrs) {\n            superClass = chains[i + 1];\n            createAttrsSingle(cls, superClass && superClass.__attrs__);\n        }\n    }\n    superClass = chains[0];\n    createAttrsSingle(subclass, superClass && superClass.__attrs__);\n    return subclass.__attrs__;\n}\n\n// /**\n//  * @class Class\n//  */\n/**\n * Tag the class with any meta attributes, then return all current attributes assigned to it.\n * This function holds only the attributes, not their implementations.\n * @param constructor The class or instance. If instance, the attribute will be dynamic and only available for the specified instance.\n * @param propertyName The name of property or function, used to retrieve the attributes.\n * @private\n */\nexport function attr (constructor: any, propertyName: string): { [attributeName: string]: any; } {\n    const attrs = getClassAttrs(constructor);\n    const prefix = propertyName + DELIMETER;\n    const ret = {};\n    for (const key in attrs) {\n        if (key.startsWith(prefix)) {\n            ret[key.slice(prefix.length)] = attrs[key];\n        }\n    }\n    return ret;\n}\n\n/**\n * Returns a readonly meta object.\n */\nexport function getClassAttrs (constructor: any) {\n    return (constructor.hasOwnProperty('__attrs__') && constructor.__attrs__) || createAttrs(constructor);\n}\n\nexport function setClassAttr (ctor, propName, key, value) {\n    getClassAttrs(ctor)[propName + DELIMETER + key] = value;\n}\n\nexport class PrimitiveType<T> {\n    public name: string;\n\n    public default: T;\n\n    constructor (name: string, defaultValue: T) {\n        this.name = name;\n        this.default = defaultValue;\n    }\n\n    public toString () {\n        return this.name;\n    }\n}\n\n/**\n * @en\n * Indicates that the editor should treats this property or array element as a Integer value.\n * @zh\n * 指定编辑器以整数形式对待该属性或数组元素。\n * @example\n * ```ts\n * import { CCInteger, _decorator } from \"cc\";\n *\n * // in class definition:\n *\n * @_decorator.property({type: CCInteger})\n * count = 0;\n *\n * @_decorator.property({type: [CCInteger]})\n * array = [];\n * ```\n */\nexport const CCInteger = new PrimitiveType('Integer', 0);\nlegacyCC.Integer = CCInteger;\nlegacyCC.CCInteger = CCInteger;\n\n/**\n * @en\n * Indicates that the editor should treats this property or array element as a Float value.\n * @zh\n * 指定编辑器以浮点数形式对待该属性或数组元素。\n * @example\n * ```ts\n * import { CCFloat, _decorator } from \"cc\";\n *\n * // in class definition:\n *\n * @_decorator.property({type: CCFloat})\n * x = 0;\n *\n * @_decorator.property({type: [CCFloat]})\n * array = [];\n * ```\n */\nexport const CCFloat = new PrimitiveType('Float', 0.0);\nlegacyCC.Float = CCFloat;\nlegacyCC.CCFloat = CCFloat;\n\nif (EDITOR) {\n    get(legacyCC, 'Number', () => {\n        warnID(3603);\n        return CCFloat;\n    });\n}\n\n/**\n * @en\n * Indicates that the editor should treats this property or array element as a Boolean value.\n * @zh\n * 指定编辑器以布尔值形式对待该属性或数组元素。\n *\n * @example\n * ```ts\n * import { CCBoolean, _decorator } from \"cc\";\n * // in class definition\n * @_decorator.property({type: CCBoolean})\n * isTrue = false;\n *\n * @_decorator.property({type: [CCBoolean]})\n * array = [];\n * ```\n */\nexport const CCBoolean = new PrimitiveType('Boolean', false);\nlegacyCC.Boolean = CCBoolean;\nlegacyCC.CCBoolean = CCBoolean;\n\n/**\n * @en\n * Indicates that the editor should treats this property or array element as a String value.\n * @zh\n * 指定编辑器以字符串形式对待该属性或数组元素。\n * @example\n * ```ts\n * import { CCString, _decorator } from \"cc\";\n *\n * // in class definition\n *\n * @_decorator.property({type: CCString})\n * name = '';\n *\n * @_decorator.property({type: [CCString]})\n * array = [];\n * ```\n */\nexport const CCString = new PrimitiveType('String', '');\nlegacyCC.String = CCString;\nlegacyCC.CCString = CCString;\n\n// Ensures the type matches its default value\nexport function getTypeChecker_ET (type: string, attributeName: string) {\n    return function (constructor: Function, mainPropertyName: string) {\n        const propInfo = `\"${getClassName(constructor)}.${mainPropertyName}\"`;\n        const mainPropAttrs = attr(constructor, mainPropertyName);\n        let mainPropAttrsType = mainPropAttrs.type;\n        if (mainPropAttrsType === CCInteger || mainPropAttrsType === CCFloat) {\n            mainPropAttrsType = 'Number';\n        } else if (mainPropAttrsType === CCString || mainPropAttrsType === CCBoolean) {\n            mainPropAttrsType = `${mainPropAttrsType}`;\n        }\n        if (mainPropAttrsType !== type) {\n            warnID(3604, propInfo);\n            return;\n        }\n\n        if (!mainPropAttrs.hasOwnProperty('default')) {\n            return;\n        }\n        const defaultVal = mainPropAttrs.default;\n        if (typeof defaultVal === 'undefined') {\n            return;\n        }\n        const isContainer = Array.isArray(defaultVal) || isPlainEmptyObj_DEV(defaultVal);\n        if (isContainer) {\n            return;\n        }\n        const defaultType = typeof defaultVal;\n        const type_lowerCase = type.toLowerCase();\n        if (defaultType === type_lowerCase) {\n            if (type_lowerCase === 'object') {\n                if (defaultVal && !(defaultVal instanceof mainPropAttrs.ctor)) {\n                    warnID(3605, propInfo, getClassName(mainPropAttrs.ctor));\n                } else {\n                    return;\n                }\n            } else if (type !== 'Number') {\n                warnID(3606, attributeName, propInfo, type);\n            }\n        } else if (defaultType !== 'function') {\n            if (type === CCString.default && defaultVal == null) {\n                warnID(3607, propInfo);\n            } else {\n                warnID(3611, attributeName, propInfo, defaultType);\n            }\n        } else {\n            return;\n        }\n        delete mainPropAttrs.type;\n    };\n}\n\n// Ensures the type matches its default value\nexport function getObjTypeChecker_ET (typeCtor) {\n    return function (classCtor, mainPropName) {\n        getTypeChecker_ET('Object', 'type')(classCtor, mainPropName);\n        // check ValueType\n        const defaultDef = getClassAttrs(classCtor)[`${mainPropName + DELIMETER}default`];\n        const defaultVal = legacyCC.Class.getDefault(defaultDef);\n        if (!Array.isArray(defaultVal) && isChildClassOf(typeCtor, legacyCC.ValueType)) {\n            const typename = getClassName(typeCtor);\n            const info = formatStr('No need to specify the \"type\" of \"%s.%s\" because %s is a child class of ValueType.',\n                getClassName(classCtor), mainPropName, typename);\n            if (defaultDef) {\n                log(info);\n            } else {\n                warnID(3612, info, typename, getClassName(classCtor), mainPropName, typename);\n            }\n        }\n    };\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { DEV, EDITOR, TEST } from 'internal:constants';\nimport { error, errorID, warn, warnID } from '../../platform/debug';\nimport * as js from '../../utils/js';\nimport { PrimitiveType } from './attribute';\nimport { legacyCC } from '../../global-exports';\n\n// 增加预处理属性这个步骤的目的是降低 CCClass 的实现难度，将比较稳定的通用逻辑和一些需求比较灵活的属性需求分隔开。\n\nconst SerializableAttrs = {\n    default: {},\n    serializable: {},\n    editorOnly: {},\n    formerlySerializedAs: {},\n};\n\n/**\n * 预处理 notify 等扩展属性\n */\nfunction parseNotify (val, propName, notify, properties) {\n    if (val.get || val.set) {\n        if (DEV) {\n            warnID(5500);\n        }\n        return;\n    }\n    if (val.hasOwnProperty('default')) {\n        // 添加新的内部属性，将原来的属性修改为 getter/setter 形式\n        // （以 _ 开头将自动设置property 为 visible: false）\n        const newKey = `_N$${propName}`;\n\n        val.get = function () {\n            return this[newKey];\n        };\n        val.set = function (value) {\n            const oldValue = this[newKey];\n            this[newKey] = value;\n            notify.call(this, oldValue);\n        };\n\n        const newValue = {};\n        properties[newKey] = newValue;\n        // 将不能用于get方法中的属性移动到newValue中\n\n        for (const attr in SerializableAttrs) {\n            const v = SerializableAttrs[attr];\n            if (val.hasOwnProperty(attr)) {\n                newValue[attr] = val[attr];\n                if (!v.canUsedInGet) {\n                    delete val[attr];\n                }\n            }\n        }\n    } else if (DEV) {\n        warnID(5501);\n    }\n}\n\nfunction parseType (val, type, className, propName) {\n    const STATIC_CHECK = (EDITOR && DEV) || TEST;\n\n    if (Array.isArray(type)) {\n        if (STATIC_CHECK && 'default' in val) {\n            if (!legacyCC.Class.isArray(val.default)) {\n                warnID(5507, className, propName);\n            }\n        }\n        if (type.length > 0) {\n            val.type = type = type[0];\n        } else {\n            return errorID(5508, className, propName);\n        }\n    }\n    if (typeof type === 'function') {\n        if (type === String) {\n            val.type = legacyCC.String;\n            if (STATIC_CHECK) {\n                warnID(3608, `\"${className}.${propName}\"`);\n            }\n        } else if (type === Boolean) {\n            val.type = legacyCC.Boolean;\n            if (STATIC_CHECK) {\n                warnID(3609, `\"${className}.${propName}\"`);\n            }\n        } else if (type === Number) {\n            val.type = legacyCC.Float;\n            if (STATIC_CHECK) {\n                warnID(3610, `\"${className}.${propName}\"`);\n            }\n        }\n    } else if (STATIC_CHECK) {\n        switch (type) {\n        case 'Number':\n            warnID(5510, className, propName);\n            break;\n        case 'String':\n            warn(`The type of \"${className}.${propName}\" must be CCString, not \"String\".`);\n            break;\n        case 'Boolean':\n            warn(`The type of \"${className}.${propName}\" must be CCBoolean, not \"Boolean\".`);\n            break;\n        case 'Float':\n            warn(`The type of \"${className}.${propName}\" must be CCFloat, not \"Float\".`);\n            break;\n        case 'Integer':\n            warn(`The type of \"${className}.${propName}\" must be CCInteger, not \"Integer\".`);\n            break;\n        case null:\n            warnID(5511, className, propName);\n            break;\n        }\n    }\n\n    if (EDITOR && typeof type === 'function') {\n        if (legacyCC.Class._isCCClass(type) && val.serializable !== false && !js.getClassId(type, false)) {\n            warnID(5512, className, propName, className, propName);\n        }\n    }\n}\n\nfunction getBaseClassWherePropertyDefined_DEV (propName, cls) {\n    if (DEV) {\n        let res;\n        for (; cls && cls.__props__ && cls.__props__.indexOf(propName) !== -1; cls = cls.$super) {\n            res = cls;\n        }\n        if (!res) {\n            error('unknown error');\n        }\n        return res;\n    }\n}\n\nfunction _wrapOptions (isGetset: boolean, _default, type?: Function | Function[]) {\n    const res: {\n        default?: any,\n        _short?: boolean,\n        type?: any,\n    } = isGetset ? { _short: true } : { _short: true, default: _default };\n    if (type) {\n        res.type = type;\n    }\n    return res;\n}\n\nexport function getFullFormOfProperty (options, isGetset) {\n    const isLiteral = options && options.constructor === Object;\n    if (!isLiteral) {\n        if (Array.isArray(options) && options.length > 0) {\n            return _wrapOptions(isGetset, [], options);\n        } else if (typeof options === 'function') {\n            const type = options;\n            return _wrapOptions(isGetset, js.isChildClassOf(type, legacyCC.ValueType) ? new type() : null, type);\n        } else if (options instanceof PrimitiveType) {\n            return _wrapOptions(isGetset, options.default);\n        } else {\n            return _wrapOptions(isGetset, options);\n        }\n    }\n    return null;\n}\n\nexport function preprocessAttrs (properties, className, cls) {\n    for (const propName in properties) {\n        let val = properties[propName];\n        const fullForm = getFullFormOfProperty(val, false);\n        if (fullForm) {\n            val = properties[propName] = fullForm;\n        }\n        if (val) {\n            if (EDITOR) {\n                if ('default' in val) {\n                    if (val.get) {\n                        errorID(5513, className, propName);\n                    } else if (val.set) {\n                        errorID(5514, className, propName);\n                    } else if (legacyCC.Class._isCCClass(val.default)) {\n                        val.default = null;\n                        errorID(5515, className, propName);\n                    }\n                }\n            }\n            if (DEV && !val.override && cls.__props__.indexOf(propName) !== -1) {\n                // check override\n                const baseClass = js.getClassName(getBaseClassWherePropertyDefined_DEV(propName, cls));\n                warnID(5517, className, propName, baseClass, propName);\n            }\n            const notify = val.notify;\n            if (notify) {\n                if (DEV) {\n                    error('not yet support notify attributes.');\n                } else {\n                    parseNotify(val, propName, notify, properties);\n                }\n            }\n\n            if ('type' in val) {\n                parseType(val, val.type, className, propName);\n            }\n        }\n    }\n}\n\nconst CALL_SUPER_DESTROY_REG_DEV = /\\b\\._super\\b|destroy.*\\.call\\s*\\(\\s*\\w+\\s*[,|)]/;\nexport function doValidateMethodWithProps_DEV (func, funcName, className, cls, base) {\n    if (cls.__props__ && cls.__props__.indexOf(funcName) >= 0) {\n        // find class that defines this method as a property\n        const baseClassName = js.getClassName(getBaseClassWherePropertyDefined_DEV(funcName, cls));\n        errorID(3648, className, funcName, baseClassName);\n        return false;\n    }\n    if (funcName === 'destroy'\n        && js.isChildClassOf(base, legacyCC.Component)\n        && !CALL_SUPER_DESTROY_REG_DEV.test(func)\n    ) {\n        error(`Overwriting '${funcName}' function in '${className}' class without calling super is not allowed. Call the super function in '${funcName}' please.`);\n    }\n}\n","/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { EDITOR } from 'internal:constants';\r\nimport { legacyCC } from '../../global-exports';\r\n\r\n/**\r\n *\r\n */\r\nlet requiringFrames: any = [];  // the requiring frame infos\r\n\r\nexport function push (module, uuid: string, script, importMeta?) {\r\n    if (script === undefined) {\r\n        script = uuid;\r\n        uuid = '';\r\n    }\r\n    requiringFrames.push({\r\n        uuid,\r\n        script,\r\n        module,\r\n        exports: module.exports,    // original exports\r\n        beh: null,\r\n        importMeta,\r\n    });\r\n}\r\n\r\nexport function pop () {\r\n    const frameInfo = requiringFrames.pop();\r\n    // check exports\r\n    const module = frameInfo.module;\r\n    let exports = module.exports;\r\n    if (exports === frameInfo.exports) {\r\n        for (const anykey in exports) {\r\n            // exported\r\n            return;\r\n        }\r\n        // auto export component\r\n        module.exports = exports = frameInfo.cls;\r\n    }\r\n}\r\n\r\nexport function peek () {\r\n    return requiringFrames[requiringFrames.length - 1];\r\n}\r\n\r\nlegacyCC._RF = {\r\n    push,\r\n    pop,\r\n    peek,\r\n};\r\n\r\nif (EDITOR) {\r\n    legacyCC._RF.reset = () => {\r\n        requiringFrames = [];\r\n    };\r\n}\r\n","import { IExposedAttributes } from './utils/attribute-defines';\n\n/**\n * Class slash stores information collected from decorators.\n * Once class decorator entered, class definition begins. It process the stash and remove it.\n */\nexport interface ClassStash {\n    /**\n     * When extract default values under TypeScript environment,\n     * we have to construct an object of current class and get its member values.\n     * This field stores the create-once object.\n     */\n    default?: unknown;\n\n    /**\n     * Just a kind of organization.\n     */\n    proto?: {\n        /**\n         * The property stashes.\n         */\n        properties?: Record<PropertyKey, PropertyStash>;\n    };\n\n    /**\n     * The error properties.\n     * We record them here to ensure only once error report is given to each property.\n     */\n    errorProps?: Record<PropertyKey, true>;\n}\n\nexport interface PropertyStash extends IExposedAttributes {\n    /**\n     * The property's default value.\n     */\n    default?: unknown;\n\n    /**\n     * The property's getter, if it's an accessor.\n     */\n    get?: () => unknown;\n\n    /**\n     * The property's setter, if it's an accessor.\n     */\n    set?: (value: unknown) => void;\n\n    /**\n     * Reserved for deprecated usage.\n     */\n    _short?: unknown;\n\n    /**\n     * Some decorators may write this internal slot. See `PropertyStashInternalFlag`.\n     */\n    __internalFlags: number;\n}\n\nexport enum PropertyStashInternalFlag {\n    /**\n     * Indicates this property is reflected using \"standalone property decorators\" such as\n     * `@editable`, `@visible`, `serializable`.\n     * All standalone property decorators would set this flag;\n     * non standalone property decorators won't set this flag.\n     */\n    STANDALONE = 1 << 0,\n\n    /**\n     * Indicates this property is visible, if no other explicit visibility decorators(`@visible`s) attached.\n     */\n    IMPLICIT_VISIBLE = 1 << 1,\n\n    /**\n     * Indicates this property is serializable, if no other explicit visibility decorators(`@serializable`s) attached.\n     */\n    IMPLICIT_SERIALIZABLE = 1 << 2,\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { DEV, EDITOR, SUPPORT_JIT, TEST } from 'internal:constants';\nimport { errorID, warnID, error } from '../platform/debug';\nimport * as js from '../utils/js';\nimport { getSuper } from '../utils/js';\nimport { BitMask } from '../value-types';\nimport { Enum } from '../value-types/enum';\nimport * as attributeUtils from './utils/attribute';\nimport { IAcceptableAttributes } from './utils/attribute-defines';\nimport { preprocessAttrs } from './utils/preprocess-class';\nimport * as RF from './utils/requiring-frame';\n\nimport { legacyCC } from '../global-exports';\nimport { PropertyStash, PropertyStashInternalFlag } from './class-stash';\n\nconst DELIMETER = attributeUtils.DELIMETER;\nconst CCCLASS_TAG = '__ctors__'; // Still use this historical name to avoid unsynchronized version issue\nexport const ENUM_TAG = 'Enum';\nexport const BITMASK_TAG = 'BitMask';\n\nfunction pushUnique (array, item) {\n    if (array.indexOf(item) < 0) {\n        array.push(item);\n    }\n}\n\n// both getter and prop must register the name into __props__ array\nfunction appendProp (cls, name) {\n    if (DEV) {\n        // if (!IDENTIFIER_RE.test(name)) {\n        //    error('The property name \"' + name + '\" is not compliant with JavaScript naming standards');\n        //    return;\n        // }\n        if (name.indexOf('.') !== -1) {\n            errorID(3634);\n            return;\n        }\n    }\n    pushUnique(cls.__props__, name);\n}\n\nfunction defineProp (cls, className, propName, val) {\n    if (DEV) {\n        // check base prototype to avoid name collision\n        if (CCClass.getInheritanceChain(cls)\n            .some((x) => x.prototype.hasOwnProperty(propName))) {\n            errorID(3637, className, propName, className);\n            return;\n        }\n    }\n\n    appendProp(cls, propName);\n\n    // apply attributes\n    parseAttributes(cls, val, className, propName, false);\n    if ((EDITOR && !window.Build) || TEST) {\n        for (let i = 0; i < onAfterProps_ET.length; i++) {\n            onAfterProps_ET[i](cls, propName);\n        }\n        onAfterProps_ET.length = 0;\n    }\n}\n\nfunction defineGetSet (cls, name, propName, val) {\n    const getter = val.get;\n    const setter = val.set;\n\n    if (getter) {\n        parseAttributes(cls, val, name, propName, true);\n        if ((EDITOR && !window.Build) || TEST) {\n            onAfterProps_ET.length = 0;\n        }\n\n        attributeUtils.setClassAttr(cls, propName, 'serializable', false);\n\n        if (DEV) {\n            // 不论是否 visible 都要添加到 props，否则 asset watcher 不能正常工作\n            appendProp(cls, propName);\n        }\n\n        if (EDITOR || DEV) {\n            attributeUtils.setClassAttr(cls, propName, 'hasGetter', true); // 方便 editor 做判断\n        }\n    }\n\n    if (setter) {\n        if (EDITOR || DEV) {\n            attributeUtils.setClassAttr(cls, propName, 'hasSetter', true); // 方便 editor 做判断\n        }\n    }\n}\n\nfunction getDefault (defaultVal) {\n    if (typeof defaultVal === 'function') {\n        if (EDITOR) {\n            try {\n                return defaultVal();\n            } catch (e) {\n                legacyCC._throw(e);\n                return undefined;\n            }\n        } else {\n            return defaultVal();\n        }\n    }\n    return defaultVal;\n}\n\nfunction doDefine (className, baseClass, options) {\n    const ctor = options.ctor;\n\n    if (DEV) {\n        // check ctor\n        if (CCClass._isCCClass(ctor)) {\n            errorID(3618, className);\n        }\n    }\n\n    js.value(ctor, CCCLASS_TAG, true, true);\n\n    const prototype = ctor.prototype;\n    if (baseClass) {\n        ctor.$super = baseClass;\n    }\n\n    js.setClassName(className, ctor);\n    return ctor;\n}\n\nfunction define (className, baseClass, options) {\n    const Component = legacyCC.Component;\n    const frame = RF.peek();\n\n    if (frame && js.isChildClassOf(baseClass, Component)) {\n        // project component\n        if (js.isChildClassOf(frame.cls, Component)) {\n            errorID(3615);\n            return null;\n        }\n        if (DEV && frame.uuid && className) {\n            // warnID(3616, className);\n        }\n        className = className || frame.script;\n    }\n\n    const cls = doDefine(className, baseClass, options);\n\n    if (EDITOR) {\n        // for RenderPipeline, RenderFlow, RenderStage\n        const isRenderPipeline = js.isChildClassOf(baseClass, legacyCC.RenderPipeline);\n        const isRenderFlow = js.isChildClassOf(baseClass, legacyCC.RenderFlow);\n        const isRenderStage = js.isChildClassOf(baseClass, legacyCC.RenderStage);\n        const isRender = isRenderPipeline || isRenderFlow || isRenderStage;\n        if (isRender) {\n            let renderName = '';\n            if (isRenderPipeline) {\n                renderName = 'render_pipeline';\n            } else if (isRenderFlow) {\n                renderName = 'render_flow';\n            } else if (isRenderStage) {\n                renderName = 'render_stage';\n            }\n            // 增加了 hidden: 开头标识，使它最终不会显示在 Editor inspector 的添加组件列表里\n\n            window.EditorExtends && window.EditorExtends.Component.addMenu(cls, `hidden:${renderName}/${className}`, -1);\n        }\n\n        // Note: `options.ctor` should be same as `cls` except if\n        // cc-class is defined by `cc.Class({/* ... */})`.\n        // In such case, `options.ctor` may be `undefined`.\n        // So we can not use `options.ctor`. Instead we should use `cls` which is the \"real\" registered cc-class.\n        EditorExtends.emit('class-registered', cls, frame, className);\n    }\n\n    if (frame) {\n        // 基础的 ts, js 脚本组件\n        if (js.isChildClassOf(baseClass, Component)) {\n            const uuid = frame.uuid;\n            if (uuid) {\n                js._setClassId(uuid, cls);\n                if (EDITOR) {\n                    cls.prototype.__scriptUuid = EditorExtends.UuidUtils.decompressUuid(uuid);\n                }\n            }\n            frame.cls = cls;\n        } else if (!js.isChildClassOf(frame.cls, Component)) {\n            frame.cls = cls;\n        }\n    }\n    return cls;\n}\n\nfunction getNewValueTypeCodeJit (value) {\n    const clsName = js.getClassName(value);\n    const type = value.constructor;\n    let res = `new ${clsName}(`;\n    for (let i = 0; i < type.__props__.length; i++) {\n        const prop = type.__props__[i];\n        const propVal = value[prop];\n        if (DEV && typeof propVal === 'object') {\n            errorID(3641, clsName);\n            return `new ${clsName}()`;\n        }\n        res += propVal;\n        if (i < type.__props__.length - 1) {\n            res += ',';\n        }\n    }\n    return `${res})`;\n}\n\n// TODO - move escapeForJS, IDENTIFIER_RE, getNewValueTypeCodeJit to misc.js or a new source file\n\n// convert a normal string including newlines, quotes and unicode characters into a string literal\n// ready to use in JavaScript source\nfunction escapeForJS (s) {\n    return JSON.stringify(s)\n        // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify\n        .replace(/\\u2028/g, '\\\\u2028')\n        .replace(/\\u2029/g, '\\\\u2029');\n}\n\n// simple test variable name\nconst IDENTIFIER_RE = /^[A-Za-z_$][0-9A-Za-z_$]*$/;\n\nfunction declareProperties (cls, className, properties, baseClass) {\n    cls.__props__ = [];\n\n    if (baseClass && baseClass.__props__) {\n        cls.__props__ = baseClass.__props__.slice();\n    }\n\n    if (properties) {\n        // 预处理属性\n        preprocessAttrs(properties, className, cls);\n\n        for (const propName in properties) {\n            const val = properties[propName];\n            if (!val.get && !val.set) {\n                defineProp(cls, className, propName, val);\n            } else {\n                defineGetSet(cls, className, propName, val);\n            }\n        }\n    }\n\n    const attrs = attributeUtils.getClassAttrs(cls);\n    cls.__values__ = cls.__props__.filter((prop) => attrs[`${prop + DELIMETER}serializable`] !== false);\n}\n\nexport function CCClass<TFunction> (options: {\n    name?: string;\n    extends: null | (Function & { __props__?: any; _sealed?: boolean });\n    ctor: TFunction;\n    properties?: any;\n    editor?: any;\n}) {\n    let name = options.name;\n    const base = options.extends/* || CCObject */;\n\n    // create constructor\n    const cls = define(name, base, options);\n    if (!name) {\n        name = legacyCC.js.getClassName(cls);\n    }\n\n    cls._sealed = true;\n    if (base) {\n        base._sealed = false;\n    }\n\n    // define Properties\n    const properties = options.properties;\n    declareProperties(cls, name, properties, base);\n\n    const editor = options.editor;\n    if (editor) {\n        if (js.isChildClassOf(base, legacyCC.Component)) {\n            legacyCC.Component._registerEditorProps(cls, editor);\n        } else if (DEV) {\n            warnID(3623, name);\n        }\n    }\n\n    return cls;\n}\n\n/**\n * @en\n * Checks whether the constructor is initialized by `@ccclass`.\n * @zh\n * 检查构造函数是否经由 `@ccclass` 初始化。\n * @method _isCCClass\n * @param {Function} constructor\n * @return {Boolean}\n * @private\n */\nCCClass._isCCClass = function isCCClass (constructor): boolean {\n    // Does not support fastDefined class (ValueType).\n    // Use `instanceof ValueType` if necessary.\n    // eslint-disable-next-line no-prototype-builtins, @typescript-eslint/no-unsafe-return\n    return constructor?.hasOwnProperty?.(CCCLASS_TAG);     // Remember, the static variable is not inheritable\n};\n\n//\n// Optimized define function only for internal classes\n//\n// @method fastDefine\n// @param {String} className\n// @param {Function} constructor\n// @param {Object} serializableFields\n// @private\n//\nCCClass.fastDefine = function (className, constructor, serializableFields) {\n    js.setClassName(className, constructor);\n    const props = constructor.__props__ = constructor.__values__ = Object.keys(serializableFields);\n    const attrs = attributeUtils.getClassAttrs(constructor);\n    for (let i = 0; i < props.length; i++) {\n        const key = props[i];\n        attrs[`${key + DELIMETER}visible`] = false;\n        attrs[`${key + DELIMETER}default`] = serializableFields[key];\n    }\n};\n\nCCClass.Attr = attributeUtils;\nCCClass.attr = attributeUtils.attr;\n\n/**\n * Returns if the class is a cc-class or is fast defined.\n * @param constructor The constructor of the class.\n * @returns Judge result.\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isCCClassOrFastDefined<T> (constructor: Constructor<T>) {\n    // eslint-disable-next-line no-prototype-builtins, @typescript-eslint/no-unsafe-return\n    return  constructor?.hasOwnProperty?.('__values__');\n}\n\nCCClass.isCCClassOrFastDefined = isCCClassOrFastDefined;\n\n/**\n * Return all super classes.\n * @param constructor The Constructor.\n */\nfunction getInheritanceChain (constructor) {\n    const chain: any[] = [];\n    for (; ;) {\n        constructor = getSuper(constructor);\n        if (!constructor) {\n            break;\n        }\n        if (constructor !== Object) {\n            chain.push(constructor);\n        }\n    }\n    return chain;\n}\n\nCCClass.getInheritanceChain = getInheritanceChain;\n\nconst PrimitiveTypes = {\n    // Specify that the input value must be integer in Properties.\n    // Also used to indicates that the type of elements in array or the type of value in dictionary is integer.\n    Integer: 'Number',\n    // Indicates that the type of elements in array or the type of value in dictionary is double.\n    Float: 'Number',\n    Boolean: 'Boolean',\n    String: 'String',\n};\n\ninterface IParsedAttribute extends IAcceptableAttributes {\n    ctor?: Function;\n    enumList?: readonly any[];\n    bitmaskList?: any[];\n}\ntype OnAfterProp = (constructor: Function, mainPropertyName: string) => void;\nconst onAfterProps_ET: OnAfterProp[] = [];\n\ninterface AttributesRecord {\n    get?: unknown;\n    set?: unknown;\n    default?: unknown;\n}\n\nfunction parseAttributes (constructor: Function, attributes: PropertyStash, className: string, propertyName: string, usedInGetter) {\n    const ERR_Type = DEV ? 'The %s of %s must be type %s' : '';\n\n    let attrs: IParsedAttribute | null = null;\n    let propertyNamePrefix = '';\n    function initAttrs () {\n        propertyNamePrefix = propertyName + DELIMETER;\n        return attrs = attributeUtils.getClassAttrs(constructor);\n    }\n\n    if ((EDITOR && !window.Build) || TEST) {\n        onAfterProps_ET.length = 0;\n    }\n\n    if ('type' in attributes && typeof attributes.type === 'undefined') {\n        warnID(3660, propertyName, className);\n    }\n\n    let warnOnNoDefault = true;\n\n    const type = attributes.type;\n    if (type) {\n        const primitiveType = PrimitiveTypes[type];\n        if (primitiveType) {\n            (attrs || initAttrs())[`${propertyNamePrefix}type`] = type;\n            if (((EDITOR && !window.Build) || TEST) && !attributes._short) {\n                onAfterProps_ET.push(attributeUtils.getTypeChecker_ET(primitiveType, `cc.${type}`));\n            }\n        } else if (type === 'Object') {\n            if (DEV) {\n                errorID(3644, className, propertyName);\n            }\n        }\n        // else if (type === Attr.ScriptUuid) {\n        //     (attrs || initAttrs())[propertyNamePrefix + 'type'] = 'Script';\n        //     attrs[propertyNamePrefix + 'ctor'] = cc.ScriptAsset;\n        // }\n        else if (typeof type === 'object') {\n            if (Enum.isEnum(type)) {\n                (attrs || initAttrs())[`${propertyNamePrefix}type`] = ENUM_TAG;\n                attrs![`${propertyNamePrefix}enumList`] = Enum.getList(type);\n            } else if (BitMask.isBitMask(type)) {\n                (attrs || initAttrs())[`${propertyNamePrefix}type`] = BITMASK_TAG;\n                attrs![`${propertyNamePrefix}bitmaskList`] = BitMask.getList(type);\n            } else if (DEV) {\n                errorID(3645, className, propertyName, type);\n            }\n        } else if (typeof type === 'function') {\n            // Do not warn missing-default if the type is object\n            warnOnNoDefault = false;\n            (attrs || initAttrs())[`${propertyNamePrefix}type`] = 'Object';\n            attrs![`${propertyNamePrefix}ctor`] = type;\n            if (((EDITOR && !window.Build) || TEST) && !attributes._short) {\n                onAfterProps_ET.push(attributeUtils.getObjTypeChecker_ET(type));\n            }\n        } else if (DEV) {\n            errorID(3646, className, propertyName, type);\n        }\n    }\n\n    if ('default' in attributes) {\n        (attrs || initAttrs())[`${propertyNamePrefix}default`] = attributes.default;\n    } else if (((EDITOR && !window.Build) || TEST) && warnOnNoDefault && !(attributes.get || attributes.set)) {\n        warnID(3654, className, propertyName);\n    }\n\n    const parseSimpleAttribute = (attributeName: keyof IAcceptableAttributes, expectType: string) => {\n        if (attributeName in attributes) {\n            const val = attributes[attributeName];\n            if (typeof val === expectType) {\n                (attrs || initAttrs())[propertyNamePrefix + attributeName] = val;\n            } else if (DEV) {\n                error(ERR_Type, attributeName, className, propertyName, expectType);\n            }\n        }\n    };\n\n    if (attributes.editorOnly) {\n        if (DEV && usedInGetter) {\n            errorID(3613, 'editorOnly', className, propertyName);\n        } else {\n            (attrs || initAttrs())[`${propertyNamePrefix}editorOnly`] = true;\n        }\n    }\n    // parseSimpleAttr('preventDeferredLoad', 'boolean');\n    if (DEV) {\n        parseSimpleAttribute('displayName', 'string');\n        parseSimpleAttribute('displayOrder', 'number');\n        parseSimpleAttribute('multiline', 'boolean');\n        parseSimpleAttribute('radian', 'boolean');\n        if (attributes.readonly) {\n            (attrs || initAttrs())[`${propertyNamePrefix}readonly`] = attributes.readonly;\n        }\n        parseSimpleAttribute('tooltip', 'string');\n        if (attributes.group) {\n            (attrs || initAttrs())[`${propertyNamePrefix}group`] = attributes.group;\n        }\n        parseSimpleAttribute('slide', 'boolean');\n        parseSimpleAttribute('unit', 'string');\n    }\n\n    const isStandaloneMode = attributes.__internalFlags & PropertyStashInternalFlag.STANDALONE;\n\n    let normalizedSerializable: undefined | boolean;\n    if (isStandaloneMode) {\n        normalizedSerializable = attributes.serializable === true\n            || (attributes.__internalFlags & PropertyStashInternalFlag.IMPLICIT_SERIALIZABLE) !== 0;\n    } else if (attributes.serializable === false) {\n        normalizedSerializable = false;\n        if (DEV && usedInGetter) {\n            errorID(3613, 'serializable', className, propertyName);\n        }\n    }\n    if (typeof normalizedSerializable !== 'undefined') {\n        (attrs || initAttrs())[`${propertyNamePrefix}serializable`] = normalizedSerializable;\n    }\n\n    parseSimpleAttribute('formerlySerializedAs', 'string');\n\n    if (DEV) {\n        if ('animatable' in attributes) {\n            (attrs || initAttrs())[`${propertyNamePrefix}animatable`] = attributes.animatable;\n        }\n    }\n\n    if (DEV) {\n        const visible = attributes.visible;\n\n        let normalizedVisible: undefined | boolean | (() => boolean);\n        switch (typeof visible) {\n        case 'boolean':\n        case 'function':\n            normalizedVisible = visible;\n            break;\n        default: {\n            if (isStandaloneMode) {\n                normalizedVisible = (attributes.__internalFlags & PropertyStashInternalFlag.IMPLICIT_VISIBLE) !== 0;\n            } else {\n                const startsWithUS = (propertyName.charCodeAt(0) === 95);\n                if (startsWithUS) {\n                    normalizedVisible = false;\n                }\n            }\n        }\n        }\n\n        if (typeof normalizedVisible !== 'undefined') {\n            (attrs || initAttrs())[`${propertyNamePrefix}visible`] = normalizedVisible;\n        }\n    }\n\n    const range = attributes.range;\n    if (range) {\n        if (Array.isArray(range)) {\n            if (range.length >= 2) {\n                (attrs || initAttrs())[`${propertyNamePrefix}min`] = range[0];\n                attrs![`${propertyNamePrefix}max`] = range[1];\n                if (range.length > 2) {\n                    attrs![`${propertyNamePrefix}step`] = range[2];\n                }\n            } else if (DEV) {\n                errorID(3647);\n            }\n        } else if (DEV) {\n            error(ERR_Type, 'range', className, propertyName, 'array');\n        }\n    }\n    parseSimpleAttribute('min', 'number');\n    parseSimpleAttribute('max', 'number');\n    parseSimpleAttribute('step', 'number');\n}\n\nCCClass.isArray = function (defaultVal) {\n    defaultVal = getDefault(defaultVal);\n    return Array.isArray(defaultVal);\n};\n\nCCClass.getDefault = getDefault;\nCCClass.escapeForJS = escapeForJS;\nCCClass.IDENTIFIER_RE = IDENTIFIER_RE;\nCCClass.getNewValueTypeCode = (SUPPORT_JIT && getNewValueTypeCodeJit) as ((value: any) => string);\n\nlegacyCC.Class = CCClass;\n","/*\n Copyright (c) 2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Mat4 } from './mat4';\nimport { IMat4Like, IQuatLike, IVec4Like } from './type-define';\nimport { clamp, EPSILON, random } from './utils';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Representation of four-dimensional vectors.\n * @zh 四维向量。\n */\nexport class Vec4 extends ValueType {\n    public static ZERO = Object.freeze(new Vec4(0, 0, 0, 0));\n    public static ONE = Object.freeze(new Vec4(1, 1, 1, 1));\n    public static NEG_ONE = Object.freeze(new Vec4(-1, -1, -1, -1));\n\n    /**\n     * @en Obtains a clone of the given vector object\n     * @zh 获得指定向量的拷贝\n     */\n    public static clone <Out extends IVec4Like> (a: Out) {\n        return new Vec4(a.x, a.y, a.z, a.w);\n    }\n\n    /**\n     * @en Copy the target vector and save the results to out vector object\n     * @zh 复制目标向量\n     */\n    public static copy <Out extends IVec4Like> (out: Out, a: Out) {\n        out.x = a.x;\n        out.y = a.y;\n        out.z = a.z;\n        out.w = a.w;\n        return out;\n    }\n\n    /**\n     * @en Sets the out vector with the given x, y, z and w values\n     * @zh 设置向量值\n     */\n    public static set <Out extends IVec4Like> (out: Out, x: number, y: number, z: number, w: number) {\n        out.x = x;\n        out.y = y;\n        out.z = z;\n        out.w = w;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector addition and save the results to out vector object\n     * @zh 逐元素向量加法\n     */\n    public static add <Out extends IVec4Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x + b.x;\n        out.y = a.y + b.y;\n        out.z = a.z + b.z;\n        out.w = a.w + b.w;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector subtraction and save the results to out vector object\n     * @zh 逐元素向量减法\n     */\n    public static subtract <Out extends IVec4Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x - b.x;\n        out.y = a.y - b.y;\n        out.z = a.z - b.z;\n        out.w = a.w - b.w;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector multiplication and save the results to out vector object\n     * @zh 逐元素向量乘法\n     */\n    public static multiply <Out extends IVec4Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x * b.x;\n        out.y = a.y * b.y;\n        out.z = a.z * b.z;\n        out.w = a.w * b.w;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector division and save the results to out vector object\n     * @zh 逐元素向量除法\n     */\n    public static divide <Out extends IVec4Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x / b.x;\n        out.y = a.y / b.y;\n        out.z = a.z / b.z;\n        out.w = a.w / b.w;\n        return out;\n    }\n\n    /**\n     * @en Rounds up by elements of the vector and save the results to out vector object\n     * @zh 逐元素向量向上取整\n     */\n    public static ceil <Out extends IVec4Like> (out: Out, a: Out) {\n        out.x = Math.ceil(a.x);\n        out.y = Math.ceil(a.y);\n        out.z = Math.ceil(a.z);\n        out.w = Math.ceil(a.w);\n        return out;\n    }\n\n    /**\n     * @en Element-wise rounds down of the current vector and save the results to the out vector\n     * @zh 逐元素向量向下取整\n     */\n    public static floor <Out extends IVec4Like> (out: Out, a: Out) {\n        out.x = Math.floor(a.x);\n        out.y = Math.floor(a.y);\n        out.z = Math.floor(a.z);\n        out.w = Math.floor(a.w);\n        return out;\n    }\n\n    /**\n     * @en Calculates the minimum values by elements of the vector and save the results to the out vector\n     * @zh 逐元素向量最小值\n     */\n    public static min <Out extends IVec4Like> (out: Out, a: Out, b: Out) {\n        out.x = Math.min(a.x, b.x);\n        out.y = Math.min(a.y, b.y);\n        out.z = Math.min(a.z, b.z);\n        out.w = Math.min(a.w, b.w);\n        return out;\n    }\n\n    /**\n     * @en Calculates the maximum values by elements of the vector and save the results to the out vector\n     * @zh 逐元素向量最大值\n     */\n    public static max <Out extends IVec4Like> (out: Out, a: Out, b: Out) {\n        out.x = Math.max(a.x, b.x);\n        out.y = Math.max(a.y, b.y);\n        out.z = Math.max(a.z, b.z);\n        out.w = Math.max(a.w, b.w);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise round results and save to the out vector\n     * @zh 逐元素向量四舍五入取整\n     */\n    public static round <Out extends IVec4Like> (out: Out, a: Out) {\n        out.x = Math.round(a.x);\n        out.y = Math.round(a.y);\n        out.z = Math.round(a.z);\n        out.w = Math.round(a.w);\n        return out;\n    }\n\n    /**\n     * @en Vector scalar multiplication and save the results to out vector object\n     * @zh 向量标量乘法\n     */\n    public static multiplyScalar <Out extends IVec4Like> (out: Out, a: Out, b: number) {\n        out.x = a.x * b;\n        out.y = a.y * b;\n        out.z = a.z * b;\n        out.w = a.w * b;\n        return out;\n    }\n\n    /**\n     * @en Element-wise multiplication and addition with the equation: a + b * scale\n     * @zh 逐元素向量乘加: A + B * scale\n     */\n    public static scaleAndAdd <Out extends IVec4Like> (out: Out, a: Out, b: Out, scale: number) {\n        out.x = a.x + (b.x * scale);\n        out.y = a.y + (b.y * scale);\n        out.z = a.z + (b.z * scale);\n        out.w = a.w + (b.w * scale);\n        return out;\n    }\n\n    /**\n     * @en Calculates the euclidean distance of two vectors\n     * @zh 求两向量的欧氏距离\n     */\n    public static distance <Out extends IVec4Like> (a: Out, b: Out) {\n        const x = b.x - a.x;\n        const y = b.y - a.y;\n        const z = b.z - a.z;\n        const w = b.w - a.w;\n        return Math.sqrt(x * x + y * y + z * z + w * w);\n    }\n\n    /**\n     * @en Calculates the squared euclidean distance of two vectors\n     * @zh 求两向量的欧氏距离平方\n     */\n    public static squaredDistance <Out extends IVec4Like> (a: Out, b: Out) {\n        const x = b.x - a.x;\n        const y = b.y - a.y;\n        const z = b.z - a.z;\n        const w = b.w - a.w;\n        return x * x + y * y + z * z + w * w;\n    }\n\n    /**\n     * @en Calculates the length of the vector\n     * @zh 求向量长度\n     */\n    public static len <Out extends IVec4Like> (a: Out) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        const w = a.w;\n        return Math.sqrt(x * x + y * y + z * z + w * w);\n    }\n\n    /**\n     * @en Calculates the squared length of the vector\n     * @zh 求向量长度平方\n     */\n    public static lengthSqr <Out extends IVec4Like> (a: Out) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        const w = a.w;\n        return x * x + y * y + z * z + w * w;\n    }\n\n    /**\n     * @en Sets each element to its negative value\n     * @zh 逐元素向量取负\n     */\n    public static negate <Out extends IVec4Like> (out: Out, a: Out) {\n        out.x = -a.x;\n        out.y = -a.y;\n        out.z = -a.z;\n        out.w = -a.w;\n        return out;\n    }\n\n    /**\n     * @en Sets each element to its inverse value, zero value will become Infinity\n     * @zh 逐元素向量取倒数，接近 0 时返回 Infinity\n     */\n    public static inverse <Out extends IVec4Like> (out: Out, a: Out) {\n        out.x = 1.0 / a.x;\n        out.y = 1.0 / a.y;\n        out.z = 1.0 / a.z;\n        out.w = 1.0 / a.w;\n        return out;\n    }\n\n    /**\n     * @en Sets each element to its inverse value, zero value will remain zero\n     * @zh 逐元素向量取倒数，接近 0 时返回 0\n     */\n    public static inverseSafe <Out extends IVec4Like> (out: Out, a: Out) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        const w = a.w;\n\n        if (Math.abs(x) < EPSILON) {\n            out.x = 0;\n        } else {\n            out.x = 1.0 / x;\n        }\n\n        if (Math.abs(y) < EPSILON) {\n            out.y = 0;\n        } else {\n            out.y = 1.0 / y;\n        }\n\n        if (Math.abs(z) < EPSILON) {\n            out.z = 0;\n        } else {\n            out.z = 1.0 / z;\n        }\n\n        if (Math.abs(w) < EPSILON) {\n            out.w = 0;\n        } else {\n            out.w = 1.0 / w;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Sets the normalized vector to the out vector\n     * @zh 归一化向量\n     */\n    public static normalize <Out extends IVec4Like> (out: Out, a: Out) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        const w = a.w;\n        let len = x * x + y * y + z * z + w * w;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            out.x = x * len;\n            out.y = y * len;\n            out.z = z * len;\n            out.w = w * len;\n        }\n        return out;\n    }\n\n    /**\n     * @en Calculates the dot product of the vector\n     * @zh 向量点积（数量积）\n     */\n    public static dot <Out extends IVec4Like> (a: Out, b: Out) {\n        return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n    }\n\n    /**\n     * @en Calculates the linear interpolation between two vectors with a given ratio\n     * @zh 逐元素向量线性插值： A + t * (B - A)\n     */\n    public static lerp <Out extends IVec4Like> (out: Out, a: Out, b: Out, t: number) {\n        out.x = a.x + t * (b.x - a.x);\n        out.y = a.y + t * (b.y - a.y);\n        out.z = a.z + t * (b.z - a.z);\n        out.w = a.w + t * (b.w - a.w);\n        return out;\n    }\n\n    /**\n     * @en Generates a uniformly distributed random vector points from center to the surface of the unit sphere\n     * @zh 生成一个在单位球体上均匀分布的随机向量\n     * @param scale vector length\n     */\n    public static random <Out extends IVec4Like> (out: Out, scale?: number) {\n        scale = scale || 1.0;\n\n        const phi = random() * 2.0 * Math.PI;\n        const cosTheta = random() * 2 - 1;\n        const sinTheta = Math.sqrt(1 - cosTheta * cosTheta);\n\n        out.x = sinTheta * Math.cos(phi) * scale;\n        out.y = sinTheta * Math.sin(phi) * scale;\n        out.z = cosTheta * scale;\n        out.w = 0;\n        return out;\n    }\n\n    /**\n     * @en Vector and fourth order matrix multiplication\n     * @zh 向量与四维矩阵乘法\n     */\n    public static transformMat4 <Out extends IVec4Like, MatLike extends IMat4Like> (out: Out, a: Out, m: MatLike) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        const w = a.w;\n        out.x = m.m00 * x + m.m04 * y + m.m08 * z + m.m12 * w;\n        out.y = m.m01 * x + m.m05 * y + m.m09 * z + m.m13 * w;\n        out.z = m.m02 * x + m.m06 * y + m.m10 * z + m.m14 * w;\n        out.w = m.m03 * x + m.m07 * y + m.m11 * z + m.m15 * w;\n        return out;\n    }\n\n    /**\n     * @en Transform the vector with the given affine transformation\n     * @zh 向量仿射变换\n     */\n    public static transformAffine<Out extends IVec4Like, VecLike extends IVec4Like, MatLike extends IMat4Like>\n    (out: Out, v: VecLike, m: MatLike) {\n        const x = v.x;\n        const y = v.y;\n        const z = v.z;\n        const w = v.w;\n        out.x = m.m00 * x + m.m04 * y + m.m08 * z + m.m12 * w;\n        out.y = m.m01 * x + m.m05 * y + m.m09 * z + m.m13 * w;\n        out.z = m.m02 * x + m.m06 * y + m.m10 * z + m.m14 * w;\n        out.w = v.w;\n        return out;\n    }\n\n    /**\n     * @en Vector quaternion multiplication\n     * @zh 向量四元数乘法\n     */\n    public static transformQuat <Out extends IVec4Like, QuatLike extends IQuatLike> (out: Out, a: Out, q: QuatLike) {\n        const { x, y, z } = a;\n\n        const _x = q.x;\n        const _y = q.y;\n        const _z = q.z;\n        const _w = q.w;\n\n        // calculate quat * vec\n        const ix = _w * x + _y * z - _z * y;\n        const iy = _w * y + _z * x - _x * z;\n        const iz = _w * z + _x * y - _y * x;\n        const iw = -_x * x - _y * y - _z * z;\n\n        // calculate result * inverse quat\n        out.x = ix * _w + iw * -_x + iy * -_z - iz * -_y;\n        out.y = iy * _w + iw * -_y + iz * -_x - ix * -_z;\n        out.z = iz * _w + iw * -_z + ix * -_y - iy * -_x;\n        out.w = a.w;\n        return out;\n    }\n\n    /**\n     * @en Converts the given vector to an array\n     * @zh 向量转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray <Out extends IWritableArrayLike<number>> (out: Out, v: IVec4Like, ofs = 0) {\n        out[ofs + 0] = v.x;\n        out[ofs + 1] = v.y;\n        out[ofs + 2] = v.z;\n        out[ofs + 3] = v.w;\n        return out;\n    }\n\n    /**\n     * @en Converts the given array to a vector\n     * @zh 数组转向量\n     * @param ofs Array Start Offset\n     */\n    public static fromArray <Out extends IVec4Like> (out: Out, arr: IWritableArrayLike<number>, ofs = 0) {\n        out.x = arr[ofs + 0];\n        out.y = arr[ofs + 1];\n        out.z = arr[ofs + 2];\n        out.w = arr[ofs + 3];\n        return out;\n    }\n\n    /**\n     * @en Check the equality of the two given vectors\n     * @zh 向量等价判断\n     */\n    public static strictEquals <Out extends IVec4Like> (a: Out, b: Out) {\n        return a.x === b.x && a.y === b.y && a.z === b.z && a.w === b.w;\n    }\n\n    /**\n     * @en Check whether the two given vectors are approximately equivalent\n     * @zh 排除浮点数误差的向量近似等价判断\n     */\n    public static equals <Out extends IVec4Like> (a: Out, b: Out, epsilon = EPSILON) {\n        return (Math.abs(a.x - b.x) <= epsilon * Math.max(1.0, Math.abs(a.x), Math.abs(b.x))\n            && Math.abs(a.y - b.y) <= epsilon * Math.max(1.0, Math.abs(a.y), Math.abs(b.y))\n            && Math.abs(a.z - b.z) <= epsilon * Math.max(1.0, Math.abs(a.z), Math.abs(b.z))\n            && Math.abs(a.w - b.w) <= epsilon * Math.max(1.0, Math.abs(a.w), Math.abs(b.w)));\n    }\n\n    /**\n     * @en x component.\n     * @zh x 分量。\n     */\n    public declare x: number;\n\n    /**\n     * @en y component.\n     * @zh y 分量。\n     */\n    public declare y: number;\n\n    /**\n     * @en z component.\n     * @zh z 分量。\n     */\n    public declare z: number;\n\n    /**\n     * @en w component.\n     * @zh w 分量。\n     */\n    public declare w: number;\n\n    constructor (other: Vec4);\n\n    constructor (x?: number, y?: number, z?: number, w?: number);\n\n    constructor (x?: number | Vec4, y?: number, z?: number, w?: number) {\n        super();\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n            this.w = x.w;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n            this.w = w || 0;\n        }\n    }\n\n    /**\n     * @en clone the current Vec4 value.\n     * @zh 克隆当前向量。\n     */\n    public clone () {\n        return new Vec4(this.x, this.y, this.z, this.w);\n    }\n\n    /**\n     * @en Set the current vector value with the given vector.\n     * @zh 设置当前向量使其与指定向量相等。\n     * @param other Specified vector\n     * @returns `this`\n     */\n    public set (other: Vec4): Vec4;\n\n    /**\n     * @en Set the value of each component of the current vector.\n     * @zh 设置当前向量的具体分量值。\n     * @param x x value\n     * @param y y value\n     * @param z z value\n     * @param w w value\n     * @returns `this`\n     */\n    public set (x?: number, y?: number, z?: number, w?: number): Vec4;\n\n    public set (x?: number | Vec4, y?: number, z?: number, w?: number) {\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n            this.w = x.w;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n            this.w = w || 0;\n        }\n        return this;\n    }\n\n    /**\n     * @en Check whether the vector approximately equals another one.\n     * @zh 判断当前向量是否在误差范围内与指定向量相等。\n     * @param other Specified vector\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public equals (other: Vec4, epsilon = EPSILON) {\n        return (Math.abs(this.x - other.x) <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(other.x))\n            && Math.abs(this.y - other.y) <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(other.y))\n            && Math.abs(this.z - other.z) <= epsilon * Math.max(1.0, Math.abs(this.z), Math.abs(other.z))\n            && Math.abs(this.w - other.w) <= epsilon * Math.max(1.0, Math.abs(this.w), Math.abs(other.w)));\n    }\n\n    /**\n     * @en Check whether the vector approximately equals another one.\n     * @zh 判断当前向量是否在误差范围内与指定分量的向量相等。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param w The w value of specified vector\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public equals4f (x: number, y: number, z: number, w: number, epsilon = EPSILON) {\n        return (Math.abs(this.x - x) <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(x))\n            && Math.abs(this.y - y) <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(y))\n            && Math.abs(this.z - z) <= epsilon * Math.max(1.0, Math.abs(this.z), Math.abs(z))\n            && Math.abs(this.w - w) <= epsilon * Math.max(1.0, Math.abs(this.w), Math.abs(w)));\n    }\n\n    /**\n     * @en Check whether the current vector strictly equals another Vec4.\n     * @zh 判断当前向量是否与指定向量相等。\n     * @param other specified vector\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public strictEquals (other: Vec4) {\n        return this.x === other.x && this.y === other.y && this.z === other.z && this.w === other.w;\n    }\n\n    /**\n     * @en Check whether the current vector strictly equals another Vec4.\n     * @zh 判断当前向量是否与指定分量的向量相等。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param w The w value of specified vector\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public strictEquals4f (x: number, y: number, z: number, w: number) {\n        return this.x === x && this.y === y && this.z === z && this.w === w;\n    }\n\n    /**\n     * @en Calculate linear interpolation result between this vector and another one with given ratio.\n     * @zh 根据指定的插值比率，从当前向量到目标向量之间做插值。\n     * @param to Target vector\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public lerp (to: Vec4, ratio: number) {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n        const w = this.w;\n        this.x = x + ratio * (to.x - x);\n        this.y = y + ratio * (to.y - y);\n        this.z = z + ratio * (to.z - z);\n        this.w = w + ratio * (to.w - w);\n        return this;\n    }\n\n    /**\n     * @en Return the information of the vector in string\n     * @zh 返回当前向量的字符串表示。\n     * @returns The string with vector information\n     */\n    public toString () {\n        return `(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)}, ${this.w.toFixed(2)})`;\n    }\n\n    /**\n     * @en Clamp the vector between minInclusive and maxInclusive.\n     * @zh 设置当前向量的值，使其各个分量都处于指定的范围内。\n     * @param minInclusive Minimum value allowed\n     * @param maxInclusive Maximum value allowed\n     * @returns `this`\n     */\n    public clampf (minInclusive: Vec4, maxInclusive: Vec4) {\n        this.x = clamp(this.x, minInclusive.x, maxInclusive.x);\n        this.y = clamp(this.y, minInclusive.y, maxInclusive.y);\n        this.z = clamp(this.z, minInclusive.z, maxInclusive.z);\n        this.w = clamp(this.w, minInclusive.w, maxInclusive.w);\n        return this;\n    }\n\n    /**\n     * @en Adds the current vector with another one and return this\n     * @zh 向量加法。将当前向量与指定向量的相加\n     * @param other specified vector\n     */\n    public add (other: Vec4) {\n        this.x += other.x;\n        this.y += other.y;\n        this.z += other.z;\n        this.w += other.w;\n        return this;\n    }\n\n    /**\n     * @en Adds the current vector with another one and return this\n     * @zh 向量加法。将当前向量与指定分量的向量相加\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param w The w value of specified vector\n     */\n    public add4f (x: number, y: number, z: number, w: number) {\n        this.x += x;\n        this.y += y;\n        this.z += z;\n        this.w += w;\n        return this;\n    }\n\n    /**\n     * @en Subtracts one vector from this, and returns this.\n     * @zh 向量减法。将当前向量减去指定向量\n     * @param other specified vector\n     */\n    public subtract (other: Vec4) {\n        this.x -= other.x;\n        this.y -= other.y;\n        this.z -= other.z;\n        this.w -= other.w;\n        return this;\n    }\n\n    /**\n     * @en Subtracts one vector from this, and returns this.\n     * @zh 向量减法。将当前向量减去指定分量的向量\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param w The w value of specified vector\n     */\n    public subtract4f (x: number, y: number, z: number, w: number) {\n        this.x -= x;\n        this.y -= y;\n        this.z -= z;\n        this.w -= w;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with a number, and returns this.\n     * @zh 向量数乘。将当前向量数乘指定标量\n     * @param scalar scalar number\n     */\n    public multiplyScalar (scalar: number) {\n        if (typeof scalar === 'object') { console.warn('should use Vec4.multiply for vector * vector operation'); }\n        this.x *= scalar;\n        this.y *= scalar;\n        this.z *= scalar;\n        this.w *= scalar;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with another one and return this\n     * @zh 向量乘法。将当前向量乘以指定向量\n     * @param other specified vector\n     */\n    public multiply (other: Vec4) {\n        if (typeof other !== 'object') { console.warn('should use Vec4.scale for vector * scalar operation'); }\n        this.x *= other.x;\n        this.y *= other.y;\n        this.z *= other.z;\n        this.w *= other.w;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with another one and return this\n     * @zh 向量乘法。将当前向量与指定分量的向量相乘的结果赋值给当前向量。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param w The w value of specified vector\n     */\n    public multiply4f (x: number, y: number, z: number, w: number) {\n        this.x *= x;\n        this.y *= y;\n        this.z *= z;\n        this.w *= w;\n        return this;\n    }\n\n    /**\n     * @en Element-wisely divides this vector with another one, and return this.\n     * @zh 向量逐元素相除。将当前向量与指定分量的向量相除的结果赋值给当前向量。\n     * @param other specified vector\n     */\n    public divide (other: Vec4) {\n        this.x /= other.x;\n        this.y /= other.y;\n        this.z /= other.z;\n        this.w /= other.w;\n        return this;\n    }\n\n    /**\n     * @en Element-wisely divides this vector with another one, and return this.\n     * @zh 向量逐元素相除。将当前向量与指定分量的向量相除的结果赋值给当前向量。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param w The w value of specified vector\n     */\n    public divide4f (x: number, y: number, z: number, w: number) {\n        this.x /= x;\n        this.y /= y;\n        this.z /= z;\n        this.w /= w;\n        return this;\n    }\n\n    /**\n     * @en Sets each component of this vector with its negative value\n     * @zh 将当前向量的各个分量取反\n     */\n    public negative () {\n        this.x = -this.x;\n        this.y = -this.y;\n        this.z = -this.z;\n        this.w = -this.w;\n        return this;\n    }\n\n    /**\n     * @en Calculates the dot product with another vector\n     * @zh 向量点乘。\n     * @param other specified vector\n     * @returns 当前向量与指定向量点乘的结果。\n     */\n    public dot (vector: Vec4) {\n        return this.x * vector.x + this.y * vector.y + this.z * vector.z + this.w * vector.w;\n    }\n\n    /**\n     * @en Calculates the cross product with another vector.\n     * @zh 向量叉乘。视当前向量和指定向量为三维向量（舍弃 w 分量），将当前向量左叉乘指定向量\n     * @param other specified vector\n     */\n    public cross (vector: Vec4) {\n        const { x: ax, y: ay, z: az } = this;\n        const { x: bx, y: by, z: bz } = vector;\n\n        this.x = ay * bz - az * by;\n        this.y = az * bx - ax * bz;\n        this.z = ax * by - ay * bx;\n        return this;\n    }\n\n    /**\n     * @en Returns the length of this vector.\n     * @zh 计算向量的长度（模）。\n     * @returns Length of vector\n     */\n    public length () {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n        const w = this.w;\n        return Math.sqrt(x * x + y * y + z * z + w * w);\n    }\n\n    /**\n     * @en Returns the squared length of this vector.\n     * @zh 计算向量长度（模）的平方。\n     * @returns the squared length of this vector\n     */\n    public lengthSqr () {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n        const w = this.w;\n        return x * x + y * y + z * z + w * w;\n    }\n\n    /**\n     * @en Normalize the current vector.\n     * @zh 将当前向量归一化\n     */\n    public normalize () {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n        const w = this.w;\n        let len = x * x + y * y + z * z + w * w;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            this.x = x * len;\n            this.y = y * len;\n            this.z = z * len;\n            this.w = w * len;\n        }\n        return this;\n    }\n\n    /**\n     * @en Transforms the vec4 with a mat4\n     * @zh 应用四维矩阵变换到当前矩阵\n     * @param matrix matrix to transform with\n     */\n    public transformMat4 (matrix: Mat4) {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n        const w = this.w;\n        this.x = matrix.m00 * x + matrix.m04 * y + matrix.m08 * z + matrix.m12 * w;\n        this.y = matrix.m01 * x + matrix.m05 * y + matrix.m09 * z + matrix.m13 * w;\n        this.z = matrix.m02 * x + matrix.m06 * y + matrix.m10 * z + matrix.m14 * w;\n        this.w = matrix.m03 * x + matrix.m07 * y + matrix.m11 * z + matrix.m15 * w;\n        return this;\n    }\n}\n\nCCClass.fastDefine('cc.Vec4', Vec4, { x: 0, y: 0, z: 0, w: 0 });\nlegacyCC.Vec4 = Vec4;\n\nexport function v4 (other: Vec4): Vec4;\nexport function v4 (x?: number, y?: number, z?: number, w?: number): Vec4;\n\nexport function v4 (x?: number | Vec4, y?: number, z?: number, w?: number) {\n    return new Vec4(x as any, y, z, w);\n}\n\nlegacyCC.v4 = v4;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { IColorLike } from './type-define';\nimport { clamp, EPSILON } from './utils';\nimport { legacyCC } from '../global-exports';\nimport { assertIsTrue } from '../data/utils/asserts';\nimport { Vec4 } from './vec4';\n\nconst toFloat = 1 / 255;\n\n/**\n * @en Representation of RGBA colors.<br/>\n * Each color component is an integer value with a range from 0 to 255.<br/>\n * @zh 通过 Red、Green、Blue 颜色通道表示颜色，并通过 Alpha 通道表示不透明度。<br/>\n * 每个通道都为取值范围 [0, 255] 的整数。<br/>\n */\nexport class Color extends ValueType {\n    public static WHITE = Object.freeze(new Color(255, 255, 255, 255));\n    public static GRAY = Object.freeze(new Color(127, 127, 127, 255));\n    public static BLACK = Object.freeze(new Color(0, 0, 0, 255));\n    public static TRANSPARENT = Object.freeze(new Color(0, 0, 0, 0));\n    public static RED = Object.freeze(new Color(255, 0, 0, 255));\n    public static GREEN = Object.freeze(new Color(0, 255, 0, 255));\n    public static BLUE = Object.freeze(new Color(0, 0, 255, 255));\n    public static CYAN = Object.freeze(new Color(0, 255, 255, 255));\n    public static MAGENTA = Object.freeze(new Color(255, 0, 255, 255));\n    public static YELLOW = Object.freeze(new Color(255, 255, 0, 255));\n\n    /**\n     * @en Copy content of a color into another and save the results to out color.\n     * @zh 获得指定颜色的拷贝\n     */\n    public static clone<Out extends IColorLike> (a: Out) {\n        const out = new Color();\n        if (a._val) {\n            out._val = a._val;\n        } else {\n            out._val = ((a.a << 24) >>> 0) + (a.b << 16) + (a.g << 8) + a.r;\n        }\n        return out;\n    }\n\n    /**\n     * @en Clone a color and save the results to out color.\n     * @zh 复制目标颜色\n     */\n    public static copy<Out extends IColorLike> (out: Out, a: Out) {\n        out.r = a.r;\n        out.g = a.g;\n        out.b = a.b;\n        out.a = a.a;\n        return out;\n    }\n\n    /**\n     * @en Set the components of a color to the given values and save the results to out color.\n     * @zh 设置颜色值\n     */\n    public static set<Out extends IColorLike> (out: Out, r: number, g: number, b: number, a: number) {\n        out.r = r;\n        out.g = g;\n        out.b = b;\n        out.a = a;\n        return out;\n    }\n    /**\n     * @en Convert 8bit color to Vec4\n     * @zh 将当前颜色转换为到 Vec4\n     * @returns Vec4 as float color value\n     * @example\n     * ```\n     * const color = Color.YELLOW;\n     * color.toVec4();\n     * ```\n     */\n    public static toVec4 (color:Color, out?: Vec4): Vec4 {\n        out = out !== undefined ?  out : new Vec4();\n        out.x = srgb8BitToLinear(color.r);\n        out.y = srgb8BitToLinear(color.g);\n        out.z = srgb8BitToLinear(color.b);\n        out.w = srgb8BitToLinear(color.a);\n        return out;\n    }\n    /**\n     * @en Set 8bit Color from Vec4\n     * @zh 使用 Vec4 设置 8 bit 颜色\n     * @returns 8 Bit srgb value\n     * @example\n     * ```\n     * color.fromVec4(new Vec4(1,1,1,1));\n     * ```\n     */\n    public static fromVec4 (value: Vec4, out?: Color): Color {\n        out = out === undefined ? new Color() : out;\n        out.r = linearToSrgb8Bit(value.x);\n        out.g = linearToSrgb8Bit(value.y);\n        out.b = linearToSrgb8Bit(value.z);\n        out.a = linearToSrgb8Bit(value.w);\n        return out;\n    }\n    /**\n     * @en Converts the hexadecimal formal color into rgb formal and save the results to out color.\n     * @zh 从十六进制颜色字符串中读入颜色到 out 中\n     */\n    public static fromHEX<Out extends IColorLike> (out: Out, hexString: string) {\n        hexString = (hexString.indexOf('#') === 0) ? hexString.substring(1) : hexString;\n        out.r = parseInt(hexString.substr(0, 2), 16) || 0;\n        out.g = parseInt(hexString.substr(2, 2), 16) || 0;\n        out.b = parseInt(hexString.substr(4, 2), 16) || 0;\n        const a = parseInt(hexString.substr(6, 2), 16);\n        out.a = !Number.isNaN(a) ? a : 255;\n        out._val = ((out.a << 24) >>> 0) + (out.b << 16) + (out.g << 8) + out.r;\n        return out;\n    }\n\n    /**\n     * @en Add two colors by components. And save the results to out color.\n     * @zh 逐通道颜色加法\n     */\n    public static add<Out extends IColorLike> (out: Out, a: Out, b: Out) {\n        out.r = a.r + b.r;\n        out.g = a.g + b.g;\n        out.b = a.b + b.b;\n        out.a = a.a + b.a;\n        return out;\n    }\n\n    /**\n     * @en Subtract each components of color b from each components of color a. And save the results to out color.\n     * @zh 逐通道颜色减法\n     */\n    public static subtract<Out extends IColorLike> (out: Out, a: Out, b: Out) {\n        out.r = a.r - b.r;\n        out.g = a.g - b.g;\n        out.b = a.b - b.b;\n        out.a = a.a - b.a;\n        return out;\n    }\n\n    /**\n     * @en Multiply each components of two colors. And save the results to out color.\n     * @zh 逐通道颜色乘法\n     */\n    public static multiply<Out extends IColorLike> (out: Out, a: Out, b: Out) {\n        out.r = a.r * b.r;\n        out.g = a.g * b.g;\n        out.b = a.b * b.b;\n        out.a = a.a * b.a;\n        return out;\n    }\n\n    /**\n     * @en Divide each components of color a by each components of color b. And save the results to out color.\n     * @zh 逐通道颜色除法\n     */\n    public static divide<Out extends IColorLike> (out: Out, a: Out, b: Out) {\n        out.r = a.r / b.r;\n        out.g = a.g / b.g;\n        out.b = a.b / b.b;\n        out.a = a.a / b.a;\n        return out;\n    }\n\n    /**\n     * @en Multiply all channels in a color with the given scale factor, and save the results to out color.\n     * @zh 全通道统一缩放颜色\n     */\n    public static scale<Out extends IColorLike> (out: Out, a: Out, b: number) {\n        out.r = a.r * b;\n        out.g = a.g * b;\n        out.b = a.b * b;\n        out.a = a.a * b;\n        return out;\n    }\n\n    /**\n     * @en Performs a linear interpolation between two colors.\n     * @zh 逐通道颜色线性插值：A + t * (B - A)\n     */\n    public static lerp<Out extends IColorLike> (out: Out, from: Out, to: Out, ratio: number) {\n        let r = from.r;\n        let g = from.g;\n        let b = from.b;\n        let a = from.a;\n        r += (to.r - r) * ratio;\n        g += (to.g - g) * ratio;\n        b += (to.b - b) * ratio;\n        a += (to.a - a) * ratio;\n        out._val = Math.floor(((a << 24) >>> 0) + (b << 16) + (g << 8) + r);\n        return out;\n    }\n\n    /**\n     * @en Convert a color object to a RGBA array, and save the results to out color.\n     * @zh 颜色转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray<Out extends IWritableArrayLike<number>> (out: Out, a: IColorLike, ofs = 0) {\n        const scale = (a instanceof Color || a.a > 1) ? 1 / 255 : 1;\n        out[ofs + 0] = a.r * scale;\n        out[ofs + 1] = a.g * scale;\n        out[ofs + 2] = a.b * scale;\n        out[ofs + 3] = a.a * scale;\n        return out;\n    }\n\n    /**\n     * @en Sets the given color with RGBA values in an array, and save the results to out color.\n     * @zh 数组转颜色\n     * @param ofs Array Start Offset\n     */\n    public static fromArray<Out extends IColorLike> (arr: IWritableArrayLike<number>, out: Out, ofs = 0) {\n        out.r = arr[ofs + 0] * 255;\n        out.g = arr[ofs + 1] * 255;\n        out.b = arr[ofs + 2] * 255;\n        out.a = arr[ofs + 3] * 255;\n        return out;\n    }\n\n    /**\n     * @en Check whether the two given colors are identical\n     * @zh 颜色等价判断\n     */\n    public static strictEquals<Out extends IColorLike> (a: Out, b: Out) {\n        return a.r === b.r && a.g === b.g && a.b === b.b && a.a === b.a;\n    }\n\n    /**\n     * @en Check whether the two given colors are approximately equivalent. Difference of each channel is smaller that the epsilon.\n     * @zh 排除浮点数误差的颜色近似等价判断\n     */\n    public static equals<Out extends IColorLike> (a: Out, b: Out, epsilon = EPSILON) {\n        return (Math.abs(a.r - b.r) <= epsilon * Math.max(1.0, Math.abs(a.r), Math.abs(b.r))\n            && Math.abs(a.g - b.g) <= epsilon * Math.max(1.0, Math.abs(a.g), Math.abs(b.g))\n            && Math.abs(a.b - b.b) <= epsilon * Math.max(1.0, Math.abs(a.b), Math.abs(b.b))\n            && Math.abs(a.a - b.a) <= epsilon * Math.max(1.0, Math.abs(a.a), Math.abs(b.a)));\n    }\n\n    /**\n     * @en Convert the given color to a hex color value. And save the results to out color.\n     * @zh 获取指定颜色的整型数据表示\n     */\n    public static hex<Out extends IColorLike> (a: Out) {\n        return ((a.r * 255) << 24 | (a.g * 255) << 16 | (a.b * 255) << 8 | a.a * 255) >>> 0;\n    }\n\n    /**\n     * @en Get or set red channel value.\n     * @zh 获取或设置当前颜色的 Red 通道。\n     */\n    get r () {\n        return this._val & 0x000000ff;\n    }\n\n    set r (red) {\n        red = ~~clamp(red, 0, 255);\n        this._val = ((this._val & 0xffffff00) | red) >>> 0;\n    }\n\n    /**\n     * @en Get or set green channel value.\n     * @zh 获取或设置当前颜色的 Green 通道。\n     */\n    get g () {\n        return (this._val & 0x0000ff00) >> 8;\n    }\n\n    set g (green) {\n        green = ~~clamp(green, 0, 255);\n        this._val = ((this._val & 0xffff00ff) | (green << 8)) >>> 0;\n    }\n\n    /**\n     * @en Get or set blue channel value.\n     * @zh 获取或设置当前颜色的 Blue 通道。\n     */\n    get b () {\n        return (this._val & 0x00ff0000) >> 16;\n    }\n\n    set b (blue) {\n        blue = ~~clamp(blue, 0, 255);\n        this._val = ((this._val & 0xff00ffff) | (blue << 16)) >>> 0;\n    }\n\n    /** @en Get or set alpha channel value.\n     * @zh 获取或设置当前颜色的透明度通道。\n     */\n    get a () {\n        return (this._val & 0xff000000) >>> 24;\n    }\n\n    set a (alpha) {\n        alpha = ~~clamp(alpha, 0, 255);\n        this._val = ((this._val & 0x00ffffff) | (alpha << 24)) >>> 0;\n    }\n\n    // compatibility with vector interfaces\n    get x () { return this.r * toFloat; }\n    set x (value) { this.r = value * 255; }\n    get y () { return this.g * toFloat; }\n    set y (value) { this.g = value * 255; }\n    get z () { return this.b * toFloat; }\n    set z (value) { this.b = value * 255; }\n    get w () { return this.a * toFloat; }\n    set w (value) { this.a = value * 255; }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _val = 0;\n\n    /**\n     * @en Construct a same color from the given color\n     * @zh 构造与指定颜色相等的颜色。\n     * @param other Specified color\n     */\n    constructor (other: Color);\n\n    /**\n     * @en Construct a color form the hex color string\n     * @zh 用十六进制颜色字符串中构造颜色。\n     * @param hexString Hexadecimal color string.\n     */\n\n    constructor (hexString: string);\n\n    /**\n     * @en Construct a color\n     * @zh 构造具有指定通道的颜色。\n     * @param r red component of the color, default value is 0.\n     * @param g green component of the color, default value is 0.\n     * @param b blue component of the color, default value is 0.\n     * @param a alpha component of the color, default value is 255.\n     */\n    constructor (r?: number, g?: number, b?: number, a?: number);\n\n    constructor (r?: number | Color | string, g?: number, b?: number, a?: number) {\n        super();\n        if (typeof r === 'string') {\n            this.fromHEX(r);\n        } else if (g !== undefined) {\n            this.set(r as number, g, b, a);\n        } else {\n            this.set(r as Color);\n        }\n    }\n\n    /**\n     * @en Clone a new color from the current color.\n     * @zh 克隆当前颜色。\n     */\n    public clone () {\n        const ret = new Color();\n        ret._val = this._val;\n        return ret;\n    }\n\n    /**\n     * @en Check whether the current color is identical with the given color\n     * @zh 判断当前颜色是否与指定颜色相等。\n     * @param other Specified color\n     * @returns Returns `true` when all channels of both colours are equal; otherwise returns `false`.\n     */\n    public equals (other: Color) {\n        return other && this._val === other._val;\n    }\n\n    /**\n     * @en Calculate linear interpolation result between this color and another one with given ratio。\n     * @zh 根据指定的插值比率，从当前颜色到目标颜色之间做插值。\n     * @param to Target color\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public lerp (to: Color, ratio: number) {\n        let r = this.r;\n        let g = this.g;\n        let b = this.b;\n        let a = this.a;\n        r += (to.r - r) * ratio;\n        g += (to.g - g) * ratio;\n        b += (to.b - b) * ratio;\n        a += (to.a - a) * ratio;\n        this._val = Math.floor(((a << 24) >>> 0) + (b << 16) + (g << 8) + r);\n        return this;\n    }\n\n    /**\n     * @en Convert to string with color informations\n     * @zh 返回当前颜色的字符串表示。\n     * @returns A string representation of the current color.\n     */\n    public toString () {\n        return `rgba(${this.r.toFixed()}, ${this.g.toFixed()}, ${this.b.toFixed()}, ${this.a.toFixed()})`;\n    }\n\n    /**\n     * @en Convert color to css format.\n     * @zh 将当前颜色转换为 CSS 格式。\n     * @param opt \"rgba\", \"rgb\", \"#rgb\" or \"#rrggbb\".\n     * @returns CSS format for the current color.\n     * @example\n     * ```ts\n     * let color = cc.Color.BLACK;\n     * color.toCSS();          // \"rgba(0,0,0,1.00)\";\n     * color.toCSS(\"rgba\");    // \"rgba(0,0,0,1.00)\";\n     * color.toCSS(\"rgb\");     // \"rgba(0,0,0)\";\n     * color.toCSS(\"#rgb\");    // \"#000\";\n     * color.toCSS(\"#rrggbb\"); // \"#000000\";\n     * ```\n     */\n    public toCSS (opt: ('rgba' | 'rgb' | '#rrggbb' | '#rrggbbaa') = 'rgba') {\n        if (opt === 'rgba') {\n            return `rgba(${this.r},${this.g},${this.b},${(this.a * toFloat).toFixed(2)})`;\n        } else if (opt === 'rgb') {\n            return `rgb(${this.r},${this.g},${this.b})`;\n        } else {\n            return `#${this.toHEX(opt)}`;\n        }\n    }\n\n    /**\n     * @en Read hex string and store color data into the current color object, the hex string must be formatted as rgba or rgb.\n     * @zh 从十六进制颜色字符串中读入当前颜色。<br/>\n     * 十六进制颜色字符串应该以可选的 \"#\" 开头，紧跟最多 8 个代表十六进制数字的字符；<br/>\n     * 每两个连续字符代表的数值依次作为 Red、Green、Blue 和 Alpha 通道；<br/>\n     * 缺省的颜色通道将视为 0；缺省的透明通道将视为 255。<br/>\n     * @param hexString the hex string\n     * @returns `this`\n     */\n    public fromHEX (hexString: string) {\n        hexString = (hexString.indexOf('#') === 0) ? hexString.substring(1) : hexString;\n        const r = parseInt(hexString.substr(0, 2), 16) || 0;\n        const g = parseInt(hexString.substr(2, 2), 16) || 0;\n        const b = parseInt(hexString.substr(4, 2), 16) || 0;\n        let a = parseInt(hexString.substr(6, 2), 16);\n        a = !Number.isNaN(a) ? a : 255;\n        this._val = ((a << 24) >>> 0) + (b << 16) + (g << 8) + (r | 0);\n        return this;\n    }\n\n    /**\n     * @en convert Color to HEX color string.\n     * @zh 转换当前颜色为十六进制颜色字符串。\n     * @param fmt \"#rrggbb\" or \"#rrggbbaa\".\n     * - `'#rrggbbaa'` obtains the hexadecimal value of the Red, Green, Blue, Alpha channels (**two**, high complement 0) and connects them sequentially.\n     * - `'#rrggbb'` is similar to `'#rrggbbaa'` but does not include the Alpha channel.\n     * @returns the Hex color string\n     * @example\n     * ```\n     * const color = new Color(255, 14, 0, 255);\n     * color.toHEX(\"#rgb\");      // \"f00\";\n     * color.toHEX(\"#rrggbbaa\"); // \"ff0e00ff\"\n     * color.toHEX(\"#rrggbb\");   // \"ff0e00\"\n     * ```\n     */\n    public toHEX (fmt: '#rgb' | '#rrggbb' | '#rrggbbaa' = '#rrggbb') {\n        const prefix = '0';\n        // #rrggbb\n        const hex = [\n            (this.r < 16 ? prefix : '') + (this.r).toString(16),\n            (this.g < 16 ? prefix : '') + (this.g).toString(16),\n            (this.b < 16 ? prefix : '') + (this.b).toString(16),\n        ];\n        const i = -1;\n        if (fmt === '#rgb') {\n            hex[0] = hex[0][0];\n            hex[1] = hex[1][0];\n            hex[2] = hex[2][0];\n        } else if (fmt === '#rrggbbaa') {\n            hex.push((this.a < 16 ? prefix : '') + (this.a).toString(16));\n        }\n        return hex.join('');\n    }\n\n    /**\n     * @en Convert to rgb value.\n     * @zh 将当前颜色转换为 RGB 整数值。\n     * @returns RGB integer value. Starting from the lowest valid bit, each 8 bits is the value of the Red, Green, and Blue channels respectively.\n     * @example\n     * ```\n     * const color = Color.YELLOW;\n     * color.toRGBValue();\n     * ```\n     */\n    public toRGBValue () {\n        return this._val & 0x00ffffff;\n    }\n\n    /**\n     * @en Read HSV model color and convert to RGB color.\n     * @zh 从 HSV 颜色中读入当前颜色。\n     * @param h H value。\n     * @param s S value。\n     * @param v V value。\n     * @returns `this`\n     * @example\n     * ```\n     * const color = Color.YELLOW;\n     * color.fromHSV(0, 0, 1); // Color {r: 255, g: 255, b: 255, a: 255};\n     * ```\n     */\n    public fromHSV (h: number, s: number, v: number) {\n        let r = 0;\n        let g = 0;\n        let b = 0;\n        if (s === 0) {\n            r = g = b = v;\n        } else if (v === 0) {\n            r = g = b = 0;\n        } else {\n            if (h === 1) { h = 0; }\n            h *= 6;\n            const i = Math.floor(h);\n            const f = h - i;\n            const p = v * (1 - s);\n            const q = v * (1 - (s * f));\n            const t = v * (1 - (s * (1 - f)));\n            switch (i) {\n            default:\n                assertIsTrue(false);\n                // eslint-disable-next-line no-fallthrough\n            case 0:\n                r = v;\n                g = t;\n                b = p;\n                break;\n\n            case 1:\n                r = q;\n                g = v;\n                b = p;\n                break;\n\n            case 2:\n                r = p;\n                g = v;\n                b = t;\n                break;\n\n            case 3:\n                r = p;\n                g = q;\n                b = v;\n                break;\n\n            case 4:\n                r = t;\n                g = p;\n                b = v;\n                break;\n\n            case 5:\n                r = v;\n                g = p;\n                b = q;\n                break;\n            }\n        }\n        r *= 255;\n        g *= 255;\n        b *= 255;\n        this._val = ((this.a << 24) >>> 0) + (b << 16) + (g << 8) + (r | 0);\n        return this;\n    }\n\n    /**\n     * @en Transform to HSV model color.\n     * @zh 转换当前颜色为 HSV 颜色。\n     * @returns HSV format color\n     * @example\n     * ```\n     * import { Color } from 'cc';\n     * const color = Color.YELLOW;\n     * color.toHSV(); // {h: 0.1533864541832669, s: 0.9843137254901961, v: 1}\n     * ```\n     */\n    public toHSV () {\n        const r = this.r * toFloat;\n        const g = this.g * toFloat;\n        const b = this.b * toFloat;\n        const hsv = { h: 0, s: 0, v: 0 };\n        const max = Math.max(r, g, b);\n        const min = Math.min(r, g, b);\n        let delta = 0;\n        hsv.v = max;\n        hsv.s = max ? (max - min) / max : 0;\n        if (!hsv.s) { hsv.h = 0; } else {\n            delta = max - min;\n            if (r === max) {\n                hsv.h = (g - b) / delta;\n            } else if (g === max) {\n                hsv.h = 2 + (b - r) / delta;\n            } else {\n                hsv.h = 4 + (r - g) / delta;\n            }\n            hsv.h /= 6;\n            if (hsv.h < 0) { hsv.h += 1.0; }\n        }\n        return hsv;\n    }\n\n    /**\n     * @en Set the color.\n     * @zh 设置当前颜色使其与指定颜色相等。\n     * @param other The specified color.\n     * @overload\n     * @param [r=0] red component of the color, the range is [0-255]\n     * @param [g=0] green component of the color\n     * @param [b=0] blue component of the color\n     * @param [a=255] alpha component of the color\n     * @returns Current color.\n     */\n    public set(other: Color): Color;\n    public set(r?: number, g?: number, b?: number, a?: number): Color;\n    public set (r?: number | Color, g?: number, b?: number, a?: number): Color {\n        if (typeof r === 'object') {\n            if (r._val != null) {\n                this._val = r._val;\n            } else {\n                g = r.g || 0;\n                b = r.b || 0;\n                a = typeof r.a === 'number' ? r.a : 255;\n                r = r.r || 0;\n                this._val = ((a << 24) >>> 0) + (b << 16) + (g << 8) + (r | 0);\n            }\n        } else {\n            r = r || 0;\n            g = g || 0;\n            b = b || 0;\n            a = typeof a === 'number' ? a : 255;\n            this._val = ((a << 24) >>> 0) + (b << 16) + (g << 8) + (r | 0);\n        }\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current color by the specified color.\n     * @zh 将当前颜色乘以与指定颜色\n     * @param other The specified color.\n     */\n    public multiply (other: Color) {\n        const r = ((this._val & 0x000000ff) * other.r) >> 8;\n        const g = ((this._val & 0x0000ff00) * other.g) >> 8;\n        const b = ((this._val & 0x00ff0000) * other.b) >> 8;\n        const a = ((this._val & 0xff000000) >>> 8) * other.a;\n        this._val = (a & 0xff000000) | (b & 0x00ff0000) | (g & 0x0000ff00) | (r & 0x000000ff);\n        return this;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _set_r_unsafe (red) {\n        this._val = ((this._val & 0xffffff00) | red) >>> 0;\n        return this;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _set_g_unsafe (green) {\n        this._val = ((this._val & 0xffff00ff) | (green << 8)) >>> 0;\n        return this;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _set_b_unsafe (blue) {\n        this._val = ((this._val & 0xff00ffff) | (blue << 16)) >>> 0;\n        return this;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _set_a_unsafe (alpha) {\n        this._val = ((this._val & 0x00ffffff) | (alpha << 24)) >>> 0;\n        return this;\n    }\n}\n\nCCClass.fastDefine('cc.Color', Color, { r: 0, g: 0, b: 0, a: 255 });\nlegacyCC.Color = Color;\n\nexport function color (other: Color | string): Color;\nexport function color (r?: number, g?: number, b?: number, a?: number): Color;\n\nexport function color (r?: number | Color | string, g?: number, b?: number, a?: number) {\n    return new Color(r as any, g, b, a);\n}\n\nlegacyCC.color = color;\n\nexport function srgbToLinear (x: number): number {\n    if (x <= 0) return 0;\n    else if (x >= 1) return 1;\n    else if (x < 0.04045) return x / 12.92;\n    else return ((x + 0.055) / 1.055) ** 2.4;\n}\n\nexport function srgb8BitToLinear (x: number): number {\n    if ((x | 0) !== x || (x >>> 8) !== 0) { throw new RangeError('Value out of 8-bit range'); }\n    return SRGB_8BIT_TO_LINEAR[x];\n}\n\nexport function linearToSrgb (x: number): number {\n    if (x <= 0) return 0;\n    else if (x >= 1) return 1;\n    else if (x < 0.0031308) return x * 12.92;\n    else return x ** (1 / 2.4) * 1.055 - 0.055;\n}\n\nexport function linearToSrgb8Bit (x: number): number {\n    if (x <= 0) { return 0; }\n    const TABLE: Array<number> = SRGB_8BIT_TO_LINEAR;\n    if (x >= 1) { return TABLE.length - 1; }\n    let y = 0;\n    for (let i = TABLE.length >>> 1; i !== 0; i >>>= 1) {\n        if (TABLE[y | i] <= x) { y |= i; }\n    }\n    if (x - TABLE[y] <= TABLE[y + 1] - x) { return y; } else { return y + 1; }\n}\n\n// use table for more consistent conversion between uint8 and float, offline processes only.\nlet SRGB_8BIT_TO_LINEAR: Array<number> = [];\nfor (let i = 0; i < 256; i++) { SRGB_8BIT_TO_LINEAR.push(srgbToLinear(i / 255.0)); }\n","/*\n Copyright (c) 2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Mat4 } from './mat4';\nimport { IMat3Like, IMat4Like, IQuatLike, IVec3Like } from './type-define';\nimport { clamp, EPSILON, random } from './utils';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Representation of 3D vectors and points.\n * @zh 三维向量。\n */\nexport class Vec3 extends ValueType {\n    public static UNIT_X = Object.freeze(new Vec3(1, 0, 0));\n    public static UNIT_Y = Object.freeze(new Vec3(0, 1, 0));\n    public static UNIT_Z = Object.freeze(new Vec3(0, 0, 1));\n    public static RIGHT = Object.freeze(new Vec3(1, 0, 0));\n    public static UP = Object.freeze(new Vec3(0, 1, 0));\n    public static FORWARD = Object.freeze(new Vec3(0, 0, -1)); // we use -z for view-dir\n    public static ZERO = Object.freeze(new Vec3(0, 0, 0));\n    public static ONE = Object.freeze(new Vec3(1, 1, 1));\n    public static NEG_ONE = Object.freeze(new Vec3(-1, -1, -1));\n\n    /**\n     * @en return a Vec3 object with x = 0, y = 0, z = 0.\n     * @zh 将目标赋值为零向量\n     */\n    public static zero<Out extends IVec3Like> (out: Out) {\n        out.x = 0;\n        out.y = 0;\n        out.z = 0;\n        return out;\n    }\n\n    /**\n     * @en Obtains a clone of the given vector object\n     * @zh 获得指定向量的拷贝\n     */\n    public static clone <Out extends IVec3Like> (a: Out) {\n        return new Vec3(a.x, a.y, a.z);\n    }\n\n    /**\n     * @en Copy the target vector and save the results to out vector object\n     * @zh 复制目标向量\n     */\n    public static copy<Out extends IVec3Like, Vec3Like extends IVec3Like> (out: Out, a: Vec3Like) {\n        out.x = a.x;\n        out.y = a.y;\n        out.z = a.z;\n        return out;\n    }\n\n    /**\n     * @en Sets the out vector with the given x, y and z values\n     * @zh 设置向量值\n     */\n    public static set<Out extends IVec3Like> (out: Out, x: number, y: number, z: number) {\n        out.x = x;\n        out.y = y;\n        out.z = z;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector addition and save the results to out vector object\n     * @zh 逐元素向量加法\n     */\n    public static add<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        out.x = a.x + b.x;\n        out.y = a.y + b.y;\n        out.z = a.z + b.z;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector subtraction and save the results to out vector object\n     * @zh 逐元素向量减法\n     */\n    public static subtract<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        out.x = a.x - b.x;\n        out.y = a.y - b.y;\n        out.z = a.z - b.z;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector multiplication and save the results to out vector object\n     * @zh 逐元素向量乘法 (分量积)\n     */\n    public static multiply<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        out.x = a.x * b.x;\n        out.y = a.y * b.y;\n        out.z = a.z * b.z;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector division and save the results to out vector object\n     * @zh 逐元素向量除法\n     */\n    public static divide<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        out.x = a.x / b.x;\n        out.y = a.y / b.y;\n        out.z = a.z / b.z;\n        return out;\n    }\n\n    /**\n     * @en Rounds up by elements of the vector and save the results to out vector object\n     * @zh 逐元素向量向上取整\n     */\n    public static ceil<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        out.x = Math.ceil(a.x);\n        out.y = Math.ceil(a.y);\n        out.z = Math.ceil(a.z);\n        return out;\n    }\n\n    /**\n     * @en Element-wise rounds down of the current vector and save the results to the out vector\n     * @zh 逐元素向量向下取整\n     */\n    public static floor<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        out.x = Math.floor(a.x);\n        out.y = Math.floor(a.y);\n        out.z = Math.floor(a.z);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise minimum values and save to the out vector\n     * @zh 逐元素向量最小值\n     */\n    public static min<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        out.x = Math.min(a.x, b.x);\n        out.y = Math.min(a.y, b.y);\n        out.z = Math.min(a.z, b.z);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise maximum values and save to the out vector\n     * @zh 逐元素向量最大值\n     */\n    public static max<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        out.x = Math.max(a.x, b.x);\n        out.y = Math.max(a.y, b.y);\n        out.z = Math.max(a.z, b.z);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise round results and save to the out vector\n     * @zh 逐元素向量四舍五入取整\n     */\n    public static round<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        out.x = Math.round(a.x);\n        out.y = Math.round(a.y);\n        out.z = Math.round(a.z);\n        return out;\n    }\n\n    /**\n     * @en Vector scalar multiplication and save the results to out vector object\n     * @zh 向量标量乘法\n     */\n    public static multiplyScalar<Out extends IVec3Like, Vec3Like extends IVec3Like > (out: Out, a: Vec3Like, b: number) {\n        out.x = a.x * b;\n        out.y = a.y * b;\n        out.z = a.z * b;\n        return out;\n    }\n\n    /**\n     * @en Element-wise multiplication and addition with the equation: a + b * scale\n     * @zh 逐元素向量乘加: A + B * scale\n     */\n    public static scaleAndAdd<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like, scale: number) {\n        out.x = a.x + b.x * scale;\n        out.y = a.y + b.y * scale;\n        out.z = a.z + b.z * scale;\n        return out;\n    }\n\n    /**\n     * @en Calculates the euclidean distance of two vectors\n     * @zh 求两向量的欧氏距离\n     */\n    public static distance (a: IVec3Like, b: IVec3Like) {\n        const x = b.x - a.x;\n        const y = b.y - a.y;\n        const z = b.z - a.z;\n        return Math.sqrt(x * x + y * y + z * z);\n    }\n\n    /**\n     * @en Calculates the squared euclidean distance of two vectors\n     * @zh 求两向量的欧氏距离平方\n     */\n    public static squaredDistance (a: IVec3Like, b: IVec3Like) {\n        const x = b.x - a.x;\n        const y = b.y - a.y;\n        const z = b.z - a.z;\n        return x * x + y * y + z * z;\n    }\n\n    /**\n     * @en Calculates the length of the vector\n     * @zh 求向量长度\n     */\n    public static len (a: IVec3Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        return Math.sqrt(x * x + y * y + z * z);\n    }\n\n    /**\n     * @en Calculates the squared length of the vector\n     * @zh 求向量长度平方\n     */\n    public static lengthSqr (a: IVec3Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        return x * x + y * y + z * z;\n    }\n\n    /**\n     * @en Sets each element to its negative value\n     * @zh 逐元素向量取负\n     */\n    public static negate<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        out.x = -a.x;\n        out.y = -a.y;\n        out.z = -a.z;\n        return out;\n    }\n\n    /**\n     * @en Sets each element to its inverse value, zero value will become Infinity\n     * @zh 逐元素向量取倒数，接近 0 时返回 Infinity\n     */\n    public static invert<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        out.x = 1.0 / a.x;\n        out.y = 1.0 / a.y;\n        out.z = 1.0 / a.z;\n        return out;\n    }\n\n    /**\n     * @en Sets each element to its inverse value, zero value will remain zero\n     * @zh 逐元素向量取倒数，接近 0 时返回 0\n     */\n    public static invertSafe<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n\n        if (Math.abs(x) < EPSILON) {\n            out.x = 0;\n        } else {\n            out.x = 1.0 / x;\n        }\n\n        if (Math.abs(y) < EPSILON) {\n            out.y = 0;\n        } else {\n            out.y = 1.0 / y;\n        }\n\n        if (Math.abs(z) < EPSILON) {\n            out.z = 0;\n        } else {\n            out.z = 1.0 / z;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Sets the normalized vector to the out vector\n     * @zh 归一化向量\n     */\n    public static normalize<Out extends IVec3Like> (out: Out, a: IVec3Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n\n        let len = x * x + y * y + z * z;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            out.x = x * len;\n            out.y = y * len;\n            out.z = z * len;\n        }\n        return out;\n    }\n\n    /**\n     * @en Calculates the dot product of the vector\n     * @zh 向量点积（数量积）\n     */\n    public static dot <Out extends IVec3Like> (a: Out, b: IVec3Like) {\n        return a.x * b.x + a.y * b.y + a.z * b.z;\n    }\n\n    /**\n     * @en Calculates the cross product of the vector\n     * @zh 向量叉积（向量积）\n     */\n    public static cross<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        const { x: ax, y: ay, z: az } = a;\n        const { x: bx, y: by, z: bz } = b;\n        out.x = ay * bz - az * by;\n        out.y = az * bx - ax * bz;\n        out.z = ax * by - ay * bx;\n        return out;\n    }\n\n    /**\n     * @en Calculates the linear interpolation between two vectors with a given ratio\n     * @zh 逐元素向量线性插值： A + t * (B - A)\n     */\n    public static lerp<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like, t: number) {\n        out.x = a.x + t * (b.x - a.x);\n        out.y = a.y + t * (b.y - a.y);\n        out.z = a.z + t * (b.z - a.z);\n        return out;\n    }\n\n    /**\n     * @en Generates a uniformly distributed random vector points from center to the surface of the unit sphere\n     * @zh 生成一个在单位球体上均匀分布的随机向量\n     * @param scale vector length\n     */\n    public static random<Out extends IVec3Like> (out: Out, scale?: number) {\n        scale = scale || 1.0;\n\n        const phi = random() * 2.0 * Math.PI;\n        const cosTheta = random() * 2 - 1;\n        const sinTheta = Math.sqrt(1 - cosTheta * cosTheta);\n\n        out.x = sinTheta * Math.cos(phi) * scale;\n        out.y = sinTheta * Math.sin(phi) * scale;\n        out.z = cosTheta * scale;\n        return out;\n    }\n\n    /**\n     * @en Vector and fourth order matrix multiplication, will complete the vector with a fourth value as one\n     * @zh 向量与四维矩阵乘法，默认向量第四位为 1。\n     */\n    public static transformMat4 <Out extends IVec3Like> (out: Out, a: IVec3Like, m: IMat4Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        let rhw = m.m03 * x + m.m07 * y + m.m11 * z + m.m15;\n        rhw = rhw ? Math.abs(1 / rhw) : 1;\n        out.x = (m.m00 * x + m.m04 * y + m.m08 * z + m.m12) * rhw;\n        out.y = (m.m01 * x + m.m05 * y + m.m09 * z + m.m13) * rhw;\n        out.z = (m.m02 * x + m.m06 * y + m.m10 * z + m.m14) * rhw;\n        return out;\n    }\n\n    /**\n     * @en Vector and fourth order matrix multiplication, will complete the vector with a fourth element as one\n     * @zh 向量与四维矩阵乘法，默认向量第四位为 0。\n     */\n    public static transformMat4Normal<Out extends IVec3Like> (out: Out, a: IVec3Like, m: IMat4Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        let rhw = m.m03 * x + m.m07 * y + m.m11 * z;\n        rhw = rhw ? Math.abs(1 / rhw) : 1;\n        out.x = (m.m00 * x + m.m04 * y + m.m08 * z) * rhw;\n        out.y = (m.m01 * x + m.m05 * y + m.m09 * z) * rhw;\n        out.z = (m.m02 * x + m.m06 * y + m.m10 * z) * rhw;\n        return out;\n    }\n\n    /**\n     * @en Vector and third order matrix multiplication\n     * @zh 向量与三维矩阵乘法\n     */\n    public static transformMat3<Out extends IVec3Like> (out: Out, a: IVec3Like, m: IMat3Like) {\n        const x = a.x;\n        const y = a.y;\n        const z = a.z;\n        out.x = x * m.m00 + y * m.m03 + z * m.m06;\n        out.y = x * m.m01 + y * m.m04 + z * m.m07;\n        out.z = x * m.m02 + y * m.m05 + z * m.m08;\n        return out;\n    }\n\n    /**\n     * @en Affine transformation vector\n     * @zh 向量仿射变换\n     */\n    public static transformAffine<Out extends IVec3Like> (out: Out, v: IVec3Like, m: IMat4Like) {\n        const x = v.x;\n        const y = v.y;\n        const z = v.z;\n        out.x = m.m00 * x + m.m04 * y + m.m08 * z + m.m12;\n        out.y = m.m01 * x + m.m05 * y + m.m09 * z + m.m13;\n        out.z = m.m02 * x + m.m06 * y + m.m10 * z + m.m14;\n        return out;\n    }\n\n    /**\n     * @en Vector quaternion multiplication\n     * @zh 向量四元数乘法\n     */\n    public static transformQuat<Out extends IVec3Like> (out: Out, a: IVec3Like, q: IQuatLike) {\n        // benchmarks: http://jsperf.com/quaternion-transform-Vec3-implementations\n\n        // calculate quat * vec\n        const ix = q.w * a.x + q.y * a.z - q.z * a.y;\n        const iy = q.w * a.y + q.z * a.x - q.x * a.z;\n        const iz = q.w * a.z + q.x * a.y - q.y * a.x;\n        const iw = -q.x * a.x - q.y * a.y - q.z * a.z;\n\n        // calculate result * inverse quat\n        out.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n        out.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n        out.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n        return out;\n    }\n\n    /**\n     * @en Transforms the current vector with given scale, rotation and translation in order\n     * @zh 以缩放 -> 旋转 -> 平移顺序变换向量\n     */\n    public static transformRTS<Out extends IVec3Like> (out: Out, a: IVec3Like, r: IQuatLike, t: IVec3Like, s: IVec3Like) {\n        const x = a.x * s.x;\n        const y = a.y * s.y;\n        const z = a.z * s.z;\n        const ix = r.w * x + r.y * z - r.z * y;\n        const iy = r.w * y + r.z * x - r.x * z;\n        const iz = r.w * z + r.x * y - r.y * x;\n        const iw = -r.x * x - r.y * y - r.z * z;\n        out.x = ix * r.w + iw * -r.x + iy * -r.z - iz * -r.y + t.x;\n        out.y = iy * r.w + iw * -r.y + iz * -r.x - ix * -r.z + t.y;\n        out.z = iz * r.w + iw * -r.z + ix * -r.y - iy * -r.x + t.z;\n        return out;\n    }\n\n    /**\n     * @en Transforms the current vector with given scale, rotation and translation in reverse order\n     * @zh 以平移 -> 旋转 -> 缩放顺序逆变换向量\n     */\n    public static transformInverseRTS<Out extends IVec3Like> (out: Out, a: IVec3Like, r: IQuatLike, t: IVec3Like, s: IVec3Like) {\n        const x = a.x - t.x;\n        const y = a.y - t.y;\n        const z = a.z - t.z;\n        const ix = r.w * x - r.y * z + r.z * y;\n        const iy = r.w * y - r.z * x + r.x * z;\n        const iz = r.w * z - r.x * y + r.y * x;\n        const iw = r.x * x + r.y * y + r.z * z;\n        out.x = (ix * r.w + iw * r.x + iy * r.z - iz * r.y) / s.x;\n        out.y = (iy * r.w + iw * r.y + iz * r.x - ix * r.z) / s.y;\n        out.z = (iz * r.w + iw * r.z + ix * r.y - iy * r.x) / s.z;\n        return out;\n    }\n\n    /**\n     * @en Rotates the vector with specified angle around X axis\n     * @zh 绕 X 轴旋转向量指定弧度\n     * @param v rotation vector\n     * @param o center of rotation\n     * @param a radius of rotation\n     */\n    public static rotateX<Out extends IVec3Like> (out: Out, v: IVec3Like, o: IVec3Like, a: number) {\n        // Translate point to the origin\n        const x = v.x - o.x;\n        const y = v.y - o.y;\n        const z = v.z - o.z;\n\n        // perform rotation\n        const cos = Math.cos(a);\n        const sin = Math.sin(a);\n        const rx = x;\n        const ry = y * cos - z * sin;\n        const rz = y * sin + z * cos;\n\n        // translate to correct position\n        out.x = rx + o.x;\n        out.y = ry + o.y;\n        out.z = rz + o.z;\n\n        return out;\n    }\n\n    /**\n     * @en Rotates the vector with specified angle around Y axis\n     * @zh 绕 Y 轴旋转向量指定弧度\n     * @param v rotation vector\n     * @param o center of rotation\n     * @param a radius of rotation\n     */\n    public static rotateY<Out extends IVec3Like> (out: Out, v: IVec3Like, o: IVec3Like, a: number) {\n        // Translate point to the origin\n        const x = v.x - o.x;\n        const y = v.y - o.y;\n        const z = v.z - o.z;\n\n        // perform rotation\n        const cos = Math.cos(a);\n        const sin = Math.sin(a);\n        const rx = z * sin + x * cos;\n        const ry = y;\n        const rz = z * cos - x * sin;\n\n        // translate to correct position\n        out.x = rx + o.x;\n        out.y = ry + o.y;\n        out.z = rz + o.z;\n\n        return out;\n    }\n\n    /**\n     * @en Rotates the vector with specified angle around Z axis\n     * @zh 绕 Z 轴旋转向量指定弧度\n     * @param v rotation vector\n     * @param o center of rotation\n     * @param a radius of rotation\n     */\n    public static rotateZ<Out extends IVec3Like> (out: Out, v: IVec3Like, o: IVec3Like, a: number) {\n        // Translate point to the origin\n        const x = v.x - o.x;\n        const y = v.y - o.y;\n        const z = v.z - o.z;\n\n        // perform rotation\n        const cos = Math.cos(a);\n        const sin = Math.sin(a);\n        const rx = x * cos - y * sin;\n        const ry = x * sin + y * cos;\n        const rz = z;\n\n        // translate to correct position\n        out.x = rx + o.x;\n        out.y = ry + o.y;\n        out.z = rz + o.z;\n\n        return out;\n    }\n\n    /**\n     * @en Converts the given vector to an array\n     * @zh 向量转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray <Out extends IWritableArrayLike<number>> (out: Out, v: IVec3Like, ofs = 0) {\n        out[ofs + 0] = v.x;\n        out[ofs + 1] = v.y;\n        out[ofs + 2] = v.z;\n\n        return out;\n    }\n\n    /**\n     * @en Converts the given array to a vector\n     * @zh 数组转向量\n     * @param ofs Array Start Offset\n     */\n    public static fromArray <Out extends IVec3Like> (out: Out, arr: IWritableArrayLike<number>, ofs = 0) {\n        out.x = arr[ofs + 0];\n        out.y = arr[ofs + 1];\n        out.z = arr[ofs + 2];\n        return out;\n    }\n\n    /**\n     * @en Check the equality of the two given vectors\n     * @zh 向量等价判断\n     */\n    public static strictEquals (a: IVec3Like, b: IVec3Like) {\n        return a.x === b.x && a.y === b.y && a.z === b.z;\n    }\n\n    /**\n     * @en Check whether the two given vectors are approximately equivalent\n     * @zh 排除浮点数误差的向量近似等价判断\n     */\n    public static equals (a: IVec3Like, b: IVec3Like, epsilon = EPSILON) {\n        const { x: a0, y: a1, z: a2 } = a;\n        const { x: b0, y: b1, z: b2 } = b;\n        return (\n            Math.abs(a0 - b0)\n            <= epsilon * Math.max(1.0, Math.abs(a0), Math.abs(b0))\n            && Math.abs(a1 - b1)\n            <= epsilon * Math.max(1.0, Math.abs(a1), Math.abs(b1))\n            && Math.abs(a2 - b2)\n            <= epsilon * Math.max(1.0, Math.abs(a2), Math.abs(b2))\n        );\n    }\n\n    /**\n     * @en Calculates the radian angle between two vectors\n     * @zh 求两向量夹角弧度\n     */\n    public static angle (a: IVec3Like, b: IVec3Like) {\n        Vec3.normalize(v3_1, a);\n        Vec3.normalize(v3_2, b);\n        const cosine = Vec3.dot(v3_1, v3_2);\n        if (cosine > 1.0) {\n            return 0;\n        }\n        if (cosine < -1.0) {\n            return Math.PI;\n        }\n        return Math.acos(cosine);\n    }\n\n    /**\n     * @en Calculates the projection vector on the specified plane\n     * @zh 计算向量在指定平面上的投影\n     * @param a projection vector\n     * @param n the normal line of specified plane\n     */\n    public static projectOnPlane<Out extends IVec3Like> (out: Out, a: IVec3Like, n: IVec3Like) {\n        return Vec3.subtract(out, a, Vec3.project(out, a, n));\n    }\n\n    /**\n     * @en Calculates the projection on the specified vector\n     * @zh 计算向量在指定向量上的投影\n     * @param a projection vector\n     * @param n target vector\n     */\n    public static project<Out extends IVec3Like> (out: Out, a: IVec3Like, b: IVec3Like) {\n        const sqrLen = Vec3.lengthSqr(b);\n        if (sqrLen < 0.000001) {\n            return Vec3.set(out, 0, 0, 0);\n        } else {\n            return Vec3.multiplyScalar(out, b, Vec3.dot(a, b) / sqrLen);\n        }\n    }\n\n    /**\n     * @en x component.\n     * @zh x 分量。\n     */\n    public declare x: number;\n\n    /**\n     * @en y component.\n     * @zh y 分量。\n     */\n    public declare y: number;\n\n    /**\n     * @en z component.\n     * @zh z 分量。\n     */\n    public declare z: number;\n\n    constructor (v: Vec3);\n\n    constructor (x?: number, y?: number, z?: number);\n\n    constructor (x?: number | Vec3, y?: number, z?: number) {\n        super();\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n        }\n    }\n\n    /**\n     * @en clone a Vec3 value\n     * @zh 克隆当前向量。\n     */\n    public clone () {\n        return new Vec3(this.x, this.y, this.z);\n    }\n\n    /**\n     * @en Set the current vector value with the given vector.\n     * @zh 设置当前向量使其与指定向量相等。\n     * @param other Specified vector\n     * @returns `this`\n     */\n    public set (other: Vec3): Vec3;\n\n    /**\n     * @en Set the value of each component of the current vector.\n     * @zh 设置当前向量的具体分量值。\n     * @param x x value\n     * @param y y value\n     * @param z z value\n     * @returns `this`\n     */\n    public set (x?: number, y?: number, z?: number): Vec3;\n\n    public set (x?: number | Vec3, y?: number, z?: number) {\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n        }\n        return this;\n    }\n\n    /**\n     * @en Check whether the vector approximately equals another one.\n     * @zh 判断当前向量是否在误差范围内与指定向量相等。\n     * @param other Specified vector\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public equals (other: Vec3, epsilon = EPSILON) {\n        return (\n            Math.abs(this.x - other.x)\n            <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(other.x))\n            && Math.abs(this.y - other.y)\n            <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(other.y))\n            && Math.abs(this.z - other.z)\n            <= epsilon * Math.max(1.0, Math.abs(this.z), Math.abs(other.z))\n        );\n    }\n\n    /**\n     * @en Check whether the vector approximately equals another one.\n     * @zh 判断当前向量是否在误差范围内与指定分量的向量相等。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public equals3f (x: number, y: number, z: number, epsilon = EPSILON) {\n        return (\n            Math.abs(this.x - x)\n            <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(x))\n            && Math.abs(this.y - y)\n            <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(y))\n            && Math.abs(this.z - z)\n            <= epsilon * Math.max(1.0, Math.abs(this.z), Math.abs(z))\n        );\n    }\n\n    /**\n     * @en Check whether the current vector strictly equals another Vec3.\n     * @zh 判断当前向量是否与指定向量相等。\n     * @param other specified vector\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public strictEquals (other: Vec3) {\n        return this.x === other.x && this.y === other.y && this.z === other.z;\n    }\n\n    /**\n     * @en Check whether the current vector strictly equals another Vec3.\n     * @zh 判断当前向量是否与指定分量的向量相等。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     * @returns Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public strictEquals3f (x: number, y: number, z: number) {\n        return this.x === x && this.y === y && this.z === z;\n    }\n\n    /**\n     * @en Transform to string with vector information.\n     * @zh 返回当前向量的字符串表示。\n     * @returns The string with vector information\n     */\n    public toString () {\n        return `(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)})`;\n    }\n\n    /**\n     * @en Calculate linear interpolation result between this vector and another one with given ratio.\n     * @zh 根据指定的插值比率，从当前向量到目标向量之间做插值。\n     * @param to Target vector\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public lerp (to: Vec3, ratio: number) {\n        this.x += ratio * (to.x - this.x);\n        this.y += ratio * (to.y - this.y);\n        this.z += ratio * (to.z - this.z);\n        return this;\n    }\n\n    /**\n     * @en Adds the current vector with another one and return this\n     * @zh 向量加法。将当前向量与指定向量的相加\n     * @param other specified vector\n     */\n    public add (other: Vec3) {\n        this.x += other.x;\n        this.y += other.y;\n        this.z += other.z;\n        return this;\n    }\n\n    /**\n     * @en Adds the current vector with another one and return this\n     * @zh 向量加法。将当前向量与指定分量的向量相加\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     */\n    public add3f (x: number, y: number, z: number) {\n        this.x += x;\n        this.y += y;\n        this.z += z;\n        return this;\n    }\n\n    /**\n     * @en Subtracts one vector from this, and returns this.\n     * @zh 向量减法。将当前向量减去指定向量的结果。\n     * @param other specified vector\n     */\n    public subtract (other: Vec3) {\n        this.x -= other.x;\n        this.y -= other.y;\n        this.z -= other.z;\n        return this;\n    }\n\n    /**\n     * @en Subtracts one vector from this, and returns this.\n     * @zh 向量减法。将当前向量减去指定分量的向量\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     */\n    public subtract3f (x: number, y: number, z: number) {\n        this.x -= x;\n        this.y -= y;\n        this.z -= z;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with a number, and returns this.\n     * @zh 向量数乘。将当前向量数乘指定标量\n     * @param scalar scalar number\n     */\n    public multiplyScalar (scalar: number) {\n        if (typeof scalar === 'object') { console.warn('should use Vec3.multiply for vector * vector operation'); }\n        this.x *= scalar;\n        this.y *= scalar;\n        this.z *= scalar;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with another one and return this\n     * @zh 向量乘法。将当前向量乘以与指定向量的结果赋值给当前向量。\n     * @param other specified vector\n     */\n    public multiply (other: Vec3) {\n        if (typeof other !== 'object') { console.warn('should use Vec3.scale for vector * scalar operation'); }\n        this.x *= other.x;\n        this.y *= other.y;\n        this.z *= other.z;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with another one and return this\n     * @zh 向量乘法。将当前向量与指定分量的向量相乘的结果赋值给当前向量。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     */\n    public multiply3f (x: number, y: number, z: number) {\n        this.x *= x;\n        this.y *= y;\n        this.z *= z;\n        return this;\n    }\n\n    /**\n     * @en Element-wisely divides this vector with another one, and return this.\n     * @zh 向量逐元素相除。将当前向量与指定分量的向量相除的结果赋值给当前向量。\n     * @param other specified vector\n     */\n    public divide (other: Vec3) {\n        this.x /= other.x;\n        this.y /= other.y;\n        this.z /= other.z;\n        return this;\n    }\n\n    /**\n     * @en Element-wisely divides this vector with another one, and return this.\n     * @zh 向量逐元素相除。将当前向量与指定分量的向量相除的结果赋值给当前向量。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param z The z value of specified vector\n     */\n    public divide3f (x: number, y: number, z: number) {\n        this.x /= x;\n        this.y /= y;\n        this.z /= z;\n        return this;\n    }\n\n    /**\n     * @en Sets each component of this vector with its negative value\n     * @zh 将当前向量的各个分量取反\n     */\n    public negative () {\n        this.x = -this.x;\n        this.y = -this.y;\n        this.z = -this.z;\n        return this;\n    }\n\n    /**\n     * @en Clamp the vector between minInclusive and maxInclusive.\n     * @zh 设置当前向量的值，使其各个分量都处于指定的范围内。\n     * @param minInclusive Minimum value allowed\n     * @param maxInclusive Maximum value allowed\n     * @returns `this`\n     */\n    public clampf (minInclusive: Vec3, maxInclusive: Vec3) {\n        this.x = clamp(this.x, minInclusive.x, maxInclusive.x);\n        this.y = clamp(this.y, minInclusive.y, maxInclusive.y);\n        this.z = clamp(this.z, minInclusive.z, maxInclusive.z);\n        return this;\n    }\n\n    /**\n     * @en Calculates the dot product with another vector\n     * @zh 向量点乘。\n     * @param other specified vector\n     * @returns The result of calculates the dot product with another vector\n     */\n    public dot (other: Vec3) {\n        return this.x * other.x + this.y * other.y + this.z * other.z;\n    }\n\n    /**\n     * @en Calculates the cross product with another vector.\n     * @zh 向量叉乘。将当前向量左叉乘指定向量\n     * @param other specified vector\n     */\n    public cross (other: Vec3) {\n        const { x: ax, y: ay, z: az } = this;\n        const { x: bx, y: by, z: bz } = other;\n\n        this.x = ay * bz - az * by;\n        this.y = az * bx - ax * bz;\n        this.z = ax * by - ay * bx;\n        return this;\n    }\n\n    /**\n     * @en Returns the length of this vector.\n     * @zh 计算向量的长度（模）。\n     * @returns Length of vector\n     */\n    public length () {\n        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n    }\n\n    /**\n     * @en Returns the squared length of this vector.\n     * @zh 计算向量长度（模）的平方。\n     * @returns the squared length of this vector\n     */\n    public lengthSqr () {\n        return this.x * this.x + this.y * this.y + this.z * this.z;\n    }\n\n    /**\n     * @en Normalize the current vector.\n     * @zh 将当前向量归一化\n     */\n    public normalize () {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n\n        let len = x * x + y * y + z * z;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            this.x = x * len;\n            this.y = y * len;\n            this.z = z * len;\n        }\n        return this;\n    }\n\n    /**\n     * @en Transforms the vec3 with a mat4. 4th vector component is implicitly '1'\n     * @zh 将当前向量视为 w 分量为 1 的四维向量，应用四维矩阵变换到当前矩阵\n     * @param matrix matrix to transform with\n     */\n    public transformMat4 (matrix: Mat4) {\n        const x = this.x;\n        const y = this.y;\n        const z = this.z;\n        let rhw = matrix.m03 * x + matrix.m07 * y + matrix.m11 * z + matrix.m15;\n        rhw = rhw ? 1 / rhw : 1;\n        this.x = (matrix.m00 * x + matrix.m04 * y + matrix.m08 * z + matrix.m12) * rhw;\n        this.y = (matrix.m01 * x + matrix.m05 * y + matrix.m09 * z + matrix.m13) * rhw;\n        this.z = (matrix.m02 * x + matrix.m06 * y + matrix.m10 * z + matrix.m14) * rhw;\n        return this;\n    }\n}\n\nconst v3_1 = new Vec3();\nconst v3_2 = new Vec3();\n\nCCClass.fastDefine('cc.Vec3', Vec3, { x: 0, y: 0, z: 0 });\nlegacyCC.Vec3 = Vec3;\n\nexport function v3 (other: Vec3): Vec3;\nexport function v3 (x?: number, y?: number, z?: number): Vec3;\n\nexport function v3 (x?: number | Vec3, y?: number, z?: number) {\n    return new Vec3(x as any, y, z);\n}\n\nlegacyCC.v3 = v3;\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Quat } from './quat';\nimport { IMat3Like, IMat4Like, IQuatLike, IVec2Like, IVec3Like } from './type-define';\nimport { EPSILON } from './utils';\nimport { Vec3 } from './vec3';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Mathematical 3x3 matrix.\n * @zh 表示三维（3x3）矩阵。\n */\n\nexport class Mat3 extends ValueType {\n    public static IDENTITY = Object.freeze(new Mat3());\n\n    /**\n     * @en Clone a matrix and save the results to out matrix\n     * @zh 获得指定矩阵的拷贝\n     */\n    public static clone <Out extends IMat3Like> (a: Out) {\n        return new Mat3(\n            a.m00, a.m01, a.m02,\n            a.m03, a.m04, a.m05,\n            a.m06, a.m07, a.m08,\n        );\n    }\n\n    /**\n     * @en Copy content of a matrix into another and save the results to out matrix\n     * @zh 复制目标矩阵\n     */\n    public static copy <Out extends IMat3Like> (out: Out, a: Out) {\n        out.m00 = a.m00;\n        out.m01 = a.m01;\n        out.m02 = a.m02;\n        out.m03 = a.m03;\n        out.m04 = a.m04;\n        out.m05 = a.m05;\n        out.m06 = a.m06;\n        out.m07 = a.m07;\n        out.m08 = a.m08;\n        return out;\n    }\n\n    /**\n     * @en Sets the elements of a matrix with the given values and save the results to out matrix\n     * @zh 设置矩阵值\n     */\n    public static set <Out extends IMat3Like>  (\n        out: Out,\n        m00: number, m01: number, m02: number,\n        m10: number, m11: number, m12: number,\n        m20: number, m21: number, m22: number,\n    ) {\n        out.m00 = m00; out.m01 = m01; out.m02 = m02;\n        out.m03 = m10; out.m04 = m11; out.m05 = m12;\n        out.m06 = m20; out.m07 = m21; out.m08 = m22;\n        return out;\n    }\n\n    /**\n     * @en Reset the out matrix to an identity matrix\n     * @zh 将目标赋值为单位矩阵\n     */\n    public static identity <Out extends IMat3Like> (out: Out) {\n        out.m00 = 1;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 1;\n        out.m05 = 0;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 1;\n        return out;\n    }\n\n    /**\n     * @en Transposes a matrix and save the results to out matrix\n     * @zh 转置矩阵\n     */\n    public static transpose <Out extends IMat3Like> (out: Out, a: Out) {\n        // If we are transposing ourselves we can skip a few steps but have to cache some values\n        if (out === a) {\n            const a01 = a.m01;\n            const a02 = a.m02;\n            const a12 = a.m05;\n            out.m01 = a.m03;\n            out.m02 = a.m06;\n            out.m03 = a01;\n            out.m05 = a.m07;\n            out.m06 = a02;\n            out.m07 = a12;\n        } else {\n            out.m00 = a.m00;\n            out.m01 = a.m03;\n            out.m02 = a.m06;\n            out.m03 = a.m01;\n            out.m04 = a.m04;\n            out.m05 = a.m07;\n            out.m06 = a.m02;\n            out.m07 = a.m05;\n            out.m08 = a.m08;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Inverts a matrix. When matrix is not invertible the matrix will be set to zeros.\n     * @zh 矩阵求逆，注意，在矩阵不可逆时，会返回一个全为 0 的矩阵。\n     */\n    public static invert <Out extends IMat3Like> (out: Out, a: Out) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02;\n        const a10 = a.m03; const a11 = a.m04; const a12 = a.m05;\n        const a20 = a.m06; const a21 = a.m07; const a22 = a.m08;\n\n        const b01 = a22 * a11 - a12 * a21;\n        const b11 = -a22 * a10 + a12 * a20;\n        const b21 = a21 * a10 - a11 * a20;\n\n        // Calculate the determinant\n        let det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        if (det === 0) {\n            out.m00 = 0; out.m01 = 0; out.m02 = 0;\n            out.m03 = 0; out.m04 = 0; out.m05 = 0;\n            out.m06 = 0; out.m07 = 0; out.m08 = 0;\n            return out;\n        }\n        det = 1.0 / det;\n\n        out.m00 = b01 * det;\n        out.m01 = (-a22 * a01 + a02 * a21) * det;\n        out.m02 = (a12 * a01 - a02 * a11) * det;\n        out.m03 = b11 * det;\n        out.m04 = (a22 * a00 - a02 * a20) * det;\n        out.m05 = (-a12 * a00 + a02 * a10) * det;\n        out.m06 = b21 * det;\n        out.m07 = (-a21 * a00 + a01 * a20) * det;\n        out.m08 = (a11 * a00 - a01 * a10) * det;\n        return out;\n    }\n\n    /**\n     * @en Calculates the determinant of a matrix\n     * @zh 矩阵行列式\n     */\n    public static determinant <Out extends IMat3Like> (a: Out) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02;\n        const a10 = a.m03; const a11 = a.m04; const a12 = a.m05;\n        const a20 = a.m06; const a21 = a.m07; const a22 = a.m08;\n\n        return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n    }\n\n    /**\n     * @en Multiply two matrices explicitly and save the results to out matrix\n     * @zh 矩阵乘法\n     */\n    public static multiply <Out extends IMat3Like> (out: Out, a: Out, b: Out) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02;\n        const a10 = a.m03; const a11 = a.m04; const a12 = a.m05;\n        const a20 = a.m06; const a21 = a.m07; const a22 = a.m08;\n\n        const b00 = b.m00; const b01 = b.m01; const b02 = b.m02;\n        const b10 = b.m03; const b11 = b.m04; const b12 = b.m05;\n        const b20 = b.m06; const b21 = b.m07; const b22 = b.m08;\n\n        out.m00 = b00 * a00 + b01 * a10 + b02 * a20;\n        out.m01 = b00 * a01 + b01 * a11 + b02 * a21;\n        out.m02 = b00 * a02 + b01 * a12 + b02 * a22;\n\n        out.m03 = b10 * a00 + b11 * a10 + b12 * a20;\n        out.m04 = b10 * a01 + b11 * a11 + b12 * a21;\n        out.m05 = b10 * a02 + b11 * a12 + b12 * a22;\n\n        out.m06 = b20 * a00 + b21 * a10 + b22 * a20;\n        out.m07 = b20 * a01 + b21 * a11 + b22 * a21;\n        out.m08 = b20 * a02 + b21 * a12 + b22 * a22;\n        return out;\n    }\n\n    /**\n     * @en Take the first third order of the fourth order matrix and multiply by the third order matrix\n     * @zh 取四阶矩阵的前三阶，与三阶矩阵相乘\n     */\n    public static multiplyMat4 <Out extends IMat3Like> (out: Out, a: Out, b: IMat4Like) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02;\n        const a10 = a.m03; const a11 = a.m04; const a12 = a.m05;\n        const a20 = a.m06; const a21 = a.m07; const a22 = a.m08;\n\n        const b00 = b.m00; const b01 = b.m01; const b02 = b.m02;\n        const b10 = b.m04; const b11 = b.m05; const b12 = b.m06;\n        const b20 = b.m08; const b21 = b.m09; const b22 = b.m10;\n\n        out.m00 = b00 * a00 + b01 * a10 + b02 * a20;\n        out.m01 = b00 * a01 + b01 * a11 + b02 * a21;\n        out.m02 = b00 * a02 + b01 * a12 + b02 * a22;\n\n        out.m03 = b10 * a00 + b11 * a10 + b12 * a20;\n        out.m04 = b10 * a01 + b11 * a11 + b12 * a21;\n        out.m05 = b10 * a02 + b11 * a12 + b12 * a22;\n\n        out.m06 = b20 * a00 + b21 * a10 + b22 * a20;\n        out.m07 = b20 * a01 + b21 * a11 + b22 * a21;\n        out.m08 = b20 * a02 + b21 * a12 + b22 * a22;\n        return out;\n    }\n\n    /**\n     * @en Multiply a matrix with a translation vector given by a translation offset.\n     * @zh 在给定矩阵变换基础上加入变换\n     */\n    public static transform <Out extends IMat3Like, VecLike extends IVec3Like> (out: Out, a: Out, v: VecLike) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02;\n        const a10 = a.m03; const a11 = a.m04; const a12 = a.m05;\n        const a20 = a.m06; const a21 = a.m07; const a22 = a.m08;\n        const x = v.x; const y = v.y;\n\n        out.m00 = a00;\n        out.m01 = a01;\n        out.m02 = a02;\n\n        out.m03 = a10;\n        out.m04 = a11;\n        out.m05 = a12;\n\n        out.m06 = x * a00 + y * a10 + a20;\n        out.m07 = x * a01 + y * a11 + a21;\n        out.m08 = x * a02 + y * a12 + a22;\n        return out;\n    }\n\n    /**\n     * @en Multiply a matrix with a scale matrix given by a scale vector and save the results to out matrix\n     * @zh 在给定矩阵变换基础上加入新缩放变换\n     */\n    public static scale <Out extends IMat3Like, VecLike extends IVec3Like> (out: Out, a: Out, v: VecLike) {\n        const x = v.x; const y = v.y;\n\n        out.m00 = x * a.m00;\n        out.m01 = x * a.m01;\n        out.m02 = x * a.m02;\n\n        out.m03 = y * a.m03;\n        out.m04 = y * a.m04;\n        out.m05 = y * a.m05;\n\n        out.m06 = a.m06;\n        out.m07 = a.m07;\n        out.m08 = a.m08;\n        return out;\n    }\n\n    /**\n     * @en Rotates the transform by the given angle and save the results into the out matrix\n     * @zh 在给定矩阵变换基础上加入新旋转变换\n     * @param rad radius of rotation\n     */\n    public static rotate <Out extends IMat3Like> (out: Out, a: Out, rad: number) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02;\n        const a10 = a.m03; const a11 = a.m04; const a12 = a.m05;\n        const a20 = a.m06; const a21 = a.m07; const a22 = a.m08;\n\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n\n        out.m00 = c * a00 + s * a10;\n        out.m01 = c * a01 + s * a11;\n        out.m02 = c * a02 + s * a12;\n\n        out.m03 = c * a10 - s * a00;\n        out.m04 = c * a11 - s * a01;\n        out.m05 = c * a12 - s * a02;\n\n        out.m06 = a20;\n        out.m07 = a21;\n        out.m08 = a22;\n        return out;\n    }\n\n    /**\n     * @en Copies the first third order matrix of a fourth order matrix to the out third order matrix\n     * @zh 取四阶矩阵的前三阶\n     */\n    public static fromMat4 <Out extends IMat3Like> (out: Out, a: IMat4Like) {\n        out.m00 = a.m00;\n        out.m01 = a.m01;\n        out.m02 = a.m02;\n        out.m03 = a.m04;\n        out.m04 = a.m05;\n        out.m05 = a.m06;\n        out.m06 = a.m08;\n        out.m07 = a.m09;\n        out.m08 = a.m10;\n        return out;\n    }\n\n    /**\n     * @en Sets a third order matrix with view direction and up direction. Then save the results to out matrix\n     * @zh 根据视口前方向和上方向计算矩阵\n     * @param view The view direction, it`s must be normalized.\n     * @param up The view up direction, it`s must be normalized, default value is (0, 1, 0).\n     */\n    public static fromViewUp <Out extends IMat3Like, VecLike extends IVec3Like> (out: Out, view: VecLike, up?: Vec3) {\n        if (Vec3.lengthSqr(view) < EPSILON * EPSILON) {\n            Mat3.identity(out);\n            return out;\n        }\n\n        up = up || Vec3.UNIT_Y;\n        Vec3.normalize(v3_1, Vec3.cross(v3_1, up, view));\n\n        if (Vec3.lengthSqr(v3_1) < EPSILON * EPSILON) {\n            Mat3.identity(out);\n            return out;\n        }\n\n        Vec3.cross(v3_2, view, v3_1);\n        Mat3.set(\n            out,\n            v3_1.x, v3_1.y, v3_1.z,\n            v3_2.x, v3_2.y, v3_2.z,\n            view.x, view.y, view.z,\n        );\n\n        return out;\n    }\n\n    /**\n     * @en Sets the given matrix with a translation vector and save the results to out matrix\n     * @zh 计算位移矩阵\n     */\n    public static fromTranslation <Out extends IMat3Like, VecLike extends IVec2Like> (out: Out, v: VecLike) {\n        out.m00 = 1;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 1;\n        out.m05 = 0;\n        out.m06 = v.x;\n        out.m07 = v.y;\n        out.m08 = 1;\n        return out;\n    }\n\n    /**\n     * @en Sets the given matrix with a scale vector and save the results to out matrix\n     * @zh 计算缩放矩阵\n     */\n    public static fromScaling <Out extends IMat3Like, VecLike extends IVec2Like> (out: Out, v: VecLike) {\n        out.m00 = v.x;\n        out.m01 = 0;\n        out.m02 = 0;\n\n        out.m03 = 0;\n        out.m04 = v.y;\n        out.m05 = 0;\n\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 1;\n        return out;\n    }\n\n    /**\n     * @en Sets the given matrix with a given angle and save the results to out matrix\n     * @zh 计算旋转矩阵\n     */\n    public static fromRotation <Out extends IMat3Like> (out: Out, rad: number) {\n        const s = Math.sin(rad); const c = Math.cos(rad);\n\n        out.m00 = c;\n        out.m01 = s;\n        out.m02 = 0;\n\n        out.m03 = -s;\n        out.m04 = c;\n        out.m05 = 0;\n\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 1;\n        return out;\n    }\n\n    /**\n     * @en Sets the given matrix with the given quaternion and save the results to out matrix\n     * @zh 根据四元数旋转信息计算矩阵\n     */\n    public static fromQuat <Out extends IMat3Like> (out: Out, q: IQuatLike) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const yx = y * x2;\n        const yy = y * y2;\n        const zx = z * x2;\n        const zy = z * y2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n\n        out.m00 = 1 - yy - zz;\n        out.m03 = yx - wz;\n        out.m06 = zx + wy;\n\n        out.m01 = yx + wz;\n        out.m04 = 1 - xx - zz;\n        out.m07 = zy - wx;\n\n        out.m02 = zx - wy;\n        out.m05 = zy + wx;\n        out.m08 = 1 - xx - yy;\n\n        return out;\n    }\n\n    /**\n     * @en Calculates the upper-left 3x3 matrix of a 4x4 matrix's inverse transpose\n     * @zh 计算指定四维矩阵的逆转置三维矩阵\n     */\n    public static inverseTransposeMat4 <Out extends IMat3Like> (out: Out, a: IMat4Like) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n        const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n        const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n        const a30 = a.m12; const a31 = a.m13; const a32 = a.m14; const a33 = a.m15;\n\n        const b00 = a00 * a11 - a01 * a10;\n        const b01 = a00 * a12 - a02 * a10;\n        const b02 = a00 * a13 - a03 * a10;\n        const b03 = a01 * a12 - a02 * a11;\n        const b04 = a01 * a13 - a03 * a11;\n        const b05 = a02 * a13 - a03 * a12;\n        const b06 = a20 * a31 - a21 * a30;\n        const b07 = a20 * a32 - a22 * a30;\n        const b08 = a20 * a33 - a23 * a30;\n        const b09 = a21 * a32 - a22 * a31;\n        const b10 = a21 * a33 - a23 * a31;\n        const b11 = a22 * a33 - a23 * a32;\n\n        // Calculate the determinant\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        if (!det) {\n            return null;\n        }\n        det = 1.0 / det;\n\n        out.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n        out.m01 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n        out.m02 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n\n        out.m03 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n        out.m04 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n        out.m05 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n\n        out.m06 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n        out.m07 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n        out.m08 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix object to a flat array\n     * @zh 矩阵转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray <Out extends IWritableArrayLike<number>> (out: Out, m: IMat3Like, ofs = 0) {\n        out[ofs + 0] = m.m00;\n        out[ofs + 1] = m.m01;\n        out[ofs + 2] = m.m02;\n        out[ofs + 3] = m.m03;\n        out[ofs + 4] = m.m04;\n        out[ofs + 5] = m.m05;\n        out[ofs + 6] = m.m06;\n        out[ofs + 7] = m.m07;\n        out[ofs + 8] = m.m08;\n        return out;\n    }\n\n    /**\n     * @en Generates or sets a matrix with a flat array\n     * @zh 数组转矩阵\n     * @param ofs Array Start Offset\n     */\n    public static fromArray <Out extends IMat3Like> (out: Out, arr: IWritableArrayLike<number>, ofs = 0) {\n        out.m00 = arr[ofs + 0];\n        out.m01 = arr[ofs + 1];\n        out.m02 = arr[ofs + 2];\n        out.m03 = arr[ofs + 3];\n        out.m04 = arr[ofs + 4];\n        out.m05 = arr[ofs + 5];\n        out.m06 = arr[ofs + 6];\n        out.m07 = arr[ofs + 7];\n        out.m08 = arr[ofs + 8];\n        return out;\n    }\n\n    /**\n     * @en Adds two matrices and save the results to out matrix\n     * @zh 逐元素矩阵加法\n     */\n    public static add <Out extends IMat3Like> (out: Out, a: Out, b: Out) {\n        out.m00 = a.m00 + b.m00;\n        out.m01 = a.m01 + b.m01;\n        out.m02 = a.m02 + b.m02;\n        out.m03 = a.m03 + b.m03;\n        out.m04 = a.m04 + b.m04;\n        out.m05 = a.m05 + b.m05;\n        out.m06 = a.m06 + b.m06;\n        out.m07 = a.m07 + b.m07;\n        out.m08 = a.m08 + b.m08;\n        return out;\n    }\n\n    /**\n     * @en Subtracts matrix b from matrix a and save the results to out matrix\n     * @zh 逐元素矩阵减法\n     */\n    public static subtract <Out extends IMat3Like> (out: Out, a: Out, b: Out) {\n        out.m00 = a.m00 - b.m00;\n        out.m01 = a.m01 - b.m01;\n        out.m02 = a.m02 - b.m02;\n        out.m03 = a.m03 - b.m03;\n        out.m04 = a.m04 - b.m04;\n        out.m05 = a.m05 - b.m05;\n        out.m06 = a.m06 - b.m06;\n        out.m07 = a.m07 - b.m07;\n        out.m08 = a.m08 - b.m08;\n        return out;\n    }\n\n    /**\n     * @en Multiply each element of a matrix by a scalar number and save the results to out matrix\n     * @zh 矩阵标量乘法\n     */\n    public static multiplyScalar <Out extends IMat3Like> (out: Out, a: Out, b: number) {\n        out.m00 = a.m00 * b;\n        out.m01 = a.m01 * b;\n        out.m02 = a.m02 * b;\n        out.m03 = a.m03 * b;\n        out.m04 = a.m04 * b;\n        out.m05 = a.m05 * b;\n        out.m06 = a.m06 * b;\n        out.m07 = a.m07 * b;\n        out.m08 = a.m08 * b;\n        return out;\n    }\n\n    /**\n     * @en Adds two matrices after multiplying each element of the second operand by a scalar number. And save the results to out matrix.\n     * @zh 逐元素矩阵标量乘加: A + B * scale\n     */\n    public static multiplyScalarAndAdd <Out extends IMat3Like> (out: Out, a: Out, b: Out, scale: number) {\n        out.m00 = b.m00 * scale + a.m00;\n        out.m01 = b.m01 * scale + a.m01;\n        out.m02 = b.m02 * scale + a.m02;\n        out.m03 = b.m03 * scale + a.m03;\n        out.m04 = b.m04 * scale + a.m04;\n        out.m05 = b.m05 * scale + a.m05;\n        out.m06 = b.m06 * scale + a.m06;\n        out.m07 = b.m07 * scale + a.m07;\n        out.m08 = b.m08 * scale + a.m08;\n        return out;\n    }\n\n    /**\n     * @en Returns whether the specified matrices are equal.\n     * @zh 矩阵等价判断\n     */\n    public static strictEquals <Out extends IMat3Like> (a: Out, b: Out) {\n        return a.m00 === b.m00 && a.m01 === b.m01 && a.m02 === b.m02\n            && a.m03 === b.m03 && a.m04 === b.m04 && a.m05 === b.m05\n            && a.m06 === b.m06 && a.m07 === b.m07 && a.m08 === b.m08;\n    }\n\n    /**\n     * @en Returns whether the specified matrices are approximately equal.\n     * @zh 排除浮点数误差的矩阵近似等价判断\n     */\n    public static equals <Out extends IMat3Like> (a: Out, b: Out, epsilon = EPSILON) {\n        return (\n            Math.abs(a.m00 - b.m00) <= epsilon * Math.max(1.0, Math.abs(a.m00), Math.abs(b.m00))\n            && Math.abs(a.m01 - b.m01) <= epsilon * Math.max(1.0, Math.abs(a.m01), Math.abs(b.m01))\n            && Math.abs(a.m02 - b.m02) <= epsilon * Math.max(1.0, Math.abs(a.m02), Math.abs(b.m02))\n            && Math.abs(a.m03 - b.m03) <= epsilon * Math.max(1.0, Math.abs(a.m03), Math.abs(b.m03))\n            && Math.abs(a.m04 - b.m04) <= epsilon * Math.max(1.0, Math.abs(a.m04), Math.abs(b.m04))\n            && Math.abs(a.m05 - b.m05) <= epsilon * Math.max(1.0, Math.abs(a.m05), Math.abs(b.m05))\n            && Math.abs(a.m06 - b.m06) <= epsilon * Math.max(1.0, Math.abs(a.m06), Math.abs(b.m06))\n            && Math.abs(a.m07 - b.m07) <= epsilon * Math.max(1.0, Math.abs(a.m07), Math.abs(b.m07))\n            && Math.abs(a.m08 - b.m08) <= epsilon * Math.max(1.0, Math.abs(a.m08), Math.abs(b.m08))\n        );\n    }\n\n    /**\n     * @en Value at column 0 row 0 of the matrix.\n     * @zh 矩阵第 0 列第 0 行的元素。\n     */\n    public declare m00: number;\n\n    /**\n     * @en Value at column 0 row 1 of the matrix.\n     * @zh 矩阵第 0 列第 1 行的元素。\n     */\n    public declare m01: number;\n\n    /**\n     * @en Value at column 0 row 2 of the matrix.\n     * @zh 矩阵第 0 列第 2 行的元素。\n     */\n    public declare m02: number;\n\n    /**\n     * @en Value at column 1 row 0 of the matrix.\n     * @zh 矩阵第 1 列第 0 行的元素。\n     */\n    public declare m03: number;\n\n    /**\n     * @en Value at column 1 row 1 of the matrix.\n     * @zh 矩阵第 1 列第 1 行的元素。\n     */\n    public declare m04: number;\n\n    /**\n     * @en Value at column 1 row 2 of the matrix.\n     * @zh 矩阵第 1 列第 2 行的元素。\n     */\n    public declare m05: number;\n\n    /**\n     * @en Value at column 2 row 0 of the matrix.\n     * @zh 矩阵第 2 列第 0 行的元素。\n     */\n    public declare m06: number;\n\n    /**\n     * @en Value at column 2 row 1 of the matrix.\n     * @zh 矩阵第 2 列第 1 行的元素。\n     */\n    public declare m07: number;\n\n    /**\n     * @en Value at column 2 row 2 of the matrix.\n     * @zh 矩阵第 2 列第 2 行的元素。\n     */\n    public declare m08: number;\n\n    constructor (other: Mat3);\n\n    constructor (\n        m00?: number, m01?: number, m02?: number,\n        m03?: number, m04?: number, m05?: number,\n        m06?: number, m07?: number, m08?: number);\n\n    constructor (\n        m00: number | Mat3 = 1, m01 = 0, m02 = 0,\n        m03 = 0, m04 = 1, m05 = 0,\n        m06 = 0, m07 = 0, m08 = 1,\n    ) {\n        super();\n        if (typeof m00 === 'object') {\n            this.m00 = m00.m00; this.m01 = m00.m01; this.m02 = m00.m02;\n            this.m03 = m00.m03; this.m04 = m00.m04; this.m05 = m00.m05;\n            this.m06 = m00.m06; this.m07 = m00.m07; this.m08 = m00.m08;\n        } else {\n            this.m00 = m00; this.m01 = m01; this.m02 = m02;\n            this.m03 = m03; this.m04 = m04; this.m05 = m05;\n            this.m06 = m06; this.m07 = m07; this.m08 = m08;\n        }\n    }\n\n    /**\n     * @en Clone a new matrix from the current matrix.\n     * @zh 克隆当前矩阵。\n     */\n    public clone () {\n        const t = this;\n        return new Mat3(\n            t.m00, t.m01, t.m02,\n            t.m03, t.m04, t.m05,\n            t.m06, t.m07, t.m08,\n        );\n    }\n\n    /**\n     * @en Sets the matrix with another one's value.\n     * @zh 设置当前矩阵使其与指定矩阵相等。\n     * @param other Specified matrix\n     * @return this\n     */\n    public set (other: Mat3): Mat3;\n\n    /**\n     * @en Set the matrix with values of all elements\n     * @zh 设置当前矩阵指定元素值。\n     * @return this\n     */\n    public set (m00?: number, m01?: number, m02?: number,\n        m03?: number, m04?: number, m05?: number,\n        m06?: number, m07?: number, m08?: number): Mat3;\n\n    public set (m00: number | Mat3 = 1, m01 = 0, m02 = 0,\n        m03 = 0, m04 = 1, m05 = 0,\n        m06 = 0, m07 = 0, m08 = 1) {\n        if (typeof m00 === 'object') {\n            this.m00 = m00.m00; this.m01 = m00.m01; this.m02 = m00.m02;\n            this.m03 = m00.m03; this.m04 = m00.m04; this.m05 = m00.m05;\n            this.m06 = m00.m06; this.m07 = m00.m07; this.m08 = m00.m08;\n        } else {\n            this.m00 = m00; this.m01 = m01; this.m02 = m02;\n            this.m03 = m03; this.m04 = m04; this.m05 = m05;\n            this.m06 = m06; this.m07 = m07; this.m08 = m08;\n        }\n        return this;\n    }\n\n    /**\n     * @en Returns whether the specified matrices are approximately equal.\n     * @zh 判断当前矩阵是否在误差范围内与指定矩阵相等。\n     * @param other Comparative matrix\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @return Returns `true' when the elements of both matrices are equal; otherwise returns `false'.\n     */\n    public equals (other: Mat3, epsilon = EPSILON): boolean {\n        return (\n            Math.abs(this.m00 - other.m00) <= epsilon * Math.max(1.0, Math.abs(this.m00), Math.abs(other.m00))\n            && Math.abs(this.m01 - other.m01) <= epsilon * Math.max(1.0, Math.abs(this.m01), Math.abs(other.m01))\n            && Math.abs(this.m02 - other.m02) <= epsilon * Math.max(1.0, Math.abs(this.m02), Math.abs(other.m02))\n            && Math.abs(this.m03 - other.m03) <= epsilon * Math.max(1.0, Math.abs(this.m03), Math.abs(other.m03))\n            && Math.abs(this.m04 - other.m04) <= epsilon * Math.max(1.0, Math.abs(this.m04), Math.abs(other.m04))\n            && Math.abs(this.m05 - other.m05) <= epsilon * Math.max(1.0, Math.abs(this.m05), Math.abs(other.m05))\n            && Math.abs(this.m06 - other.m06) <= epsilon * Math.max(1.0, Math.abs(this.m06), Math.abs(other.m06))\n            && Math.abs(this.m07 - other.m07) <= epsilon * Math.max(1.0, Math.abs(this.m07), Math.abs(other.m07))\n            && Math.abs(this.m08 - other.m08) <= epsilon * Math.max(1.0, Math.abs(this.m08), Math.abs(other.m08))\n        );\n    }\n\n    /**\n     * @en Returns whether the specified matrices are equal.\n     * @zh 判断当前矩阵是否与指定矩阵相等。\n     * @param other Comparative matrix\n     * @return Returns `true' when the elements of both matrices are equal; otherwise returns `false'.\n     */\n    public strictEquals (other: Mat3): boolean {\n        return this.m00 === other.m00 && this.m01 === other.m01 && this.m02 === other.m02\n            && this.m03 === other.m03 && this.m04 === other.m04 && this.m05 === other.m05\n            && this.m06 === other.m06 && this.m07 === other.m07 && this.m08 === other.m08;\n    }\n\n    /**\n     * @en Returns a string representation of a matrix.\n     * @zh 返回当前矩阵的字符串表示。\n     * @return The string representation of this matrix\n     */\n    public toString () {\n        const t = this;\n        return `[\\n${\n            t.m00}, ${t.m01}, ${t.m02},\\n${\n            t.m03},\\n${t.m04}, ${t.m05},\\n${\n            t.m06}, ${t.m07},\\n${t.m08}\\n`\n            + `]`;\n    }\n\n    /**\n     * @en set the current matrix to an identity matrix.\n     * @zh 将当前矩阵设为单位矩阵。\n     * @return `this`\n     */\n    public identity () {\n        this.m00 = 1;\n        this.m01 = 0;\n        this.m02 = 0;\n        this.m03 = 0;\n        this.m04 = 1;\n        this.m05 = 0;\n        this.m06 = 0;\n        this.m07 = 0;\n        this.m08 = 1;\n        return this;\n    }\n\n    /**\n     * @en Transposes the current matrix.\n     * @zh 计算当前矩阵的转置矩阵。\n     */\n    public transpose () {\n        const a01 = this.m01; const a02 = this.m02; const a12 = this.m05;\n        this.m01 = this.m03;\n        this.m02 = this.m06;\n        this.m03 = a01;\n        this.m05 = this.m07;\n        this.m06 = a02;\n        this.m07 = a12;\n        return this;\n    }\n\n    /**\n     * @en Inverts the current matrix. When matrix is not invertible the matrix will be set to zeros.\n     * @zh 计算当前矩阵的逆矩阵。注意，在矩阵不可逆时，会返回一个全为 0 的矩阵。\n     */\n    public invert () {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02;\n        const a10 = this.m03; const a11 = this.m04; const a12 = this.m05;\n        const a20 = this.m06; const a21 = this.m07; const a22 = this.m08;\n\n        const b01 = a22 * a11 - a12 * a21;\n        const b11 = -a22 * a10 + a12 * a20;\n        const b21 = a21 * a10 - a11 * a20;\n\n        // Calculate the determinant\n        let det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        if (det === 0) {\n            this.set(0, 0, 0, 0, 0, 0, 0, 0, 0);\n            return this;\n        }\n        det = 1.0 / det;\n\n        this.m00 = b01 * det;\n        this.m01 = (-a22 * a01 + a02 * a21) * det;\n        this.m02 = (a12 * a01 - a02 * a11) * det;\n        this.m03 = b11 * det;\n        this.m04 = (a22 * a00 - a02 * a20) * det;\n        this.m05 = (-a12 * a00 + a02 * a10) * det;\n        this.m06 = b21 * det;\n        this.m07 = (-a21 * a00 + a01 * a20) * det;\n        this.m08 = (a11 * a00 - a01 * a10) * det;\n        return this;\n    }\n\n    /**\n     * @en Calculates the determinant of the current matrix.\n     * @zh 计算当前矩阵的行列式。\n     * @return 当前矩阵的行列式。\n     */\n    public determinant (): number {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02;\n        const a10 = this.m03; const a11 = this.m04; const a12 = this.m05;\n        const a20 = this.m06; const a21 = this.m07; const a22 = this.m08;\n\n        return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n    }\n\n    /**\n     * @en Adds the current matrix and another matrix to the current matrix.\n     * @zh 矩阵加法。将当前矩阵与指定矩阵的相加，结果返回给当前矩阵。\n     * @param mat the second operand\n     */\n    public add (mat: Mat3) {\n        this.m00 += mat.m00;\n        this.m01 += mat.m01;\n        this.m02 += mat.m02;\n        this.m03 += mat.m03;\n        this.m04 += mat.m04;\n        this.m05 += mat.m05;\n        this.m06 += mat.m06;\n        this.m07 += mat.m07;\n        this.m08 += mat.m08;\n        return this;\n    }\n\n    /**\n     * @en Subtracts another matrix from the current matrix.\n     * @zh 计算矩阵减法。将当前矩阵减去指定矩阵的结果赋值给当前矩阵。\n     * @param mat the second operand\n     */\n    public subtract (mat: Mat3) {\n        this.m00 -= mat.m00;\n        this.m01 -= mat.m01;\n        this.m02 -= mat.m02;\n        this.m03 -= mat.m03;\n        this.m04 -= mat.m04;\n        this.m05 -= mat.m05;\n        this.m06 -= mat.m06;\n        this.m07 -= mat.m07;\n        this.m08 -= mat.m08;\n        return this;\n    }\n\n    /**\n     * @en Multiply the current matrix with another matrix.\n     * @zh 矩阵乘法。将当前矩阵左乘指定矩阵的结果赋值给当前矩阵。\n     * @param mat the second operand\n     */\n    public multiply (mat: Mat3) {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02;\n        const a10 = this.m03; const a11 = this.m04; const a12 = this.m05;\n        const a20 = this.m06; const a21 = this.m07; const a22 = this.m08;\n\n        const b00 = mat.m00; const b01 = mat.m01; const b02 = mat.m02;\n        const b10 = mat.m03; const b11 = mat.m04; const b12 = mat.m05;\n        const b20 = mat.m06; const b21 = mat.m07; const b22 = mat.m08;\n\n        this.m00 = b00 * a00 + b01 * a10 + b02 * a20;\n        this.m01 = b00 * a01 + b01 * a11 + b02 * a21;\n        this.m02 = b00 * a02 + b01 * a12 + b02 * a22;\n\n        this.m03 = b10 * a00 + b11 * a10 + b12 * a20;\n        this.m04 = b10 * a01 + b11 * a11 + b12 * a21;\n        this.m05 = b10 * a02 + b11 * a12 + b12 * a22;\n\n        this.m06 = b20 * a00 + b21 * a10 + b22 * a20;\n        this.m07 = b20 * a01 + b21 * a11 + b22 * a21;\n        this.m08 = b20 * a02 + b21 * a12 + b22 * a22;\n        return this;\n    }\n\n    /**\n     * @en Multiply each element of the current matrix by a scalar number.\n     * @zh 矩阵数乘。将当前矩阵与指定标量的数乘结果赋值给当前矩阵。\n     * @param scalar amount to scale the matrix's elements by\n     */\n    public multiplyScalar (scalar: number) {\n        this.m00 *= scalar;\n        this.m01 *= scalar;\n        this.m02 *= scalar;\n        this.m03 *= scalar;\n        this.m04 *= scalar;\n        this.m05 *= scalar;\n        this.m06 *= scalar;\n        this.m07 *= scalar;\n        this.m08 *= scalar;\n        return this;\n    }\n\n    /**\n     * @en Multiply the current matrix with a scale matrix given by a scale vector.\n     * @zh 将当前矩阵左乘缩放矩阵的结果赋值给当前矩阵，缩放矩阵由各个轴的缩放给出。\n     * @param vec vector to scale by\n     */\n    public scale (vec: Vec3) {\n        const x = vec.x; const y = vec.y;\n\n        this.m00 = x * this.m00;\n        this.m01 = x * this.m01;\n        this.m02 = x * this.m02;\n\n        this.m03 = y * this.m03;\n        this.m04 = y * this.m04;\n        this.m05 = y * this.m05;\n\n        this.m06 = this.m06;\n        this.m07 = this.m07;\n        this.m08 = this.m08;\n        return this;\n    }\n\n    /**\n     * @en Rotates the current matrix by the given angle.\n     * @zh 将当前矩阵左乘旋转矩阵的结果赋值给当前矩阵，旋转矩阵由旋转轴和旋转角度给出。\n     * @param rad radius of rotation\n     */\n    public rotate (rad: number) {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02;\n        const a10 = this.m03; const a11 = this.m04; const a12 = this.m05;\n        const a20 = this.m06; const a21 = this.m07; const a22 = this.m08;\n\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n\n        this.m00 = c * a00 + s * a10;\n        this.m01 = c * a01 + s * a11;\n        this.m02 = c * a02 + s * a12;\n\n        this.m03 = c * a10 - s * a00;\n        this.m04 = c * a11 - s * a01;\n        this.m05 = c * a12 - s * a02;\n\n        this.m06 = a20;\n        this.m07 = a21;\n        this.m08 = a22;\n        return this;\n    }\n\n    /**\n     * @en Resets the current matrix from the given quaternion.\n     * @zh 重置当前矩阵的值，使其表示指定四元数表示的旋转变换。\n     * @param q The quaternion.\n     * @returns this\n     */\n    public fromQuat (q: Quat) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const yx = y * x2;\n        const yy = y * y2;\n        const zx = z * x2;\n        const zy = z * y2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n\n        this.m00 = 1 - yy - zz;\n        this.m03 = yx - wz;\n        this.m06 = zx + wy;\n\n        this.m01 = yx + wz;\n        this.m04 = 1 - xx - zz;\n        this.m07 = zy - wx;\n\n        this.m02 = zx - wy;\n        this.m05 = zy + wx;\n        this.m08 = 1 - xx - yy;\n        return this;\n    }\n}\n\nconst v3_1 = new Vec3();\nconst v3_2 = new Vec3();\n\nCCClass.fastDefine('cc.Mat3', Mat3, {\n    m00: 1,\n    m01: 0,\n    m02: 0,\n    m03: 0,\n    m04: 1,\n    m05: 0,\n    m06: 0,\n    m07: 0,\n    m08: 1,\n});\nlegacyCC.Mat3 = Mat3;\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Mat3 } from './mat3';\nimport { IQuatLike, IVec3Like } from './type-define';\nimport { EPSILON, toDegree } from './utils';\nimport { Vec3 } from './vec3';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en quaternion\n * @zh 四元数\n */\nexport class Quat extends ValueType {\n    public static IDENTITY = Object.freeze(new Quat());\n\n    /**\n     * @en Obtain a copy of the given quaternion\n     * @zh 获得指定四元数的拷贝\n     */\n    public static clone<Out extends IQuatLike> (a: Out) {\n        return new Quat(a.x, a.y, a.z, a.w);\n    }\n\n    /**\n     * @en Copy the given quaternion to the out quaternion\n     * @zh 复制目标四元数\n     */\n    public static copy<Out extends IQuatLike, QuatLike extends IQuatLike> (out: Out, a: QuatLike) {\n        out.x = a.x;\n        out.y = a.y;\n        out.z = a.z;\n        out.w = a.w;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion with values of each component\n     * @zh 设置四元数值\n     */\n    public static set<Out extends IQuatLike> (out: Out, x: number, y: number, z: number, w: number) {\n        out.x = x;\n        out.y = y;\n        out.z = z;\n        out.w = w;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion to an identity quaternion\n     * @zh 将目标赋值为单位四元数\n     */\n    public static identity<Out extends IQuatLike> (out: Out) {\n        out.x = 0;\n        out.y = 0;\n        out.z = 0;\n        out.w = 1;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion with the shortest path orientation between two vectors, considering both vectors normalized\n     * @zh 设置四元数为两向量间的最短路径旋转，默认两向量都已归一化\n     */\n    public static rotationTo<Out extends IQuatLike, VecLike extends IVec3Like> (out: Out, a: VecLike, b: VecLike) {\n        const dot = Vec3.dot(a, b);\n        if (dot < -0.999999) {\n            Vec3.cross(v3_1, Vec3.UNIT_X, a);\n            if (v3_1.length() < 0.000001) {\n                Vec3.cross(v3_1, Vec3.UNIT_Y, a);\n            }\n            Vec3.normalize(v3_1, v3_1);\n            Quat.fromAxisAngle(out, v3_1, Math.PI);\n            return out;\n        } else if (dot > 0.999999) {\n            out.x = 0;\n            out.y = 0;\n            out.z = 0;\n            out.w = 1;\n            return out;\n        } else {\n            Vec3.cross(v3_1, a, b);\n            out.x = v3_1.x;\n            out.y = v3_1.y;\n            out.z = v3_1.z;\n            out.w = 1 + dot;\n            return Quat.normalize(out, out);\n        }\n    }\n\n    /**\n     * @en Gets the rotation axis and the arc of rotation from the quaternion\n     * @zh 获取四元数的旋转轴和旋转弧度\n     * @param outAxis output axis\n     * @param q input quaternion\n     * @return radius of rotation\n     */\n    public static getAxisAngle<Out extends IQuatLike, VecLike extends IVec3Like> (outAxis: VecLike, q: Out) {\n        const rad = Math.acos(q.w) * 2.0;\n        const s = Math.sin(rad / 2.0);\n        if (s !== 0.0) {\n            outAxis.x = q.x / s;\n            outAxis.y = q.y / s;\n            outAxis.z = q.z / s;\n        } else {\n            // If s is zero, return any axis (no rotation - axis does not matter)\n            outAxis.x = 1;\n            outAxis.y = 0;\n            outAxis.z = 0;\n        }\n        return rad;\n    }\n\n    /**\n     * @en Quaternion multiplication and save the results to out quaternion\n     * @zh 四元数乘法\n     */\n    public static multiply<Out extends IQuatLike, QuatLike_1 extends IQuatLike, QuatLike_2 extends IQuatLike> (out: Out, a: QuatLike_1, b: QuatLike_2) {\n        const x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n        const y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n        const z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n        const w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n        out.x = x;\n        out.y = y;\n        out.z = z;\n        out.w = w;\n        return out;\n    }\n\n    /**\n     * @en Quaternion scalar multiplication and save the results to out quaternion\n     * @zh 四元数标量乘法\n     */\n    public static multiplyScalar<Out extends IQuatLike> (out: Out, a: Out, b: number) {\n        out.x = a.x * b;\n        out.y = a.y * b;\n        out.z = a.z * b;\n        out.w = a.w * b;\n        return out;\n    }\n\n    /**\n     * @en Quaternion multiplication and addition: A + B * scale\n     * @zh 四元数乘加：A + B * scale\n     */\n    public static scaleAndAdd<Out extends IQuatLike> (out: Out, a: Out, b: Out, scale: number) {\n        out.x = a.x + b.x * scale;\n        out.y = a.y + b.y * scale;\n        out.z = a.z + b.z * scale;\n        out.w = a.w + b.w * scale;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion to represent a radian rotation around x axis\n     * @zh 绕 X 轴旋转指定四元数\n     * @param rad radius of rotation\n     */\n    public static rotateX<Out extends IQuatLike> (out: Out, a: Out, rad: number) {\n        rad *= 0.5;\n\n        const bx = Math.sin(rad);\n        const bw = Math.cos(rad);\n        const { x, y, z, w } = a;\n\n        out.x = x * bw + w * bx;\n        out.y = y * bw + z * bx;\n        out.z = z * bw - y * bx;\n        out.w = w * bw - x * bx;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion to represent a radian rotation around y axis\n     * @zh 绕 Y 轴旋转指定四元数\n     * @param rad radius of rotation\n     */\n    public static rotateY<Out extends IQuatLike> (out: Out, a: Out, rad: number) {\n        rad *= 0.5;\n\n        const by = Math.sin(rad);\n        const bw = Math.cos(rad);\n        const { x, y, z, w } = a;\n\n        out.x = x * bw - z * by;\n        out.y = y * bw + w * by;\n        out.z = z * bw + x * by;\n        out.w = w * bw - y * by;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion to represent a radian rotation around z axis\n     * @zh 绕 Z 轴旋转指定四元数\n     * @param rad radius of rotation\n     */\n    public static rotateZ<Out extends IQuatLike> (out: Out, a: Out, rad: number) {\n        rad *= 0.5;\n\n        const bz = Math.sin(rad);\n        const bw = Math.cos(rad);\n        const { x, y, z, w } = a;\n\n        out.x = x * bw + y * bz;\n        out.y = y * bw - x * bz;\n        out.z = z * bw + w * bz;\n        out.w = w * bw - z * bz;\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion to represent a radian rotation around a given rotation axis in world space\n     * @zh 绕世界空间下指定轴旋转四元数\n     * @param axis axis of rotation, normalized by default\n     * @param rad radius of rotation\n     */\n    public static rotateAround<Out extends IQuatLike, VecLike extends IVec3Like> (out: Out, rot: Out, axis: VecLike, rad: number) {\n        // get inv-axis (local to rot)\n        Quat.invert(qt_1, rot);\n        Vec3.transformQuat(v3_1, axis, qt_1);\n        // rotate by inv-axis\n        Quat.fromAxisAngle(qt_1, v3_1, rad);\n        Quat.multiply(out, rot, qt_1);\n        return out;\n    }\n\n    /**\n     * @en Sets the out quaternion to represent a radian rotation around a given rotation axis in local space\n     * @zh 绕本地空间下指定轴旋转四元数\n     * @param axis axis of rotation\n     * @param rad radius of rotation\n     */\n    public static rotateAroundLocal<Out extends IQuatLike, VecLike extends IVec3Like> (out: Out, rot: Out, axis: VecLike, rad: number) {\n        Quat.fromAxisAngle(qt_1, axis, rad);\n        Quat.multiply(out, rot, qt_1);\n        return out;\n    }\n\n    /**\n     * @en Calculates the w component with xyz components, considering the given quaternion normalized\n     * @zh 根据 xyz 分量计算 w 分量，默认已归一化\n     */\n    public static calculateW<Out extends IQuatLike> (out: Out, a: Out) {\n        out.x = a.x;\n        out.y = a.y;\n        out.z = a.z;\n        out.w = Math.sqrt(Math.abs(1.0 - a.x * a.x - a.y * a.y - a.z * a.z));\n        return out;\n    }\n\n    /**\n     * @en Quaternion dot product (scalar product)\n     * @zh 四元数点积（数量积）\n     */\n    public static dot<Out extends IQuatLike> (a: Out, b: Out) {\n        return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n    }\n\n    /**\n     * @en Element by element linear interpolation: A + t * (B - A)\n     * @zh 逐元素线性插值： A + t * (B - A)\n     */\n    public static lerp<Out extends IQuatLike> (out: Out, a: Out, b: Out, t: number) {\n        out.x = a.x + t * (b.x - a.x);\n        out.y = a.y + t * (b.y - a.y);\n        out.z = a.z + t * (b.z - a.z);\n        out.w = a.w + t * (b.w - a.w);\n        return out;\n    }\n\n    /**\n     * @en Spherical quaternion interpolation\n     * @zh 四元数球面插值\n     */\n    public static slerp<Out extends IQuatLike, QuatLike_1 extends IQuatLike, QuatLike_2 extends IQuatLike>\n    (out: Out, a: QuatLike_1, b: QuatLike_2, t: number) {\n        // benchmarks:\n        //    http://jsperf.com/quaternion-slerp-implementations\n\n        let scale0 = 0;\n        let scale1 = 0;\n        let bx = b.x;\n        let by = b.y;\n        let bz = b.z;\n        let bw = b.w;\n\n        // calc cosine\n        let cosom = a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n        // adjust signs (if necessary)\n        if (cosom < 0.0) {\n            cosom = -cosom;\n            bx = -bx;\n            by = -by;\n            bz = -bz;\n            bw = -bw;\n        }\n        // calculate coefficients\n        if ((1.0 - cosom) > 0.000001) {\n            // standard case (slerp)\n            const omega = Math.acos(cosom);\n            const sinom = Math.sin(omega);\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\n            scale1 = Math.sin(t * omega) / sinom;\n        } else {\n            // \"from\" and \"to\" quaternions are very close\n            //  ... so we can do a linear interpolation\n            scale0 = 1.0 - t;\n            scale1 = t;\n        }\n        // calculate final values\n        out.x = scale0 * a.x + scale1 * bx;\n        out.y = scale0 * a.y + scale1 * by;\n        out.z = scale0 * a.z + scale1 * bz;\n        out.w = scale0 * a.w + scale1 * bw;\n\n        return out;\n    }\n\n    /**\n     * @en Spherical quaternion interpolation with two control points\n     * @zh 带两个控制点的四元数球面插值\n     */\n    public static sqlerp<Out extends IQuatLike> (out: Out, a: Out, b: Out, c: Out, d: Out, t: number) {\n        Quat.slerp(qt_1, a, d, t);\n        Quat.slerp(qt_2, b, c, t);\n        Quat.slerp(out, qt_1, qt_2, 2 * t * (1 - t));\n        return out;\n    }\n\n    /**\n     * @en Sets the inverse of the given quaternion to out quaternion\n     * @zh 四元数求逆\n     */\n    public static invert<Out extends IQuatLike, QuatLike extends IQuatLike> (out: Out, a: QuatLike) {\n        const dot = a.x * a.x + a.y * a.y + a.z * a.z + a.w * a.w;\n        const invDot = dot ? 1.0 / dot : 0;\n\n        // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\n\n        out.x = -a.x * invDot;\n        out.y = -a.y * invDot;\n        out.z = -a.z * invDot;\n        out.w = a.w * invDot;\n        return out;\n    }\n\n    /**\n     * @en Conjugating a quaternion, it's equivalent to the inverse of the unit quaternion, but more efficient\n     * @zh 求共轭四元数，对单位四元数与求逆等价，但更高效\n     */\n    public static conjugate<Out extends IQuatLike> (out: Out, a: Out) {\n        out.x = -a.x;\n        out.y = -a.y;\n        out.z = -a.z;\n        out.w = a.w;\n        return out;\n    }\n\n    /**\n     * @en Calculates the length of the quaternion\n     * @zh 求四元数长度\n     */\n    public static len<Out extends IQuatLike> (a: Out) {\n        return Math.sqrt(a.x * a.x + a.y * a.y + a.z * a.z + a.w * a.w);\n    }\n\n    /**\n     * @en Calculates the squared length of the quaternion\n     * @zh 求四元数长度平方\n     */\n    public static lengthSqr<Out extends IQuatLike> (a: Out) {\n        return a.x * a.x + a.y * a.y + a.z * a.z + a.w * a.w;\n    }\n\n    /**\n     * @en Normalize the given quaternion\n     * @zh 归一化四元数\n     */\n    public static normalize<Out extends IQuatLike> (out: Out, a: Out) {\n        let len = a.x * a.x + a.y * a.y + a.z * a.z + a.w * a.w;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            out.x = a.x * len;\n            out.y = a.y * len;\n            out.z = a.z * len;\n            out.w = a.w * len;\n        }\n        return out;\n    }\n\n    /**\n     * @en Calculated the quaternion represents the given coordinates, considering all given vectors are normalized and mutually perpendicular\n     * @zh 根据本地坐标轴朝向计算四元数，默认三向量都已归一化且相互垂直\n     */\n    public static fromAxes<Out extends IQuatLike, VecLike extends IVec3Like> (out: Out, xAxis: VecLike, yAxis: VecLike, zAxis: VecLike) {\n        Mat3.set(m3_1,\n            xAxis.x, xAxis.y, xAxis.z,\n            yAxis.x, yAxis.y, yAxis.z,\n            zAxis.x, zAxis.y, zAxis.z);\n        return Quat.normalize(out, Quat.fromMat3(out, m3_1));\n    }\n\n    /**\n     * @en Calculates the quaternion with the up direction and the direction of the viewport\n     * @zh 根据视口的前方向和上方向计算四元数\n     * @param view The view direction, it`s must be normalized.\n     * @param up The view up direction, it`s must be normalized, default value is (0, 1, 0).\n     */\n    public static fromViewUp<Out extends IQuatLike, VecLike extends IVec3Like> (out: Out, view: VecLike, up?: Vec3) {\n        Mat3.fromViewUp(m3_1, view, up);\n        return Quat.normalize(out, Quat.fromMat3(out, m3_1));\n    }\n\n    /**\n     * @en Calculates the quaternion from a given rotary shaft and a radian rotation around it.\n     * @zh 根据旋转轴和旋转弧度计算四元数\n     */\n    public static fromAxisAngle<Out extends IQuatLike, VecLike extends IVec3Like> (out: Out, axis: VecLike, rad: number) {\n        rad *= 0.5;\n        const s = Math.sin(rad);\n        out.x = s * axis.x;\n        out.y = s * axis.y;\n        out.z = s * axis.z;\n        out.w = Math.cos(rad);\n        return out;\n    }\n\n    /**\n     * @en Calculates the quaternion with the three-dimensional transform matrix, considering no scale included in the matrix\n     * @zh 根据三维矩阵信息计算四元数，默认输入矩阵不含有缩放信息\n     */\n    public static fromMat3<Out extends IQuatLike> (out: Out, m: Mat3) {\n        const {\n            m00, m03: m01, m06: m02,\n            m01: m10, m04: m11, m07: m12,\n            m02: m20, m05: m21, m08: m22,\n        } = m;\n\n        const trace = m00 + m11 + m22;\n\n        if (trace > 0) {\n            const s = 0.5 / Math.sqrt(trace + 1.0);\n\n            out.w = 0.25 / s;\n            out.x = (m21 - m12) * s;\n            out.y = (m02 - m20) * s;\n            out.z = (m10 - m01) * s;\n        } else if ((m00 > m11) && (m00 > m22)) {\n            const s = 2.0 * Math.sqrt(1.0 + m00 - m11 - m22);\n\n            out.w = (m21 - m12) / s;\n            out.x = 0.25 * s;\n            out.y = (m01 + m10) / s;\n            out.z = (m02 + m20) / s;\n        } else if (m11 > m22) {\n            const s = 2.0 * Math.sqrt(1.0 + m11 - m00 - m22);\n\n            out.w = (m02 - m20) / s;\n            out.x = (m01 + m10) / s;\n            out.y = 0.25 * s;\n            out.z = (m12 + m21) / s;\n        } else {\n            const s = 2.0 * Math.sqrt(1.0 + m22 - m00 - m11);\n\n            out.w = (m10 - m01) / s;\n            out.x = (m02 + m20) / s;\n            out.y = (m12 + m21) / s;\n            out.z = 0.25 * s;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Calculates the quaternion with Euler angles, the rotation order is YZX\n     * @zh 根据欧拉角信息计算四元数，旋转顺序为 YZX\n     */\n    public static fromEuler<Out extends IQuatLike> (out: Out, x: number, y: number, z: number) {\n        x *= halfToRad;\n        y *= halfToRad;\n        z *= halfToRad;\n\n        const sx = Math.sin(x);\n        const cx = Math.cos(x);\n        const sy = Math.sin(y);\n        const cy = Math.cos(y);\n        const sz = Math.sin(z);\n        const cz = Math.cos(z);\n\n        out.x = sx * cy * cz + cx * sy * sz;\n        out.y = cx * sy * cz + sx * cy * sz;\n        out.z = cx * cy * sz - sx * sy * cz;\n        out.w = cx * cy * cz - sx * sy * sz;\n\n        return out;\n    }\n\n    /**\n     * @en Calculates the quaternion with given 2D angle (0, 0, z).\n     * @zh 根据 2D 角度（0, 0, z）计算四元数\n     *\n     * @param out Output quaternion\n     * @param z Angle to rotate around Z axis in degrees.\n     */\n    public static fromAngleZ<Out extends IQuatLike> (out: Out, z: number) {\n        z *= halfToRad;\n        out.x = out.y = 0;\n        out.z = Math.sin(z);\n        out.w = Math.cos(z);\n        return out;\n    }\n\n    /**\n     * @en This returns the X-axis vector of the quaternion\n     * @zh 返回定义此四元数的坐标系 X 轴向量\n     */\n    public static toAxisX (out: IVec3Like, q: IQuatLike) {\n        const fy = 2.0 * q.y;\n        const fz = 2.0 * q.z;\n        out.x = 1.0 - fy * q.y - fz * q.z;\n        out.y = fy * q.x + fz * q.w;\n        out.z = fz * q.x + fy * q.w;\n\n        return out;\n    }\n\n    /**\n     * @en This returns the Y-axis vector of the quaternion\n     * @zh 返回定义此四元数的坐标系 Y 轴向量\n     */\n    public static toAxisY (out: IVec3Like, q: IQuatLike) {\n        const fx = 2.0 * q.x;\n        const fy = 2.0 * q.y;\n        const fz = 2.0 * q.z;\n        out.x = fy * q.x - fz * q.w;\n        out.y = 1.0 - fx * q.x - fz * q.z;\n        out.z = fz * q.y + fx * q.w;\n\n        return out;\n    }\n\n    /**\n     * @en This returns the Z-axis vector of the quaternion\n     * @zh 返回定义此四元数的坐标系 Z 轴向量\n     */\n    public static toAxisZ (out: IVec3Like, q: IQuatLike) {\n        const fx = 2.0 * q.x;\n        const fy = 2.0 * q.y;\n        const fz = 2.0 * q.z;\n        out.x = fz * q.x - fy * q.w;\n        out.y = fz * q.y - fx * q.w;\n        out.z = 1.0 - fx * q.x - fy * q.y;\n\n        return out;\n    }\n\n    /**\n     * @en Converts the quaternion to angles, result angle x, y in the range of [-180, 180], z in the range of [-90, 90] interval, the rotation order is YZX\n     * @zh 根据四元数计算欧拉角，返回角度 x, y 在 [-180, 180] 区间内, z 默认在 [-90, 90] 区间内，旋转顺序为 YZX\n     * @param outerZ change z value range to [-180, -90] U [90, 180]\n     */\n    public static toEuler (out: IVec3Like, q: IQuatLike, outerZ?: boolean) {\n        const { x, y, z, w } = q;\n        let bank = 0;\n        let heading = 0;\n        let attitude = 0;\n        const test = x * y + z * w;\n        if (test > 0.499999) {\n            bank = 0; // default to zero\n            heading = toDegree(2 * Math.atan2(x, w));\n            attitude = 90;\n        } else if (test < -0.499999) {\n            bank = 0; // default to zero\n            heading = -toDegree(2 * Math.atan2(x, w));\n            attitude = -90;\n        } else {\n            const sqx = x * x;\n            const sqy = y * y;\n            const sqz = z * z;\n            bank = toDegree(Math.atan2(2 * x * w - 2 * y * z, 1 - 2 * sqx - 2 * sqz));\n            heading = toDegree(Math.atan2(2 * y * w - 2 * x * z, 1 - 2 * sqy - 2 * sqz));\n            attitude = toDegree(Math.asin(2 * test));\n            if (outerZ) {\n                bank = -180 * Math.sign(bank + 1e-6) + bank;\n                heading = -180 * Math.sign(heading + 1e-6) + heading;\n                attitude = 180 * Math.sign(attitude + 1e-6) - attitude;\n            }\n        }\n        out.x = bank; out.y = heading; out.z = attitude;\n        return out;\n    }\n\n    /**\n     * @en Converts quaternion to an array\n     * @zh 四元数转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray<Out extends IWritableArrayLike<number>> (out: Out, q: IQuatLike, ofs = 0) {\n        out[ofs + 0] = q.x;\n        out[ofs + 1] = q.y;\n        out[ofs + 2] = q.z;\n        out[ofs + 3] = q.w;\n        return out;\n    }\n\n    /**\n     * @en Array to a quaternion\n     * @zh 数组转四元数\n     * @param ofs Array Start Offset\n     */\n    public static fromArray (out: IQuatLike, arr: IWritableArrayLike<number>, ofs = 0) {\n        out.x = arr[ofs + 0];\n        out.y = arr[ofs + 1];\n        out.z = arr[ofs + 2];\n        out.w = arr[ofs + 3];\n        return out;\n    }\n\n    /**\n     * @en Check whether two quaternions are equal\n     * @zh 四元数等价判断\n     */\n    public static strictEquals (a: IQuatLike, b: IQuatLike) {\n        return a.x === b.x && a.y === b.y && a.z === b.z && a.w === b.w;\n    }\n\n    /**\n     * @en Check whether two quaternions are approximately equal\n     * @zh 排除浮点数误差的四元数近似等价判断\n     */\n    public static equals (a: IQuatLike, b: IQuatLike, epsilon = EPSILON) {\n        return (Math.abs(a.x - b.x) <= epsilon * Math.max(1.0, Math.abs(a.x), Math.abs(b.x))\n            && Math.abs(a.y - b.y) <= epsilon * Math.max(1.0, Math.abs(a.y), Math.abs(b.y))\n            && Math.abs(a.z - b.z) <= epsilon * Math.max(1.0, Math.abs(a.z), Math.abs(b.z))\n            && Math.abs(a.w - b.w) <= epsilon * Math.max(1.0, Math.abs(a.w), Math.abs(b.w)));\n    }\n\n    /**\n     * @en x component.\n     * @zh x 分量。\n     */\n    public declare x: number;\n\n    /**\n     * @en y component.\n     * @zh y 分量。\n     */\n    public declare y: number;\n\n    /**\n     * @en z component.\n     * @zh z 分量。\n     */\n    public declare z: number;\n\n    /**\n     * @en w component.\n     * @zh w 分量。\n     */\n    public declare w: number;\n\n    constructor (other: Quat);\n\n    constructor (x?: number, y?: number, z?: number, w?: number);\n\n    constructor (x?: number | IQuatLike, y?: number, z?: number, w?: number) {\n        super();\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n            this.w = x.w;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n            this.w = w ?? 1;\n        }\n    }\n\n    /**\n     * @en clone the current Quat\n     * @zh 克隆当前四元数。\n     */\n    public clone () {\n        return new Quat(this.x, this.y, this.z, this.w);\n    }\n\n    /**\n     * @en Set values with another quaternion\n     * @zh 设置当前四元数使其与指定四元数相等。\n     * @param other Specified quaternion\n     * @returns `this`\n     */\n    public set (other: Quat): Quat;\n\n    /**\n     * @en Set the value of each component of the current quaternion\n     * @zh 设置当前四元数指定元素值。\n     * @returns `this`\n     */\n    public set (x?: number, y?: number, z?: number, w?: number): Quat;\n\n    public set (x?: number | Quat, y?: number, z?: number, w?: number) {\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n            this.w = x.w;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n            this.w = w ?? 1;\n        }\n        return this;\n    }\n\n    /**\n     * @en Check whether the quaternion approximately equals another one\n     * @zh 判断当前四元数是否在误差范围内与指定向量相等。\n     * @param other Comparative quaternion\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @returns Returns `true' when the components of the two quaternions are equal within the specified error range; otherwise, returns `false'.\n     */\n    public equals (other: Quat, epsilon = EPSILON) {\n        return (Math.abs(this.x - other.x) <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(other.x))\n            && Math.abs(this.y - other.y) <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(other.y))\n            && Math.abs(this.z - other.z) <= epsilon * Math.max(1.0, Math.abs(this.z), Math.abs(other.z))\n            && Math.abs(this.w - other.w) <= epsilon * Math.max(1.0, Math.abs(this.w), Math.abs(other.w)));\n    }\n\n    /**\n     * @en Check whether the current quaternion strictly equals other quaternion\n     * @zh 判断当前四元数是否与指定四元数相等。\n     * @param other Comparative quaternion\n     * @returns Returns `true' when the components of the two quaternions are equal within the specified error range; otherwise, returns `false'.\n     */\n    public strictEquals (other: Quat) {\n        return other && this.x === other.x && this.y === other.y && this.z === other.z && this.w === other.w;\n    }\n\n    /**\n     * @en Convert quaternion to Euler angles\n     * @zh 将当前四元数转化为欧拉角（x-y-z）并赋值给出口向量。\n     * @param out the output vector\n     */\n    public getEulerAngles (out: Vec3) {\n        return Quat.toEuler(out, this);\n    }\n\n    /**\n     * @en Calculate the linear interpolation result between this quaternion and another one with given ratio\n     * @zh 根据指定的插值比率，从当前四元数到目标四元数之间做线性插值。\n     * @param to The target quaternion\n     * @param ratio The interpolation coefficient. The range is [0,1].\n     */\n    public lerp (to: Quat, ratio: number) {\n        this.x += ratio * (to.x - this.x);\n        this.y += ratio * (to.y - this.y);\n        this.z += ratio * (to.z - this.z);\n        this.w += ratio * (to.w - this.w);\n        return this;\n    }\n\n    /**\n     * @en Calculates the spherical interpolation result between this quaternion and another one with the given ratio\n     * @zh 根据指定的插值比率，从当前四元数到目标四元数之间做球面插值。\n     * @param to The target quaternion\n     * @param ratio The interpolation coefficient. The range is [0,1].\n     */\n    public slerp (to: Quat, ratio: number) {\n        return Quat.slerp(this, this, to, ratio);\n    }\n\n    /**\n     * @en Calculates the length of the quaternion\n     * @zh 求四元数长度\n     */\n    public length () {\n        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\n    }\n\n    /**\n     * @en Calculates the squared length of the quaternion\n     * @zh 求四元数长度平方\n     */\n    public lengthSqr () {\n        return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\n    }\n}\n\nconst qt_1 = new Quat();\nconst qt_2 = new Quat();\nconst v3_1 = new Vec3();\nconst m3_1 = new Mat3();\nconst halfToRad = 0.5 * Math.PI / 180.0;\n\nCCClass.fastDefine('cc.Quat', Quat, { x: 0, y: 0, z: 0, w: 1 });\nlegacyCC.Quat = Quat;\n\nexport function quat (other: Quat): Quat;\nexport function quat (x?: number, y?: number, z?: number, w?: number): Quat;\n\nexport function quat (x: number | Quat = 0, y = 0, z = 0, w = 1) {\n    return new Quat(x as any, y, z, w);\n}\n\nlegacyCC.quat = quat;\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Mat3 } from './mat3';\nimport { Quat } from './quat';\nimport { IMat4Like, IVec3Like } from './type-define';\nimport { EPSILON } from './utils';\nimport { Vec3 } from './vec3';\nimport { legacyCC } from '../global-exports';\n\nexport const preTransforms = Object.freeze([\n    Object.freeze([1,  0,  0,  1]), // SurfaceTransform.IDENTITY\n    Object.freeze([0,  1, -1,  0]), // SurfaceTransform.ROTATE_90\n    Object.freeze([-1,  0,  0, -1]), // SurfaceTransform.ROTATE_180\n    Object.freeze([0, -1,  1,  0]), // SurfaceTransform.ROTATE_270\n]);\n\n/**\n * @en Mathematical 4x4 matrix.\n * @zh 表示四维（4x4）矩阵。\n */\n\nexport class Mat4 extends ValueType {\n    public static IDENTITY = Object.freeze(new Mat4());\n\n    /**\n     * @en Clone a matrix and save the results to out matrix\n     * @zh 获得指定矩阵的拷贝\n     */\n    public static clone (a: IMat4Like) {\n        return new Mat4(\n            a.m00, a.m01, a.m02, a.m03,\n            a.m04, a.m05, a.m06, a.m07,\n            a.m08, a.m09, a.m10, a.m11,\n            a.m12, a.m13, a.m14, a.m15,\n        );\n    }\n\n    /**\n     * @en Copy a matrix into the out matrix\n     * @zh 复制目标矩阵\n     */\n    public static copy <Out extends IMat4Like> (out: Out, a: Out) {\n        out.m00 = a.m00;\n        out.m01 = a.m01;\n        out.m02 = a.m02;\n        out.m03 = a.m03;\n        out.m04 = a.m04;\n        out.m05 = a.m05;\n        out.m06 = a.m06;\n        out.m07 = a.m07;\n        out.m08 = a.m08;\n        out.m09 = a.m09;\n        out.m10 = a.m10;\n        out.m11 = a.m11;\n        out.m12 = a.m12;\n        out.m13 = a.m13;\n        out.m14 = a.m14;\n        out.m15 = a.m15;\n        return out;\n    }\n\n    /**\n     * @en Sets a matrix with the given values and save the results to out matrix\n     * @zh 设置矩阵值\n     */\n    public static set <Out extends IMat4Like>  (\n        out: Out,\n        m00: number, m01: number, m02: number, m03: number,\n        m10: number, m11: number, m12: number, m13: number,\n        m20: number, m21: number, m22: number, m23: number,\n        m30: number, m31: number, m32: number, m33: number,\n    ) {\n        out.m00 = m00; out.m01 = m01; out.m02 = m02; out.m03 = m03;\n        out.m04 = m10; out.m05 = m11; out.m06 = m12; out.m07 = m13;\n        out.m08 = m20; out.m09 = m21; out.m10 = m22; out.m11 = m23;\n        out.m12 = m30; out.m13 = m31; out.m14 = m32; out.m15 = m33;\n        return out;\n    }\n\n    /**\n     * @en return an identity matrix.\n     * @zh 将目标赋值为单位矩阵\n     */\n    public static identity <Out extends IMat4Like> (out: Out) {\n        out.m00 = 1;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 0;\n        out.m05 = 1;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = 0;\n        out.m10 = 1;\n        out.m11 = 0;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Transposes a matrix and save the results to out matrix\n     * @zh 转置矩阵\n     */\n    public static transpose <Out extends IMat4Like> (out: Out, a: Out) {\n        // If we are transposing ourselves we can skip a few steps but have to cache some values\n        if (out === a) {\n            const a01 = a.m01; const a02 = a.m02; const a03 = a.m03; const a12 = a.m06; const a13 = a.m07; const a23 = a.m11;\n            out.m01 = a.m04;\n            out.m02 = a.m08;\n            out.m03 = a.m12;\n            out.m04 = a01;\n            out.m06 = a.m09;\n            out.m07 = a.m13;\n            out.m08 = a02;\n            out.m09 = a12;\n            out.m11 = a.m14;\n            out.m12 = a03;\n            out.m13 = a13;\n            out.m14 = a23;\n        } else {\n            out.m00 = a.m00;\n            out.m01 = a.m04;\n            out.m02 = a.m08;\n            out.m03 = a.m12;\n            out.m04 = a.m01;\n            out.m05 = a.m05;\n            out.m06 = a.m09;\n            out.m07 = a.m13;\n            out.m08 = a.m02;\n            out.m09 = a.m06;\n            out.m10 = a.m10;\n            out.m11 = a.m14;\n            out.m12 = a.m03;\n            out.m13 = a.m07;\n            out.m14 = a.m11;\n            out.m15 = a.m15;\n        }\n        return out;\n    }\n\n    /**\n     * @en Inverts a matrix. When matrix is not invertible the matrix will be set to zeros.\n     * @zh 矩阵求逆，注意，在矩阵不可逆时，会返回一个全为 0 的矩阵。\n     */\n    public static invert <Out extends IMat4Like> (out: Out, a: Out) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n        const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n        const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n        const a30 = a.m12; const a31 = a.m13; const a32 = a.m14; const a33 = a.m15;\n\n        const b00 = a00 * a11 - a01 * a10;\n        const b01 = a00 * a12 - a02 * a10;\n        const b02 = a00 * a13 - a03 * a10;\n        const b03 = a01 * a12 - a02 * a11;\n        const b04 = a01 * a13 - a03 * a11;\n        const b05 = a02 * a13 - a03 * a12;\n        const b06 = a20 * a31 - a21 * a30;\n        const b07 = a20 * a32 - a22 * a30;\n        const b08 = a20 * a33 - a23 * a30;\n        const b09 = a21 * a32 - a22 * a31;\n        const b10 = a21 * a33 - a23 * a31;\n        const b11 = a22 * a33 - a23 * a32;\n\n        // Calculate the determinant\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        if (det === 0) {\n            out.m00 = 0; out.m01 = 0; out.m02 = 0; out.m03 = 0;\n            out.m04 = 0; out.m05 = 0; out.m06 = 0; out.m07 = 0;\n            out.m08 = 0; out.m09 = 0; out.m10 = 0; out.m11 = 0;\n            out.m12 = 0; out.m13 = 0; out.m14 = 0; out.m15 = 0;\n            return out;\n        }\n        det = 1.0 / det;\n\n        out.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n        out.m01 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n        out.m02 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n        out.m03 = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n        out.m04 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n        out.m05 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n        out.m06 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n        out.m07 = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n        out.m08 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n        out.m09 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n        out.m10 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n        out.m11 = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n        out.m12 = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n        out.m13 = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n        out.m14 = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n        out.m15 = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n\n        return out;\n    }\n\n    /**\n     * @en Calculates the determinant of a matrix\n     * @zh 矩阵行列式\n     */\n    public static determinant <InType extends IMat4Like> (a: InType): number {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n        const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n        const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n        const a30 = a.m12; const a31 = a.m13; const a32 = a.m14; const a33 = a.m15;\n\n        const b00 = a00 * a11 - a01 * a10;\n        const b01 = a00 * a12 - a02 * a10;\n        const b02 = a00 * a13 - a03 * a10;\n        const b03 = a01 * a12 - a02 * a11;\n        const b04 = a01 * a13 - a03 * a11;\n        const b05 = a02 * a13 - a03 * a12;\n        const b06 = a20 * a31 - a21 * a30;\n        const b07 = a20 * a32 - a22 * a30;\n        const b08 = a20 * a33 - a23 * a30;\n        const b09 = a21 * a32 - a22 * a31;\n        const b10 = a21 * a33 - a23 * a31;\n        const b11 = a22 * a33 - a23 * a32;\n\n        // Calculate the determinant\n        return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    }\n\n    /**\n     * @en Multiply two matrices and save the results to out matrix\n     * @zh 矩阵乘法\n     */\n    public static multiply <Out extends IMat4Like> (out: Out, a: Out, b: Out) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n        const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n        const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n        const a30 = a.m12; const a31 = a.m13; const a32 = a.m14; const a33 = a.m15;\n\n        // Cache only the current line of the second matrix\n        let b0 = b.m00; let b1 = b.m01; let b2 = b.m02; let b3 = b.m03;\n        out.m00 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out.m01 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out.m02 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out.m03 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n        b0 = b.m04; b1 = b.m05; b2 = b.m06; b3 = b.m07;\n        out.m04 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out.m05 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out.m06 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out.m07 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n        b0 = b.m08; b1 = b.m09; b2 = b.m10; b3 = b.m11;\n        out.m08 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out.m09 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out.m10 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out.m11 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n        b0 = b.m12; b1 = b.m13; b2 = b.m14; b3 = b.m15;\n        out.m12 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        out.m13 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        out.m14 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        out.m15 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix with the given vector and save results to the out matrix\n     * @zh 在给定矩阵变换基础上加入变换\n     */\n    public static transform <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, a: Out, v: VecLike) {\n        const x = v.x; const y = v.y; const z = v.z;\n        if (a === out) {\n            out.m12 = a.m00 * x + a.m04 * y + a.m08 * z + a.m12;\n            out.m13 = a.m01 * x + a.m05 * y + a.m09 * z + a.m13;\n            out.m14 = a.m02 * x + a.m06 * y + a.m10 * z + a.m14;\n            out.m15 = a.m03 * x + a.m07 * y + a.m11 * z + a.m15;\n        } else {\n            const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n            const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n            const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n            const a30 = a.m12; const a31 = a.m13; const a32 = a.m14; const a33 = a.m15;\n\n            out.m00 = a00; out.m01 = a01; out.m02 = a02; out.m03 = a03;\n            out.m04 = a10; out.m05 = a11; out.m06 = a12; out.m07 = a13;\n            out.m08 = a20; out.m09 = a21; out.m10 = a22; out.m11 = a23;\n\n            out.m12 = a00 * x + a10 * y + a20 * z + a.m12;\n            out.m13 = a01 * x + a11 * y + a21 * z + a.m13;\n            out.m14 = a02 * x + a12 * y + a22 * z + a.m14;\n            out.m15 = a03 * x + a13 * y + a23 * z + a.m15;\n        }\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix with the given translation vector and save results to the out matrix\n     * @zh 在给定矩阵变换基础上加入新位移变换\n     */\n    public static translate <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, a: Out, v: VecLike) {\n        if (a === out) {\n            out.m12 += v.x;\n            out.m13 += v.y;\n            out.m14 += v.z;\n        } else {\n            out.m00 = a.m00; out.m01 = a.m01; out.m02 = a.m02; out.m03 = a.m03;\n            out.m04 = a.m04; out.m05 = a.m05; out.m06 = a.m06; out.m07 = a.m07;\n            out.m08 = a.m08; out.m09 = a.m09; out.m10 = a.m10; out.m11 = a.m11;\n            out.m12 += v.x;\n            out.m13 += v.y;\n            out.m14 += v.z;\n            out.m15 = a.m15;\n        }\n        return out;\n    }\n\n    /**\n     * @en Multiply a matrix with a scale matrix given by a scale vector and save the results into the out matrix\n     * @zh 在给定矩阵变换基础上加入新缩放变换\n     */\n    public static scale <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, a: Out, v: VecLike) {\n        const x = v.x; const y = v.y; const z = v.z;\n        out.m00 = a.m00 * x;\n        out.m01 = a.m01 * x;\n        out.m02 = a.m02 * x;\n        out.m03 = a.m03 * x;\n        out.m04 = a.m04 * y;\n        out.m05 = a.m05 * y;\n        out.m06 = a.m06 * y;\n        out.m07 = a.m07 * y;\n        out.m08 = a.m08 * z;\n        out.m09 = a.m09 * z;\n        out.m10 = a.m10 * z;\n        out.m11 = a.m11 * z;\n        out.m12 = a.m12;\n        out.m13 = a.m13;\n        out.m14 = a.m14;\n        out.m15 = a.m15;\n        return out;\n    }\n\n    /**\n     * @en Rotates the transform by the given angle and save the results into the out matrix\n     * @zh 在给定矩阵变换基础上加入新旋转变换\n     * @param rad Angle of rotation (in radians)\n     * @param axis axis of rotation\n     */\n    public static rotate <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, a: Out, rad: number, axis: VecLike) {\n        let x = axis.x; let y = axis.y; let z = axis.z;\n\n        let len = Math.sqrt(x * x + y * y + z * z);\n\n        if (Math.abs(len) < EPSILON) {\n            return null;\n        }\n\n        len = 1 / len;\n        x *= len;\n        y *= len;\n        z *= len;\n\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const t = 1 - c;\n\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n        const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n        const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n\n        // Construct the elements of the rotation matrix\n        const b00 = x * x * t + c; const b01 = y * x * t + z * s; const b02 = z * x * t - y * s;\n        const b10 = x * y * t - z * s; const b11 = y * y * t + c; const b12 = z * y * t + x * s;\n        const b20 = x * z * t + y * s; const b21 = y * z * t - x * s; const b22 = z * z * t + c;\n\n        // Perform rotation-specific matrix multiplication\n        out.m00 = a00 * b00 + a10 * b01 + a20 * b02;\n        out.m01 = a01 * b00 + a11 * b01 + a21 * b02;\n        out.m02 = a02 * b00 + a12 * b01 + a22 * b02;\n        out.m03 = a03 * b00 + a13 * b01 + a23 * b02;\n        out.m04 = a00 * b10 + a10 * b11 + a20 * b12;\n        out.m05 = a01 * b10 + a11 * b11 + a21 * b12;\n        out.m06 = a02 * b10 + a12 * b11 + a22 * b12;\n        out.m07 = a03 * b10 + a13 * b11 + a23 * b12;\n        out.m08 = a00 * b20 + a10 * b21 + a20 * b22;\n        out.m09 = a01 * b20 + a11 * b21 + a21 * b22;\n        out.m10 = a02 * b20 + a12 * b21 + a22 * b22;\n        out.m11 = a03 * b20 + a13 * b21 + a23 * b22;\n\n        // If the source and destination differ, copy the unchanged last row\n        if (a !== out) {\n            out.m12 = a.m12;\n            out.m13 = a.m13;\n            out.m14 = a.m14;\n            out.m15 = a.m15;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix with a given angle around X axis and save the results to the out matrix\n     * @zh 在给定矩阵变换基础上加入绕 X 轴的旋转变换\n     * @param rad Angle of rotation (in radians)\n     */\n    public static rotateX <Out extends IMat4Like> (out: Out, a: Out, rad: number) {\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const a10 = a.m04;\n        const a11 = a.m05;\n        const a12 = a.m06;\n        const a13 = a.m07;\n        const a20 = a.m08;\n        const a21 = a.m09;\n        const a22 = a.m10;\n        const a23 = a.m11;\n\n        if (a !== out) { // If the source and destination differ, copy the unchanged rows\n            out.m00 = a.m00;\n            out.m01 = a.m01;\n            out.m02 = a.m02;\n            out.m03 = a.m03;\n            out.m12 = a.m12;\n            out.m13 = a.m13;\n            out.m14 = a.m14;\n            out.m15 = a.m15;\n        }\n\n        // Perform axis-specific matrix multiplication\n        out.m04 = a10 * c + a20 * s;\n        out.m05 = a11 * c + a21 * s;\n        out.m06 = a12 * c + a22 * s;\n        out.m07 = a13 * c + a23 * s;\n        out.m08 = a20 * c - a10 * s;\n        out.m09 = a21 * c - a11 * s;\n        out.m10 = a22 * c - a12 * s;\n        out.m11 = a23 * c - a13 * s;\n\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix with a given angle around Y axis and save the results to the out matrix\n     * @zh 在给定矩阵变换基础上加入绕 Y 轴的旋转变换\n     * @param rad Angle of rotation (in radians)\n     */\n    public static rotateY <Out extends IMat4Like> (out: Out, a: Out, rad: number) {\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const a00 = a.m00;\n        const a01 = a.m01;\n        const a02 = a.m02;\n        const a03 = a.m03;\n        const a20 = a.m08;\n        const a21 = a.m09;\n        const a22 = a.m10;\n        const a23 = a.m11;\n\n        if (a !== out) { // If the source and destination differ, copy the unchanged rows\n            out.m04 = a.m04;\n            out.m05 = a.m05;\n            out.m06 = a.m06;\n            out.m07 = a.m07;\n            out.m12 = a.m12;\n            out.m13 = a.m13;\n            out.m14 = a.m14;\n            out.m15 = a.m15;\n        }\n\n        // Perform axis-specific matrix multiplication\n        out.m00 = a00 * c - a20 * s;\n        out.m01 = a01 * c - a21 * s;\n        out.m02 = a02 * c - a22 * s;\n        out.m03 = a03 * c - a23 * s;\n        out.m08 = a00 * s + a20 * c;\n        out.m09 = a01 * s + a21 * c;\n        out.m10 = a02 * s + a22 * c;\n        out.m11 = a03 * s + a23 * c;\n\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix with a given angle around Z axis and save the results to the out matrix\n     * @zh 在给定矩阵变换基础上加入绕 Z 轴的旋转变换\n     * @param rad Angle of rotation (in radians)\n     */\n    public static rotateZ <Out extends IMat4Like> (out: Out, a: Out, rad: number) {\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const a00 = a.m00;\n        const a01 = a.m01;\n        const a02 = a.m02;\n        const a03 = a.m03;\n        const a10 = a.m04;\n        const a11 = a.m05;\n        const a12 = a.m06;\n        const a13 = a.m07;\n\n        // If the source and destination differ, copy the unchanged last row\n        if (a !== out) {\n            out.m08 = a.m08;\n            out.m09 = a.m09;\n            out.m10 = a.m10;\n            out.m11 = a.m11;\n            out.m12 = a.m12;\n            out.m13 = a.m13;\n            out.m14 = a.m14;\n            out.m15 = a.m15;\n        }\n\n        // Perform axis-specific matrix multiplication\n        out.m00 = a00 * c + a10 * s;\n        out.m01 = a01 * c + a11 * s;\n        out.m02 = a02 * c + a12 * s;\n        out.m03 = a03 * c + a13 * s;\n        out.m04 = a10 * c - a00 * s;\n        out.m05 = a11 * c - a01 * s;\n        out.m06 = a12 * c - a02 * s;\n        out.m07 = a13 * c - a03 * s;\n\n        return out;\n    }\n\n    /**\n     * @en Sets the out matrix with a translation vector\n     * @zh 计算位移矩阵\n     */\n    public static fromTranslation <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, v: VecLike) {\n        out.m00 = 1;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 0;\n        out.m05 = 1;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = 0;\n        out.m10 = 1;\n        out.m11 = 0;\n        out.m12 = v.x;\n        out.m13 = v.y;\n        out.m14 = v.z;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Sets the out matrix with a scale vector\n     * @zh 计算缩放矩阵\n     */\n    public static fromScaling <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, v: VecLike) {\n        out.m00 = v.x;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 0;\n        out.m05 = v.y;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = 0;\n        out.m10 = v.z;\n        out.m11 = 0;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Sets the out matrix with rotation angle\n     * @zh 计算旋转矩阵\n     */\n    public static fromRotation <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, rad: number, axis: VecLike) {\n        let x = axis.x; let y = axis.y; let z = axis.z;\n        let len = Math.sqrt(x * x + y * y + z * z);\n\n        if (Math.abs(len) < EPSILON) {\n            return null;\n        }\n\n        len = 1 / len;\n        x *= len;\n        y *= len;\n        z *= len;\n\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const t = 1 - c;\n\n        // Perform rotation-specific matrix multiplication\n        out.m00 = x * x * t + c;\n        out.m01 = y * x * t + z * s;\n        out.m02 = z * x * t - y * s;\n        out.m03 = 0;\n        out.m04 = x * y * t - z * s;\n        out.m05 = y * y * t + c;\n        out.m06 = z * y * t + x * s;\n        out.m07 = 0;\n        out.m08 = x * z * t + y * s;\n        out.m09 = y * z * t - x * s;\n        out.m10 = z * z * t + c;\n        out.m11 = 0;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Calculates the matrix representing a rotation around the X axis\n     * @zh 计算绕 X 轴的旋转矩阵\n     */\n    public static fromXRotation <Out extends IMat4Like> (out: Out, rad: number) {\n        const s = Math.sin(rad); const c = Math.cos(rad);\n\n        // Perform axis-specific matrix multiplication\n        out.m00 = 1;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 0;\n        out.m05 = c;\n        out.m06 = s;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = -s;\n        out.m10 = c;\n        out.m11 = 0;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Calculates the matrix representing a rotation around the Y axis\n     * @zh 计算绕 Y 轴的旋转矩阵\n     */\n    public static fromYRotation <Out extends IMat4Like> (out: Out, rad: number) {\n        const s = Math.sin(rad); const c = Math.cos(rad);\n\n        // Perform axis-specific matrix multiplication\n        out.m00 = c;\n        out.m01 = 0;\n        out.m02 = -s;\n        out.m03 = 0;\n        out.m04 = 0;\n        out.m05 = 1;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = s;\n        out.m09 = 0;\n        out.m10 = c;\n        out.m11 = 0;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Calculates the matrix representing a rotation around the Z axis\n     * @zh 计算绕 Z 轴的旋转矩阵\n     */\n    public static fromZRotation <Out extends IMat4Like> (out: Out, rad: number) {\n        const s = Math.sin(rad); const c = Math.cos(rad);\n\n        // Perform axis-specific matrix multiplication\n        out.m00 = c;\n        out.m01 = s;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = -s;\n        out.m05 = c;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = 0;\n        out.m10 = 1;\n        out.m11 = 0;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en Calculates the transform representing the combination of a rotation and a translation\n     * @zh 根据旋转和位移信息计算矩阵\n     */\n    public static fromRT <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, q: Quat, v: VecLike) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const xy = x * y2;\n        const xz = x * z2;\n        const yy = y * y2;\n        const yz = y * z2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n\n        out.m00 = 1 - (yy + zz);\n        out.m01 = xy + wz;\n        out.m02 = xz - wy;\n        out.m03 = 0;\n        out.m04 = xy - wz;\n        out.m05 = 1 - (xx + zz);\n        out.m06 = yz + wx;\n        out.m07 = 0;\n        out.m08 = xz + wy;\n        out.m09 = yz - wx;\n        out.m10 = 1 - (xx + yy);\n        out.m11 = 0;\n        out.m12 = v.x;\n        out.m13 = v.y;\n        out.m14 = v.z;\n        out.m15 = 1;\n\n        return out;\n    }\n\n    /**\n     * @en Extracts the translation from the matrix, assuming it's composed in order of scale, rotation, translation\n     * @zh 提取矩阵的位移信息, 默认矩阵中的变换以 S->R->T 的顺序应用\n     */\n    public static getTranslation <InType extends IMat4Like, VecLike extends IVec3Like> (out: VecLike, mat: InType) {\n        out.x = mat.m12;\n        out.y = mat.m13;\n        out.z = mat.m14;\n\n        return out;\n    }\n\n    /**\n     * @en Extracts the scale vector from the matrix, assuming it's composed in order of scale, rotation, translation\n     * @zh 提取矩阵的缩放信息, 默认矩阵中的变换以 S->R->T 的顺序应用\n     */\n    public static getScaling <InType extends IMat4Like, VecLike extends IVec3Like> (out: VecLike, mat: InType) {\n        const m00 = m3_1.m00 = mat.m00;\n        const m01 = m3_1.m01 = mat.m01;\n        const m02 = m3_1.m02 = mat.m02;\n        const m04 = m3_1.m03 = mat.m04;\n        const m05 = m3_1.m04 = mat.m05;\n        const m06 = m3_1.m05 = mat.m06;\n        const m08 = m3_1.m06 = mat.m08;\n        const m09 = m3_1.m07 = mat.m09;\n        const m10 = m3_1.m08 = mat.m10;\n        out.x = Math.sqrt(m00 * m00 + m01 * m01 + m02 * m02);\n        out.y = Math.sqrt(m04 * m04 + m05 * m05 + m06 * m06);\n        out.z = Math.sqrt(m08 * m08 + m09 * m09 + m10 * m10);\n        // account for refections\n        if (Mat3.determinant(m3_1) < 0) { out.x *= -1; }\n        return out;\n    }\n\n    /**\n     * @en Extracts the rotation from the matrix, assuming it's composed in order of scale, rotation, translation\n     * @zh 提取矩阵的旋转信息, 默认输入矩阵不含有缩放信息，如考虑缩放应使用 `toRTS` 函数。\n     */\n    public static getRotation <InType extends IMat4Like> (out: Quat, mat: InType) {\n        const trace = mat.m00 + mat.m05 + mat.m10;\n        let S = 0;\n\n        if (trace > 0) {\n            S = Math.sqrt(trace + 1.0) * 2;\n            out.w = 0.25 * S;\n            out.x = (mat.m06 - mat.m09) / S;\n            out.y = (mat.m08 - mat.m02) / S;\n            out.z = (mat.m01 - mat.m04) / S;\n        } else if ((mat.m00 > mat.m05) && (mat.m00 > mat.m10)) {\n            S = Math.sqrt(1.0 + mat.m00 - mat.m05 - mat.m10) * 2;\n            out.w = (mat.m06 - mat.m09) / S;\n            out.x = 0.25 * S;\n            out.y = (mat.m01 + mat.m04) / S;\n            out.z = (mat.m08 + mat.m02) / S;\n        } else if (mat.m05 > mat.m10) {\n            S = Math.sqrt(1.0 + mat.m05 - mat.m00 - mat.m10) * 2;\n            out.w = (mat.m08 - mat.m02) / S;\n            out.x = (mat.m01 + mat.m04) / S;\n            out.y = 0.25 * S;\n            out.z = (mat.m06 + mat.m09) / S;\n        } else {\n            S = Math.sqrt(1.0 + mat.m10 - mat.m00 - mat.m05) * 2;\n            out.w = (mat.m01 - mat.m04) / S;\n            out.x = (mat.m08 + mat.m02) / S;\n            out.y = (mat.m06 + mat.m09) / S;\n            out.z = 0.25 * S;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Extracts the scale, rotation and translation from the matrix, assuming it's composed in order of scale, rotation, translation\n     * @zh 提取旋转、位移、缩放信息， 默认矩阵中的变换以 S->R->T 的顺序应用\n     */\n    public static toRTS <InType extends IMat4Like, VecLike extends IVec3Like> (m: InType, q: Quat, v: VecLike, s: VecLike) {\n        s.x = Vec3.set(v3_1, m.m00, m.m01, m.m02).length();\n        m3_1.m00 = m.m00 / s.x;\n        m3_1.m01 = m.m01 / s.x;\n        m3_1.m02 = m.m02 / s.x;\n        s.y = Vec3.set(v3_1, m.m04, m.m05, m.m06).length();\n        m3_1.m03 = m.m04 / s.y;\n        m3_1.m04 = m.m05 / s.y;\n        m3_1.m05 = m.m06 / s.y;\n        s.z = Vec3.set(v3_1, m.m08, m.m09, m.m10).length();\n        m3_1.m06 = m.m08 / s.z;\n        m3_1.m07 = m.m09 / s.z;\n        m3_1.m08 = m.m10 / s.z;\n        const det = Mat3.determinant(m3_1);\n        if (det < 0) { s.x *= -1; m3_1.m00 *= -1; m3_1.m01 *= -1; m3_1.m02 *= -1; }\n        Quat.fromMat3(q, m3_1); // already normalized\n        Vec3.set(v, m.m12, m.m13, m.m14);\n    }\n\n    /**\n     * @en Compose a matrix from scale, rotation and translation, applied in order.\n     * @zh 根据旋转、位移、缩放信息计算矩阵，以 S->R->T 的顺序应用\n     */\n    public static fromRTS <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, q: Quat, v: VecLike, s: VecLike) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const xy = x * y2;\n        const xz = x * z2;\n        const yy = y * y2;\n        const yz = y * z2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n        const sx = s.x;\n        const sy = s.y;\n        const sz = s.z;\n\n        out.m00 = (1 - (yy + zz)) * sx;\n        out.m01 = (xy + wz) * sx;\n        out.m02 = (xz - wy) * sx;\n        out.m03 = 0;\n        out.m04 = (xy - wz) * sy;\n        out.m05 = (1 - (xx + zz)) * sy;\n        out.m06 = (yz + wx) * sy;\n        out.m07 = 0;\n        out.m08 = (xz + wy) * sz;\n        out.m09 = (yz - wx) * sz;\n        out.m10 = (1 - (xx + yy)) * sz;\n        out.m11 = 0;\n        out.m12 = v.x;\n        out.m13 = v.y;\n        out.m14 = v.z;\n        out.m15 = 1;\n\n        return out;\n    }\n\n    /**\n     * @en Compose a matrix from scale, rotation and translation, applied in order, from a given origin\n     * @zh 根据指定的旋转、位移、缩放及变换中心信息计算矩阵，以 S->R->T 的顺序应用\n     * @param q Rotation quaternion\n     * @param v Translation vector\n     * @param s Scaling vector\n     * @param o transformation Center\n     */\n    public static fromRTSOrigin <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, q: Quat, v: VecLike, s: VecLike, o: VecLike) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const xy = x * y2;\n        const xz = x * z2;\n        const yy = y * y2;\n        const yz = y * z2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n\n        const sx = s.x;\n        const sy = s.y;\n        const sz = s.z;\n\n        const ox = o.x;\n        const oy = o.y;\n        const oz = o.z;\n\n        out.m00 = (1 - (yy + zz)) * sx;\n        out.m01 = (xy + wz) * sx;\n        out.m02 = (xz - wy) * sx;\n        out.m03 = 0;\n        out.m04 = (xy - wz) * sy;\n        out.m05 = (1 - (xx + zz)) * sy;\n        out.m06 = (yz + wx) * sy;\n        out.m07 = 0;\n        out.m08 = (xz + wy) * sz;\n        out.m09 = (yz - wx) * sz;\n        out.m10 = (1 - (xx + yy)) * sz;\n        out.m11 = 0;\n        out.m12 = v.x + ox - (out.m00 * ox + out.m04 * oy + out.m08 * oz);\n        out.m13 = v.y + oy - (out.m01 * ox + out.m05 * oy + out.m09 * oz);\n        out.m14 = v.z + oz - (out.m02 * ox + out.m06 * oy + out.m10 * oz);\n        out.m15 = 1;\n\n        return out;\n    }\n\n    /**\n     * @en Sets the out matrix with the given quaternion\n     * @zh 根据指定的旋转信息计算矩阵\n     */\n    public static fromQuat <Out extends IMat4Like> (out: Out, q: Quat) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const yx = y * x2;\n        const yy = y * y2;\n        const zx = z * x2;\n        const zy = z * y2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n\n        out.m00 = 1 - yy - zz;\n        out.m01 = yx + wz;\n        out.m02 = zx - wy;\n        out.m03 = 0;\n\n        out.m04 = yx - wz;\n        out.m05 = 1 - xx - zz;\n        out.m06 = zy + wx;\n        out.m07 = 0;\n\n        out.m08 = zx + wy;\n        out.m09 = zy - wx;\n        out.m10 = 1 - xx - yy;\n        out.m11 = 0;\n\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n\n        return out;\n    }\n\n    /**\n     * @en Calculates the matrix representing the given frustum\n     * @zh 根据指定的视锥体信息计算矩阵\n     * @param left The X coordinate of the left side of the near projection plane in view space.\n     * @param right The X coordinate of the right side of the near projection plane in view space.\n     * @param bottom The Y coordinate of the bottom side of the near projection plane in view space.\n     * @param top The Y coordinate of the top side of the near projection plane in view space.\n     * @param near Z distance to the near plane from the origin in view space.\n     * @param far Z distance to the far plane from the origin in view space.\n     */\n    public static frustum <Out extends IMat4Like> (out: Out, left: number, right: number, bottom: number, top: number, near: number, far: number) {\n        const rl = 1 / (right - left);\n        const tb = 1 / (top - bottom);\n        const nf = 1 / (near - far);\n\n        out.m00 = (near * 2) * rl;\n        out.m01 = 0;\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = 0;\n        out.m05 = (near * 2) * tb;\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = (right + left) * rl;\n        out.m09 = (top + bottom) * tb;\n        out.m10 = (far + near) * nf;\n        out.m11 = -1;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = (far * near * 2) * nf;\n        out.m15 = 0;\n        return out;\n    }\n\n    /**\n     * @en Calculates perspective projection matrix\n     * @zh 计算透视投影矩阵\n     * @param fovy Vertical field-of-view in degrees.\n     * @param aspect Aspect ratio\n     * @param near Near depth clipping plane value.\n     * @param far Far depth clipping plane value.\n     */\n    public static perspective <Out extends IMat4Like> (\n        out: Out, fov: number, aspect: number, near: number, far: number,\n        isFOVY = true, minClipZ = -1, projectionSignY = 1, orientation = 0,\n    ) {\n        const f = 1.0 / Math.tan(fov / 2);\n        const nf = 1 / (near - far);\n\n        const x = isFOVY ? f / aspect : f;\n        const y = (isFOVY ? f : f * aspect) * projectionSignY;\n        const preTransform = preTransforms[orientation];\n\n        out.m00 = x * preTransform[0];\n        out.m01 = x * preTransform[1];\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = y * preTransform[2];\n        out.m05 = y * preTransform[3];\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = 0;\n        out.m10 = (far - minClipZ * near) * nf;\n        out.m11 = -1;\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = far * near * nf * (1 - minClipZ);\n        out.m15 = 0;\n        return out;\n    }\n\n    /**\n     * @en Calculates orthogonal projection matrix\n     * @zh 计算正交投影矩阵\n     * @param left Left-side x-coordinate.\n     * @param right Right-side x-coordinate.\n     * @param bottom Bottom y-coordinate.\n     * @param top Top y-coordinate.\n     * @param near Near depth clipping plane value.\n     * @param far Far depth clipping plane value.\n     */\n    public static ortho <Out extends IMat4Like> (\n        out: Out, left: number, right: number, bottom: number, top: number, near: number, far: number,\n        minClipZ = -1, projectionSignY = 1, orientation = 0,\n    ) {\n        const lr = 1 / (left - right);\n        const bt = 1 / (bottom - top) * projectionSignY;\n        const nf = 1 / (near - far);\n\n        const x = -2 * lr;\n        const y = -2 * bt;\n        const dx = (left + right) * lr;\n        const dy = (top + bottom) * bt;\n        const preTransform = preTransforms[orientation];\n\n        out.m00 = x * preTransform[0];\n        out.m01 = x * preTransform[1];\n        out.m02 = 0;\n        out.m03 = 0;\n        out.m04 = y * preTransform[2];\n        out.m05 = y * preTransform[3];\n        out.m06 = 0;\n        out.m07 = 0;\n        out.m08 = 0;\n        out.m09 = 0;\n        out.m10 = nf * (1 - minClipZ);\n        out.m11 = 0;\n        out.m12 = dx * preTransform[0] + dy * preTransform[2];\n        out.m13 = dx * preTransform[1] + dy * preTransform[3];\n        out.m14 = (near - minClipZ * far) * nf;\n        out.m15 = 1;\n        return out;\n    }\n\n    /**\n     * @en\n     * Calculates the matrix with the view point information, given by eye position, target center and the up vector.\n     * Note that center to eye vector can't be zero or parallel to the up vector\n     * @zh\n     * 根据视点计算矩阵，注意 `eye - center` 不能为零向量或与 `up` 向量平行\n     * @param eye The source point.\n     * @param center The target point.\n     * @param up The vector describing the up direction.\n     */\n    public static lookAt <Out extends IMat4Like, VecLike extends IVec3Like> (out: Out, eye: VecLike, center: VecLike, up: VecLike) {\n        const eyex = eye.x;\n        const eyey = eye.y;\n        const eyez = eye.z;\n        const upx = up.x;\n        const upy = up.y;\n        const upz = up.z;\n        const centerx = center.x;\n        const centery = center.y;\n        const centerz = center.z;\n\n        let z0 = eyex - centerx;\n        let z1 = eyey - centery;\n        let z2 = eyez - centerz;\n\n        let len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n        z0 *= len;\n        z1 *= len;\n        z2 *= len;\n\n        let x0 = upy * z2 - upz * z1;\n        let x1 = upz * z0 - upx * z2;\n        let x2 = upx * z1 - upy * z0;\n        len = 1 / Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n        x0 *= len;\n        x1 *= len;\n        x2 *= len;\n\n        const y0 = z1 * x2 - z2 * x1;\n        const y1 = z2 * x0 - z0 * x2;\n        const y2 = z0 * x1 - z1 * x0;\n\n        out.m00 = x0;\n        out.m01 = y0;\n        out.m02 = z0;\n        out.m03 = 0;\n        out.m04 = x1;\n        out.m05 = y1;\n        out.m06 = z1;\n        out.m07 = 0;\n        out.m08 = x2;\n        out.m09 = y2;\n        out.m10 = z2;\n        out.m11 = 0;\n        out.m12 = -(x0 * eyex + x1 * eyey + x2 * eyez);\n        out.m13 = -(y0 * eyex + y1 * eyey + y2 * eyez);\n        out.m14 = -(z0 * eyex + z1 * eyey + z2 * eyez);\n        out.m15 = 1;\n\n        return out;\n    }\n\n    /**\n     * @en Calculates the inverse transpose of a matrix and save the results to out matrix\n     * @zh 计算逆转置矩阵\n     */\n    public static inverseTranspose <Out extends IMat4Like> (out: Out, a: Out) {\n        const a00 = a.m00; const a01 = a.m01; const a02 = a.m02; const a03 = a.m03;\n        const a10 = a.m04; const a11 = a.m05; const a12 = a.m06; const a13 = a.m07;\n        const a20 = a.m08; const a21 = a.m09; const a22 = a.m10; const a23 = a.m11;\n        const a30 = a.m12; const a31 = a.m13; const a32 = a.m14; const a33 = a.m15;\n\n        const b00 = a00 * a11 - a01 * a10;\n        const b01 = a00 * a12 - a02 * a10;\n        const b02 = a00 * a13 - a03 * a10;\n        const b03 = a01 * a12 - a02 * a11;\n        const b04 = a01 * a13 - a03 * a11;\n        const b05 = a02 * a13 - a03 * a12;\n        const b06 = a20 * a31 - a21 * a30;\n        const b07 = a20 * a32 - a22 * a30;\n        const b08 = a20 * a33 - a23 * a30;\n        const b09 = a21 * a32 - a22 * a31;\n        const b10 = a21 * a33 - a23 * a31;\n        const b11 = a22 * a33 - a23 * a32;\n\n        // Calculate the determinant\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        if (!det) {\n            return null;\n        }\n        det = 1.0 / det;\n\n        out.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n        out.m01 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n        out.m02 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n        out.m03 = 0;\n\n        out.m04 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n        out.m05 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n        out.m06 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n        out.m07 = 0;\n\n        out.m08 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n        out.m09 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n        out.m10 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n        out.m11 = 0;\n\n        out.m12 = 0;\n        out.m13 = 0;\n        out.m14 = 0;\n        out.m15 = 1;\n\n        return out;\n    }\n\n    /**\n     * @en Transform a matrix object to a flat array\n     * @zh 矩阵转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray <Out extends IWritableArrayLike<number>> (out: Out, m: IMat4Like, ofs = 0) {\n        out[ofs + 0] = m.m00;\n        out[ofs + 1] = m.m01;\n        out[ofs + 2] = m.m02;\n        out[ofs + 3] = m.m03;\n        out[ofs + 4] = m.m04;\n        out[ofs + 5] = m.m05;\n        out[ofs + 6] = m.m06;\n        out[ofs + 7] = m.m07;\n        out[ofs + 8] = m.m08;\n        out[ofs + 9] = m.m09;\n        out[ofs + 10] = m.m10;\n        out[ofs + 11] = m.m11;\n        out[ofs + 12] = m.m12;\n        out[ofs + 13] = m.m13;\n        out[ofs + 14] = m.m14;\n        out[ofs + 15] = m.m15;\n        return out;\n    }\n\n    /**\n     * @en Generates or sets a matrix with a flat array\n     * @zh 数组转矩阵\n     * @param ofs Array Start Offset\n     */\n    public static fromArray <Out extends IMat4Like> (out: Out, arr: IWritableArrayLike<number>, ofs = 0) {\n        out.m00 = arr[ofs + 0];\n        out.m01 = arr[ofs + 1];\n        out.m02 = arr[ofs + 2];\n        out.m03 = arr[ofs + 3];\n        out.m04 = arr[ofs + 4];\n        out.m05 = arr[ofs + 5];\n        out.m06 = arr[ofs + 6];\n        out.m07 = arr[ofs + 7];\n        out.m08 = arr[ofs + 8];\n        out.m09 = arr[ofs + 9];\n        out.m10 = arr[ofs + 10];\n        out.m11 = arr[ofs + 11];\n        out.m12 = arr[ofs + 12];\n        out.m13 = arr[ofs + 13];\n        out.m14 = arr[ofs + 14];\n        out.m15 = arr[ofs + 15];\n        return out;\n    }\n\n    /**\n     * @en Adds two matrices and save the results to out matrix\n     * @zh 逐元素矩阵加法\n     */\n    public static add <Out extends IMat4Like> (out: Out, a: Out, b: Out) {\n        out.m00 = a.m00 + b.m00;\n        out.m01 = a.m01 + b.m01;\n        out.m02 = a.m02 + b.m02;\n        out.m03 = a.m03 + b.m03;\n        out.m04 = a.m04 + b.m04;\n        out.m05 = a.m05 + b.m05;\n        out.m06 = a.m06 + b.m06;\n        out.m07 = a.m07 + b.m07;\n        out.m08 = a.m08 + b.m08;\n        out.m09 = a.m09 + b.m09;\n        out.m10 = a.m10 + b.m10;\n        out.m11 = a.m11 + b.m11;\n        out.m12 = a.m12 + b.m12;\n        out.m13 = a.m13 + b.m13;\n        out.m14 = a.m14 + b.m14;\n        out.m15 = a.m15 + b.m15;\n        return out;\n    }\n\n    /**\n     * @en Subtracts matrix b from matrix a and save the results to out matrix\n     * @zh 逐元素矩阵减法\n     */\n    public static subtract <Out extends IMat4Like> (out: Out, a: Out, b: Out) {\n        out.m00 = a.m00 - b.m00;\n        out.m01 = a.m01 - b.m01;\n        out.m02 = a.m02 - b.m02;\n        out.m03 = a.m03 - b.m03;\n        out.m04 = a.m04 - b.m04;\n        out.m05 = a.m05 - b.m05;\n        out.m06 = a.m06 - b.m06;\n        out.m07 = a.m07 - b.m07;\n        out.m08 = a.m08 - b.m08;\n        out.m09 = a.m09 - b.m09;\n        out.m10 = a.m10 - b.m10;\n        out.m11 = a.m11 - b.m11;\n        out.m12 = a.m12 - b.m12;\n        out.m13 = a.m13 - b.m13;\n        out.m14 = a.m14 - b.m14;\n        out.m15 = a.m15 - b.m15;\n        return out;\n    }\n\n    /**\n     * @en Multiply each element of a matrix by a scalar number and save the results to out matrix\n     * @zh 矩阵标量乘法\n     */\n    public static multiplyScalar <Out extends IMat4Like> (out: Out, a: Out, b: number) {\n        out.m00 = a.m00 * b;\n        out.m01 = a.m01 * b;\n        out.m02 = a.m02 * b;\n        out.m03 = a.m03 * b;\n        out.m04 = a.m04 * b;\n        out.m05 = a.m05 * b;\n        out.m06 = a.m06 * b;\n        out.m07 = a.m07 * b;\n        out.m08 = a.m08 * b;\n        out.m09 = a.m09 * b;\n        out.m10 = a.m10 * b;\n        out.m11 = a.m11 * b;\n        out.m12 = a.m12 * b;\n        out.m13 = a.m13 * b;\n        out.m14 = a.m14 * b;\n        out.m15 = a.m15 * b;\n        return out;\n    }\n\n    /**\n     * @en Adds two matrices after multiplying each element of the second operand by a scalar number. And save the results to out matrix.\n     * @zh 逐元素矩阵标量乘加: A + B * scale\n     */\n    public static multiplyScalarAndAdd <Out extends IMat4Like> (out: Out, a: Out, b: Out, scale: number) {\n        out.m00 = a.m00 + (b.m00 * scale);\n        out.m01 = a.m01 + (b.m01 * scale);\n        out.m02 = a.m02 + (b.m02 * scale);\n        out.m03 = a.m03 + (b.m03 * scale);\n        out.m04 = a.m04 + (b.m04 * scale);\n        out.m05 = a.m05 + (b.m05 * scale);\n        out.m06 = a.m06 + (b.m06 * scale);\n        out.m07 = a.m07 + (b.m07 * scale);\n        out.m08 = a.m08 + (b.m08 * scale);\n        out.m09 = a.m09 + (b.m09 * scale);\n        out.m10 = a.m10 + (b.m10 * scale);\n        out.m11 = a.m11 + (b.m11 * scale);\n        out.m12 = a.m12 + (b.m12 * scale);\n        out.m13 = a.m13 + (b.m13 * scale);\n        out.m14 = a.m14 + (b.m14 * scale);\n        out.m15 = a.m15 + (b.m15 * scale);\n        return out;\n    }\n\n    /**\n     * @en Returns whether the specified matrices are equal.\n     * @zh 矩阵等价判断\n     */\n    public static strictEquals <InType extends IMat4Like> (a: InType, b: InType) {\n        return a.m00 === b.m00 && a.m01 === b.m01 && a.m02 === b.m02 && a.m03 === b.m03\n            && a.m04 === b.m04 && a.m05 === b.m05 && a.m06 === b.m06 && a.m07 === b.m07\n            && a.m08 === b.m08 && a.m09 === b.m09 && a.m10 === b.m10 && a.m11 === b.m11\n            && a.m12 === b.m12 && a.m13 === b.m13 && a.m14 === b.m14 && a.m15 === b.m15;\n    }\n\n    /**\n     * @en Returns whether the specified matrices are approximately equal.\n     * @zh 排除浮点数误差的矩阵近似等价判断\n     */\n    public static equals <InType extends IMat4Like> (a: InType, b: InType, epsilon = EPSILON) {\n        // TAOCP vol.2, 3rd ed., s.4.2.4, p.213-225\n        // defines a 'close enough' relationship between u and v that scales for magnitude\n        return (\n            Math.abs(a.m00 - b.m00) <= epsilon * Math.max(1.0, Math.abs(a.m00), Math.abs(b.m00))\n            && Math.abs(a.m01 - b.m01) <= epsilon * Math.max(1.0, Math.abs(a.m01), Math.abs(b.m01))\n            && Math.abs(a.m02 - b.m02) <= epsilon * Math.max(1.0, Math.abs(a.m02), Math.abs(b.m02))\n            && Math.abs(a.m03 - b.m03) <= epsilon * Math.max(1.0, Math.abs(a.m03), Math.abs(b.m03))\n            && Math.abs(a.m04 - b.m04) <= epsilon * Math.max(1.0, Math.abs(a.m04), Math.abs(b.m04))\n            && Math.abs(a.m05 - b.m05) <= epsilon * Math.max(1.0, Math.abs(a.m05), Math.abs(b.m05))\n            && Math.abs(a.m06 - b.m06) <= epsilon * Math.max(1.0, Math.abs(a.m06), Math.abs(b.m06))\n            && Math.abs(a.m07 - b.m07) <= epsilon * Math.max(1.0, Math.abs(a.m07), Math.abs(b.m07))\n            && Math.abs(a.m08 - b.m08) <= epsilon * Math.max(1.0, Math.abs(a.m08), Math.abs(b.m08))\n            && Math.abs(a.m09 - b.m09) <= epsilon * Math.max(1.0, Math.abs(a.m09), Math.abs(b.m09))\n            && Math.abs(a.m10 - b.m10) <= epsilon * Math.max(1.0, Math.abs(a.m10), Math.abs(b.m10))\n            && Math.abs(a.m11 - b.m11) <= epsilon * Math.max(1.0, Math.abs(a.m11), Math.abs(b.m11))\n            && Math.abs(a.m12 - b.m12) <= epsilon * Math.max(1.0, Math.abs(a.m12), Math.abs(b.m12))\n            && Math.abs(a.m13 - b.m13) <= epsilon * Math.max(1.0, Math.abs(a.m13), Math.abs(b.m13))\n            && Math.abs(a.m14 - b.m14) <= epsilon * Math.max(1.0, Math.abs(a.m14), Math.abs(b.m14))\n            && Math.abs(a.m15 - b.m15) <= epsilon * Math.max(1.0, Math.abs(a.m15), Math.abs(b.m15))\n        );\n    }\n\n    /**\n     * @en Value at column 0 row 0 of the matrix.\n     * @zh 矩阵第 0 列第 0 行的元素。\n     */\n    public m00: number;\n\n    /**\n     * @en Value at column 0 row 1 of the matrix.\n     * @zh 矩阵第 0 列第 1 行的元素。\n     */\n    public m01: number;\n\n    /**\n     * @en Value at column 0 row 2 of the matrix.\n     * @zh 矩阵第 0 列第 2 行的元素。\n     */\n    public m02: number;\n\n    /**\n     * @en Value at column 0 row 3 of the matrix.\n     * @zh 矩阵第 0 列第 3 行的元素。\n     */\n    public m03: number;\n\n    /**\n     * @en Value at column 1 row 0 of the matrix.\n     * @zh 矩阵第 1 列第 0 行的元素。\n     */\n    public m04: number;\n\n    /**\n     * @en Value at column 1 row 1 of the matrix.\n     * @zh 矩阵第 1 列第 1 行的元素。\n     */\n    public m05: number;\n\n    /**\n     * @en Value at column 1 row 2 of the matrix.\n     * @zh 矩阵第 1 列第 2 行的元素。\n     */\n    public m06: number;\n\n    /**\n     * @en Value at column 1 row 3 of the matrix.\n     * @zh 矩阵第 1 列第 3 行的元素。\n     */\n    public m07: number;\n\n    /**\n     * @en Value at column 2 row 0 of the matrix.\n     * @zh 矩阵第 2 列第 0 行的元素。\n     */\n    public m08: number;\n\n    /**\n     * @en Value at column 2 row 1 of the matrix.\n     * @zh 矩阵第 2 列第 1 行的元素。\n     */\n    public m09: number;\n\n    /**\n     * @en Value at column 2 row 2 of the matrix.\n     * @zh 矩阵第 2 列第 2 行的元素。\n     */\n    public m10: number;\n\n    /**\n     * @en Value at column 2 row 3 of the matrix.\n     * @zh 矩阵第 2 列第 3 行的元素。\n     */\n    public m11: number;\n\n    /**\n     * @en Value at column 3 row 0 of the matrix.\n     * @zh 矩阵第 3 列第 0 行的元素。\n     */\n    public m12: number;\n\n    /**\n     * @en Value at column 3 row 1 of the matrix.\n     * @zh 矩阵第 3 列第 1 行的元素。\n     */\n    public m13: number;\n\n    /**\n     * @en Value at column 3 row 2 of the matrix.\n     * @zh 矩阵第 3 列第 2 行的元素。\n     */\n    public m14: number;\n\n    /**\n     * @en Value at column 3 row 3 of the matrix.\n     * @zh 矩阵第 3 列第 3 行的元素。\n     */\n    public m15: number;\n\n    constructor (other: Mat4);\n\n    constructor (\n        m00?: number, m01?: number, m02?: number, m03?: number,\n        m04?: number, m05?: number, m06?: number, m07?: number,\n        m08?: number, m09?: number, m10?: number, m11?: number,\n        m12?: number, m13?: number, m14?: number, m15?: number);\n\n    constructor (\n        m00: Mat4 | number = 1, m01 = 0, m02 = 0, m03 = 0,\n        m04 = 0, m05 = 1, m06 = 0, m07 = 0,\n        m08 = 0, m09 = 0, m10 = 1, m11 = 0,\n        m12 = 0, m13 = 0, m14 = 0, m15 = 1,\n    ) {\n        super();\n        if (typeof m00 === 'object') {\n            this.m00 = m00.m00; this.m01 = m00.m01; this.m02 = m00.m02; this.m03 = m00.m03;\n            this.m04 = m00.m04; this.m05 = m00.m05; this.m06 = m00.m06; this.m07 = m00.m07;\n            this.m08 = m00.m08; this.m09 = m00.m09; this.m10 = m00.m10; this.m11 = m00.m11;\n            this.m12 = m00.m12; this.m13 = m00.m13; this.m14 = m00.m14; this.m15 = m00.m15;\n        } else {\n            this.m00 = m00; this.m01 = m01; this.m02 = m02; this.m03 = m03;\n            this.m04 = m04; this.m05 = m05; this.m06 = m06; this.m07 = m07;\n            this.m08 = m08; this.m09 = m09; this.m10 = m10; this.m11 = m11;\n            this.m12 = m12; this.m13 = m13; this.m14 = m14; this.m15 = m15;\n        }\n    }\n\n    /**\n     * @en Clone a new matrix from the current matrix.\n     * @zh 克隆当前矩阵。\n     */\n    public clone () {\n        return new Mat4(\n            this.m00, this.m01, this.m02, this.m03,\n            this.m04, this.m05, this.m06, this.m07,\n            this.m08, this.m09, this.m10, this.m11,\n            this.m12, this.m13, this.m14, this.m15,\n        );\n    }\n\n    /**\n     * @en Sets the matrix with another one's value.\n     * @zh 设置当前矩阵使其与指定矩阵相等。\n     * @param other Specified matrix.\n     * @return this\n     */\n    public set (other: Mat4): Mat4;\n\n    /**\n     * @en Set the matrix with values of all elements\n     * @zh 设置当前矩阵指定元素值。\n     * @return this\n     */\n    public set (\n        m00?: number, m01?: number, m02?: number, m03?: number,\n        m04?: number, m05?: number, m06?: number, m07?: number,\n        m08?: number, m09?: number, m10?: number, m11?: number,\n        m12?: number, m13?: number, m14?: number, m15?: number): Mat4;\n\n    public set (m00: Mat4 | number = 1, m01 = 0, m02 = 0, m03 = 0,\n        m04 = 0, m05 = 1, m06 = 0, m07 = 0,\n        m08 = 0, m09 = 0, m10 = 1, m11 = 0,\n        m12 = 0, m13 = 0, m14 = 0, m15 = 1) {\n        if (typeof m00 === 'object') {\n            this.m01 = m00.m01; this.m02 = m00.m02; this.m03 = m00.m03; this.m04 = m00.m04;\n            this.m05 = m00.m05; this.m06 = m00.m06; this.m07 = m00.m07; this.m08 = m00.m08;\n            this.m09 = m00.m09; this.m10 = m00.m10; this.m11 = m00.m11; this.m12 = m00.m12;\n            this.m13 = m00.m13; this.m14 = m00.m14; this.m15 = m00.m15; this.m00 = m00.m00;\n        } else {\n            this.m01 = m01; this.m02 = m02; this.m03 = m03; this.m04 = m04;\n            this.m05 = m05; this.m06 = m06; this.m07 = m07; this.m08 = m08;\n            this.m09 = m09; this.m10 = m10; this.m11 = m11; this.m12 = m12;\n            this.m13 = m13; this.m14 = m14; this.m15 = m15; this.m00 = m00;\n        }\n        return this;\n    }\n\n    /**\n     * @en Returns whether the specified matrices are approximately equal.\n     * @zh 判断当前矩阵是否在误差范围内与指定矩阵相等。\n     * @param other Comparative matrix\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @return Returns `true' when the elements of both matrices are equal; otherwise returns `false'.\n     */\n    public equals (other: Mat4, epsilon = EPSILON): boolean {\n        return (\n            Math.abs(this.m00 - other.m00) <= epsilon * Math.max(1.0, Math.abs(this.m00), Math.abs(other.m00))\n            && Math.abs(this.m01 - other.m01) <= epsilon * Math.max(1.0, Math.abs(this.m01), Math.abs(other.m01))\n            && Math.abs(this.m02 - other.m02) <= epsilon * Math.max(1.0, Math.abs(this.m02), Math.abs(other.m02))\n            && Math.abs(this.m03 - other.m03) <= epsilon * Math.max(1.0, Math.abs(this.m03), Math.abs(other.m03))\n            && Math.abs(this.m04 - other.m04) <= epsilon * Math.max(1.0, Math.abs(this.m04), Math.abs(other.m04))\n            && Math.abs(this.m05 - other.m05) <= epsilon * Math.max(1.0, Math.abs(this.m05), Math.abs(other.m05))\n            && Math.abs(this.m06 - other.m06) <= epsilon * Math.max(1.0, Math.abs(this.m06), Math.abs(other.m06))\n            && Math.abs(this.m07 - other.m07) <= epsilon * Math.max(1.0, Math.abs(this.m07), Math.abs(other.m07))\n            && Math.abs(this.m08 - other.m08) <= epsilon * Math.max(1.0, Math.abs(this.m08), Math.abs(other.m08))\n            && Math.abs(this.m09 - other.m09) <= epsilon * Math.max(1.0, Math.abs(this.m09), Math.abs(other.m09))\n            && Math.abs(this.m10 - other.m10) <= epsilon * Math.max(1.0, Math.abs(this.m10), Math.abs(other.m10))\n            && Math.abs(this.m11 - other.m11) <= epsilon * Math.max(1.0, Math.abs(this.m11), Math.abs(other.m11))\n            && Math.abs(this.m12 - other.m12) <= epsilon * Math.max(1.0, Math.abs(this.m12), Math.abs(other.m12))\n            && Math.abs(this.m13 - other.m13) <= epsilon * Math.max(1.0, Math.abs(this.m13), Math.abs(other.m13))\n            && Math.abs(this.m14 - other.m14) <= epsilon * Math.max(1.0, Math.abs(this.m14), Math.abs(other.m14))\n            && Math.abs(this.m15 - other.m15) <= epsilon * Math.max(1.0, Math.abs(this.m15), Math.abs(other.m15))\n        );\n    }\n\n    /**\n     * @en Returns whether the specified matrices are equal.\n     * @zh 判断当前矩阵是否与指定矩阵相等。\n     * @param other Comparative matrix\n     * @return Returns `true' when the elements of both matrices are equal; otherwise returns `false'.\n     */\n    public strictEquals (other: Mat4): boolean {\n        return this.m00 === other.m00 && this.m01 === other.m01 && this.m02 === other.m02 && this.m03 === other.m03\n            && this.m04 === other.m04 && this.m05 === other.m05 && this.m06 === other.m06 && this.m07 === other.m07\n            && this.m08 === other.m08 && this.m09 === other.m09 && this.m10 === other.m10 && this.m11 === other.m11\n            && this.m12 === other.m12 && this.m13 === other.m13 && this.m14 === other.m14 && this.m15 === other.m15;\n    }\n\n    /**\n     * @en Returns a string representation of a matrix.\n     * @zh 返回当前矩阵的字符串表示。\n     * @return 当前矩阵的字符串表示。\n     */\n    public toString () {\n        return `[\\n${\n            this.m00}, ${this.m01}, ${this.m02}, ${this.m03},\\n${\n            this.m04}, ${this.m05}, ${this.m06}, ${this.m07},\\n${\n            this.m08}, ${this.m09}, ${this.m10}, ${this.m11},\\n${\n            this.m12}, ${this.m13}, ${this.m14}, ${this.m15}\\n`\n            + ']';\n    }\n\n    /**\n     * @en set the current matrix to an identity matrix.\n     * @zh 将当前矩阵设为单位矩阵。\n     * @return `this`\n     */\n    public identity () {\n        this.m00 = 1;\n        this.m01 = 0;\n        this.m02 = 0;\n        this.m03 = 0;\n        this.m04 = 0;\n        this.m05 = 1;\n        this.m06 = 0;\n        this.m07 = 0;\n        this.m08 = 0;\n        this.m09 = 0;\n        this.m10 = 1;\n        this.m11 = 0;\n        this.m12 = 0;\n        this.m13 = 0;\n        this.m14 = 0;\n        this.m15 = 1;\n        return this;\n    }\n\n    /**\n     * @en set the current matrix to an zero matrix.\n     * @zh 将当前矩阵设为 0矩阵。\n     * @return `this`\n     */\n    public zero () {\n        this.m00 = 0;\n        this.m01 = 0;\n        this.m02 = 0;\n        this.m03 = 0;\n        this.m04 = 0;\n        this.m05 = 0;\n        this.m06 = 0;\n        this.m07 = 0;\n        this.m08 = 0;\n        this.m09 = 0;\n        this.m10 = 0;\n        this.m11 = 0;\n        this.m12 = 0;\n        this.m13 = 0;\n        this.m14 = 0;\n        this.m15 = 0;\n        return this;\n    }\n\n    /**\n     * @en Transposes the current matrix.\n     * @zh 计算当前矩阵的转置矩阵。\n     */\n    public transpose () {\n        const a01 = this.m01; const a02 = this.m02; const a03 = this.m03; const a12 = this.m06; const a13 = this.m07; const a23 = this.m11;\n        this.m01 = this.m04;\n        this.m02 = this.m08;\n        this.m03 = this.m12;\n        this.m04 = a01;\n        this.m06 = this.m09;\n        this.m07 = this.m13;\n        this.m08 = a02;\n        this.m09 = a12;\n        this.m11 = this.m14;\n        this.m12 = a03;\n        this.m13 = a13;\n        this.m14 = a23;\n        return this;\n    }\n\n    /**\n     * @en Inverts the current matrix. When matrix is not invertible the matrix will be set to zeros.\n     * @zh 计算当前矩阵的逆矩阵。注意，在矩阵不可逆时，会返回一个全为 0 的矩阵。\n     */\n    public invert () {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02; const a03 = this.m03;\n        const a10 = this.m04; const a11 = this.m05; const a12 = this.m06; const a13 = this.m07;\n        const a20 = this.m08; const a21 = this.m09; const a22 = this.m10; const a23 = this.m11;\n        const a30 = this.m12; const a31 = this.m13; const a32 = this.m14; const a33 = this.m15;\n\n        const b00 = a00 * a11 - a01 * a10;\n        const b01 = a00 * a12 - a02 * a10;\n        const b02 = a00 * a13 - a03 * a10;\n        const b03 = a01 * a12 - a02 * a11;\n        const b04 = a01 * a13 - a03 * a11;\n        const b05 = a02 * a13 - a03 * a12;\n        const b06 = a20 * a31 - a21 * a30;\n        const b07 = a20 * a32 - a22 * a30;\n        const b08 = a20 * a33 - a23 * a30;\n        const b09 = a21 * a32 - a22 * a31;\n        const b10 = a21 * a33 - a23 * a31;\n        const b11 = a22 * a33 - a23 * a32;\n\n        // Calculate the determinant\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        if (det === 0) {\n            this.set(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\n            return this;\n        }\n        det = 1.0 / det;\n\n        this.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n        this.m01 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n        this.m02 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n        this.m03 = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n        this.m04 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n        this.m05 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n        this.m06 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n        this.m07 = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n        this.m08 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n        this.m09 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n        this.m10 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n        this.m11 = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n        this.m12 = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n        this.m13 = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n        this.m14 = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n        this.m15 = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n\n        return this;\n    }\n\n    /**\n     * @en Calculates the determinant of the current matrix.\n     * @zh 计算当前矩阵的行列式。\n     * @return 当前矩阵的行列式。\n     */\n    public determinant (): number {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02; const a03 = this.m03;\n        const a10 = this.m04; const a11 = this.m05; const a12 = this.m06; const a13 = this.m07;\n        const a20 = this.m08; const a21 = this.m09; const a22 = this.m10; const a23 = this.m11;\n        const a30 = this.m12; const a31 = this.m13; const a32 = this.m14; const a33 = this.m15;\n\n        const b00 = a00 * a11 - a01 * a10;\n        const b01 = a00 * a12 - a02 * a10;\n        const b02 = a00 * a13 - a03 * a10;\n        const b03 = a01 * a12 - a02 * a11;\n        const b04 = a01 * a13 - a03 * a11;\n        const b05 = a02 * a13 - a03 * a12;\n        const b06 = a20 * a31 - a21 * a30;\n        const b07 = a20 * a32 - a22 * a30;\n        const b08 = a20 * a33 - a23 * a30;\n        const b09 = a21 * a32 - a22 * a31;\n        const b10 = a21 * a33 - a23 * a31;\n        const b11 = a22 * a33 - a23 * a32;\n\n        // Calculate the determinant\n        return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    }\n\n    /**\n     * @en Adds the current matrix and another matrix to the current matrix.\n     * @zh 矩阵加法。将当前矩阵与指定矩阵的相加，结果返回给当前矩阵。\n     * @param mat the second operand\n     */\n    public add (mat: Mat4) {\n        this.m00 += mat.m00;\n        this.m01 += mat.m01;\n        this.m02 += mat.m02;\n        this.m03 += mat.m03;\n        this.m04 += mat.m04;\n        this.m05 += mat.m05;\n        this.m06 += mat.m06;\n        this.m07 += mat.m07;\n        this.m08 += mat.m08;\n        this.m09 += mat.m09;\n        this.m10 += mat.m10;\n        this.m11 += mat.m11;\n        this.m12 += mat.m12;\n        this.m13 += mat.m13;\n        this.m14 += mat.m14;\n        this.m15 += mat.m15;\n        return this;\n    }\n\n    /**\n     * @en Subtracts another matrix from the current matrix.\n     * @zh 计算矩阵减法。将当前矩阵减去指定矩阵的结果赋值给当前矩阵。\n     * @param mat the second operand\n     */\n    public subtract (mat: Mat4) {\n        this.m00 -= mat.m00;\n        this.m01 -= mat.m01;\n        this.m02 -= mat.m02;\n        this.m03 -= mat.m03;\n        this.m04 -= mat.m04;\n        this.m05 -= mat.m05;\n        this.m06 -= mat.m06;\n        this.m07 -= mat.m07;\n        this.m08 -= mat.m08;\n        this.m09 -= mat.m09;\n        this.m10 -= mat.m10;\n        this.m11 -= mat.m11;\n        this.m12 -= mat.m12;\n        this.m13 -= mat.m13;\n        this.m14 -= mat.m14;\n        this.m15 -= mat.m15;\n        return this;\n    }\n\n    /**\n     * @en Multiply the current matrix with another matrix.\n     * @zh 矩阵乘法。将当前矩阵左乘指定矩阵的结果赋值给当前矩阵。\n     * @param mat the second operand\n     */\n    public multiply (mat: Mat4) {\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02; const a03 = this.m03;\n        const a10 = this.m04; const a11 = this.m05; const a12 = this.m06; const a13 = this.m07;\n        const a20 = this.m08; const a21 = this.m09; const a22 = this.m10; const a23 = this.m11;\n        const a30 = this.m12; const a31 = this.m13; const a32 = this.m14; const a33 = this.m15;\n\n        // Cache only the current line of the second matrix\n        let b0 = mat.m00; let b1 = mat.m01; let b2 = mat.m02; let b3 = mat.m03;\n        this.m00 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        this.m01 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        this.m02 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        this.m03 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n        b0 = mat.m04; b1 = mat.m05; b2 = mat.m06; b3 = mat.m07;\n        this.m04 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        this.m05 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        this.m06 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        this.m07 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n        b0 = mat.m08; b1 = mat.m09; b2 = mat.m10; b3 = mat.m11;\n        this.m08 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        this.m09 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        this.m10 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        this.m11 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n        b0 = mat.m12; b1 = mat.m13; b2 = mat.m14; b3 = mat.m15;\n        this.m12 = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n        this.m13 = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n        this.m14 = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n        this.m15 = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n        return this;\n    }\n\n    /**\n     * @en Multiply each element of the current matrix by a scalar number.\n     * @zh 矩阵数乘。将当前矩阵与指定标量的数乘结果赋值给当前矩阵。\n     * @param scalar amount to scale the matrix's elements by\n     */\n    public multiplyScalar (scalar: number) {\n        this.m00 *= scalar;\n        this.m01 *= scalar;\n        this.m02 *= scalar;\n        this.m03 *= scalar;\n        this.m04 *= scalar;\n        this.m05 *= scalar;\n        this.m06 *= scalar;\n        this.m07 *= scalar;\n        this.m08 *= scalar;\n        this.m09 *= scalar;\n        this.m10 *= scalar;\n        this.m11 *= scalar;\n        this.m12 *= scalar;\n        this.m13 *= scalar;\n        this.m14 *= scalar;\n        this.m15 *= scalar;\n        return this;\n    }\n\n    /**\n     * @en Translate the current matrix by the given vector\n     * @zh 将当前矩阵左乘位移矩阵的结果赋值给当前矩阵，位移矩阵由各个轴的位移给出。\n     * @param vec vector to translate by\n     */\n    public translate (vec: Vec3) {\n        this.m12 += vec.x;\n        this.m13 += vec.y;\n        this.m14 += vec.z;\n        return this;\n    }\n\n    /**\n     * @en Multiply the current matrix with a scale vector.\n     * @zh 将当前矩阵左乘缩放矩阵的结果赋值给当前矩阵，缩放矩阵由各个轴的缩放给出。\n     * @param vec vector to scale by\n     */\n    public scale (vec: Vec3) {\n        const x = vec.x; const y = vec.y; const z = vec.z;\n        this.m00 *= x;\n        this.m01 *= x;\n        this.m02 *= x;\n        this.m03 *= x;\n        this.m04 *= y;\n        this.m05 *= y;\n        this.m06 *= y;\n        this.m07 *= y;\n        this.m08 *= z;\n        this.m09 *= z;\n        this.m10 *= z;\n        this.m11 *= z;\n        return this;\n    }\n\n    /**\n     * @en Rotates the current matrix by the given angle around the given axis\n     * @zh 将当前矩阵左乘旋转矩阵的结果赋值给当前矩阵，旋转矩阵由旋转轴和旋转角度给出。\n     * @param rad Angle of rotation (in radians)\n     * @param axis Axis of rotation\n     */\n    public rotate (rad: number, axis: Vec3) {\n        let x = axis.x; let y = axis.y; let z = axis.z;\n\n        let len = Math.sqrt(x * x + y * y + z * z);\n\n        if (Math.abs(len) < EPSILON) {\n            return null;\n        }\n\n        len = 1 / len;\n        x *= len;\n        y *= len;\n        z *= len;\n\n        const s = Math.sin(rad);\n        const c = Math.cos(rad);\n        const t = 1 - c;\n\n        const a00 = this.m00; const a01 = this.m01; const a02 = this.m02; const a03 = this.m03;\n        const a10 = this.m04; const a11 = this.m05; const a12 = this.m06; const a13 = this.m07;\n        const a20 = this.m08; const a21 = this.m09; const a22 = this.m10; const a23 = this.m11;\n\n        // Construct the elements of the rotation matrix\n        const b00 = x * x * t + c; const b01 = y * x * t + z * s; const b02 = z * x * t - y * s;\n        const b10 = x * y * t - z * s; const b11 = y * y * t + c; const b12 = z * y * t + x * s;\n        const b20 = x * z * t + y * s; const b21 = y * z * t - x * s; const b22 = z * z * t + c;\n\n        // Perform rotation-specific matrix multiplication\n        this.m00 = a00 * b00 + a10 * b01 + a20 * b02;\n        this.m01 = a01 * b00 + a11 * b01 + a21 * b02;\n        this.m02 = a02 * b00 + a12 * b01 + a22 * b02;\n        this.m03 = a03 * b00 + a13 * b01 + a23 * b02;\n        this.m04 = a00 * b10 + a10 * b11 + a20 * b12;\n        this.m05 = a01 * b10 + a11 * b11 + a21 * b12;\n        this.m06 = a02 * b10 + a12 * b11 + a22 * b12;\n        this.m07 = a03 * b10 + a13 * b11 + a23 * b12;\n        this.m08 = a00 * b20 + a10 * b21 + a20 * b22;\n        this.m09 = a01 * b20 + a11 * b21 + a21 * b22;\n        this.m10 = a02 * b20 + a12 * b21 + a22 * b22;\n        this.m11 = a03 * b20 + a13 * b21 + a23 * b22;\n\n        return this;\n    }\n\n    /**\n     * @en Returns the translation vector component of a transformation matrix.\n     * @zh 从当前矩阵中计算出位移变换的部分，并以各个轴上位移的形式赋值给出口向量。\n     * @param out Vector to receive translation component.\n     */\n    public getTranslation (out: Vec3) {\n        out.x = this.m12;\n        out.y = this.m13;\n        out.z = this.m14;\n\n        return out;\n    }\n\n    /**\n     * @en Returns the scale factor component of a transformation matrix\n     * @zh 从当前矩阵中计算出缩放变换的部分，并以各个轴上缩放的形式赋值给出口向量。\n     * @param out Vector to receive scale component\n     */\n    public getScale (out: Vec3) {\n        const m00 = m3_1.m00 = this.m00;\n        const m01 = m3_1.m01 = this.m01;\n        const m02 = m3_1.m02 = this.m02;\n        const m04 = m3_1.m03 = this.m04;\n        const m05 = m3_1.m04 = this.m05;\n        const m06 = m3_1.m05 = this.m06;\n        const m08 = m3_1.m06 = this.m08;\n        const m09 = m3_1.m07 = this.m09;\n        const m10 = m3_1.m08 = this.m10;\n        out.x = Math.sqrt(m00 * m00 + m01 * m01 + m02 * m02);\n        out.y = Math.sqrt(m04 * m04 + m05 * m05 + m06 * m06);\n        out.z = Math.sqrt(m08 * m08 + m09 * m09 + m10 * m10);\n        // account for refections\n        if (Mat3.determinant(m3_1) < 0) { out.x *= -1; }\n        return out;\n    }\n\n    /**\n     * @en Returns the rotation factor component of a transformation matrix\n     * @zh 从当前矩阵中计算出旋转变换的部分，并以四元数的形式赋值给出口四元数。\n     * @param out Vector to receive rotation component\n     */\n    public getRotation (out: Quat) {\n        const trace = this.m00 + this.m05 + this.m10;\n        let S = 0;\n\n        if (trace > 0) {\n            S = Math.sqrt(trace + 1.0) * 2;\n            out.w = 0.25 * S;\n            out.x = (this.m06 - this.m09) / S;\n            out.y = (this.m08 - this.m02) / S;\n            out.z = (this.m01 - this.m04) / S;\n        } else if ((this.m00 > this.m05) && (this.m00 > this.m10)) {\n            S = Math.sqrt(1.0 + this.m00 - this.m05 - this.m10) * 2;\n            out.w = (this.m06 - this.m09) / S;\n            out.x = 0.25 * S;\n            out.y = (this.m01 + this.m04) / S;\n            out.z = (this.m08 + this.m02) / S;\n        } else if (this.m05 > this.m10) {\n            S = Math.sqrt(1.0 + this.m05 - this.m00 - this.m10) * 2;\n            out.w = (this.m08 - this.m02) / S;\n            out.x = (this.m01 + this.m04) / S;\n            out.y = 0.25 * S;\n            out.z = (this.m06 + this.m09) / S;\n        } else {\n            S = Math.sqrt(1.0 + this.m10 - this.m00 - this.m05) * 2;\n            out.w = (this.m01 - this.m04) / S;\n            out.x = (this.m08 + this.m02) / S;\n            out.y = (this.m06 + this.m09) / S;\n            out.z = 0.25 * S;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Resets the matrix values by the given rotation quaternion, translation vector and scale vector\n     * @zh 重置当前矩阵的值，使其表示指定的旋转、缩放、位移依次组合的变换。\n     * @param q Rotation quaternion\n     * @param v Translation vector\n     * @param s Scaling vector\n     * @return `this`\n     */\n    public fromRTS (q: Quat, v: Vec3, s: Vec3) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const xy = x * y2;\n        const xz = x * z2;\n        const yy = y * y2;\n        const yz = y * z2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n        const sx = s.x;\n        const sy = s.y;\n        const sz = s.z;\n\n        this.m00 = (1 - (yy + zz)) * sx;\n        this.m01 = (xy + wz) * sx;\n        this.m02 = (xz - wy) * sx;\n        this.m03 = 0;\n        this.m04 = (xy - wz) * sy;\n        this.m05 = (1 - (xx + zz)) * sy;\n        this.m06 = (yz + wx) * sy;\n        this.m07 = 0;\n        this.m08 = (xz + wy) * sz;\n        this.m09 = (yz - wx) * sz;\n        this.m10 = (1 - (xx + yy)) * sz;\n        this.m11 = 0;\n        this.m12 = v.x;\n        this.m13 = v.y;\n        this.m14 = v.z;\n        this.m15 = 1;\n\n        return this;\n    }\n\n    /**\n     * @en Resets the current matrix from the given quaternion.\n     * @zh 重置当前矩阵的值，使其表示指定四元数表示的旋转变换。\n     * @param q Rotation quaternion\n     * @return `this`\n     */\n    public fromQuat (q: Quat) {\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\n        const x2 = x + x;\n        const y2 = y + y;\n        const z2 = z + z;\n\n        const xx = x * x2;\n        const yx = y * x2;\n        const yy = y * y2;\n        const zx = z * x2;\n        const zy = z * y2;\n        const zz = z * z2;\n        const wx = w * x2;\n        const wy = w * y2;\n        const wz = w * z2;\n\n        this.m00 = 1 - yy - zz;\n        this.m01 = yx + wz;\n        this.m02 = zx - wy;\n        this.m03 = 0;\n\n        this.m04 = yx - wz;\n        this.m05 = 1 - xx - zz;\n        this.m06 = zy + wx;\n        this.m07 = 0;\n\n        this.m08 = zx + wy;\n        this.m09 = zy - wx;\n        this.m10 = 1 - xx - yy;\n        this.m11 = 0;\n\n        this.m12 = 0;\n        this.m13 = 0;\n        this.m14 = 0;\n        this.m15 = 1;\n\n        return this;\n    }\n}\n\nconst v3_1 = new Vec3();\nconst m3_1 = new Mat3();\n\nCCClass.fastDefine('cc.Mat4', Mat4, {\n    m00: 1,\n    m01: 0,\n    m02: 0,\n    m03: 0,\n    m04: 0,\n    m05: 1,\n    m06: 0,\n    m07: 0,\n    m08: 0,\n    m09: 0,\n    m10: 1,\n    m11: 0,\n    m12: 0,\n    m13: 0,\n    m14: 0,\n    m15: 1,\n});\nlegacyCC.Mat4 = Mat4;\n\nexport function mat4 (other: Mat4): Mat4;\nexport function mat4 (\n    m00?: number, m01?: number, m02?: number, m03?: number,\n    m10?: number, m11?: number, m12?: number, m13?: number,\n    m20?: number, m21?: number, m22?: number, m23?: number,\n    m30?: number, m31?: number, m32?: number, m33?: number): Mat4;\n\nexport function mat4 (\n    m00?: Mat4 | number, m01?, m02?, m03?,\n    m10?, m11?, m12?, m13?,\n    m20?, m21?, m22?, m23?,\n    m30?, m31?, m32?, m33?,\n) {\n    return new Mat4(m00 as any, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33);\n}\n\nlegacyCC.mat4 = mat4;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Mat4 } from './mat4';\nimport { IMat3Like, IMat4Like, IVec2Like } from './type-define';\nimport { clamp, EPSILON, random } from './utils';\n\nimport { Vec3 } from './vec3';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Representation of 2D vectors and points.\n * @zh 二维向量。\n */\nexport class Vec2 extends ValueType {\n    public static ZERO = Object.freeze(new Vec2(0, 0));\n    public static ONE = Object.freeze(new Vec2(1, 1));\n    public static NEG_ONE = Object.freeze(new Vec2(-1, -1));\n    public static UNIT_X = Object.freeze(new Vec2(1, 0));\n    public static UNIT_Y = Object.freeze(new Vec2(0, 1));\n\n    /**\n     * @en Obtains a clone of the given vector object\n     * @zh 获得指定向量的拷贝\n     */\n    public static clone <Out extends IVec2Like> (a: Out) {\n        return new Vec2(a.x, a.y);\n    }\n\n    /**\n     * @en Copy the target vector and save the results to out vector object\n     * @zh 复制目标向量\n     */\n    public static copy <Out extends IVec2Like> (out: Out, a: Out) {\n        out.x = a.x;\n        out.y = a.y;\n        return out;\n    }\n\n    /**\n     * @en Sets the out vector with the given x and y values\n     * @zh 设置向量值\n     */\n    public static set <Out extends IVec2Like> (out: Out, x: number, y: number) {\n        out.x = x;\n        out.y = y;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector addition and save the results to out vector object\n     * @zh 逐元素向量加法\n     */\n    public static add <Out extends IVec2Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x + b.x;\n        out.y = a.y + b.y;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector subtraction and save the results to out vector object\n     * @zh 逐元素向量减法\n     */\n    public static subtract <Out extends IVec2Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x - b.x;\n        out.y = a.y - b.y;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector multiplication and save the results to out vector object\n     * @zh 逐元素向量乘法\n     */\n    public static multiply <Out extends IVec2Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x * b.x;\n        out.y = a.y * b.y;\n        return out;\n    }\n\n    /**\n     * @en Element-wise vector division and save the results to out vector object\n     * @zh 逐元素向量除法\n     */\n    public static divide <Out extends IVec2Like> (out: Out, a: Out, b: Out) {\n        out.x = a.x / b.x;\n        out.y = a.y / b.y;\n        return out;\n    }\n\n    /**\n     * @en Rounds up by elements of the vector and save the results to out vector object\n     * @zh 逐元素向量向上取整\n     */\n    public static ceil <Out extends IVec2Like> (out: Out, a: Out) {\n        out.x = Math.ceil(a.x);\n        out.y = Math.ceil(a.y);\n        return out;\n    }\n\n    /**\n     * @en Element-wise rounds down of the current vector and save the results to the out vector\n     * @zh 逐元素向量向下取整\n     */\n    public static floor <Out extends IVec2Like> (out: Out, a: Out) {\n        out.x = Math.floor(a.x);\n        out.y = Math.floor(a.y);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise minimum values and save to the out vector\n     * @zh 逐元素向量最小值\n     */\n    public static min <Out extends IVec2Like> (out: Out, a: Out, b: Out) {\n        out.x = Math.min(a.x, b.x);\n        out.y = Math.min(a.y, b.y);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise maximum values and save to the out vector\n     * @zh 逐元素向量最大值\n     */\n    public static max <Out extends IVec2Like> (out: Out, a: Out, b: Out) {\n        out.x = Math.max(a.x, b.x);\n        out.y = Math.max(a.y, b.y);\n        return out;\n    }\n\n    /**\n     * @en Calculates element-wise round results and save to the out vector\n     * @zh 逐元素向量四舍五入取整\n     */\n    public static round <Out extends IVec2Like> (out: Out, a: Out) {\n        out.x = Math.round(a.x);\n        out.y = Math.round(a.y);\n        return out;\n    }\n\n    /**\n     * @en Vector scalar multiplication and save the results to out vector object\n     * @zh 向量标量乘法\n     */\n    public static multiplyScalar <Out extends IVec2Like> (out: Out, a: Out, b: number) {\n        out.x = a.x * b;\n        out.y = a.y * b;\n        return out;\n    }\n\n    /**\n     * @en Element-wise multiplication and addition with the equation: a + b * scale\n     * @zh 逐元素向量乘加: A + B * scale\n     */\n    public static scaleAndAdd <Out extends IVec2Like> (out: Out, a: Out, b: Out, scale: number) {\n        out.x = a.x + (b.x * scale);\n        out.y = a.y + (b.y * scale);\n        return out;\n    }\n\n    /**\n     * @en Calculates the euclidean distance of two vectors\n     * @zh 求两向量的欧氏距离\n     */\n    public static distance <Out extends IVec2Like> (a: Out, b: Out) {\n        const x = b.x - a.x;\n        const y = b.y - a.y;\n        return Math.sqrt(x * x + y * y);\n    }\n\n    /**\n     * @en Calculates the squared euclidean distance of two vectors\n     * @zh 求两向量的欧氏距离平方\n     */\n    public static squaredDistance <Out extends IVec2Like> (a: Out, b: Out) {\n        const x = b.x - a.x;\n        const y = b.y - a.y;\n        return x * x + y * y;\n    }\n\n    /**\n     * @en Calculates the length of the vector\n     * @zh 求向量长度\n     */\n    public static len <Out extends IVec2Like> (a: Out) {\n        const x = a.x;\n        const y = a.y;\n        return Math.sqrt(x * x + y * y);\n    }\n\n    /**\n     * @en Calculates the squared length of the vector\n     * @zh 求向量长度平方\n     */\n    public static lengthSqr <Out extends IVec2Like> (a: Out) {\n        const x = a.x;\n        const y = a.y;\n        return x * x + y * y;\n    }\n\n    /**\n     * @en Sets each element to its negative value\n     * @zh 逐元素向量取负\n     */\n    public static negate <Out extends IVec2Like> (out: Out, a: Out) {\n        out.x = -a.x;\n        out.y = -a.y;\n        return out;\n    }\n\n    /**\n     * @en Sets each element to its inverse value, zero value will become Infinity\n     * @zh 逐元素向量取倒数，接近 0 时返回 Infinity\n     */\n    public static inverse <Out extends IVec2Like> (out: Out, a: Out) {\n        out.x = 1.0 / a.x;\n        out.y = 1.0 / a.y;\n        return out;\n    }\n\n    /**\n     * @en Sets each element to its inverse value, zero value will remain zero\n     * @zh 逐元素向量取倒数，接近 0 时返回 0\n     */\n    public static inverseSafe <Out extends IVec2Like> (out: Out, a: Out) {\n        const x = a.x;\n        const y = a.y;\n\n        if (Math.abs(x) < EPSILON) {\n            out.x = 0;\n        } else {\n            out.x = 1.0 / x;\n        }\n\n        if (Math.abs(y) < EPSILON) {\n            out.y = 0;\n        } else {\n            out.y = 1.0 / y;\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Sets the normalized vector to the out vector\n     * @zh 归一化向量\n     */\n    public static normalize <Out extends IVec2Like, Vec2Like extends IVec2Like> (out: Out, a: Vec2Like) {\n        const x = a.x;\n        const y = a.y;\n        let len = x * x + y * y;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            out.x = x * len;\n            out.y = y * len;\n        }\n        return out;\n    }\n\n    /**\n     * @en Calculates the dot product of the vector\n     * @zh 向量点积（数量积）\n     */\n    public static dot <Out extends IVec2Like> (a: Out, b: Out) {\n        return a.x * b.x + a.y * b.y;\n    }\n\n    /**\n     * @en Calculates the cross product of the vector\n     * @zh 向量叉积（向量积），注意二维向量的叉积为与 Z 轴平行的三维向量\n     * @override (a:Vec2, b:Vec2) => number\n     * @override [deprecated] (out:Vec3, a:Vec2, b:Vec2) => Vec3\n     */\n    public static cross (a: IVec2Like, b: IVec2Like): number;\n\n    /**\n     * @deprecated Consider use another overrides please.\n     */\n    public static cross <Out extends IVec2Like> (out: Vec3, a: Out, b: Out): Vec3;\n\n    public static cross (out: IVec2Like | Vec3, a: IVec2Like, b?: IVec2Like) : number | Vec3 {\n        if (out instanceof Vec3) {\n            out.x = out.y = 0;\n            out.z = a.x * b!.y - a.y * b!.x;\n            return out;\n        } else {\n            return out.x * a.y - out.y * a.x;\n        }\n    }\n\n    /**\n     * @en Calculates the linear interpolation between two vectors with a given ratio\n     * @zh 逐元素向量线性插值： A + t * (B - A)\n     */\n    public static lerp <Out extends IVec2Like> (out: Out, a: Out, b: Out, t: number) {\n        const x = a.x;\n        const y = a.y;\n        out.x = x + t * (b.x - x);\n        out.y = y + t * (b.y - y);\n        return out;\n    }\n\n    /**\n     * @en Generates a uniformly distributed random vector points from center to the surface of the unit sphere\n     * @zh 生成一个在单位圆上均匀分布的随机向量\n     * @param scale vector length\n     */\n    public static random <Out extends IVec2Like> (out: Out, scale?: number) {\n        scale = scale || 1.0;\n        const r = random() * 2.0 * Math.PI;\n        out.x = Math.cos(r) * scale;\n        out.y = Math.sin(r) * scale;\n        return out;\n    }\n\n    /**\n     * @en Vector and third order matrix multiplication, will complete the vector with a third value as one\n     * @zh 向量与三维矩阵乘法，默认向量第三位为 1。\n     */\n    public static transformMat3 <Out extends IVec2Like, MatLike extends IMat3Like> (out: Out, a: Out, m: IMat3Like) {\n        const x = a.x;\n        const y = a.y;\n        out.x = m.m00 * x + m.m03 * y + m.m06;\n        out.y = m.m01 * x + m.m04 * y + m.m07;\n        return out;\n    }\n\n    /**\n     * @en Vector and third order matrix multiplication, will complete the vector with a third and a fourth element as one\n     * @zh 向量与四维矩阵乘法，默认向量第三位为 0，第四位为 1。\n     */\n    public static transformMat4 <Out extends IVec2Like, MatLike extends IMat4Like> (out: Out, a: Out, m: IMat4Like) {\n        const x = a.x;\n        const y = a.y;\n        out.x = m.m00 * x + m.m04 * y + m.m12;\n        out.y = m.m01 * x + m.m05 * y + m.m13;\n        return out;\n    }\n\n    /**\n     * @en Gets the string representation of the given vector\n     * @zh 返回向量的字符串表示\n     */\n    public static str <Out extends IVec2Like> (a: Out) {\n        return `Vec2(${a.x}, ${a.y})`;\n    }\n\n    /**\n     * @en Converts the given vector to an array\n     * @zh 向量转数组\n     * @param ofs Array Start Offset\n     */\n    public static toArray <Out extends IWritableArrayLike<number>> (out: Out, v: IVec2Like, ofs = 0) {\n        out[ofs + 0] = v.x;\n        out[ofs + 1] = v.y;\n        return out;\n    }\n\n    /**\n     * @en Converts the given array to a vector\n     * @zh 数组转向量\n     * @param ofs Array Start Offset\n     */\n    public static fromArray <Out extends IVec2Like> (out: Out, arr: IWritableArrayLike<number>, ofs = 0) {\n        out.x = arr[ofs + 0];\n        out.y = arr[ofs + 1];\n        return out;\n    }\n\n    /**\n     * @en Check the equality of the two given vectors\n     * @zh 向量等价判断\n     */\n    public static strictEquals <Out extends IVec2Like> (a: Out, b: Out) {\n        return a.x === b.x && a.y === b.y;\n    }\n\n    /**\n     * @en Check whether the two given vectors are approximately equivalent\n     * @zh 排除浮点数误差的向量近似等价判断\n     */\n    public static equals <Out extends IVec2Like> (a: Out, b: Out,  epsilon = EPSILON) {\n        return (\n            Math.abs(a.x - b.x)\n            <= epsilon * Math.max(1.0, Math.abs(a.x), Math.abs(b.x))\n            && Math.abs(a.y - b.y)\n            <= epsilon * Math.max(1.0, Math.abs(a.y), Math.abs(b.y))\n        );\n    }\n\n    /**\n     * @en Calculates the radian angle between two vectors\n     * @zh 求两向量夹角弧度\n     */\n    public static angle <Out extends IVec2Like> (a: Out, b: Out) {\n        Vec2.normalize(v2_1, a);\n        Vec2.normalize(v2_2, b);\n        const cosine = Vec2.dot(v2_1, v2_2);\n        if (cosine > 1.0) {\n            return 0;\n        }\n        if (cosine < -1.0) {\n            return Math.PI;\n        }\n        return Math.acos(cosine);\n    }\n\n    /**\n     * @en x component.\n     * @zh x 分量。\n     */\n    public declare x: number;\n\n    /**\n     * @en y component.\n     * @zh y 分量。\n     */\n    public declare y: number;\n\n    constructor (other: Vec2);\n\n    constructor (x?: number, y?: number);\n\n    constructor (x?: number | Vec2, y?: number) {\n        super();\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n        }\n    }\n\n    /**\n     * @en clone a Vec2 value\n     * @zh 克隆当前向量。\n     */\n    public clone () {\n        return new Vec2(this.x, this.y);\n    }\n\n    /**\n     * @en Set the current vector value with the given vector.\n     * @zh 设置当前向量使其与指定向量相等。\n     * @param other Specified vector\n     * @return `this`\n     */\n    public set (other: Vec2): Vec2;\n\n    /**\n     * @en Set the value of each component of the current vector.\n     * @zh 设置当前向量的具体分量值。\n     * @param x x value\n     * @param y y value\n     * @return `this`\n     */\n    public set (x?: number, y?: number): Vec2;\n\n    public set (x?: number | Vec2, y?: number) {\n        if (x && typeof x === 'object') {\n            this.x = x.x;\n            this.y = x.y;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n        }\n        return this;\n    }\n\n    /**\n     * @en Check whether the vector approximately equals another one.\n     * @zh 判断当前向量是否在误差范围内与指定向量相等。\n     * @param other Specified vector\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @return Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public equals (other: Vec2, epsilon = EPSILON) {\n        return (\n            Math.abs(this.x - other.x)\n            <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(other.x))\n            && Math.abs(this.y - other.y)\n            <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(other.y))\n        );\n    }\n\n    /**\n     * @en Check whether the vector approximately equals another one.\n     * @zh 判断当前向量是否在误差范围内与指定分量的向量相等。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @param epsilon The error allowed. It`s should be a non-negative number.\n     * @return Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public equals2f (x: number, y: number, epsilon = EPSILON) {\n        return (\n            Math.abs(this.x - x)\n            <= epsilon * Math.max(1.0, Math.abs(this.x), Math.abs(x))\n            && Math.abs(this.y - y)\n            <= epsilon * Math.max(1.0, Math.abs(this.y), Math.abs(y))\n        );\n    }\n\n    /**\n     * @en Check whether the current vector strictly equals another Vec2.\n     * @zh 判断当前向量是否与指定向量相等。\n     * @param other specified vector\n     * @return Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public strictEquals (other: Vec2) {\n        return other && this.x === other.x && this.y === other.y;\n    }\n\n    /**\n     * @en Check whether the current vector strictly equals another Vec2.\n     * @zh 判断当前向量是否与指定分量的向量相等。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     * @return Returns `true` when the components of both vectors are equal within the specified range of error; otherwise it returns `false`.\n     */\n    public strictEquals2f (x: number, y: number) {\n        return this.x === x && this.y === y;\n    }\n\n    /**\n     * @en Transform to string with vector information.\n     * @zh 返回当前向量的字符串表示。\n     * @returns The string with vector information\n     */\n    public toString () {\n        return `(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`;\n    }\n\n    /**\n     * @en Calculate linear interpolation result between this vector and another one with given ratio.\n     * @zh 根据指定的插值比率，从当前向量到目标向量之间做插值。\n     * @param to Target vector\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public lerp (to: Vec2, ratio: number) {\n        const x = this.x;\n        const y = this.y;\n        this.x = x + ratio * (to.x - x);\n        this.y = y + ratio * (to.y - y);\n        return this;\n    }\n\n    /**\n     * @en Clamp the vector between minInclusive and maxInclusive.\n     * @zh 设置当前向量的值，使其各个分量都处于指定的范围内。\n     * @param minInclusive Minimum value allowed\n     * @param maxInclusive Maximum value allowed\n     * @return `this`\n     */\n    public clampf (minInclusive: Vec2, maxInclusive: Vec2) {\n        this.x = clamp(this.x, minInclusive.x, maxInclusive.x);\n        this.y = clamp(this.y, minInclusive.y, maxInclusive.y);\n        return this;\n    }\n\n    /**\n     * @en Adds the current vector with another one and return this\n     * @zh 向量加法。将当前向量与指定向量的相加\n     * @param other specified vector\n     */\n    public add (other: Vec2) {\n        this.x += other.x;\n        this.y += other.y;\n        return this;\n    }\n\n    /**\n     * @en Adds the current vector with another one and return this\n     * @zh 向量加法。将当前向量与指定分量的向量相加\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     */\n    public add2f (x: number, y: number) {\n        this.x += x;\n        this.y += y;\n        return this;\n    }\n\n    /**\n     * @en Subtracts one vector from this, and returns this.\n     * @zh 向量减法。将当前向量减去指定向量\n     * @param other specified vector\n     */\n    public subtract (other: Vec2) {\n        this.x -= other.x;\n        this.y -= other.y;\n        return this;\n    }\n\n    /**\n     * @en Subtracts one vector from this, and returns this.\n     * @zh 向量减法。将当前向量减去指定分量的向量\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     */\n    public subtract2f (x: number, y: number) {\n        this.x -= x;\n        this.y -= y;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with a number, and returns this.\n     * @zh 向量数乘。将当前向量数乘指定标量\n     * @param scalar scalar number\n     */\n    public multiplyScalar (scalar: number) {\n        if (typeof scalar === 'object') { console.warn('should use Vec2.multiply for vector * vector operation'); }\n        this.x *= scalar;\n        this.y *= scalar;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with another one and return this\n     * @zh 向量乘法。将当前向量乘以与指定向量的结果赋值给当前向量。\n     * @param other specified vector\n     */\n    public multiply (other: Vec2) {\n        if (typeof other !== 'object') { console.warn('should use Vec2.scale for vector * scalar operation'); }\n        this.x *= other.x;\n        this.y *= other.y;\n        return this;\n    }\n\n    /**\n     * @en Multiplies the current vector with another one and return this\n     * @zh 向量乘法。将当前向量与指定分量的向量相乘的结果赋值给当前向量。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     */\n    public multiply2f (x: number, y: number) {\n        this.x *= x;\n        this.y *= y;\n        return this;\n    }\n\n    /**\n     * @en Element-wisely divides this vector with another one, and return this.\n     * @zh 向量逐元素相除。将当前向量与指定分量的向量相除的结果赋值给当前向量。\n     * @param other specified vector\n     */\n    public divide (other: Vec2) {\n        this.x /= other.x;\n        this.y /= other.y;\n        return this;\n    }\n\n    /**\n     * @en Element-wisely divides this vector with another one, and return this.\n     * @zh 向量逐元素相除。将当前向量与指定分量的向量相除的结果赋值给当前向量。\n     * @param x The x value of specified vector\n     * @param y The y value of specified vector\n     */\n    public divide2f (x: number, y: number) {\n        this.x /= x;\n        this.y /= y;\n        return this;\n    }\n\n    /**\n     * @en Sets each component of this vector with its negative value\n     * @zh 将当前向量的各个分量取反\n     */\n    public negative () {\n        this.x = -this.x;\n        this.y = -this.y;\n        return this;\n    }\n\n    /**\n     * @en Calculates the dot product with another vector\n     * @zh 向量点乘。\n     * @param other specified vector\n     * @return The result of calculates the dot product with another vector\n     */\n    public dot (other: Vec2) {\n        return this.x * other.x + this.y * other.y;\n    }\n\n    /**\n     * @en Calculates the cross product with another vector.\n     * @zh 向量叉乘。\n     * @param other specified vector\n     * @return `out`\n     */\n    public cross (other: Vec2) {\n        return this.x * other.y - this.y * other.x;\n    }\n\n    /**\n     * @en Returns the length of this vector.\n     * @zh 计算向量的长度（模）。\n     * @return Length of vector\n     */\n    public length () {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n\n    /**\n     * @en Returns the squared length of this vector.\n     * @zh 计算向量长度（模）的平方。\n     * @return the squared length of this vector\n     */\n    public lengthSqr () {\n        return this.x * this.x + this.y * this.y;\n    }\n\n    /**\n     * @en Normalize the current vector.\n     * @zh 将当前向量归一化。\n     */\n    public normalize () {\n        const x = this.x;\n        const y = this.y;\n        let len = x * x + y * y;\n        if (len > 0) {\n            len = 1 / Math.sqrt(len);\n            this.x *= len;\n            this.y *= len;\n        }\n        return this;\n    }\n\n    /**\n     * @en Calculates radian angle between two vectors\n     * @zh 获取当前向量和指定向量之间的角度。\n     * @param other specified vector\n     * @return The angle between the current vector and the specified vector (in radians); if there are zero vectors in the current vector and the specified vector, 0 is returned.\n     */\n    public angle (other: Vec2) {\n        const magSqr1 = this.lengthSqr();\n        const magSqr2 = other.lengthSqr();\n\n        if (magSqr1 === 0 || magSqr2 === 0) {\n            console.warn('Can\\'t get angle between zero vector');\n            return 0.0;\n        }\n\n        const dot = this.dot(other);\n        let theta = dot / (Math.sqrt(magSqr1 * magSqr2));\n        theta = clamp(theta, -1.0, 1.0);\n        return Math.acos(theta);\n    }\n\n    /**\n     * @en Get angle in radian between this and vector with direction.\n     * @zh 获取当前向量和指定向量之间的有符号角度。<br/>\n     * 有符号角度的取值范围为 (-180, 180]，当前向量可以通过逆时针旋转有符号角度与指定向量同向。<br/>\n     * @param other specified vector\n     * @return The signed angle between the current vector and the specified vector (in radians); if there is a zero vector in the current vector and the specified vector, 0 is returned.\n     */\n    public signAngle (other: Vec2) {\n        const angle = this.angle(other);\n        return this.cross(other) < 0 ? -angle : angle;\n    }\n\n    /**\n     * @en Rotates the current vector by an angle in radian value\n     * @zh 将当前向量的旋转\n     * @param radians radius of rotation\n     */\n    public rotate (radians: number) {\n        const x = this.x;\n        const y = this.y;\n\n        const sin = Math.sin(radians);\n        const cos = Math.cos(radians);\n        this.x = cos * x - sin * y;\n        this.y = sin * x + cos * y;\n        return this;\n    }\n\n    /**\n     * @en Projects the current vector on another one\n     * @zh 计算当前向量在指定向量上的投影向量。\n     * @param other specified vector\n     */\n    public project (other: Vec2) {\n        const scalar = this.dot(other) / other.dot(other);\n        this.x = other.x * scalar;\n        this.y = other.y * scalar;\n        return this;\n    }\n\n    /**\n     * @en Transforms the vec2 with a mat4. 3rd vector component is implicitly '0', 4th vector component is implicitly '1'\n     * @zh 将当前向量视为 z 分量为 0、w 分量为 1 的四维向量，<br/>\n     * 应用四维矩阵变换到当前矩阵<br/>\n     * @param matrix matrix to transform with\n     */\n    public transformMat4 (matrix: Mat4) {\n        const x = this.x;\n        const y = this.y;\n        this.x = matrix.m00 * x + matrix.m04 * y + matrix.m12;\n        this.y = matrix.m01 * x + matrix.m05 * y + matrix.m13;\n        return this;\n    }\n}\n\nconst v2_1 = new Vec2();\nconst v2_2 = new Vec2();\n\nCCClass.fastDefine('cc.Vec2', Vec2, { x: 0, y: 0 });\nlegacyCC.Vec2 = Vec2;\n\nexport function v2 (other: Vec2): Vec2;\nexport function v2 (x?: number, y?: number): Vec2;\n\nexport function v2 (x?: number | Vec2, y?: number) {\n    return new Vec2(x as any, y);\n}\n\nlegacyCC.v2 = v2;\n","/*\r\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n */\r\n\r\nimport { removeProperty, replaceProperty } from '../utils/x-deprecated';\r\nimport { Color } from './color';\r\nimport { Mat3 } from './mat3';\r\nimport { Mat4 } from './mat4';\r\nimport { Quat } from './quat';\r\nimport { Vec2 } from './vec2';\r\nimport { Vec3 } from './vec3';\r\nimport { Vec4 } from './vec4';\r\nimport { legacyCC } from '../global-exports';\r\n\r\nreplaceProperty(Vec2, 'Vec2', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'div',\r\n        newName: 'divide',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'dist',\r\n        newName: 'distance',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'sqrDist',\r\n        newName: 'squaredDistance',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'mag',\r\n        newName: 'len',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'sqrMag',\r\n        newName: 'lengthSqr',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Vec2,\r\n        targetName: 'Vec2',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Vec2.prototype, 'Vec2', [\r\n    {\r\n        name: 'mag',\r\n        newName: 'length',\r\n        target: Vec2.prototype,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'magSqr',\r\n        newName: 'lengthSqr',\r\n        target: Vec2.prototype,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Vec2.prototype,\r\n        targetName: 'Vec2',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Vec2.prototype,\r\n        targetName: 'Vec2',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Vec3, 'Vec3', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'div',\r\n        newName: 'divide',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'dist',\r\n        newName: 'distance',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'sqrDist',\r\n        newName: 'squaredDistance',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'mag',\r\n        newName: 'len',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'sqrMag',\r\n        newName: 'lengthSqr',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Vec3,\r\n        targetName: 'Vec3',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Vec3.prototype, 'Vec3', [\r\n    {\r\n        name: 'mag',\r\n        newName: 'length',\r\n        target: Vec3.prototype,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'magSqr',\r\n        newName: 'lengthSqr',\r\n        target: Vec3.prototype,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Vec3.prototype,\r\n        targetName: 'Vec3',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Vec3.prototype,\r\n        targetName: 'Vec3',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Vec4, 'Vec4', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'div',\r\n        newName: 'divide',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'dist',\r\n        newName: 'distance',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'sqrDist',\r\n        newName: 'squaredDistance',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'mag',\r\n        newName: 'len',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'sqrMag',\r\n        newName: 'lengthSqr',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Vec4,\r\n        targetName: 'Vec4',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Vec4.prototype, 'Vec4', [\r\n    {\r\n        name: 'mag',\r\n        newName: 'length',\r\n        target: Vec4.prototype,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'magSqr',\r\n        newName: 'lengthSqr',\r\n        target: Vec4.prototype,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Vec4.prototype,\r\n        targetName: 'Vec4',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Vec4.prototype,\r\n        targetName: 'Vec4',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Quat, 'Quat', [\r\n    {\r\n        name: 'mag',\r\n        newName: 'len',\r\n        target: Quat,\r\n        targetName: 'Quat',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Quat,\r\n        targetName: 'Quat',\r\n    },\r\n    {\r\n        name: 'sqrMag',\r\n        newName: 'lengthSqr',\r\n        target: Quat,\r\n        targetName: 'Quat',\r\n    },\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Quat,\r\n        targetName: 'Quat',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Quat,\r\n        targetName: 'Quat',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Quat.prototype, 'Quat', [\r\n    {\r\n        name: 'scale',\r\n        newName: 'multiplyScalar',\r\n        target: Quat.prototype,\r\n        targetName: 'Quat',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Quat.prototype,\r\n        targetName: 'Quat',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Color, 'Color', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Color,\r\n        targetName: 'Color',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Color,\r\n        targetName: 'Color',\r\n    },\r\n    {\r\n        name: 'div',\r\n        newName: 'divide',\r\n        target: Color,\r\n        targetName: 'Color',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Color,\r\n        targetName: 'Color',\r\n    },\r\n    {\r\n        name: 'fromHex',\r\n        newName: 'fromHEX',\r\n        customFunction (...args: any) {\r\n            const arg1 = args[1].toString(16);\r\n            return legacyCC.Color.fromHEX(args[0], arg1);\r\n        },\r\n    },\r\n]);\r\n\r\nreplaceProperty(Mat3, 'Mat3', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Mat3,\r\n        targetName: 'Mat3',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Mat3,\r\n        targetName: 'Mat3',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Mat3,\r\n        targetName: 'Mat3',\r\n    },\r\n    {\r\n        name: 'transfrom',\r\n        newName: 'transform',\r\n        target: Mat3,\r\n        targetName: 'Mat3',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Mat3.prototype, 'Mat3', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Mat3.prototype,\r\n        targetName: 'Mat3',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Mat3.prototype,\r\n        targetName: 'Mat3',\r\n    },\r\n    {\r\n        name: 'mulScalar',\r\n        newName: 'multiplyScalar',\r\n        target: Mat3.prototype,\r\n        targetName: 'Mat3',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Mat3.prototype,\r\n        targetName: 'Mat3',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Mat4, 'Mat4', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Mat4,\r\n        targetName: 'Mat4',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Mat4,\r\n        targetName: 'Mat4',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Mat4,\r\n        targetName: 'Mat4',\r\n    },\r\n]);\r\n\r\nreplaceProperty(Mat4.prototype, 'Mat4', [\r\n    {\r\n        name: 'sub',\r\n        newName: 'subtract',\r\n        target: Mat4.prototype,\r\n        targetName: 'Mat4',\r\n    },\r\n    {\r\n        name: 'mul',\r\n        newName: 'multiply',\r\n        target: Mat4.prototype,\r\n        targetName: 'Mat4',\r\n    },\r\n    {\r\n        name: 'mulScalar',\r\n        newName: 'multiplyScalar',\r\n        target: Mat4.prototype,\r\n        targetName: 'Mat4',\r\n    },\r\n    {\r\n        name: 'exactEquals',\r\n        newName: 'strictEquals',\r\n        target: Mat4.prototype,\r\n        targetName: 'Mat4',\r\n    },\r\n]);\r\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Mat4 } from './mat4';\nimport { Rect } from './rect';\nimport { Size } from './size';\nimport { Vec2 } from './vec2';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en `AffineTransform` class represent an affine transform matrix. It's composed basically by translation, rotation, scale transformations.\n * @zh 二维仿射变换矩阵，描述了平移、缩放和缩放。\n */\nexport class AffineTransform {\n    /**\n     * @en Create an identity transformation matrix.\n     * @zh 创建单位二维仿射变换矩阵，它不进行任何变换。\n     */\n    public static identity () {\n        return new AffineTransform();\n    }\n\n    /**\n     * @en Clone an `AffineTransform` object from the specified transform.\n     * @zh 克隆指定的二维仿射变换矩阵。\n     * @param affineTransform Specified `AffineTransform` objects\n     */\n    public static clone (affineTransform: AffineTransform) {\n        return new AffineTransform(\n            affineTransform.a, affineTransform.b,\n            affineTransform.c, affineTransform.d,\n            affineTransform.tx, affineTransform.ty,\n        );\n    }\n\n    /**\n     * @en Concatenate a transform matrix to another. The results are reflected in the out `AffineTransform`.\n     * @zh 将两个矩阵相乘的结果赋值给出口矩阵。\n     * @param out Out object to store the concat result\n     * @param t1 The first transform object.\n     * @param t2 The transform object to concatenate.\n     */\n    public static concat (out: AffineTransform, t1: AffineTransform, t2: AffineTransform) {\n        const a = t1.a;\n        const b = t1.b;\n        const c = t1.c;\n        const d = t1.d;\n        const tx = t1.tx;\n        const ty = t1.ty;\n        out.a = a * t2.a + b * t2.c;\n        out.b = a * t2.b + b * t2.d;\n        out.c = c * t2.a + d * t2.c;\n        out.d = c * t2.b + d * t2.d;\n        out.tx = tx * t2.a + ty * t2.c + t2.tx;\n        out.ty = tx * t2.b + ty * t2.d + t2.ty;\n    }\n\n    /**\n     * @en Get the invert transform of an `AffineTransform` object.\n     * @zh 将矩阵求逆的结果赋值给出口矩阵。\n     * @param out Out object to store the invert result\n     * @param t the input `AffineTransform` object\n     */\n    public static invert (out: AffineTransform, t: AffineTransform) {\n        const determinant = 1 / (t.a * t.d - t.b * t.c);\n        out.a = determinant * t.d;\n        out.b = -determinant * t.b;\n        out.c = -determinant * t.c;\n        out.d = determinant * t.a;\n        out.tx = determinant * (t.c * t.ty - t.d * t.tx);\n        out.ty = determinant * (t.b * t.tx - t.a * t.ty);\n    }\n\n    /**\n     * @en Get an `AffineTransform` object from a given matrix 4x4.\n     * @zh 将四维矩阵转换为二维仿射变换矩阵并赋值给出口矩阵。\n     * @param out The output matrix to store the result\n     * @param mat transform matrix.\n     */\n    public static fromMat4 (out: AffineTransform, mat: Mat4) {\n        out.a = mat.m00;\n        out.b = mat.m01;\n        out.c = mat.m04;\n        out.d = mat.m05;\n        out.tx = mat.m12;\n        out.ty = mat.m13;\n    }\n\n    /**\n     * @en Apply the `AffineTransform` on a 2D vector.\n     * @zh 应用二维仿射变换矩阵到二维向量上，并将结果赋值给出口向量。\n     * @param out The output vector to store the result\n     * @param point Vector to apply transform.\n     * @param t transform matrix.\n     */\n    public static transformVec2 (out: Vec2, point: Vec2, t: AffineTransform);\n\n    /**\n     * @en Apply the `AffineTransform` on a 2D vector.\n     * @zh 应用二维仿射变换矩阵到二维向量上，并将结果赋值给出口向量。\n     * @param out The output vector to store the result\n     * @param x x to apply transform.\n     * @param y y to apply transform.\n     * @param t transform matrix.\n     */\n    public static transformVec2 (out: Vec2, x: number, y: number, t: AffineTransform);\n\n    public static transformVec2 (out: Vec2, point: Vec2 | number, transOrY: AffineTransform | number, t?: AffineTransform) {\n        let x: number;\n        let y: number;\n        if (!t) {\n            t = transOrY as AffineTransform;\n            x = (point as Vec2).x;\n            y = (point as Vec2).y;\n        } else {\n            x = point as number;\n            y = transOrY as number;\n        }\n        out.x = t.a * x + t.c * y + t.tx;\n        out.y = t.b * x + t.d * y + t.ty;\n    }\n\n    /**\n     * @en Apply the `AffineTransform` on a size.\n     * @zh 应用二维仿射变换矩阵到二维尺寸上，并将结果赋值给出口尺寸。\n     * @param out The output size to store the result\n     * @param size The size to apply transform.\n     * @param t transform matrix.\n     */\n    public static transformSize (out: Size, size: Size, t: AffineTransform) {\n        out.width = t.a * size.width + t.c * size.height;\n        out.height = t.b * size.width + t.d * size.height;\n    }\n\n    /**\n     * @en Apply the `AffineTransform` on a rect.\n     * @zh 应用二维仿射变换矩阵到矩形上，并将结果赋值给出口矩形。\n     * @param out The output rect object to store the result\n     * @param rect The rect object to apply transform.\n     * @param t transform matrix.\n     */\n    public static transformRect (out: Rect, rect: Rect, t: AffineTransform) {\n        const or = rect.x + rect.width;\n        const ot = rect.y + rect.height;\n        const lbx = t.a * rect.x + t.c * rect.y + t.tx;\n        const lby = t.b * rect.x + t.d * rect.y + t.ty;\n        const rbx = t.a * or + t.c * rect.y + t.tx;\n        const rby = t.b * or + t.d * rect.y + t.ty;\n        const ltx = t.a * rect.x + t.c * ot + t.tx;\n        const lty = t.b * rect.x + t.d * ot + t.ty;\n        const rtx = t.a * or + t.c * ot + t.tx;\n        const rty = t.b * or + t.d * ot + t.ty;\n\n        const minX = Math.min(lbx, rbx, ltx, rtx);\n        const maxX = Math.max(lbx, rbx, ltx, rtx);\n        const minY = Math.min(lby, rby, lty, rty);\n        const maxY = Math.max(lby, rby, lty, rty);\n\n        out.x = minX;\n        out.y = minY;\n        out.width = maxX - minX;\n        out.height = maxY - minY;\n    }\n\n    /**\n     * @en Apply the `AffineTransform` on a rect, and turns to an Oriented Bounding Box.\n     * This function does not allocate any memory, you should create the output vectors by yourself and manage their memory.\n     * @zh 应用二维仿射变换矩阵到矩形上, 并转换为有向包围盒。\n     * 这个函数不创建任何内存，你需要先创建包围盒的四个 Vector 对象用来存储结果，并作为前四个参数传入函数。\n     * @param out_bl Output vector for storing the bottom left corner coordinates of the Obb object\n     * @param out_tl Output vector for storing the top left corner coordinates of the Obb object\n     * @param out_tr Output vector for storing the top right corner coordinates of the Obb object\n     * @param out_br Output vector for storing the bottom right corner coordinates of the Obb object\n     * @param rect The rect object to apply transform.\n     * @param anAffineTransform transform matrix.\n     */\n    public static transformObb (out_bl: Vec2, out_tl: Vec2, out_tr: Vec2, out_br: Vec2, rect: Rect, anAffineTransform: AffineTransform) {\n        const tx = anAffineTransform.a * rect.x + anAffineTransform.c * rect.y + anAffineTransform.tx;\n        const ty = anAffineTransform.b * rect.x + anAffineTransform.d * rect.y + anAffineTransform.ty;\n        const xa = anAffineTransform.a * rect.width;\n        const xb = anAffineTransform.b * rect.width;\n        const yc = anAffineTransform.c * rect.height;\n        const yd = anAffineTransform.d * rect.height;\n\n        out_tl.x = tx;\n        out_tl.y = ty;\n        out_tr.x = xa + tx;\n        out_tr.y = xb + ty;\n        out_bl.x = yc + tx;\n        out_bl.y = yd + ty;\n        out_br.x = xa + yc + tx;\n        out_br.y = xb + yd + ty;\n    }\n\n    public declare a: number;\n    public declare b: number;\n    public declare c: number;\n    public declare d: number;\n    public declare tx: number;\n    public declare ty: number;\n\n    /**\n     * @en constructor an `AffineTransform` object.\n     * @zh 构造二维放射变换矩阵。\n     * @param a a\n     * @param b b\n     * @param c c\n     * @param d d\n     * @param tx tx\n     * @param ty ty\n     */\n    constructor (a = 1, b = 0, c = 0, d = 1, tx = 0, ty = 0) {\n        this.a = a;\n        this.b = b;\n        this.c = c;\n        this.d = d;\n        this.tx = tx;\n        this.ty = ty;\n    }\n}\n\nlegacyCC.AffineTransform = AffineTransform;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { ISizeLike } from './type-define';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Two dimensional size type representing the width and height.\n * @zh 二维尺寸。\n */\nexport class Size extends ValueType {\n    public static ZERO = Object.freeze(new Size(0, 0));\n    public static ONE = Object.freeze(new Size(1, 1));\n\n    /**\n     * @en Calculate the interpolation result between this size and another one with given ratio\n     * @zh 根据指定的插值比率，从当前尺寸到目标尺寸之间做插值。\n     * @param out Output Size.\n     * @param from Original Size.\n     * @param to Target Size.\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     * @returns A vector consisting of linear interpolation of the width and height of the current size to the width and height of the target size at a specified interpolation ratio, respectively.\n     */\n    public static lerp <Out extends ISizeLike> (out: Out, from: Out, to: Out, ratio: number) {\n        out.width = from.width + (to.width - from.width) * ratio;\n        out.height = from.height + (to.height - from.height) * ratio;\n        return out;\n    }\n\n    // compatibility with vector interfaces\n    set x (val) { this.width = val; }\n    get x () { return this.width; }\n    set y (val) { this.height = val; }\n    get y () { return this.height; }\n\n    public declare width: number;\n\n    public declare height: number;\n\n    /**\n     * @en Constructor a size from another one.\n     * @zh 构造与指定尺寸相等的尺寸。\n     * @param other Specified Size.\n     */\n    constructor (other: Size);\n\n    /**\n     * @en Constructor a size with specified values.\n     * @zh 构造具有指定宽度和高度的尺寸。\n     * @param width width of the Size, default value is 0.\n     * @param height height of the Size, default value is 0.\n     */\n    constructor (width?: number, height?: number);\n\n    constructor (width?: Size | number, height?: number) {\n        super();\n        if (width && typeof width === 'object') {\n            this.width = width.width;\n            this.height = width.height;\n        } else {\n            this.width = width || 0;\n            this.height = height || 0;\n        }\n    }\n\n    /**\n     * @en clone the current `Size`.\n     * @zh 克隆当前尺寸。\n     */\n    public clone () {\n        return new Size(this.width, this.height);\n    }\n\n    /**\n     * @en Set values with another `Size`.\n     * @zh 设置当前尺寸使其与指定的尺寸相等。\n     * @param other Specified Size.\n     * @returns `this`\n     */\n    public set (other: Size);\n\n    /**\n     * @en Set the value of each component of the current `Size`.\n     * @zh 设置当前尺寸的具体参数。\n     * @param width Specified width\n     * @param height Specified height\n     * @returns `this`\n     */\n    public set (width?: number, height?: number);\n\n    public set (width?: Size | number, height?: number) {\n        if (width && typeof width === 'object') {\n            this.height = width.height;\n            this.width = width.width;\n        } else {\n            this.width = width || 0;\n            this.height = height || 0;\n        }\n        return this;\n    }\n\n    /**\n     * @en Check whether the current `Size` equals another one.\n     * @zh 判断当前尺寸是否与指定尺寸的相等。\n     * @param other Specified Size\n     * @returns Returns `true' when both dimensions are equal in width and height; otherwise returns `false'.\n     */\n    public equals (other: Size) {\n        return this.width === other.width\n            && this.height === other.height;\n    }\n\n    /**\n     * @en Calculate the interpolation result between this size and another one with given ratio\n     * @zh 根据指定的插值比率，从当前尺寸到目标尺寸之间做插值。\n     * @param to Target Size.\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public lerp (to: Size, ratio: number) {\n        this.width += (to.width - this.width) * ratio;\n        this.height += (to.height - this.height) * ratio;\n        return this;\n    }\n\n    /**\n     * @en Return the information of the current size in string\n     * @zh 返回当前尺寸的字符串表示。\n     * @returns The information of the current size in string\n     */\n    public toString () {\n        return `(${this.width.toFixed(2)}, ${this.height.toFixed(2)})`;\n    }\n}\n\nCCClass.fastDefine('cc.Size', Size, { width: 0, height: 0 });\n\n/**\n * @en Constructs a `Size` object.\n * @zh 等价于 `new Size(other)`。\n * @param other Specified Size.\n * @returns `new Size(other)`\n */\nexport function size (other: Size): Size;\n\n/**\n * @en Constructs a `Size` object.\n * @zh 等价于 `new Size(x, y)`。\n * @param width Specified width\n * @param height Specified height\n * @returns `new Size(w, h)`\n */\nexport function size (width?: number, height?: number): Size;\n\nexport function size (width: Size | number = 0, height = 0) {\n    return new Size(width as any, height);\n}\n\nlegacyCC.size = size;\n\nlegacyCC.Size = Size;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CCClass } from '../data/class';\nimport { ValueType } from '../value-types/value-type';\nimport { Mat4 } from './mat4';\nimport { Size } from './size';\nimport { IRectLike, IVec2Like } from './type-define';\nimport { Vec2 } from './vec2';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en\n * A 2D rectangle defined by x, y position and width, height.\n * @zh\n * 轴对齐矩形。\n * 矩形内的所有点都大于等于矩形的最小点 (xMin, yMin) 并且小于等于矩形的最大点 (xMax, yMax)。\n * 矩形的宽度定义为 xMax - xMin；高度定义为 yMax - yMin。\n */\nexport class Rect extends ValueType {\n    /**\n     * @en Creates a rectangle from two coordinate values.\n     * @zh 由任意两个点创建一个矩形，目标矩形即是这两个点各向 x、y 轴作线所得到的矩形。\n     * @param v1 Specified point 1.\n     * @param v2 Specified point 2.\n     * @returns Target rectangle.\n     */\n    public static fromMinMax <Out extends IRectLike, VecLike extends IVec2Like> (out: Out, v1: VecLike, v2: VecLike) {\n        const minX = Math.min(v1.x, v2.x);\n        const minY = Math.min(v1.y, v2.y);\n        const maxX = Math.max(v1.x, v2.x);\n        const maxY = Math.max(v1.y, v2.y);\n        out.x = minX;\n        out.y = minY;\n        out.width = maxX - minX;\n        out.height = maxY - minY;\n\n        return out;\n    }\n\n    /**\n     * @en Calculate the interpolation result between this rect and another one with given ratio\n     * @zh 根据指定的插值比率，从当前矩形到目标矩形之间做插值。\n     * @param out Output rect.\n     * @param from Original rect.\n     * @param to Target rect.\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public static lerp <Out extends IRectLike> (out: Out, from: Out, to: Out, ratio: number) {\n        const x = from.x;\n        const y = from.y;\n        const w = from.width;\n        const h = from.height;\n        out.x = x + (to.x - x) * ratio;\n        out.y = y + (to.y - y) * ratio;\n        out.width = w + (to.width - w) * ratio;\n        out.height = h + (to.height - h) * ratio;\n\n        return out;\n    }\n\n    /**\n     * @en Returns the overlapping portion of 2 rectangles.\n     * @zh 计算当前矩形与指定矩形重叠部分的矩形，将其赋值给出口矩形。\n     * @param out Output Rect.\n     * @param one One of the specify Rect.\n     * @param other Another of the specify Rect.\n     */\n    public static intersection <Out extends IRectLike> (out: Out, one: Out, other: Out) {\n        const axMin = one.x;\n        const ayMin = one.y;\n        const axMax = one.x + one.width;\n        const ayMax = one.y + one.height;\n        const bxMin = other.x;\n        const byMin = other.y;\n        const bxMax = other.x + other.width;\n        const byMax = other.y + other.height;\n        out.x = Math.max(axMin, bxMin);\n        out.y = Math.max(ayMin, byMin);\n        out.width = Math.min(axMax, bxMax) - out.x;\n        out.height = Math.min(ayMax, byMax) - out.y;\n\n        return out;\n    }\n\n    /**\n     * @en Returns the smallest rectangle that contains the current rect and the given rect.\n     * @zh 创建同时包含当前矩形和指定矩形的最小矩形，将其赋值给出口矩形。\n     * @param out Output Rect.\n     * @param one One of the specify Rect.\n     * @param other Another of the specify Rect.\n     */\n    public static union <Out extends IRectLike> (out: Out, one: Out, other: Out) {\n        const x = one.x;\n        const y = one.y;\n        const w = one.width;\n        const h = one.height;\n        const bx = other.x;\n        const by = other.y;\n        const bw = other.width;\n        const bh = other.height;\n        out.x = Math.min(x, bx);\n        out.y = Math.min(y, by);\n        out.width = Math.max(x + w, bx + bw) - out.x;\n        out.height = Math.max(y + h, by + bh) - out.y;\n\n        return out;\n    }\n\n    /**\n     * @en The minimum x value.\n     * @zh 获取或设置矩形在 x 轴上的最小值。\n     */\n    get xMin () {\n        return this.x;\n    }\n\n    set xMin (value) {\n        this.width += this.x - value;\n        this.x = value;\n    }\n\n    /**\n     * @en The minimum y value.\n     * @zh 获取或设置矩形在 y 轴上的最小值。\n     */\n    get yMin () {\n        return this.y;\n    }\n\n    set yMin (value) {\n        this.height += this.y - value;\n        this.y = value;\n    }\n\n    /**\n     * @en The maximum x value.\n     * @zh 获取或设置矩形在 x 轴上的最大值。\n     */\n    get xMax () {\n        return this.x + this.width;\n    }\n\n    set xMax (value) {\n        this.width = value - this.x;\n    }\n\n    /**\n     * @en The maximum y value.\n     * @zh 获取或设置矩形在 y 轴上的最大值。\n     */\n    get yMax () {\n        return this.y + this.height;\n    }\n\n    set yMax (value) {\n        this.height = value - this.y;\n    }\n\n    /**\n     * @en The position of the center of the rectangle.\n     * @zh 获取或设置矩形中心点的坐标。\n     */\n    get center () {\n        return new Vec2(this.x + this.width * 0.5,\n            this.y + this.height * 0.5);\n    }\n\n    set center (value) {\n        this.x = value.x - this.width * 0.5;\n        this.y = value.y - this.height * 0.5;\n    }\n\n    /**\n     * @en Returns a new [[Vec2]] object representing the position of the rectangle\n     * @zh 获取或设置矩形的 x 和 y 坐标。\n     */\n    get origin () {\n        return new Vec2(this.x, this.y);\n    }\n\n    set origin (value) {\n        this.x = value.x;\n        this.y = value.y;\n    }\n\n    /**\n     * @en Returns a new [[Size]] object represents the width and height of the rectangle\n     * @zh 获取或设置矩形的尺寸。\n     */\n    get size () {\n        return new Size(this.width, this.height);\n    }\n\n    set size (value) {\n        this.width = value.width;\n        this.height = value.height;\n    }\n\n    // compatibility with vector interfaces\n    set z (val) { this.width = val; }\n    get z () { return this.width; }\n    set w (val) { this.height = val; }\n    get w () { return this.height; }\n\n    /**\n     * @en The minimum x value.\n     * @zh 矩形最小点的 x 坐标。\n     */\n    public declare x: number;\n\n    /**\n     * @en The minimum y value.\n     * @zh 矩形最小点的 y 坐标。\n     */\n    public declare y: number;\n\n    /**\n     * @en The width of the Rect.\n     * @zh 矩形的宽度。\n     */\n    public declare width: number;\n\n    /**\n     * @en The height of the Rect.\n     * @zh 矩形的高度。\n     */\n    public declare height: number;\n\n    /**\n     * @en Constructs a Rect from another one.\n     * @zh 构造与指定矩形相等的矩形。\n     * @param other Specified Rect.\n     */\n    constructor (other: Rect);\n\n    /**\n     * @en Constructs a Rect with specified values.\n     * @zh 构造具有指定的最小值和尺寸的矩形。\n     * @param x The minimum X coordinate of the rectangle.\n     * @param y The minimum Y coordinate of the rectangle.\n     * @param width The width of the rectangle, measured from the X position.\n     * @param height The height of the rectangle, measured from the Y position.\n     */\n    constructor (x?: number, y?: number, width?: number, height?: number);\n\n    constructor (x?: Rect | number, y?: number, width?: number, height?: number) {\n        super();\n        if (x && typeof x === 'object') {\n            this.y = x.y;\n            this.width = x.width;\n            this.height = x.height;\n            this.x = x.x;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.width = width || 0;\n            this.height = height || 0;\n        }\n    }\n\n    /**\n     * @en clone the current Rect.\n     * @zh 克隆当前矩形。\n     */\n    public clone () {\n        return new Rect(this.x, this.y, this.width, this.height);\n    }\n\n    /**\n     * @en Set values with another Rect.\n     * @zh 设置当前矩形使其与指定矩形相等。\n     * @param other Specified Rect.\n     * @returns `this`\n     */\n    public set (other: Rect);\n\n    /**\n     * @en Set the value of each component of the current Rect.\n     * @zh 设置当前矩形使其与指定参数的矩形相等。\n     * @param x The x parameter of the specified rectangle\n     * @param y The y parameter of the specified rectangle\n     * @param width The width parameter of the specified rectangle\n     * @param height The height parameter of the specified rectangle\n     * @returns `this`\n     */\n    public set (x?: number, y?: number, width?: number, height?: number);\n\n    public set (x?: Rect | number, y?: number, width?: number, height?: number) {\n        if (x && typeof x === 'object') {\n            this.y = x.y;\n            this.width = x.width;\n            this.height = x.height;\n            this.x = x.x;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.width = width || 0;\n            this.height = height || 0;\n        }\n        return this;\n    }\n\n    /**\n     * @en Check whether the current Rect equals another one.\n     * @zh 判断当前矩形是否与指定矩形相等。\n     * @param other Specified rectangles.\n     * @returns Returns `true' when the minimum and maximum values of both rectangles are equal, respectively; otherwise, returns `false'.\n     */\n    public equals (other: Rect) {\n        return this.x === other.x\n            && this.y === other.y\n            && this.width === other.width\n            && this.height === other.height;\n    }\n\n    /**\n     * @en Calculate the interpolation result between this Rect and another one with given ratio.\n     * @zh 根据指定的插值比率，从当前矩形到目标矩形之间做插值。\n     * @param to Target Rect.\n     * @param ratio The interpolation coefficient.The range is [0,1].\n     */\n    public lerp (to: Rect, ratio: number) {\n        const x = this.x;\n        const y = this.y;\n        const w = this.width;\n        const h = this.height;\n        this.x = x + (to.x - x) * ratio;\n        this.y = y + (to.y - y) * ratio;\n        this.width = w + (to.width - w) * ratio;\n        this.height = h + (to.height - h) * ratio;\n\n        return this;\n    }\n\n    /**\n     * @en Return the information of the current rect in string\n     * @zh 返回当前矩形的字符串表示。\n     * @returns The information of the current rect in string\n     */\n    public toString () {\n        return `(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.width.toFixed(2)}, ${this.height.toFixed(2)})`;\n    }\n\n    /**\n     * @en Check whether the current rectangle intersects with the given one.\n     * @zh 判断当前矩形是否与指定矩形相交。\n     * @param other Specified rectangles.\n     * @returns If intersected, return `true', otherwise return `false'.\n     */\n    public intersects (other: Rect) {\n        const maxax = this.x + this.width;\n        const maxay = this.y + this.height;\n        const maxbx = other.x + other.width;\n        const maxby = other.y + other.height;\n        return !(maxax < other.x || maxbx < this.x || maxay < other.y || maxby < this.y);\n    }\n\n    /**\n     * @en Check whether the current rect contains the given point.\n     * @zh 判断当前矩形是否包含指定的点。\n     * @param point Specified point.\n     * @returns The specified point is included in the rectangle and returns `true', otherwise it returns `false'.\n     */\n    public contains (point: Vec2) {\n        return (this.x <= point.x\n                && this.x + this.width >= point.x\n                && this.y <= point.y\n                && this.y + this.height >= point.y);\n    }\n\n    /**\n     * @en Returns true if the other rect entirely inside this rectangle.\n     * @zh 判断当前矩形是否包含指定矩形。\n     * @param other Specified rectangles.\n     * @returns Returns `true' if all the points of the specified rectangle are included in the current rectangle, `false' otherwise.\n     */\n    public containsRect (other: Rect) {\n        return (this.x <= other.x\n                && this.x + this.width >= other.x + other.width\n                && this.y <= other.y\n                && this.y + this.height >= other.y + other.height);\n    }\n\n    /**\n     * @en Apply matrix4 to the rect.\n     * @zh\n     * 应用矩阵变换到当前矩形：\n     * 应用矩阵变换到当前矩形的最小点得到新的最小点，\n     * 将当前矩形的尺寸视为二维向量应用矩阵变换得到新的尺寸；\n     * 并将如此构成的新矩形。\n     * @param matrix The matrix4\n     */\n    public transformMat4 (mat: Mat4) {\n        const ol = this.x;\n        const ob = this.y;\n        const or = ol + this.width;\n        const ot = ob + this.height;\n        const lbx = mat.m00 * ol + mat.m04 * ob + mat.m12;\n        const lby = mat.m01 * ol + mat.m05 * ob + mat.m13;\n        const rbx = mat.m00 * or + mat.m04 * ob + mat.m12;\n        const rby = mat.m01 * or + mat.m05 * ob + mat.m13;\n        const ltx = mat.m00 * ol + mat.m04 * ot + mat.m12;\n        const lty = mat.m01 * ol + mat.m05 * ot + mat.m13;\n        const rtx = mat.m00 * or + mat.m04 * ot + mat.m12;\n        const rty = mat.m01 * or + mat.m05 * ot + mat.m13;\n\n        const minX = Math.min(lbx, rbx, ltx, rtx);\n        const maxX = Math.max(lbx, rbx, ltx, rtx);\n        const minY = Math.min(lby, rby, lty, rty);\n        const maxY = Math.max(lby, rby, lty, rty);\n\n        this.x = minX;\n        this.y = minY;\n        this.width = maxX - minX;\n        this.height = maxY - minY;\n\n        return this;\n    }\n\n    /**\n     * @en\n     * Applies a matrix transformation to the current rectangle and outputs the result to the four vertices.\n     * @zh\n     * 应用矩阵变换到当前矩形，并将结果输出到四个顶点上。\n     *\n     * @param mat The mat4 to apply\n     * @param out_lb The left bottom point\n     * @param out_lt The left top point\n     * @param out_rb The right bottom point\n     * @param out_rt The right top point\n     */\n    public transformMat4ToPoints (mat: Mat4, out_lb: Vec2, out_lt: Vec2, out_rt: Vec2, out_rb: Vec2) {\n        const ol = this.x;\n        const ob = this.y;\n        const or = ol + this.width;\n        const ot = ob + this.height;\n        out_lb.x = mat.m00 * ol + mat.m04 * ob + mat.m12;\n        out_lb.y = mat.m01 * ol + mat.m05 * ob + mat.m13;\n        out_rb.x = mat.m00 * or + mat.m04 * ob + mat.m12;\n        out_rb.y = mat.m01 * or + mat.m05 * ob + mat.m13;\n        out_lt.x = mat.m00 * ol + mat.m04 * ot + mat.m12;\n        out_lt.y = mat.m01 * ol + mat.m05 * ot + mat.m13;\n        out_rt.x = mat.m00 * or + mat.m04 * ot + mat.m12;\n        out_rt.y = mat.m01 * or + mat.m05 * ot + mat.m13;\n    }\n}\n\nCCClass.fastDefine('cc.Rect', Rect, { x: 0, y: 0, width: 0, height: 0 });\n\nlegacyCC.Rect = Rect;\n\n/**\n * @en The convenient method to create a new Rect.\n * @zh 构造与指定矩形相等的矩形。等价于 `new Rect(rect)`。\n * @param rect Specified Rect.\n * @returns `new Rect(rect)`\n */\nexport function rect (rect: Rect): Rect;\n\n/**\n * @en The convenient method to create a new Rect.\n * @zh 构造具有指定的最小值和尺寸的矩形，等价于`new Rect(x, y, width, height)`。\n * @param x The minimum X coordinate of the rectangle.\n * @param y The minimum Y coordinate of the rectangle.\n * @param width The width of the rectangle, measured from the X position.\n * @param height The height of the rectangle, measured from the Y position.\n * @returns `new Rect(x, y, width, height)`\n */\nexport function rect (x?: number, y?: number, width?: number, height?: number): Rect;\n\nexport function rect (x: Rect | number = 0, y = 0, width = 0, height = 0): Rect {\n    return new Rect(x as any, y, width, height);\n}\n\nlegacyCC.rect = rect;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Queue } from './queue';\nimport { Buffer } from './buffer';\nimport { Texture } from './texture';\nimport { Swapchain } from './swapchain';\nimport { RenderPass } from './render-pass';\nimport { DescriptorSetLayout } from './descriptor-set-layout';\n\nimport { Sampler } from './states/sampler';\nimport { GeneralBarrier } from './states/general-barrier';\nimport { TextureBarrier } from './states/texture-barrier';\nimport { BufferBarrier } from './states/buffer-barrier';\nimport { GCObject } from '../../data/gc-object';\n\ninterface ICopyable { copy (info: ICopyable): ICopyable; }\n\nconst deepCopy = <T extends ICopyable> (target: T[], source: T[], Ctor: Constructor<T>) => {\n    for (let i = 0; i < source.length; ++i) {\n        if (target.length <= i) target.push(new Ctor());\n        target[i].copy(source[i]);\n    }\n    target.length = source.length;\n};\n\n/**\n  * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\n  * The following section is auto-generated from native/cocos/renderer/core/gfx/GFXDef-common.h\n  * by the script native/tools/gfx-define-generator/generate.js.\n  * Changes to these public interfaces should be made there first and synced back.\n  * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\n  */\n\n/**\n * @en Graphics object type\n * @zh 图形API对象的类型\n */\nexport enum ObjectType {\n    UNKNOWN,\n    SWAPCHAIN,\n    BUFFER,\n    TEXTURE,\n    RENDER_PASS,\n    FRAMEBUFFER,\n    SAMPLER,\n    SHADER,\n    DESCRIPTOR_SET_LAYOUT,\n    PIPELINE_LAYOUT,\n    PIPELINE_STATE,\n    DESCRIPTOR_SET,\n    INPUT_ASSEMBLER,\n    COMMAND_BUFFER,\n    QUEUE,\n    QUERY_POOL,\n    GLOBAL_BARRIER,\n    TEXTURE_BARRIER,\n    BUFFER_BARRIER,\n    COUNT,\n}\n\nexport enum Status {\n    UNREADY,\n    FAILED,\n    SUCCESS,\n}\n\nexport enum API {\n    UNKNOWN,\n    GLES2,\n    GLES3,\n    METAL,\n    VULKAN,\n    NVN,\n    WEBGL,\n    WEBGL2,\n    WEBGPU,\n}\n\nexport enum SurfaceTransform {\n    IDENTITY,\n    ROTATE_90,\n    ROTATE_180,\n    ROTATE_270,\n}\n\nexport enum Feature {\n    ELEMENT_INDEX_UINT,\n    INSTANCED_ARRAYS,\n    MULTIPLE_RENDER_TARGETS,\n    BLEND_MINMAX,\n    COMPUTE_SHADER,\n    // This flag indicates whether the device can benefit from subpass-style usages.\n    // Specifically, this only differs on the GLES backends: the Framebuffer Fetch\n    // extension is used to simulate input attachments, so the flag is not set when\n    // the extension is not supported, and you should switch to the fallback branch\n    // (without the extension requirement) in GLSL shader sources accordingly.\n    // Everything else can remain the same.\n    //\n    // Another caveat when using the Framebuffer Fetch extensions in shaders is that\n    // for subpasses with exactly 4 inout attachments the output is automatically set\n    // to the last attachment (taking advantage of 'inout' property), and a separate\n    // blit operation (if needed) will be added for you afterwards to transfer the\n    // rendering result to the correct subpass output texture. This is to ameliorate\n    // the max number of attachment limit(4) situation for many devices, and shader\n    // sources inside this kind of subpass must match this behavior.\n    INPUT_ATTACHMENT_BENEFIT,\n    COUNT,\n}\n\nexport enum Format {\n\n    UNKNOWN,\n\n    A8,\n    L8,\n    LA8,\n\n    R8,\n    R8SN,\n    R8UI,\n    R8I,\n    R16F,\n    R16UI,\n    R16I,\n    R32F,\n    R32UI,\n    R32I,\n\n    RG8,\n    RG8SN,\n    RG8UI,\n    RG8I,\n    RG16F,\n    RG16UI,\n    RG16I,\n    RG32F,\n    RG32UI,\n    RG32I,\n\n    RGB8,\n    SRGB8,\n    RGB8SN,\n    RGB8UI,\n    RGB8I,\n    RGB16F,\n    RGB16UI,\n    RGB16I,\n    RGB32F,\n    RGB32UI,\n    RGB32I,\n\n    RGBA8,\n    BGRA8,\n    SRGB8_A8,\n    RGBA8SN,\n    RGBA8UI,\n    RGBA8I,\n    RGBA16F,\n    RGBA16UI,\n    RGBA16I,\n    RGBA32F,\n    RGBA32UI,\n    RGBA32I,\n\n    // Special Format\n    R5G6B5,\n    R11G11B10F,\n    RGB5A1,\n    RGBA4,\n    RGB10A2,\n    RGB10A2UI,\n    RGB9E5,\n\n    // Depth-Stencil Format\n    DEPTH,\n    DEPTH_STENCIL,\n\n    // Compressed Format\n\n    // Block Compression Format, DDS (DirectDraw Surface)\n    // DXT1: 3 channels (5:6:5), 1/8 original size, with 0 or 1 bit of alpha\n    BC1,\n    BC1_ALPHA,\n    BC1_SRGB,\n    BC1_SRGB_ALPHA,\n    // DXT3: 4 channels (5:6:5), 1/4 original size, with 4 bits of alpha\n    BC2,\n    BC2_SRGB,\n    // DXT5: 4 channels (5:6:5), 1/4 original size, with 8 bits of alpha\n    BC3,\n    BC3_SRGB,\n    // 1 channel (8), 1/4 original size\n    BC4,\n    BC4_SNORM,\n    // 2 channels (8:8), 1/2 original size\n    BC5,\n    BC5_SNORM,\n    // 3 channels (16:16:16), half-floating point, 1/6 original size\n    // UF16: unsigned float, 5 exponent bits + 11 mantissa bits\n    // SF16: signed float, 1 signed bit + 5 exponent bits + 10 mantissa bits\n    BC6H_UF16,\n    BC6H_SF16,\n    // 4 channels (4~7 bits per channel) with 0 to 8 bits of alpha, 1/3 original size\n    BC7,\n    BC7_SRGB,\n\n    // Ericsson Texture Compression Format\n    ETC_RGB8,\n    ETC2_RGB8,\n    ETC2_SRGB8,\n    ETC2_RGB8_A1,\n    ETC2_SRGB8_A1,\n    ETC2_RGBA8,\n    ETC2_SRGB8_A8,\n    EAC_R11,\n    EAC_R11SN,\n    EAC_RG11,\n    EAC_RG11SN,\n\n    // PVRTC (PowerVR)\n    PVRTC_RGB2,\n    PVRTC_RGBA2,\n    PVRTC_RGB4,\n    PVRTC_RGBA4,\n    PVRTC2_2BPP,\n    PVRTC2_4BPP,\n\n    // ASTC (Adaptive Scalable Texture Compression)\n    ASTC_RGBA_4X4,\n    ASTC_RGBA_5X4,\n    ASTC_RGBA_5X5,\n    ASTC_RGBA_6X5,\n    ASTC_RGBA_6X6,\n    ASTC_RGBA_8X5,\n    ASTC_RGBA_8X6,\n    ASTC_RGBA_8X8,\n    ASTC_RGBA_10X5,\n    ASTC_RGBA_10X6,\n    ASTC_RGBA_10X8,\n    ASTC_RGBA_10X10,\n    ASTC_RGBA_12X10,\n    ASTC_RGBA_12X12,\n\n    // ASTC (Adaptive Scalable Texture Compression) SRGB\n    ASTC_SRGBA_4X4,\n    ASTC_SRGBA_5X4,\n    ASTC_SRGBA_5X5,\n    ASTC_SRGBA_6X5,\n    ASTC_SRGBA_6X6,\n    ASTC_SRGBA_8X5,\n    ASTC_SRGBA_8X6,\n    ASTC_SRGBA_8X8,\n    ASTC_SRGBA_10X5,\n    ASTC_SRGBA_10X6,\n    ASTC_SRGBA_10X8,\n    ASTC_SRGBA_10X10,\n    ASTC_SRGBA_12X10,\n    ASTC_SRGBA_12X12,\n\n    // Total count\n    COUNT,\n}\n\nexport enum FormatType {\n    NONE,\n    UNORM,\n    SNORM,\n    UINT,\n    INT,\n    UFLOAT,\n    FLOAT,\n}\n\nexport enum Type {\n    UNKNOWN,\n    BOOL,\n    BOOL2,\n    BOOL3,\n    BOOL4,\n    INT,\n    INT2,\n    INT3,\n    INT4,\n    UINT,\n    UINT2,\n    UINT3,\n    UINT4,\n    FLOAT,\n    FLOAT2,\n    FLOAT3,\n    FLOAT4,\n    MAT2,\n    MAT2X3,\n    MAT2X4,\n    MAT3X2,\n    MAT3,\n    MAT3X4,\n    MAT4X2,\n    MAT4X3,\n    MAT4,\n    // combined image samplers\n    SAMPLER1D,\n    SAMPLER1D_ARRAY,\n    SAMPLER2D,\n    SAMPLER2D_ARRAY,\n    SAMPLER3D,\n    SAMPLER_CUBE,\n    // sampler\n    SAMPLER,\n    // sampled textures\n    TEXTURE1D,\n    TEXTURE1D_ARRAY,\n    TEXTURE2D,\n    TEXTURE2D_ARRAY,\n    TEXTURE3D,\n    TEXTURE_CUBE,\n    // storage images\n    IMAGE1D,\n    IMAGE1D_ARRAY,\n    IMAGE2D,\n    IMAGE2D_ARRAY,\n    IMAGE3D,\n    IMAGE_CUBE,\n    // input attachment\n    SUBPASS_INPUT,\n    COUNT,\n}\n\nexport enum BufferUsageBit {\n    NONE = 0,\n    TRANSFER_SRC = 0x1,\n    TRANSFER_DST = 0x2,\n    INDEX = 0x4,\n    VERTEX = 0x8,\n    UNIFORM = 0x10,\n    STORAGE = 0x20,\n    INDIRECT = 0x40,\n}\n\nexport enum BufferFlagBit {\n    NONE = 0,\n}\n\nexport enum MemoryAccessBit {\n    NONE = 0,\n    READ_ONLY = 0x1,\n    WRITE_ONLY = 0x2,\n    READ_WRITE = READ_ONLY | WRITE_ONLY,\n}\n\nexport enum MemoryUsageBit {\n    NONE = 0,\n    DEVICE = 0x1, // for rarely-updated resources, use MemoryUsageBit::DEVICE\n    HOST = 0x2,   // for frequently-updated resources, use MemoryUsageBit::DEVICE | MemoryUsageBit::HOST\n}\n\nexport enum TextureType {\n    TEX1D,\n    TEX2D,\n    TEX3D,\n    CUBE,\n    TEX1D_ARRAY,\n    TEX2D_ARRAY,\n}\n\nexport enum TextureUsageBit {\n    NONE = 0,\n    TRANSFER_SRC = 0x1,\n    TRANSFER_DST = 0x2,\n    SAMPLED = 0x4,\n    STORAGE = 0x8,\n    COLOR_ATTACHMENT = 0x10,\n    DEPTH_STENCIL_ATTACHMENT = 0x20,\n    INPUT_ATTACHMENT = 0x40,\n}\n\nexport enum TextureFlagBit {\n    NONE = 0,\n    GEN_MIPMAP = 0x1,     // Generate mipmaps using bilinear filter\n    GENERAL_LAYOUT = 0x2, // For inout framebuffer attachments\n}\n\nexport enum FormatFeatureBit {\n    NONE = 0,\n    RENDER_TARGET = 0x1,     // Allow usages as render pass attachments\n    SAMPLED_TEXTURE = 0x2,   // Allow sampled reads in shaders\n    LINEAR_FILTER = 0x4,     // Allow linear filtering when sampling in shaders or blitting\n    STORAGE_TEXTURE = 0x8,   // Allow storage reads & writes in shaders\n    VERTEX_ATTRIBUTE = 0x10, // Allow usages as vertex input attributes\n}\n\nexport enum SampleCount {\n    ONE,                  // Single sample\n    MULTIPLE_PERFORMANCE, // Multiple samples prioritizing performance over quality\n    MULTIPLE_BALANCE,     // Multiple samples leveraging both quality and performance\n    MULTIPLE_QUALITY,     // Multiple samples prioritizing quality over performance\n}\n\nexport enum VsyncMode {\n    // The application does not synchronizes with the vertical sync.\n    // If application renders faster than the display refreshes, frames are wasted and tearing may be observed.\n    // FPS is uncapped. Maximum power consumption. If unsupported, \"ON\" value will be used instead. Minimum latency.\n    OFF,\n    // The application is always synchronized with the vertical sync. Tearing does not happen.\n    // FPS is capped to the display's refresh rate. For fast applications, battery life is improved. Always supported.\n    ON,\n    // The application synchronizes with the vertical sync, but only if the application rendering speed is greater than refresh rate.\n    // Compared to OFF, there is no tearing. Compared to ON, the FPS will be improved for \"slower\" applications.\n    // If unsupported, \"ON\" value will be used instead. Recommended for most applications. Default if supported.\n    RELAXED,\n    // The presentation engine will always use the latest fully rendered image.\n    // Compared to OFF, no tearing will be observed.\n    // Compared to ON, battery power will be worse, especially for faster applications.\n    // If unsupported,  \"OFF\" will be attempted next.\n    MAILBOX,\n    // The application is capped to using half the vertical sync time.\n    // FPS artificially capped to Half the display speed (usually 30fps) to maintain battery.\n    // Best possible battery savings. Worst possible performance.\n    // Recommended for specific applications where battery saving is critical.\n    HALF,\n}\n\nexport enum Filter {\n    NONE,\n    POINT,\n    LINEAR,\n    ANISOTROPIC,\n}\n\nexport enum Address {\n    WRAP,\n    MIRROR,\n    CLAMP,\n    BORDER,\n}\n\nexport enum ComparisonFunc {\n    NEVER,\n    LESS,\n    EQUAL,\n    LESS_EQUAL,\n    GREATER,\n    NOT_EQUAL,\n    GREATER_EQUAL,\n    ALWAYS,\n}\n\nexport enum StencilOp {\n    ZERO,\n    KEEP,\n    REPLACE,\n    INCR,\n    DECR,\n    INVERT,\n    INCR_WRAP,\n    DECR_WRAP,\n}\n\nexport enum BlendFactor {\n    ZERO,\n    ONE,\n    SRC_ALPHA,\n    DST_ALPHA,\n    ONE_MINUS_SRC_ALPHA,\n    ONE_MINUS_DST_ALPHA,\n    SRC_COLOR,\n    DST_COLOR,\n    ONE_MINUS_SRC_COLOR,\n    ONE_MINUS_DST_COLOR,\n    SRC_ALPHA_SATURATE,\n    CONSTANT_COLOR,\n    ONE_MINUS_CONSTANT_COLOR,\n    CONSTANT_ALPHA,\n    ONE_MINUS_CONSTANT_ALPHA,\n}\n\nexport enum BlendOp {\n    ADD,\n    SUB,\n    REV_SUB,\n    MIN,\n    MAX,\n}\n\nexport enum ColorMask {\n    NONE = 0x0,\n    R = 0x1,\n    G = 0x2,\n    B = 0x4,\n    A = 0x8,\n    ALL = R | G | B | A,\n}\n\nexport enum ShaderStageFlagBit {\n    NONE = 0x0,\n    VERTEX = 0x1,\n    CONTROL = 0x2,\n    EVALUATION = 0x4,\n    GEOMETRY = 0x8,\n    FRAGMENT = 0x10,\n    COMPUTE = 0x20,\n    ALL = 0x3f,\n}\n\nexport enum LoadOp {\n    LOAD,    // Load the previous content from memory\n    CLEAR,   // Clear the content to a fixed value\n    DISCARD, // Discard the previous content\n}\n\nexport enum StoreOp {\n    STORE,   // Store the pending content to memory\n    DISCARD, // Discard the pending content\n}\n\nexport enum AccessFlagBit {\n    NONE = 0,\n\n    // Read accesses\n    INDIRECT_BUFFER = 1 << 0,                                     // Read as an indirect buffer for drawing or dispatch\n    INDEX_BUFFER = 1 << 1,                                        // Read as an index buffer for drawing\n    VERTEX_BUFFER = 1 << 2,                                       // Read as a vertex buffer for drawing\n    VERTEX_SHADER_READ_UNIFORM_BUFFER = 1 << 3,                   // Read as a uniform buffer in a vertex shader\n    VERTEX_SHADER_READ_TEXTURE = 1 << 4,                          // Read as a sampled image/uniform texel buffer in a vertex shader\n    VERTEX_SHADER_READ_OTHER = 1 << 5,                            // Read as any other resource in a vertex shader\n    FRAGMENT_SHADER_READ_UNIFORM_BUFFER = 1 << 6,                 // Read as a uniform buffer in a fragment shader\n    FRAGMENT_SHADER_READ_TEXTURE = 1 << 7,                        // Read as a sampled image/uniform texel buffer in a fragment shader\n    FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT = 1 << 8,         // Read as an input attachment with a color format in a fragment shader\n    FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT = 1 << 9, // Read as an input attachment with a depth/stencil format in a fragment shader\n    FRAGMENT_SHADER_READ_OTHER = 1 << 10,                         // Read as any other resource in a fragment shader\n    COLOR_ATTACHMENT_READ = 1 << 11,                              // Read by standard blending/logic operations or subpass load operations\n    DEPTH_STENCIL_ATTACHMENT_READ = 1 << 12,                      // Read by depth/stencil tests or subpass load operations\n    COMPUTE_SHADER_READ_UNIFORM_BUFFER = 1 << 13,                 // Read as a uniform buffer in a compute shader\n    COMPUTE_SHADER_READ_TEXTURE = 1 << 14,                        // Read as a sampled image/uniform texel buffer in a compute shader\n    COMPUTE_SHADER_READ_OTHER = 1 << 15,                          // Read as any other resource in a compute shader\n    TRANSFER_READ = 1 << 16,                                      // Read as the source of a transfer operation\n    HOST_READ = 1 << 17,                                          // Read on the host\n    PRESENT = 1 << 18,                                            // Read by the presentation engine\n\n    // Write accesses\n    VERTEX_SHADER_WRITE = 1 << 19,            // Written as any resource in a vertex shader\n    FRAGMENT_SHADER_WRITE = 1 << 20,          // Written as any resource in a fragment shader\n    COLOR_ATTACHMENT_WRITE = 1 << 21,         // Written as a color attachment during rendering, or via a subpass store op\n    DEPTH_STENCIL_ATTACHMENT_WRITE = 1 << 22, // Written as a depth/stencil attachment during rendering, or via a subpass store op\n    COMPUTE_SHADER_WRITE = 1 << 23,           // Written as any resource in a compute shader\n    TRANSFER_WRITE = 1 << 24,                 // Written as the destination of a transfer operation\n    HOST_PREINITIALIZED = 1 << 25,            // Data pre-filled by host before device access starts\n    HOST_WRITE = 1 << 26,                     // Written on the host\n}\n\nexport enum ResolveMode {\n    NONE,\n    SAMPLE_ZERO,\n    AVERAGE,\n    MIN,\n    MAX,\n}\n\nexport enum PipelineBindPoint {\n    GRAPHICS,\n    COMPUTE,\n    RAY_TRACING,\n}\n\nexport enum PrimitiveMode {\n    POINT_LIST,\n    LINE_LIST,\n    LINE_STRIP,\n    LINE_LOOP,\n    LINE_LIST_ADJACENCY,\n    LINE_STRIP_ADJACENCY,\n    ISO_LINE_LIST,\n    // raycast detectable:\n    TRIANGLE_LIST,\n    TRIANGLE_STRIP,\n    TRIANGLE_FAN,\n    TRIANGLE_LIST_ADJACENCY,\n    TRIANGLE_STRIP_ADJACENCY,\n    TRIANGLE_PATCH_ADJACENCY,\n    QUAD_PATCH_LIST,\n}\n\nexport enum PolygonMode {\n    FILL,\n    POINT,\n    LINE,\n}\n\nexport enum ShadeModel {\n    GOURAND,\n    FLAT,\n}\n\nexport enum CullMode {\n    NONE,\n    FRONT,\n    BACK,\n}\n\nexport enum DynamicStateFlagBit {\n    NONE = 0x0,\n    LINE_WIDTH = 0x1,\n    DEPTH_BIAS = 0x2,\n    BLEND_CONSTANTS = 0x4,\n    DEPTH_BOUNDS = 0x8,\n    STENCIL_WRITE_MASK = 0x10,\n    STENCIL_COMPARE_MASK = 0x20,\n}\n\nexport enum StencilFace {\n    FRONT = 0x1,\n    BACK = 0x2,\n    ALL = 0x3,\n}\n\nexport enum DescriptorType {\n    UNKNOWN = 0,\n    UNIFORM_BUFFER = 0x1,\n    DYNAMIC_UNIFORM_BUFFER = 0x2,\n    STORAGE_BUFFER = 0x4,\n    DYNAMIC_STORAGE_BUFFER = 0x8,\n    SAMPLER_TEXTURE = 0x10,\n    SAMPLER = 0x20,\n    TEXTURE = 0x40,\n    STORAGE_IMAGE = 0x80,\n    INPUT_ATTACHMENT = 0x100,\n}\n\nexport enum QueueType {\n    GRAPHICS,\n    COMPUTE,\n    TRANSFER,\n}\n\nexport enum QueryType {\n    OCCLUSION,\n    PIPELINE_STATISTICS,\n    TIMESTAMP,\n}\n\nexport enum CommandBufferType {\n    PRIMARY,\n    SECONDARY,\n}\n\nexport enum ClearFlagBit {\n    NONE = 0,\n    COLOR = 0x1,\n    DEPTH = 0x2,\n    STENCIL = 0x4,\n    DEPTH_STENCIL = DEPTH | STENCIL,\n    ALL = COLOR | DEPTH | STENCIL,\n}\n\nexport enum BarrierType {\n    FULL,\n    SPLIT_BEGIN,\n    SPLIT_END,\n}\n\nexport enum PassType {\n    RASTER,\n    COMPUTE,\n    COPY,\n    MOVE,\n    RAYTRACE,\n    PRESENT,\n}\n\nexport type BufferUsage = BufferUsageBit;\nexport type BufferFlags = BufferFlagBit;\nexport type MemoryAccess = MemoryAccessBit;\nexport type MemoryUsage = MemoryUsageBit;\nexport type TextureUsage = TextureUsageBit;\nexport type TextureFlags = TextureFlagBit;\nexport type FormatFeature = FormatFeatureBit;\nexport type ShaderStageFlags = ShaderStageFlagBit;\nexport type AccessFlags = AccessFlagBit;\nexport type DynamicStateFlags = DynamicStateFlagBit;\nexport type ClearFlags = ClearFlagBit;\n\nexport class Size {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public x: number = 0,\n        public y: number = 0,\n        public z: number = 0,\n    ) {}\n\n    public copy (info: Readonly<Size>) {\n        this.x = info.x;\n        this.y = info.y;\n        this.z = info.z;\n        return this;\n    }\n}\n\nexport class DeviceCaps {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public maxVertexAttributes: number = 0,\n        public maxVertexUniformVectors: number = 0,\n        public maxFragmentUniformVectors: number = 0,\n        public maxTextureUnits: number = 0,\n        public maxImageUnits: number = 0,\n        public maxVertexTextureUnits: number = 0,\n        public maxColorRenderTargets: number = 0,\n        public maxShaderStorageBufferBindings: number = 0,\n        public maxShaderStorageBlockSize: number = 0,\n        public maxUniformBufferBindings: number = 0,\n        public maxUniformBlockSize: number = 0,\n        public maxTextureSize: number = 0,\n        public maxCubeMapTextureSize: number = 0,\n        public uboOffsetAlignment: number = 1,\n        public maxComputeSharedMemorySize: number = 0,\n        public maxComputeWorkGroupInvocations: number = 0,\n        public maxComputeWorkGroupSize: Size = new Size(),\n        public maxComputeWorkGroupCount: Size = new Size(),\n        public supportQuery: boolean = false,\n        public clipSpaceMinZ: number = -1,\n        public screenSpaceSignY: number = 1,\n        public clipSpaceSignY: number = 1,\n    ) {}\n\n    public copy (info: Readonly<DeviceCaps>) {\n        this.maxVertexAttributes = info.maxVertexAttributes;\n        this.maxVertexUniformVectors = info.maxVertexUniformVectors;\n        this.maxFragmentUniformVectors = info.maxFragmentUniformVectors;\n        this.maxTextureUnits = info.maxTextureUnits;\n        this.maxImageUnits = info.maxImageUnits;\n        this.maxVertexTextureUnits = info.maxVertexTextureUnits;\n        this.maxColorRenderTargets = info.maxColorRenderTargets;\n        this.maxShaderStorageBufferBindings = info.maxShaderStorageBufferBindings;\n        this.maxShaderStorageBlockSize = info.maxShaderStorageBlockSize;\n        this.maxUniformBufferBindings = info.maxUniformBufferBindings;\n        this.maxUniformBlockSize = info.maxUniformBlockSize;\n        this.maxTextureSize = info.maxTextureSize;\n        this.maxCubeMapTextureSize = info.maxCubeMapTextureSize;\n        this.uboOffsetAlignment = info.uboOffsetAlignment;\n        this.maxComputeSharedMemorySize = info.maxComputeSharedMemorySize;\n        this.maxComputeWorkGroupInvocations = info.maxComputeWorkGroupInvocations;\n        this.maxComputeWorkGroupSize.copy(info.maxComputeWorkGroupSize);\n        this.maxComputeWorkGroupCount.copy(info.maxComputeWorkGroupCount);\n        this.supportQuery = info.supportQuery;\n        this.clipSpaceMinZ = info.clipSpaceMinZ;\n        this.screenSpaceSignY = info.screenSpaceSignY;\n        this.clipSpaceSignY = info.clipSpaceSignY;\n        return this;\n    }\n}\n\nexport class DeviceOptions {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public enableBarrierDeduce: boolean = true,\n    ) {}\n\n    public copy (info: Readonly<DeviceOptions>) {\n        this.enableBarrierDeduce = info.enableBarrierDeduce;\n        return this;\n    }\n}\n\nexport class Offset {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public x: number = 0,\n        public y: number = 0,\n        public z: number = 0,\n    ) {}\n\n    public copy (info: Readonly<Offset>) {\n        this.x = info.x;\n        this.y = info.y;\n        this.z = info.z;\n        return this;\n    }\n}\n\nexport class Rect {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public x: number = 0,\n        public y: number = 0,\n        public width: number = 0,\n        public height: number = 0,\n    ) {}\n\n    public copy (info: Readonly<Rect>) {\n        this.x = info.x;\n        this.y = info.y;\n        this.width = info.width;\n        this.height = info.height;\n        return this;\n    }\n}\n\nexport class Extent {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public width: number = 0,\n        public height: number = 0,\n        public depth: number = 1,\n    ) {}\n\n    public copy (info: Readonly<Extent>) {\n        this.width = info.width;\n        this.height = info.height;\n        this.depth = info.depth;\n        return this;\n    }\n}\n\nexport class TextureSubresLayers {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public mipLevel: number = 0,\n        public baseArrayLayer: number = 0,\n        public layerCount: number = 1,\n    ) {}\n\n    public copy (info: Readonly<TextureSubresLayers>) {\n        this.mipLevel = info.mipLevel;\n        this.baseArrayLayer = info.baseArrayLayer;\n        this.layerCount = info.layerCount;\n        return this;\n    }\n}\n\nexport class TextureSubresRange {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public baseMipLevel: number = 0,\n        public levelCount: number = 1,\n        public baseArrayLayer: number = 0,\n        public layerCount: number = 1,\n    ) {}\n\n    public copy (info: Readonly<TextureSubresRange>) {\n        this.baseMipLevel = info.baseMipLevel;\n        this.levelCount = info.levelCount;\n        this.baseArrayLayer = info.baseArrayLayer;\n        this.layerCount = info.layerCount;\n        return this;\n    }\n}\n\nexport class TextureCopy {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public srcSubres: TextureSubresLayers = new TextureSubresLayers(),\n        public srcOffset: Offset = new Offset(),\n        public dstSubres: TextureSubresLayers = new TextureSubresLayers(),\n        public dstOffset: Offset = new Offset(),\n        public extent: Extent = new Extent(),\n    ) {}\n\n    public copy (info: Readonly<TextureCopy>) {\n        this.srcSubres.copy(info.srcSubres);\n        this.srcOffset.copy(info.srcOffset);\n        this.dstSubres.copy(info.dstSubres);\n        this.dstOffset.copy(info.dstOffset);\n        this.extent.copy(info.extent);\n        return this;\n    }\n}\n\nexport class TextureBlit {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public srcSubres: TextureSubresLayers = new TextureSubresLayers(),\n        public srcOffset: Offset = new Offset(),\n        public srcExtent: Extent = new Extent(),\n        public dstSubres: TextureSubresLayers = new TextureSubresLayers(),\n        public dstOffset: Offset = new Offset(),\n        public dstExtent: Extent = new Extent(),\n    ) {}\n\n    public copy (info: Readonly<TextureBlit>) {\n        this.srcSubres.copy(info.srcSubres);\n        this.srcOffset.copy(info.srcOffset);\n        this.srcExtent.copy(info.srcExtent);\n        this.dstSubres.copy(info.dstSubres);\n        this.dstOffset.copy(info.dstOffset);\n        this.dstExtent.copy(info.dstExtent);\n        return this;\n    }\n}\n\nexport class BufferTextureCopy {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public buffOffset: number = 0,\n        public buffStride: number = 0,\n        public buffTexHeight: number = 0,\n        public texOffset: Offset = new Offset(),\n        public texExtent: Extent = new Extent(),\n        public texSubres: TextureSubresLayers = new TextureSubresLayers(),\n    ) {}\n\n    public copy (info: Readonly<BufferTextureCopy>) {\n        this.buffOffset = info.buffOffset;\n        this.buffStride = info.buffStride;\n        this.buffTexHeight = info.buffTexHeight;\n        this.texOffset.copy(info.texOffset);\n        this.texExtent.copy(info.texExtent);\n        this.texSubres.copy(info.texSubres);\n        return this;\n    }\n}\n\nexport class Viewport {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public left: number = 0,\n        public top: number = 0,\n        public width: number = 0,\n        public height: number = 0,\n        public minDepth: number = 0,\n        public maxDepth: number = 1,\n    ) {}\n\n    public copy (info: Readonly<Viewport>) {\n        this.left = info.left;\n        this.top = info.top;\n        this.width = info.width;\n        this.height = info.height;\n        this.minDepth = info.minDepth;\n        this.maxDepth = info.maxDepth;\n        return this;\n    }\n}\n\nexport class Color {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public x: number = 0,\n        public y: number = 0,\n        public z: number = 0,\n        public w: number = 0,\n    ) {}\n\n    public copy (info: Readonly<Color>) {\n        this.x = info.x;\n        this.y = info.y;\n        this.z = info.z;\n        this.w = info.w;\n        return this;\n    }\n}\n\nexport class BindingMappingInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public maxBlockCounts: number[] = [0],\n        public maxSamplerTextureCounts: number[] = [0],\n        public maxSamplerCounts: number[] = [0],\n        public maxTextureCounts: number[] = [0],\n        public maxBufferCounts: number[] = [0],\n        public maxImageCounts: number[] = [0],\n        public maxSubpassInputCounts: number[] = [0],\n        public setIndices: number[] = [0],\n    ) {}\n\n    public copy (info: Readonly<BindingMappingInfo>) {\n        this.maxBlockCounts = info.maxBlockCounts.slice();\n        this.maxSamplerTextureCounts = info.maxSamplerTextureCounts.slice();\n        this.maxSamplerCounts = info.maxSamplerCounts.slice();\n        this.maxTextureCounts = info.maxTextureCounts.slice();\n        this.maxBufferCounts = info.maxBufferCounts.slice();\n        this.maxImageCounts = info.maxImageCounts.slice();\n        this.maxSubpassInputCounts = info.maxSubpassInputCounts.slice();\n        this.setIndices = info.setIndices.slice();\n        return this;\n    }\n}\n\nexport class SwapchainInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public windowHandle: HTMLCanvasElement = null!,\n        public vsyncMode: VsyncMode = VsyncMode.ON,\n        public width: number = 0,\n        public height: number = 0,\n    ) {}\n\n    public copy (info: Readonly<SwapchainInfo>) {\n        this.windowHandle = info.windowHandle;\n        this.vsyncMode = info.vsyncMode;\n        this.width = info.width;\n        this.height = info.height;\n        return this;\n    }\n}\n\nexport class DeviceInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public bindingMappingInfo: BindingMappingInfo = new BindingMappingInfo(),\n    ) {}\n\n    public copy (info: Readonly<DeviceInfo>) {\n        this.bindingMappingInfo.copy(info.bindingMappingInfo);\n        return this;\n    }\n}\n\nexport class BufferInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public usage: BufferUsage = BufferUsageBit.NONE,\n        public memUsage: MemoryUsage = MemoryUsageBit.NONE,\n        public size: number = 0,\n        public stride: number = 1,\n        public flags: BufferFlags = BufferFlagBit.NONE,\n    ) {}\n\n    public copy (info: Readonly<BufferInfo>) {\n        this.usage = info.usage;\n        this.memUsage = info.memUsage;\n        this.size = info.size;\n        this.stride = info.stride;\n        this.flags = info.flags;\n        return this;\n    }\n}\n\nexport class BufferViewInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public buffer: Buffer = null!,\n        public offset: number = 0,\n        public range: number = 0,\n    ) {}\n\n    public copy (info: Readonly<BufferViewInfo>) {\n        this.buffer = info.buffer;\n        this.offset = info.offset;\n        this.range = info.range;\n        return this;\n    }\n}\n\nexport class DrawInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public vertexCount: number = 0,\n        public firstVertex: number = 0,\n        public indexCount: number = 0,\n        public firstIndex: number = 0,\n        public vertexOffset: number = 0,\n        public instanceCount: number = 0,\n        public firstInstance: number = 0,\n    ) {}\n\n    public copy (info: Readonly<DrawInfo>) {\n        this.vertexCount = info.vertexCount;\n        this.firstVertex = info.firstVertex;\n        this.indexCount = info.indexCount;\n        this.firstIndex = info.firstIndex;\n        this.vertexOffset = info.vertexOffset;\n        this.instanceCount = info.instanceCount;\n        this.firstInstance = info.firstInstance;\n        return this;\n    }\n}\n\nexport class DispatchInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public groupCountX: number = 0,\n        public groupCountY: number = 0,\n        public groupCountZ: number = 0,\n        public indirectBuffer: Buffer | null = null,\n        public indirectOffset: number = 0,\n    ) {}\n\n    public copy (info: Readonly<DispatchInfo>) {\n        this.groupCountX = info.groupCountX;\n        this.groupCountY = info.groupCountY;\n        this.groupCountZ = info.groupCountZ;\n        this.indirectBuffer = info.indirectBuffer;\n        this.indirectOffset = info.indirectOffset;\n        return this;\n    }\n}\n\nexport class IndirectBuffer {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public drawInfos: DrawInfo[] = [],\n    ) {}\n\n    public copy (info: Readonly<IndirectBuffer>) {\n        deepCopy(this.drawInfos, info.drawInfos, DrawInfo);\n        return this;\n    }\n}\n\nexport class TextureInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public type: TextureType = TextureType.TEX2D,\n        public usage: TextureUsage = TextureUsageBit.NONE,\n        public format: Format = Format.UNKNOWN,\n        public width: number = 0,\n        public height: number = 0,\n        public flags: TextureFlags = TextureFlagBit.NONE,\n        public layerCount: number = 1,\n        public levelCount: number = 1,\n        public samples: SampleCount = SampleCount.ONE,\n        public depth: number = 1,\n        public externalRes: number = 0,\n    ) {}\n\n    public copy (info: Readonly<TextureInfo>) {\n        this.type = info.type;\n        this.usage = info.usage;\n        this.format = info.format;\n        this.width = info.width;\n        this.height = info.height;\n        this.flags = info.flags;\n        this.layerCount = info.layerCount;\n        this.levelCount = info.levelCount;\n        this.samples = info.samples;\n        this.depth = info.depth;\n        this.externalRes = info.externalRes;\n        return this;\n    }\n}\n\nexport class TextureViewInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public texture: Texture = null!,\n        public type: TextureType = TextureType.TEX2D,\n        public format: Format = Format.UNKNOWN,\n        public baseLevel: number = 0,\n        public levelCount: number = 1,\n        public baseLayer: number = 0,\n        public layerCount: number = 1,\n    ) {}\n\n    public copy (info: Readonly<TextureViewInfo>) {\n        this.texture = info.texture;\n        this.type = info.type;\n        this.format = info.format;\n        this.baseLevel = info.baseLevel;\n        this.levelCount = info.levelCount;\n        this.baseLayer = info.baseLayer;\n        this.layerCount = info.layerCount;\n        return this;\n    }\n}\n\nexport class SamplerInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public minFilter: Filter = Filter.LINEAR,\n        public magFilter: Filter = Filter.LINEAR,\n        public mipFilter: Filter = Filter.NONE,\n        public addressU: Address = Address.WRAP,\n        public addressV: Address = Address.WRAP,\n        public addressW: Address = Address.WRAP,\n        public maxAnisotropy: number = 0,\n        public cmpFunc: ComparisonFunc = ComparisonFunc.ALWAYS,\n    ) {}\n\n    public copy (info: Readonly<SamplerInfo>) {\n        this.minFilter = info.minFilter;\n        this.magFilter = info.magFilter;\n        this.mipFilter = info.mipFilter;\n        this.addressU = info.addressU;\n        this.addressV = info.addressV;\n        this.addressW = info.addressW;\n        this.maxAnisotropy = info.maxAnisotropy;\n        this.cmpFunc = info.cmpFunc;\n        return this;\n    }\n}\n\nexport class Uniform {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public name: string = '',\n        public type: Type = Type.UNKNOWN,\n        public count: number = 0,\n    ) {}\n\n    public copy (info: Readonly<Uniform>) {\n        this.name = info.name;\n        this.type = info.type;\n        this.count = info.count;\n        return this;\n    }\n}\n\nexport class UniformBlock {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public members: Uniform[] = [],\n        public count: number = 0,\n    ) {}\n\n    public copy (info: Readonly<UniformBlock>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        deepCopy(this.members, info.members, Uniform);\n        this.count = info.count;\n        return this;\n    }\n}\n\nexport class UniformSamplerTexture {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public type: Type = Type.UNKNOWN,\n        public count: number = 0,\n    ) {}\n\n    public copy (info: Readonly<UniformSamplerTexture>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        this.type = info.type;\n        this.count = info.count;\n        return this;\n    }\n}\n\nexport class UniformSampler {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public count: number = 0,\n    ) {}\n\n    public copy (info: Readonly<UniformSampler>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        this.count = info.count;\n        return this;\n    }\n}\n\nexport class UniformTexture {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public type: Type = Type.UNKNOWN,\n        public count: number = 0,\n    ) {}\n\n    public copy (info: Readonly<UniformTexture>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        this.type = info.type;\n        this.count = info.count;\n        return this;\n    }\n}\n\nexport class UniformStorageImage {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public type: Type = Type.UNKNOWN,\n        public count: number = 0,\n        public memoryAccess: MemoryAccess = MemoryAccessBit.READ_WRITE,\n    ) {}\n\n    public copy (info: Readonly<UniformStorageImage>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        this.type = info.type;\n        this.count = info.count;\n        this.memoryAccess = info.memoryAccess;\n        return this;\n    }\n}\n\nexport class UniformStorageBuffer {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public count: number = 0,\n        public memoryAccess: MemoryAccess = MemoryAccessBit.READ_WRITE,\n    ) {}\n\n    public copy (info: Readonly<UniformStorageBuffer>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        this.count = info.count;\n        this.memoryAccess = info.memoryAccess;\n        return this;\n    }\n}\n\nexport class UniformInputAttachment {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public set: number = 0,\n        public binding: number = 0,\n        public name: string = '',\n        public count: number = 0,\n    ) {}\n\n    public copy (info: Readonly<UniformInputAttachment>) {\n        this.set = info.set;\n        this.binding = info.binding;\n        this.name = info.name;\n        this.count = info.count;\n        return this;\n    }\n}\n\nexport class ShaderStage {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public stage: ShaderStageFlagBit = ShaderStageFlagBit.NONE,\n        public source: string = '',\n    ) {}\n\n    public copy (info: Readonly<ShaderStage>) {\n        this.stage = info.stage;\n        this.source = info.source;\n        return this;\n    }\n}\n\nexport class Attribute {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public name: string = '',\n        public format: Format = Format.UNKNOWN,\n        public isNormalized: boolean = false,\n        public stream: number = 0,\n        public isInstanced: boolean = false,\n        public location: number = 0,\n    ) {}\n\n    public copy (info: Readonly<Attribute>) {\n        this.name = info.name;\n        this.format = info.format;\n        this.isNormalized = info.isNormalized;\n        this.stream = info.stream;\n        this.isInstanced = info.isInstanced;\n        this.location = info.location;\n        return this;\n    }\n}\n\nexport class ShaderInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public name: string = '',\n        public stages: ShaderStage[] = [],\n        public attributes: Attribute[] = [],\n        public blocks: UniformBlock[] = [],\n        public buffers: UniformStorageBuffer[] = [],\n        public samplerTextures: UniformSamplerTexture[] = [],\n        public samplers: UniformSampler[] = [],\n        public textures: UniformTexture[] = [],\n        public images: UniformStorageImage[] = [],\n        public subpassInputs: UniformInputAttachment[] = [],\n    ) {}\n\n    public copy (info: Readonly<ShaderInfo>) {\n        this.name = info.name;\n        deepCopy(this.stages, info.stages, ShaderStage);\n        deepCopy(this.attributes, info.attributes, Attribute);\n        deepCopy(this.blocks, info.blocks, UniformBlock);\n        deepCopy(this.buffers, info.buffers, UniformStorageBuffer);\n        deepCopy(this.samplerTextures, info.samplerTextures, UniformSamplerTexture);\n        deepCopy(this.samplers, info.samplers, UniformSampler);\n        deepCopy(this.textures, info.textures, UniformTexture);\n        deepCopy(this.images, info.images, UniformStorageImage);\n        deepCopy(this.subpassInputs, info.subpassInputs, UniformInputAttachment);\n        return this;\n    }\n}\n\nexport class InputAssemblerInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public attributes: Attribute[] = [],\n        public vertexBuffers: Buffer[] = [],\n        public indexBuffer: Buffer | null = null,\n        public indirectBuffer: Buffer | null = null,\n    ) {}\n\n    public copy (info: Readonly<InputAssemblerInfo>) {\n        deepCopy(this.attributes, info.attributes, Attribute);\n        this.vertexBuffers = info.vertexBuffers.slice();\n        this.indexBuffer = info.indexBuffer;\n        this.indirectBuffer = info.indirectBuffer;\n        return this;\n    }\n}\n\nexport class ColorAttachment {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public format: Format = Format.UNKNOWN,\n        public sampleCount: SampleCount = SampleCount.ONE,\n        public loadOp: LoadOp = LoadOp.CLEAR,\n        public storeOp: StoreOp = StoreOp.STORE,\n        public barrier: GeneralBarrier = null!,\n        public isGeneralLayout: boolean = false,\n    ) {}\n\n    public copy (info: Readonly<ColorAttachment>) {\n        this.format = info.format;\n        this.sampleCount = info.sampleCount;\n        this.loadOp = info.loadOp;\n        this.storeOp = info.storeOp;\n        this.barrier = info.barrier;\n        this.isGeneralLayout = info.isGeneralLayout;\n        return this;\n    }\n}\n\nexport class DepthStencilAttachment {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public format: Format = Format.UNKNOWN,\n        public sampleCount: SampleCount = SampleCount.ONE,\n        public depthLoadOp: LoadOp = LoadOp.CLEAR,\n        public depthStoreOp: StoreOp = StoreOp.STORE,\n        public stencilLoadOp: LoadOp = LoadOp.CLEAR,\n        public stencilStoreOp: StoreOp = StoreOp.STORE,\n        public barrier: GeneralBarrier = null!,\n        public isGeneralLayout: boolean = false,\n    ) {}\n\n    public copy (info: Readonly<DepthStencilAttachment>) {\n        this.format = info.format;\n        this.sampleCount = info.sampleCount;\n        this.depthLoadOp = info.depthLoadOp;\n        this.depthStoreOp = info.depthStoreOp;\n        this.stencilLoadOp = info.stencilLoadOp;\n        this.stencilStoreOp = info.stencilStoreOp;\n        this.barrier = info.barrier;\n        this.isGeneralLayout = info.isGeneralLayout;\n        return this;\n    }\n}\n\nexport class SubpassInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public inputs: number[] = [],\n        public colors: number[] = [],\n        public resolves: number[] = [],\n        public preserves: number[] = [],\n        public depthStencil: number = -1,\n        public depthStencilResolve: number = -1,\n        public depthResolveMode: ResolveMode = ResolveMode.NONE,\n        public stencilResolveMode: ResolveMode = ResolveMode.NONE,\n    ) {}\n\n    public copy (info: Readonly<SubpassInfo>) {\n        this.inputs = info.inputs.slice();\n        this.colors = info.colors.slice();\n        this.resolves = info.resolves.slice();\n        this.preserves = info.preserves.slice();\n        this.depthStencil = info.depthStencil;\n        this.depthStencilResolve = info.depthStencilResolve;\n        this.depthResolveMode = info.depthResolveMode;\n        this.stencilResolveMode = info.stencilResolveMode;\n        return this;\n    }\n}\n\nexport class SubpassDependency {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public srcSubpass: number = 0,\n        public dstSubpass: number = 0,\n        public generalBarrier: GeneralBarrier = null!,\n        public bufferBarriers: BufferBarrier = null!,\n        public buffers: Buffer = null!,\n        public bufferBarrierCount: number = 0,\n        public textureBarriers: TextureBarrier = null!,\n        public textures: Texture = null!,\n        public textureBarrierCount: number = 0,\n    ) {}\n\n    public copy (info: Readonly<SubpassDependency>) {\n        this.srcSubpass = info.srcSubpass;\n        this.dstSubpass = info.dstSubpass;\n        this.generalBarrier = info.generalBarrier;\n        this.bufferBarriers = info.bufferBarriers;\n        this.buffers = info.buffers;\n        this.bufferBarrierCount = info.bufferBarrierCount;\n        this.textureBarriers = info.textureBarriers;\n        this.textures = info.textures;\n        this.textureBarrierCount = info.textureBarrierCount;\n        return this;\n    }\n}\n\nexport class RenderPassInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public colorAttachments: ColorAttachment[] = [],\n        public depthStencilAttachment: DepthStencilAttachment = new DepthStencilAttachment(),\n        public subpasses: SubpassInfo[] = [],\n        public dependencies: SubpassDependency[] = [],\n    ) {}\n\n    public copy (info: Readonly<RenderPassInfo>) {\n        deepCopy(this.colorAttachments, info.colorAttachments, ColorAttachment);\n        this.depthStencilAttachment.copy(info.depthStencilAttachment);\n        deepCopy(this.subpasses, info.subpasses, SubpassInfo);\n        deepCopy(this.dependencies, info.dependencies, SubpassDependency);\n        return this;\n    }\n}\n\nexport class GeneralBarrierInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public prevAccesses: AccessFlags = AccessFlagBit.NONE,\n        public nextAccesses: AccessFlags = AccessFlagBit.NONE,\n        public type: BarrierType = BarrierType.FULL,\n    ) {}\n\n    public copy (info: Readonly<GeneralBarrierInfo>) {\n        this.prevAccesses = info.prevAccesses;\n        this.nextAccesses = info.nextAccesses;\n        this.type = info.type;\n        return this;\n    }\n}\n\nexport class TextureBarrierInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public prevAccesses: AccessFlags = AccessFlagBit.NONE,\n        public nextAccesses: AccessFlags = AccessFlagBit.NONE,\n        public type: BarrierType = BarrierType.FULL,\n        public baseMipLevel: number = 0,\n        public levelCount: number = 1,\n        public baseSlice: number = 0,\n        public sliceCount: number = 1,\n        public discardContents: boolean = false,\n        public srcQueue: Queue | null = null,\n        public dstQueue: Queue | null = null,\n    ) {}\n\n    public copy (info: Readonly<TextureBarrierInfo>) {\n        this.prevAccesses = info.prevAccesses;\n        this.nextAccesses = info.nextAccesses;\n        this.type = info.type;\n        this.baseMipLevel = info.baseMipLevel;\n        this.levelCount = info.levelCount;\n        this.baseSlice = info.baseSlice;\n        this.sliceCount = info.sliceCount;\n        this.discardContents = info.discardContents;\n        this.srcQueue = info.srcQueue;\n        this.dstQueue = info.dstQueue;\n        return this;\n    }\n}\n\nexport class BufferBarrierInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public prevAccesses: AccessFlags = AccessFlagBit.NONE,\n        public nextAccesses: AccessFlags = AccessFlagBit.NONE,\n        public type: BarrierType = BarrierType.FULL,\n        public offset: number = 0,\n        public size: number = 0,\n        public discardContents: boolean = false,\n        public srcQueue: Queue | null = null,\n        public dstQueue: Queue | null = null,\n    ) {}\n\n    public copy (info: Readonly<BufferBarrierInfo>) {\n        this.prevAccesses = info.prevAccesses;\n        this.nextAccesses = info.nextAccesses;\n        this.type = info.type;\n        this.offset = info.offset;\n        this.size = info.size;\n        this.discardContents = info.discardContents;\n        this.srcQueue = info.srcQueue;\n        this.dstQueue = info.dstQueue;\n        return this;\n    }\n}\n\nexport class FramebufferInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public renderPass: RenderPass = null!,\n        public colorTextures: Texture[] = [],\n        public depthStencilTexture: Texture | null = null,\n    ) {}\n\n    public copy (info: Readonly<FramebufferInfo>) {\n        this.renderPass = info.renderPass;\n        this.colorTextures = info.colorTextures.slice();\n        this.depthStencilTexture = info.depthStencilTexture;\n        return this;\n    }\n}\n\nexport class DescriptorSetLayoutBinding {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public binding: number = -1,\n        public descriptorType: DescriptorType = DescriptorType.UNKNOWN,\n        public count: number = 0,\n        public stageFlags: ShaderStageFlags = ShaderStageFlagBit.NONE,\n        public immutableSamplers: Sampler[] = [],\n    ) {}\n\n    public copy (info: Readonly<DescriptorSetLayoutBinding>) {\n        this.binding = info.binding;\n        this.descriptorType = info.descriptorType;\n        this.count = info.count;\n        this.stageFlags = info.stageFlags;\n        this.immutableSamplers = info.immutableSamplers.slice();\n        return this;\n    }\n}\n\nexport class DescriptorSetLayoutInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public bindings: DescriptorSetLayoutBinding[] = [],\n    ) {}\n\n    public copy (info: Readonly<DescriptorSetLayoutInfo>) {\n        deepCopy(this.bindings, info.bindings, DescriptorSetLayoutBinding);\n        return this;\n    }\n}\n\nexport class DescriptorSetInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public layout: DescriptorSetLayout = null!,\n    ) {}\n\n    public copy (info: Readonly<DescriptorSetInfo>) {\n        this.layout = info.layout;\n        return this;\n    }\n}\n\nexport class PipelineLayoutInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public setLayouts: DescriptorSetLayout[] = [],\n    ) {}\n\n    public copy (info: Readonly<PipelineLayoutInfo>) {\n        this.setLayouts = info.setLayouts.slice();\n        return this;\n    }\n}\n\nexport class InputState {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public attributes: Attribute[] = [],\n    ) {}\n\n    public copy (info: Readonly<InputState>) {\n        deepCopy(this.attributes, info.attributes, Attribute);\n        return this;\n    }\n}\n\nexport class CommandBufferInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public queue: Queue = null!,\n        public type: CommandBufferType = CommandBufferType.PRIMARY,\n    ) {}\n\n    public copy (info: Readonly<CommandBufferInfo>) {\n        this.queue = info.queue;\n        this.type = info.type;\n        return this;\n    }\n}\n\nexport class QueueInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public type: QueueType = QueueType.GRAPHICS,\n    ) {}\n\n    public copy (info: Readonly<QueueInfo>) {\n        this.type = info.type;\n        return this;\n    }\n}\n\nexport class QueryPoolInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public type: QueryType = QueryType.OCCLUSION,\n        public maxQueryObjects: number = 32767,\n        public forceWait: boolean = true,\n    ) {}\n\n    public copy (info: Readonly<QueryPoolInfo>) {\n        this.type = info.type;\n        this.maxQueryObjects = info.maxQueryObjects;\n        this.forceWait = info.forceWait;\n        return this;\n    }\n}\n\nexport class FormatInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public readonly name: string = '',\n        public readonly size: number = 0,\n        public readonly count: number = 0,\n        public readonly type: FormatType = FormatType.NONE,\n        public readonly hasAlpha: boolean = false,\n        public readonly hasDepth: boolean = false,\n        public readonly hasStencil: boolean = false,\n        public readonly isCompressed: boolean = false,\n    ) {}\n}\n\nexport class MemoryStatus {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public bufferSize: number = 0,\n        public textureSize: number = 0,\n    ) {}\n\n    public copy (info: Readonly<MemoryStatus>) {\n        this.bufferSize = info.bufferSize;\n        this.textureSize = info.textureSize;\n        return this;\n    }\n}\n\nexport class DynamicStencilStates {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public writeMask: number = 0,\n        public compareMask: number = 0,\n        public reference: number = 0,\n    ) {}\n\n    public copy (info: Readonly<DynamicStencilStates>) {\n        this.writeMask = info.writeMask;\n        this.compareMask = info.compareMask;\n        this.reference = info.reference;\n        return this;\n    }\n}\n\nexport class DynamicStates {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public viewport: Viewport = new Viewport(),\n        public scissor: Rect = new Rect(),\n        public blendConstant: Color = new Color(),\n        public lineWidth: number = 1,\n        public depthBiasConstant: number = 0,\n        public depthBiasClamp: number = 0,\n        public depthBiasSlope: number = 0,\n        public depthMinBounds: number = 0,\n        public depthMaxBounds: number = 0,\n        public stencilStatesFront: DynamicStencilStates = new DynamicStencilStates(),\n        public stencilStatesBack: DynamicStencilStates = new DynamicStencilStates(),\n    ) {}\n\n    public copy (info: Readonly<DynamicStates>) {\n        this.viewport.copy(info.viewport);\n        this.scissor.copy(info.scissor);\n        this.blendConstant.copy(info.blendConstant);\n        this.lineWidth = info.lineWidth;\n        this.depthBiasConstant = info.depthBiasConstant;\n        this.depthBiasClamp = info.depthBiasClamp;\n        this.depthBiasSlope = info.depthBiasSlope;\n        this.depthMinBounds = info.depthMinBounds;\n        this.depthMaxBounds = info.depthMaxBounds;\n        this.stencilStatesFront.copy(info.stencilStatesFront);\n        this.stencilStatesBack.copy(info.stencilStatesBack);\n        return this;\n    }\n}\n\n/**\n  * ========================= !DO NOT CHANGE THE ABOVE SECTION MANUALLY! =========================\n  * The above section is auto-generated from native/cocos/renderer/core/gfx/GFXDef-common.h\n  * by the script native/tools/gfx-define-generator/generate.js.\n  * Changes to these public interfaces should be made there first and synced back.\n  * ========================= !DO NOT CHANGE THE ABOVE SECTION MANUALLY! =========================\n  */\n\n/**\n  * @en GFX base object.\n  * @zh GFX 基类对象。\n  */\nexport class GFXObject extends GCObject {\n    public get objectType (): ObjectType {\n        return this._objectType;\n    }\n\n    public get objectID (): number {\n        return this._objectID;\n    }\n\n    public get typedID (): number {\n        return this._typedID;\n    }\n\n    protected _objectType = ObjectType.UNKNOWN;\n    protected _objectID = 0;\n    protected _typedID = 0;\n\n    private static _idTable = Array(ObjectType.COUNT).fill(1 << 16);\n\n    constructor (objectType: ObjectType) {\n        super();\n        this._objectType = objectType;\n        this._objectID = GFXObject._idTable[ObjectType.UNKNOWN]++;\n        this._typedID = GFXObject._idTable[objectType]++;\n    }\n}\n\nexport interface ISwapchainTextureInfo {\n    swapchain: Swapchain;\n    format: Format;\n    width: number;\n    height: number;\n}\n\nexport enum AttributeName {\n    ATTR_POSITION = 'a_position',\n    ATTR_NORMAL = 'a_normal',\n    ATTR_TANGENT = 'a_tangent',\n    ATTR_BITANGENT = 'a_bitangent',\n    ATTR_WEIGHTS = 'a_weights',\n    ATTR_JOINTS = 'a_joints',\n    ATTR_COLOR = 'a_color',\n    ATTR_COLOR1 = 'a_color1',\n    ATTR_COLOR2 = 'a_color2',\n    ATTR_TEX_COORD = 'a_texCoord',\n    ATTR_TEX_COORD1 = 'a_texCoord1',\n    ATTR_TEX_COORD2 = 'a_texCoord2',\n    ATTR_TEX_COORD3 = 'a_texCoord3',\n    ATTR_TEX_COORD4 = 'a_texCoord4',\n    ATTR_TEX_COORD5 = 'a_texCoord5',\n    ATTR_TEX_COORD6 = 'a_texCoord6',\n    ATTR_TEX_COORD7 = 'a_texCoord7',\n    ATTR_TEX_COORD8 = 'a_texCoord8',\n    ATTR_BATCH_ID = 'a_batch_id',\n    ATTR_BATCH_UV = 'a_batch_uv',\n}\n\nexport const FormatInfos = Object.freeze([\n\n    new FormatInfo('UNKNOWN', 0, 0, FormatType.NONE, false, false, false, false),\n\n    new FormatInfo('A8', 1, 1, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('L8', 1, 1, FormatType.UNORM, false, false, false, false),\n    new FormatInfo('LA8', 1, 2, FormatType.UNORM, true, false, false, false),\n\n    new FormatInfo('R8', 1, 1, FormatType.UNORM, false, false, false, false),\n    new FormatInfo('R8SN', 1, 1, FormatType.SNORM, false, false, false, false),\n    new FormatInfo('R8UI', 1, 1, FormatType.UINT, false, false, false, false),\n    new FormatInfo('R8I', 1, 1, FormatType.INT, false, false, false, false),\n    new FormatInfo('R16F', 2, 1, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('R16UI', 2, 1, FormatType.UINT, false, false, false, false),\n    new FormatInfo('R16I', 2, 1, FormatType.INT, false, false, false, false),\n    new FormatInfo('R32F', 4, 1, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('R32UI', 4, 1, FormatType.UINT, false, false, false, false),\n    new FormatInfo('R32I', 4, 1, FormatType.INT, false, false, false, false),\n\n    new FormatInfo('RG8', 2, 2, FormatType.UNORM, false, false, false, false),\n    new FormatInfo('RG8SN', 2, 2, FormatType.SNORM, false, false, false, false),\n    new FormatInfo('RG8UI', 2, 2, FormatType.UINT, false, false, false, false),\n    new FormatInfo('RG8I', 2, 2, FormatType.INT, false, false, false, false),\n    new FormatInfo('RG16F', 4, 2, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('RG16UI', 4, 2, FormatType.UINT, false, false, false, false),\n    new FormatInfo('RG16I', 4, 2, FormatType.INT, false, false, false, false),\n    new FormatInfo('RG32F', 8, 2, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('RG32UI', 8, 2, FormatType.UINT, false, false, false, false),\n    new FormatInfo('RG32I', 8, 2, FormatType.INT, false, false, false, false),\n\n    new FormatInfo('RGB8', 3, 3, FormatType.UNORM, false, false, false, false),\n    new FormatInfo('SRGB8', 3, 3, FormatType.UNORM, false, false, false, false),\n    new FormatInfo('RGB8SN', 3, 3, FormatType.SNORM, false, false, false, false),\n    new FormatInfo('RGB8UI', 3, 3, FormatType.UINT, false, false, false, false),\n    new FormatInfo('RGB8I', 3, 3, FormatType.INT, false, false, false, false),\n    new FormatInfo('RGB16F', 6, 3, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('RGB16UI', 6, 3, FormatType.UINT, false, false, false, false),\n    new FormatInfo('RGB16I', 6, 3, FormatType.INT, false, false, false, false),\n    new FormatInfo('RGB32F', 12, 3, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('RGB32UI', 12, 3, FormatType.UINT, false, false, false, false),\n    new FormatInfo('RGB32I', 12, 3, FormatType.INT, false, false, false, false),\n\n    new FormatInfo('RGBA8', 4, 4, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('BGRA8', 4, 4, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('SRGB8_A8', 4, 4, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('RGBA8SN', 4, 4, FormatType.SNORM, true, false, false, false),\n    new FormatInfo('RGBA8UI', 4, 4, FormatType.UINT, true, false, false, false),\n    new FormatInfo('RGBA8I', 4, 4, FormatType.INT, true, false, false, false),\n    new FormatInfo('RGBA16F', 8, 4, FormatType.FLOAT, true, false, false, false),\n    new FormatInfo('RGBA16UI', 8, 4, FormatType.UINT, true, false, false, false),\n    new FormatInfo('RGBA16I', 8, 4, FormatType.INT, true, false, false, false),\n    new FormatInfo('RGBA32F', 16, 4, FormatType.FLOAT, true, false, false, false),\n    new FormatInfo('RGBA32UI', 16, 4, FormatType.UINT, true, false, false, false),\n    new FormatInfo('RGBA32I', 16, 4, FormatType.INT, true, false, false, false),\n\n    new FormatInfo('R5G6B5', 2, 3, FormatType.UNORM, false, false, false, false),\n    new FormatInfo('R11G11B10F', 4, 3, FormatType.FLOAT, false, false, false, false),\n    new FormatInfo('RGB5A1', 2, 4, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('RGBA4', 2, 4, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('RGB10A2', 2, 4, FormatType.UNORM, true, false, false, false),\n    new FormatInfo('RGB10A2UI', 2, 4, FormatType.UINT, true, false, false, false),\n    new FormatInfo('RGB9E5', 2, 4, FormatType.FLOAT, true, false, false, false),\n\n    new FormatInfo('DEPTH', 4, 1, FormatType.FLOAT, false, true, false, false),\n    new FormatInfo('DEPTH_STENCIL', 5, 2, FormatType.FLOAT, false, true, true, false),\n\n    new FormatInfo('BC1', 1, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('BC1_ALPHA', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC1_SRGB', 1, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('BC1_SRGB_ALPHA', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC2', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC2_SRGB', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC3', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC3_SRGB', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC4', 1, 1, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('BC4_SNORM', 1, 1, FormatType.SNORM, false, false, false, true),\n    new FormatInfo('BC5', 1, 2, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('BC5_SNORM', 1, 2, FormatType.SNORM, false, false, false, true),\n    new FormatInfo('BC6H_UF16', 1, 3, FormatType.UFLOAT, false, false, false, true),\n    new FormatInfo('BC6H_SF16', 1, 3, FormatType.FLOAT, false, false, false, true),\n    new FormatInfo('BC7', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('BC7_SRGB', 1, 4, FormatType.UNORM, true, false, false, true),\n\n    new FormatInfo('ETC_RGB8', 1, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('ETC2_RGB8', 1, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('ETC2_SRGB8', 1, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('ETC2_RGB8_A1', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ETC2_SRGB8_A1', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ETC2_RGBA8', 2, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ETC2_SRGB8_A8', 2, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('EAC_R11', 1, 1, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('EAC_R11SN', 1, 1, FormatType.SNORM, false, false, false, true),\n    new FormatInfo('EAC_RG11', 2, 2, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('EAC_RG11SN', 2, 2, FormatType.SNORM, false, false, false, true),\n\n    new FormatInfo('PVRTC_RGB2', 2, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('PVRTC_RGBA2', 2, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('PVRTC_RGB4', 2, 3, FormatType.UNORM, false, false, false, true),\n    new FormatInfo('PVRTC_RGBA4', 2, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('PVRTC2_2BPP', 2, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('PVRTC2_4BPP', 2, 4, FormatType.UNORM, true, false, false, true),\n\n    new FormatInfo('ASTC_RGBA_4x4', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_5x4', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_5x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_6x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_6x6', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_8x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_8x6', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_8x8', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_10x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_10x6', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_10x8', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_10x10', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_12x10', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_RGBA_12x12', 1, 4, FormatType.UNORM, true, false, false, true),\n\n    new FormatInfo('ASTC_SRGBA_4x4', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_5x4', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_5x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_6x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_6x6', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_8x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_8x6', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_8x8', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_10x5', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_10x6', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_10x8', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_10x10', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_12x10', 1, 4, FormatType.UNORM, true, false, false, true),\n    new FormatInfo('ASTC_SRGBA_12x12', 1, 4, FormatType.UNORM, true, false, false, true),\n]);\n\nexport const DESCRIPTOR_BUFFER_TYPE = DescriptorType.UNIFORM_BUFFER | DescriptorType.DYNAMIC_UNIFORM_BUFFER\n    | DescriptorType.STORAGE_BUFFER | DescriptorType.DYNAMIC_STORAGE_BUFFER;\n\nexport const DESCRIPTOR_SAMPLER_TYPE = DescriptorType.SAMPLER_TEXTURE | DescriptorType.SAMPLER | DescriptorType.TEXTURE\n    | DescriptorType.STORAGE_IMAGE | DescriptorType.INPUT_ATTACHMENT;\n\nexport const DESCRIPTOR_DYNAMIC_TYPE = DescriptorType.DYNAMIC_STORAGE_BUFFER | DescriptorType.DYNAMIC_UNIFORM_BUFFER;\n\nexport const DRAW_INFO_SIZE = 28;\n\nexport type BufferSource = ArrayBuffer | IndirectBuffer;\n\nexport function IsPowerOf2 (x: number): boolean {\n    return x > 0 && (x & (x - 1)) === 0;\n}\n\n/**\n  * @en Get memory size of the specified fomat.\n  * @zh 获取指定格式对应的内存大小。\n  * @param format The target format.\n  * @param width The target width.\n  * @param height The target height.\n  * @param depth The target depth.\n  */\nexport function FormatSize (format: Format, width: number, height: number, depth: number): number {\n    if (!FormatInfos[format].isCompressed) {\n        return (width * height * depth * FormatInfos[format].size);\n    } else {\n        switch (format) {\n            case Format.BC1:\n            case Format.BC1_ALPHA:\n            case Format.BC1_SRGB:\n            case Format.BC1_SRGB_ALPHA:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 8 * depth;\n            case Format.BC2:\n            case Format.BC2_SRGB:\n            case Format.BC3:\n            case Format.BC3_SRGB:\n            case Format.BC4:\n            case Format.BC4_SNORM:\n            case Format.BC6H_SF16:\n            case Format.BC6H_UF16:\n            case Format.BC7:\n            case Format.BC7_SRGB:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 16 * depth;\n            case Format.BC5:\n            case Format.BC5_SNORM:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 32 * depth;\n\n            case Format.ETC_RGB8:\n            case Format.ETC2_RGB8:\n            case Format.ETC2_SRGB8:\n            case Format.ETC2_RGB8_A1:\n            case Format.EAC_R11:\n            case Format.EAC_R11SN:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 8 * depth;\n            case Format.ETC2_RGBA8:\n            case Format.ETC2_SRGB8_A1:\n            case Format.EAC_RG11:\n            case Format.EAC_RG11SN:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 16 * depth;\n\n            case Format.PVRTC_RGB2:\n            case Format.PVRTC_RGBA2:\n            case Format.PVRTC2_2BPP:\n                return Math.ceil(width / 8) * Math.ceil(height / 4) * 8 * depth;\n\n            case Format.PVRTC_RGB4:\n            case Format.PVRTC_RGBA4:\n            case Format.PVRTC2_4BPP:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 8 * depth;\n\n            case Format.ASTC_RGBA_4X4:\n            case Format.ASTC_SRGBA_4X4:\n                return Math.ceil(width / 4) * Math.ceil(height / 4) * 16 * depth;\n            case Format.ASTC_RGBA_5X4:\n            case Format.ASTC_SRGBA_5X4:\n                return Math.ceil(width / 5) * Math.ceil(height / 4) * 16 * depth;\n            case Format.ASTC_RGBA_5X5:\n            case Format.ASTC_SRGBA_5X5:\n                return Math.ceil(width / 5) * Math.ceil(height / 5) * 16 * depth;\n            case Format.ASTC_RGBA_6X5:\n            case Format.ASTC_SRGBA_6X5:\n                return Math.ceil(width / 6) * Math.ceil(height / 5) * 16 * depth;\n            case Format.ASTC_RGBA_6X6:\n            case Format.ASTC_SRGBA_6X6:\n                return Math.ceil(width / 6) * Math.ceil(height / 6) * 16 * depth;\n            case Format.ASTC_RGBA_8X5:\n            case Format.ASTC_SRGBA_8X5:\n                return Math.ceil(width / 8) * Math.ceil(height / 5) * 16 * depth;\n            case Format.ASTC_RGBA_8X6:\n            case Format.ASTC_SRGBA_8X6:\n                return Math.ceil(width / 8) * Math.ceil(height / 6) * 16 * depth;\n            case Format.ASTC_RGBA_8X8:\n            case Format.ASTC_SRGBA_8X8:\n                return Math.ceil(width / 8) * Math.ceil(height / 8) * 16 * depth;\n            case Format.ASTC_RGBA_10X5:\n            case Format.ASTC_SRGBA_10X5:\n                return Math.ceil(width / 10) * Math.ceil(height / 5) * 16 * depth;\n            case Format.ASTC_RGBA_10X6:\n            case Format.ASTC_SRGBA_10X6:\n                return Math.ceil(width / 10) * Math.ceil(height / 6) * 16 * depth;\n            case Format.ASTC_RGBA_10X8:\n            case Format.ASTC_SRGBA_10X8:\n                return Math.ceil(width / 10) * Math.ceil(height / 8) * 16 * depth;\n            case Format.ASTC_RGBA_10X10:\n            case Format.ASTC_SRGBA_10X10:\n                return Math.ceil(width / 10) * Math.ceil(height / 10) * 16 * depth;\n            case Format.ASTC_RGBA_12X10:\n            case Format.ASTC_SRGBA_12X10:\n                return Math.ceil(width / 12) * Math.ceil(height / 10) * 16 * depth;\n            case Format.ASTC_RGBA_12X12:\n            case Format.ASTC_SRGBA_12X12:\n                return Math.ceil(width / 12) * Math.ceil(height / 12) * 16 * depth;\n\n            default: {\n                return 0;\n            }\n        }\n    }\n}\n\n/**\n  * @en Get memory size of the specified surface.\n  * @zh GFX 格式表面内存大小。\n  * @param format The target format.\n  * @param width The target width.\n  * @param height The target height.\n  * @param depth The target depth.\n  * @param mips The target mip levels.\n  */\nexport function FormatSurfaceSize (\n    format: Format, width: number, height: number,\n    depth: number, mips: number,\n): number {\n    let size = 0;\n\n    for (let i = 0; i < mips; ++i) {\n        size += FormatSize(format, width, height, depth);\n        width = Math.max(width >> 1, 1);\n        height = Math.max(height >> 1, 1);\n    }\n\n    return size;\n}\n\nconst _type2size = [\n    0,  // UNKNOWN\n    4,  // BOOL\n    8,  // BOOL2\n    12, // BOOL3\n    16, // BOOL4\n    4,  // INT\n    8,  // INT2\n    12, // INT3\n    16, // INT4\n    4,  // UINT\n    8,  // UINT2\n    12, // UINT3\n    16, // UINT4\n    4,  // FLOAT\n    8,  // FLOAT2\n    12, // FLOAT3\n    16, // FLOAT4\n    16, // MAT2\n    24, // MAT2X3\n    32, // MAT2X4\n    24, // MAT3X2\n    36, // MAT3\n    48, // MAT3X4\n    32, // MAT4X2\n    48, // MAT4X3\n    64, // MAT4\n    4,  // SAMPLER1D\n    4,  // SAMPLER1D_ARRAY\n    4,  // SAMPLER2D\n    4,  // SAMPLER2D_ARRAY\n    4,  // SAMPLER3D\n    4,  // SAMPLER_CUBE\n];\n\n/**\n  * @en Get the memory size of the specified type.\n  * @zh 得到 GFX 数据类型的大小。\n  * @param type The target type.\n  */\nexport function GetTypeSize (type: Type): number {\n    return _type2size[type] || 0;\n}\n\nexport function getTypedArrayConstructor (info: FormatInfo): TypedArrayConstructor {\n    if (info.isCompressed) {\n        return Uint8Array;\n    }\n    const stride = info.size / info.count;\n    switch (info.type) {\n        case FormatType.UNORM:\n        case FormatType.UINT: {\n            switch (stride) {\n                case 1: return Uint8Array;\n                case 2: return Uint16Array;\n                case 4: return Uint32Array;\n                default:\n                    return Uint8Array;\n            }\n        }\n        case FormatType.SNORM:\n        case FormatType.INT: {\n            switch (stride) {\n                case 1: return Int8Array;\n                case 2: return Int16Array;\n                case 4: return Int32Array;\n                default:\n                    return Int8Array;\n            }\n        }\n        case FormatType.FLOAT: {\n            return Float32Array;\n        }\n        default:\n    }\n    return Float32Array;\n}\n\nexport interface FormatAlignment {\n    width: number,  // default 1\n    height: number, // default 1\n}\n\nexport function formatAlignment (format: Format): FormatAlignment {\n    switch (format) {\n        case Format.BC1:\n        case Format.BC1_ALPHA:\n        case Format.BC1_SRGB:\n        case Format.BC1_SRGB_ALPHA:\n        case Format.BC2:\n        case Format.BC2_SRGB:\n        case Format.BC3:\n        case Format.BC3_SRGB:\n        case Format.BC4:\n        case Format.BC4_SNORM:\n        case Format.BC6H_SF16:\n        case Format.BC6H_UF16:\n        case Format.BC7:\n        case Format.BC7_SRGB:\n        case Format.BC5:\n        case Format.BC5_SNORM:\n        case Format.ETC_RGB8:\n        case Format.ETC2_RGB8:\n        case Format.ETC2_SRGB8:\n        case Format.ETC2_RGB8_A1:\n        case Format.EAC_R11:\n        case Format.EAC_R11SN:\n        case Format.ETC2_RGBA8:\n        case Format.ETC2_SRGB8_A1:\n        case Format.EAC_RG11:\n        case Format.EAC_RG11SN:\n            return { width: 4, height: 4 };\n\n        case Format.PVRTC_RGB2:\n        case Format.PVRTC_RGBA2:\n        case Format.PVRTC2_2BPP:\n            return { width: 8, height: 4 };\n\n        case Format.PVRTC_RGB4:\n        case Format.PVRTC_RGBA4:\n        case Format.PVRTC2_4BPP:\n            return { width: 4, height: 4 };\n\n        case Format.ASTC_RGBA_4X4:\n        case Format.ASTC_SRGBA_4X4:\n            return { width: 4, height: 4 };\n        case Format.ASTC_RGBA_5X4:\n        case Format.ASTC_SRGBA_5X4:\n            return { width: 5, height: 4 };\n        case Format.ASTC_RGBA_5X5:\n        case Format.ASTC_SRGBA_5X5:\n            return { width: 5, height: 5 };\n        case Format.ASTC_RGBA_6X5:\n        case Format.ASTC_SRGBA_6X5:\n            return { width: 6, height: 5 };\n        case Format.ASTC_RGBA_6X6:\n        case Format.ASTC_SRGBA_6X6:\n            return { width: 6, height: 6 };\n        case Format.ASTC_RGBA_8X5:\n        case Format.ASTC_SRGBA_8X5:\n            return { width: 8, height: 5 };\n        case Format.ASTC_RGBA_8X6:\n        case Format.ASTC_SRGBA_8X6:\n            return { width: 8, height: 6 };\n        case Format.ASTC_RGBA_8X8:\n        case Format.ASTC_SRGBA_8X8:\n            return { width: 8, height: 8 };\n        case Format.ASTC_RGBA_10X5:\n        case Format.ASTC_SRGBA_10X5:\n            return { width: 10, height: 5 };\n        case Format.ASTC_RGBA_10X6:\n        case Format.ASTC_SRGBA_10X6:\n            return { width: 10, height: 6 };\n        case Format.ASTC_RGBA_10X8:\n        case Format.ASTC_SRGBA_10X8:\n            return { width: 10, height: 8 };\n        case Format.ASTC_RGBA_10X10:\n        case Format.ASTC_SRGBA_10X10:\n            return { width: 10, height: 10 };\n        case Format.ASTC_RGBA_12X10:\n        case Format.ASTC_SRGBA_12X10:\n            return { width: 12, height: 10 };\n        case Format.ASTC_RGBA_12X12:\n        case Format.ASTC_SRGBA_12X12:\n            return { width: 12, height: 12 };\n        default:\n            return { width: 1, height: 1 };\n    }\n}\n\nexport function alignTo (size: number, alignment: number): number {\n    return Math.ceil(size / alignment) * alignment;\n}\n","import { JSB } from 'internal:constants';\r\nimport { ValueType } from '../value-types/value-type';\r\nimport { FloatArray } from './type-define';\r\n\r\nexport const MATH_FLOAT_ARRAY = JSB ? Float32Array : Float64Array;\r\n\r\nexport class MathBase extends ValueType {\r\n    public static createFloatArray (size: number) {\r\n        return new MATH_FLOAT_ARRAY(size);\r\n    }\r\n\r\n    /**\r\n     * @en Get the internal array data.\r\n     * @zh 获取内部 array 数据。\r\n     */\r\n    public get array (): FloatArray  {\r\n        return this._array;\r\n    }\r\n\r\n    protected declare _array: FloatArray;\r\n}\r\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n https://www.cocos.com/\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { EDITOR } from 'internal:constants';\nimport { GCObject } from './gc-object';\n\ndeclare class FinalizationRegistry {\n    constructor (callback: (heldObj: any) => void);\n    register (obj: any, heldObj: any, token?: any);\n    unregister (token: any);\n}\n\nconst targetSymbol = Symbol('[[target]]');\n\nclass GarbageCollectionManager {\n    private _finalizationRegistry: FinalizationRegistry | null = EDITOR && typeof FinalizationRegistry !== 'undefined' ? new FinalizationRegistry(this.finalizationRegistryCallback.bind(this)) : null;\n    private _gcObjects: WeakMap<any, GCObject> = new WeakMap();\n\n    public registerGCObject (gcObject: GCObject): GCObject {\n        if (EDITOR && this._finalizationRegistry) {\n            const token = {};\n            const proxy = new Proxy(gcObject, {\n                get (target, property, receiver) {\n                    if (property === targetSymbol) {\n                        return target;\n                    }\n                    let val = Reflect.get(target, property);\n                    if (typeof val === 'function' && property !== 'constructor') {\n                        const original = val;\n                        val = function newFunc () {\n                            // @ts-expect-error this is referenced to proxy\n                            return original.apply(this[targetSymbol], arguments) as unknown;\n                        };\n                    }\n                    return val as unknown;\n                },\n                set (target, prop, value, receiver) {\n                    target[prop] = value;\n                    return true;\n                },\n            });\n            this._gcObjects.set(token, gcObject);\n            this._finalizationRegistry.register(proxy, token, token);\n            return proxy;\n        } else {\n            return gcObject;\n        }\n    }\n\n    public init () {\n    }\n\n    private finalizationRegistryCallback (token: any) {\n        const gcObject = this._gcObjects.get(token);\n        if (gcObject) {\n            this._gcObjects.delete(token);\n            gcObject.destroy();\n        }\n        this._finalizationRegistry!.unregister(token);\n    }\n\n    public destroy () {\n    }\n}\n\nconst garbageCollectionManager = new GarbageCollectionManager();\nexport { garbageCollectionManager };\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n http://www.cocos.com\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\nimport { garbageCollectionManager } from './garbage-collection';\n\nexport class GCObject {\n    constructor () {\n        return garbageCollectionManager.registerGCObject(this);\n    }\n\n    public destroy () {}\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport {\n    BufferFlagBit,\n    BufferFlags,\n    BufferUsage,\n    BufferUsageBit,\n    MemoryUsage,\n    MemoryUsageBit,\n    GFXObject,\n    ObjectType,\n    BufferInfo,\n    BufferViewInfo,\n    BufferSource,\n} from './define';\n\n/**\n * @en GFX buffer.\n * @zh GFX 缓冲。\n */\nexport abstract class Buffer extends GFXObject {\n    /**\n     * @en Usage type of the buffer.\n     * @zh 缓冲使用方式。\n     */\n    get usage (): BufferUsage {\n        return this._usage;\n    }\n\n    /**\n     * @en Memory usage of the buffer.\n     * @zh 缓冲的内存使用方式。\n     */\n    get memUsage (): MemoryUsage {\n        return this._memUsage;\n    }\n\n    /**\n     * @en Size of the buffer.\n     * @zh 缓冲大小。\n     */\n    get size (): number {\n        return this._size;\n    }\n\n    /**\n     * @en Stride of the buffer.\n     * @zh 缓冲步长。\n     */\n    get stride (): number {\n        return this._stride;\n    }\n\n    /**\n     * @en Count of the buffer wrt. stride.\n     * @zh 缓冲条目数量。\n     */\n    get count (): number {\n        return this._count;\n    }\n\n    get flags (): BufferFlags {\n        return this._flags;\n    }\n\n    protected _usage: BufferUsage = BufferUsageBit.NONE;\n    protected _memUsage: MemoryUsage = MemoryUsageBit.NONE;\n    protected _size = 0;\n    protected _stride = 1;\n    protected _count = 0;\n    protected _flags: BufferFlags = BufferFlagBit.NONE;\n    protected _isBufferView = false;\n\n    constructor () {\n        super(ObjectType.BUFFER);\n    }\n\n    public abstract initialize (info: Readonly<BufferInfo> | Readonly<BufferViewInfo>): void;\n\n    public abstract destroy (): void;\n\n    /**\n     * @en Resize the buffer.\n     * @zh 重置缓冲大小。\n     * @param size The new buffer size.\n     */\n    public abstract resize (size: number): void;\n\n    /**\n     * @en Update the buffer data.\n     * @zh 更新缓冲内容。\n     * @param buffer The new buffer data.\n     * @param size Size in bytes to be updated.\n     */\n    public abstract update (buffer: Readonly<BufferSource>, size?: number): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Buffer } from './buffer';\nimport { DescriptorSet } from './descriptor-set';\nimport { Framebuffer } from './framebuffer';\nimport { InputAssembler } from './input-assembler';\nimport { PipelineState } from './pipeline-state';\nimport { Queue } from './queue';\nimport { RenderPass } from './render-pass';\nimport { Texture } from './texture';\nimport {\n    GFXObject,\n    ObjectType,\n    StencilFace,\n    CommandBufferType,\n    CommandBufferInfo,\n    BufferTextureCopy, Color, Rect, Viewport, DrawInfo,\n} from './define';\nimport { GeneralBarrier } from './states/general-barrier';\nimport { TextureBarrier } from './states/texture-barrier';\nimport { BufferBarrier } from './states/buffer-barrier';\n\n/**\n * @en GFX command buffer.\n * @zh GFX 命令缓冲。\n */\n\nexport abstract class CommandBuffer extends GFXObject {\n    /**\n     * @en Type of the command buffer.\n     * @zh 命令缓冲类型。\n     */\n    get type (): CommandBufferType {\n        return this._type;\n    }\n\n    /**\n     * @en Type of the command buffer.\n     * @zh 命令缓冲类型。\n     */\n    get queue (): Queue {\n        return this._queue!;\n    }\n\n    /**\n     * @en Number of draw calls currently recorded.\n     * @zh 绘制调用次数。\n     */\n    get numDrawCalls (): number {\n        return this._numDrawCalls;\n    }\n\n    /**\n     * @en Number of instances currently recorded.\n     * @zh 绘制 Instance 数量。\n     */\n    get numInstances (): number {\n        return this._numInstances;\n    }\n\n    /**\n     * @en Number of triangles currently recorded.\n     * @zh 绘制三角形数量。\n     */\n    get numTris (): number {\n        return this._numTris;\n    }\n\n    protected _queue: Queue | null = null;\n    protected _type: CommandBufferType = CommandBufferType.PRIMARY;\n    protected _numDrawCalls = 0;\n    protected _numInstances = 0;\n    protected _numTris = 0;\n\n    constructor () {\n        super(ObjectType.COMMAND_BUFFER);\n    }\n\n    public abstract initialize (info: Readonly<CommandBufferInfo>): void;\n\n    public abstract destroy (): void;\n\n    /**\n     * @en Begin recording commands.\n     * @zh 开始记录命令。\n     * @param renderPass [Secondary Command Buffer Only] The render pass the subsequent commands will be executed in\n     * @param subpass [Secondary Command Buffer Only] The subpass the subsequent commands will be executed in\n     * @param frameBuffer [Secondary Command Buffer Only, Optional] The framebuffer to be used in the subpass\n     */\n    public abstract begin (renderPass?: RenderPass, subpass?: number, frameBuffer?: Framebuffer): void;\n\n    /**\n     * @en End recording commands.\n     * @zh 结束记录命令。\n     */\n    public abstract end (): void;\n\n    /**\n     * @en Begin render pass.\n     * @zh 开始 RenderPass。\n     * @param framebuffer The frame buffer used.\n     * @param renderArea The target render area.\n     * @param clearFlag The clear flags.\n     * @param clearColors The clearing colors.\n     * @param clearDepth The clearing depth.\n     * @param clearStencil The clearing stencil.\n     */\n    public abstract beginRenderPass (renderPass: RenderPass, framebuffer: Framebuffer,\n        renderArea: Readonly<Rect>, clearColors: Readonly<Color[]>, clearDepth: number, clearStencil: number): void;\n\n    /**\n     * @en End render pass.\n     * @zh 结束 RenderPass。\n     */\n    public abstract endRenderPass (): void;\n\n    /**\n     * @en Bind pipeline state.\n     * @zh 绑定 GFX 管线状态。\n     * @param pipelineState The pipeline state to be bound.\n     */\n    public abstract bindPipelineState (pipelineState: PipelineState): void;\n\n    /**\n     * @en Bind a descriptor set. Note that the corresponding PiplieneState has to be bound first\n     * before calling this function, or the dynamic offset specified may be invalidated.\n     * @zh 绑定 GFX 描述符集。注意在调用此函数前，必须先绑定对应的 PipelineState，否则 dynamic offset 可能无效。\n     * @param set The target descriptor set index.\n     * @param descriptorSet The descriptor set to be bound.\n     * @param dynamicOffsets The offset numbers for dynamic bindings.\n     */\n    public abstract bindDescriptorSet (set: number, descriptorSet: DescriptorSet, dynamicOffsets?: Readonly<number[]>): void;\n\n    /**\n     * @en Bind input assembler.\n     * @zh 绑定 GFX 输入汇集器。\n     * @param inputAssembler The input assembler to be bound.\n     */\n    public abstract bindInputAssembler (inputAssembler: InputAssembler): void;\n\n    /**\n     * @en Set viewport.\n     * @zh 设置视口。\n     * @param viewport The new viewport.\n     */\n    public abstract setViewport (viewport: Readonly<Viewport>): void;\n\n    /**\n     * @en Set scissor range.\n     * @zh 设置剪裁区域。\n     * @param scissor The new scissor range.\n     */\n    public abstract setScissor (scissor: Readonly<Rect>): void;\n\n    /**\n     * @en Set line width.\n     * @zh 设置线宽。\n     * @param lineWidth The new line width.\n     */\n    public abstract setLineWidth (lineWidth: number): void;\n\n    /**\n     * @en Set depth bias.\n     * @zh 设置深度偏移。\n     * @param depthBiasConstantFactor The new depth bias factor.\n     * @param depthBiasClamp The new depth bias clamp threshold.\n     * @param depthBiasSlopeFactor  The new depth bias slope factor.\n     */\n    public abstract setDepthBias (depthBiasConstantFactor: number, depthBiasClamp: number, depthBiasSlopeFactor: number): void;\n\n    /**\n     * @en Set blend constants.\n     * @zh 设置混合因子。\n     * @param blendConstants The new blend constants.\n     */\n    public abstract setBlendConstants (blendConstants: Readonly<Color>): void;\n\n    /**\n     * @en Set depth bound.\n     * @zh 设置深度边界。\n     * @param minDepthBounds The new minimum depth bound.\n     * @param maxDepthBounds The new maximum depth bound.\n     */\n    public abstract setDepthBound (minDepthBounds: number, maxDepthBounds: number): void;\n\n    /**\n     * @en Set stencil write mask.\n     * @zh 设置模板写掩码。\n     * @param face The effective triangle face.\n     * @param writeMask The new stencil write mask.\n     */\n    public abstract setStencilWriteMask (face: StencilFace, writeMask: number): void;\n\n    /**\n     * @en Set stencil compare mask.\n     * @zh 设置模板比较掩码。\n     * @param face The effective triangle face.\n     * @param reference The new stencil reference constant.\n     * @param compareMask The new stencil read mask.\n     */\n    public abstract setStencilCompareMask (face: StencilFace, reference: number, compareMask: number): void;\n\n    /**\n     * @en Draw the specified primitives.\n     * @zh 绘制。\n     * @param infoOrAssembler The draw call information.\n     */\n    public abstract draw (infoOrAssembler: Readonly<DrawInfo> | Readonly<InputAssembler>): void;\n\n    /**\n     * @en Update buffer.\n     * @zh 更新缓冲。\n     * @param buffer The buffer to be updated.\n     * @param data The source data.\n     * @param size Size in bytes to be updated.\n     */\n    public abstract updateBuffer (buffer: Buffer, data: Readonly<ArrayBuffer>, size?: number): void;\n\n    /**\n     * @en Copy buffer to texture.\n     * @zh 拷贝缓冲到纹理。\n     * @param srcBuff The buffer to be copied.\n     * @param dstTex The texture to copy to.\n     * @param dstLayout The target texture layout.\n     * @param regions The region descriptions.\n     */\n    public abstract copyBuffersToTexture (buffers: Readonly<ArrayBufferView[]>, texture: Texture, regions: Readonly<BufferTextureCopy[]>): void;\n\n    /**\n     * @en Execute specified command buffers.\n     * @zh 执行一组命令缓冲。\n     * @param cmdBuffs The command buffers to be executed.\n     * @param count The number of command buffers to be executed.\n     */\n    public abstract execute (cmdBuffs: Readonly<CommandBuffer[]>, count: number): void;\n\n    /**\n     * @en Insert pipeline memory barriers.\n     * @zh 插入管线内存屏障。\n     * @param barrier The global memory barrier to apply.\n     * @param textureBarriers The texture memory barriers to apply.\n     */\n    public abstract pipelineBarrier (barrier: Readonly<GeneralBarrier> | null,\n        bufferBarriers?: Readonly<BufferBarrier[]>,\n        buffers?: Readonly<Buffer[]>,\n        textureBarriers?: Readonly<TextureBarrier[]>,\n        textures?: Readonly<Texture[]>): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport {\n    API, Feature, MemoryStatus,\n    CommandBufferInfo, BufferInfo, BufferViewInfo, TextureInfo, TextureViewInfo, SamplerInfo, DescriptorSetInfo,\n    ShaderInfo, InputAssemblerInfo, RenderPassInfo, FramebufferInfo, DescriptorSetLayoutInfo, PipelineLayoutInfo,\n    QueueInfo, BufferTextureCopy, DeviceInfo, DeviceCaps, GeneralBarrierInfo, TextureBarrierInfo, BufferBarrierInfo,\n    SwapchainInfo, BindingMappingInfo, Format, FormatFeature,\n} from './define';\nimport { Buffer } from './buffer';\nimport { CommandBuffer } from './command-buffer';\nimport { DescriptorSet } from './descriptor-set';\nimport { DescriptorSetLayout } from './descriptor-set-layout';\nimport { PipelineLayout } from './pipeline-layout';\nimport { Framebuffer } from './framebuffer';\nimport { InputAssembler } from './input-assembler';\nimport { PipelineState, PipelineStateInfo } from './pipeline-state';\nimport { Queue } from './queue';\nimport { RenderPass } from './render-pass';\nimport { Sampler } from './states/sampler';\nimport { Shader } from './shader';\nimport { Texture } from './texture';\nimport { GeneralBarrier } from './states/general-barrier';\nimport { TextureBarrier } from './states/texture-barrier';\nimport { BufferBarrier } from './states/buffer-barrier';\nimport { Swapchain } from './swapchain';\n\n/**\n * @en GFX Device.\n * @zh GFX 设备。\n */\nexport abstract class Device {\n    /**\n     * @en Current rendering API.\n     * @zh 当前 GFX 使用的渲染 API。\n     */\n    get gfxAPI (): API {\n        return this._gfxAPI;\n    }\n\n    /**\n     * @en GFX default queue.\n     * @zh GFX 默认队列。\n     */\n    get queue (): Queue {\n        return this._queue as Queue;\n    }\n\n    /**\n     * @en GFX default command buffer.\n     * @zh GFX 默认命令缓冲。\n     */\n    get commandBuffer (): CommandBuffer {\n        return this._cmdBuff as CommandBuffer;\n    }\n\n    /**\n     * @en Renderer description.\n     * @zh 渲染器描述。\n     */\n    get renderer (): string {\n        return this._renderer;\n    }\n\n    /**\n     * @en Vendor description.\n     * @zh 厂商描述。\n     */\n    get vendor (): string {\n        return this._vendor;\n    }\n\n    /**\n     * @en Number of draw calls currently recorded.\n     * @zh 绘制调用次数。\n     */\n    get numDrawCalls (): number {\n        return this._numDrawCalls;\n    }\n\n    /**\n     * @en Number of instances currently recorded.\n     * @zh 绘制 Instance 数量。\n     */\n    get numInstances (): number {\n        return this._numInstances;\n    }\n\n    /**\n     * @en Number of triangles currently recorded.\n     * @zh 渲染三角形数量。\n     */\n    get numTris (): number {\n        return this._numTris;\n    }\n\n    /**\n     * @en Total memory size currently allocated.\n     * @zh 内存状态。\n     */\n    get memoryStatus (): MemoryStatus {\n        return this._memoryStatus;\n    }\n\n    /**\n     * @en Current device capabilities.\n     * @zh 当前设备能力数据。\n     */\n    get capabilities (): DeviceCaps {\n        return this._caps;\n    }\n\n    /**\n     * @en Current device binding mappings.\n     * @zh 当前设备的绑定槽位映射关系。\n     */\n    get bindingMappingInfo () {\n        return this._bindingMappingInfo;\n    }\n\n    protected _gfxAPI = API.UNKNOWN;\n    protected _renderer = '';\n    protected _vendor = '';\n    protected _features = new Array<boolean>(Feature.COUNT);\n    protected _formatFeatures = new Array<FormatFeature>(Format.COUNT);\n    protected _queue: Queue | null = null;\n    protected _cmdBuff: CommandBuffer | null = null;\n    protected _numDrawCalls = 0;\n    protected _numInstances = 0;\n    protected _numTris = 0;\n    protected _memoryStatus = new MemoryStatus();\n    protected _caps = new DeviceCaps();\n    protected _bindingMappingInfo: BindingMappingInfo = new BindingMappingInfo();\n    protected _samplers = new Map<number, Sampler>();\n    protected _generalBarrierss = new Map<number, GeneralBarrier>();\n    protected _textureBarriers = new Map<number, TextureBarrier>();\n    protected _bufferBarriers = new Map<number, BufferBarrier>();\n\n    public static canvas: HTMLCanvasElement; // Hack for WebGL device initialization process\n\n    public abstract initialize (info: Readonly<DeviceInfo>): boolean;\n\n    public abstract destroy (): void;\n\n    /**\n     * @en Acquire next swapchain image.\n     * @zh 获取下一个交换链缓冲。\n     */\n    public abstract acquire (swapchains: Readonly<Swapchain[]>): void;\n\n    /**\n     * @en Present current swapchain image.\n     * @zh 上屏当前交换链缓冲。\n     */\n    public abstract present (): void;\n\n    /**\n     * @en Flush the specified command buffers.\n     * @zh 实际录制指定的命令缓冲。\n     */\n    public abstract flushCommands (cmdBuffs: Readonly<CommandBuffer[]>): void;\n\n    /**\n     * @en Create command buffer.\n     * @zh 创建命令缓冲。\n     * @param info GFX command buffer description info.\n     */\n    public abstract createCommandBuffer (info: Readonly<CommandBufferInfo>): CommandBuffer;\n\n    /**\n     * @en Create swapchain.\n     * @zh 创建交换链。\n     * @param info GFX swapchain description info.\n     */\n    public abstract createSwapchain (info: Readonly<SwapchainInfo>): Swapchain;\n\n    /**\n     * @en Create buffer.\n     * @zh 创建缓冲。\n     * @param info GFX buffer description info.\n     */\n    public abstract createBuffer (info: Readonly<BufferInfo> | BufferViewInfo): Buffer;\n\n    /**\n     * @en Create texture.\n     * @zh 创建纹理。\n     * @param info GFX texture description info.\n     */\n    public abstract createTexture (info: Readonly<TextureInfo> | TextureViewInfo): Texture;\n\n    /**\n     * @en Create descriptor sets.\n     * @zh 创建描述符集组。\n     * @param info GFX descriptor sets description info.\n     */\n    public abstract createDescriptorSet (info: Readonly<DescriptorSetInfo>): DescriptorSet;\n\n    /**\n     * @en Create shader.\n     * @zh 创建着色器。\n     * @param info GFX shader description info.\n     */\n    public abstract createShader (info: Readonly<ShaderInfo>): Shader;\n\n    /**\n     * @en Create input assembler.\n     * @zh 创建纹理。\n     * @param info GFX input assembler description info.\n     */\n    public abstract createInputAssembler (info: Readonly<InputAssemblerInfo>): InputAssembler;\n\n    /**\n     * @en Create render pass.\n     * @zh 创建渲染过程。\n     * @param info GFX render pass description info.\n     */\n    public abstract createRenderPass (info: Readonly<RenderPassInfo>): RenderPass;\n\n    /**\n     * @en Create frame buffer.\n     * @zh 创建帧缓冲。\n     * @param info GFX frame buffer description info.\n     */\n    public abstract createFramebuffer (info: Readonly<FramebufferInfo>): Framebuffer;\n\n    /**\n     * @en Create descriptor set layout.\n     * @zh 创建描述符集布局。\n     * @param info GFX descriptor set layout description info.\n     */\n    public abstract createDescriptorSetLayout (info: Readonly<DescriptorSetLayoutInfo>): DescriptorSetLayout;\n\n    /**\n     * @en Create pipeline layout.\n     * @zh 创建管线布局。\n     * @param info GFX pipeline layout description info.\n     */\n    public abstract createPipelineLayout (info: Readonly<PipelineLayoutInfo>): PipelineLayout;\n\n    /**\n     * @en Create pipeline state.\n     * @zh 创建管线状态。\n     * @param info GFX pipeline state description info.\n     */\n    public abstract createPipelineState (info: Readonly<PipelineStateInfo>): PipelineState;\n\n    /**\n     * @en Create queue.\n     * @zh 创建队列。\n     * @param info GFX queue description info.\n     */\n    public abstract createQueue (info: Readonly<QueueInfo>): Queue;\n\n    /**\n     * @en Create sampler.\n     * @zh 创建采样器。\n     * @param info GFX sampler description info.\n     */\n    public abstract getSampler (info: Readonly<SamplerInfo>): Sampler;\n\n    /**\n     * @en Get swapchains.\n     * @zh 获取交换链列表。\n     */\n    public abstract getSwapchains (): Readonly<Swapchain[]>;\n\n    /**\n     * @en Create global barrier.\n     * @zh 创建全局内存屏障。\n     * @param info GFX global barrier description info.\n     */\n    public abstract getGeneralBarrier (info: Readonly<GeneralBarrierInfo>): GeneralBarrier;\n\n    /**\n     * @en Create texture barrier.\n     * @zh 创建贴图内存屏障。\n     * @param info GFX texture barrier description info.\n     */\n    public abstract getTextureBarrier (info: Readonly<TextureBarrierInfo>): TextureBarrier;\n\n    /**\n     * @en Create buffer barrier.\n     * @zh 创建buffer内存屏障。\n     * @param info GFX buffer barrier description info.\n     */\n    public abstract getBufferBarrier (info: Readonly<BufferBarrierInfo>): BufferBarrier;\n\n    /**\n     * @en Copy buffers to texture.\n     * @zh 拷贝缓冲到纹理。\n     * @param buffers The buffers to be copied.\n     * @param texture The texture to copy to.\n     * @param regions The region descriptions.\n     */\n    public abstract copyBuffersToTexture (buffers: Readonly<ArrayBufferView[]>, texture: Texture, regions: Readonly<BufferTextureCopy[]>): void;\n\n    /**\n     * @en Copy texture to buffers\n     * @zh 拷贝纹理到缓冲\n     * @param texture The texture to be copied.\n     * @param buffers The buffer to copy to.\n     * @param regions The region descriptions\n     */\n    public abstract copyTextureToBuffers (texture: Readonly<Texture>, buffers: ArrayBufferView[], regions: Readonly<BufferTextureCopy[]>): void;\n\n    /**\n     * @en Copy texture images to texture.\n     * @zh 拷贝图像到纹理。\n     * @param texImages The texture to be copied.\n     * @param texture The texture to copy to.\n     * @param regions The region descriptions.\n     */\n    public abstract copyTexImagesToTexture (texImages: Readonly<TexImageSource[]>, texture: Texture, regions: Readonly<BufferTextureCopy[]>): void;\n\n    /**\n     * @en Whether the device has specific feature.\n     * @zh 是否具备特性。\n     * @param feature The GFX feature to be queried.\n     */\n    public hasFeature (feature: Feature): boolean {\n        return this._features[feature];\n    }\n\n    /**\n     * @en The extent a specific format is supported by the backend.\n     * @zh 后端对特定格式的支持程度。\n     * @param format The GFX format to be queried.\n     */\n    public getFormatFeatures (format: Format): FormatFeature {\n        return this._formatFeatures[format];\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { GFXObject, ObjectType, SurfaceTransform, SwapchainInfo } from './define';\nimport { Texture } from './texture';\n\n/**\n * @en GFX Swapchain.\n * @zh GFX 交换链。\n */\nexport abstract class Swapchain extends GFXObject {\n    /**\n     * @en The color texture of this swapchain.\n     * @zh 当前交换链的颜色缓冲。\n     */\n    get colorTexture () {\n        return this._colorTexture;\n    }\n\n    /**\n     * @en The depth stencil texture of this swapchain.\n     * @zh 当前交换链的深度模板缓冲。\n     */\n    get depthStencilTexture () {\n        return this._depthStencilTexture;\n    }\n\n    /**\n     * @en The surface transform to be applied in projection matrices.\n     * @zh 需要在投影矩阵中应用的表面变换。\n     */\n    get surfaceTransform () {\n        return this._transform;\n    }\n\n    get width () {\n        return this._colorTexture.width;\n    }\n\n    get height () {\n        return this._colorTexture.height;\n    }\n\n    protected _transform = SurfaceTransform.IDENTITY;\n    protected _colorTexture: Texture = null!;\n    protected _depthStencilTexture: Texture = null!;\n\n    constructor () {\n        super(ObjectType.SWAPCHAIN);\n    }\n\n    public abstract initialize (info: Readonly<SwapchainInfo>): void;\n    public abstract resize (width: number, height: number, surfaceTransform: SurfaceTransform): void;\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { RenderPass } from './render-pass';\nimport { Texture } from './texture';\nimport { GFXObject, ObjectType, FramebufferInfo } from './define';\n\n/**\n * @en GFX frame buffer.\n * @zh GFX 帧缓冲。\n */\nexport abstract class Framebuffer extends GFXObject {\n    /**\n     * @en Get current render pass.\n     * @zh GFX 渲染过程。\n     */\n    public get renderPass (): RenderPass {\n        return this._renderPass!;\n    }\n\n    /**\n     * @en Get current color views.\n     * @zh 颜色纹理视图数组。\n     */\n    public get colorTextures (): (Texture | null)[] {\n        return this._colorTextures;\n    }\n\n    /**\n     * @en Get current depth stencil views.\n     * @zh 深度模板纹理视图。\n     */\n    public get depthStencilTexture (): Texture | null {\n        return this._depthStencilTexture;\n    }\n\n    protected _renderPass: RenderPass | null = null;\n    protected _colorTextures: (Texture | null)[] = [];\n    protected _depthStencilTexture: Texture | null = null;\n\n    constructor () {\n        super(ObjectType.FRAMEBUFFER);\n    }\n\n    public abstract initialize (info: Readonly<FramebufferInfo>): void;\n\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/*\n * JS Implementation of MurmurHash2\n *\n * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n * @see http://github.com/garycourt/murmurhash-js\n * @author <a href=\"mailto:aappleby@gmail.com\">Austin Appleby</a>\n * @see http://sites.google.com/site/murmurhash/\n *\n * @param {string} str ASCII only\n * @param {number} seed Positive integer only\n * @return {number} 32-bit positive integer hash\n */\n\nconst getUint8ForString = String.prototype.charCodeAt;\nfunction getUint8ForArray (this: Uint8Array, idx: number) { return this[idx]; }\n\nexport function murmurhash2_32_gc (input: string | Uint8Array, seed: number) {\n    let l = input.length;\n    let h = seed ^ l;\n    let i = 0;\n    const getUint8 = typeof input === 'string' ? getUint8ForString : getUint8ForArray;\n\n    while (l >= 4) {\n        let k =            ((getUint8.call(input, i) & 0xff))\n            | ((getUint8.call(input, ++i) & 0xff) << 8)\n            | ((getUint8.call(input, ++i) & 0xff) << 16)\n            | ((getUint8.call(input, ++i) & 0xff) << 24);\n\n        k = (((k & 0xffff) * 0x5bd1e995) + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n        k ^= k >>> 24;\n        k = (((k & 0xffff) * 0x5bd1e995) + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n\n        h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16)) ^ k;\n\n        l -= 4;\n        ++i;\n    }\n\n    switch (l) {\n    case 3: h ^= (getUint8.call(input, i + 2) & 0xff) << 16;\n    case 2: h ^= (getUint8.call(input, i + 1) & 0xff) << 8;\n    case 1: h ^= (getUint8.call(input, i) & 0xff);\n        h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n    }\n\n    h ^= h >>> 13;\n    h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n    h ^= h >>> 15;\n\n    return h >>> 0;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Buffer } from './buffer';\nimport { murmurhash2_32_gc } from '../../utils/murmurhash2_gc';\nimport { Attribute, GFXObject, ObjectType, InputAssemblerInfo, DrawInfo } from './define';\n\n/**\n * @en GFX input assembler.\n * @zh GFX 输入汇集器。\n */\nexport abstract class InputAssembler extends GFXObject {\n    /**\n     * @en Get current attributes.\n     * @zh 顶点属性数组。\n     */\n    get attributes (): Attribute[] {\n        return this._attributes;\n    }\n\n    /**\n     * @en Get current vertex buffers.\n     * @zh 顶点缓冲数组。\n     */\n    get vertexBuffers (): Buffer[] {\n        return this._vertexBuffers;\n    }\n\n    /**\n     * @en Get current index buffer.\n     * @zh 索引缓冲。\n     */\n    get indexBuffer (): Buffer | null {\n        return this._indexBuffer;\n    }\n\n    /**\n     * @en Get the indirect buffer, if present.\n     * @zh 间接绘制缓冲。\n     */\n    get indirectBuffer (): Buffer | null {\n        return this._indirectBuffer;\n    }\n\n    /**\n     * @en Get hash of current attributes.\n     * @zh 获取顶点属性数组的哈希值。\n     */\n    get attributesHash (): number {\n        return this._attributesHash;\n    }\n\n    /**\n     * @en Get current vertex count.\n     * @zh 顶点数量。\n     */\n    set vertexCount (count: number) {\n        this._drawInfo.vertexCount = count;\n    }\n    get vertexCount () {\n        return this._drawInfo.vertexCount;\n    }\n\n    /**\n     * @en Get starting vertex.\n     * @zh 起始顶点。\n     */\n    set firstVertex (first: number) {\n        this._drawInfo.firstVertex = first;\n    }\n    get firstVertex () {\n        return this._drawInfo.firstVertex;\n    }\n\n    /**\n     * @en Get current index count.\n     * @zh 索引数量。\n     */\n    set indexCount (count: number) {\n        this._drawInfo.indexCount = count;\n    }\n    get indexCount () {\n        return this._drawInfo.indexCount;\n    }\n\n    /**\n     * @en Get starting index.\n     * @zh 起始索引。\n     */\n    set firstIndex (first: number) {\n        this._drawInfo.firstIndex = first;\n    }\n    get firstIndex () {\n        return this._drawInfo.firstIndex;\n    }\n\n    /**\n     * @en Get current vertex offset.\n     * @zh 顶点偏移量。\n     */\n    set vertexOffset (offset: number) {\n        this._drawInfo.vertexOffset = offset;\n    }\n    get vertexOffset () {\n        return this._drawInfo.vertexOffset;\n    }\n\n    /**\n     * @en Get current instance count.\n     * @zh 实例数量。\n     */\n    set instanceCount (count: number) {\n        this._drawInfo.instanceCount = count;\n    }\n    get instanceCount () {\n        return this._drawInfo.instanceCount;\n    }\n\n    /**\n     * @en Get starting instance.\n     * @zh 起始实例。\n     */\n    set firstInstance (first: number) {\n        this._drawInfo.firstInstance = first;\n    }\n    get firstInstance () {\n        return this._drawInfo.firstInstance;\n    }\n\n    /**\n     * @en set the draw range\n     * @zh 设置渲染范围\n     */\n    set drawInfo (info: DrawInfo) {\n        this._drawInfo = info;\n    }\n\n    /**\n     * @en get the draw range\n     * @zh 获取渲染范围\n     */\n    get drawInfo (): DrawInfo {\n        return this._drawInfo;\n    }\n\n    protected _attributes: Attribute[] = [];\n    protected _attributesHash = 0;\n\n    protected _vertexBuffers: Buffer[] = [];\n    protected _indexBuffer: Buffer | null = null;\n    protected _indirectBuffer: Buffer | null = null;\n\n    protected _drawInfo = new DrawInfo();\n\n    constructor () {\n        super(ObjectType.INPUT_ASSEMBLER);\n    }\n\n    /**\n     * @en Get the specified vertex buffer.\n     * @zh 获取顶点缓冲。\n     * @param stream The stream index of the vertex buffer.\n     */\n    public getVertexBuffer (stream = 0): Buffer | null {\n        if (stream < this._vertexBuffers.length) {\n            return this._vertexBuffers[stream];\n        } else {\n            return null;\n        }\n    }\n\n    protected computeAttributesHash (): number {\n        let res = 'attrs';\n        for (let i = 0; i < this.attributes.length; ++i) {\n            const at = this.attributes[i];\n            res += `,${at.name},${at.format},${at.isNormalized},${at.stream},${at.isInstanced},${at.location}`;\n        }\n        return murmurhash2_32_gc(res, 666);\n    }\n\n    public abstract initialize (info: Readonly<InputAssemblerInfo>): void;\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Buffer } from './buffer';\nimport { DescriptorSetLayout } from './descriptor-set-layout';\nimport { Sampler } from './states/sampler';\nimport { Texture } from './texture';\nimport { GFXObject, ObjectType, DescriptorSetInfo, DESCRIPTOR_BUFFER_TYPE, DESCRIPTOR_SAMPLER_TYPE } from './define';\n\n/**\n * @en GFX descriptor sets.\n * @zh GFX 描述符集组。\n */\nexport abstract class DescriptorSet extends GFXObject {\n    get layout () {\n        return this._layout!;\n    }\n\n    protected _layout: DescriptorSetLayout | null = null;\n    protected _buffers: Buffer[] = [];\n    protected _textures: Texture[] = [];\n    protected _samplers: Sampler[] = [];\n\n    protected _isDirty = false;\n\n    constructor () {\n        super(ObjectType.DESCRIPTOR_SET);\n    }\n\n    public abstract initialize (info: Readonly<DescriptorSetInfo>): void;\n\n    public abstract destroy (): void;\n\n    public abstract update (): void;\n\n    /**\n     * @en Bind buffer to the specified descriptor.\n     * @zh 在指定的描述符位置上绑定缓冲。\n     * @param binding The target binding.\n     * @param buffer The buffer to be bound.\n     */\n    public bindBuffer (binding: number, buffer: Buffer, index = 0) {\n        const bindingIndex = this._layout!.bindingIndices[binding];\n        const info = this._layout!.bindings[bindingIndex]; if (!info) { return; }\n        if (info.descriptorType & DESCRIPTOR_BUFFER_TYPE) {\n            const descriptorIndex = this._layout!.descriptorIndices[binding];\n            if (this._buffers[descriptorIndex + index] !== buffer) {\n                this._buffers[descriptorIndex + index] = buffer;\n                this._isDirty = true;\n            }\n        }\n    }\n\n    /**\n     * @en Bind sampler to the specified descriptor.\n     * @zh 在指定的描述符位置上绑定采样器。\n     * @param binding The target binding.\n     * @param sampler The sampler to be bound.\n     */\n    public bindSampler (binding: number, sampler: Sampler, index = 0) {\n        const bindingIndex = this._layout!.bindingIndices[binding];\n        const info = this._layout!.bindings[bindingIndex]; if (!info) { return; }\n        if (info.descriptorType & DESCRIPTOR_SAMPLER_TYPE) {\n            const descriptorIndex = this._layout!.descriptorIndices[binding];\n            if (this._samplers[descriptorIndex + index] !== sampler) {\n                this._samplers[descriptorIndex + index] = sampler;\n                this._isDirty = true;\n            }\n        }\n    }\n\n    /**\n     * @en Bind texture to the specified descriptor.\n     * @zh 在指定的描述符位置上绑定纹理。\n     * @param binding The target binding.\n     * @param texture The texture to be bound.\n     */\n    public bindTexture (binding: number, texture: Texture, index = 0) {\n        const bindingIndex = this._layout!.bindingIndices[binding];\n        const info = this._layout!.bindings[bindingIndex]; if (!info) { return; }\n        if (info.descriptorType & DESCRIPTOR_SAMPLER_TYPE) {\n            const descriptorIndex = this._layout!.descriptorIndices[binding];\n            if (this._textures[descriptorIndex + index] !== texture) {\n                this._textures[descriptorIndex + index] = texture;\n                this._isDirty = true;\n            }\n        }\n    }\n\n    /**\n     * @en Get buffer from the specified binding location.\n     * @zh 获取当前指定绑定位置上的缓冲。\n     * @param binding The target binding.\n     */\n    public getBuffer (binding: number, index = 0) {\n        const descriptorIndex = this._layout!.descriptorIndices[binding];\n        return this._buffers[descriptorIndex + index];\n    }\n\n    /**\n     * @en Get sampler from the specified binding location.\n     * @zh 获取当前指定绑定位置上的采样器。\n     * @param binding The target binding.\n     */\n    public getSampler (binding: number, index = 0) {\n        const descriptorIndex = this._layout!.descriptorIndices[binding];\n        return this._samplers[descriptorIndex + index];\n    }\n\n    /**\n     * @en Get texture from the specified binding location.\n     * @zh 获取当前指定绑定位置上的贴图。\n     * @param binding The target binding.\n     */\n    public getTexture (binding: number, index = 0) {\n        const descriptorIndex = this._layout!.descriptorIndices[binding];\n        return this._textures[descriptorIndex + index];\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { GFXObject, ObjectType, DescriptorSetLayoutBinding, DescriptorSetLayoutInfo } from './define';\n\n/**\n * @en GFX descriptor sets layout.\n * @zh GFX 描述符集布局。\n */\nexport abstract class DescriptorSetLayout extends GFXObject {\n    get bindings () {\n        return this._bindings;\n    }\n\n    get bindingIndices () {\n        return this._bindingIndices;\n    }\n\n    get descriptorIndices () {\n        return this._descriptorIndices;\n    }\n\n    protected _bindings: DescriptorSetLayoutBinding[] = [];\n    protected _bindingIndices: number[] = [];\n    protected _descriptorIndices: number[] = [];\n\n    constructor () {\n        super(ObjectType.DESCRIPTOR_SET_LAYOUT);\n    }\n\n    public abstract initialize (info: Readonly<DescriptorSetLayoutInfo>): void;\n\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DescriptorSetLayout } from './descriptor-set-layout';\nimport { GFXObject, ObjectType, PipelineLayoutInfo } from './define';\n\n/**\n * @en GFX pipeline layout.\n * @zh GFX 管线布局。\n */\nexport abstract class PipelineLayout extends GFXObject {\n    get setLayouts () {\n        return this._setLayouts;\n    }\n\n    protected _setLayouts: DescriptorSetLayout[] = [];\n\n    constructor () {\n        super(ObjectType.PIPELINE_LAYOUT);\n    }\n\n    public abstract initialize (info: Readonly<PipelineLayoutInfo>): void;\n\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { PipelineLayout } from './pipeline-layout';\nimport { RenderPass } from './render-pass';\nimport { Shader } from './shader';\nimport {\n    BlendFactor,\n    BlendOp,\n    ColorMask,\n    ComparisonFunc,\n    CullMode,\n    DynamicStateFlagBit,\n    DynamicStateFlags,\n    GFXObject,\n    ObjectType,\n    PolygonMode,\n    PrimitiveMode,\n    ShadeModel,\n    StencilOp,\n    InputState,\n    Color,\n    PipelineBindPoint,\n} from './define';\n\n/**\n * @en GFX rasterizer state.\n * @zh GFX 光栅化状态。\n */\nexport class RasterizerState {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    get native () {\n        return this;\n    }\n\n    constructor (\n        public isDiscard: boolean = false,\n        public polygonMode: PolygonMode = PolygonMode.FILL,\n        public shadeModel: ShadeModel = ShadeModel.GOURAND,\n        public cullMode: CullMode = CullMode.BACK,\n        public isFrontFaceCCW: boolean = true,\n        public depthBiasEnabled: boolean = false,\n        public depthBias: number = 0,\n        public depthBiasClamp: number = 0.0,\n        public depthBiasSlop: number = 0.0,\n        public isDepthClip: boolean = true,\n        public isMultisample: boolean = false,\n        public lineWidth: number = 1.0,\n    ) {}\n\n    public reset () {\n        this.isDiscard = false;\n        this.polygonMode = PolygonMode.FILL;\n        this.shadeModel = ShadeModel.GOURAND;\n        this.cullMode = CullMode.BACK;\n        this.isFrontFaceCCW = true;\n        this.depthBiasEnabled = false;\n        this.depthBias = 0;\n        this.depthBiasClamp = 0.0;\n        this.depthBiasSlop = 0.0;\n        this.isDepthClip = true;\n        this.isMultisample = false;\n        this.lineWidth = 1.0;\n    }\n\n    public assign (rs: RasterizerState) {\n        Object.assign(this, rs);\n    }\n\n    public destroy () {}\n}\n\n/**\n * @en GFX depth stencil state.\n * @zh GFX 深度模板状态。\n */\nexport class DepthStencilState {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    get native () {\n        return this;\n    }\n    constructor (\n        public depthTest: boolean = true,\n        public depthWrite: boolean = true,\n        public depthFunc: ComparisonFunc = ComparisonFunc.LESS,\n        public stencilTestFront: boolean = false,\n        public stencilFuncFront: ComparisonFunc = ComparisonFunc.ALWAYS,\n        public stencilReadMaskFront: number = 0xffff,\n        public stencilWriteMaskFront: number = 0xffff,\n        public stencilFailOpFront: StencilOp = StencilOp.KEEP,\n        public stencilZFailOpFront: StencilOp = StencilOp.KEEP,\n        public stencilPassOpFront: StencilOp = StencilOp.KEEP,\n        public stencilRefFront: number = 1,\n        public stencilTestBack: boolean = false,\n        public stencilFuncBack: ComparisonFunc = ComparisonFunc.ALWAYS,\n        public stencilReadMaskBack: number = 0xffff,\n        public stencilWriteMaskBack: number = 0xffff,\n        public stencilFailOpBack: StencilOp = StencilOp.KEEP,\n        public stencilZFailOpBack: StencilOp = StencilOp.KEEP,\n        public stencilPassOpBack: StencilOp = StencilOp.KEEP,\n        public stencilRefBack: number = 1,\n    ) {}\n\n    public reset () {\n        this.depthTest = true;\n        this.depthWrite = true;\n        this.depthFunc = ComparisonFunc.LESS;\n        this.stencilTestFront = false;\n        this.stencilFuncFront = ComparisonFunc.ALWAYS;\n        this.stencilReadMaskFront = 0xffff;\n        this.stencilWriteMaskFront = 0xffff;\n        this.stencilFailOpFront = StencilOp.KEEP;\n        this.stencilZFailOpFront = StencilOp.KEEP;\n        this.stencilPassOpFront = StencilOp.KEEP;\n        this.stencilRefFront = 1;\n        this.stencilTestBack = false;\n        this.stencilFuncBack = ComparisonFunc.ALWAYS;\n        this.stencilReadMaskBack = 0xffff;\n        this.stencilWriteMaskBack = 0xffff;\n        this.stencilFailOpBack = StencilOp.KEEP;\n        this.stencilZFailOpBack = StencilOp.KEEP;\n        this.stencilPassOpBack = StencilOp.KEEP;\n        this.stencilRefBack = 1;\n    }\n\n    public assign (dss: DepthStencilState) {\n        Object.assign(this, dss);\n    }\n\n    public destroy () {}\n}\n\n/**\n * @en GFX blend target.\n * @zh GFX 混合目标。\n */\nexport class BlendTarget {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public blend: boolean = false,\n        public blendSrc: BlendFactor = BlendFactor.ONE,\n        public blendDst: BlendFactor = BlendFactor.ZERO,\n        public blendEq: BlendOp = BlendOp.ADD,\n        public blendSrcAlpha: BlendFactor = BlendFactor.ONE,\n        public blendDstAlpha: BlendFactor = BlendFactor.ZERO,\n        public blendAlphaEq: BlendOp = BlendOp.ADD,\n        public blendColorMask: ColorMask = ColorMask.ALL,\n    ) {}\n\n    public reset () {\n        this.blend = false;\n        this.blendSrc = BlendFactor.ONE;\n        this.blendDst = BlendFactor.ZERO;\n        this.blendEq = BlendOp.ADD;\n        this.blendSrcAlpha = BlendFactor.ONE;\n        this.blendDstAlpha = BlendFactor.ZERO;\n        this.blendAlphaEq = BlendOp.ADD;\n        this.blendColorMask = ColorMask.ALL;\n    }\n\n    public assign (target: BlendTarget) {\n        Object.assign(this, target);\n    }\n\n    public destroy () {}\n}\n\n/**\n * @en GFX blend state.\n * @zh GFX 混合状态。\n */\nexport class BlendState {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    get native () {\n        return this;\n    }\n\n    constructor (\n        public isA2C: boolean = false,\n        public isIndepend: boolean = false,\n        public blendColor: Color = new Color(),\n        public targets: BlendTarget[] = [new BlendTarget()],\n    ) {}\n\n    /**\n     * @en Should use this function to set target, or it will not work\n     * on native platforms, as native can not support this feature,\n     * such as `blendState[i] = target;`.\n     *\n     * @param index The index to set target.\n     * @param target The target to be set.\n     */\n    public setTarget (index: number, target: BlendTarget) {\n        let tg = this.targets[index];\n        if (!tg) {\n            tg = this.targets[index] = new BlendTarget();\n        }\n        Object.assign(tg, target);\n    }\n\n    public reset () {\n        this.isA2C = false;\n        this.isIndepend = false;\n        this.blendColor.x = 0;\n        this.blendColor.y = 0;\n        this.blendColor.z = 0;\n        this.blendColor.w = 0;\n        this.targets.length = 1;\n        this.targets[0].reset();\n    }\n\n    public destroy () {}\n}\n\nexport class PipelineStateInfo {\n    declare private _token: never; // to make sure all usages must be an instance of this exact class, not assembled from plain object\n\n    constructor (\n        public shader: Shader = null!,\n        public pipelineLayout: PipelineLayout = null!,\n        public renderPass: RenderPass = null!,\n        public inputState: InputState = new InputState(),\n        public rasterizerState: RasterizerState = new RasterizerState(),\n        public depthStencilState: DepthStencilState = new DepthStencilState(),\n        public blendState: BlendState = new BlendState(),\n        public primitive: PrimitiveMode = PrimitiveMode.TRIANGLE_LIST,\n        public dynamicStates: DynamicStateFlags = DynamicStateFlagBit.NONE,\n        public bindPoint: PipelineBindPoint = PipelineBindPoint.GRAPHICS,\n    ) {}\n}\n\n/**\n * @en GFX pipeline state.\n * @zh GFX 管线状态。\n */\nexport abstract class PipelineState extends GFXObject {\n    /**\n     * @en Get current shader.\n     * @zh GFX 着色器。\n     */\n    get shader (): Shader {\n        return this._shader!;\n    }\n\n    /**\n     * @en Get current pipeline layout.\n     * @zh GFX 管线布局。\n     */\n    get pipelineLayout (): PipelineLayout {\n        return this._pipelineLayout!;\n    }\n\n    /**\n     * @en Get current primitve mode.\n     * @zh GFX 图元模式。\n     */\n    get primitive (): PrimitiveMode {\n        return this._primitive;\n    }\n\n    /**\n     * @en Get current rasterizer state.\n     * @zh GFX 光栅化状态。\n     */\n    get rasterizerState (): RasterizerState {\n        return this._rs;\n    }\n\n    /**\n     * @en Get current depth stencil state.\n     * @zh GFX 深度模板状态。\n     */\n    get depthStencilState (): DepthStencilState {\n        return this._dss;\n    }\n\n    /**\n     * @en Get current blend state.\n     * @zh GFX 混合状态。\n     */\n    get blendState (): BlendState {\n        return this._bs;\n    }\n\n    /**\n     * @en Get current input state.\n     * @zh GFX 输入状态。\n     */\n    get inputState (): InputState {\n        return this._is as InputState;\n    }\n\n    /**\n     * @en Get current dynamic states.\n     * @zh GFX 动态状态数组。\n     */\n    get dynamicStates (): DynamicStateFlags {\n        return this._dynamicStates;\n    }\n\n    /**\n     * @en Get current render pass.\n     * @zh GFX 渲染过程。\n     */\n    get renderPass (): RenderPass {\n        return this._renderPass as RenderPass;\n    }\n\n    protected _shader: Shader | null = null;\n    protected _pipelineLayout: PipelineLayout | null = null;\n    protected _primitive: PrimitiveMode = PrimitiveMode.TRIANGLE_LIST;\n    protected _is: InputState | null = null;\n    protected _rs: RasterizerState = new RasterizerState();\n    protected _dss: DepthStencilState = new DepthStencilState();\n    protected _bs: BlendState = new BlendState();\n    protected _dynamicStates: DynamicStateFlags = DynamicStateFlagBit.NONE;\n    protected _renderPass: RenderPass | null = null;\n\n    constructor () {\n        super(ObjectType.PIPELINE_STATE);\n    }\n\n    public abstract initialize (info: Readonly<PipelineStateInfo>): void;\n\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { CommandBuffer } from './command-buffer';\nimport { GFXObject, ObjectType, QueueType, QueueInfo } from './define';\n\n/**\n * @en GFX Queue.\n * @zh GFX 队列。\n */\nexport abstract class Queue extends GFXObject {\n    /**\n     * @en Get current type.\n     * @zh 队列类型。\n     */\n    get type (): number {\n        return this._type;\n    }\n\n    protected _type: QueueType = QueueType.GRAPHICS;\n\n    constructor () {\n        super(ObjectType.QUEUE);\n    }\n\n    public abstract initialize (info: Readonly<QueueInfo>): void;\n\n    public abstract destroy (): void;\n\n    /**\n     * @en Submit command buffers.\n     * @zh 提交命令缓冲数组。\n     * @param cmdBuffs The command buffers to be submitted.\n     * @param fence The syncing fence.\n     */\n    public abstract submit (cmdBuffs: Readonly<CommandBuffer[]>): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { murmurhash2_32_gc } from '../../utils/murmurhash2_gc';\nimport {\n    GFXObject,\n    ObjectType,\n    ColorAttachment,\n    DepthStencilAttachment,\n    SubpassInfo,\n    RenderPassInfo,\n} from './define';\n\n/**\n * @en GFX render pass.\n * @zh GFX 渲染过程。\n */\nexport abstract class RenderPass extends GFXObject {\n    protected _colorInfos: ColorAttachment[] = [];\n    protected _depthStencilInfo: DepthStencilAttachment | null = null;\n    protected _subpasses: SubpassInfo[] = [];\n    protected _hash = 0;\n\n    get colorAttachments () : Readonly<ColorAttachment[]> { return this._colorInfos; }\n    get depthStencilAttachment () : Readonly<DepthStencilAttachment> | null { return this._depthStencilInfo; }\n    get subPasses () : Readonly<SubpassInfo[]> { return this._subpasses; }\n    get hash () { return this._hash; }\n\n    constructor () {\n        super(ObjectType.RENDER_PASS);\n    }\n\n    // Based on render pass compatibility\n    protected computeHash (): number {\n        let res = '';\n        if (this._subpasses.length) {\n            for (let i = 0; i < this._subpasses.length; ++i) {\n                const subpass = this._subpasses[i];\n                if (subpass.inputs.length) {\n                    res += 'ia';\n                    for (let j = 0; j < subpass.inputs.length; ++j) {\n                        const ia = this._colorInfos[subpass.inputs[j]];\n                        res += `,${ia.format},${ia.sampleCount}`;\n                    }\n                }\n                if (subpass.colors.length) {\n                    res += 'ca';\n                    for (let j = 0; j < subpass.inputs.length; ++j) {\n                        const ca = this._colorInfos[subpass.inputs[j]];\n                        res += `,${ca.format},${ca.sampleCount}`;\n                    }\n                }\n                if (subpass.depthStencil >= 0) {\n                    const ds = this._colorInfos[subpass.depthStencil];\n                    res += `ds,${ds.format},${ds.sampleCount}`;\n                }\n            }\n        } else {\n            res += 'ca';\n            for (let i = 0; i < this._colorInfos.length; ++i) {\n                const ca = this._colorInfos[i];\n                res += `,${ca.format},${ca.sampleCount}`;\n            }\n            const ds = this._depthStencilInfo;\n            if (ds) {\n                res += `ds,${ds.format},${ds.sampleCount}`;\n            }\n        }\n\n        return murmurhash2_32_gc(res, 666);\n    }\n\n    public abstract initialize (info: Readonly<RenderPassInfo>): void;\n\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { GFXObject, ObjectType, SamplerInfo } from '../define';\n\n/**\n * @en GFX sampler.\n * @zh GFX 采样器。\n */\nexport class Sampler extends GFXObject {\n    get info (): Readonly<SamplerInfo> { return this._info; }\n    get hash (): number { return this._hash; }\n\n    protected _info: SamplerInfo = new SamplerInfo();\n    protected _hash = 0;\n\n    constructor (info: Readonly<SamplerInfo>, hash: number) {\n        super(ObjectType.SAMPLER);\n        this._info.copy(info);\n        this._hash = hash;\n    }\n\n    static computeHash (info: Readonly<SamplerInfo>) {\n        let hash = info.minFilter;\n        hash |= (info.magFilter << 2);\n        hash |= (info.mipFilter << 4);\n        hash |= (info.addressU << 6);\n        hash |= (info.addressV << 8);\n        hash |= (info.addressW << 10);\n        hash |= (info.maxAnisotropy << 12);\n        hash |= (info.cmpFunc << 16);\n        return hash;\n    }\n\n    static unpackFromHash (hash: number) {\n        const info = new SamplerInfo();\n        info.minFilter = (hash & ((1 << 2) - 1)) >> 0;\n        info.magFilter = (hash & ((1 << 2) - 1)) >> 2;\n        info.mipFilter = (hash & ((1 << 2) - 1)) >> 4;\n        info.addressU = (hash & ((1 << 2) - 1)) >> 6;\n        info.addressV = (hash & ((1 << 2) - 1)) >> 8;\n        info.addressW = (hash & ((1 << 2) - 1)) >> 10;\n        info.maxAnisotropy = (hash & ((1 << 4) - 1)) >> 12;\n        info.cmpFunc = (hash & ((1 << 3) - 1)) >> 16;\n        return info;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { GFXObject, ObjectType, ShaderInfo, ShaderStage, UniformBlock, UniformSampler, Attribute } from './define';\n\n/**\n * @en GFX shader.\n * @zh GFX 着色器。\n */\nexport abstract class Shader extends GFXObject {\n    get name (): string {\n        return this._name;\n    }\n\n    get attributes () {\n        return this._attributes;\n    }\n\n    get blocks () {\n        return this._blocks;\n    }\n\n    get samplers () {\n        return this._samplers;\n    }\n\n    protected _name = '';\n    protected _stages: ShaderStage[] = [];\n    protected _attributes: Attribute[] = [];\n    protected _blocks: UniformBlock[] = [];\n    protected _samplers: UniformSampler[] = [];\n\n    constructor () {\n        super(ObjectType.SHADER);\n    }\n\n    public abstract initialize (info: Readonly<ShaderInfo>): void;\n\n    public abstract destroy (): void;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport {\n    Format,\n    GFXObject,\n    ObjectType,\n    SampleCount,\n    TextureFlags,\n    TextureType,\n    TextureUsage,\n    TextureInfo,\n    TextureViewInfo,\n    ISwapchainTextureInfo,\n} from './define';\n\n/**\n * @en GFX texture.\n * @zh GFX 纹理。\n */\nexport abstract class Texture extends GFXObject {\n    /**\n     * @en Get texture type.\n     * @zh 纹理类型。\n     */\n    get type (): TextureType {\n        return this._info.type;\n    }\n\n    /**\n     * @en Get texture usage.\n     * @zh 纹理使用方式。\n     */\n    get usage (): TextureUsage {\n        return this._info.usage;\n    }\n\n    /**\n     * @en Get texture format.\n     * @zh 纹理格式。\n     */\n    get format (): Format {\n        return this._info.format;\n    }\n\n    /**\n     * @en Get texture width.\n     * @zh 纹理宽度。\n     */\n    get width (): number {\n        return this._info.width;\n    }\n\n    /**\n     * @en Get texture height.\n     * @zh 纹理高度。\n     */\n    get height (): number {\n        return this._info.height;\n    }\n\n    /**\n     * @en Get texture depth.\n     * @zh 纹理深度。\n     */\n    get depth (): number {\n        return this._info.depth;\n    }\n\n    /**\n     * @en Get texture array layer.\n     * @zh 纹理数组层数。\n     */\n    get layerCount (): number {\n        return this._info.layerCount;\n    }\n\n    /**\n     * @en Get texture mip level.\n     * @zh 纹理 mip 层级数。\n     */\n    get levelCount (): number {\n        return this._info.levelCount;\n    }\n\n    /**\n     * @en Get texture samples.\n     * @zh 纹理采样数。\n     */\n    get samples (): SampleCount {\n        return this._info.samples;\n    }\n\n    /**\n     * @en Get texture flags.\n     * @zh 纹理标识位。\n     */\n    get flags (): TextureFlags {\n        return this._info.flags;\n    }\n\n    /**\n     * @en Get texture size.\n     * @zh 纹理大小。\n     */\n    get size (): number {\n        return this._size;\n    }\n\n    /**\n     * @en Get texture info.\n     * @zh 纹理信息。\n     */\n    get info (): Readonly<TextureInfo> {\n        return this._info;\n    }\n\n    /**\n     * @en Get view info.\n     * @zh 纹理视图信息。\n     */\n    get viewInfo (): Readonly<TextureViewInfo> {\n        return this._viewInfo;\n    }\n\n    /**\n     * @en Get texture type.\n     * @zh 是否为纹理视图。\n     */\n    get isTextureView (): boolean {\n        return this._isTextureView;\n    }\n\n    protected _info: TextureInfo = new TextureInfo();\n    protected _viewInfo: TextureViewInfo = new TextureViewInfo();\n\n    protected _isPowerOf2 = false;\n    protected _isTextureView = false;\n    protected _size = 0;\n\n    constructor () {\n        super(ObjectType.TEXTURE);\n    }\n\n    public abstract initialize (info: Readonly<TextureInfo> | Readonly<TextureViewInfo>): void;\n\n    public abstract destroy (): void;\n\n    /**\n     * @en Resize texture.\n     * @zh 重置纹理大小。\n     * @param width The new width.\n     * @param height The new height.\n     */\n    public abstract resize (width: number, height: number): void;\n\n    protected abstract initAsSwapchainTexture (info: Readonly<ISwapchainTextureInfo>): void;\n\n    public static getLevelCount (width: number, height: number): number {\n        return Math.floor(Math.log2(Math.max(width, height)));\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { murmurhash2_32_gc } from '../../../utils/murmurhash2_gc';\nimport { GFXObject, ObjectType, GeneralBarrierInfo } from '../define';\n\n/**\n * @en GFX global barrier.\n * @zh GFX 全局内存屏障。\n */\nexport class GeneralBarrier extends GFXObject {\n    get info (): Readonly<GeneralBarrierInfo> { return this._info; }\n    get hash (): number { return this._hash; }\n\n    protected _info: GeneralBarrierInfo = new GeneralBarrierInfo();\n    protected _hash = 0;\n\n    constructor (info: Readonly<GeneralBarrierInfo>, hash: number) {\n        super(ObjectType.GLOBAL_BARRIER);\n        this._info.copy(info);\n        this._hash = hash;\n    }\n\n    static computeHash (info: Readonly<GeneralBarrierInfo>) {\n        return murmurhash2_32_gc(`${info.prevAccesses} ${info.nextAccesses} ${info.type}`, 666);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { murmurhash2_32_gc } from '../../../utils/murmurhash2_gc';\nimport { GFXObject, ObjectType, TextureBarrierInfo } from '../define';\n\n/**\n * @en GFX texture barrier.\n * @zh GFX 贴图内存屏障。\n */\nexport class TextureBarrier extends GFXObject {\n    get info (): Readonly<TextureBarrierInfo> { return this._info; }\n    get hash (): number { return this._hash; }\n\n    protected _info: TextureBarrierInfo = new TextureBarrierInfo();\n    protected _hash = 0;\n\n    constructor (info: Readonly<TextureBarrierInfo>, hash: number) {\n        super(ObjectType.TEXTURE_BARRIER);\n        this._info.copy(info);\n        this._hash = hash;\n    }\n\n    static computeHash (info: Readonly<TextureBarrierInfo>) {\n        let res = `${info.prevAccesses} ${info.nextAccesses}`;\n        res += info.type;\n        res += info.baseMipLevel;\n        res += info.levelCount;\n        res += info.baseSlice;\n        res += info.sliceCount;\n        res += info.discardContents;\n        res += info.srcQueue ? info.srcQueue.type : 0;\n        res += info.dstQueue ? info.dstQueue.type : 0;\n\n        return murmurhash2_32_gc(res, 666);\n    }\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { murmurhash2_32_gc } from '../../../utils/murmurhash2_gc';\nimport { GFXObject, ObjectType, BufferBarrierInfo } from '../define';\n\n/**\n * @en GFX buffer barrier.\n * @zh GFX buffer内存屏障。\n */\nexport class BufferBarrier extends GFXObject {\n    get info (): Readonly<BufferBarrierInfo> { return this._info; }\n    get hash (): number { return this._hash; }\n\n    protected _info: BufferBarrierInfo = new BufferBarrierInfo();\n    protected _hash = 0;\n\n    constructor (info: Readonly<BufferBarrierInfo>, hash: number) {\n        super(ObjectType.BUFFER_BARRIER);\n        this._info.copy(info);\n        this._hash = hash;\n    }\n\n    static computeHash (info: Readonly<BufferBarrierInfo>) {\n        let res = `${info.prevAccesses} ${info.nextAccesses}`;\n        res += info.type;\n        res += info.offset;\n        res += info.size;\n        res += info.discardContents;\n        res += info.srcQueue ? info.srcQueue.type : 0;\n        res += info.dstQueue ? info.dstQueue.type : 0;\n\n        return murmurhash2_32_gc(res, 666);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Buffer } from './base/buffer';\nimport { CommandBuffer } from './base/command-buffer';\nimport { Device } from './base/device';\nimport { Swapchain } from './base/swapchain';\nimport { Framebuffer } from './base/framebuffer';\nimport { InputAssembler } from './base/input-assembler';\nimport { DescriptorSet } from './base/descriptor-set';\nimport { DescriptorSetLayout } from './base/descriptor-set-layout';\nimport { PipelineLayout } from './base/pipeline-layout';\nimport { PipelineState, PipelineStateInfo, RasterizerState, BlendState, BlendTarget, DepthStencilState } from './base/pipeline-state';\nimport { Queue } from './base/queue';\nimport { RenderPass } from './base/render-pass';\nimport { Sampler } from './base/states/sampler';\nimport { Shader } from './base/shader';\nimport { Texture } from './base/texture';\nimport { GeneralBarrier } from './base/states/general-barrier';\nimport { TextureBarrier } from './base/states/texture-barrier';\nimport { BufferBarrier } from './base/states/buffer-barrier';\nimport { legacyCC } from '../global-exports';\nimport * as defines from './base/define';\n\nconst polyfills: Record<string, unknown> = {\n    Device,\n    Swapchain,\n    Buffer,\n    Texture,\n    Sampler,\n    Shader,\n    InputAssembler,\n    RenderPass,\n    Framebuffer,\n    DescriptorSet,\n    DescriptorSetLayout,\n    PipelineLayout,\n    PipelineState,\n    CommandBuffer,\n    Queue,\n    GeneralBarrier,\n    TextureBarrier,\n    BufferBarrier,\n\n    RasterizerState,\n    BlendState,\n    BlendTarget,\n    DepthStencilState,\n    PipelineStateInfo,\n};\n\nObject.assign(polyfills, defines);\nlegacyCC.gfx = polyfills;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { replaceProperty, removeProperty } from '../utils/x-deprecated';\nimport { legacyCC } from '../global-exports';\n\n// Deprecated CC polyfill\nconst polyfills = {\n    GFXDevice: true,\n    GFXBuffer: true,\n    GFXTexture: true,\n    GFXSampler: true,\n    GFXShader: true,\n    GFXInputAssembler: true,\n    GFXRenderPass: true,\n    GFXFramebuffer: true,\n    GFXPipelineState: true,\n    GFXCommandBuffer: true,\n    GFXQueue: true,\n    GFXObjectType: true,\n    GFXObject: false,\n    GFXAttributeName: true,\n    GFXType: true,\n    GFXFormat: true,\n    GFXBufferUsageBit: true,\n    GFXMemoryUsageBit: true,\n    GFXBufferFlagBit: true,\n    GFXBufferAccessBit: 'MemoryAccessBit',\n    GFXPrimitiveMode: true,\n    GFXPolygonMode: true,\n    GFXShadeModel: true,\n    GFXCullMode: true,\n    GFXComparisonFunc: true,\n    GFXStencilOp: true,\n    GFXBlendOp: true,\n    GFXBlendFactor: true,\n    GFXColorMask: true,\n    GFXFilter: true,\n    GFXAddress: true,\n    GFXTextureType: true,\n    GFXTextureUsageBit: true,\n    GFXSampleCount: true,\n    GFXTextureFlagBit: true,\n    GFXShaderStageFlagBit: true,\n    GFXDescriptorType: true,\n    GFXCommandBufferType: true,\n    GFXLoadOp: true,\n    GFXStoreOp: true,\n    GFXPipelineBindPoint: true,\n    GFXDynamicStateFlagBit: true,\n    GFXStencilFace: true,\n    GFXQueueType: true,\n    GFXRect: true,\n    GFXViewport: true,\n    GFXColor: true,\n    GFXClearFlag: true,\n    GFXOffset: true,\n    GFXExtent: true,\n    GFXTextureSubres: 'TextureSubresLayers',\n    GFXTextureCopy: true,\n    GFXBufferTextureCopy: true,\n    GFXFormatType: true,\n    GFXFormatInfo: true,\n    GFXMemoryStatus: true,\n    GFXFormatInfos: true,\n    GFXFormatSize: true,\n    GFXFormatSurfaceSize: true,\n    GFXGetTypeSize: true,\n    getTypedArrayConstructor: false,\n};\nfor (const name in polyfills) {\n    let newName = polyfills[name];\n    if (newName === true) {\n        newName = name.slice(3);\n    } else if (newName === false) {\n        newName = name;\n    }\n    // Deprecation\n    replaceProperty(legacyCC, 'cc', [\n        {\n            name,\n            newName,\n            target: legacyCC.gfx,\n            targetName: 'cc.gfx',\n        },\n    ]);\n}\n\nremoveProperty(legacyCC, 'cc', [\n    { name: 'GFX_MAX_VERTEX_ATTRIBUTES' },\n    { name: 'GFX_MAX_TEXTURE_UNITS' },\n    { name: 'GFX_MAX_ATTACHMENTS' },\n    { name: 'GFX_MAX_BUFFER_BINDINGS' },\n    { name: 'GFXTextureLayout' },\n]);\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { removeProperty, replaceProperty } from '../utils/x-deprecated';\nimport { Device } from './base/device';\nimport { Feature, ColorAttachment, DepthStencilAttachment } from './base/define';\n\n// Deprecate format features in gfx Feature.\nremoveProperty(Feature, 'Feature', [\n    {\n        name: 'COLOR_FLOAT',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.RENDER_TARGET;',\n    },\n    {\n        name: 'COLOR_HALF_FLOAT',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.RENDER_TARGET;',\n    },\n    {\n        name: 'TEXTURE_FLOAT',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = (device.getFormatFeatures(Format.R32F) & (FormatFeatureBit.RENDER_TARGET'\n             + ' | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);',\n    },\n    {\n        name: 'TEXTURE_HALF_FLOAT',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = (device.getFormatFeatures(Format.R16F) & (FormatFeatureBit.RENDER_TARGET'\n             + ' | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);',\n    },\n    {\n        name: 'TEXTURE_FLOAT_LINEAR',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.LINEAR_FILTER;',\n    },\n    {\n        name: 'TEXTURE_HALF_FLOAT_LINEAR',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.LINEAR_FILTER;',\n    },\n    {\n        name: 'FORMAT_R11G11B10F',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.R11G11B10F) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_SRGB',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.SRGB8) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_ETC1',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.ETC_RGB8) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_ETC2',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.ETC2_RGB8) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_DXT',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.BC1) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_PVRTC',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.PVRTC_RGB2) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_ASTC',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.ASTC_RGBA_4x4) !== FormatFeatureBit.NONE;',\n    },\n    {\n        name: 'FORMAT_RGB8',\n        suggest: 'Please use device.getFormatFeatures() instead, like: \\n'\n             + 'let isSupported = device.getFormatFeatures(Format.RGB8) !== FormatFeatureBit.NONE;',\n    },\n]);\n\nremoveProperty(ColorAttachment.prototype, 'ColorAttachment', [\n    {\n        name: 'beginAccesses',\n        suggest: 'Please assign to ColorAttachment.barrier instead',\n    },\n    {\n        name: 'endAccesses',\n        suggest: 'Please assign to ColorAttachment.barrier instead',\n    },\n]);\n\nremoveProperty(DepthStencilAttachment.prototype, 'DepthStencilAttachment', [\n    {\n        name: 'beginAccesses',\n        suggest: 'Please assign to DepthStencilAttachment.barrier instead',\n    },\n    {\n        name: 'endAccesses',\n        suggest: 'Please assign to DepthStencilAttachment.barrier instead',\n    },\n]);\n\nreplaceProperty(Device.prototype, 'Device', [\n    {\n        name: 'getGlobalBarrier',\n        newName: 'getGeneralBarrier',\n    },\n]);\n","/*\n Copyright (c) 2021 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { fastRemoveAt } from '../utils/array';\nimport { ScalableContainer } from './scalable-container';\n\nclass ContainerManager {\n    private _pools: ScalableContainer[] = [];\n    private _lastShrinkPassed = 0;\n    public shrinkTimeSpan = 5;\n\n    addContainer (pool: ScalableContainer) {\n        if (pool._poolHandle !== -1) return;\n        pool._poolHandle = this._pools.length;\n        this._pools.push(pool);\n    }\n\n    removeContainer (pool: ScalableContainer) {\n        if (pool._poolHandle === -1) return;\n        this._pools[this._pools.length - 1]._poolHandle = pool._poolHandle;\n        fastRemoveAt(this._pools, pool._poolHandle);\n        pool._poolHandle = -1;\n    }\n\n    tryShrink () {\n        for (let i = 0; i < this._pools.length; i++) {\n            this._pools[i].tryShrink();\n        }\n    }\n\n    update (dt: number) {\n        this._lastShrinkPassed += dt;\n        if (this._lastShrinkPassed > this.shrinkTimeSpan) {\n            this.tryShrink();\n            this._lastShrinkPassed -= this.shrinkTimeSpan;\n        }\n    }\n}\n\nexport const containerManager = new ContainerManager();\n","/*\n Copyright (c) 2021 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { containerManager } from './container-manager';\n\nexport abstract class ScalableContainer {\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _poolHandle = -1;\n    constructor () {\n        containerManager.addContainer(this);\n    }\n\n    abstract tryShrink (): void;\n\n    destroy () {\n        containerManager.removeContainer(this);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { warnID } from '../platform/debug';\nimport { ScalableContainer } from './scalable-container';\n\n/**\n * @en Typed object pool.\n * It's a traditional design, you can get elements out of the pool or recycle elements by putting back into the pool.\n * @zh 支持类型的对象池。这是一个传统设计的对象池，你可以从对象池中取出对象或是放回不再需要对象来复用。\n * @see [[RecyclePool]]\n */\nexport class Pool<T> extends ScalableContainer {\n    private _ctor: () => T;\n    private _elementsPerBatch: number;\n    private _nextAvail: number;\n    private _freepool: T[] = [];\n    private _dtor: ((obj: T) => void) | null;\n\n    /**\n     * @en Constructor with the allocator of elements and initial pool size\n     * @zh 使用元素的构造器和初始大小的构造函数\n     * @param ctor The allocator of elements in pool, it's invoked directly without `new`\n     * @param elementsPerBatch Initial pool size, this size will also be the incremental size when the pool is overloaded\n     * @param dtor The finalizer of element, it's invoked when this container is destroyed or shrunk\n     */\n    constructor (ctor: () => T, elementsPerBatch: number, dtor?: (obj: T) => void) {\n        super();\n        this._ctor = ctor;\n        this._dtor = dtor || null;\n        this._elementsPerBatch = Math.max(elementsPerBatch, 1);\n        this._nextAvail = this._elementsPerBatch - 1;\n\n        for (let i = 0; i < this._elementsPerBatch; ++i) {\n            this._freepool.push(ctor());\n        }\n    }\n\n    /**\n     * @en Take an object out of the object pool.\n     * @zh 从对象池中取出一个对象。\n     * @return An object ready for use. This function always return an object.\n     */\n    public alloc (): T {\n        if (this._nextAvail < 0) {\n            this._freepool.length = this._elementsPerBatch;\n            for (let i = 0; i < this._elementsPerBatch; i++) {\n                this._freepool[i] = this._ctor();\n            }\n            this._nextAvail = this._elementsPerBatch - 1;\n        }\n\n        return this._freepool[this._nextAvail--];\n    }\n\n    /**\n     * @en Put an object back into the object pool.\n     * @zh 将一个对象放回对象池中。\n     * @param obj The object to be put back into the pool\n     */\n    public free (obj: T) {\n        this._freepool[++this._nextAvail] = obj;\n    }\n\n    /**\n     * @en Put multiple objects back into the object pool.\n     * @zh 将一组对象放回对象池中。\n     * @param objs An array of objects to be put back into the pool\n     */\n    public freeArray (objs: T[]) {\n        this._freepool.length = this._nextAvail + 1;\n        Array.prototype.push.apply(this._freepool, objs);\n        this._nextAvail += objs.length;\n    }\n\n    public tryShrink () {\n        if (this._nextAvail >> 1 > this._elementsPerBatch) {\n            if (this._dtor) {\n                for (let i = this._nextAvail >> 1; i <= this._nextAvail; i++) {\n                    this._dtor(this._freepool[i]);\n                }\n            }\n            this._freepool.length = this._nextAvail >> 1;\n            this._nextAvail = this._freepool.length - 1;\n        }\n    }\n\n    /**\n     * @en Destroy all elements and clear the pool.\n     * @zh 释放对象池中所有资源并清空缓存池。\n     */\n    public destroy () {\n        const dtor = arguments.length > 0 ? arguments[0] : null;\n        if (dtor) { warnID(14100); }\n        const readDtor = dtor || this._dtor;\n        if (readDtor) {\n            for (let i = 0; i <= this._nextAvail; i++) {\n                readDtor(this._freepool[i]);\n            }\n        }\n        this._freepool.length = 0;\n        this._nextAvail = -1;\n        super.destroy();\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ScalableContainer } from './scalable-container';\n\n/**\n * @en Recyclable object pool. It's designed to be entirely reused each time.\n * There is no put and get method, each time you get the [[data]], you can use all elements as new.\n * You shouldn't simultaneously use the same RecyclePool in more than two overlapped logic.\n * Its size can be automatically incremented or manually resized.\n * @zh 循环对象池。这种池子被设计为每次使用都完整复用。\n * 它没有回收和提取的函数，通过获取 [[data]] 可以获取池子中所有元素，全部都应该被当做新对象来使用。\n * 开发者不应该在相互交叉的不同逻辑中同时使用同一个循环对象池。\n * 池子尺寸可以在池子满时自动扩充，也可以手动调整。\n * @see [[Pool]]\n */\nexport class RecyclePool<T = any> extends ScalableContainer {\n    private _fn: () => T;\n    private _dtor: ((obj: T) => void) | null = null;\n    private _count = 0;\n    private _data: T[];\n    private _initSize = 0;\n\n    /**\n     * @en Constructor with the allocator of elements and initial pool size, all elements will be pre-allocated.\n     * @zh 使用元素的构造器和初始大小的构造函数，所有元素都会被预创建。\n     * @param fn The allocator of elements in pool, it's invoked directly without `new`\n     * @param size Initial pool size\n     * @param dtor The finalizer of element, it's invoked when this container is destroyed or shrunk\n     */\n    constructor (fn: () => T, size: number, dtor?: (obj: T) => void) {\n        super();\n        this._fn = fn;\n        this._dtor = dtor || null;\n        this._data = new Array(size);\n        this._initSize = size;\n\n        for (let i = 0; i < size; ++i) {\n            this._data[i] = fn();\n        }\n    }\n\n    /**\n     * @en The length of the object pool.\n     * @zh 对象池大小。\n     */\n    get length () {\n        return this._count;\n    }\n\n    /**\n     * @en The underlying array of all pool elements.\n     * @zh 实际对象池数组。\n     */\n    get data () {\n        return this._data;\n    }\n\n    /**\n     * @en Resets the object pool. Only changes the length to 0\n     * @zh 清空对象池。目前仅仅会设置尺寸为 0\n     */\n    public reset () {\n        this._count = 0;\n    }\n\n    /**\n     * @en Resize the object poo, and fills with new created elements.\n     * @zh 设置对象池大小，并填充新的元素。\n     * @param size The new size of the pool\n     */\n    public resize (size: number) {\n        if (size > this._data.length) {\n            for (let i = this._data.length; i < size; ++i) {\n                this._data[i] = this._fn();\n            }\n        }\n    }\n\n    /**\n     * @en Expand the object pool, the size will be increment to current size times two, and fills with new created elements.\n     * @zh 扩充对象池容量，会自动扩充尺寸到两倍，并填充新的元素。\n     * @param idx\n     */\n    public add () {\n        if (this._count >= this._data.length) {\n            this.resize(this._data.length << 1);\n        }\n\n        return this._data[this._count++];\n    }\n\n    public destroy () {\n        if (this._dtor) {\n            for (let i = 0; i < this._data.length; i++) {\n                this._dtor(this._data[i]);\n            }\n        }\n        this._data.length = 0;\n        this._count = 0;\n        super.destroy();\n    }\n\n    public tryShrink () {\n        if (this._data.length >> 2 > this._count) {\n            const length = Math.max(this._initSize, this._data.length >> 1);\n            if (this._dtor) {\n                for (let i = length; i < this._data.length; i++) {\n                    this._dtor(this._data[i]);\n                }\n            }\n            this._data.length = length;\n        }\n    }\n\n    /**\n     * @en Remove an element of the object pool. This will also decrease size of the pool\n     * @zh 移除对象池中的一个元素，同时会减小池子尺寸。\n     * @param idx The index of the element to be removed\n     */\n    public removeAt (idx: number) {\n        if (idx >= this._count) {\n            return;\n        }\n\n        const last = this._count - 1;\n        const tmp = this._data[idx];\n        this._data[idx] = this._data[last];\n        this._data[last] = tmp;\n        this._count -= 1;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ScalableContainer } from './scalable-container';\n\n/**\n * @en\n * Cached array is a data structure for objects cache, it's designed for persistent data.\n * Its content array length will keep grow.\n * @zh\n * 适用于对象缓存的数组类型封装，一般用于不易被移除的常驻数据。\n * 它的内部数组长度会持续增长，不会减少。\n */\nexport class CachedArray<T> extends ScalableContainer {\n    /**\n     * @en\n     * The array which stores actual content\n     * @zh\n     * 实际存储数据内容的数组\n     */\n    public array: T[];\n\n    /**\n     * @en\n     * The actual count of data object\n     * @zh\n     * 实际数据内容数量\n     */\n    public length = 0;\n\n    private _compareFn?: (a: T, b: T) => number;\n    private _initSize = 0;\n\n    /**\n     * @param length Initial length\n     * @param compareFn Comparison function for sorting\n     */\n    constructor (length: number, compareFn?: (a: T, b: T) => number) {\n        super();\n        this.array = new Array(length);\n        this._initSize = length;\n        this.length = 0;\n        this._compareFn = compareFn;\n    }\n\n    /**\n     * @en\n     * Push an element to the end of the array\n     * @zh\n     * 向数组末尾添加一个元素\n     * @param item The item to be added\n     */\n    public push (item: T) {\n        this.array[this.length++] = item;\n    }\n\n    /**\n     * @en\n     * Pop the last element in the array. The [[length]] will reduce, but the internal array will keep its size.\n     * @zh\n     * 弹出数组最后一个元素，CachedArray 的 [[length]] 会减少，但是内部数组的实际长度不变\n     * @return The last element.\n     */\n    public pop (): T | undefined {\n        return this.array[--this.length];\n    }\n\n    /**\n     * @en\n     * Get the element at the specified index of the array\n     * @zh\n     * 得到数组中指定位置的元素\n     * @param idx The index of the requested element\n     * @return The element at given index\n     */\n    public get (idx: number): T | undefined {\n        return this.array[idx];\n    }\n\n    /**\n     * @en\n     * Clear the cache. The [[length]] will be set to 0, but the internal array will keep its size.\n     * @zh\n     * 清空数组所有元素。[[length]] 会被设为 0，但内部数组的实际长度不变\n     */\n    public clear () {\n        this.length = 0;\n    }\n\n    /**\n     * @en\n     * Clear the cache. The [[length]] will be set to 0, and clear the internal array.\n     * @zh\n     * 清空数组所有元素。[[length]] 会被设为 0，并且清空内部数组\n     */\n    public destroy () {\n        this.length = 0;\n        this.array.length = 0;\n        super.destroy();\n    }\n\n    public tryShrink () {\n        if (this.array.length >> 2 > this.length) {\n            this.array.length = Math.max(this._initSize, this.array.length >> 1);\n        }\n    }\n\n    /**\n     * @en\n     * Sort the existing elements in cache\n     * @zh\n     * 排序所有现有元素\n     */\n    public sort () {\n        this.array.length = this.length;\n        this.array.sort(this._compareFn);\n    }\n\n    /**\n     * @en\n     * Add all elements of a given array to the end of the current array\n     * @zh\n     * 添加一个指定数组中的所有元素到当前数组末尾\n     * @param array The given array to be appended\n     */\n    public concat (array: T[]) {\n        for (let i = 0; i < array.length; ++i) {\n            this.array[this.length++] = array[i];\n        }\n    }\n\n    /**\n     * @en Delete the element at the specified location and move the last element to that location.\n     * @zh 删除指定位置的元素并将最后一个元素移动至该位置。\n     * @param idx The index of the element to be deleted\n     */\n    public fastRemove (idx: number) {\n        if (idx >= this.length || idx < 0) {\n            return;\n        }\n        const last = --this.length;\n        this.array[idx] = this.array[last];\n    }\n\n    /**\n     * @en Returns the first index at which a given element can be found in the array.\n     * @zh 返回在数组中可以找到一个给定元素的第一个索引。\n     * @param val The element\n     */\n    public indexOf (val: T) {\n        for (let i = 0, len = this.length; i < len; ++i) {\n            if (this.array[i] === val) {\n                return i;\n            }\n        }\n        return -1;\n    }\n}\n","/**\n * Tag to visit editor extras of an object. Never concern about its value please.\n * @internal\n */\nexport const editorExtrasTag = '__editorExtras__';\n\n/**\n * Engine classes with this kind of signatures are integrated with editor extendability.\n * @internal\n */\nexport interface EditorExtendableObject {\n    /**\n     * @en\n     * The editor extras on this object.\n     *\n     * BE CAREFUL: this property is currently governed by Cocos Creator Editor.\n     * Its definition is not visible and is unknown to both engine code or users codes,\n     * they SHALL NOT operates it.\n     *\n     * You should use editor extras tag to visit this property.\n     * @example\n     * ```ts\n     * import { editorExtrasTag } from 'cc';\n     * node[editorExtrasTag] = {};\n     * node[editorExtrasTag].someWhat;\n     * ```\n     * Even if you know `editorExtrasTag === '__editorExtras__'` in current,\n     * don't access the property through that:\n     * ```ts\n     * node.__editorExtras__ = {}; // Error: might be break in future.\n     * ```\n     * @zh\n     * 此对象的编辑器额外数据。\n     *\n     * **注意**：此属性目前由 Cocos Creator 编辑器管理。\n     * 它的定义不管是对于引擎还是用户代码都是不可见的，也 **不应该** 操作该数据。\n     *\n     * 你应该仅使用编辑器额外数据标签来访问此数据。\n     * @example\n     * ```ts\n     * import { editorExtrasTag } from 'cc';\n     * node[editorExtrasTag] = {};\n     * node[editorExtrasTag].someWhat;\n     * ```\n     * 即使你知道目前 `editorExtrasTag === '__editorExtras__'`，\n     * 也不要通过字符串属性来访问：\n     * ```ts\n     * node.__editorExtras__ = {}; // 错误：在未来可能无法生效\n     * ```\n     */\n    [editorExtrasTag]: unknown;\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { SUPPORT_JIT, EDITOR, TEST, JSB } from 'internal:constants';\nimport * as js from '../utils/js';\nimport { CCClass } from './class';\nimport { errorID, warnID } from '../platform/debug';\nimport { legacyCC } from '../global-exports';\nimport { EditorExtendableObject, editorExtrasTag } from './editor-extras-tag';\nimport { copyAllProperties } from '../utils/js';\n\n// definitions for CCObject.Flags\n\nconst Destroyed = 1 << 0;\nconst RealDestroyed = 1 << 1;\nconst ToDestroy = 1 << 2;\nconst DontSave = 1 << 3;\nconst EditorOnly = 1 << 4;\nconst Dirty = 1 << 5;\nconst DontDestroy = 1 << 6;\nconst Destroying = 1 << 7;\nconst Deactivating = 1 << 8;\nconst LockedInEditor = 1 << 9;\nconst HideInHierarchy = 1 << 10;\n\nconst IsOnEnableCalled = 1 << 11;\nconst IsEditorOnEnableCalled = 1 << 12;\nconst IsPreloadStarted = 1 << 13;\nconst IsOnLoadCalled = 1 << 14;\nconst IsOnLoadStarted = 1 << 15;\nconst IsStartCalled = 1 << 16;\n\nconst IsRotationLocked = 1 << 17;\nconst IsScaleLocked = 1 << 18;\nconst IsAnchorLocked = 1 << 19;\nconst IsSizeLocked = 1 << 20;\nconst IsPositionLocked = 1 << 21;\n\n// Distributed\nconst IsReplicated = 1 << 22;\nexport const IsClientLoad = 1 << 23;\n\n// var Hide = HideInGame | HideInEditor;\n// should not clone or serialize these flags\nconst PersistentMask = ~(ToDestroy | Dirty | Destroying | DontDestroy | Deactivating\n                       | IsPreloadStarted | IsOnLoadStarted | IsOnLoadCalled | IsStartCalled\n                       | IsOnEnableCalled | IsEditorOnEnableCalled\n                       | IsRotationLocked | IsScaleLocked | IsAnchorLocked | IsSizeLocked | IsPositionLocked\n/* RegisteredInEditor */);\n\n// all the hideFlags\nconst AllHideMasks = DontSave | EditorOnly | LockedInEditor | HideInHierarchy;\n\nconst objectsToDestroy: any = [];\nlet deferredDestroyTimer = null;\n\nfunction compileDestruct (obj, ctor) {\n    const shouldSkipId = obj instanceof legacyCC._BaseNode || obj instanceof legacyCC.Component;\n    const idToSkip = shouldSkipId ? '_id' : null;\n\n    let key;\n    const propsToReset = {};\n    for (key in obj) {\n        // eslint-disable-next-line no-prototype-builtins\n        if (obj.hasOwnProperty(key)) {\n            if (key === idToSkip) {\n                continue;\n            }\n            switch (typeof obj[key]) {\n            case 'string':\n                propsToReset[key] = '';\n                break;\n            case 'object':\n            case 'function':\n                propsToReset[key] = null;\n                break;\n            default:\n                break;\n            }\n        }\n    }\n    // Overwrite propsToReset according to Class\n    if (CCClass._isCCClass(ctor)) {\n        const attrs = legacyCC.Class.Attr.getClassAttrs(ctor);\n        const propList = ctor.__props__;\n\n        for (let i = 0; i < propList.length; i++) {\n            key = propList[i];\n            // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n            const attrKey = `${key}`;\n            if (attrKey in attrs) {\n                if (shouldSkipId && key === '_id') {\n                    continue;\n                }\n                switch (typeof attrs[attrKey]) {\n                case 'string':\n                    propsToReset[key] = '';\n                    break;\n                case 'object':\n                case 'function':\n                    propsToReset[key] = null;\n                    break;\n                case 'undefined':\n                    propsToReset[key] = undefined;\n                    break;\n                default:\n                    break;\n                }\n            }\n        }\n    }\n\n    if (SUPPORT_JIT) {\n        // compile code\n        let func = '';\n\n        for (key in propsToReset) {\n            let statement;\n            if (CCClass.IDENTIFIER_RE.test(key)) {\n                statement = `o.${key}=`;\n            } else {\n                statement = `o[${CCClass.escapeForJS(key)}]=`;\n            }\n            let val = propsToReset[key];\n            if (val === '') {\n                val = '\"\"';\n            }\n            // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n            func += (`${statement + val};\\n`);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-implied-eval,no-new-func\n        return Function('o', func);\n    } else {\n        return (o) => {\n            for (const _key in propsToReset) {\n                o[_key] = propsToReset[_key];\n            }\n        };\n    }\n}\n\n/**\n * @en\n * The base class of most of all the objects in Fireball.\n * @zh\n * 大部分对象的基类。\n * @private\n */\nclass CCObject implements EditorExtendableObject {\n    public static _deferredDestroy () {\n        const deleteCount = objectsToDestroy.length;\n        for (let i = 0; i < deleteCount; ++i) {\n            const obj = objectsToDestroy[i];\n            if (!(obj._objFlags & Destroyed)) {\n                obj._destroyImmediate();\n            }\n        }\n        // if we called b.destory() in a.onDestroy(), objectsToDestroy will be resized,\n        // but we only destroy the objects which called destory in this frame.\n        if (deleteCount === objectsToDestroy.length) {\n            objectsToDestroy.length = 0;\n        } else {\n            objectsToDestroy.splice(0, deleteCount);\n        }\n\n        if (EDITOR) {\n            deferredDestroyTimer = null;\n        }\n    }\n\n    /**\n     * @internal\n     */\n    public declare [editorExtrasTag]: unknown;\n\n    /**\n     * @internal\n     */\n    public _objFlags: number;\n    protected _name: string;\n\n    constructor (name = '') {\n        /**\n         * @default \"\"\n         * @private\n         */\n        this._name = name;\n\n        /**\n         * @default 0\n         * @private\n         */\n        this._objFlags = 0;\n    }\n\n    // MEMBER\n\n    /**\n     * @en The name of the object.\n     * @zh 该对象的名称。\n     * @default \"\"\n     * @example\n     * ```\n     * obj.name = \"New Obj\";\n     * ```\n     */\n    get name () {\n        return this._name;\n    }\n    set name (value) {\n        this._name = value;\n    }\n\n    /**\n     * @en After inheriting CCObject objects, control whether you need to hide, lock, serialize, and other functions.\n     * @zh 在继承 CCObject 对象后，控制是否需要隐藏，锁定，序列化等功能。\n     */\n    public set hideFlags (hideFlags: CCObject.Flags) {\n        const flags = hideFlags & CCObject.Flags.AllHideMasks;\n        this._objFlags = (this._objFlags & ~CCObject.Flags.AllHideMasks) | flags;\n    }\n    public get hideFlags () {\n        return this._objFlags & CCObject.Flags.AllHideMasks;\n    }\n\n    public set replicated (value: boolean) {\n        if (value) {\n            this._objFlags |= IsReplicated;\n        } else {\n            this._objFlags &= ~IsReplicated;\n        }\n    }\n    public get replicated () {\n        return !!(this._objFlags & IsReplicated);\n    }\n\n    /**\n     * @en\n     * Indicates whether the object is not yet destroyed. (It will not be available after being destroyed)<br>\n     * When an object's `destroy` is called, it is actually destroyed after the end of this frame.\n     * So `isValid` will return false from the next frame, while `isValid` in the current frame will still be true.\n     * If you want to determine whether the current frame has called `destroy`, use `isValid(obj, true)`,\n     * but this is often caused by a particular logical requirements, which is not normally required.\n     *\n     * @zh\n     * 表示该对象是否可用（被 destroy 后将不可用）。<br>\n     * 当一个对象的 `destroy` 调用以后，会在这一帧结束后才真正销毁。<br>\n     * 因此从下一帧开始 `isValid` 就会返回 false，而当前帧内 `isValid` 仍然会是 true。<br>\n     * 如果希望判断当前帧是否调用过 `destroy`，请使用 `isValid(obj, true)`，不过这往往是特殊的业务需求引起的，通常情况下不需要这样。\n     * @default true\n     * @readOnly\n     * @example\n     * ```ts\n     * import { Node, log } from 'cc';\n     * const node = new Node();\n     * log(node.isValid);    // true\n     * node.destroy();\n     * log(node.isValid);    // true, still valid in this frame\n     * // after a frame...\n     * log(node.isValid);    // false, destroyed in the end of last frame\n     * ```\n     */\n    get isValid (): boolean {\n        return !(this._objFlags & Destroyed);\n    }\n\n    /**\n     * @en\n     * Destroy this Object, and release all its own references to other objects.<br/>\n     * Actual object destruction will delayed until before rendering.\n     * From the next frame, this object is not usable any more.\n     * You can use `isValid(obj)` to check whether the object is destroyed before accessing it.\n     * @zh\n     * 销毁该对象，并释放所有它对其它对象的引用。<br/>\n     * 实际销毁操作会延迟到当前帧渲染前执行。从下一帧开始，该对象将不再可用。\n     * 您可以在访问对象之前使用 `isValid(obj)` 来检查对象是否已被销毁。\n     * @return whether it is the first time the destroy being called\n     * @example\n     * ```\n     * obj.destroy();\n     * ```\n     */\n    public destroy (): boolean {\n        if (this._objFlags & Destroyed) {\n            warnID(5000);\n            return false;\n        }\n        if (this._objFlags & ToDestroy) {\n            return false;\n        }\n        this._objFlags |= ToDestroy;\n        objectsToDestroy.push(this);\n\n        if (EDITOR && deferredDestroyTimer === null && legacyCC.engine && !legacyCC.engine._isUpdating) {\n            // auto destroy immediate in edit mode\n            // @ts-expect-error no function\n            deferredDestroyTimer = setTimeout(CCObject._deferredDestroy);\n        }\n\n        if (JSB) {\n            // @ts-expect-error JSB method\n            this._destroy();\n        }\n\n        return true;\n    }\n\n    /**\n     * @en\n     * Clear all references in the instance.\n     *\n     * NOTE: this method will not clear the getter or setter functions which defined in the instance of CCObject.\n     *\n     * @zh\n     * 清理实例的所有引用\n     * 注意：此方法不会清理实例上的 getter 与 setter 方法。\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     * @example\n     * ```\n     * // You can override the _destruct method if you need, for example:\n     *       _destruct: function () {\n     *           for (var key in this) {\n     *               if (this.hasOwnProperty(key)) {\n     *                   switch (typeof this[key]) {\n     *                       case 'string':\n     *                           this[key] = '';\n     *                           break;\n     *                       case 'object':\n     *                       case 'function':\n     *                           this[key] = null;\n     *                           break;\n     *               }\n     *           }\n     *       }\n     * ```\n     */\n    public _destruct () {\n        const ctor: any = this.constructor;\n        let destruct = ctor.__destruct__;\n        if (!destruct) {\n            destruct = compileDestruct(this, ctor);\n            js.value(ctor, '__destruct__', destruct, true);\n        }\n        destruct(this);\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _destroyImmediate () {\n        if (this._objFlags & Destroyed) {\n            errorID(5000);\n            return;\n        }\n        // engine internal callback\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error\n        if (this._onPreDestroy) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-expect-error\n            this._onPreDestroy();\n        }\n\n        if (!EDITOR || legacyCC.GAME_VIEW) {\n            this._destruct();\n        }\n\n        this._objFlags |= Destroyed;\n    }\n}\n\nconst prototype = CCObject.prototype;\nif (EDITOR || TEST) {\n    js.get(prototype, 'isRealValid', function (this: CCObject) {\n        return !(this._objFlags & RealDestroyed);\n    });\n\n    /**\n     * @en After inheriting CCObject objects, control whether you need to hide, lock, serialize, and other functions.\n     * This method is only available for editors and is not recommended for developers\n     * @zh 在继承 CCObject 对象后，控制是否需要隐藏，锁定，序列化等功能(该方法仅提供给编辑器使用，不建议开发者使用)。\n     */\n    js.getset(prototype, 'objFlags',\n        function (this: CCObject) {\n            return this._objFlags;\n        },\n        function (this: CCObject, objFlags: CCObject.Flags) {\n            this._objFlags = objFlags;\n        });\n\n    /*\n    * @en\n    * In fact, Object's \"destroy\" will not trigger the destruct operation in Firebal Editor.\n    * The destruct operation will be executed by Undo system later.\n    * @zh\n    * 事实上，对象的 “destroy” 不会在编辑器中触发析构操作，\n    * 析构操作将在 Undo 系统中**延后**执行。\n    * @method realDestroyInEditor\n    * @private\n    */\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    prototype.realDestroyInEditor = function () {\n        if (!(this._objFlags & Destroyed)) {\n            warnID(5001);\n            return;\n        }\n        if (this._objFlags & RealDestroyed) {\n            warnID(5000);\n            return;\n        }\n        this._destruct();\n        this._objFlags |= RealDestroyed;\n    };\n}\n\nif (EDITOR) {\n    js.value(CCObject, '_clearDeferredDestroyTimer', () => {\n        if (deferredDestroyTimer !== null) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-expect-error\n            clearImmediate(deferredDestroyTimer);\n            deferredDestroyTimer = null;\n        }\n    });\n\n    /*\n     * The customized serialization for this object. (Editor Only)\n     * @method _serialize\n     * @param {Boolean} exporting\n     * @return {object} the serialized json data object\n     * @private\n     */\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    prototype._serialize = null;\n}\n\n/*\n * Init this object from the custom serialized data.\n * @method _deserialize\n * @param {Object} data - the serialized json data\n * @param {_Deserializer} ctx\n * @private\n */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-expect-error\nprototype._deserialize = null;\n/*\n * Called before the object being destroyed.\n * @method _onPreDestroy\n * @private\n */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-expect-error\nprototype._onPreDestroy = null;\n\nCCClass.fastDefine('cc.Object', CCObject, { _name: '', _objFlags: 0, [editorExtrasTag]: {} });\nCCClass.Attr.setClassAttr(CCObject, editorExtrasTag, 'editorOnly', true);\nCCClass.Attr.setClassAttr(CCObject, 'replicated', 'visible', false);\n\n/**\n * Bit mask that controls object states.\n * @enum Object.Flags\n * @private\n */\njs.value(CCObject, 'Flags', {\n    Destroyed,\n    DontSave,\n    EditorOnly,\n    Dirty,\n    DontDestroy,\n    PersistentMask,\n    Destroying,\n    Deactivating,\n    LockedInEditor,\n    HideInHierarchy,\n    AllHideMasks,\n    IsPreloadStarted,\n    IsOnLoadStarted,\n    IsOnLoadCalled,\n    IsOnEnableCalled,\n    IsStartCalled,\n    IsEditorOnEnableCalled,\n    IsPositionLocked,\n    IsRotationLocked,\n    IsScaleLocked,\n    IsAnchorLocked,\n    IsSizeLocked,\n});\n\ndeclare namespace CCObject {\n    export enum Flags {\n        Destroyed,\n        // ToDestroy: ToDestroy,\n\n        /**\n         * @en The object will not be saved.\n         * @zh 该对象将不会被保存。\n         */\n        DontSave,\n\n        /**\n         * @en The object will not be saved when building a player.\n         * @zh 构建项目时，该对象将不会被保存。\n         */\n        EditorOnly,\n\n        Dirty,\n\n        /**\n         * @en Dont destroy automatically when loading a new scene.\n         * @zh 加载一个新场景时，不自动删除该对象。\n         * @private\n         */\n        DontDestroy,\n\n        /**\n         * @en\n         * @zh\n         * @private\n         */\n        PersistentMask,\n\n        // FLAGS FOR ENGINE\n\n        /**\n         * @en\n         * @zh\n         * @private\n         */\n        Destroying,\n\n        /**\n         * @en The node is deactivating.\n         * @zh 节点正在反激活的过程中。\n         * @private\n         */\n        Deactivating,\n\n        /**\n         * @en\n         * Hide in game and hierarchy.\n         * This flag is readonly, it can only be used as an argument of scene.addEntity() or Entity.createWithFlags().\n         * @zh\n         * 在游戏和层级中隐藏该对象。<br/>\n         * 该标记只读，它只能被用作 scene.addEntity()的一个参数。\n         */\n        // HideInGame: HideInGame,\n\n        /**\n         * @en The lock node, when the node is locked, cannot be clicked in the scene.\n         * @zh 锁定节点，锁定后场景内不能点击。\n         * @private\n         */\n        LockedInEditor,\n\n        /**\n          * @en Hide the object in editor.\n          * @zh 在编辑器中隐藏该对象。\n          */\n        HideInHierarchy,\n\n        /**\n          * @en The object will not be saved and hide the object in editor,and lock node, when the node is locked,\n          * cannot be clicked in the scene,and The object will not be saved when building a player.\n          * @zh 该对象将不会被保存,构建项目时，该对象将不会被保存, 锁定节点，锁定后场景内不能点击, 在编辑器中隐藏该对象。\n          */\n        AllHideMasks,\n\n        // FLAGS FOR EDITOR\n\n        /**\n         * @en\n         * Hide in game view, hierarchy, and scene view... etc.\n         * This flag is readonly, it can only be used as an argument of scene.addEntity() or Entity.createWithFlags().\n         * @zh\n         * 在游戏视图，层级，场景视图等等...中隐藏该对象。\n         * 该标记只读，它只能被用作 scene.addEntity()的一个参数。\n         */\n        // Hide: Hide,\n\n        // FLAGS FOR COMPONENT\n\n        IsPreloadStarted,\n        IsOnLoadStarted,\n        IsOnLoadCalled,\n        IsOnEnableCalled,\n        IsStartCalled,\n        IsEditorOnEnableCalled,\n\n        IsPositionLocked,\n        IsRotationLocked,\n        IsScaleLocked,\n        IsAnchorLocked,\n        IsSizeLocked,\n\n        IsReplicated,\n        IsClientLoad,\n    }\n\n    // for @ccclass\n    let __props__: string[];\n    let __values__: string[];\n}\n\n/*\n * @en\n * Checks whether the object is a CCObject.<br>\n *\n * @zh\n * 检查该对象是否为CCObject。<br>\n *\n * @method isCCObject\n * @param object\n * @return @en Whether it is a CCObject boolean value. @zh 是否为CCObject的布尔值。\n */\nexport function isCCObject (object: any) {\n    return object instanceof CCObject;\n}\n\n/*\n * @en\n * Checks whether the object is non-nil and not yet destroyed.<br>\n * When an object's `destroy` is called, it is actually destroyed after the end of this frame.\n * So `isValid` will return false from the next frame, while `isValid` in the current frame will still be true.\n * If you want to determine whether the current frame has called `destroy`, use `isValid(obj, true)`,\n * but this is often caused by a particular logical requirements, which is not normally required.\n *\n * @zh\n * 检查该对象是否不为 null 并且尚未销毁。<br>\n * 当一个对象的 `destroy` 调用以后，会在这一帧结束后才真正销毁。<br>\n * 因此从下一帧开始 `isValid` 就会返回 false，而当前帧内 `isValid` 仍然会是 true。<br>\n * 如果希望判断当前帧是否调用过 `destroy`，请使用 `isValid(obj, true)`，不过这往往是特殊的业务需求引起的，通常情况下不需要这样。\n *\n * @method isValid\n * @param value\n * @param [strictMode=false] - If true, Object called destroy() in this frame will also treated as invalid.\n * @return whether is valid\n * @example\n * ```\n * import { Node, log } from 'cc';\n * var node = new Node();\n * log(isValid(node));    // true\n * node.destroy();\n * log(isValid(node));    // true, still valid in this frame\n * // after a frame...\n * log(isValid(node));    // false, destroyed in the end of last frame\n * ```\n */\nexport function isValid (value: any, strictMode?: boolean) {\n    if (typeof value === 'object') {\n        return !!value && !(value._objFlags & (strictMode ? (Destroyed | ToDestroy) : Destroyed));\n    } else {\n        return typeof value !== 'undefined';\n    }\n}\nlegacyCC.isValid = isValid;\n\nif (EDITOR || TEST) {\n    js.value(CCObject, '_willDestroy', (obj) => !(obj._objFlags & Destroyed) && (obj._objFlags & ToDestroy) > 0);\n    js.value(CCObject, '_cancelDestroy', (obj) => {\n        obj._objFlags &= ~ToDestroy;\n        js.array.fastRemove(objectsToDestroy, obj);\n    });\n}\n\ndeclare const jsb: any;\n\nif (JSB) {\n    copyAllProperties(CCObject, jsb.CCObject, ['prototype', 'length', 'name']);\n    copyAllProperties(CCObject.prototype, jsb.CCObject.prototype,\n        ['constructor', 'name', 'hideFlags', 'replicated', 'isValid']);\n\n    // @ts-expect-error TS2629\n    // eslint-disable-next-line no-class-assign\n    CCObject = jsb.CCObject;\n}\n\nlegacyCC.Object = CCObject;\nexport { CCObject };\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { TEST } from 'internal:constants';\nimport { Pool } from '../memop';\nimport { array, createMap } from '../utils/js';\nimport { isCCObject, isValid } from '../data/object';\nimport { legacyCC } from '../global-exports';\n\nconst fastRemoveAt = array.fastRemoveAt;\n\nfunction empty () { }\n\nclass CallbackInfo {\n    public callback: AnyFunction = empty;\n    public target: unknown | undefined = undefined;\n    public once = false;\n\n    public set (callback: AnyFunction, target?: unknown, once?: boolean) {\n        this.callback = callback || empty;\n        this.target = target;\n        this.once = !!once;\n    }\n\n    public reset () {\n        this.target = undefined;\n        this.callback = empty;\n        this.once = false;\n    }\n\n    public check () {\n        // Validation\n        if (isCCObject(this.target) && !isValid(this.target, true)) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n}\n\nconst callbackInfoPool = new Pool(() => new CallbackInfo(), 32);\n/**\n * @zh 事件监听器列表的简单封装。\n * @en A simple list of event callbacks\n */\nexport class CallbackList {\n    public callbackInfos: Array<CallbackInfo | null> = [];\n    public isInvoking = false;\n    public containCanceled = false;\n\n    /**\n     * @zh 从列表中移除与指定目标相同回调函数的事件。\n     * @en Remove the event listeners with the given callback from the list\n     *\n     * @param cb - The callback to be removed\n     */\n    public removeByCallback (cb: AnyFunction) {\n        for (let i = 0; i < this.callbackInfos.length; ++i) {\n            const info = this.callbackInfos[i];\n            if (info && info.callback === cb) {\n                info.reset();\n                callbackInfoPool.free(info);\n                fastRemoveAt(this.callbackInfos, i);\n                --i;\n            }\n        }\n    }\n    /**\n     * @zh 从列表中移除与指定目标相同调用者的事件。\n     * @en Remove the event listeners with the given target from the list\n     * @param target\n     */\n    public removeByTarget (target: unknown) {\n        for (let i = 0; i < this.callbackInfos.length; ++i) {\n            const info = this.callbackInfos[i];\n            if (info && info.target === target) {\n                info.reset();\n                callbackInfoPool.free(info);\n                fastRemoveAt(this.callbackInfos, i);\n                --i;\n            }\n        }\n    }\n\n    /**\n     * @zh 移除指定编号事件。\n     * @en Remove the event listener at the given index\n     * @param index\n     */\n    public cancel (index: number) {\n        const info = this.callbackInfos[index];\n        if (info) {\n            info.reset();\n            if (this.isInvoking) {\n                this.callbackInfos[index] = null;\n            } else {\n                fastRemoveAt(this.callbackInfos, index);\n            }\n            callbackInfoPool.free(info);\n        }\n        this.containCanceled = true;\n    }\n\n    /**\n     * @zh 注销所有事件。\n     * @en Cancel all event listeners\n     */\n    public cancelAll () {\n        for (let i = 0; i < this.callbackInfos.length; i++) {\n            const info = this.callbackInfos[i];\n            if (info) {\n                info.reset();\n                callbackInfoPool.free(info);\n                this.callbackInfos[i] = null;\n            }\n        }\n        this.containCanceled = true;\n    }\n\n    /**\n     * @zh 立即删除所有取消的回调。（在移除过程中会更加紧凑的排列数组）\n     * @en Delete all canceled callbacks and compact array\n     */\n    public purgeCanceled () {\n        for (let i = this.callbackInfos.length - 1; i >= 0; --i) {\n            const info = this.callbackInfos[i];\n            if (!info) {\n                fastRemoveAt(this.callbackInfos, i);\n            }\n        }\n        this.containCanceled = false;\n    }\n\n    /**\n     * @zh 清除并重置所有数据。\n     * @en Clear all data\n     */\n    public clear () {\n        this.cancelAll();\n        this.callbackInfos.length = 0;\n        this.isInvoking = false;\n        this.containCanceled = false;\n    }\n}\n\nconst MAX_SIZE = 16;\nconst callbackListPool = new Pool<CallbackList>(() => new CallbackList(), MAX_SIZE);\n\nexport interface ICallbackTable {\n    [x: string]: CallbackList | undefined;\n}\n\ntype EventType = string | number;\n/**\n * @zh CallbacksInvoker 用来根据事件名（Key）管理事件监听器列表并调用回调方法。\n * @en CallbacksInvoker is used to manager and invoke event listeners with different event keys,\n * each key is mapped to a CallbackList.\n */\nexport class CallbacksInvoker<EventTypeClass extends EventType = EventType> {\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _callbackTable: ICallbackTable = createMap(true);\n    private _offCallback?: () => void;\n\n    /**\n     * @zh 向一个事件名注册一个新的事件监听器，包含回调函数和调用者\n     * @en Register an event listener to a given event key with callback and target.\n     *\n     * @param key - Event type\n     * @param callback - Callback function when event triggered\n     * @param target - Callback callee\n     * @param once - Whether invoke the callback only once (and remove it)\n     */\n    public on (key: EventTypeClass, callback: AnyFunction, target?: unknown, once?: boolean) {\n        if (!this.hasEventListener(key, callback, target)) {\n            let list = this._callbackTable[key];\n            if (!list) {\n                list = this._callbackTable[key] = callbackListPool.alloc();\n            }\n            const info = callbackInfoPool.alloc();\n            info.set(callback, target, once);\n            list.callbackInfos.push(info);\n        }\n        return callback;\n    }\n\n    /**\n     * @zh 检查指定事件是否已注册回调。\n     * @en Checks whether there is correspond event listener registered on the given event\n     * @param key - Event type\n     * @param callback - Callback function when event triggered\n     * @param target - Callback callee\n     */\n    public hasEventListener (key: EventTypeClass, callback?: AnyFunction, target?: unknown) {\n        const list = this._callbackTable && this._callbackTable[key];\n        if (!list) {\n            return false;\n        }\n\n        // check any valid callback\n        const infos = list.callbackInfos;\n        if (!callback) {\n            // Make sure no cancelled callbacks\n            if (list.isInvoking) {\n                for (let i = 0; i < infos.length; ++i) {\n                    if (infos[i]) {\n                        return true;\n                    }\n                }\n                return false;\n            } else {\n                return infos.length > 0;\n            }\n        }\n\n        for (let i = 0; i < infos.length; ++i) {\n            const info = infos[i];\n            if (info && info.check() && info.callback === callback && info.target === target) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * @zh 移除在特定事件类型中注册的所有回调或在某个目标中注册的所有回调。\n     * @en Removes all callbacks registered in a certain event type or all callbacks registered with a certain target\n     * @param keyOrTarget - The event type or target with which the listeners will be removed\n     */\n    public removeAll (keyOrTarget: EventTypeClass | unknown) {\n        const type = typeof keyOrTarget;\n        if (type === 'string' || type === 'number') {\n            // remove by key\n            const list = this._callbackTable && this._callbackTable[keyOrTarget as string|number];\n            if (list) {\n                if (list.isInvoking) {\n                    list.cancelAll();\n                } else {\n                    list.clear();\n                    callbackListPool.free(list);\n                    delete this._callbackTable[keyOrTarget as string|number];\n                }\n            }\n        } else if (keyOrTarget) {\n            // remove by target\n            for (const key in this._callbackTable) {\n                const list = this._callbackTable[key]!;\n                if (list.isInvoking) {\n                    const infos = list.callbackInfos;\n                    for (let i = 0; i < infos.length; ++i) {\n                        const info = infos[i];\n                        if (info && info.target === keyOrTarget) {\n                            list.cancel(i);\n                        }\n                    }\n                } else {\n                    list.removeByTarget(keyOrTarget);\n                }\n            }\n        }\n    }\n\n    /**\n     * @zh 删除以指定事件，回调函数，目标注册的回调。\n     * @en Remove event listeners registered with the given event key, callback and target\n     * @param key - Event type\n     * @param callback - The callback function of the event listener, if absent all event listeners for the given type will be removed\n     * @param target - The callback callee of the event listener\n     */\n    public off (key: EventTypeClass, callback?: AnyFunction, target?: unknown) {\n        const list = this._callbackTable && this._callbackTable[key];\n        if (list) {\n            const infos = list.callbackInfos;\n            if (callback) {\n                for (let i = 0; i < infos.length; ++i) {\n                    const info = infos[i];\n                    if (info && info.callback === callback && info.target === target) {\n                        list.cancel(i);\n                        break;\n                    }\n                }\n            } else {\n                this.removeAll(key);\n            }\n        }\n        this._offCallback?.();\n    }\n\n    /**\n     * @zh 派发一个指定事件，并传递需要的参数\n     * @en Trigger an event directly with the event name and necessary arguments.\n     * @param key - event type\n     * @param arg0 - The first argument to be passed to the callback\n     * @param arg1 - The second argument to be passed to the callback\n     * @param arg2 - The third argument to be passed to the callback\n     * @param arg3 - The fourth argument to be passed to the callback\n     * @param arg4 - The fifth argument to be passed to the callback\n     */\n    public emit (key: EventTypeClass, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) {\n        const list: CallbackList = this._callbackTable && this._callbackTable[key]!;\n        if (list) {\n            const rootInvoker = !list.isInvoking;\n            list.isInvoking = true;\n\n            const infos = list.callbackInfos;\n            for (let i = 0, len = infos.length; i < len; ++i) {\n                const info = infos[i];\n                if (info) {\n                    const callback = info.callback;\n                    const target = info.target;\n                    // Pre off once callbacks to avoid influence on logic in callback\n                    if (info.once) {\n                        this.off(key, callback, target);\n                    }\n                    // Lazy check validity of callback target,\n                    // if target is CCObject and is no longer valid, then remove the callback info directly\n                    if (!info.check()) {\n                        this.off(key, callback, target);\n                    } else if (target) {\n                        callback.call(target, arg0, arg1, arg2, arg3, arg4);\n                    } else {\n                        callback(arg0, arg1, arg2, arg3, arg4);\n                    }\n                }\n            }\n\n            if (rootInvoker) {\n                list.isInvoking = false;\n                if (list.containCanceled) {\n                    list.purgeCanceled();\n                }\n            }\n        }\n    }\n\n    /**\n     * 移除所有回调。\n     */\n    public clear () {\n        for (const key in this._callbackTable) {\n            const list = this._callbackTable[key];\n            if (list) {\n                list.clear();\n                callbackListPool.free(list);\n                delete this._callbackTable[key];\n            }\n        }\n    }\n\n    private _registerOffCallback (cb: () => void) {\n        this._offCallback = cb;\n    }\n}\n\nif (TEST) {\n    legacyCC._Test.CallbacksInvoker = CallbacksInvoker;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { CallbacksInvoker } from './callbacks-invoker';\nimport { createMap } from '../utils/js';\n\ntype Constructor<T> = new (...args: any[]) => T;\n\ntype EventType = string | number;\n\n/**\n * @zh\n * 实现该接口的对象具有处理事件的能力。\n * @en\n * Objects those implement this interface have essentially the capability to process events.\n */\nexport interface IEventified {\n    /**\n     * @zh 检查指定事件是否已注册回调。\n     * @en Checks whether there is correspond event listener registered on the given event.\n     * @param type - Event type.\n     * @param callback - Callback function when event triggered.\n     * @param target - Callback callee.\n     */\n    hasEventListener (type: string, callback?: (...any) => void, target?: any): boolean;\n\n    /**\n     * @en\n     * Register an callback of a specific event type on the EventTarget.\n     * This type of event should be triggered via `emit`.\n     * @zh\n     * 注册事件目标的特定事件类型回调。这种类型的事件应该被 `emit` 触发。\n     *\n     * @param type - A string representing the event type to listen for.\n     * @param callback - The callback that will be invoked when the event is dispatched.\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\n     * @param thisArg - The target (this object) to invoke the callback, can be null\n     * @return - Just returns the incoming callback so you can save the anonymous function easier.\n     * @example\n     * import { log } from 'cc';\n     * eventTarget.on('fire', function () {\n     *     log(\"fire in the hole\");\n     * }, node);\n     */\n    on<TFunction extends (...any) => void> (type: EventType, callback: TFunction, thisArg?: any, once?: boolean): typeof callback;\n\n    /**\n     * @en\n     * Register an callback of a specific event type on the EventTarget,\n     * the callback will remove itself after the first time it is triggered.\n     * @zh\n     * 注册事件目标的特定事件类型回调，回调会在第一时间被触发后删除自身。\n     *\n     * @param type - A string representing the event type to listen for.\n     * @param callback - The callback that will be invoked when the event is dispatched.\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\n     * @param target - The target (this object) to invoke the callback, can be null\n     * @example\n     * import { log } from 'cc';\n     * eventTarget.once('fire', function () {\n     *     log(\"this is the callback and will be invoked only once\");\n     * }, node);\n     */\n    once<TFunction extends (...any) => void> (type: EventType, callback: TFunction, thisArg?: any): typeof callback;\n\n    /**\n     * @en\n     * Removes the listeners previously registered with the same type, callback, target and or useCapture,\n     * if only type is passed as parameter, all listeners registered with that type will be removed.\n     * @zh\n     * 删除之前用同类型，回调，目标或 useCapture 注册的事件监听器，如果只传递 type，将会删除 type 类型的所有事件监听器。\n     *\n     * @param type - A string representing the event type being removed.\n     * @param callback - The callback to remove.\n     * @param target - The target (this object) to invoke the callback, if it's not given, only callback without target will be removed\n     * @example\n     * import { log } from 'cc';\n     * // register fire eventListener\n     * var callback = eventTarget.on('fire', function () {\n     *     log(\"fire in the hole\");\n     * }, target);\n     * // remove fire event listener\n     * eventTarget.off('fire', callback, target);\n     * // remove all fire event listeners\n     * eventTarget.off('fire');\n     */\n    off<TFunction extends (...any) => void> (type: EventType, callback?: TFunction, thisArg?: any): void;\n\n    /**\n     * @en Removes all callbacks previously registered with the same target (passed as parameter).\n     * This is not for removing all listeners in the current event target,\n     * and this is not for removing all listeners the target parameter have registered.\n     * It's only for removing all listeners (callback and target couple) registered on the current event target by the target parameter.\n     * @zh 在当前 EventTarget 上删除指定目标（target 参数）注册的所有事件监听器。\n     * 这个函数无法删除当前 EventTarget 的所有事件监听器，也无法删除 target 参数所注册的所有事件监听器。\n     * 这个函数只能删除 target 参数在当前 EventTarget 上注册的所有事件监听器。\n     * @param typeOrTarget - The target to be searched for all related listeners\n     */\n    targetOff (typeOrTarget: any): void;\n\n    /**\n     * @zh 移除在特定事件类型中注册的所有回调或在某个目标中注册的所有回调。\n     * @en Removes all callbacks registered in a certain event type or all callbacks registered with a certain target\n     * @param typeOrTarget - The event type or target with which the listeners will be removed\n     */\n    removeAll (typeOrTarget: any): void;\n\n    /**\n     * @zh 派发一个指定事件，并传递需要的参数\n     * @en Trigger an event directly with the event name and necessary arguments.\n     * @param type - event type\n     * @param args - Arguments when the event triggered\n     */\n    emit (type: EventType, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any): void;\n}\n\n/**\n * @en Generate a new class from the given base class, after polyfill all functionalities in [[IEventified]] as if it's extended from [[EventTarget]]\n * @zh 生成一个类，该类继承自指定的基类，并以和 [[EventTarget]] 等同的方式实现了 [[IEventified]] 的所有接口。\n * @param base The base class\n * @example\n * ```ts\n * class Base { say() { console.log('Hello!'); } }\n * class MyClass extends Eventify(Base) { }\n * function (o: MyClass) {\n *     o.say(); // Ok: Extend from `Base`\n *     o.emit('sing', 'The ghost'); // Ok: `MyClass` implements IEventified\n * }\n * ```\n */\nexport function Eventify<TBase> (base: Constructor<TBase>): Constructor<TBase & IEventified> {\n    class Eventified extends (base as unknown as any) {\n        private _callbackTable = createMap(true);\n\n        public once<Callback extends (...any) => void> (type: EventType, callback: Callback, target?: any) {\n            return this.on(type, callback, target, true) as Callback;\n        }\n\n        public targetOff (typeOrTarget: any) {\n            this.removeAll(typeOrTarget);\n        }\n    }\n\n    // Mixin with `CallbacksInvokers`'s prototype\n    const callbacksInvokerPrototype = CallbacksInvoker.prototype;\n    const propertyKeys: (string | symbol)[] =        (Object.getOwnPropertyNames(callbacksInvokerPrototype) as (string | symbol)[]).concat(\n        Object.getOwnPropertySymbols(callbacksInvokerPrototype),\n    );\n    for (let iPropertyKey = 0; iPropertyKey < propertyKeys.length; ++iPropertyKey) {\n        const propertyKey = propertyKeys[iPropertyKey];\n        if (!(propertyKey in Eventified.prototype)) {\n            const propertyDescriptor = Object.getOwnPropertyDescriptor(callbacksInvokerPrototype, propertyKey);\n            if (propertyDescriptor) {\n                Object.defineProperty(Eventified.prototype, propertyKey, propertyDescriptor);\n            }\n        }\n    }\n\n    return Eventified as unknown as Constructor<TBase & IEventified>;\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { legacyCC } from '../global-exports';\nimport { Eventify } from './eventify';\n\nclass Empty {}\n\n/**\n * @en\n * EventTarget is an object to which an event is dispatched when something has occurred.\n * [[Node]]s are the most common event targets, but other objects can be event targets too.\n * If a class cannot extend from EventTarget, it can consider using [[Eventify]].\n *\n * @zh\n * 事件目标是具有注册监听器、派发事件能力的类，[[Node]] 是最常见的事件目标，\n * 但是其他类也可以继承自事件目标以获得管理监听器和派发事件的能力。\n * 如果无法继承自 EventTarget，也可以使用 [[Eventify]]\n */\nexport const EventTarget = Eventify(Empty);\n\nexport type EventTarget = InstanceType<typeof EventTarget>;\n\nlegacyCC.EventTarget = EventTarget;\n","export enum BrowserType {\r\n    /**\r\n     * @en Browser Type - Unknown\r\n     * @zh 浏览器类型 - 未知\r\n     */\r\n    UNKNOWN = 'unknown',\r\n    /**\r\n     * @en Browser Type - WeChat inner browser\r\n     * @zh 浏览器类型 - 微信内置浏览器\r\n     */\r\n    WECHAT = 'wechat',\r\n    /**\r\n     * @en Browser Type - Android Browser\r\n     * @zh 浏览器类型 - 安卓浏览器\r\n     */\r\n    ANDROID = 'androidbrowser',\r\n    /**\r\n     * @en Browser Type - Internet Explorer\r\n     * @zh 浏览器类型 - 微软 IE\r\n     */\r\n    IE = 'ie',\r\n    /**\r\n     * @en Browser Type - Microsoft Edge\r\n     * @zh 浏览器类型 - 微软 Edge\r\n     */\r\n    EDGE = 'edge',\r\n    /**\r\n     * @en Browser Type - QQ Browser\r\n     * @zh 浏览器类型 - QQ 浏览器\r\n     */\r\n    QQ = 'qqbrowser',\r\n    /**\r\n     * @en Browser Type - Mobile QQ Browser\r\n     * @zh 浏览器类型 - 手机 QQ 浏览器\r\n     */\r\n    MOBILE_QQ = 'mqqbrowser',\r\n    /**\r\n     * @en Browser Type - UC Browser\r\n     * @zh 浏览器类型 - UC 浏览器\r\n     */\r\n    UC = 'ucbrowser',\r\n    /**\r\n     * @en Browser Type - Third party integrated UC browser\r\n     * @zh 浏览器类型 - 第三方应用中集成的 UC 浏览器\r\n     */\r\n    UCBS = 'ucbs',\r\n    /**\r\n     * @en Browser Type - 360 Browser\r\n     * @zh 浏览器类型 - 360 浏览器\r\n     */\r\n    BROWSER_360 = '360browser',\r\n    /**\r\n     * @en Browser Type - Baidu Box App\r\n     * @zh 浏览器类型 - Baidu Box App\r\n     */\r\n    BAIDU_APP = 'baiduboxapp',\r\n    /**\r\n     * @en Browser Type - Baidu Browser\r\n     * @zh 浏览器类型 - 百度浏览器\r\n     */\r\n    BAIDU = 'baidubrowser',\r\n    /**\r\n     * @en Browser Type - Maxthon Browser\r\n     * @zh 浏览器类型 - 傲游浏览器\r\n     */\r\n    MAXTHON = 'maxthon',\r\n    /**\r\n     * @en Browser Type - Opera Browser\r\n     * @zh 浏览器类型 - Opera 浏览器\r\n     */\r\n    OPERA = 'opera',\r\n    /**\r\n     * @en Browser Type - Oupeng Browser\r\n     * @zh 浏览器类型 - 欧朋浏览器\r\n     */\r\n    OUPENG = 'oupeng',\r\n    /**\r\n     * @en Browser Type - MI UI Browser\r\n     * @zh 浏览器类型 - MIUI 内置浏览器\r\n     */\r\n    MIUI = 'miuibrowser',\r\n    /**\r\n     * @en Browser Type - Firefox Browser\r\n     * @zh 浏览器类型 - Firefox 浏览器\r\n     */\r\n    FIREFOX = 'firefox',\r\n    /**\r\n     * @en Browser Type - Safari Browser\r\n     * @zh 浏览器类型 - Safari 浏览器\r\n     */\r\n    SAFARI = 'safari',\r\n    /**\r\n     * @en Browser Type - Chrome Browser\r\n     * @zh 浏览器类型 - Chrome 浏览器\r\n     */\r\n    CHROME = 'chrome',\r\n    /**\r\n     * @en Browser Type - Cheetah Browser\r\n     * @zh 浏览器类型 - 猎豹浏览器\r\n     */\r\n    LIEBAO = 'liebao',\r\n    /**\r\n     * @en Browser Type - QZone Inner Browser\r\n     * @zh 浏览器类型 - QZone 内置浏览器\r\n     */\r\n    QZONE = 'qzone',\r\n    /**\r\n     * @en Browser Type - Sogou Browser\r\n     * @zh 浏览器类型 - 搜狗浏览器\r\n     */\r\n    SOUGOU = 'sogou',\r\n    /**\r\n     * @en Browser Type - Huawei Browser\r\n     * @zh 浏览器类型 - 华为浏览器\r\n     */\r\n    HUAWEI = 'huawei',\r\n}\r\n","export enum Language {\r\n    /**\r\n     * @en Unknown language code\r\n     * @zh 语言代码 - 未知\r\n     */\r\n    UNKNOWN = 'unknown',\r\n\r\n    /**\r\n     * @en English language code\r\n     * @zh 语言代码 - 英语\r\n     */\r\n    ENGLISH = 'en',\r\n\r\n    /**\r\n     * @en Chinese language code\r\n     * @zh 语言代码 - 中文\r\n     */\r\n    CHINESE = 'zh',\r\n\r\n    /**\r\n     * @en French language code\r\n     * @zh 语言代码 - 法语\r\n     */\r\n    FRENCH = 'fr',\r\n\r\n    /**\r\n     * @en Italian language code\r\n     * @zh 语言代码 - 意大利语\r\n     */\r\n    ITALIAN = 'it',\r\n\r\n    /**\r\n     * @en German language code\r\n     * @zh 语言代码 - 德语\r\n     */\r\n    GERMAN = 'de',\r\n\r\n    /**\r\n     * @en Spanish language code\r\n     * @zh 语言代码 - 西班牙语\r\n     */\r\n    SPANISH = 'es',\r\n\r\n    /**\r\n     * @en Spanish language code\r\n     * @zh 语言代码 - 荷兰语\r\n     */\r\n    DUTCH = 'du',\r\n\r\n    /**\r\n     * @en Russian language code\r\n     * @zh 语言代码 - 俄罗斯语\r\n     */\r\n    RUSSIAN = 'ru',\r\n\r\n    /**\r\n     * @en Korean language code\r\n     * @zh 语言代码 - 韩语\r\n     */\r\n    KOREAN = 'ko',\r\n\r\n    /**\r\n     * @en Japanese language code\r\n     * @zh 语言代码 - 日语\r\n     */\r\n    JAPANESE = 'ja',\r\n\r\n    /**\r\n     * @en Hungarian language code\r\n     * @zh 语言代码 - 匈牙利语\r\n     */\r\n    HUNGARIAN = 'hu',\r\n\r\n    /**\r\n     * @en Portuguese language code\r\n     * @zh 语言代码 - 葡萄牙语\r\n     */\r\n    PORTUGUESE = 'pt',\r\n\r\n    /**\r\n     * @en Arabic language code\r\n     * @zh 语言代码 - 阿拉伯语\r\n     */\r\n    ARABIC = 'ar',\r\n\r\n    /**\r\n     * @en Norwegian language code\r\n     * @zh 语言代码 - 挪威语\r\n     */\r\n    NORWEGIAN = 'no',\r\n\r\n    /**\r\n     * @en Polish language code\r\n     * @zh 语言代码 - 波兰语\r\n     */\r\n    POLISH = 'pl',\r\n\r\n    /**\r\n     * @en Turkish language code\r\n     * @zh 语言代码 - 土耳其语\r\n     */\r\n    TURKISH = 'tr',\r\n\r\n    /**\r\n     * @en Ukrainian language code\r\n     * @zh 语言代码 - 乌克兰语\r\n     */\r\n    UKRAINIAN = 'uk',\r\n\r\n    /**\r\n     * @en Romanian language code\r\n     * @zh 语言代码 - 罗马尼亚语\r\n     */\r\n    ROMANIAN = 'ro',\r\n\r\n    /**\r\n     * @en Bulgarian language code\r\n     * @zh 语言代码 - 保加利亚语\r\n     */\r\n    BULGARIAN = 'bg',\r\n}\r\n","export enum NetworkType {\r\n    /**\r\n     * @en Network is unreachable.\r\n     * @zh 网络不通\r\n     */\r\n    NONE,\r\n    /**\r\n     * @en Network is reachable via WiFi or cable.\r\n     * @zh 通过无线或者有线本地网络连接因特网\r\n     */\r\n    LAN,\r\n    /**\r\n     * @en Network is reachable via Wireless Wide Area Network\r\n     * @zh 通过蜂窝移动网络连接因特网\r\n     */\r\n    WWAN,\r\n}\r\n","export enum OS {\r\n    /**\r\n     * @en Operating System - Unknown\r\n     * @zh 操作系统 - 未知\r\n     */\r\n    UNKNOWN = 'Unknown',\r\n    /**\r\n     * @en Operating System - iOS\r\n     * @zh 操作系统 - iOS\r\n     */\r\n    IOS = 'iOS',\r\n    /**\r\n     * @en Operating System - Android\r\n     * @zh 操作系统 - 安卓\r\n     */\r\n    ANDROID = 'Android',\r\n    /**\r\n     * @en Operating System - Windows\r\n     * @zh 操作系统 - Windows\r\n     */\r\n    WINDOWS = 'Windows',\r\n    /**\r\n     * @en Operating System - Linux\r\n     * @zh 操作系统 - Linux\r\n     */\r\n    LINUX = 'Linux',\r\n    /**\r\n     * @en Operating System - Mac OS X\r\n     * @zh 操作系统 - Mac OS X\r\n     */\r\n    OSX = 'OS X',\r\n    /**\r\n     * @en Operating System - Huawei Open Harmony OS\r\n     * @zh 操作系统 - 鸿蒙\r\n     */\r\n    OHOS = 'OHOS',\r\n}\r\n","export enum Platform {\r\n    UNKNOWN = 'UNKNOWN',\r\n    // Web Based\r\n    EDITOR_PAGE = 'EDITOR_PAGE',\r\n    EDITOR_CORE = 'EDITOR_CORE',\r\n    MOBILE_BROWSER = 'MOBILE_BROWSER',\r\n    DESKTOP_BROWSER = 'DESKTOP_BROWSER',\r\n    // Native\r\n    WIN32 = 'WIN32',\r\n    ANDROID = 'ANDROID',\r\n    IOS = 'IOS',\r\n    MACOS = 'MACOS',\r\n    OHOS = 'OHOS',\r\n    // Minigame\r\n    WECHAT_GAME = 'WECHAT_GAME',\r\n    BAIDU_MINI_GAME = 'BAIDU_MINI_GAME',\r\n    XIAOMI_QUICK_GAME = 'XIAOMI_QUICK_GAME',\r\n    ALIPAY_MINI_GAME = 'ALIPAY_MINI_GAME',\r\n    BYTEDANCE_MINI_GAME = 'BYTEDANCE_MINI_GAME',\r\n    // Runtime Based\r\n    OPPO_MINI_GAME = 'OPPO_MINI_GAME',\r\n    VIVO_MINI_GAME = 'VIVO_MINI_GAME',\r\n    HUAWEI_QUICK_GAME = 'HUAWEI_QUICK_GAME',\r\n    COCOSPLAY = 'COCOSPLAY',\r\n    LINKSURE_MINI_GAME = 'LINKSURE_MINI_GAME',\r\n    QTT_MINI_GAME = 'QTT_MINI_GAME',\r\n}\r\n","export enum Feature {\n    /**\n     * @en Feature to support Webp.\n     * @zh 是否支持 Webp 特性。\n     */\n    WEBP = 'WEBP',\n    /**\n     * @en Feature to support Image Bitmap.\n     * @zh 是否支持 Image Bitmap 特性。\n     */\n    IMAGE_BITMAP = 'IMAGE_BITMAP',\n    /**\n     * @en Feature to support Web View.\n     * @zh 是否支持 Web View 特性。\n     */\n    WEB_VIEW = 'WEB_VIEW',\n    /**\n     * @en Feature to support Video Player.\n     * @zh 是否支持 Video Player 特性。\n     */\n    VIDEO_PLAYER = 'VIDEO_PLAYER',\n    /**\n     * @en Feature to support Safe Area.\n     * @zh 是否支持 Safe Area 特性。\n     */\n    SAFE_AREA = 'SAFE_AREA',\n\n    /**\n     * @en Feature to support Touch Input.\n     * Touch Input is only supported on some devices with touch screen.\n     * This feature tells that whether the device has a touch screen.\n     * @zh 是否支持触摸输入。\n     * 触摸输入只在一些带触摸屏的设备上支持。\n     * 这个特性旨在说明设备上是否带触摸屏。\n     */\n    INPUT_TOUCH = 'INPUT_TOUCH',\n    /**\n     * @en Feature to support dispatching EventKeyboard.\n     * @zh 是否支持派发 EventKeyboard。\n     */\n    EVENT_KEYBOARD = 'EVENT_KEYBOARD',\n    /**\n     * @en Feature to support dispatching EventMouse.\n     * @zh 是否支持派发 EventMouse。\n     */\n    EVENT_MOUSE = 'EVENT_MOUSE',\n    /**\n     * @en Feature to support dispatching EventTouch.\n     * On some devices without touch screen, we still can simulate dispatching EventTouch from EventMouse.\n     * @zh 是否支持派发 EventTouch。\n     * 在一些不带触摸屏的设备上，我们仍然会从 EventMouse 模拟派发 EventTouch。\n     */\n    EVENT_TOUCH = 'EVENT_TOUCH',\n    /**\n     * @en Feature to support dispatching EventAcceleration.\n     * @zh 是否支持派发 EventAcceleration。\n     */\n    EVENT_ACCELEROMETER = 'EVENT_ACCELEROMETER',\n    /**\n     * @en Feature to support dispatching EventGamepad.\n     * @zh 是否支持派发 EventGamepad.\n     */\n    EVENT_GAMEPAD = 'EVENT_GAMEPAD',\n    /**\n     * @en Feature to support dispatching EventHandle.\n     * @zh 是否支持派发 EventHandle\n     */\n    EVENT_HANDLE = 'EVENT_HANDLE',\n    /**\n     * @en Feature to support dispatching EventHMD.\n     * @zh 是否支持派发 EventHMD\n     */\n    EVENT_HMD = 'EVENT_HMD',\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { js } from '../utils/js';\n\n/**\n * @zh\n * Async Delegate 用于支持异步回调的代理，你可以新建一个异步代理，并注册异步回调，等到对应的时机触发代理事件。\n *\n * @en\n * Async Delegate is a delegate that supports asynchronous callbacks.\n * You can create a new AsyncDelegate, register the asynchronous callback, and wait until the corresponding time to dispatch the event.\n *\n * @example\n * ```ts\n * const ad = new AsyncDelegate();\n * ad.add(() => {\n *     return new Promise((resolve, reject) => {\n *        setTimeout(() => {\n *            console.log('hello world');\n *            resolve();\n *        }, 1000);\n *     })\n * });\n * await ad.dispatch();\n * ```\n */\nexport class AsyncDelegate<T extends (...args: any) => (Promise<void> | void) = () => (Promise<void> | void)> {\n    private _delegates: T[] = [];\n\n    /**\n     * @en\n     * Add an async callback or sync callback.\n     *\n     * @zh\n     * 添加一个异步回调或同步回调。\n     *\n     * @param callback\n     * @en The callback to add, and will be invoked when this delegate is dispatching.\n     * @zh 要添加的回调，并将在该委托调度时被调用。\n     */\n    public add (callback: T) {\n        if (!this._delegates.includes(callback)) {\n            this._delegates.push(callback);\n        }\n    }\n\n    /**\n     * @zh\n     * 查询是否已注册某个回调。\n     * @en\n     * Queries if a callback has been registered.\n     *\n     * @param callback @en The callback to query. @zh 要查询的回调函数。\n     * @returns @en Whether the callback has been added. @zh 是否已经添加了回调。\n     */\n    public hasListener (callback: T) {\n        return this._delegates.includes(callback);\n    }\n\n    /**\n     * @en\n     * Remove the specific callback of this delegate.\n     *\n     * @zh\n     * 移除此代理中某个具体的回调。\n     *\n     * @param callback @en The callback to remove. @zh 要移除的某个回调。\n     */\n    public remove (callback: T) {\n        js.array.fastRemove(this._delegates, callback);\n    }\n\n    /**\n     * @en\n     * Dispatching the delegate event. This function will trigger all previously registered callbacks and does not guarantee execution order.\n     *\n     * @zh\n     * 派发代理事件。此函数会触发所有之前注册的回调，并且不保证执行顺序。\n     *\n     * @param args @en The parameters to be transferred to callback. @zh 传递给回调函数的参数。\n     * @returns @en The promise awaiting all async callback resolved. @zh 等待所有异步回调结束的 Promise 对象。\n     */\n    public dispatch (...args: Parameters<T>) {\n        return Promise.all(this._delegates.map((func) => func(...arguments)).filter(Boolean));\n    }\n}\n","const _PORTRAIT = 1;\nconst _PORTRAIT_UPSIDE_DOWN = _PORTRAIT << 1;\nconst _LEFT = _PORTRAIT << 2;\nconst _RIGHT = _PORTRAIT << 3;\nconst _LANDSCAPE = _LEFT | _RIGHT;\nconst _AUTO = _PORTRAIT | _LANDSCAPE;\n\nexport enum Orientation {\n    PORTRAIT = _PORTRAIT,\n    PORTRAIT_UPSIDE_DOWN = _PORTRAIT_UPSIDE_DOWN,\n    LANDSCAPE_LEFT = _LEFT,\n    LANDSCAPE_RIGHT = _RIGHT,\n    LANDSCAPE = _LANDSCAPE,\n    AUTO = _AUTO,\n}\n","import { DEBUG, EDITOR, TEST } from 'internal:constants';\nimport { IFeatureMap } from 'pal/system-info';\nimport { EventTarget } from '../../../cocos/core/event';\nimport legacyCC from '../../../predefine';\nimport { BrowserType, NetworkType, OS, Platform, Language, Feature } from '../enum-type';\n\nclass SystemInfo extends EventTarget {\n    public readonly networkType: NetworkType;\n    public readonly isNative: boolean;\n    public readonly isBrowser: boolean;\n    public readonly isMobile: boolean;\n    public readonly isLittleEndian: boolean;\n    public readonly platform: Platform;\n    public readonly language: Language;\n    public readonly nativeLanguage: string;\n    public readonly os: OS;\n    public readonly osVersion: string;\n    public readonly osMainVersion: number;\n    public readonly browserType: BrowserType;\n    public readonly browserVersion: string;\n    public readonly isXR: boolean;\n    private _battery?: any;\n    private _featureMap: IFeatureMap;\n\n    constructor () {\n        super();\n        const nav = window.navigator;\n        const ua = nav.userAgent.toLowerCase();\n        // @ts-expect-error getBattery is not totally supported\n        nav.getBattery?.().then((battery) => {\n            this._battery = battery;\n        });\n\n        this.networkType = NetworkType.LAN;  // TODO\n        this.isNative = false;\n        this.isBrowser = true;\n\n        // init isMobile and platform\n        if (EDITOR) {\n            this.isMobile = false;\n            this.platform = Platform.EDITOR_PAGE;  // TODO\n        } else {\n            this.isMobile = /mobile|android|iphone|ipad/.test(ua);\n            this.platform = this.isMobile ? Platform.MOBILE_BROWSER : Platform.DESKTOP_BROWSER;\n        }\n\n        // init isLittleEndian\n        this.isLittleEndian = (() => {\n            const buffer = new ArrayBuffer(2);\n            new DataView(buffer).setInt16(0, 256, true);\n            // Int16Array uses the platform's endianness.\n            return new Int16Array(buffer)[0] === 256;\n        })();\n\n        // init languageCode and language\n        let currLanguage = nav.language;\n        this.nativeLanguage = currLanguage.toLowerCase();\n        currLanguage = currLanguage || (nav as any).browserLanguage;\n        currLanguage = currLanguage ? currLanguage.split('-')[0] : Language.ENGLISH;\n        this.language = currLanguage as Language;\n\n        // init os, osVersion and osMainVersion\n        let isAndroid = false; let iOS = false; let osVersion = ''; let osMajorVersion = 0;\n        let uaResult = /android\\s*(\\d+(?:\\.\\d+)*)/i.exec(ua) || /android\\s*(\\d+(?:\\.\\d+)*)/i.exec(nav.platform);\n        if (uaResult) {\n            isAndroid = true;\n            osVersion = uaResult[1] || '';\n            osMajorVersion = parseInt(osVersion) || 0;\n        }\n        uaResult = /(iPad|iPhone|iPod).*OS ((\\d+_?){2,3})/i.exec(ua);\n        if (uaResult) {\n            iOS = true;\n            osVersion = uaResult[2] || '';\n            osMajorVersion = parseInt(osVersion) || 0;\n            // refer to https://github.com/cocos-creator/engine/pull/5542 , thanks for contribition from @krapnikkk\n            // ipad OS 13 safari identifies itself as \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15) AppleWebKit/605.1.15 (KHTML, like Gecko)\"\n            // so use maxTouchPoints to check whether it's desktop safari or not.\n            // reference: https://stackoverflow.com/questions/58019463/how-to-detect-device-name-in-safari-on-ios-13-while-it-doesnt-show-the-correct\n            // FIXME: should remove it when touch-enabled mac are available\n            // TODO: due to compatibility issues, it is still determined to be ios, and a new operating system type ipados may be added later？\n        } else if (/(iPhone|iPad|iPod)/.exec(nav.platform) || (nav.platform === 'MacIntel' && nav.maxTouchPoints && nav.maxTouchPoints > 1)) {\n            iOS = true;\n            osVersion = '';\n            osMajorVersion = 0;\n        }\n\n        let osName = OS.UNKNOWN;\n        if (nav.appVersion.indexOf('Win') !== -1) {\n            osName = OS.WINDOWS;\n        } else if (iOS) {\n            osName = OS.IOS;\n        } else if (nav.appVersion.indexOf('Mac') !== -1) {\n            osName = OS.OSX;\n        } else if (nav.appVersion.indexOf('X11') !== -1 && nav.appVersion.indexOf('Linux') === -1) {\n            osName = OS.LINUX;\n        } else if (isAndroid) {\n            osName = OS.ANDROID;\n        } else if (nav.appVersion.indexOf('Linux') !== -1 || ua.indexOf('ubuntu') !== -1) {\n            osName = OS.LINUX;\n        }\n\n        this.os = osName;\n        this.osVersion = osVersion;\n        this.osMainVersion = osMajorVersion;\n\n        // TODO: use dack-type to determine the browserType\n        // init browserType and browserVersion\n        this.browserType = BrowserType.UNKNOWN;\n        const typeReg0 = /wechat|weixin|micromessenger/i;\n        const typeReg1 = /mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i;\n        const typeReg2 = /qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i;\n        const typeReg3 = /chrome|safari|firefox|trident|opera|opr\\/|oupeng/i;\n        const browserTypes = typeReg0.exec(ua) || typeReg1.exec(ua) || typeReg2.exec(ua) || typeReg3.exec(ua);\n\n        let browserType = browserTypes ? browserTypes[0].toLowerCase() : OS.UNKNOWN;\n        if (browserType === 'safari' && isAndroid) {\n            browserType = BrowserType.ANDROID;\n        } else if (browserType === 'qq' && /android.*applewebkit/i.test(ua)) {\n            browserType = BrowserType.ANDROID;\n        }\n        const typeMap = {\n            micromessenger: BrowserType.WECHAT,\n            wechat: BrowserType.WECHAT,\n            weixin: BrowserType.WECHAT,\n            trident: BrowserType.IE,\n            edge: BrowserType.EDGE,\n            '360 aphone': BrowserType.BROWSER_360,\n            mxbrowser: BrowserType.MAXTHON,\n            'opr/': BrowserType.OPERA,\n            ubrowser: BrowserType.UC,\n            huaweibrowser: BrowserType.HUAWEI,\n        };\n\n        this.browserType = typeMap[browserType] || browserType;\n\n        // init browserVersion\n        this.browserVersion = '';\n        const versionReg1 = /(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\\/?([\\d.]+)/i;\n        const versionReg2 = /(qq|chrome|safari|firefox|trident|opera|opr\\/|oupeng)(mobile)?(browser)?\\/?([\\d.]+)/i;\n        let tmp = versionReg1.exec(ua);\n        if (!tmp) {\n            tmp = versionReg2.exec(ua);\n        }\n        this.browserVersion = tmp ? tmp[4] : '';\n\n        this.isXR = false;\n\n        // init capability\n        const _tmpCanvas1 = document.createElement('canvas');\n        const supportCanvas = TEST ? false : !!_tmpCanvas1.getContext('2d');\n        let supportWebGL = false;\n        if (TEST) {\n            supportWebGL = false;\n        } else if (window.WebGLRenderingContext) {\n            supportWebGL = true;\n        }\n        let supportWebp;\n        try {\n            supportWebp = TEST ? false : _tmpCanvas1.toDataURL('image/webp').startsWith('data:image/webp');\n        } catch (e) {\n            supportWebp  = false;\n        }\n        if (this.browserType === BrowserType.SAFARI) {\n            const result = / version\\/(\\d+)/.exec(ua)?.[1];\n            if (typeof result === 'string') {\n                if (Number.parseInt(result) >= 14) {\n                    // safari 14+ support webp, but canvas.toDataURL is not supported by default\n                    supportWebp = true;\n                }\n            }\n        }\n        let supportImageBitmap = false;\n        if (!TEST && typeof createImageBitmap !== 'undefined' && typeof Blob !== 'undefined') {\n            _tmpCanvas1.width = _tmpCanvas1.height = 2;\n            createImageBitmap(_tmpCanvas1, {}).then((imageBitmap) => {\n                supportImageBitmap = true;\n                imageBitmap?.close();\n            }).catch((err) => {});\n        }\n\n        const supportTouch = (document.documentElement.ontouchstart !== undefined || document.ontouchstart !== undefined || EDITOR);\n        const supportMouse = document.documentElement.onmouseup !== undefined || EDITOR;\n        this._featureMap = {\n            [Feature.WEBP]: supportWebp,\n            [Feature.IMAGE_BITMAP]: supportImageBitmap,\n            [Feature.WEB_VIEW]: true,\n            [Feature.VIDEO_PLAYER]: true,\n            [Feature.SAFE_AREA]: false,\n\n            [Feature.INPUT_TOUCH]: supportTouch,\n            [Feature.EVENT_KEYBOARD]: document.documentElement.onkeyup !== undefined || EDITOR,\n            [Feature.EVENT_MOUSE]: supportMouse,\n            [Feature.EVENT_TOUCH]: supportTouch || supportMouse,\n            [Feature.EVENT_ACCELEROMETER]: (window.DeviceMotionEvent !== undefined || window.DeviceOrientationEvent !== undefined),\n            // @ts-expect-error undefined webkitGetGamepads\n            [Feature.EVENT_GAMEPAD]: (navigator.getGamepads !== undefined || navigator.webkitGetGamepads !== undefined),\n            [Feature.EVENT_HANDLE]: this.isXR,\n            [Feature.EVENT_HMD]: this.isXR,\n        };\n\n        this._registerEvent();\n    }\n\n    private _registerEvent () {\n        let hiddenPropName: string;\n        if (typeof document.hidden !== 'undefined') {\n            hiddenPropName = 'hidden';\n        } else if (typeof document.mozHidden !== 'undefined') {\n            hiddenPropName = 'mozHidden';\n        } else if (typeof document.msHidden !== 'undefined') {\n            hiddenPropName = 'msHidden';\n        } else if (typeof document.webkitHidden !== 'undefined') {\n            hiddenPropName = 'webkitHidden';\n        } else {\n            hiddenPropName = 'hidden';\n        }\n\n        let hidden = false;\n        const onHidden = () => {\n            if (!hidden) {\n                hidden = true;\n                this.emit('hide');\n            }\n        };\n        // In order to adapt the most of platforms the onshow API.\n        const onShown = (arg0?, arg1?, arg2?, arg3?, arg4?) => {\n            if (hidden) {\n                hidden = false;\n                this.emit('show', arg0, arg1, arg2, arg3, arg4);\n            }\n        };\n\n        if (hiddenPropName) {\n            const changeList = [\n                'visibilitychange',\n                'mozvisibilitychange',\n                'msvisibilitychange',\n                'webkitvisibilitychange',\n                'qbrowserVisibilityChange',\n            ];\n\n            for (let i = 0; i < changeList.length; i++) {\n                document.addEventListener(changeList[i], (event) => {\n                    let visible = document[hiddenPropName];\n                    // @ts-expect-error QQ App need hidden property\n                    visible = visible || event.hidden;\n                    if (visible) {\n                        onHidden();\n                    } else {\n                        onShown();\n                    }\n                });\n            }\n        } else {\n            window.addEventListener('blur', onHidden);\n            window.addEventListener('focus', onShown);\n        }\n\n        if (window.navigator.userAgent.indexOf('MicroMessenger') > -1) {\n            window.onfocus = onShown;\n        }\n\n        if ('onpageshow' in window && 'onpagehide' in window) {\n            window.addEventListener('pagehide', onHidden);\n            window.addEventListener('pageshow', onShown);\n            // Taobao UIWebKit\n            document.addEventListener('pagehide', onHidden);\n            document.addEventListener('pageshow', onShown);\n        }\n    }\n\n    public hasFeature (feature: Feature): boolean {\n        return this._featureMap[feature];\n    }\n\n    public getBatteryLevel (): number {\n        if (this._battery) {\n            return this._battery.level as number;\n        } else {\n            if (DEBUG) {\n                console.warn('getBatteryLevel is not supported');\n            }\n            return 1;\n        }\n    }\n    public triggerGC (): void {\n        if (DEBUG) {\n            console.warn('triggerGC is not supported.');\n        }\n    }\n    public openURL (url: string): void {\n        window.open(url);\n    }\n    public now (): number {\n        if (Date.now) {\n            return Date.now();\n        }\n\n        return +(new Date());\n    }\n    public restartJSVM (): void {\n        if (DEBUG) {\n            console.warn('restartJSVM is not supported.');\n        }\n    }\n\n    public close () {\n        this.emit('close');\n        window.close();\n    }\n}\n\nexport const systemInfo = new SystemInfo();\n","import { EDITOR, TEST } from 'internal:constants';\nimport { ConfigOrientation, IScreenOptions, SafeAreaEdge } from 'pal/screen-adapter';\nimport { systemInfo } from 'pal/system-info';\nimport { warnID } from '../../../cocos/core/platform/debug';\nimport { EventTarget } from '../../../cocos/core/event/event-target';\nimport { Size } from '../../../cocos/core/math';\nimport { Orientation } from '../enum-type';\nimport legacyCC from '../../../predefine';\n\ninterface ICachedStyle {\n    width: string;\n    height: string;\n}\n\nconst EVENT_TIMEOUT = EDITOR ? 5 : 200;\nconst orientationMap: Record<ConfigOrientation, Orientation> = {\n    auto: Orientation.AUTO,\n    landscape: Orientation.LANDSCAPE,\n    portrait: Orientation.PORTRAIT,\n};\n\n/**\n * On Web platform, the game window may points to different type of window.\n */\nenum WindowType {\n    /**\n     * Unknown window type.\n     */\n    Unknown,\n    /**\n     * A SubFrame in BrowserWindow.\n     * Need to set the frame size from an external editor option.\n     * Should only dispatch 'resize' event when the frame size changed.\n     * Setting window size is supported.\n     */\n    SubFrame,\n    /**\n     * The window size is determined by the size of BrowserWindow.\n     * Should dispatch 'resize' event when the BrowserWindow size changed.\n     * Setting window size is NOT supported.\n     */\n    BrowserWindow,\n    /**\n     * The window size is equal to the size of screen.\n     * Should dispatch 'resize' event when enter / exit fullscreen or screen resize.\n     * Setting window size is NOT supported.\n     */\n    Fullscreen,\n}\n\ninterface IScreenFunctionName {\n    requestFullscreen: string,\n    exitFullscreen: string,\n    fullscreenchange: string,\n    fullscreenEnabled: string,\n    fullscreenElement: string,\n    fullscreenerror: string,\n}\n\nclass ScreenAdapter extends EventTarget {\n    public isFrameRotated = false;\n    public handleResizeEvent = true;\n\n    public get supportFullScreen (): boolean {\n        return this._supportFullScreen;\n    }\n    public get isFullScreen (): boolean {\n        if (!this._supportFullScreen) {\n            return false;\n        }\n        return !!document[this._fn.fullscreenElement];\n    }\n\n    public get devicePixelRatio () {\n        // TODO: remove the down sampling operation in DPR after supporting resolutionScale\n        return Math.min(window.devicePixelRatio ?? 1, 2);\n    }\n\n    public get windowSize (): Size {\n        const result = this._windowSizeInCssPixels;\n        const dpr = this.devicePixelRatio;\n        result.width *= dpr;\n        result.height *= dpr;\n        return result;\n    }\n    public set windowSize (size: Size) {\n        if (this._windowType !== WindowType.SubFrame) {\n            warnID(9202);\n            return;\n        }\n        this._resizeFrame(this._convertToSizeInCssPixels(size));\n    }\n\n    public get resolution () {\n        const windowSize = this.windowSize;\n        const resolutionScale = this.resolutionScale;\n        return new Size(windowSize.width * resolutionScale, windowSize.height * resolutionScale);\n    }\n    public get resolutionScale () {\n        return this._resolutionScale;\n    }\n    public set resolutionScale (v: number) {\n        if (v === this._resolutionScale) {\n            return;\n        }\n        this._resolutionScale = v;\n        this._cbToUpdateFrameBuffer?.();\n    }\n\n    public get orientation (): Orientation {\n        return this._orientation;\n    }\n    public set orientation (value: Orientation) {\n        if (this._orientation === value) {\n            return;\n        }\n        this._orientation = value;\n        this._updateFrameState();\n    }\n\n    public get safeAreaEdge (): SafeAreaEdge {\n        return {\n            top: 0,\n            bottom: 0,\n            left: 0,\n            right: 0,\n        };\n    }\n    public get isProportionalToFrame (): boolean {\n        return this._isProportionalToFrame;\n    }\n    public set isProportionalToFrame (v: boolean) {\n        if (this._isProportionalToFrame === v) {\n            return;\n        }\n        this._isProportionalToFrame = v;\n        this._updateContainer();\n    }\n\n    private _gameFrame?: HTMLDivElement;\n    private _gameContainer?: HTMLDivElement;\n    private _gameCanvas?: HTMLCanvasElement;\n    private _isProportionalToFrame = false;\n    private _cachedFrameStyle: ICachedStyle = { width: '0px', height: '0px' };\n    private _cachedContainerStyle: ICachedStyle = { width: '0px', height: '0px' };\n    private _cbToUpdateFrameBuffer?: () => void;\n    private _supportFullScreen = false;\n    private _touchEventName: string;\n    private _onFullscreenChange?: () => void;\n    private _onFullscreenError?: () => void;\n    // We need to set timeout to handle screen event.\n    private _orientationChangeTimeoutId = -1;\n    private _cachedFrameSize = new Size(0, 0); // cache before enter fullscreen.\n    private _exactFitScreen = false;\n    private _fn = {} as IScreenFunctionName;\n    // Function mapping for cross browser support\n    private _fnGroup = [\n        [\n            'requestFullscreen',\n            'exitFullscreen',\n            'fullscreenchange',\n            'fullscreenEnabled',\n            'fullscreenElement',\n            'fullscreenerror',\n        ],\n        [\n            'requestFullScreen',\n            'exitFullScreen',\n            'fullScreenchange',\n            'fullScreenEnabled',\n            'fullScreenElement',\n            'fullscreenerror',\n        ],\n        [\n            'webkitRequestFullScreen',\n            'webkitCancelFullScreen',\n            'webkitfullscreenchange',\n            'webkitIsFullScreen',\n            'webkitCurrentFullScreenElement',\n            'webkitfullscreenerror',\n        ],\n        [\n            'mozRequestFullScreen',\n            'mozCancelFullScreen',\n            'mozfullscreenchange',\n            'mozFullScreen',\n            'mozFullScreenElement',\n            'mozfullscreenerror',\n        ],\n        [\n            'msRequestFullscreen',\n            'msExitFullscreen',\n            'MSFullscreenChange',\n            'msFullscreenEnabled',\n            'msFullscreenElement',\n            'msfullscreenerror',\n        ],\n    ];\n    private get _windowSizeInCssPixels () {\n        if (TEST) {\n            return new Size(window.innerWidth, window.innerHeight);\n        }\n        if (this.isProportionalToFrame) {\n            if (!this._gameContainer) {\n                warnID(9201);\n                return new Size(0, 0);\n            }\n            return new Size(this._gameContainer.clientWidth, this._gameContainer.clientHeight);\n        }\n        let fullscreenTarget;\n        let width: number;\n        let height: number;\n        switch (this._windowType) {\n        case WindowType.SubFrame:\n            if (!this._gameFrame) {\n                warnID(9201);\n                return new Size(0, 0);\n            }\n            return new Size(this._gameFrame.clientWidth, this._gameFrame.clientHeight);\n        case WindowType.Fullscreen:\n            fullscreenTarget = this._getFullscreenTarget()!;\n            width = this.isFrameRotated ? fullscreenTarget.clientHeight : fullscreenTarget.clientWidth;\n            height = this.isFrameRotated ? fullscreenTarget.clientWidth : fullscreenTarget.clientHeight;\n            return new Size(width, height);\n        case WindowType.BrowserWindow:\n            width = this.isFrameRotated ? window.innerHeight : window.innerWidth;\n            height = this.isFrameRotated ? window.innerWidth : window.innerHeight;\n            return new Size(width, height);\n        case WindowType.Unknown:\n        default:\n            return new Size(0, 0);\n        }\n    }\n    private get _windowType (): WindowType {\n        if (this.isFullScreen) {\n            return WindowType.Fullscreen;\n        }\n        if (!this._gameFrame) {\n            warnID(9201);\n            return WindowType.Unknown;\n        }\n        if (this._exactFitScreen) {\n            // Note: It doesn't work well to determine whether the frame exact fits the screen.\n            // Need to specify the attribute from Editor.\n            return WindowType.BrowserWindow;\n        }\n        return WindowType.SubFrame;\n    }\n    private _resolutionScale = 1;\n    private _orientation = Orientation.AUTO;\n\n    constructor () {\n        super();\n        // TODO: need to access frame from 'pal/launcher' module\n        this._gameFrame = document.getElementById('GameDiv') as HTMLDivElement;\n        this._gameContainer = document.getElementById('Cocos3dGameContainer') as HTMLDivElement;\n        this._gameCanvas = document.getElementById('GameCanvas') as HTMLCanvasElement;\n        // Compability with old preview or build template in Editor.\n        if (!TEST && !EDITOR) {\n            if (!this._gameFrame) {\n                this._gameFrame = document.createElement<'div'>('div');\n                this._gameFrame.setAttribute('id', 'GameDiv');\n                this._gameCanvas?.parentNode?.insertBefore(this._gameFrame, this._gameCanvas);\n                this._gameFrame.appendChild(this._gameCanvas);\n            }\n            if (!this._gameContainer) {\n                this._gameContainer = document.createElement<'div'>('div');\n                this._gameContainer.setAttribute('id', 'Cocos3dGameContainer');\n                this._gameCanvas?.parentNode?.insertBefore(this._gameContainer, this._gameCanvas);\n                this._gameContainer.appendChild(this._gameCanvas);\n            }\n        }\n\n        let fnList: Array<string>;\n        const fnGroup = this._fnGroup;\n        for (let i = 0; i < fnGroup.length; i++) {\n            fnList = fnGroup[i];\n            // detect event support\n            if (typeof document[fnList[1]] !== 'undefined') {\n                for (let i = 0; i < fnList.length; i++) {\n                    this._fn[fnGroup[0][i]] = fnList[i];\n                }\n                break;\n            }\n        }\n\n        this._supportFullScreen = (this._fn.requestFullscreen !== undefined);\n        this._touchEventName = ('ontouchstart' in window) ? 'touchend' : 'mousedown';\n        this._registerEvent();\n    }\n\n    public init (options: IScreenOptions, cbToRebuildFrameBuffer: () => void) {\n        this._cbToUpdateFrameBuffer = cbToRebuildFrameBuffer;\n        this.orientation = orientationMap[options.configOrientation];\n        this._exactFitScreen = options.exactFitScreen;\n        this._resizeFrame();\n    }\n\n    public requestFullScreen (): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (this.isFullScreen) {\n                resolve();\n                return;\n            }\n            this._cachedFrameSize = this.windowSize;\n            this._doRequestFullScreen().then(() => {\n                resolve();\n            }).catch(() => {\n                const fullscreenTarget = this._getFullscreenTarget();\n                if (!fullscreenTarget) {\n                    reject(new Error('Cannot access fullscreen target'));\n                    return;\n                }\n                fullscreenTarget.addEventListener(this._touchEventName, () => {\n                    this._doRequestFullScreen().then(() => {\n                        resolve();\n                    }).catch(reject);\n                }, { once: true, capture: true });\n            });\n        });\n    }\n    public exitFullScreen (): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const requestPromise = document[this._fn.exitFullscreen]();\n            if (window.Promise && requestPromise instanceof Promise) {\n                requestPromise.then(() => {\n                    this.windowSize = this._cachedFrameSize;\n                    resolve();\n                }).catch(reject);\n                return;\n            }\n            this.windowSize = this._cachedFrameSize;\n            resolve();\n        });\n    }\n\n    private _registerEvent () {\n        document.addEventListener(this._fn.fullscreenerror, () => {\n            this._onFullscreenError?.();\n        });\n\n        window.addEventListener('resize', () => {\n            if (!this.handleResizeEvent) {\n                return;\n            }\n            this._resizeFrame();\n        });\n        if (typeof window.matchMedia === 'function') {\n            const updateDPRChangeListener = () => {\n                const dpr = window.devicePixelRatio;\n                // NOTE: some browsers especially on iPhone doesn't support MediaQueryList\n                window.matchMedia(`(resolution: ${dpr}dppx)`)?.addEventListener?.('change', () => {\n                    this.emit('window-resize');\n                    updateDPRChangeListener();\n                }, { once: true });\n            };\n            updateDPRChangeListener();\n        }\n        window.addEventListener('orientationchange', () => {\n            if (this._orientationChangeTimeoutId !== -1) {\n                clearTimeout(this._orientationChangeTimeoutId);\n            }\n            this._orientationChangeTimeoutId = setTimeout(() => {\n                if (!this.handleResizeEvent) {\n                    return;\n                }\n                this._updateFrameState();\n                this._resizeFrame();\n                this.emit('orientation-change');\n                this._orientationChangeTimeoutId = -1;\n            }, EVENT_TIMEOUT);\n        });\n        document.addEventListener(this._fn.fullscreenchange, () => {\n            this._onFullscreenChange?.();\n            this.emit('fullscreen-change');\n        });\n    }\n    private _convertToSizeInCssPixels (size: Size) {\n        const clonedSize = size.clone();\n        const dpr = this.devicePixelRatio;\n        clonedSize.width /= dpr;\n        clonedSize.height /= dpr;\n        return clonedSize;\n    }\n\n    /**\n     * The frame size may be from screen size or an external editor options by setting screen.windowSize.\n     * @param sizeInCssPixels you need to specify this size when the windowType is SubFrame.\n     */\n    private _resizeFrame (sizeInCssPixels?: Size) {\n        if (!this._gameFrame) {\n            return;\n        }\n        // Center align the canvas\n        this._gameFrame.style.display = 'flex';\n        this._gameFrame.style['justify-content'] = 'center';\n        this._gameFrame.style['align-items'] = 'center';\n        if (this._windowType === WindowType.SubFrame) {\n            if (!sizeInCssPixels) {\n                this._updateContainer();\n                return;\n            }\n            this._gameFrame.style.width = `${sizeInCssPixels.width}px`;\n            this._gameFrame.style.height = `${sizeInCssPixels.height}px`;\n        } else {\n            const winWidth = window.innerWidth; const winHeight = window.innerHeight;\n            if (this.isFrameRotated) {\n                this._gameFrame.style['-webkit-transform'] = 'rotate(90deg)';\n                this._gameFrame.style.transform = 'rotate(90deg)';\n                this._gameFrame.style['-webkit-transform-origin'] = '0px 0px 0px';\n                this._gameFrame.style.transformOrigin = '0px 0px 0px';\n                this._gameFrame.style.margin = `0 0 0 ${winWidth}px`;\n                this._gameFrame.style.width = `${winHeight}px`;\n                this._gameFrame.style.height = `${winWidth}px`;\n            } else {\n                this._gameFrame.style['-webkit-transform'] = 'rotate(0deg)';\n                this._gameFrame.style.transform = 'rotate(0deg)';\n                // TODO\n                // this._gameFrame.style['-webkit-transform-origin'] = '0px 0px 0px';\n                // this._gameFrame.style.transformOrigin = '0px 0px 0px';\n                this._gameFrame.style.margin = '0px auto';\n                this._gameFrame.style.width = `${winWidth}px`;\n                this._gameFrame.style.height = `${winHeight}px`;\n            }\n        }\n\n        this._updateContainer();\n    }\n\n    private _getFullscreenTarget () {\n        const windowType = this._windowType;\n        if (windowType === WindowType.Fullscreen) {\n            return document[this._fn.fullscreenElement] as HTMLElement;\n        }\n        if (windowType === WindowType.SubFrame) {\n            return this._gameFrame;\n        }\n        // On web mobile, the transform of game frame doesn't work when it's on fullscreen.\n        // So we need to make the body fullscreen.\n        return document.body;\n    }\n    private _doRequestFullScreen (): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!this._supportFullScreen) {\n                reject(new Error('fullscreen is not supported'));\n                return;\n            }\n            const fullscreenTarget = this._getFullscreenTarget();\n            if (!fullscreenTarget) {\n                reject(new Error('Cannot access fullscreen target'));\n                return;\n            }\n            this._onFullscreenChange = undefined;\n            this._onFullscreenError = undefined;\n            const requestPromise = fullscreenTarget[this._fn.requestFullscreen]() as Promise<void> | undefined;\n            if (window.Promise && requestPromise instanceof Promise) {\n                requestPromise.then(resolve).catch(reject);\n            } else {\n                this._onFullscreenChange = resolve;\n                this._onFullscreenError = reject;\n            }\n        });\n    }\n    private _updateFrameState () {\n        const orientation = this.orientation;\n        const width = window.innerWidth;\n        const height = window.innerHeight;\n        const isBrowserLandscape = width > height;\n        this.isFrameRotated = systemInfo.isMobile\n            && ((isBrowserLandscape && orientation === Orientation.PORTRAIT) || (!isBrowserLandscape && orientation === Orientation.LANDSCAPE));\n    }\n    private _updateContainer () {\n        if (!this._gameContainer) {\n            warnID(9201);\n            return;\n        }\n        if (this.isProportionalToFrame) {\n            if (!this._gameFrame) {\n                warnID(9201);\n                return;\n            }\n            // TODO: access designedResolution from Launcher module.\n            const designedResolution = legacyCC.view.getDesignResolutionSize() as Size;\n            const frame = this._gameFrame;\n            const frameW = frame.clientWidth;\n            const frameH = frame.clientHeight;\n            const designW = designedResolution.width;\n            const designH = designedResolution.height;\n            const scaleX = frameW / designW;\n            const scaleY = frameH / designH;\n            const containerStyle = this._gameContainer.style;\n            let containerW: number;\n            let containerH: number;\n\n            if (scaleX < scaleY) {\n                containerW = frameW;\n                containerH = designH * scaleX;\n            } else {\n                containerW = designW * scaleY;\n                containerH = frameH;\n            }\n            // Set window size on game container\n            containerStyle.width = `${containerW}px`;\n            containerStyle.height = `${containerH}px`;\n        } else {\n            const containerStyle = this._gameContainer.style;\n            // game container exact fit game frame.\n            containerStyle.width = '100%';\n            containerStyle.height = '100%';\n        }\n\n        // Cache Test\n        if (this._gameFrame\n            && (this._cachedFrameStyle.width !== this._gameFrame.style.width\n            || this._cachedFrameStyle.height !== this._gameFrame.style.height\n            || this._cachedContainerStyle.width !== this._gameContainer.style.width\n            || this._cachedContainerStyle.height !== this._gameContainer.style.height)) {\n            this.emit('window-resize');\n\n            // Update Cache\n            this._cachedFrameStyle.width = this._gameFrame.style.width;\n            this._cachedFrameStyle.height = this._gameFrame.style.height;\n            this._cachedContainerStyle.width = this._gameContainer.style.width;\n            this._cachedContainerStyle.height = this._gameContainer.style.height;\n        }\n    }\n}\n\nexport const screenAdapter = new ScreenAdapter();\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { IScreenOptions, screenAdapter } from 'pal/screen-adapter';\nimport { legacyCC } from '../global-exports';\nimport { Size } from '../math';\nimport { Settings, settings } from '../settings';\nimport { warnID } from './debug';\n\n/**\n * @en The screen API provides an easy way to do some screen managing stuff.\n * @zh screen 单例对象提供简单的方法来做屏幕管理相关的工作。\n */\nclass Screen {\n    /**\n     * @internal\n     */\n    public init () {\n        const exactFitScreen = settings.querySettings(Settings.Category.SCREEN, 'exactFitScreen') ?? true;\n        const orientation = settings.querySettings(Settings.Category.SCREEN, 'orientation') ?? 'auto';\n        screenAdapter.init({ exactFitScreen, configOrientation: orientation }, () => {\n            const director = legacyCC.director;\n            if (!director.root?.pipeline) {\n                warnID(1220);\n                return;\n            }\n            director.root.pipeline.shadingScale = screenAdapter.resolutionScale;\n        });\n    }\n\n    /**\n     * @en the ratio of the resolution in physical pixels to the resolution in CSS pixels for the current display device\n     * NOTE: For performance reasons, the engine will limit the maximum value of DPR on some platforms.\n     * This property returns the DPR after the engine limit.\n     * @zh 当前显示设备的物理像素分辨率与 CSS 像素分辨率之比\n     * 注意：出于性能考虑，引擎在一些平台会限制 DPR 的最高值，这个属性返回的是引擎限制后的 DPR。\n     */\n    public get devicePixelRatio () {\n        return screenAdapter.devicePixelRatio;\n    }\n\n    /**\n     * @en Get and set the size of current window in physical pixels.\n     * NOTE:\n     * - Setting window size is only supported on Web platform for now.\n     * - On Web platform, if the ContainerStrategy is PROPORTIONAL_TO_FRAME, we set windowSize on game frame,\n     *    and get windowSize from the game container after adaptation.\n     * @zh 获取和设置当前窗口的物理像素尺寸。\n     * 注意\n     * - 设置窗口尺寸目前只在 Web 平台上支持。\n     * - Web 平台上，如果 ContainerStrategy 为 PROPORTIONAL_TO_FRAME, 则设置 windowSize 作用于 game frame, 而从适配之后 game container 尺寸获取 windowSize.\n     */\n    public get windowSize (): Size {\n        return screenAdapter.windowSize;\n    }\n    public set windowSize (size: Size) {\n        screenAdapter.windowSize = size;\n    }\n\n    /**\n     * @en Get the current resolution of game.\n     * This is a readonly property.\n     * @zh 获取当前游戏的分辨率。\n     * 这是一个只读属性。\n     *\n     * @readonly\n     */\n    public get resolution () {\n        return screenAdapter.resolution;\n    }\n\n    // /**\n    //  * @en Get and set the resolution scale of screen, which will affect the quality of the rendering.\n    //  * Note: if this value is set too high, the rendering performance of GPU will be reduced, this value is 1 by default.\n    //  * @zh 获取和设置屏幕的分辨率缩放比，这将会影响最终渲染的质量。\n    //  * 注意：如果这个值设置的太高，会降低 GPU 的渲染性能，该值默认为 1。\n    //  */\n    // public get resolutionScale () {\n    //     return screenAdapter.resolutionScale;\n    // }\n    // public set resolutionScale (v: number) {\n    //     screenAdapter.resolutionScale = v;\n    // }\n\n    /**\n     * @en Whether it supports full screen？\n     * @zh 是否支持全屏？\n     * @returns {Boolean}\n     */\n    public get supportsFullScreen (): boolean {\n        return screenAdapter.supportFullScreen;\n    }\n\n    /**\n     * @en Return true if it's in full screen state now.\n     * @zh 当前是否处在全屏状态下\n     * @returns {boolean}\n     */\n    public fullScreen (): boolean {\n        return screenAdapter.isFullScreen;\n    }\n\n    /**\n     * @en Request to enter full screen mode with the given element.\n     * Many browsers forbid to enter full screen mode without an user intended interaction.\n     * If failed to request fullscreen, another attempt will be made to request fullscreen the next time a user interaction occurs.\n     * @zh 尝试使当前节点进入全屏模式，很多浏览器不允许程序触发这样的行为，必须在一个用户交互回调中才会生效。\n     * 如果进入全屏失败，会在下一次用户发生交互时，再次尝试进入全屏。\n     * @param element The element to request full screen state\n     * @param onFullScreenChange callback function when full screen state changed\n     * @param onFullScreenError callback function when full screen error\n     * @return {Promise|undefined}\n     * @deprecated since v3.3, please use `screen.requestFullScreen(): Promise<void>` instead.\n     */\n    public requestFullScreen (element: HTMLElement, onFullScreenChange?: (this: Document, ev: any) => any, onFullScreenError?: (this: Document, ev: any) => any): Promise<any> | undefined;\n    /**\n     * @en Request to enter full screen mode.\n     * Many browsers forbid to enter full screen mode without an user intended interaction.\n     * If failed to request fullscreen, another attempt will be made to request fullscreen the next time a user interaction occurs.\n     * @zh 尝试使当前屏幕进入全屏模式，很多浏览器不允许程序触发这样的行为，必须在一个用户交互回调中才会生效。\n     * 如果进入全屏失败，会在下一次用户发生交互时，再次尝试进入全屏。\n     * @return {Promise}\n     */\n    public requestFullScreen (): Promise<void>;\n    public requestFullScreen (element?: HTMLElement, onFullScreenChange?: (this: Document, ev: any) => any, onFullScreenError?: (this: Document, ev: any) => any): Promise<any> {\n        if (arguments.length > 0) {\n            warnID(1400, 'screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)', 'screen.requestFullScreen(): Promise');\n        }\n        return screenAdapter.requestFullScreen().then(() => {\n            // @ts-expect-error no parameter passed\n            onFullScreenChange?.();\n        }).catch((err) => {\n            console.error(err);\n            // @ts-expect-error no parameter passed\n            onFullScreenError?.();\n        });\n    }\n\n    /**\n     * @en Exit the full mode.\n     * @zh 退出全屏模式\n     * @return {Promise}\n     */\n    public exitFullScreen (): Promise<any> {\n        return screenAdapter.exitFullScreen();\n    }\n\n    /**\n     * @en Automatically request full screen during the next touch/click event\n     * @zh 自动监听触摸、鼠标事件并在下一次事件触发时尝试进入全屏模式\n     * @param element The element to request full screen state\n     * @param onFullScreenChange callback function when full screen state changed\n     *\n     * @deprecated since v3.3, please use screen.requestFullScreen() instead.\n     */\n    public autoFullScreen (element: HTMLElement, onFullScreenChange: (this: Document, ev: any) => any) {\n        this.requestFullScreen(element, onFullScreenChange)?.catch((e) => {});\n    }\n\n    /**\n     * @param element\n     * @deprecated since v3.3\n     */\n    public disableAutoFullScreen (element) {\n        // DO NOTHING\n    }\n\n    // TODO: to support registering fullscreen change\n    // TODO: to support screen resize\n}\n\nconst screen = new Screen();\n\nlegacyCC.screen = screen;\n\nexport { screen };\n","/* eslint-disable max-len */\n/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { JSB, WEBGPU } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport { error, getError } from '../platform/debug';\nimport { sys } from '../platform/sys';\nimport { BindingMappingInfo, DeviceInfo, SwapchainInfo } from './base/define';\nimport { Device } from './base/device';\nimport { Swapchain } from './base/swapchain';\nimport { BrowserType } from '../../../pal/system-info/enum-type';\nimport { screen } from '../platform/screen';\nimport { Settings, settings } from '../settings';\n\n/**\n * @en\n * Sets the renderer type, only useful on web\n *\n * @zh\n * 渲染模式。\n * 设置渲染器类型，仅适用于 web 端\n * @internal\n */\nexport enum LegacyRenderMode {\n    /**\n     * @en\n     * Automatically chosen by engine.\n     * @zh\n     * 通过引擎自动选择。\n     */\n    AUTO = 0,\n    /**\n     * @en\n     * Forced to use canvas renderer.\n     * @zh\n     * 强制使用 canvas 渲染。\n     */\n    CANVAS = 1,\n    /**\n     * @en\n     * Forced to use WebGL renderer, but this will be ignored on mobile browsers.\n     * @zh\n     * 强制使用 WebGL 渲染，但是在部分 Android 浏览器中这个选项会被忽略。\n     */\n    WEBGL = 2,\n    /**\n     * @en\n     * Use Headless Renderer, which is useful in test or server env, only for internal use by cocos team for now\n     * @zh\n     * 使用空渲染器，可以用于测试和服务器端环境，目前暂时用于 Cocos 内部测试使用。\n     */\n    HEADLESS = 3\n}\n\n/**\n * @internal\n */\nexport enum RenderType {\n    UNKNOWN = -1,\n    CANVAS = 0,\n    WEBGL = 1,\n    OPENGL = 2,\n    HEADLESS = 3,\n}\n\n/**\n * @internal\n */\n\nexport class DeviceManager {\n    private initialized = false;\n    private _gfxDevice!: Device;\n    private _canvas: HTMLCanvasElement | null = null;\n    private _swapchain!: Swapchain;\n    private _renderType: RenderType = RenderType.UNKNOWN;\n\n    public get gfxDevice () {\n        return this._gfxDevice;\n    }\n\n    public get swapchain () {\n        return this._swapchain;\n    }\n\n    public init (canvas: HTMLCanvasElement | null, bindingMappingInfo: BindingMappingInfo) {\n        // Avoid setup to be called twice.\n        if (this.initialized) { return; }\n        const renderMode = settings.querySettings(Settings.Category.RENDERING, 'renderMode');\n        this._canvas = canvas;\n\n        this._renderType = this._determineRenderType(renderMode);\n\n        // WebGL context created successfully\n        if (this._renderType === RenderType.WEBGL) {\n            const deviceInfo = new DeviceInfo(bindingMappingInfo);\n\n            if (JSB && window.gfx) {\n                this._gfxDevice = gfx.DeviceManager.create(deviceInfo);\n            } else {\n                let useWebGL2 = (!!window.WebGL2RenderingContext);\n                const userAgent = window.navigator.userAgent.toLowerCase();\n                if (userAgent.indexOf('safari') !== -1 && userAgent.indexOf('chrome') === -1\n                    || sys.browserType === BrowserType.UC // UC browser implementation doesn't conform to WebGL2 standard\n                ) {\n                    useWebGL2 = false;\n                }\n\n                const deviceCtors: Constructor<Device>[] = [];\n                if (WEBGPU) {\n                    deviceCtors.push(legacyCC.WebGPUDevice);\n                }\n                if (useWebGL2 && legacyCC.WebGL2Device) {\n                    deviceCtors.push(legacyCC.WebGL2Device);\n                }\n                if (legacyCC.WebGLDevice) {\n                    deviceCtors.push(legacyCC.WebGLDevice);\n                }\n                if (legacyCC.EmptyDevice) {\n                    deviceCtors.push(legacyCC.EmptyDevice);\n                }\n\n                Device.canvas = canvas!;\n                for (let i = 0; i < deviceCtors.length; i++) {\n                    this._gfxDevice = new deviceCtors[i]();\n                    if (this._gfxDevice.initialize(deviceInfo)) { break; }\n                }\n            }\n        } else if (this._renderType === RenderType.HEADLESS && legacyCC.EmptyDevice) {\n            this._gfxDevice = new legacyCC.EmptyDevice();\n            this._gfxDevice.initialize(new DeviceInfo(bindingMappingInfo));\n        }\n\n        if (!this._gfxDevice) {\n            // todo fix here for wechat game\n            error('can not support canvas rendering in 3D');\n            this._renderType = RenderType.UNKNOWN;\n            return;\n        }\n\n        const swapchainInfo = new SwapchainInfo(this._canvas!);\n        const windowSize = screen.windowSize;\n        swapchainInfo.width = windowSize.width;\n        swapchainInfo.height = windowSize.height;\n        this._swapchain = this._gfxDevice.createSwapchain(swapchainInfo);\n\n        if (this._canvas) { this._canvas.oncontextmenu = () => false; }\n    }\n\n    private _determineRenderType (renderMode: LegacyRenderMode): RenderType {\n        if (typeof renderMode !== 'number' || renderMode > RenderType.HEADLESS || renderMode < LegacyRenderMode.AUTO) {\n            renderMode = LegacyRenderMode.AUTO;\n        }\n        // Determine RenderType\n        let renderType = RenderType.CANVAS;\n        let supportRender = false;\n\n        if (renderMode === LegacyRenderMode.CANVAS) {\n            renderType = RenderType.CANVAS;\n            supportRender = true;\n        } else if (renderMode === LegacyRenderMode.AUTO || renderMode === LegacyRenderMode.WEBGL) {\n            renderType = RenderType.WEBGL;\n            supportRender = true;\n        } else if (renderMode === LegacyRenderMode.HEADLESS) {\n            renderType = RenderType.HEADLESS;\n            supportRender = true;\n        }\n\n        if (!supportRender) {\n            throw new Error(getError(3820, renderMode));\n        }\n        return renderType;\n    }\n}\n\n/**\n * @internal\n */\nexport const deviceManager = new DeviceManager();\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { systemInfo } from 'pal/system-info';\nimport { screenAdapter } from 'pal/screen-adapter';\nimport { WECHAT } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport { Rect } from '../math/rect';\nimport { Vec2 } from '../math/vec2';\nimport { warnID, log } from './debug';\nimport { NetworkType, Language, OS, Platform, BrowserType, Feature } from '../../../pal/system-info/enum-type';\nimport { screen } from './screen';\n\nexport declare namespace sys {\n    /**\n     * @en\n     * Platform related feature enum type.\n     * @zh\n     * 平台相关的特性枚举类型。\n     */\n    export type Feature = EnumAlias<typeof Feature>;\n}\n\n/**\n * @en A set of system related variables\n * @zh 一系列系统相关环境变量\n */\nexport const sys = {\n    Feature,\n\n    /**\n     * @en\n     * Returns if the specified platform related feature is supported.\n     * @zh\n     * 返回指定的平台相关的特性是否支持。\n     */\n    hasFeature (feature: sys.Feature): boolean {\n        return systemInfo.hasFeature(feature);\n    },\n\n    /**\n     * @en\n     * Network type enumeration\n     * @zh\n     * 网络类型枚举\n     */\n    NetworkType,\n\n    /**\n     * @en\n     * LanguageCode type enumeration\n     * @zh\n     * 语言码类型枚举\n     */\n    Language,\n\n    /**\n     * @en\n     * OS type enumeration\n     * @zh\n     * 操作系统类型枚举\n     */\n    OS,\n\n    /**\n     * @en\n     * Platform type enumeration\n     * @zh\n     * 平台类型枚举\n     */\n    Platform,\n\n    /**\n     * @en\n     * Browser type enumeration\n     * @zh\n     * 浏览器类型枚举\n     */\n    BrowserType,\n\n    /**\n     * @en Whether the running platform is native app\n     * @zh 指示运行平台是否是原生平台\n     */\n    isNative: systemInfo.isNative,\n\n    /**\n     * @en Whether the running platform is browser\n     * @zh 指示运行平台是否是浏览器\n     */\n    isBrowser: systemInfo.isBrowser,\n\n    /**\n     * @en Indicate whether the current running context is a mobile system\n     * @zh 指示当前运行平台是否是移动端平台\n     */\n    isMobile: systemInfo.isMobile,\n\n    /**\n     * @en Whether the endianness of current platform is little endian\n     * @zh 当前平台字节顺序是否是小端序\n     */\n    isLittleEndian: systemInfo.isLittleEndian,\n\n    /**\n     * @en The running platform\n     * @zh 当前运行平台或环境\n     */\n    platform: systemInfo.platform,\n\n    /**\n     * @en Indicate the current language of the running system\n     * @zh 指示当前运行环境的语言\n     */\n    language: systemInfo.language,\n\n    /**\n     * @en\n     * Get current language iso 639-1 code.\n     * Examples of valid language codes include \"zh-tw\", \"en\", \"en-us\", \"fr\", \"fr-fr\", \"es-es\", etc.\n     * The actual value totally depends on results provided by destination platform.\n     * @zh\n     * 指示当前运行环境的语言\n     * 获取当前的语言iso 639-1代码。\n     * 有效的语言代码包括 \"zh-tw\"、\"en\"、\"en-us\"、\"fr\"、\"fr-fr\"、\"es-es \"等。\n     * 实际值完全取决于目的地平台提供的结果。\n     */\n    languageCode: systemInfo.nativeLanguage,\n\n    /**\n     * @en Indicate the running os name\n     * @zh 指示当前运行系统\n     */\n    os: systemInfo.os,\n\n    /**\n     * @en Indicate the running os version string\n     * @zh 指示当前运行系统版本字符串\n     */\n    osVersion: systemInfo.osVersion,\n\n    /**\n     * @en Indicate the running os main version\n     * @zh 指示当前系统主版本\n     */\n    osMainVersion: systemInfo.osMainVersion,\n\n    /**\n     * @en Indicate the running browser type\n     * @zh 指示当前运行的浏览器类型\n     */\n    browserType: systemInfo.browserType,\n\n    /**\n     * @en Indicate the running browser version\n     * @zh 指示当前运行的浏览器版本\n     */\n    browserVersion: systemInfo.browserVersion,\n\n    /**\n     * @en Whether the running platform is xr app\n     * @zh 指示运行平台是否是XR平台\n     */\n    isXR: systemInfo.isXR,\n\n    /**\n     * @en Indicate the real pixel resolution of the whole game window\n     * @zh 指示游戏窗口的像素分辨率\n     *\n     * @deprecated since v3.4.0, please use screen.windowSize instead.\n     */\n    windowPixelResolution: screen.windowSize,\n\n    /**\n     * @en The capabilities of the current platform\n     * @zh 当前平台的功能可用性\n     *\n     * @deprecated since v3.4.0, please use sys.hasFeature() instead.\n     */\n    capabilities: {\n        canvas: true,\n        opengl: true,\n        webp: systemInfo.hasFeature(Feature.WEBP),\n        imageBitmap: systemInfo.hasFeature(Feature.IMAGE_BITMAP),\n        touches: systemInfo.hasFeature(Feature.INPUT_TOUCH),\n        mouse: systemInfo.hasFeature(Feature.EVENT_MOUSE),\n        keyboard: systemInfo.hasFeature(Feature.EVENT_KEYBOARD),\n        accelerometer: systemInfo.hasFeature(Feature.EVENT_ACCELEROMETER),\n    },\n\n    /**\n     * @en It is a local storage component based on HTML5 localStorage API, on web platform, it's equal to window.localStorage\n     * @zh HTML5 标准中的 localStorage 的本地存储功能，在 Web 端等价于 window.localStorage\n     */\n    localStorage: {} as Storage,\n\n    /**\n     * @en Get the network type of current device, return `sys.NetworkType.LAN` if failure.\n     * @zh 获取当前设备的网络类型, 如果网络类型无法获取，默认将返回 `sys.NetworkType.LAN`\n     */\n    getNetworkType (): NetworkType {\n        return systemInfo.networkType;\n    },\n\n    /**\n     * @en Get the battery level of current device, return 1.0 if failure.\n     * @zh 获取当前设备的电池电量，如果电量无法获取，默认将返回 1\n     * @return - 0.0 ~ 1.0\n     */\n    getBatteryLevel (): number {\n        return systemInfo.getBatteryLevel();\n    },\n\n    /**\n     * @en Forces the garbage collection, only available in native platforms\n     * @zh 强制进行 JS 内存垃圾回收，尽在原生平台有效\n     */\n    garbageCollect () {\n        systemInfo.triggerGC();\n    },\n\n    /**\n     * @en Check whether an object is valid,\n     * In web engine, it will return true if the object exist\n     * In native engine, it will return true if the JS object and the correspond native object are both valid\n     * @zh 检查一个对象是否非空或在原生平台有效，\n     * 在 Web 平台，只要对象非空或非 Undefined 就会返回 true，在原生平台，我们会检查当前 JS 对象和其绑定的原生对象是否都有效\n     * @param obj The object to be checked\n     */\n    isObjectValid (obj: any): boolean {\n        if (obj === null || obj === undefined) {\n            return false;\n        }\n\n        return true;\n    },\n\n    /**\n     * @en Dump systemInfo informations\n     * @zh 在控制台打印当前的主要系统信息\n     */\n    dump () {\n        let str = '';\n        str += `isMobile : ${this.isMobile}\\r\\n`;\n        str += `language : ${this.language}\\r\\n`;\n        str += `browserType : ${this.browserType}\\r\\n`;\n        str += `browserVersion : ${this.browserVersion}\\r\\n`;\n        str += `capabilities : ${JSON.stringify(this.capabilities)}\\r\\n`;\n        str += `os : ${this.os}\\r\\n`;\n        str += `osVersion : ${this.osVersion}\\r\\n`;\n        str += `platform : ${this.platform}\\r\\n`;\n        str += `Using ${legacyCC.game.renderType === legacyCC.game.RENDER_TYPE_WEBGL ? 'WEBGL' : 'CANVAS'} renderer.\\r\\n`;\n        log(str);\n    },\n\n    /**\n     * @en Try to open a url in browser, may not work in some platforms\n     * @zh 尝试打开一个 web 页面，并非在所有平台都有效\n     */\n    openURL (url) {\n        systemInfo.openURL(url);\n    },\n\n    /**\n     * @internal\n     */\n    init () {\n        try {\n            let localStorage: Storage | null = sys.localStorage = window.localStorage;\n            localStorage.setItem('storage', '');\n            localStorage.removeItem('storage');\n            localStorage = null;\n        } catch (e) {\n            const warn = function () {\n                warnID(5200);\n            };\n            this.localStorage = {\n                // @ts-expect-error Type '() => void' is not assignable to type '(key: string) => string | null'\n                getItem: warn,\n                setItem: warn,\n                clear: warn,\n                removeItem: warn,\n            };\n        }\n\n        if (WECHAT) {\n            // @ts-expect-error HACK: this private property only needed on web & wechat JIT\n            this.__isWebIOS14OrIPadOS14Env = (sys.os === OS.IOS || sys.os === OS.OSX) && GameGlobal?.isIOSHighPerformanceMode\n            && /(OS 1((4\\.[0-9])|(5\\.[0-3])))|(Version\\/1((4\\.[0-9])|(5\\.[0-3])))/.test(window.navigator.userAgent);\n        } else {\n            // @ts-expect-error HACK: this private property only needed on web & wechat JIT\n            this.__isWebIOS14OrIPadOS14Env = (sys.os === OS.IOS || sys.os === OS.OSX) && systemInfo.isBrowser\n            && /(OS 14)|(Version\\/14)/.test(window.navigator.userAgent);\n        }\n    },\n\n    /**\n     * @en Get the current time in milliseconds\n     * @zh 获取当前时间（毫秒为单位）\n     */\n    now () {\n        return systemInfo.now();\n    },\n\n    /**\n     * Restart the JS VM, only available in native platforms\n     * @private\n     */\n    restartVM () {\n        systemInfo.restartJSVM();\n    },\n\n    /**\n     * @en\n     * Returns the safe area of the screen (in design resolution) based on the game view coordinate system.\n     * If the screen is not notched, this method returns a Rect of the same size as visibleSize by default.\n     * Currently supports Android, iOS and WeChat, ByteDance Mini Game platform.\n     * @zh\n     * 返回基于游戏视图坐标系的手机屏幕安全区域（设计分辨率为单位），如果不是异形屏将默认返回一个和 visibleSize 一样大的 Rect。目前支持安卓、iOS 原生平台和微信、字节小游戏平台。\n     * @method getSafeAreaRect\n     * @return {Rect}\n     */\n    getSafeAreaRect () {\n        const locView = legacyCC.view;\n        const edge = screenAdapter.safeAreaEdge;\n        const windowSize = screenAdapter.windowSize;\n\n        // Get leftBottom and rightTop point in screen coordinates system.\n        const leftBottom = new Vec2(edge.left, edge.bottom);\n        const rightTop = new Vec2(windowSize.width - edge.right, windowSize.height - edge.top);\n\n        // Convert view point to UI coordinate system.\n        locView._convertToUISpace(leftBottom);\n        locView._convertToUISpace(rightTop);\n\n        const x = leftBottom.x;\n        const y = leftBottom.y;\n        const width = rightTop.x - leftBottom.x;\n        const height = rightTop.y - leftBottom.y;\n        return new Rect(x, y, width, height);\n    },\n};\n\nlegacyCC.sys = sys;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3 } from '../math';\nimport { AABB } from './aabb';\nimport { OBB } from './obb';\nimport { Plane } from './plane';\n\nconst X = new Vec3();\nconst Y = new Vec3();\nconst Z = new Vec3();\nconst d = new Vec3();\nconst min = new Vec3();\nconst max = new Vec3();\nconst u = new Array(3);\nconst e = new Array(3);\n\n/**\n * @en\n * the distance between a point and a plane\n * @zh\n * 计算点和平面之间的距离。\n * @param {Vec3} point @en Target point @zh 目标点。\n * @param {Plane} plane @en Target plane @zh 目标平面。\n * @return @en The distance in between @zh 距离。\n */\nexport function point_plane (point: Vec3, plane_: Plane) {\n    return Vec3.dot(plane_.n, point) - plane_.d;\n}\n\n/**\n * @en\n * the closest point on plane to a given point\n * @zh\n * 计算平面上最接近给定点的点。\n * @param out @en The closest point, as a result @zh 最近点。\n * @param point @en The given point @zh 给定点。\n * @param plane @en Target plane @zh 平面。\n * @return @en The closest point, same as out @zh 最近点。\n */\nexport function pt_point_plane (out: Vec3, point: Vec3, plane_: Plane) {\n    const t = point_plane(point, plane_);\n    return Vec3.subtract(out, point, Vec3.multiplyScalar(out, plane_.n, t));\n}\n\n/**\n * @en\n * the closest point on aabb to a given point\n * @zh\n * 计算 aabb 上最接近给定点的点。\n * @param {Vec3} out @en The closest point, as a result @zh 最近点。\n * @param {Vec3} point @en The given point @zh 给定点。\n * @param {AABB} aabb @en Target aabb to calculate @zh 轴对齐包围盒。\n * @return {Vec3} @en The closest point, same as out @zh 最近点。\n */\nexport function pt_point_aabb (out: Vec3, point: Vec3, aabb_: AABB): Vec3 {\n    Vec3.copy(out, point);\n    Vec3.subtract(min, aabb_.center, aabb_.halfExtents);\n    Vec3.add(max, aabb_.center, aabb_.halfExtents);\n\n    out.x = (out.x < min.x) ? min.x : out.x;\n    out.y = (out.y < min.y) ? min.y : out.y;\n    out.z = (out.z < min.z) ? min.z : out.z;\n\n    out.x = (out.x > max.x) ? max.x : out.x;\n    out.y = (out.y > max.y) ? max.y : out.y;\n    out.z = (out.z > max.z) ? max.z : out.z;\n    return out;\n}\n\n/**\n * @en\n * the closest point on obb to a given point\n * @zh\n * 计算 obb 上最接近给定点的点。\n * @param {Vec3} out @en The closest point, as a result @zh 最近点。\n * @param {Vec3} point @en The given point @zh 给定点。\n * @param {OBB} obb @en Target obb to calculate @zh 方向包围盒。\n * @return {Vec3} @en The closest point, same as out @zh 最近点。\n */\nexport function pt_point_obb (out: Vec3, point: Vec3, obb_: OBB): Vec3 {\n    Vec3.set(X, obb_.orientation.m00, obb_.orientation.m01, obb_.orientation.m02);\n    Vec3.set(Y, obb_.orientation.m03, obb_.orientation.m04, obb_.orientation.m05);\n    Vec3.set(Z, obb_.orientation.m06, obb_.orientation.m07, obb_.orientation.m08);\n\n    u[0] = X;\n    u[1] = Y;\n    u[2] = Z;\n    e[0] = obb_.halfExtents.x;\n    e[1] = obb_.halfExtents.y;\n    e[2] = obb_.halfExtents.z;\n\n    Vec3.subtract(d, point, obb_.center);\n\n    // Start result at center of obb; make steps from there\n    Vec3.set(out, obb_.center.x, obb_.center.y, obb_.center.z);\n\n    // For each OBB axis...\n    for (let i = 0; i < 3; i++) {\n        // ...project d onto that axis to get the distance\n        // along the axis of d from the obb center\n        let dist = Vec3.dot(d, u[i]);\n\n        // if distance farther than the obb extents, clamp to the obb\n        if (dist > e[i]) {\n            dist = e[i];\n        }\n        if (dist < -e[i]) {\n            dist = -e[i];\n        }\n\n        // Step that distance along the axis to get world coordinate\n        out.x += dist * u[i].x;\n        out.y += dist * u[i].y;\n        out.z += dist * u[i].z;\n    }\n    return out;\n}\n\n/**\n * @en\n * Calculate the nearest point on the line, which is from A to B, to the given point\n * @zh\n * 计算给定点距离线段上最近的一点。线段从A到B。\n * @param out @en The closest point, as a result @zh 最近点\n * @param point @en The given point @zh 给定点\n * @param linePointA @en Point A on the line @zh 线上的某点 A\n * @param linePointB @en Point B on the line @zh 线上的某点 B\n */\nexport function pt_point_line (out: Vec3, point: Vec3, linePointA: Vec3, linePointB: Vec3) {\n    Vec3.subtract(X, linePointA, linePointB);\n    const dir = X;\n    const dirSquaredLength = Vec3.lengthSqr(dir);\n\n    if (dirSquaredLength == 0) {\n        // The point is at the segment start.\n        Vec3.copy(out, linePointA);\n    } else {\n        // Calculate the projection of the point onto the line extending through the segment.\n        Vec3.subtract(X, point, linePointA);\n        const t = Vec3.dot(X, dir) / dirSquaredLength;\n\n        if (t < 0) {\n            // The point projects beyond the segment start.\n            Vec3.copy(out, linePointA);\n        } else if (t > 1) {\n            // The point projects beyond the segment end.\n            Vec3.copy(out, linePointB);\n        } else {\n            // The point projects between the start and end of the segment.\n            Vec3.scaleAndAdd(out, linePointA, dir, t);\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * 几何工具模块\n * @module geometry\n */\n\n/**\n * @en\n * The enum type of basic geometry.\n * @zh\n * 形状的类型值。\n */\nexport default {\n    SHAPE_RAY: (1 << 0),\n    SHAPE_LINE: (1 << 1),\n    SHAPE_SPHERE: (1 << 2),\n    SHAPE_AABB: (1 << 3),\n    SHAPE_OBB: (1 << 4),\n    SHAPE_PLANE: (1 << 5),\n    SHAPE_TRIANGLE: (1 << 6),\n    SHAPE_FRUSTUM: (1 << 7),\n    SHAPE_FRUSTUM_ACCURATE: (1 << 8),\n    SHAPE_CAPSULE: (1 << 9),\n    SHAPE_SPLINE: (1 << 10),\n};\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3 } from '../math';\nimport enums from './enums';\n\n/**\n * @en\n * Basic Geometry: Line.\n * @zh\n * 基础几何 line。\n */\nexport class Line {\n    /**\n     * @en\n     * create a new line\n     * @zh\n     * 创建一个新的 line。\n     * @param sx @en Start position x @zh 起点的 x 坐标。\n     * @param sy @en Start position y @zh 起点的 y 坐标。\n     * @param sz @en Start position z @zh 起点的 z 坐标。\n     * @param ex @en End position x @zh 终点的 x 坐标。\n     * @param ey @en End position y @zh 终点的 y 坐标。\n     * @param ez @en End position z @zh 终点的 z 坐标。\n     * @return\n     */\n    public static create (sx: number, sy: number, sz: number, ex: number, ey: number, ez: number) {\n        return new Line(sx, sy, sz, ex, ey, ez);\n    }\n\n    /**\n     * @en\n     * Creates a new Line initialized with values from an existing Line\n     * @zh\n     * 克隆一个新的 line。\n     * @param a @en The line to clone from @zh 克隆的来源 Line 对象。\n     * @return @en The new line cloned @zh 克隆出的新 Line 对象\n     */\n    public static clone (a: Line) {\n        return new Line(\n            a.s.x, a.s.y, a.s.z,\n            a.e.x, a.e.y, a.e.z,\n        );\n    }\n\n    /**\n     * @en\n     * Copy the values from one Line to another\n     * @zh\n     * 复制一个线的值到另一个。\n     * @param out @en The output line to store the copied data @zh 用来存储拷贝数据的 Line 对象\n     * @param a @en The line to copy from @zh 从这个 Line 对象拷贝信息。\n     * @return @en The out object @zh 会直接返回传入的 out 对象\n     */\n    public static copy (out: Line, a: Line) {\n        Vec3.copy(out.s, a.s);\n        Vec3.copy(out.e, a.e);\n\n        return out;\n    }\n\n    /**\n     * @en\n     * create a line from two points\n     * @zh\n     * 用两个点创建一个线。\n     * @param out @en The output line @zh 接受新数据的 Line 对象\n     * @param start @en The start point @zh 起点\n     * @param end @en The end point @zh 终点\n     * @return @en The out object @zh 会直接返回传入的 out 对象\n     */\n    public static fromPoints (out: Line, start: Vec3, end: Vec3) {\n        Vec3.copy(out.s, start);\n        Vec3.copy(out.e, end);\n        return out;\n    }\n\n    /**\n     * @en\n     * Set the components of a Vec3 to the given values\n     * @zh\n     * 将给定线的属性设置为给定值。\n     * @param out @en The output line to set properties to @zh 接受新数据的 Line 对象\n     * @param sx @en Start position x @zh 起点到 x 坐标\n     * @param sy @en Start position y @zh 起点到 y 坐标\n     * @param sz @en Start position z @zh 起点到 z 坐标\n     * @param ex @en End position x @zh 终点到 x 坐标\n     * @param ey @en End position y @zh 终点到 y 坐标\n     * @param ez @en End position z @zh 终点到 z 坐标\n     * @return @en The out object @zh 会直接返回传入的 out 对象\n     */\n    public static set (out: Line, sx: number, sy: number, sz: number, ex: number, ey: number, ez: number) {\n        out.s.x = sx;\n        out.s.y = sy;\n        out.s.z = sz;\n        out.e.x = ex;\n        out.e.y = ey;\n        out.e.z = ez;\n\n        return out;\n    }\n\n    /**\n     * @en Calculate the length of the given line\n     * @zh 计算线的长度。\n     * @param a @en The line @zh 用于计算长度的线段\n     * @return @en The length of the given line @zh 线段的长度\n     */\n    public static len (a: Line) {\n        return Vec3.distance(a.s, a.e);\n    }\n\n    /**\n     * @en Start point\n     * @zh 起点。\n     */\n    public s: Vec3;\n\n    /**\n     * @en End point\n     * @zh 终点。\n     */\n    public e: Vec3;\n\n    /**\n     * @en Gets the type of the shape.\n     * @zh 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    private readonly _type: number;\n\n    /**\n     * @en Constructor of the line\n     * @zh 构造一条线。\n     * @param sx @en Start position x @zh 起点的 x 坐标\n     * @param sy @en Start position y @zh 起点的 y 坐标\n     * @param sz @en Start position z @zh 起点的 z 坐标\n     * @param ex @en End position x @zh 终点的 x 坐标\n     * @param ey @en End position y @zh 终点的 y 坐标\n     * @param ez @en End position z @zh 终点的 z 坐标\n     */\n    constructor (sx = 0, sy = 0, sz = 0, ex = 0, ey = 0, ez = -1) {\n        this._type = enums.SHAPE_LINE;\n        this.s = new Vec3(sx, sy, sz);\n        this.e = new Vec3(ex, ey, ez);\n    }\n\n    /**\n     * @en Calculate the length of the line\n     * @zh 计算线的长度。\n     * @return @en The length @zh 线段的长度\n     */\n    public length () {\n        return Vec3.distance(this.s, this.e);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3 } from '../math';\nimport enums from './enums';\nimport { IVec3Like } from '../math/type-define';\n\n/**\n * @en\n * Basic Geometry: ray.\n * @zh\n * 基础几何 射线。\n */\n\nexport class Ray {\n    /**\n     * @en\n     * create a new ray\n     * @zh\n     * 创建一条射线。\n     * @param {number} ox @en x component of start point @zh 起点的 x 部分。\n     * @param {number} oy @en y component of start point @zh 起点的 y 部分。\n     * @param {number} oz @en z component of start point @zh 起点的 z 部分。\n     * @param {number} dx @en Point in the x direction @zh 方向的 x 部分。\n     * @param {number} dy @en Point in the y direction @zh 方向的 y 部分。\n     * @param {number} dz @en Point in the z direction @zh 方向的 z 部分。\n     * @return {Ray} @en Ray object @zh 射线。\n     */\n    public static create (ox = 0, oy = 0, oz = 0, dx = 0, dy = 0, dz = 1): Ray {\n        return new Ray(ox, oy, oz, dx, dy, dz);\n    }\n\n    /**\n     * @en\n     * Creates a new ray initialized with values from an existing ray\n     * @zh\n     * 从一条射线克隆出一条新的射线。\n     * @param {Ray} a @en The Ray object to be cloned from @zh 克隆的目标。\n     * @return {Ray} @en Clone new ray object @zh 克隆出的新对象。\n     */\n    public static clone (a: Ray): Ray {\n        return new Ray(\n            a.o.x, a.o.y, a.o.z,\n            a.d.x, a.d.y, a.d.z,\n        );\n    }\n\n    /**\n     * @en\n     * Copy the values from one ray to another\n     * @zh\n     * 将从一个 ray 的值复制到另一个 ray。\n     * @param {Ray} out @en The ray object to be modified @zh 接受操作的 ray。\n     * @param {Ray} a @en The copied ray object @zh 被复制的 ray。\n     * @return {Ray} @en Ray object @zh out 接受操作的 ray。\n     */\n    public static copy (out: Ray, a: Ray): Ray {\n        Vec3.copy(out.o, a.o);\n        Vec3.copy(out.d, a.d);\n\n        return out;\n    }\n\n    /**\n     * @en\n     * create a ray from two points\n     * @zh\n     * 用两个点创建一条射线。\n     * @param {Ray} out @en The ray object to be modified @zh 接受操作的射线。\n     * @param {Vec3} origin @en Starting point of the ray @zh 射线的起点。\n     * @param {Vec3} target @en point on the ray @zh 射线上的一点。\n     * @return {Ray} @en Ray object @zh out 接受操作的射线。\n     */\n    public static fromPoints (out: Ray, origin: Vec3, target: Vec3): Ray {\n        Vec3.copy(out.o, origin);\n        Vec3.normalize(out.d, Vec3.subtract(out.d, target, origin));\n        return out;\n    }\n\n    /**\n     * @en\n     * Set the components of a ray to the given values\n     * @zh\n     * 将给定射线的属性设置为给定的值。\n     * @param {Ray} out @en The ray object to be modified @zh 接受操作的射线。\n     * @param {number} ox @en x component of start point @zh 起点的 x 部分。\n     * @param {number} oy @en y component of start point @zh 起点的 y 部分。\n     * @param {number} oz @en z component of start point @zh 起点的 z 部分。\n     * @param {number} dx @en Point in the x direction @zh 方向的 x 部分。\n     * @param {number} dy @en Point in the y direction @zh 方向的 y 部分。\n     * @param {number} dz @en Point in the z direction @zh 方向的 z 部分。\n     * @return {Ray} @en Ray object @zh out 接受操作的射线。\n     */\n    public static set (out: Ray, ox: number, oy: number, oz: number, dx: number, dy: number, dz: number): Ray {\n        out.o.x = ox;\n        out.o.y = oy;\n        out.o.z = oz;\n        out.d.x = dx;\n        out.d.y = dy;\n        out.d.z = dz;\n\n        return out;\n    }\n\n    /**\n     * @en\n     * The origin of the ray.\n     * @zh\n     * 起点。\n     */\n    public o: Vec3;\n\n    /**\n     * @en\n     * The direction of the ray.\n     * @zh\n     * 方向。\n     */\n    public d: Vec3;\n\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    protected readonly _type: number;\n\n    /**\n     * @en\n     * Construct a ray;\n     * @zh\n     * 构造一条射线。\n     * @param {number} ox @en x component of start point @zh 起点的 x 部分。\n     * @param {number} oy @en y component of start point @zh 起点的 y 部分。\n     * @param {number} oz @en z component of start point @zh 起点的 z 部分。\n     * @param {number} dx @en Point in the x direction @zh 方向的 x 部分。\n     * @param {number} dy @en Point in the y direction @zh 方向的 y 部分。\n     * @param {number} dz @en Point in the z direction @zh 方向的 z 部分。\n     */\n    constructor (ox = 0, oy = 0, oz = 0,\n        dx = 0, dy = 0, dz = -1) {\n        this._type = enums.SHAPE_RAY;\n        this.o = new Vec3(ox, oy, oz);\n        this.d = new Vec3(dx, dy, dz);\n    }\n\n    /**\n     * @en\n     * Compute a point with the distance between the origin.\n     * @zh\n     * 根据给定距离计算出射线上的一点。\n     * @param out @en Another point on the ray @zh 射线上的另一点。\n     * @param distance @en Given distance @zh 给定距离。\n     */\n    public computeHit (out: IVec3Like, distance: number) {\n        Vec3.normalize(out, this.d);\n        Vec3.scaleAndAdd(out, this.o, out, distance);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Mat4, Quat, Vec3 } from '../math';\nimport enums from './enums';\nimport { AABB } from './aabb';\n\nconst _v3_tmp = new Vec3();\nconst _offset = new Vec3();\nconst _min = new Vec3();\nconst _max = new Vec3();\nfunction maxComponent (v: Vec3) { return Math.max(Math.max(v.x, v.y), v.z); }\n\n/**\n * @en\n * Basic Geometry: Sphere.\n * @zh\n * 基础几何 轴对齐球。\n */\n\nexport class Sphere {\n    /**\n     * @en\n     * create a new sphere\n     * @zh\n     * 创建一个新的 sphere 实例。\n     * @param cx @en X-Coordinate of center point relative to the origin.  @zh 中心点的相对于原点的 X 坐标。\n     * @param cy @en Y-Coordinate of center point relative to the origin.  @zh 中心点的相对于原点的 Y 坐标。\n     * @param cz @en Z-Coordinate of center point relative to the origin.  @zh 中心点的相对于原点的 Z 坐标。\n     * @param r @en Radius of the sphere. @zh 球体的半径\n     * @return @en return a new sphere. @zh 返回一个 sphere。\n     */\n    public static create (cx: number, cy: number, cz: number, r: number): Sphere {\n        return new Sphere(cx, cy, cz, r);\n    }\n\n    /**\n     * @en\n     * clone a new sphere\n     * @zh\n     * 克隆一个新的 sphere 实例。\n     * @param p @en The sphere object to clone from. @zh 克隆的目标。\n     * @return @en The sphere object to clone to. @zh 克隆出的示例。\n     */\n    public static clone (p: Sphere): Sphere {\n        return new Sphere(p.center.x, p.center.y, p.center.z, p.radius);\n    }\n\n    /**\n     * @en\n     * copy the values from one sphere to another\n     * @zh\n     * 将从一个 sphere 的值复制到另一个 sphere。\n     * @param out @en The sphere object to copy to. @zh 接受操作的 sphere。\n     * @param a @en The sphere object to copy from. @zh 被复制的 sphere。\n     * @return @en The sphere object to copy to. @zh 接受操作的 sphere。\n     */\n    public static copy (out: Sphere, p: Sphere): Sphere {\n        Vec3.copy(out.center, p.center);\n        out.radius = p.radius;\n\n        return out;\n    }\n\n    /**\n     * @en\n     * create a new bounding sphere from two corner points\n     * @zh\n     * 从两个点创建一个新的 sphere。\n     * @param out - @en Sphere created from points. @zh 接受操作的 sphere。\n     * @param minPos - @en Lower point of the sphere. @zh sphere 的较小点。\n     * @param maxPos - @en Upper point of the sphere. @zh sphere 的较大点。\n     * @returns @en The output sphere object to save the created sphere data. @zh 接受操作的 sphere。\n     */\n    public static fromPoints (out: Sphere, minPos: Vec3, maxPos: Vec3): Sphere {\n        Vec3.multiplyScalar(out.center, Vec3.add(_v3_tmp, minPos, maxPos), 0.5);\n        out.radius = Vec3.subtract(_v3_tmp, maxPos, minPos).length() * 0.5;\n        return out;\n    }\n\n    /**\n     * @en\n     * Set the components of a sphere to the given values\n     * @zh\n     * 将球体的属性设置为给定的值。\n     * @param out @en The sphere to set properties to. @zh 接受操作的 sphere。\n     * @param cx @en X-Coordinate of center point relative to the origin.  @zh 中心点的相对于原点的 X 坐标。\n     * @param cy @en Y-Coordinate of center point relative to the origin.  @zh 中心点的相对于原点的 Y 坐标。\n     * @param cz @en Z-Coordinate of center point relative to the origin.  @zh 中心点的相对于原点的 Z 坐标。\n     * @param r @en Radius of the sphere. @zh 半径。\n     * @return @en Sphere which the properties will be set to. @zh 接受操作的 sphere。\n     * @function\n     */\n    public static set (out: Sphere, cx: number, cy: number, cz: number, r: number): Sphere {\n        out.center.x = cx;\n        out.center.y = cy;\n        out.center.z = cz;\n        out.radius = r;\n\n        return out;\n    }\n\n    /**\n     * @en\n     * The center of this sphere.\n     * @zh\n     * 本地坐标的中心点。\n     */\n    protected _center: Vec3 = new Vec3(0, 0, 0);\n    get center (): Vec3 {\n        return this._center;\n    }\n\n    set center (val: Vec3) {\n        this._center = val;\n    }\n\n    private _radius = 0;\n\n    /**\n      * @en\n      * The radius of this sphere.\n      * @zh\n      * 半径。\n      */\n    get radius (): number {\n        return this._radius;\n    }\n\n    set radius (val: number) {\n        this._radius = val;\n    }\n\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    protected readonly _type: number;\n\n    /**\n     * @en\n     * Construct a sphere.\n     * @zh\n     * 构造一个球。\n     * @param cx @en The X-Coordinate of the sphere. @zh 该球的世界坐标的 X 坐标。\n     * @param cy @en The Y-Coordinate of the sphere. @zh 该球的世界坐标的 Y 坐标。\n     * @param cz @en The Z-Coordinate of the sphere. @zh 该球的世界坐标的 Z 坐标。\n     * @param r @en The radius. @zh 半径。\n     */\n    constructor (cx = 0, cy = 0, cz = 0, r = 1) {\n        this._type = enums.SHAPE_SPHERE;\n        this._center = new Vec3(cx, cy, cz);\n        this._radius = r;\n    }\n\n    public destroy () {\n    }\n\n    /**\n     * @en\n     * Get a clone.\n     * @zh\n     * 获得克隆。\n     */\n    public clone () {\n        return Sphere.clone(this);\n    }\n\n    /**\n     * @en\n     * Copy a sphere.\n     * @zh\n     * 拷贝对象。\n     * @param a @en The sphere to copy from. @zh 拷贝的目标。\n     */\n    public copy (a: Sphere) {\n        return Sphere.copy(this, a);\n    }\n\n    /**\n     * @en\n     * Get the bounding points of this shape\n     * @zh\n     * 获取此形状的边界点。\n     * @param minPos @en The point with maximum coordinates of the sphere. @zh 最小点。\n     * @param maxPos @en The point with minimum coordinates of the sphere. @zh 最大点。\n     */\n    public getBoundary (minPos: Vec3, maxPos: Vec3) {\n        Vec3.set(minPos, this.center.x - this.radius, this.center.y - this.radius, this.center.z - this.radius);\n        Vec3.set(maxPos, this.center.x + this.radius, this.center.y + this.radius, this.center.z + this.radius);\n    }\n\n    /**\n     * @en\n     * Transform this shape\n     * @zh\n     * 将 out 根据这个 sphere 的数据进行变换。\n     * @param m @en The transform matrix. @zh 变换的矩阵。\n     * @param pos @en The position. @zh 变换的位置部分。\n     * @param rot @en The rotation. @zh 变换的旋转部分。\n     * @param scale @en The scale. @zh 变换的缩放部分。\n     * @param out @en The sphere which the transform will be applied to. @zh 变换的目标。\n     */\n    public transform (m: Mat4, pos: Vec3, rot: Quat, scale: Vec3, out: Sphere) {\n        Vec3.transformMat4(out.center, this.center, m);\n        out.radius = this.radius * maxComponent(scale);\n    }\n\n    /**\n     * @en\n     * Translate and rotate this sphere.\n     * @zh\n     * 将 out 根据这个 sphere 的数据进行变换。\n     * @param m @en The transform matrix. @zh 变换的矩阵。\n     * @param rot @en The rotation. @zh 变换的旋转部分。\n     * @param out @en The sphere which the transform will be applied to. @zh 变换的目标。\n     */\n    public translateAndRotate (m: Mat4, rot: Quat, out: Sphere) {\n        Vec3.transformMat4(out.center, this.center, m);\n    }\n\n    /**\n     * @en\n     * Scaling this sphere.\n     * @zh\n     * 将 out 根据这个 sphere 的数据进行缩放。\n     * @param scale @en The scale. @zh 缩放值。\n     * @param out @en The sphere which the scale will be applied to. @zh 缩放的目标。\n     */\n    public setScale (scale: Vec3, out: Sphere) {\n        out.radius = this.radius * maxComponent(scale);\n    }\n\n    /**\n     * @en The point to be merged.\n     * @zh 球跟点合并\n     * @param point @en The point to be merged. @zh 点\n     */\n    public mergePoint (point: Vec3) {\n        // if sphere.radius Less than 0,\n        // Set this point as anchor,\n        // And set radius to 0.\n        if (this.radius < 0.0) {\n            this.center.set(point);\n            this.radius = 0.0;\n        }\n\n        Vec3.subtract(_offset, point, this.center);\n        const dist = _offset.length();\n\n        if (dist > this.radius) {\n            const half = (dist - this.radius) * 0.5;\n            this.radius += half;\n            Vec3.multiplyScalar(_offset, _offset, half / dist);\n            Vec3.add(this.center, this.center, _offset);\n        }\n    }\n\n    /**\n     * @en The sphere and points to be merged.\n     * @zh 球跟一系列点合并\n     * @param points @en The point to be merged. @zh 一系列点\n     */\n    public mergePoints (points: Vec3[]) {\n        const length = points.length;\n        if (length < 1) return;\n\n        // Init Invalid Sphere\n        this.radius = -1.0;\n\n        for (let i = 0; i < length; i++) {\n            this.mergePoint(points[i]);\n        }\n    }\n\n    /**\n     * @en The axis-aligned bounding box to be merged.\n     * @zh 球跟立方体合并\n     * @param a @en Cube. @zh 立方体\n     */\n    public mergeAABB (a: AABB) {\n        a.getBoundary(_min, _max);\n\n        this.mergePoint(_min);\n        this.mergePoint(_max);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @en\n * The raycast mode.\n * @zh\n * 射线检测模式。\n */\nexport enum ERaycastMode {\n\n    /**\n     * @en\n     * Detect and record all data.\n     * @zh\n     * 检测并记录所有的数据。\n     */\n    ALL,\n\n    /**\n     * @en\n     * Detect all, but record only the most recent data.\n     * @zh\n     * 检测所有，但只记录最近的数据。\n     */\n    CLOSEST,\n\n    /**\n     * @en\n     * Once the test is successful, the test is stopped and the data is recorded only once.\n     * @zh\n     * 一旦检测成功就停止检测，只会记录一次数据。\n     */\n    ANY,\n}\n\n/**\n * @en\n * The storage structure of the raycast results.\n * @zh\n * 射线检测结果的存储结构。\n */\nexport interface IRaySubMeshResult {\n\n    /**\n     * @en\n     * The distance between the hit point and the ray.\n     * @zh\n     * 击中点和射线的距离。\n     */\n    distance: number;\n\n    /**\n     * @en\n     * The index of the triangle vertex 0。\n     * @zh\n     * 三角形顶点0的索引。\n     */\n    vertexIndex0: number;\n\n    /**\n     * @en\n     * The index of the triangle vertex 1。\n     * @zh\n     * 三角形顶点1的索引\n     */\n    vertexIndex1: number;\n\n    /**\n     * @en\n     * The index of the triangle vertex 2。\n     * @zh\n     * 三角形顶点2的索引\n     */\n    vertexIndex2: number;\n}\n\n/**\n * @en\n * The optional param structure of the `raySubMesh`.\n * @zh\n * `raySubMesh`的可选参数结构。\n */\nexport interface IRaySubMeshOptions {\n\n    /**\n     * @en\n     * The raycast mode，`ANY` by default.\n     * @zh\n     * 射线检测模式：[0, 1, 2]=>[`ALL`, `CLOSEST`, `ANY`]\n     */\n    mode: ERaycastMode;\n\n    /**\n     * @en\n     * The maximum distance of the raycast, `Infinity` by default.\n     * @zh\n     * 射线检测的最大距离，默认为`Infinity`。\n     */\n    distance: number;\n\n    /**\n     * @en\n     * An array used to store the results of a ray detection.\n     * @zh\n     * 用于存储射线检测结果的数组。\n     */\n    result?: IRaySubMeshResult[];\n\n    /**\n     * @en\n     * Whether to detect the double-sided or not，`false` by default.\n     * @zh\n     * 是否检测双面，默认为`false`。\n     */\n    doubleSided?: boolean;\n}\n\n/**\n * @en\n * The optional param structure of the `rayMesh`.\n * @zh\n * `rayMesh`的可选参数结构。\n */\nexport interface IRayMeshOptions extends IRaySubMeshOptions {\n\n    /**\n     * @en\n     * The index of the sub mesh.\n     * @zh\n     * 子网格的索引。\n     */\n    subIndices?: number[];\n}\n\n/**\n * @en\n * The optional param structure of the `rayModel`.\n * @zh\n * `rayModel`的可选参数结构。\n */\nexport type IRayModelOptions = IRayMeshOptions\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3 } from '../math';\nimport enums from './enums';\n\n/**\n * @en\n * Basic Geometry: Triangle.\n * @zh\n * 基础几何 三角形。\n */\n\nexport class Triangle {\n    /**\n     * @en\n     * create a new triangle\n     * @zh\n     * 创建一个新的 triangle。\n     * @param {number} ax @en x component of point a @zh a 点的 x 部分。\n     * @param {number} ay @en y component of point a @zh a 点的 y 部分。\n     * @param {number} az @en z component of point a @zh a 点的 z 部分。\n     * @param {number} bx @en x component of point b @zh b 点的 x 部分。\n     * @param {number} by @en y component of point b @zh b 点的 y 部分。\n     * @param {number} bz @en z component of point b @zh b 点的 z 部分。\n     * @param {number} cx @en x component of point c @zh c 点的 x 部分。\n     * @param {number} cy @en y component of point c @zh c 点的 y 部分。\n     * @param {number} cz @en z component of point c @zh c 点的 z 部分。\n     * @return {Triangle} @en A new triangle. @zh 一个新的 triangle。\n     */\n    public static create (ax = 1, ay = 0, az = 0,\n        bx = 0, by = 0, bz = 0,\n        cx = 0, cy = 0, cz = 1): Triangle {\n        return new Triangle(ax, ay, az, bx, by, bz, cx, cy, cz);\n    }\n\n    /**\n     * @en\n     * clone a new triangle\n     * @zh\n     * 克隆一个新的 triangle。\n     * @param {Triangle} @en Triangle object to be cloned from. @zh t 克隆的目标。\n     * @return {Triangle} @en A new cloned Triangle object. @zh 克隆出的新对象。\n     */\n    public static clone (t: Triangle): Triangle {\n        return new Triangle(\n            t.a.x, t.a.y, t.a.z,\n            t.b.x, t.b.y, t.b.z,\n            t.c.x, t.c.y, t.c.z,\n        );\n    }\n\n    /**\n     * @en\n     * copy the values from one triangle to another\n     * @zh\n     * 将一个 triangle 的值复制到另一个 triangle。\n     * @param {Triangle} out @en Target Triangle object to be copied to. @zh 接受操作的 triangle。\n     * @param {Triangle} t @en A Triangle object to be copied from. @zh 被复制的 triangle。\n     * @return {Triangle}  @en The same as out. @zh out 接受操作的 triangle。\n     */\n    public static copy (out: Triangle, t: Triangle): Triangle {\n        Vec3.copy(out.a, t.a);\n        Vec3.copy(out.b, t.b);\n        Vec3.copy(out.c, t.c);\n\n        return out;\n    }\n\n    /**\n     * @en\n     * Create a triangle from three points\n     * @zh\n     * 用三个点创建一个 triangle。\n     * @param {Triangle} out @en The Triangle object to be modified. @zh 接受操作的 triangle。\n     * @param {Vec3} a @en The point value to set out.a. @zh a 点。\n     * @param {Vec3} b @en The point value to set out.b. @zh b 点。\n     * @param {Vec3} c @en The point value to set out.c. @zh c 点。\n     * @return {Triangle} @en The same as out. @zh 接受操作的 triangle。\n     */\n    public static fromPoints (out: Triangle, a: Vec3, b: Vec3, c: Vec3): Triangle {\n        Vec3.copy(out.a, a);\n        Vec3.copy(out.b, b);\n        Vec3.copy(out.c, c);\n        return out;\n    }\n\n    /**\n     * @en\n     * Set the components of a triangle to the given values\n     * @zh\n     * 将给定三角形的属性设置为给定值。\n     * @param {Triangle} out @en The Triangle object to be set. @zh 被修改的三角形。\n     * @param {number} ax @en The value to set out.a.x. @zh a 点的 x 部分。\n     * @param {number} ay @en The value to set out.a.y. @zh a 点的 y 部分。\n     * @param {number} az @en The value to set out.a.z. @zh a 点的 z 部分。\n     * @param {number} bx @en The value to set out.b.x. @zh b 点的 x 部分。\n     * @param {number} by @en The value to set out.b.y. @zh b 点的 y 部分。\n     * @param {number} bz @en The value to set out.b.z. @zh b 点的 z 部分。\n     * @param {number} cx @en The value to set out.c.x. @zh c 点的 x 部分。\n     * @param {number} cy @en The value to set out.c.y. @zh c 点的 y 部分。\n     * @param {number} cz @en The value to set out.c.z. @zh c 点的 z 部分。\n     * @return {Triangle} @en The same as out. @zh 传入的 out 对象。\n     * @function\n     */\n    public static set (out: Triangle,\n        ax: number, ay: number, az: number,\n        bx: number, by: number, bz: number,\n        cx: number, cy: number, cz: number): Triangle {\n        out.a.x = ax;\n        out.a.y = ay;\n        out.a.z = az;\n\n        out.b.x = bx;\n        out.b.y = by;\n        out.b.z = bz;\n\n        out.c.x = cx;\n        out.c.y = cy;\n        out.c.z = cz;\n\n        return out;\n    }\n\n    /**\n     * @en\n     * Point a.\n     * @zh\n     * 点 a。\n     */\n    public a: Vec3;\n\n    /**\n     * @en\n     * Point b.\n     * @zh\n     * 点 b。\n     */\n    public b: Vec3;\n\n    /**\n     * @en\n     * Point c.\n     * @zh\n     * 点 c。\n     */\n    public c: Vec3;\n\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    protected readonly _type: number;\n\n    /**\n     * @en\n     * Construct a triangle.\n     * @zh\n     * 构造一个三角形。\n     * @param {number} ax @en x component of point a. @zh a 点的 x 部分。\n     * @param {number} ay @en y component of point a. @zh a 点的 y 部分。\n     * @param {number} az @en z component of point a. @zh a 点的 z 部分。\n     * @param {number} bx @en x component of point b. @zh b 点的 x 部分。\n     * @param {number} by @en y component of point b. @zh b 点的 y 部分。\n     * @param {number} bz @en z component of point b. @zh b 点的 z 部分。\n     * @param {number} cx @en x component of point c. @zh c 点的 x 部分。\n     * @param {number} cy @en y component of point c. @zh c 点的 y 部分。\n     * @param {number} cz @en z component of point c. @zh c 点的 z 部分。\n     */\n    constructor (ax = 0, ay = 0, az = 0,\n        bx = 1, by = 0, bz = 0,\n        cx = 0, cy = 1, cz = 0) {\n        this._type = enums.SHAPE_TRIANGLE;\n        this.a = new Vec3(ax, ay, az);\n        this.b = new Vec3(bx, by, bz);\n        this.c = new Vec3(cx, cy, cz);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EPSILON, Mat3, Vec3, Mat4 } from '../math';\nimport { AABB } from './aabb';\nimport { Capsule } from './capsule';\nimport * as distance from './distance';\nimport enums from './enums';\nimport { Frustum } from './frustum';\nimport { Line } from './line';\nimport { OBB } from './obb';\nimport { Plane } from './plane';\nimport { Ray } from './ray';\nimport { Sphere } from './sphere';\nimport { Triangle } from './triangle';\nimport { PrimitiveMode } from '../gfx';\nimport { Mesh } from '../../3d/assets/mesh';\nimport { IBArray, RenderingSubMesh } from '../assets/rendering-sub-mesh';\nimport { IRaySubMeshOptions, ERaycastMode, IRaySubMeshResult, IRayMeshOptions, IRayModelOptions } from './spec';\nimport { IVec3Like } from '../math/type-define';\nimport { scene } from '../renderer';\n\n/**\n * @en\n * ray-plane intersect detect.\n * @zh\n * 射线与平面的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param plane @zh 平面 @en The plane to test\n * @return @zh 0 或 非0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayPlane = (function () {\n    const pt = new Vec3(0, 0, 0);\n\n    return function (ray: Ray, plane: Plane): number {\n        const denom = Vec3.dot(ray.d, plane.n);\n        if (Math.abs(denom) < Number.EPSILON) { return 0; }\n        Vec3.multiplyScalar(pt, plane.n, plane.d);\n        const t = Vec3.dot(Vec3.subtract(pt, pt, ray.o), plane.n) / denom;\n        if (t < 0) { return 0; }\n        return t;\n    };\n}());\n\n// based on http://fileadmin.cs.lth.se/cs/Personal/Tomas_Akenine-Moller/raytri/\n/**\n * @en\n * ray-triangle intersect detect.\n * @zh\n * 射线与三角形的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param triangle @zh 三角形 @en The triangle to test\n * @param doubleSided @zh 三角形是否为双面 @en Indicates whether it is double sided\n * @return @zh 0 或 非0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayTriangle = (function () {\n    const ab = new Vec3(0, 0, 0);\n    const ac = new Vec3(0, 0, 0);\n    const pvec = new Vec3(0, 0, 0);\n    const tvec = new Vec3(0, 0, 0);\n    const qvec = new Vec3(0, 0, 0);\n\n    return function (ray: Ray, triangle: Triangle, doubleSided?: boolean) {\n        Vec3.subtract(ab, triangle.b, triangle.a);\n        Vec3.subtract(ac, triangle.c, triangle.a);\n\n        Vec3.cross(pvec, ray.d, ac);\n        const det = Vec3.dot(ab, pvec);\n        if (det < Number.EPSILON && (!doubleSided || det > -Number.EPSILON)) { return 0; }\n\n        const inv_det = 1 / det;\n\n        Vec3.subtract(tvec, ray.o, triangle.a);\n        const u = Vec3.dot(tvec, pvec) * inv_det;\n        if (u < 0 || u > 1) { return 0; }\n\n        Vec3.cross(qvec, tvec, ab);\n        const v = Vec3.dot(ray.d, qvec) * inv_det;\n        if (v < 0 || u + v > 1) { return 0; }\n\n        const t = Vec3.dot(ac, qvec) * inv_det;\n        return t < 0 ? 0 : t;\n    };\n}());\n\n/**\n * @en\n * ray-sphere intersect detect.\n * @zh\n * 射线和球的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param sphere @zh 球 @en The sphere to test\n * @return @zh 0 或 非0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst raySphere = (function () {\n    const e = new Vec3(0, 0, 0);\n    return function (ray: Ray, sphere: Sphere): number {\n        const r = sphere.radius;\n        const c = sphere.center;\n        const o = ray.o;\n        const d = ray.d;\n        const rSq = r * r;\n        Vec3.subtract(e, c, o);\n        const eSq = e.lengthSqr();\n\n        const aLength = Vec3.dot(e, d); // assume ray direction already normalized\n        const fSq = rSq - (eSq - aLength * aLength);\n        if (fSq < 0) { return 0; }\n\n        const f = Math.sqrt(fSq);\n        const t = eSq < rSq ? aLength + f : aLength - f;\n        if (t < 0) { return 0; }\n        return t;\n    };\n}());\n\n/**\n * @en\n * ray-aabb intersect detect.\n * @zh\n * 射线和轴对齐包围盒的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @return @zh 0 或 非0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayAABB = (function () {\n    const min = new Vec3();\n    const max = new Vec3();\n    return function (ray: Ray, aabb: AABB): number {\n        Vec3.subtract(min, aabb.center, aabb.halfExtents);\n        Vec3.add(max, aabb.center, aabb.halfExtents);\n        return rayAABB2(ray, min, max);\n    };\n}());\n\nfunction rayAABB2 (ray: Ray, min: IVec3Like, max: IVec3Like) {\n    const o = ray.o; const d = ray.d;\n    const ix = 1 / d.x; const iy = 1 / d.y; const iz = 1 / d.z;\n    const t1 = (min.x - o.x) * ix;\n    const t2 = (max.x - o.x) * ix;\n    const t3 = (min.y - o.y) * iy;\n    const t4 = (max.y - o.y) * iy;\n    const t5 = (min.z - o.z) * iz;\n    const t6 = (max.z - o.z) * iz;\n    const tmin = Math.max(Math.max(Math.min(t1, t2), Math.min(t3, t4)), Math.min(t5, t6));\n    const tmax = Math.min(Math.min(Math.max(t1, t2), Math.max(t3, t4)), Math.max(t5, t6));\n    if (tmax < 0 || tmin > tmax) { return 0; }\n    return tmin > 0 ? tmin : tmax; // ray origin inside aabb\n}\n\n/**\n * @en\n * ray-obb intersect detect.\n * @zh\n * 射线和方向包围盒的相交性检测。\n * @param ray @zh 射线 @en The ray\n * @param obb @zh 方向包围盒 @en The obb to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayOBB = (function () {\n    let center = new Vec3();\n    let o = new Vec3();\n    let d = new Vec3();\n    const X = new Vec3();\n    const Y = new Vec3();\n    const Z = new Vec3();\n    const p = new Vec3();\n    const size = new Array<number>(3);\n    const f = new Array<number>(3);\n    const e = new Array<number>(3);\n    const t = new Array<number>(6);\n\n    return function (ray: Ray, obb: OBB): number {\n        size[0] = obb.halfExtents.x;\n        size[1] = obb.halfExtents.y;\n        size[2] = obb.halfExtents.z;\n        center = obb.center;\n        o = ray.o;\n        d = ray.d;\n\n        Vec3.set(X, obb.orientation.m00, obb.orientation.m01, obb.orientation.m02);\n        Vec3.set(Y, obb.orientation.m03, obb.orientation.m04, obb.orientation.m05);\n        Vec3.set(Z, obb.orientation.m06, obb.orientation.m07, obb.orientation.m08);\n        Vec3.subtract(p, center, o);\n\n        // The cos values of the ray on the X, Y, Z\n        f[0] = Vec3.dot(X, d);\n        f[1] = Vec3.dot(Y, d);\n        f[2] = Vec3.dot(Z, d);\n\n        // The projection length of P on X, Y, Z\n        e[0] = Vec3.dot(X, p);\n        e[1] = Vec3.dot(Y, p);\n        e[2] = Vec3.dot(Z, p);\n\n        for (let i = 0; i < 3; ++i) {\n            if (f[i] === 0) {\n                if (-e[i] - size[i] > 0 || -e[i] + size[i] < 0) {\n                    return 0;\n                }\n                // Avoid div by 0!\n                f[i] = 0.0000001;\n            }\n            // min\n            t[i * 2 + 0] = (e[i] + size[i]) / f[i];\n            // max\n            t[i * 2 + 1] = (e[i] - size[i]) / f[i];\n        }\n        const tmin = Math.max(\n            Math.max(\n                Math.min(t[0], t[1]),\n                Math.min(t[2], t[3]),\n            ),\n            Math.min(t[4], t[5]),\n        );\n        const tmax = Math.min(\n            Math.min(\n                Math.max(t[0], t[1]),\n                Math.max(t[2], t[3]),\n            ),\n            Math.max(t[4], t[5]),\n        );\n        if (tmax < 0 || tmin > tmax) {\n            return 0;\n        }\n\n        return tmin > 0 ? tmin : tmax; // ray origin inside aabb\n    };\n}());\n\n/**\n * @en\n * ray-capsule intersect detect.\n * @zh\n * 射线和胶囊体的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param capsule @zh 胶囊体 @en The capsule to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayCapsule = (function () {\n    const v3_0 = new Vec3();\n    const v3_1 = new Vec3();\n    const v3_2 = new Vec3();\n    const v3_3 = new Vec3();\n    const v3_4 = new Vec3();\n    const v3_5 = new Vec3();\n    const v3_6 = new Vec3();\n    const sphere_0 = new Sphere();\n    return function (ray: Ray, capsule: Capsule) {\n        const radiusSqr = capsule.radius * capsule.radius;\n        const vRayNorm = Vec3.normalize(v3_0, ray.d);\n        const A = capsule.ellipseCenter0;\n        const B = capsule.ellipseCenter1;\n        const BA = Vec3.subtract(v3_1, B, A);\n        if (BA.equals(Vec3.ZERO)) {\n            sphere_0.radius = capsule.radius;\n            sphere_0.center.set(capsule.ellipseCenter0);\n            return intersect.raySphere(ray, sphere_0);\n        }\n\n        const O = ray.o;\n        const OA = Vec3.subtract(v3_2, O, A);\n        const VxBA = Vec3.cross(v3_3, vRayNorm, BA);\n        const a = VxBA.lengthSqr();\n        if (a === 0) {\n            sphere_0.radius = capsule.radius;\n            const BO = Vec3.subtract(v3_4, B, O);\n            if (OA.lengthSqr() < BO.lengthSqr()) {\n                sphere_0.center.set(capsule.ellipseCenter0);\n            } else {\n                sphere_0.center.set(capsule.ellipseCenter1);\n            }\n            return intersect.raySphere(ray, sphere_0);\n        }\n\n        const OAxBA = Vec3.cross(v3_4, OA, BA);\n        const ab2 = BA.lengthSqr();\n        const b = 2 * Vec3.dot(VxBA, OAxBA);\n        const c = OAxBA.lengthSqr() - (radiusSqr * ab2);\n        const d = b * b - 4 * a * c;\n\n        if (d < 0) { return 0; }\n\n        const t = (-b - Math.sqrt(d)) / (2 * a);\n        if (t < 0) {\n            sphere_0.radius = capsule.radius;\n            const BO = Vec3.subtract(v3_5, B, O);\n            if (OA.lengthSqr() < BO.lengthSqr()) {\n                sphere_0.center.set(capsule.ellipseCenter0);\n            } else {\n                sphere_0.center.set(capsule.ellipseCenter1);\n            }\n            return intersect.raySphere(ray, sphere_0);\n        } else {\n            // Limit intersection between the bounds of the cylinder's end caps.\n            const iPos = Vec3.scaleAndAdd(v3_5, ray.o, vRayNorm, t);\n            const iPosLen = Vec3.subtract(v3_6, iPos, A);\n            const tLimit = Vec3.dot(iPosLen, BA) / ab2;\n\n            if (tLimit >= 0 && tLimit <= 1) {\n                return t;\n            } else if (tLimit < 0) {\n                sphere_0.radius = capsule.radius;\n                sphere_0.center.set(capsule.ellipseCenter0);\n                return intersect.raySphere(ray, sphere_0);\n            } else if (tLimit > 1) {\n                sphere_0.radius = capsule.radius;\n                sphere_0.center.set(capsule.ellipseCenter1);\n                return intersect.raySphere(ray, sphere_0);\n            } else {\n                return 0;\n            }\n        }\n    };\n}());\n\n/**\n * @en\n * ray-subMesh intersect detect, in model space.\n * @zh\n * 在模型空间中，射线和子三角网格的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param subMesh @zh 子网格 @en The sub mesh to test\n * @param options @zh 额外选项 @en Optional params\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst raySubMesh = (function () {\n    const tri = Triangle.create();\n    const deOpt: IRaySubMeshOptions = { distance: Infinity, doubleSided: false, mode: ERaycastMode.ANY };\n    let minDis = 0;\n\n    const fillResult = (m: ERaycastMode, d: number, i0: number, i1: number, i2: number, r?: IRaySubMeshResult[]) => {\n        if (m === ERaycastMode.CLOSEST) {\n            if (minDis > d || minDis === 0) {\n                minDis = d;\n                if (r) {\n                    if (r.length === 0) {\n                        r.push({ distance: d, vertexIndex0: i0 / 3, vertexIndex1: i1 / 3, vertexIndex2: i2 / 3 });\n                    } else {\n                        r[0].distance = d; r[0].vertexIndex0 = i0 / 3; r[0].vertexIndex1 = i1 / 3; r[0].vertexIndex2 = i2 / 3;\n                    }\n                }\n            }\n        } else {\n            minDis = d;\n            if (r) r.push({ distance: d, vertexIndex0: i0 / 3, vertexIndex1: i1 / 3, vertexIndex2: i2 / 3 });\n        }\n    };\n\n    const narrowphase = (vb: Float32Array, ib: IBArray, pm: PrimitiveMode, ray: Ray, opt: IRaySubMeshOptions) => {\n        if (pm === PrimitiveMode.TRIANGLE_LIST) {\n            const cnt = ib.length;\n            for (let j = 0; j < cnt; j += 3) {\n                const i0 = ib[j] * 3;\n                const i1 = ib[j + 1] * 3;\n                const i2 = ib[j + 2] * 3;\n                Vec3.set(tri.a, vb[i0], vb[i0 + 1], vb[i0 + 2]);\n                Vec3.set(tri.b, vb[i1], vb[i1 + 1], vb[i1 + 2]);\n                Vec3.set(tri.c, vb[i2], vb[i2 + 1], vb[i2 + 2]);\n                const dist = intersect.rayTriangle(ray, tri, opt.doubleSided);\n                if (dist === 0 || dist > opt.distance) continue;\n                fillResult(opt.mode, dist, i0, i1, i2, opt.result);\n                if (opt.mode === ERaycastMode.ANY) return dist;\n            }\n        } else if (pm === PrimitiveMode.TRIANGLE_STRIP) {\n            const cnt = ib.length - 2;\n            let rev = 0;\n            for (let j = 0; j < cnt; j += 1) {\n                const i0 = ib[j - rev] * 3;\n                const i1 = ib[j + rev + 1] * 3;\n                const i2 = ib[j + 2] * 3;\n                Vec3.set(tri.a, vb[i0], vb[i0 + 1], vb[i0 + 2]);\n                Vec3.set(tri.b, vb[i1], vb[i1 + 1], vb[i1 + 2]);\n                Vec3.set(tri.c, vb[i2], vb[i2 + 1], vb[i2 + 2]);\n                rev = ~rev;\n                const dist = intersect.rayTriangle(ray, tri, opt.doubleSided);\n                if (dist === 0 || dist > opt.distance) continue;\n                fillResult(opt.mode, dist, i0, i1, i2, opt.result);\n                if (opt.mode === ERaycastMode.ANY) return dist;\n            }\n        } else if (pm === PrimitiveMode.TRIANGLE_FAN) {\n            const cnt = ib.length - 1;\n            const i0 = ib[0] * 3;\n            Vec3.set(tri.a, vb[i0], vb[i0 + 1], vb[i0 + 2]);\n            for (let j = 1; j < cnt; j += 1) {\n                const i1 = ib[j] * 3;\n                const i2 = ib[j + 1] * 3;\n                Vec3.set(tri.b, vb[i1], vb[i1 + 1], vb[i1 + 2]);\n                Vec3.set(tri.c, vb[i2], vb[i2 + 1], vb[i2 + 2]);\n                const dist = intersect.rayTriangle(ray, tri, opt.doubleSided);\n                if (dist === 0 || dist > opt.distance) continue;\n                fillResult(opt.mode, dist, i0, i1, i2, opt.result);\n                if (opt.mode === ERaycastMode.ANY) return dist;\n            }\n        }\n        return minDis;\n    };\n    return function (ray: Ray, submesh: RenderingSubMesh, options?: IRaySubMeshOptions) {\n        minDis = 0;\n        if (submesh.geometricInfo.positions.length === 0) return minDis;\n        const opt = options === undefined ? deOpt : options;\n        const min = submesh.geometricInfo.boundingBox.min;\n        const max = submesh.geometricInfo.boundingBox.max;\n        if (rayAABB2(ray, min, max)) {\n            const pm = submesh.primitiveMode;\n            const { positions: vb, indices: ib } = submesh.geometricInfo;\n            narrowphase(vb, ib!, pm, ray, opt);\n        }\n        return minDis;\n    };\n}());\n\n/**\n * @en\n * ray-mesh intersect detect, in model space.\n * @zh\n * 在模型空间中，射线和三角网格资源的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param mesh @zh 网格 @en The mesh to test\n * @param options @zh 可选参数 @en Optional param\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayMesh = (function () {\n    let minDis = 0;\n    const deOpt: IRayMeshOptions = { distance: Infinity, doubleSided: false, mode: ERaycastMode.ANY };\n    return function (ray: Ray, mesh: Mesh, options?: IRayMeshOptions) {\n        minDis = 0;\n        const opt = options === undefined ? deOpt : options;\n        const length = mesh.renderingSubMeshes.length;\n        const min = mesh.struct.minPosition;\n        const max = mesh.struct.maxPosition;\n        if (min && max && !rayAABB2(ray, min, max)) return minDis;\n        for (let i = 0; i < length; i++) {\n            const sm = mesh.renderingSubMeshes[i];\n            const dis = raySubMesh(ray, sm, opt);\n            if (dis) {\n                if (opt.mode === ERaycastMode.CLOSEST) {\n                    if (minDis === 0 || minDis > dis) {\n                        minDis = dis;\n                        if (opt.subIndices) opt.subIndices[0] = i;\n                    }\n                } else {\n                    minDis = dis;\n                    if (opt.subIndices) opt.subIndices.push(i);\n                    if (opt.mode === ERaycastMode.ANY) {\n                        return dis;\n                    }\n                }\n            }\n        }\n        if (minDis && opt.mode === ERaycastMode.CLOSEST) {\n            if (opt.result) {\n                opt.result[0].distance = minDis;\n                opt.result.length = 1;\n            }\n            if (opt.subIndices) opt.subIndices.length = 1;\n        }\n        return minDis;\n    };\n}());\n\n/**\n * @en\n * ray-model intersect detect, in world space.\n * @zh\n * 在世界空间中，射线和渲染模型的相交性检测。\n * @param ray @zh 射线 @en The ray to test\n * @param model @zh model @en The model to test\n * @param options @zh 可选参数 @en Optional param\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst rayModel = (function () {\n    let minDis = 0;\n    const deOpt: IRayModelOptions = { distance: Infinity, doubleSided: false, mode: ERaycastMode.ANY };\n    const modelRay = new Ray();\n    const m4 = new Mat4();\n    return function (r: Ray, model: scene.Model, options?: IRayModelOptions) {\n        minDis = 0;\n        const opt = options === undefined ? deOpt : options;\n        const wb = model.worldBounds;\n        if (wb && !rayAABB(r, wb)) return minDis;\n        Ray.copy(modelRay, r);\n        if (model.node) {\n            Mat4.invert(m4, model.node.getWorldMatrix(m4));\n            Vec3.transformMat4(modelRay.o, r.o, m4);\n            Vec3.transformMat4Normal(modelRay.d, r.d, m4);\n        }\n        const subModels = model.subModels;\n        for (let i = 0; i < subModels.length; i++) {\n            const subMesh = subModels[i].subMesh;\n            const dis = raySubMesh(modelRay, subMesh, opt);\n            if (dis) {\n                if (opt.mode === ERaycastMode.CLOSEST) {\n                    if (minDis === 0 || minDis > dis) {\n                        minDis = dis;\n                        if (opt.subIndices) opt.subIndices[0] = i;\n                    }\n                } else {\n                    minDis = dis;\n                    if (opt.subIndices) opt.subIndices.push(i);\n                    if (opt.mode === ERaycastMode.ANY) {\n                        return dis;\n                    }\n                }\n            }\n        }\n        if (minDis && opt.mode === ERaycastMode.CLOSEST) {\n            if (opt.result) {\n                opt.result[0].distance = minDis;\n                opt.result.length = 1;\n            }\n            if (opt.subIndices) opt.subIndices.length = 1;\n        }\n        return minDis;\n    };\n}());\n\n/**\n * @en\n * line-plane intersect detect.\n * @zh\n * 线段与平面的相交性检测。\n * @param line @zh 线段 @en The line to test\n * @param plane @zh 平面 @en The plane to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst linePlane = (function () {\n    const ab = new Vec3(0, 0, 0);\n\n    return function (line: Line, plane: Plane): number {\n        Vec3.subtract(ab, line.e, line.s);\n        const t = (plane.d - Vec3.dot(line.s, plane.n)) / Vec3.dot(ab, plane.n);\n        if (t < 0 || t > 1) { return 0; }\n        return t;\n    };\n}());\n\n/**\n * @en\n * line-triangle intersect detect.\n * @zh\n * 线段与三角形的相交性检测。\n * @param line @zh 线段 @en The line to test\n * @param triangle @zh 三角形 @en The triangle to test\n * @param outPt @zh 可选，相交点 @en Optional out param, indicates the intersection point\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst lineTriangle = (function () {\n    const ab = new Vec3(0, 0, 0);\n    const ac = new Vec3(0, 0, 0);\n    const qp = new Vec3(0, 0, 0);\n    const ap = new Vec3(0, 0, 0);\n    const n = new Vec3(0, 0, 0);\n    const e = new Vec3(0, 0, 0);\n\n    return function (line: Line, triangle: Triangle, outPt?: Vec3): number {\n        Vec3.subtract(ab, triangle.b, triangle.a);\n        Vec3.subtract(ac, triangle.c, triangle.a);\n        Vec3.subtract(qp, line.s, line.e);\n\n        Vec3.cross(n, ab, ac);\n        const det = Vec3.dot(qp, n);\n\n        if (det <= 0.0) {\n            return 0;\n        }\n\n        Vec3.subtract(ap, line.s, triangle.a);\n        const t = Vec3.dot(ap, n);\n        if (t < 0 || t > det) {\n            return 0;\n        }\n\n        Vec3.cross(e, qp, ap);\n        let v = Vec3.dot(ac, e);\n        if (v < 0 || v > det) {\n            return 0;\n        }\n\n        let w = -Vec3.dot(ab, e);\n        if (w < 0.0 || v + w > det) {\n            return 0;\n        }\n\n        if (outPt) {\n            const invDet = 1.0 / det;\n            v *= invDet;\n            w *= invDet;\n            const u = 1.0 - v - w;\n\n            // outPt = u*a + v*d + w*c;\n            Vec3.set(outPt,\n                triangle.a.x * u + triangle.b.x * v + triangle.c.x * w,\n                triangle.a.y * u + triangle.b.y * v + triangle.c.y * w,\n                triangle.a.z * u + triangle.b.z * v + triangle.c.z * w);\n        }\n\n        return 1;\n    };\n}());\n\nconst r_t = new Ray();\n/**\n * @en\n * line-aabb intersect detect.\n * @zh\n * 线段与轴对齐包围盒的相交性检测\n * @param line @zh 线段 @en The line to test\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nfunction lineAABB (line: Line, aabb: AABB): number {\n    r_t.o.set(line.s);\n    Vec3.subtract(r_t.d, line.e, line.s);\n    r_t.d.normalize();\n    const min = rayAABB(r_t, aabb);\n    const len = line.length();\n    if (min <= len) {\n        return min;\n    } else {\n        return 0;\n    }\n}\n\n/**\n * @en\n * line-obb intersect detect.\n * @zh\n * 线段与方向包围盒的相交性检测\n * @param line @zh 线段 @en The line to test\n * @param obb @zh 方向包围盒 @en The obb\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nfunction lineOBB (line: Line, obb: OBB): number {\n    r_t.o.set(line.s);\n    Vec3.subtract(r_t.d, line.e, line.s);\n    r_t.d.normalize();\n    const min = rayOBB(r_t, obb);\n    const len = line.length();\n    if (min <= len) {\n        return min;\n    } else {\n        return 0;\n    }\n}\n\n/**\n * @en\n * line-sphere intersect detect.\n * @zh\n * 线段与球的相交性检测\n * @param line @zh 线段 @en The line to test\n * @param sphere @zh 球 @en The sphere to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nfunction lineSphere (line: Line, sphere: Sphere): number {\n    r_t.o.set(line.s);\n    Vec3.subtract(r_t.d, line.e, line.s);\n    r_t.d.normalize();\n    const min = raySphere(r_t, sphere);\n    const len = line.length();\n    if (min <= len) {\n        return min;\n    } else {\n        return 0;\n    }\n}\n\n/**\n * @en\n * aabb-aabb intersect detect.\n * @zh\n * 轴对齐包围盒和轴对齐包围盒的相交性检测。\n * @param aabb1 @zh 轴对齐包围盒1 @en aabb 1 to test\n * @param aabb2 @zh 轴对齐包围盒2 @en aabb 2 to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst aabbWithAABB = (function () {\n    const aMin = new Vec3();\n    const aMax = new Vec3();\n    const bMin = new Vec3();\n    const bMax = new Vec3();\n    return function (aabb1: AABB, aabb2: AABB) {\n        Vec3.subtract(aMin, aabb1.center, aabb1.halfExtents);\n        Vec3.add(aMax, aabb1.center, aabb1.halfExtents);\n        Vec3.subtract(bMin, aabb2.center, aabb2.halfExtents);\n        Vec3.add(bMax, aabb2.center, aabb2.halfExtents);\n        return (aMin.x <= bMax.x && aMax.x >= bMin.x)\n            && (aMin.y <= bMax.y && aMax.y >= bMin.y)\n            && (aMin.z <= bMax.z && aMax.z >= bMin.z);\n    };\n}());\n\nfunction getAABBVertices (min: Vec3, max: Vec3, out: Vec3[]) {\n    Vec3.set(out[0], min.x, max.y, max.z);\n    Vec3.set(out[1], min.x, max.y, min.z);\n    Vec3.set(out[2], min.x, min.y, max.z);\n    Vec3.set(out[3], min.x, min.y, min.z);\n    Vec3.set(out[4], max.x, max.y, max.z);\n    Vec3.set(out[5], max.x, max.y, min.z);\n    Vec3.set(out[6], max.x, min.y, max.z);\n    Vec3.set(out[7], max.x, min.y, min.z);\n}\n\nfunction getOBBVertices (c: Vec3, e: Vec3, a1: Vec3, a2: Vec3, a3: Vec3, out: Vec3[]) {\n    Vec3.set(out[0],\n        c.x + a1.x * e.x + a2.x * e.y + a3.x * e.z,\n        c.y + a1.y * e.x + a2.y * e.y + a3.y * e.z,\n        c.z + a1.z * e.x + a2.z * e.y + a3.z * e.z);\n    Vec3.set(out[1],\n        c.x - a1.x * e.x + a2.x * e.y + a3.x * e.z,\n        c.y - a1.y * e.x + a2.y * e.y + a3.y * e.z,\n        c.z - a1.z * e.x + a2.z * e.y + a3.z * e.z);\n    Vec3.set(out[2],\n        c.x + a1.x * e.x - a2.x * e.y + a3.x * e.z,\n        c.y + a1.y * e.x - a2.y * e.y + a3.y * e.z,\n        c.z + a1.z * e.x - a2.z * e.y + a3.z * e.z);\n    Vec3.set(out[3],\n        c.x + a1.x * e.x + a2.x * e.y - a3.x * e.z,\n        c.y + a1.y * e.x + a2.y * e.y - a3.y * e.z,\n        c.z + a1.z * e.x + a2.z * e.y - a3.z * e.z);\n    Vec3.set(out[4],\n        c.x - a1.x * e.x - a2.x * e.y - a3.x * e.z,\n        c.y - a1.y * e.x - a2.y * e.y - a3.y * e.z,\n        c.z - a1.z * e.x - a2.z * e.y - a3.z * e.z);\n    Vec3.set(out[5],\n        c.x + a1.x * e.x - a2.x * e.y - a3.x * e.z,\n        c.y + a1.y * e.x - a2.y * e.y - a3.y * e.z,\n        c.z + a1.z * e.x - a2.z * e.y - a3.z * e.z);\n    Vec3.set(out[6],\n        c.x - a1.x * e.x + a2.x * e.y - a3.x * e.z,\n        c.y - a1.y * e.x + a2.y * e.y - a3.y * e.z,\n        c.z - a1.z * e.x + a2.z * e.y - a3.z * e.z);\n    Vec3.set(out[7],\n        c.x - a1.x * e.x - a2.x * e.y + a3.x * e.z,\n        c.y - a1.y * e.x - a2.y * e.y + a3.y * e.z,\n        c.z - a1.z * e.x - a2.z * e.y + a3.z * e.z);\n}\n\nfunction getInterval (vertices: any[] | Vec3[], axis: Vec3) {\n    let min = Vec3.dot(axis, vertices[0]); let max = min;\n    for (let i = 1; i < 8; ++i) {\n        const projection = Vec3.dot(axis, vertices[i]);\n        min = (projection < min) ? projection : min;\n        max = (projection > max) ? projection : max;\n    }\n    return [min, max];\n}\n\n/**\n * @en\n * aabb-obb intersect detect.\n * @zh\n * 轴对齐包围盒和方向包围盒的相交性检测。\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @param obb @zh 方向包围盒 @en The obb to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst aabbWithOBB = (function () {\n    const test = new Array(15);\n    for (let i = 0; i < 15; i++) {\n        test[i] = new Vec3(0, 0, 0);\n    }\n    const vertices = new Array(8);\n    const vertices2 = new Array(8);\n    for (let i = 0; i < 8; i++) {\n        vertices[i] = new Vec3(0, 0, 0);\n        vertices2[i] = new Vec3(0, 0, 0);\n    }\n    const min = new Vec3();\n    const max = new Vec3();\n    return function (aabb: AABB, obb: OBB): number {\n        Vec3.set(test[0], 1, 0, 0);\n        Vec3.set(test[1], 0, 1, 0);\n        Vec3.set(test[2], 0, 0, 1);\n        Vec3.set(test[3], obb.orientation.m00, obb.orientation.m01, obb.orientation.m02);\n        Vec3.set(test[4], obb.orientation.m03, obb.orientation.m04, obb.orientation.m05);\n        Vec3.set(test[5], obb.orientation.m06, obb.orientation.m07, obb.orientation.m08);\n\n        for (let i = 0; i < 3; ++i) { // Fill out rest of axis\n            Vec3.cross(test[6 + i * 3 + 0], test[i], test[3]);\n            Vec3.cross(test[6 + i * 3 + 1], test[i], test[4]);\n            Vec3.cross(test[6 + i * 3 + 1], test[i], test[5]);\n        }\n\n        Vec3.subtract(min, aabb.center, aabb.halfExtents);\n        Vec3.add(max, aabb.center, aabb.halfExtents);\n        getAABBVertices(min, max, vertices);\n        getOBBVertices(obb.center, obb.halfExtents, test[3], test[4], test[5], vertices2);\n\n        for (let j = 0; j < 15; ++j) {\n            const a = getInterval(vertices, test[j]);\n            const b = getInterval(vertices2, test[j]);\n            if (b[0] > a[1] || a[0] > b[1]) {\n                return 0; // Seperating axis found\n            }\n        }\n\n        return 1;\n    };\n}());\n\n/**\n * @en\n * aabb-plane intersect detect.\n * @zh\n * 轴对齐包围盒和平面的相交性检测。\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @param plane @zh 平面 @en The plane to test\n * @return @zh 检测结果, 包含为 -1, 不包含为 0, 相交为 1 @en Test result, inside(back) = -1, outside(front) = 0, intersect = 1\n */\nconst aabbPlane = function (aabb: AABB, plane: Plane): number {\n    const r = aabb.halfExtents.x * Math.abs(plane.n.x)\n        + aabb.halfExtents.y * Math.abs(plane.n.y)\n        + aabb.halfExtents.z * Math.abs(plane.n.z);\n    const dot = Vec3.dot(plane.n, aabb.center);\n    if (dot + r < plane.d) { return -1; } else if (dot - r > plane.d) { return 0; }\n    return 1;\n};\n\n/**\n * @en\n * aabb-frustum intersect detect, faster but has false positive corner cases.\n * @zh\n * 轴对齐包围盒和锥台相交性检测，速度快，但有错误情况。\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @param frustum @zh 锥台 @en The frustum to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst aabbFrustum = function (aabb: AABB, frustum: Readonly<Frustum>): number {\n    for (let i = 0; i < frustum.planes.length; i++) {\n        // frustum plane normal points to the inside\n        if (aabbPlane(aabb, frustum.planes[i]) === -1) {\n            return 0;\n        }\n    } // completely outside\n    return 1;\n};\n\n/**\n * @en\n * aabb-frustum intersect detect, faster but false while frustum is completely inside the aabb.\n * @zh\n * 轴对齐包围盒和锥台的相交性检测。速度快，但是当锥台完全在aabb中时就会判断出错。\n * @param {AABB} aabb 轴对齐包围盒\n * @param {Frustum} frustum 锥台\n * @return {number} aabb completely inside the frustum = 1, otherwise = 0\n */\nconst aabbFrustumCompletelyInside = function (aabb: AABB, frustum: Readonly<Frustum>): number {\n    for (let i = 0; i < frustum.planes.length; i++) {\n        // frustum plane normal points to the inside\n        if (aabbPlane(aabb, frustum.planes[i]) !== 0) {\n            return 0;\n        }\n    } // completely inside\n    return 1;\n};\n\n// https://cesium.com/blog/2017/02/02/tighter-frustum-culling-and-why-you-may-want-to-disregard-it/\n/**\n * @en\n * aabb-frustum intersect, handles most of the false positives correctly.\n * @zh\n * 轴对齐包围盒和锥台相交性检测，正确处理大多数错误情况。\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @param frustum @zh 锥台 @en The frustum to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst aabbFrustumAccurate = (function () {\n    const tmp = new Array(8);\n    let out1 = 0; let out2 = 0;\n    for (let i = 0; i < tmp.length; i++) {\n        tmp[i] = new Vec3(0, 0, 0);\n    }\n    return function (aabb: AABB, frustum: Frustum): number {\n        let result = 0; let intersects = false;\n        // 1. aabb inside/outside frustum test\n        for (let i = 0; i < frustum.planes.length; i++) {\n            result = aabbPlane(aabb, frustum.planes[i]);\n            // frustum plane normal points to the inside\n            if (result === -1) return 0; // completely outside\n            else if (result === 1) { intersects = true; }\n        }\n        if (!intersects) { return 1; } // completely inside\n        // in case of false positives\n        // 2. frustum inside/outside aabb test\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            Vec3.subtract(tmp[i], frustum.vertices[i], aabb.center);\n        }\n        out1 = 0, out2 = 0;\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            if (tmp[i].x > aabb.halfExtents.x) { out1++; } else if (tmp[i].x < -aabb.halfExtents.x) { out2++; }\n        }\n        if (out1 === frustum.vertices.length || out2 === frustum.vertices.length) { return 0; }\n        out1 = 0; out2 = 0;\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            if (tmp[i].y > aabb.halfExtents.y) { out1++; } else if (tmp[i].y < -aabb.halfExtents.y) { out2++; }\n        }\n        if (out1 === frustum.vertices.length || out2 === frustum.vertices.length) { return 0; }\n        out1 = 0; out2 = 0;\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            if (tmp[i].z > aabb.halfExtents.z) { out1++; } else if (tmp[i].z < -aabb.halfExtents.z) { out2++; }\n        }\n        if (out1 === frustum.vertices.length || out2 === frustum.vertices.length) { return 0; }\n        return 1;\n    };\n}());\n\n/**\n * @en\n * obb contains the point.\n * @zh\n * 方向包围盒和点的相交性检测。\n * @param obb @zh 方向包围盒 @en The obb to test\n * @param point @zh 点 @en The point to test\n * @return @zh 布尔值 @en The value indicates if there is a intersection\n */\nconst obbPoint = (function () {\n    const tmp = new Vec3(0, 0, 0); const m3 = new Mat3();\n    const lessThan = function (a: Vec3, b: Vec3): boolean { return Math.abs(a.x) < b.x && Math.abs(a.y) < b.y && Math.abs(a.z) < b.z; };\n    return function (obb: OBB, point: Vec3): boolean {\n        Vec3.subtract(tmp, point, obb.center);\n        Vec3.transformMat3(tmp, tmp, Mat3.transpose(m3, obb.orientation));\n        return lessThan(tmp, obb.halfExtents);\n    };\n}());\n\n/**\n * @en\n * obb-plane intersect detect.\n * @zh\n * 方向包围盒和平面的相交性检测。\n * @param obb @zh 方向包围盒 @en The obb to test\n * @param plane @zh 平面 @en The plane to test\n * @return @zh 检测结果, 包含为 -1, 不包含为 0, 相交为 1 @en Test result, inside(back) = -1, outside(front) = 0, intersect = 1\n */\nconst obbPlane = (function () {\n    const absDot = function (n: Vec3, x: number, y: number, z: number) {\n        return Math.abs(n.x * x + n.y * y + n.z * z);\n    };\n    return function (obb: OBB, plane: Plane): number {\n        // Real-Time Collision Detection, Christer Ericson, p. 163.\n        const r = obb.halfExtents.x * absDot(plane.n, obb.orientation.m00, obb.orientation.m01, obb.orientation.m02)\n            + obb.halfExtents.y * absDot(plane.n, obb.orientation.m03, obb.orientation.m04, obb.orientation.m05)\n            + obb.halfExtents.z * absDot(plane.n, obb.orientation.m06, obb.orientation.m07, obb.orientation.m08);\n\n        const dot = Vec3.dot(plane.n, obb.center);\n        if (dot + r < plane.d) { return -1; } else if (dot - r > plane.d) { return 0; }\n        return 1;\n    };\n}());\n\n/**\n * @en\n * obb-frustum intersect, faster but has false positive corner cases.\n * @zh\n * 方向包围盒和锥台相交性检测，速度快，但有错误情况。\n * @param obb @zh 方向包围盒 @en The obb to test\n * @param frustum @zh 锥台 @en The frustum to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst obbFrustum = function (obb: OBB, frustum: Frustum): number {\n    for (let i = 0; i < frustum.planes.length; i++) {\n        // frustum plane normal points to the inside\n        if (obbPlane(obb, frustum.planes[i]) === -1) {\n            return 0;\n        }\n    } // completely outside\n    return 1;\n};\n\n// https://cesium.com/blog/2017/02/02/tighter-frustum-culling-and-why-you-may-want-to-disregard-it/\n/**\n * @en\n * obb-frustum intersect, handles most of the false positives correctly.\n * @zh\n * 方向包围盒和锥台相交性检测，正确处理大多数错误情况。\n * @param obb @zh 方向包围盒 @en The obb to test\n * @param frustum @zh 锥台 @en The frustum to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst obbFrustumAccurate = (function () {\n    const tmp = new Array(8);\n    let dist = 0; let out1 = 0; let out2 = 0;\n    for (let i = 0; i < tmp.length; i++) {\n        tmp[i] = new Vec3(0, 0, 0);\n    }\n    const dot = function (n: Vec3, x: number, y: number, z: number): number {\n        return n.x * x + n.y * y + n.z * z;\n    };\n    return function (obb: OBB, frustum: Frustum): number {\n        let result = 0; let intersects = false;\n        // 1. obb inside/outside frustum test\n        for (let i = 0; i < frustum.planes.length; i++) {\n            result = obbPlane(obb, frustum.planes[i]);\n            // frustum plane normal points to the inside\n            if (result === -1) return 0; // completely outside\n            else if (result === 1) { intersects = true; }\n        }\n        if (!intersects) { return 1; } // completely inside\n        // in case of false positives\n        // 2. frustum inside/outside obb test\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            Vec3.subtract(tmp[i], frustum.vertices[i], obb.center);\n        }\n        out1 = 0, out2 = 0;\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            dist = dot(tmp[i], obb.orientation.m00, obb.orientation.m01, obb.orientation.m02);\n            if (dist > obb.halfExtents.x) { out1++; } else if (dist < -obb.halfExtents.x) { out2++; }\n        }\n        if (out1 === frustum.vertices.length || out2 === frustum.vertices.length) { return 0; }\n        out1 = 0; out2 = 0;\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            dist = dot(tmp[i], obb.orientation.m03, obb.orientation.m04, obb.orientation.m05);\n            if (dist > obb.halfExtents.y) { out1++; } else if (dist < -obb.halfExtents.y) { out2++; }\n        }\n        if (out1 === frustum.vertices.length || out2 === frustum.vertices.length) { return 0; }\n        out1 = 0; out2 = 0;\n        for (let i = 0; i < frustum.vertices.length; i++) {\n            dist = dot(tmp[i], obb.orientation.m06, obb.orientation.m07, obb.orientation.m08);\n            if (dist > obb.halfExtents.z) { out1++; } else if (dist < -obb.halfExtents.z) { out2++; }\n        }\n        if (out1 === frustum.vertices.length || out2 === frustum.vertices.length) { return 0; }\n        return 1;\n    };\n}());\n\n/**\n * @en\n * obb-obb intersect detect.\n * @zh\n * 方向包围盒和方向包围盒的相交性检测。\n * @param obb1 @zh 方向包围盒1 @en Obb 1 to test\n * @param obb2 @zh 方向包围盒2 @en Obb 2 to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst obbWithOBB = (function () {\n    const test = new Array(15);\n    for (let i = 0; i < 15; i++) {\n        test[i] = new Vec3(0, 0, 0);\n    }\n\n    const vertices = new Array(8);\n    const vertices2 = new Array(8);\n    for (let i = 0; i < 8; i++) {\n        vertices[i] = new Vec3(0, 0, 0);\n        vertices2[i] = new Vec3(0, 0, 0);\n    }\n\n    return function (obb1: OBB, obb2: OBB): number {\n        Vec3.set(test[0], obb1.orientation.m00, obb1.orientation.m01, obb1.orientation.m02);\n        Vec3.set(test[1], obb1.orientation.m03, obb1.orientation.m04, obb1.orientation.m05);\n        Vec3.set(test[2], obb1.orientation.m06, obb1.orientation.m07, obb1.orientation.m08);\n        Vec3.set(test[3], obb2.orientation.m00, obb2.orientation.m01, obb2.orientation.m02);\n        Vec3.set(test[4], obb2.orientation.m03, obb2.orientation.m04, obb2.orientation.m05);\n        Vec3.set(test[5], obb2.orientation.m06, obb2.orientation.m07, obb2.orientation.m08);\n\n        for (let i = 0; i < 3; ++i) { // Fill out rest of axis\n            Vec3.cross(test[6 + i * 3 + 0], test[i], test[3]);\n            Vec3.cross(test[6 + i * 3 + 1], test[i], test[4]);\n            Vec3.cross(test[6 + i * 3 + 2], test[i], test[5]);\n        }\n\n        getOBBVertices(obb1.center, obb1.halfExtents, test[0], test[1], test[2], vertices);\n        getOBBVertices(obb2.center, obb2.halfExtents, test[3], test[4], test[5], vertices2);\n\n        for (let i = 0; i < 15; ++i) {\n            const a = getInterval(vertices, test[i]);\n            const b = getInterval(vertices2, test[i]);\n            if (b[0] > a[1] || a[0] > b[1]) {\n                return 0; // Seperating axis found\n            }\n        }\n\n        return 1;\n    };\n}());\n\n// https://github.com/diku-dk/bvh-tvcg18/blob/1fd3348c17bc8cf3da0b4ae60fdb8f2aa90a6ff0/FOUNDATION/GEOMETRY/GEOMETRY/include/overlap/geometry_overlap_obb_capsule.h\n/**\n * @en\n * obb-capsule intersect detect.\n * @zh\n * 方向包围盒和胶囊体的相交性检测。\n * @param obb @zh 方向包围盒 @en The obb to test\n * @param capsule @zh 胶囊体 @en The capsule to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst obbCapsule = (function () {\n    const sphere_0 = new Sphere();\n    const v3_0 = new Vec3();\n    const v3_1 = new Vec3();\n    const v3_2 = new Vec3();\n    const v3_verts8 = new Array<Vec3>(8);\n    for (let i = 0; i < 8; i++) { v3_verts8[i] = new Vec3(); }\n    const v3_axis8 = new Array<Vec3>(8);\n    for (let i = 0; i < 8; i++) { v3_axis8[i] = new Vec3(); }\n    return function (obb: OBB, capsule: Capsule) {\n        const h = Vec3.squaredDistance(capsule.ellipseCenter0, capsule.ellipseCenter1);\n        if (h === 0) {\n            sphere_0.radius = capsule.radius;\n            sphere_0.center.set(capsule.ellipseCenter0);\n            return intersect.sphereOBB(sphere_0, obb);\n        } else {\n            v3_0.x = obb.orientation.m00;\n            v3_0.y = obb.orientation.m01;\n            v3_0.z = obb.orientation.m02;\n            v3_1.x = obb.orientation.m03;\n            v3_1.y = obb.orientation.m04;\n            v3_1.z = obb.orientation.m05;\n            v3_2.x = obb.orientation.m06;\n            v3_2.y = obb.orientation.m07;\n            v3_2.z = obb.orientation.m08;\n            getOBBVertices(obb.center, obb.halfExtents, v3_0, v3_1, v3_2, v3_verts8);\n\n            const axes = v3_axis8;\n            const a0 = Vec3.copy(axes[0], v3_0);\n            const a1 = Vec3.copy(axes[1], v3_1);\n            const a2 = Vec3.copy(axes[2], v3_2);\n            const C = Vec3.subtract(axes[3], capsule.center, obb.center);\n            C.normalize();\n            const B = Vec3.subtract(axes[4], capsule.ellipseCenter0, capsule.ellipseCenter1);\n            B.normalize();\n            Vec3.cross(axes[5], a0, B);\n            Vec3.cross(axes[6], a1, B);\n            Vec3.cross(axes[7], a2, B);\n\n            for (let i = 0; i < 8; ++i) {\n                const a = getInterval(v3_verts8, axes[i]);\n                const d0 = Vec3.dot(axes[i], capsule.ellipseCenter0);\n                const d1 = Vec3.dot(axes[i], capsule.ellipseCenter1);\n                const max_d = Math.max(d0, d1);\n                const min_d = Math.min(d0, d1);\n                const d_min = min_d - capsule.radius;\n                const d_max = max_d + capsule.radius;\n                if (d_min > a[1] || a[0] > d_max) {\n                    return 0; // Seperating axis found\n                }\n            }\n            return 1;\n        }\n    };\n}());\n\n/**\n * @en\n * sphere-plane intersect, not necessarily faster than obb-plane,due to the length calculation of the\n * plane normal to factor out the unnomalized plane distance.\n * @zh\n * 球与平面的相交性检测。\n * @param sphere @zh 球 @en The sphere to test\n * @param plane @zh 平面 @en The plane to test\n * @return @zh 检测结果, 包含为 -1, 不包含为 0, 相交为 1 @en Test result, inside(back) = -1, outside(front) = 0, intersect = 1\n */\nconst spherePlane = function (sphere: Sphere, plane: Plane): number {\n    const dot = Vec3.dot(plane.n, sphere.center);\n    const r = sphere.radius * plane.n.length();\n    if (dot + r < plane.d) { return -1; } else if (dot - r > plane.d) { return 0; }\n    return 1;\n};\n\n/**\n * @en\n * sphere-frustum intersect, faster but has false positive corner cases.\n * @zh\n * 球和锥台的相交性检测，速度快，但有错误情况。\n * @param sphere @zh 球 @en The sphere to test\n * @param frustum @zh 锥台 @en The frustum to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst sphereFrustum = function (sphere: Sphere, frustum: Frustum): number {\n    for (let i = 0; i < frustum.planes.length; i++) {\n        // frustum plane normal points to the inside\n        if (spherePlane(sphere, frustum.planes[i]) === -1) {\n            return 0;\n        }\n    } // completely outside\n    return 1;\n};\n\n// https://stackoverflow.com/questions/20912692/view-frustum-culling-corner-cases\n/**\n * @en\n * sphere-frustum intersect, handles the false positives correctly.\n * @zh\n * 球和锥台的相交性检测，正确处理大多数错误情况。\n * @param sphere @zh 球 @en The sphere to test\n * @param frustum @zh 锥台 @en The frustum to test\n * @return @zh 0 或非 0 @en 0 or not 0, 0 indicates there is no intersection\n */\nconst sphereFrustumAccurate = (function () {\n    const pt = new Vec3(0, 0, 0); const map = [1, -1, 1, -1, 1, -1];\n    return function (sphere: Sphere, frustum: Frustum): number {\n        for (let i = 0; i < 6; i++) {\n            const plane = frustum.planes[i];\n            const r = sphere.radius; const c = sphere.center;\n            const n = plane.n; const d = plane.d;\n            const dot = Vec3.dot(n, c);\n            // frustum plane normal points to the inside\n            if (dot + r < d) return 0; // completely outside\n            else if (dot - r > d) { continue; }\n            // in case of false positives\n            // has false negatives, still working on it\n            Vec3.add(pt, c, Vec3.multiplyScalar(pt, n, r));\n            for (let j = 0; j < 6; j++) {\n                if (j === i || j === i + map[i]) { continue; }\n                const test = frustum.planes[j];\n                if (Vec3.dot(test.n, pt) < test.d) { return 0; }\n            }\n        }\n        return 1;\n    };\n}());\n\n/**\n * @en\n * sphere-sphere intersect detect.\n * @zh\n * 球和球的相交性检测。\n * @param sphere0 @zh 球 0 @en The sphere A to test\n * @param sphere1 @zh 球 1 @en The sphere B to test\n * @return @zh 是否发生碰撞 @en true or false which indicates if there is a intersection\n */\nconst sphereWithSphere = function (sphere0: Sphere, sphere1: Sphere): boolean {\n    const r = sphere0.radius + sphere1.radius;\n    return Vec3.squaredDistance(sphere0.center, sphere1.center) < r * r;\n};\n\n/**\n * @en\n * sphere-aabb intersect detect.\n * @zh\n * 球和轴对齐包围盒的相交性检测。\n * @param sphere @zh 球 @en The sphere to test\n * @param aabb @zh 轴对齐包围盒 @en The aabb to test\n * @return @zh 是否发生碰撞 @en true or false which indicates if there is a intersection\n */\nconst sphereAABB = (function () {\n    const pt = new Vec3();\n    return function (sphere: Sphere, aabb: AABB): boolean {\n        distance.pt_point_aabb(pt, sphere.center, aabb);\n        return Vec3.squaredDistance(sphere.center, pt) < sphere.radius * sphere.radius;\n    };\n}());\n\n/**\n * @en\n * sphere-obb intersect detect.\n * @zh\n * 球和方向包围盒的相交性检测。\n * @param sphere @zh 球 @en The sphere to test\n * @param obb @zh 方向包围盒 @en The obb to test\n * @return @zh 是否发生碰撞 @en true or false which indicates if there is a intersection\n */\nconst sphereOBB = (function () {\n    const pt = new Vec3();\n    return function (sphere: Sphere, obb: OBB): boolean {\n        distance.pt_point_obb(pt, sphere.center, obb);\n        return Vec3.squaredDistance(sphere.center, pt) < sphere.radius * sphere.radius;\n    };\n}());\n\n/**\n * @en\n * sphere-capsule intersect detect.\n * @zh\n * 球和胶囊体的相交性检测。\n * @param sphere @zh 球 @en The sphere to test\n * @param capsule @zh 胶囊体 @en The capsule to test\n * @return @zh 是否发生碰撞 @en true or false which indicates if there is a intersection\n */\nconst sphereCapsule = (function () {\n    const v3_0 = new Vec3();\n    const v3_1 = new Vec3();\n    return function (sphere: Sphere, capsule: Capsule) {\n        const r = sphere.radius + capsule.radius;\n        const squaredR = r * r;\n        const h = Vec3.squaredDistance(capsule.ellipseCenter0, capsule.ellipseCenter1);\n        if (h === 0) {\n            return Vec3.squaredDistance(sphere.center, capsule.center) < squaredR;\n        } else {\n            Vec3.subtract(v3_0, sphere.center, capsule.ellipseCenter0);\n            Vec3.subtract(v3_1, capsule.ellipseCenter1, capsule.ellipseCenter0);\n            const t = Vec3.dot(v3_0, v3_1) / h;\n            if (t < 0) {\n                return Vec3.squaredDistance(sphere.center, capsule.ellipseCenter0) < squaredR;\n            } else if (t > 1) {\n                return Vec3.squaredDistance(sphere.center, capsule.ellipseCenter1) < squaredR;\n            } else {\n                Vec3.scaleAndAdd(v3_0, capsule.ellipseCenter0, v3_1, t);\n                return Vec3.squaredDistance(sphere.center, v3_0) < squaredR;\n            }\n        }\n    };\n}());\n\n// http://www.geomalgorithms.com/a07-_distance.html\n/**\n * @en\n * capsule-capsule intersect detect.\n * @zh\n * 胶囊体和胶囊体的相交性检测。\n * @param capsuleA @zh 胶囊体 A @en The capsule A to test\n * @param capsuleB @zh 胶囊体 B @en The capsule B to test\n * @return @zh 是否发生碰撞 @en true or false which indicates if there is a intersection\n */\nconst capsuleWithCapsule = (function () {\n    const v3_0 = new Vec3();\n    const v3_1 = new Vec3();\n    const v3_2 = new Vec3();\n    const v3_3 = new Vec3();\n    const v3_4 = new Vec3();\n    const v3_5 = new Vec3();\n    return function capsuleWithCapsule (capsuleA: Capsule, capsuleB: Capsule) {\n        const u = Vec3.subtract(v3_0, capsuleA.ellipseCenter1, capsuleA.ellipseCenter0);\n        const v = Vec3.subtract(v3_1, capsuleB.ellipseCenter1, capsuleB.ellipseCenter0);\n        const w = Vec3.subtract(v3_2, capsuleA.ellipseCenter0, capsuleB.ellipseCenter0);\n        const a = Vec3.dot(u, u);         // always >= 0\n        const b = Vec3.dot(u, v);\n        const c = Vec3.dot(v, v);         // always >= 0\n        const d = Vec3.dot(u, w);\n        const e = Vec3.dot(v, w);\n        const D = a * c - b * b;        // always >= 0\n        let sN: number;\n        let sD = D;       // sc = sN / sD, default sD = D >= 0\n        let tN: number;\n        let tD = D;       // tc = tN / tD, default tD = D >= 0\n\n        // compute the line parameters of the two closest points\n        if (D < EPSILON) { // the lines are almost parallel\n            sN = 0.0;         // force using point P0 on segment S1\n            sD = 1.0;         // to prevent possible division by 0.0 later\n            tN = e;\n            tD = c;\n        } else {                 // get the closest points on the infinite lines\n            sN = (b * e - c * d);\n            tN = (a * e - b * d);\n            if (sN < 0.0) {        // sc < 0 => the s=0 edge is visible\n                sN = 0.0;\n                tN = e;\n                tD = c;\n            } else if (sN > sD) {  // sc > 1  => the s=1 edge is visible\n                sN = sD;\n                tN = e + b;\n                tD = c;\n            }\n        }\n\n        if (tN < 0.0) {            // tc < 0 => the t=0 edge is visible\n            tN = 0.0;\n            // recompute sc for this edge\n            if (-d < 0.0) {\n                sN = 0.0;\n            } else if (-d > a) {\n                sN = sD;\n            } else {\n                sN = -d;\n                sD = a;\n            }\n        } else if (tN > tD) {      // tc > 1  => the t=1 edge is visible\n            tN = tD;\n            // recompute sc for this edge\n            if ((-d + b) < 0.0) {\n                sN = 0;\n            } else if ((-d + b) > a) {\n                sN = sD;\n            } else {\n                sN = (-d + b);\n                sD = a;\n            }\n        }\n        // finally do the division to get sc and tc\n        const sc = (Math.abs(sN) < EPSILON ? 0.0 : sN / sD);\n        const tc = (Math.abs(tN) < EPSILON ? 0.0 : tN / tD);\n\n        // get the difference of the two closest points\n        const dP = v3_3;\n        dP.set(w);\n        dP.add(Vec3.multiplyScalar(v3_4, u, sc));\n        dP.subtract(Vec3.multiplyScalar(v3_5, v, tc));\n        const radius = capsuleA.radius + capsuleB.radius;\n        return dP.lengthSqr() < radius * radius;\n    };\n}());\n\n/**\n * @en\n * Algorithm of intersect detect for basic geometry.\n * @zh\n * 基础几何的相交性检测算法。\n */\nconst intersect = {\n    raySphere,\n    rayAABB,\n    rayOBB,\n    rayPlane,\n    rayTriangle,\n    rayCapsule,\n\n    raySubMesh,\n    rayMesh,\n    rayModel,\n\n    lineSphere,\n    lineAABB,\n    lineOBB,\n    linePlane,\n    lineTriangle,\n\n    sphereWithSphere,\n    sphereAABB,\n    sphereOBB,\n    spherePlane,\n    sphereFrustum,\n    sphereFrustumAccurate,\n    sphereCapsule,\n\n    aabbWithAABB,\n    aabbWithOBB,\n    aabbPlane,\n    aabbFrustum,\n    aabbFrustumAccurate,\n\n    obbWithOBB,\n    obbPlane,\n    obbFrustum,\n    obbFrustumAccurate,\n    obbPoint,\n    obbCapsule,\n    aabbFrustumCompletelyInside,\n\n    capsuleWithCapsule,\n\n    /**\n     * @en Check intersection between two geometries, it accept all basic geometry types in [[geometry]] module.\n     * @zh 两个几何体的相交性检测，可填入 [[geometry]] 模块中的基础几何形状。\n     * @param g1 @en The first geometry. @zh 第一个几何体。\n     * @param g2 @en The second geometry. @zh 第二个几何体。\n     * @param outPt @en A 3d point to store the intersection point result, only part of the geometries support this.\n     *              @zh 可选，用于保存相交点的输出对象。（注：仅部分形状的检测带有这个返回值）\n     */\n    resolve (g1: any, g2: any, outPt = null) {\n        const type1 = g1._type; const type2 = g2._type;\n        const resolver = this[type1 | type2] as (...args: any) => number;\n        return type1 < type2 ? resolver(g1, g2, outPt) : resolver(g2, g1, outPt);\n    },\n};\n\nintersect[enums.SHAPE_RAY | enums.SHAPE_SPHERE] = raySphere;\nintersect[enums.SHAPE_RAY | enums.SHAPE_AABB] = rayAABB;\nintersect[enums.SHAPE_RAY | enums.SHAPE_OBB] = rayOBB;\nintersect[enums.SHAPE_RAY | enums.SHAPE_PLANE] = rayPlane;\nintersect[enums.SHAPE_RAY | enums.SHAPE_TRIANGLE] = rayTriangle;\nintersect[enums.SHAPE_RAY | enums.SHAPE_CAPSULE] = rayCapsule;\n\nintersect[enums.SHAPE_LINE | enums.SHAPE_SPHERE] = lineSphere;\nintersect[enums.SHAPE_LINE | enums.SHAPE_AABB] = lineAABB;\nintersect[enums.SHAPE_LINE | enums.SHAPE_OBB] = lineOBB;\nintersect[enums.SHAPE_LINE | enums.SHAPE_PLANE] = linePlane;\nintersect[enums.SHAPE_LINE | enums.SHAPE_TRIANGLE] = lineTriangle;\n\nintersect[enums.SHAPE_SPHERE] = sphereWithSphere;\nintersect[enums.SHAPE_SPHERE | enums.SHAPE_AABB] = sphereAABB;\nintersect[enums.SHAPE_SPHERE | enums.SHAPE_OBB] = sphereOBB;\nintersect[enums.SHAPE_SPHERE | enums.SHAPE_PLANE] = spherePlane;\nintersect[enums.SHAPE_SPHERE | enums.SHAPE_FRUSTUM] = sphereFrustum;\nintersect[enums.SHAPE_SPHERE | enums.SHAPE_FRUSTUM_ACCURATE] = sphereFrustumAccurate;\nintersect[enums.SHAPE_SPHERE | enums.SHAPE_CAPSULE] = sphereCapsule;\n\nintersect[enums.SHAPE_AABB] = aabbWithAABB;\nintersect[enums.SHAPE_AABB | enums.SHAPE_OBB] = aabbWithOBB;\nintersect[enums.SHAPE_AABB | enums.SHAPE_PLANE] = aabbPlane;\nintersect[enums.SHAPE_AABB | enums.SHAPE_FRUSTUM] = aabbFrustum;\nintersect[enums.SHAPE_AABB | enums.SHAPE_FRUSTUM_ACCURATE] = aabbFrustumAccurate;\n\nintersect[enums.SHAPE_OBB] = obbWithOBB;\nintersect[enums.SHAPE_OBB | enums.SHAPE_PLANE] = obbPlane;\nintersect[enums.SHAPE_OBB | enums.SHAPE_FRUSTUM] = obbFrustum;\nintersect[enums.SHAPE_OBB | enums.SHAPE_FRUSTUM_ACCURATE] = obbFrustumAccurate;\nintersect[enums.SHAPE_OBB | enums.SHAPE_CAPSULE] = obbCapsule;\n\nintersect[enums.SHAPE_CAPSULE] = capsuleWithCapsule;\n\nexport default intersect;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { replaceProperty, removeProperty } from '../utils/x-deprecated';\nimport { Line } from './line';\nimport intersect from './intersect';\n\nreplaceProperty(Line.prototype, 'line', [\n    {\n        name: 'mag',\n        newName: 'len',\n    },\n    {\n        name: 'magnitude',\n        newName: 'len',\n    },\n]);\n\nremoveProperty(intersect, 'intersect', [\n    {\n        name: 'line_quad',\n    },\n]);\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Mat4, Vec3, Vec4 } from '../math';\nimport enums from './enums';\nimport { legacyCC } from '../global-exports';\n\nconst v1 = new Vec3(0, 0, 0);\nconst v2 = new Vec3(0, 0, 0);\nconst temp_mat = legacyCC.mat4();\nconst temp_vec4 = legacyCC.v4();\n\n/**\n * @en\n * Basic Geometry: Plane.\n * @zh\n * 基础几何 Plane。\n */\n\nexport class Plane {\n    /**\n     * @en\n     * create a new plane\n     * @zh\n     * 创建一个新的 plane。\n     * @param nx @en The x component of normal vector. @zh 法向分量的 x 部分。\n     * @param ny @en The y component of normal vector. @zh 法向分量的 y 部分。\n     * @param nz @en The z component of normal vector. @zh 法向分量的 z 部分。\n     * @param d  @en The distance between normal vector and the origin. @zh 与原点的距离。\n     * @return\n     */\n    public static create (nx: number, ny: number, nz: number, d: number) {\n        return new Plane(nx, ny, nz, d);\n    }\n\n    /**\n     * @en\n     * clone a new plane\n     * @zh\n     * 克隆一个新的 plane。\n     * @param p @en The Plane object to be cloned from. @zh 克隆的来源。\n     * @return @en Cloned objects @zh 克隆出的对象。\n     */\n    public static clone (p: Plane) {\n        return new Plane(p.n.x, p.n.y, p.n.z, p.d);\n    }\n\n    /**\n     * @en\n     * copy the values from one plane to another\n     * @zh\n     * 复制一个平面的值到另一个。\n     * @param out @en The object to be operated on. @zh 接受操作的对象。\n     * @param p @en The source of replication. @zh 复制的来源。\n     * @return @en The object to be operated on. @zh 接受操作的对象。\n     */\n    public static copy (out: Plane, p: Plane) {\n        Vec3.copy(out.n, p.n);\n        out.d = p.d;\n\n        return out;\n    }\n\n    /**\n     * @en\n     * create a plane from three points\n     * @zh\n     * 用三个点创建一个平面。\n     * @param out @en The object to be operated on. @zh 接受操作的对象。\n     * @param a @en Point a. @zh 点 a。\n     * @param b @en Point b. @zh 点 b。\n     * @param c @en Point c. @zh 点 c。\n     * @return out @en The object to be operated on. @zh 接受操作的对象。\n     */\n    public static fromPoints (out: Plane, a: Vec3, b: Vec3, c: Vec3) {\n        Vec3.subtract(v1, b, a);\n        Vec3.subtract(v2, c, a);\n\n        Vec3.normalize(out.n, Vec3.cross(out.n, v1, v2));\n        out.d = Vec3.dot(out.n, a);\n\n        return out;\n    }\n\n    /**\n     * @en\n     * Set the components of a plane to the given values\n     * @zh\n     * 将给定平面的属性设置为给定值。\n     * @param out @en The object to be operated on. @zh 接受操作的对象。\n     * @param nx @en The x component of normal vector. @zh 法向分量的 x 部分。\n     * @param ny @en The y component of normal vector. @zh 法向分量的 y 部分。\n     * @param nz @en The z component of normal vector. @zh 法向分量的 z 部分。\n     * @param d  @en The distance between normal vector and the origin. @zh 与原点的距离。\n     * @return out @en The object to be operated on. @zh 接受操作的对象。\n     */\n    public static set (out: Plane, nx: number, ny: number, nz: number, d: number) {\n        out.n.x = nx;\n        out.n.y = ny;\n        out.n.z = nz;\n        out.d = d;\n\n        return out;\n    }\n\n    /**\n     * @en\n     * create plane from normal and point\n     * @zh\n     * 用一条法线和一个点创建平面。\n     * @param out @en The object to be operated on. @zh 接受操作的对象。\n     * @param normal @en Normal of the plane. @zh 平面的法线。\n     * @param point @en A point in the plane. @zh 平面上的一点。\n     * @return out @en The object to be operated on. @zh 接受操作的对象。\n     */\n    public static fromNormalAndPoint (out: Plane, normal: Vec3, point: Vec3) {\n        Vec3.copy(out.n, normal);\n        out.d = Vec3.dot(normal, point);\n\n        return out;\n    }\n\n    /**\n     * @en\n     * normalize a plane\n     * @zh\n     * 归一化一个平面。\n     * @param out @en The object to be operated on. @zh 接受操作的对象。\n     * @param a @en Source data for the operation. @zh 操作的源数据。\n     * @return out @en The object to be operated on. @zh 接受操作的对象。\n     */\n    public static normalize (out: Plane, a: Plane) {\n        const len = a.n.length();\n        Vec3.normalize(out.n, a.n);\n        if (len > 0) {\n            out.d = a.d / len;\n        }\n        return out;\n    }\n\n    /**\n     * @en\n     * The normal of the plane.\n     * @zh\n     * 法线向量。\n     */\n    public n: Vec3;\n\n    /**\n     * @en\n     * The distance from the origin to the plane.\n     * @zh\n     * 原点到平面的距离。\n     */\n    public d: number;\n\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    // compatibility with vector interfaces\n    set x (val) { this.n.x = val; }\n    get x () { return this.n.x; }\n    set y (val) { this.n.y = val; }\n    get y () { return this.n.y; }\n    set z (val) { this.n.z = val; }\n    get z () { return this.n.z; }\n    set w (val) { this.d = val; }\n    get w () { return this.d; }\n\n    protected readonly _type: number;\n\n    /**\n     * @en\n     * Construct a plane.\n     * @zh\n     * 构造一个平面。\n     * @param nx @en The x component of normal vector. @zh 法向分量的 x 部分。\n     * @param ny @en The y component of normal vector. @zh 法向分量的 y 部分。\n     * @param nz @en The z component of normal vector. @zh 法向分量的 z 部分。\n     * @param d @en The distance between normal vector and the origin. @zh 与原点的距离。\n     */\n    constructor (nx = 0, ny = 1, nz = 0, d = 0) {\n        this._type = enums.SHAPE_PLANE;\n        this.n = new Vec3(nx, ny, nz);\n        this.d = d;\n    }\n\n    /**\n     * @en\n     * transform this plane.\n     * @zh\n     * 变换一个平面。\n     * @param mat\n     */\n    public transform (mat: Mat4): void {\n        Mat4.invert(temp_mat, mat);\n        Mat4.transpose(temp_mat, temp_mat);\n        Vec4.set(temp_vec4, this.n.x, this.n.y, this.n.z, this.d);\n        Vec4.transformMat4(temp_vec4, temp_vec4, temp_mat);\n        Vec3.set(this.n, temp_vec4.x, temp_vec4.y, temp_vec4.z);\n        this.d = temp_vec4.w;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Mat3, Mat4, Quat, Vec3 } from '../math';\nimport enums from './enums';\nimport { IVec3, IVec3Like } from '../math/type-define';\nimport { Sphere } from './sphere';\nimport { Frustum } from './frustum';\n\nconst _v3_tmp = new Vec3();\nconst _v3_tmp2 = new Vec3();\nconst _v3_tmp3 = new Vec3();\nconst _v3_tmp4 = new Vec3();\nconst _m3_tmp = new Mat3();\n\n// https://zeuxcg.org/2010/10/17/aabb-from-obb-with-component-wise-abs/\nconst transform_extent_m4 = (out: Vec3, extent: Vec3, m4: Mat4 | Readonly<Mat4>) => {\n    _m3_tmp.m00 = Math.abs(m4.m00); _m3_tmp.m01 = Math.abs(m4.m01); _m3_tmp.m02 = Math.abs(m4.m02);\n    _m3_tmp.m03 = Math.abs(m4.m04); _m3_tmp.m04 = Math.abs(m4.m05); _m3_tmp.m05 = Math.abs(m4.m06);\n    _m3_tmp.m06 = Math.abs(m4.m08); _m3_tmp.m07 = Math.abs(m4.m09); _m3_tmp.m08 = Math.abs(m4.m10);\n    Vec3.transformMat3(out, extent, _m3_tmp);\n};\n\n/**\n  * @en\n  * Basic Geometry: Axis-aligned bounding box, using center and half extents structure.\n  * @zh\n  * 基础几何  轴对齐包围盒，使用中心点和半长宽高的结构。\n  */\n\nexport class AABB {\n    /**\n      * @en\n      * create a new AABB\n      * @zh\n      * 创建一个新的 AABB 实例。\n      * @param px @zh AABB 的原点的 X 坐标。@en The x coordinate of the origin of the AABB.\n      * @param py @zh AABB 的原点的 Y 坐标。@en The y coordinate of the origin of the AABB.\n      * @param pz @zh AABB 的原点的 Z 坐标。 @en The z coordinate of the origin of the AABB.\n      * @param hw @zh AABB 宽度的一半。 @en Half the width of the AABB.\n      * @param hh @zh AABB 高度的一半。@en Half the height of the AABB.\n      * @param hl @zh AABB 长度的一半。@en Half the length of the AABB.\n      * @returns @zh 返回新创建的 AABB 实例。 @en A new instance of AABB.\n      */\n    public static create (px?: number, py?: number, pz?: number, hw?: number, hh?: number, hl?: number) {\n        return new AABB(px, py, pz, hw, hh, hl);\n    }\n\n    /**\n      * @en\n      * clone a new AABB\n      * @zh\n      * 克隆一个 AABB。\n      * @param a @zh 克隆的目标。 @en Target object.\n      * @returns @zh 克隆出的 AABB。@en The new AABB.\n      */\n    public static clone (a: AABB | Readonly<AABB>) {\n        return new AABB(a.center.x, a.center.y, a.center.z,\n            a.halfExtents.x, a.halfExtents.y, a.halfExtents.z);\n    }\n\n    /**\n      * @en\n      * copy the values from one AABB to another\n      * @zh\n      * 将从一个 AABB 的值复制到另一个 AABB。\n      * @param out @zh 接受操作的 AABB。 @en The output AABB, copy destination.\n      * @param a @zh 被复制的 AABB。 @en Source object of copy operation.\n      * @returns @zh 接受操作的 AABB。 @en The reference of the first parameter `dst`, the new AABB.\n      */\n    public static copy (out: AABB, a: AABB | Readonly<AABB>): AABB {\n        Vec3.copy(out.center, a.center);\n        Vec3.copy(out.halfExtents, a.halfExtents);\n\n        return out;\n    }\n\n    /**\n      * @en\n      * Construct a new AABB from two corner points\n      * @zh\n      * 从两个点创建一个新的 AABB。\n      * @param out @zh 接受操作的 AABB。 @en The output AABB\n      * @param minPos @zh AABB 的最小点。 @en Minimum point of the axis-aligned 3d bounding box.\n      * @param maxPos @zh AABB 的最大点。 @en Maximum point of the axis-aligned 3d bounding box.\n      * @returns @zh out 接受操作的 AABB。 @en The new AABB\n      */\n    public static fromPoints (out: AABB, minPos: IVec3, maxPos: IVec3): AABB {\n        Vec3.add(_v3_tmp, maxPos, minPos);\n        Vec3.subtract(_v3_tmp2, maxPos, minPos);\n        Vec3.multiplyScalar(out.center, _v3_tmp, 0.5);\n        Vec3.multiplyScalar(out.halfExtents, _v3_tmp2, 0.5);\n        return out;\n    }\n\n    /**\n      * @en\n      * Set the components of a AABB to the given values\n      * @zh\n      * 将 AABB 的属性设置为给定的值。\n      * @param @zh out 接受操作的 AABB。 @en The output AABB to set.\n      * @param px @zh - AABB 的原点的 X 坐标。 @en The x coordinate of the origin of the AABB.\n      * @param py @zh - AABB 的原点的 Y 坐标。 @en The y coordinate of the origin of the AABB.\n      * @param pz @zh - AABB 的原点的 Z 坐标。 @en The z coordinate of the origin of the AABB.\n      * @param hw @zh - AABB 宽度的一半。 @en Half the width of the AABB.\n      * @param hh @zh - AABB 高度的一半。 @en Half the height of the AABB.\n      * @param hl @zh - AABB 长度度的一半。 @en Half the length of the AABB.\n      * @returns @zh out 接受操作的 AABB。 @en The reference fo the first parameter `out`.\n      */\n    public static set (out: AABB, px: number, py: number, pz: number, hw: number, hh: number, hl: number): AABB {\n        out.center.set(px, py, pz);\n        out.halfExtents.set(hw, hh, hl);\n        return out;\n    }\n\n    /**\n      * @en\n      * Merge two AABB into one.\n      * @zh\n      * 合并两个 AABB 到 out。\n      * @param out @zh 接受操作的 AABB。 @en The output AABB to storge merge result.\n      * @param a @zh 输入的 AABB。 @en The first AABB to be merged.\n      * @param b @zh 输入的 AABB。 @en The second AABB to be merged.\n      * @returns @zh out 接受操作的 AABB。 @en The reference of the first parameter `out`.\n      */\n    public static merge (out: AABB, a: AABB | Readonly<AABB>, b: AABB | Readonly<AABB>): AABB {\n        Vec3.subtract(_v3_tmp, a.center, a.halfExtents);\n        Vec3.subtract(_v3_tmp2, b.center, b.halfExtents);\n        Vec3.add(_v3_tmp3, a.center, a.halfExtents);\n        Vec3.add(_v3_tmp4, b.center, b.halfExtents);\n        Vec3.max(_v3_tmp4, _v3_tmp3, _v3_tmp4);\n        Vec3.min(_v3_tmp3, _v3_tmp, _v3_tmp2);\n        return AABB.fromPoints(out, _v3_tmp3, _v3_tmp4);\n    }\n\n    /**\n      * @en\n      * Convert AABB to sphere.\n      * @zh\n      * 包围盒转包围球\n      * @param out @zh 接受操作的 sphere。 @en The output sphere.\n      * @param a @zh 输入的 AABB。 @en The input AABB.\n      * @returns @zh out 接受的 Sphere @en The reference of the first parameter `out`.\n      */\n    public static toBoundingSphere (out: Sphere, a: AABB | Readonly<AABB>) {\n        out.center.set(a.center);\n        out.radius = a.halfExtents.length();\n        return out;\n    }\n\n    /**\n      * @en\n      * Transform this AABB.\n      * @zh\n      * 变换一个 AABB 到 out 中。\n      * @param out @zh 接受操作的 AABB。 @en The output AABB.\n      * @param a @zh 输入的源 AABB。 @en The input AABB.\n      * @param matrix @zh 矩阵。 @en The transformation matrix.\n      * @returns @zh {AABB} out 接受操作的 AABB。 @en The reference of the first parameter `out`.\n      */\n    public static transform (out: AABB, a: AABB | Readonly<AABB>, matrix: Mat4 | Readonly<Mat4>): AABB {\n        Vec3.transformMat4(out.center, a.center, matrix);\n        transform_extent_m4(out.halfExtents, a.halfExtents, matrix);\n        return out;\n    }\n\n    /**\n      * @en\n      * The origin point of the AABB\n      * @zh\n      * 本地坐标的中心点。\n      */\n    public center: Vec3;\n\n    /**\n      * @en\n      * Half the size of the AABB\n      * @zh\n      * 长宽高的一半。\n      */\n    public halfExtents: Vec3;\n\n    /**\n      * @en\n      * Gets the type of the shape.\n      * @zh\n      * 获取形状的类型。\n      */\n    get type () {\n        return this._type;\n    }\n\n    protected readonly _type: number;\n    constructor (px = 0, py = 0, pz = 0, hw = 1, hh = 1, hl = 1) {\n        this._type = enums.SHAPE_AABB;\n\n        this.center = new Vec3(px, py, pz);\n        this.halfExtents = new Vec3(hw, hh, hl);\n    }\n\n    /**\n      * @en\n      * Get the bounding points of this shape\n      * @zh\n      * 获取 AABB 的最小点和最大点。\n      * @param minPos @zh 最小点。 @en Minimum position of the axis-aligned 3d bounding box.\n      * @param maxPos @zh 最大点。 @en Maximum position of the axis-aligned 3d bounding box.\n      */\n    public getBoundary (minPos: IVec3Like, maxPos: IVec3Like) {\n        Vec3.subtract(minPos, this.center, this.halfExtents);\n        Vec3.add(maxPos, this.center, this.halfExtents);\n    }\n\n    /**\n      * @en\n      * Transform this shape\n      * @zh\n      * 将 out 根据这个 AABB 的数据进行变换。\n      * @param m @zh 变换的矩阵。 @en The transform matrix.\n      * @param pos @zh 变换的位置部分。 @en 3d-vector translation.\n      * @param rot @zh 变换的旋转部分。 @en Quaternion rotation .\n      * @param scale @zh 变换的缩放部分。 @en 3d-vector scale.\n      * @param out @zh 变换的目标。 @en The output AABB.\n      */\n    public transform (m: Mat4, pos: Vec3 | null, rot: Quat | null, scale: Vec3 | null, out: AABB) {\n        Vec3.transformMat4(out.center, this.center, m);\n        transform_extent_m4(out.halfExtents, this.halfExtents, m);\n    }\n\n    /**\n      * @en\n      * Clones the AABB\n      * @zh\n      * 获得克隆。\n      * @returns @zh {AABB} @en A copy of the object.\n      */\n    public clone (): AABB {\n        return AABB.clone(this);\n    }\n\n    /**\n      * @en\n      * Copy the input to the receiver object.\n      * @zh\n      * 拷贝对象。\n      * @param a @zh 拷贝的目标。 @en Copy target\n      * @returns @zh This object @en The reference of this.\n      */\n    public copy (a: AABB | Readonly<AABB>): AABB {\n        return AABB.copy(this, a);\n    }\n\n    /**\n      * @en AABB and point merge.\n      * @zh AABB包围盒合并一个顶点。\n      * @param point @zh - 某一个位置的顶点。 @en A point in 3d space.\n      */\n    public mergePoint (point: IVec3) {\n        // _v3_tmp is min pos\n        // _v3_tmp2 is max pos\n        this.getBoundary(_v3_tmp, _v3_tmp2);\n        if (point.x < _v3_tmp.x) { _v3_tmp.x = point.x; }\n        if (point.y < _v3_tmp.y) { _v3_tmp.y = point.y; }\n        if (point.z < _v3_tmp.z) { _v3_tmp.z = point.z; }\n        if (point.x > _v3_tmp2.x) { _v3_tmp2.x = point.x; }\n        if (point.y > _v3_tmp2.y) { _v3_tmp2.y = point.y; }\n        if (point.z > _v3_tmp2.z) { _v3_tmp2.z = point.z; }\n\n        // _v3_tmp3 is center pos\n        Vec3.add(_v3_tmp3, _v3_tmp, _v3_tmp2);\n        this.center.set(Vec3.multiplyScalar(_v3_tmp3, _v3_tmp3, 0.5));\n        this.halfExtents.set(_v3_tmp2.x - _v3_tmp3.x, _v3_tmp2.y - _v3_tmp3.y, _v3_tmp2.z - _v3_tmp3.z);\n    }\n\n    /**\n      * @en AABB and points merge.\n      * @zh AABB包围盒合并一系列顶点。\n      * @param points @zh - 某一个位置的顶点。 @en A list of points in 3d space.\n      */\n    public mergePoints (points: IVec3[]) {\n        if (points.length < 1) { return; }\n        for (let i = 0; i < points.length; i++) {\n            this.mergePoint(points[i]);\n        }\n    }\n\n    /**\n      * @en AABB and frustum merge.\n      * @zh Frustum 合并到 AABB。\n      * @param frustum @zh 输入的 Frustum。 @en The frustum object.\n      */\n    public mergeFrustum (frustum: Frustum | Readonly<Frustum>) {\n        return this.mergePoints(frustum.vertices);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Mat3, Mat4, Quat, Vec3 } from '../math';\nimport enums from './enums';\n\nconst _v3_tmp = new Vec3();\nconst _v3_tmp2 = new Vec3();\nconst _m3_tmp = new Mat3();\n\n// https://zeuxcg.org/2010/10/17/aabb-from-obb-with-component-wise-abs/\nconst transform_extent_m3 = (out: Vec3, extent: Vec3, m3: Mat3) => {\n    _m3_tmp.m00 = Math.abs(m3.m00); _m3_tmp.m01 = Math.abs(m3.m01); _m3_tmp.m02 = Math.abs(m3.m02);\n    _m3_tmp.m03 = Math.abs(m3.m03); _m3_tmp.m04 = Math.abs(m3.m04); _m3_tmp.m05 = Math.abs(m3.m05);\n    _m3_tmp.m06 = Math.abs(m3.m06); _m3_tmp.m07 = Math.abs(m3.m07); _m3_tmp.m08 = Math.abs(m3.m08);\n    Vec3.transformMat3(out, extent, _m3_tmp);\n};\n\n/**\n * @en\n * Basic Geometry: directional bounding box.\n * @zh\n * 基础几何  方向包围盒。\n */\n\nexport class OBB {\n    /**\n     * @en\n     * create a new obb\n     * @zh\n     * 创建一个新的 obb 实例。\n     * @param cx @zh 形状的相对于原点的 X 坐标。 @en The x coordinate of origin.\n     * @param cy @zh 形状的相对于原点的 Y 坐标。 @en The y coordinate of origin.\n     * @param cz @zh 形状的相对于原点的 Z 坐标。 @en The z coordinate of origin.\n     * @param hw @zh - obb 宽度的一半。 @en Half the width of the OBB.\n     * @param hh @zh - obb 高度的一半。 @en Half the height of the OBB.\n     * @param hl @zh - obb 长度的一半。 @en Half the length of the OBB.\n     * @param ox_1 @zh 方向矩阵参数。 @en The x component of the one axis of the OBB.\n     * @param ox_2 @zh 方向矩阵参数。 @en The x component of the second axis of the OBB.\n     * @param ox_3 @zh 方向矩阵参数。 @en The x component of the third axis of the OBB.\n     * @param oy_1 @zh 方向矩阵参数。 @en The y component of the one axis of the OBB.\n     * @param oy_2 @zh 方向矩阵参数。 @en The y component of the second axis of the OBB.\n     * @param oy_3 @zh 方向矩阵参数。 @en The y component of the third axis of the OBB.\n     * @param oz_1 @zh 方向矩阵参数。 @en The z component of the one axis of the OBB.\n     * @param oz_2 @zh 方向矩阵参数。 @en The z component of the second axis of the OBB.\n     * @param oz_3 @zh 方向矩阵参数。 @en The z component of the third axis of the OBB.\n     * @return @zh 返回一个 obb。 @en A new OBB.\n     */\n    public static create (\n        cx: number, cy: number, cz: number,\n        hw: number, hh: number, hl: number,\n        ox_1: number, ox_2: number, ox_3: number,\n        oy_1: number, oy_2: number, oy_3: number,\n        oz_1: number, oz_2: number, oz_3: number,\n    ) {\n        return new OBB(cx, cy, cz, hw, hh, hl, ox_1, ox_2, ox_3, oy_1, oy_2, oy_3, oz_1, oz_2, oz_3);\n    }\n\n    /**\n     * @en\n     * clone a new obb\n     * @zh\n     * 克隆一个 obb。\n     * @param a @zh 克隆的目标。 @en The input OBB.\n     * @returns @zh The new OBB.  @en 克隆出的新对象。\n     */\n    public static clone (a: OBB) {\n        return new OBB(a.center.x, a.center.y, a.center.z,\n            a.halfExtents.x, a.halfExtents.y, a.halfExtents.z,\n            a.orientation.m00, a.orientation.m01, a.orientation.m02,\n            a.orientation.m03, a.orientation.m04, a.orientation.m05,\n            a.orientation.m06, a.orientation.m07, a.orientation.m08);\n    }\n\n    /**\n     * @en\n     * copy the values from one obb to another\n     * @zh\n     * 将从一个 obb 的值复制到另一个 obb。\n     * @param  out @zh 接受操作的 obb。 @en The output OBB.\n     * @param  a @zh 被复制的 obb。 @en The input OBB.\n     * @returns  @zh out 接受操作的 obb。 @en The reference of the first parameter `out`.\n     */\n    public static copy (out: OBB, a: OBB): OBB {\n        Vec3.copy(out.center, a.center);\n        Vec3.copy(out.halfExtents, a.halfExtents);\n        Mat3.copy(out.orientation, a.orientation);\n\n        return out;\n    }\n\n    /**\n     * @en\n     * create a new obb from two corner points\n     * @zh\n     * 用两个点创建一个新的 obb。\n     * @param out @zh - 接受操作的 obb。 @en The output OBB.\n     * @param minPos @zh - obb 的最小点。 @en The minimum position of the AABB.\n     * @param maxPos @zh - obb 的最大点。 @en The maximum position of the AABB.\n     * @returns @zh {OBB} out 接受操作的 obb。 @en The reference of the first parameter `out`.\n     */\n    public static fromPoints (out: OBB, minPos: Vec3, maxPos: Vec3): OBB {\n        Vec3.multiplyScalar(out.center, Vec3.add(_v3_tmp, minPos, maxPos), 0.5);\n        Vec3.multiplyScalar(out.halfExtents, Vec3.subtract(_v3_tmp2, maxPos, minPos), 0.5);\n        Mat3.identity(out.orientation);\n        return out;\n    }\n\n    /**\n     * @en\n     * Set the components of a obb to the given values\n     * @zh\n     * 将给定 obb 的属性设置为给定的值。\n     * @param out @zh 目标 OBB @en The output OBB.\n     * @param cx @zh 形状的相对于原点的 X 坐标。 @en The x coordinate of origin.\n     * @param cy @zh 形状的相对于原点的 Y 坐标。 @en The y coordinate of origin.\n     * @param cz @zh 形状的相对于原点的 Z 坐标。 @en The z coordinate of origin.\n     * @param hw @zh - obb 宽度的一半。 @en Half the width of the OBB.\n     * @param hh @zh - obb 高度的一半。 @en Half the height of the OBB.\n     * @param hl @zh - obb 长度的一半。 @en Half the length of the OBB.\n     * @param ox_1 @zh 方向矩阵参数。 @en The x component of the one axis of the OBB.\n     * @param ox_2 @zh 方向矩阵参数。 @en The x component of the second axis of the OBB.\n     * @param ox_3 @zh 方向矩阵参数。 @en The x component of the third axis of the OBB.\n     * @param oy_1 @zh 方向矩阵参数。 @en The y component of the one axis of the OBB.\n     * @param oy_2 @zh 方向矩阵参数。 @en The y component of the second axis of the OBB.\n     * @param oy_3 @zh 方向矩阵参数。 @en The y component of the third axis of the OBB.\n     * @param oz_1 @zh 方向矩阵参数。 @en The z component of the one axis of the OBB.\n     * @param oz_2 @zh 方向矩阵参数。 @en The z component of the second axis of the OBB.\n     * @param oz_3 @zh 方向矩阵参数。 @en The z component of the third axis of the OBB.\n     * @returns @zh out 接受操作的 OBB @en The reference of the first parameter `out`.\n     */\n    public static set (\n        out: OBB,\n        cx: number, cy: number, cz: number,\n        hw: number, hh: number, hl: number,\n        ox_1: number, ox_2: number, ox_3: number,\n        oy_1: number, oy_2: number, oy_3: number,\n        oz_1: number, oz_2: number, oz_3: number,\n    ): OBB {\n        Vec3.set(out.center, cx, cy, cz);\n        Vec3.set(out.halfExtents, hw, hh, hl);\n        Mat3.set(out.orientation, ox_1, ox_2, ox_3, oy_1, oy_2, oy_3, oz_1, oz_2, oz_3);\n        return out;\n    }\n\n    /**\n     * @en\n     * Center point of the OBB.\n     * @zh\n     * 本地坐标的中心点。\n     */\n    public center: Vec3;\n\n    /**\n     * @en\n     * Half the distance across the OBB in each local axis.\n     * @zh\n     * 长宽高的一半。\n     */\n    public halfExtents: Vec3;\n\n    /**\n     * @en\n     * Orientation matrix.\n     * @zh\n     * 方向矩阵。\n     */\n    public orientation: Mat3;\n\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    protected readonly _type: number;\n\n    constructor (cx = 0, cy = 0, cz = 0,\n        hw = 1, hh = 1, hl = 1,\n        ox_1 = 1, ox_2 = 0, ox_3 = 0,\n        oy_1 = 0, oy_2 = 1, oy_3 = 0,\n        oz_1 = 0, oz_2 = 0, oz_3 = 1) {\n        this._type = enums.SHAPE_OBB;\n        this.center = new Vec3(cx, cy, cz);\n        this.halfExtents = new Vec3(hw, hh, hl);\n        this.orientation = new Mat3(ox_1, ox_2, ox_3, oy_1, oy_2, oy_3, oz_1, oz_2, oz_3);\n    }\n\n    /**\n     * @en\n     * Get the bounding points of this shape\n     * @zh\n     * 获取 obb 的最小点和最大点。\n     * @param minPos @zh 最小点。 @en The out minimum position of the OBB.\n     * @param maxPos @zh 最大点。 @en The out maximum position of the OBB.\n     */\n    public getBoundary (minPos: Vec3, maxPos: Vec3) {\n        transform_extent_m3(_v3_tmp, this.halfExtents, this.orientation);\n        Vec3.subtract(minPos, this.center, _v3_tmp);\n        Vec3.add(maxPos, this.center, _v3_tmp);\n    }\n\n    /**\n     * @en\n     * Transform this shape\n     * @zh\n     * 将 out 根据这个 obb 的数据进行变换。\n     * @param m @zh 变换的矩阵。 @en The transform matrix\n     * @param pos @zh 变换的位置部分。 @en 3d-vector translation.\n     * @param rot @zh 变换的旋转部分。 @en Quaternion rotation.\n     * @param scale @zh 变换的缩放部分。 @en 3d-vector scale.\n     * @param out @zh 变换的目标。 @en The output OBB.\n     */\n    public transform (m: Mat4, pos: Vec3, rot: Quat, scale: Vec3, out: OBB) {\n        Vec3.transformMat4(out.center, this.center, m);\n        // parent shape doesn't contain rotations for now\n        Mat3.fromQuat(out.orientation, rot);\n        Vec3.multiply(out.halfExtents, this.halfExtents, scale);\n    }\n\n    /**\n     * @en\n     * Transform by matrix and rotation.\n     * @zh\n     * 将 out 根据这个 obb 的数据进行变换。\n     * @param m @zh 变换的矩阵。 @en The transform matrix.\n     * @param rot @zh 变换的旋转部分。 @en Quaternion rotation.\n     * @param out @zh 变换的目标。 @en The output OBB.\n     */\n    public translateAndRotate (m: Mat4, rot: Quat, out: OBB) {\n        Vec3.transformMat4(out.center, this.center, m);\n        // parent shape doesn't contain rotations for now\n        Mat3.fromQuat(out.orientation, rot);\n    }\n\n    /**\n     * @en\n     * Scale OBB by a 3d-vector.\n     * @zh\n     *  将 out 根据这个 obb 的数据进行缩放。\n     * @param scale @zh 缩放值。 @en 3d-vector scale.\n     * @param out @zh 缩放的目标。 @en The output OBB.\n     */\n    public setScale (scale: Vec3, out: OBB) {\n        Vec3.multiply(out.halfExtents, this.halfExtents, scale);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3, Quat, Mat4, absMaxComponent } from '../math';\nimport enums from './enums';\nimport { IVec3Like, IQuatLike } from '../math/type-define';\n\n/**\n * @en\n * Basic Geometry: capsule.\n * @zh\n * 基础几何，胶囊体。\n */\nexport class Capsule {\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     */\n    get type () {\n        return this._type;\n    }\n\n    protected readonly _type: number;\n\n    /**\n     * @en\n     * Capsule sphere radius.\n     * @zh\n     * 胶囊体球部半径。\n     */\n    radius: number;\n\n    /**\n     * @en\n     * The distance between the center point of the capsule and the center of the sphere.\n     * @zh\n     * 胶囊体中心点和球部圆心的距离。\n     */\n    halfHeight: number;\n\n    /**\n     * @en\n     * Local orientation of capsule [0,1,2] => [x,y,z].\n     * @zh\n     * 胶囊体的本地朝向，映射关系 [0,1,2] => [x,y,z]。\n     */\n    axis: number;\n\n    /**\n     * @en\n     * The origin of the capsule.\n     * @zh\n     * 胶囊体的原点。\n     */\n    readonly center: Vec3;\n\n    /**\n     * @en\n     * The rotation of the capsule.\n     * @zh\n     * 胶囊体的旋转。\n     */\n    readonly rotation: Quat;\n\n    /**\n     * @internal\n     * cache, local center of ellipse\n     **/\n    readonly ellipseCenter0: Vec3;\n    /**\n     * @internal\n     */\n    readonly ellipseCenter1: Vec3;\n\n    constructor (radius = 0.5, halfHeight = 0.5, axis = 1) {\n        this._type = enums.SHAPE_CAPSULE;\n        this.radius = radius;\n        this.halfHeight = halfHeight;\n        this.axis = axis;\n\n        this.center = new Vec3();\n        this.rotation = new Quat();\n\n        this.ellipseCenter0 = new Vec3(0, halfHeight, 0);\n        this.ellipseCenter1 = new Vec3(0, -halfHeight, 0);\n        this.updateCache();\n    }\n\n    /**\n     * @en\n     * Transform this capsule.\n     * @zh\n     * 变换此胶囊体。\n     */\n    transform (m: Mat4, pos: IVec3Like, rot: IQuatLike, scale: IVec3Like, out: Capsule) {\n        const ws = scale;\n        const s = absMaxComponent(ws as Vec3);\n        out.radius = this.radius * Math.abs(s);\n\n        const halfTotalWorldHeight = (this.halfHeight + this.radius) * Math.abs(ws.y);\n        let halfWorldHeight = halfTotalWorldHeight - out.radius;\n        if (halfWorldHeight < 0) halfWorldHeight = 0;\n        out.halfHeight = halfWorldHeight;\n\n        Vec3.transformMat4(out.center, this.center, m);\n        Quat.multiply(out.rotation, this.rotation, rot);\n        out.updateCache();\n    }\n\n    updateCache () {\n        this.updateLocalCenter();\n        Vec3.transformQuat(this.ellipseCenter0, this.ellipseCenter0, this.rotation);\n        Vec3.transformQuat(this.ellipseCenter1, this.ellipseCenter1, this.rotation);\n        this.ellipseCenter0.add(this.center);\n        this.ellipseCenter1.add(this.center);\n    }\n\n    updateLocalCenter () {\n        const halfHeight = this.halfHeight;\n        const axis = this.axis;\n        switch (axis) {\n        case 0:\n            this.ellipseCenter0.set(halfHeight, 0, 0);\n            this.ellipseCenter1.set(-halfHeight, 0, 0);\n            break;\n        case 1:\n            this.ellipseCenter0.set(0, halfHeight, 0);\n            this.ellipseCenter1.set(0, -halfHeight, 0);\n            break;\n        case 2:\n            this.ellipseCenter0.set(0, 0, halfHeight);\n            this.ellipseCenter1.set(0, 0, -halfHeight);\n            break;\n        default:\n            break;\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Mat4, Vec3 } from '../math';\nimport { Camera } from '../renderer/scene';\nimport enums from './enums';\nimport { Plane } from './plane';\nimport { AABB } from './aabb';\n\nconst _v = new Array(8);\n_v[0] = new Vec3(1, 1, 1);\n_v[1] = new Vec3(-1, 1, 1);\n_v[2] = new Vec3(-1, -1, 1);\n_v[3] = new Vec3(1, -1, 1);\n_v[4] = new Vec3(1, 1, -1);\n_v[5] = new Vec3(-1, 1, -1);\n_v[6] = new Vec3(-1, -1, -1);\n_v[7] = new Vec3(1, -1, -1);\n\nconst _nearTemp = new Vec3();\nconst _farTemp = new Vec3();\nconst _temp_v3 = new Vec3();\n\n/**\n * @en\n * Basic Geometry: frustum.\n * @zh\n * 基础几何 截头锥体。\n */\n\nexport class Frustum {\n    /**\n     * @en\n     * Create an orthogonal frustum.\n     * @zh\n     * 创建一个正交视锥体。\n     * @param out @en The result orthogonal frustum. @zh 输出的正交视锥体。\n     * @param width @en The width of the frustum. @zh 正交视锥体的宽度。\n     * @param height @en The height of the frustum. @zh 正交视锥体的高度。\n     * @param near @en The near plane of the frustum. @zh 正交视锥体的近平面值。\n     * @param far @en The far plane of the frustum. @zh 正交视锥体的远平面值。\n     * @param transform @en The transform matrix of the frustum. @zh 正交视锥体的变换矩阵。\n     * @return @en The out object @zh 返回正交视锥体.\n     */\n    public static createOrtho = (() => (out: Frustum, width: number, height: number, near: number, far: number, transform: Mat4) => {\n        const halfWidth = width / 2;\n        const halfHeight = height / 2;\n        Vec3.set(_temp_v3, halfWidth, halfHeight, -near);\n        Vec3.transformMat4(out.vertices[0], _temp_v3, transform);\n        Vec3.set(_temp_v3, -halfWidth, halfHeight, -near);\n        Vec3.transformMat4(out.vertices[1], _temp_v3, transform);\n        Vec3.set(_temp_v3, -halfWidth, -halfHeight, -near);\n        Vec3.transformMat4(out.vertices[2], _temp_v3, transform);\n        Vec3.set(_temp_v3, halfWidth, -halfHeight, -near);\n        Vec3.transformMat4(out.vertices[3], _temp_v3, transform);\n        Vec3.set(_temp_v3, halfWidth, halfHeight, -far);\n        Vec3.transformMat4(out.vertices[4], _temp_v3, transform);\n        Vec3.set(_temp_v3, -halfWidth, halfHeight, -far);\n        Vec3.transformMat4(out.vertices[5], _temp_v3, transform);\n        Vec3.set(_temp_v3, -halfWidth, -halfHeight, -far);\n        Vec3.transformMat4(out.vertices[6], _temp_v3, transform);\n        Vec3.set(_temp_v3, halfWidth, -halfHeight, -far);\n        Vec3.transformMat4(out.vertices[7], _temp_v3, transform);\n\n        Plane.fromPoints(out.planes[0], out.vertices[1], out.vertices[6], out.vertices[5]);\n        Plane.fromPoints(out.planes[1], out.vertices[3], out.vertices[4], out.vertices[7]);\n        Plane.fromPoints(out.planes[2], out.vertices[6], out.vertices[3], out.vertices[7]);\n        Plane.fromPoints(out.planes[3], out.vertices[0], out.vertices[5], out.vertices[4]);\n        Plane.fromPoints(out.planes[4], out.vertices[2], out.vertices[0], out.vertices[3]);\n        Plane.fromPoints(out.planes[5], out.vertices[7], out.vertices[5], out.vertices[6]);\n    })();\n\n    /**\n     * @en Create a frustum from an AABB box.\n     * @zh 从 AABB 包围盒中创建一个视锥体。\n     * @param out @en The result frustum @zh 输出的视锥体对象。\n     * @param aabb @en The AABB bounding box of the frustum @zh AABB 包围盒。\n     * @return @en The out object @zh 返回视锥体.\n     */\n    public static createFromAABB (out: Frustum, aabb: AABB | Readonly<AABB>) : Frustum {\n        const vec3_min = new Vec3(); const vec3_max = new Vec3();\n        Vec3.subtract(vec3_min, aabb.center, aabb.halfExtents);\n        Vec3.add(vec3_max, aabb.center, aabb.halfExtents);\n\n        out.vertices[0].set(vec3_min.x, vec3_max.y, vec3_min.z);\n        out.vertices[1].set(vec3_max.x, vec3_max.y, vec3_min.z);\n        out.vertices[2].set(vec3_max.x, vec3_min.y, vec3_min.z);\n        out.vertices[3].set(vec3_min.x, vec3_min.y, vec3_min.z);\n        out.vertices[4].set(vec3_min.x, vec3_max.y, vec3_max.z);\n        out.vertices[5].set(vec3_max.x, vec3_max.y, vec3_max.z);\n        out.vertices[6].set(vec3_max.x, vec3_min.y, vec3_max.z);\n        out.vertices[7].set(vec3_min.x, vec3_min.y, vec3_max.z);\n\n        if (out._type !== enums.SHAPE_FRUSTUM_ACCURATE) {\n            return out;\n        }\n\n        out.updatePlanes();\n\n        return out;\n    }\n\n    /**\n     * @en Calculate the splitted frustum.\n     * @zh 创建一个新的截锥体。\n     * @param out @en The output frustum @zh 输出的新截锥体\n     * @param camera @en The camera of the frustum @zh 相机参数\n     * @param m @en The transform matrix @zh 变换矩阵\n     * @param start @en The split start position @zh 分割开始位置\n     * @param end @en The split end position @zh 分割末尾位置\n     * @return @en The out object @zh 返回新截锥体.\n     */\n    public static split (out: Frustum, camera: Camera, m: Mat4, start: number, end: number): Frustum {\n        // 0: cameraNear  1:cameraFar\n        const h = Math.tan(camera.fov * 0.5);\n        const w = h * camera.aspect;\n        _nearTemp.set(start * w,  start * h, start);\n        _farTemp.set(end * w, end * h, end);\n\n        const vertexes = out.vertices;\n        // startHalfWidth startHalfHeight\n        _temp_v3.set(_nearTemp.x, _nearTemp.y, _nearTemp.z);\n        Vec3.transformMat4(vertexes[0], _temp_v3, m);\n        _temp_v3.set(-_nearTemp.x, _nearTemp.y, _nearTemp.z);\n        Vec3.transformMat4(vertexes[1], _temp_v3, m);\n        _temp_v3.set(-_nearTemp.x, -_nearTemp.y, _nearTemp.z);\n        Vec3.transformMat4(vertexes[2], _temp_v3, m);\n        _temp_v3.set(_nearTemp.x, -_nearTemp.y, _nearTemp.z);\n        Vec3.transformMat4(vertexes[3], _temp_v3, m);\n\n        // endHalfWidth, endHalfHeight\n        _temp_v3.set(_farTemp.x, _farTemp.y, _farTemp.z);\n        Vec3.transformMat4(vertexes[4], _temp_v3, m);\n        _temp_v3.set(-_farTemp.x, _farTemp.y, _farTemp.z);\n        Vec3.transformMat4(vertexes[5], _temp_v3, m);\n        _temp_v3.set(-_farTemp.x, -_farTemp.y, _farTemp.z);\n        Vec3.transformMat4(vertexes[6], _temp_v3, m);\n        _temp_v3.set(_farTemp.x, -_farTemp.y, _farTemp.z);\n        Vec3.transformMat4(vertexes[7], _temp_v3, m);\n\n        out.updatePlanes();\n        return out;\n    }\n\n    /**\n     * @en\n     * Create a new frustum.\n     * @zh\n     * 创建一个新的截锥体。\n     * @return @en An empty frustum. @zh 一个空截椎体\n     */\n    public static create (): Frustum {\n        return new Frustum();\n    }\n\n    /**\n     * @en\n     * Clone a frustum.\n     * @zh\n     * 克隆一个截锥体。\n     * @param f @en The frustum to clone from @zh 用于克隆的截锥体\n     * @return @en The cloned frustum @zh 克隆出的新截锥体\n     */\n    public static clone (f: Frustum): Frustum {\n        return Frustum.copy(new Frustum(), f);\n    }\n\n    /**\n     * @en\n     * Copy the values from one frustum to another.\n     * @zh\n     * 从一个视锥体拷贝到另一个视锥体。\n     * @param out @en The result frustum @zh 用于存储拷贝数据的截锥体\n     * @param f @en The frustum to copy from @zh 用于克隆的截锥体\n     * @return @en The out object @zh 传入的 out 对象\n     */\n    public static copy (out: Frustum, f: Readonly<Frustum>): Frustum {\n        out._type = f.type;\n        for (let i = 0; i < 6; ++i) {\n            Plane.copy(out.planes[i], f.planes[i]);\n        }\n        for (let i = 0; i < 8; ++i) {\n            Vec3.copy(out.vertices[i], f.vertices[i]);\n        }\n        return out;\n    }\n\n    /**\n     * @en\n     * Set whether to use accurate intersection testing function on this frustum.\n     * @zh\n     * 设置是否在此截锥体上使用精确的相交测试函数。\n     */\n    set accurate (b: boolean) {\n        this._type = b ? enums.SHAPE_FRUSTUM_ACCURATE : enums.SHAPE_FRUSTUM;\n    }\n\n    /**\n     * @en\n     * Gets the type of the shape.\n     * @zh\n     * 获取形状的类型。\n     * @readonly\n     */\n    get type () {\n        return this._type;\n    }\n\n    public planes: Plane[];\n    public vertices: Vec3[];\n\n    protected _type: number;\n\n    constructor () {\n        this._type = enums.SHAPE_FRUSTUM;\n        this.planes = new Array(6);\n        for (let i = 0; i < 6; ++i) {\n            this.planes[i] = Plane.create(0, 0, 0, 0);\n        }\n        this.vertices = new Array(8);\n        for (let i = 0; i < 8; ++i) {\n            this.vertices[i] = new Vec3();\n        }\n    }\n\n    /**\n     * @en\n     * Update the frustum information according to the given transform matrix.\n     * Note that the resulting planes are not normalized under normal mode.\n     * @zh\n     * 根据给定的变换矩阵更新截锥体信息，注意得到的平面不是在标准模式下归一化的。\n     * @param m @en The view-projection matrix @zh 视图投影矩阵\n     * @param inv @en The inverse view-projection matrix @zh 视图投影逆矩阵\n     */\n    public update (m: Mat4, inv: Mat4) {\n        // RTR4, ch. 22.14.1, p. 983\n        // extract frustum planes from view-proj matrix.\n\n        // left plane\n        Vec3.set(this.planes[0].n, m.m03 + m.m00, m.m07 + m.m04, m.m11 + m.m08);\n        this.planes[0].d = -(m.m15 + m.m12);\n        // right plane\n        Vec3.set(this.planes[1].n, m.m03 - m.m00, m.m07 - m.m04, m.m11 - m.m08);\n        this.planes[1].d = -(m.m15 - m.m12);\n        // bottom plane\n        Vec3.set(this.planes[2].n, m.m03 + m.m01, m.m07 + m.m05, m.m11 + m.m09);\n        this.planes[2].d = -(m.m15 + m.m13);\n        // top plane\n        Vec3.set(this.planes[3].n, m.m03 - m.m01, m.m07 - m.m05, m.m11 - m.m09);\n        this.planes[3].d = -(m.m15 - m.m13);\n        // near plane\n        Vec3.set(this.planes[4].n, m.m03 + m.m02, m.m07 + m.m06, m.m11 + m.m10);\n        this.planes[4].d = -(m.m15 + m.m14);\n        // far plane\n        Vec3.set(this.planes[5].n, m.m03 - m.m02, m.m07 - m.m06, m.m11 - m.m10);\n        this.planes[5].d = -(m.m15 - m.m14);\n\n        if (this._type !== enums.SHAPE_FRUSTUM_ACCURATE) { return; }\n\n        // normalize planes\n        for (let i = 0; i < 6; i++) {\n            const pl = this.planes[i];\n            const invDist = 1 / pl.n.length();\n            Vec3.multiplyScalar(pl.n, pl.n, invDist);\n            pl.d *= invDist;\n        }\n\n        // update frustum vertices\n        for (let i = 0; i < 8; i++) {\n            Vec3.transformMat4(this.vertices[i], _v[i], inv);\n        }\n    }\n\n    /**\n     * @en\n     * Transform this frustum.\n     * @zh\n     * 变换此视锥体。\n     * @param mat @en The transform matrix @zh 变换矩阵\n     */\n    public transform (mat: Mat4) {\n        if (this._type !== enums.SHAPE_FRUSTUM_ACCURATE) {\n            return;\n        }\n        for (let i = 0; i < 8; i++) {\n            Vec3.transformMat4(this.vertices[i], this.vertices[i], mat);\n        }\n        this.updatePlanes();\n    }\n\n    /**\n     * @en Initialize the frustum\n     * @zh 初始化视锥体\n     */\n    public zero () {\n        for (let i = 0; i < 8; i++) {\n            this.vertices[i].set(0.0, 0.0, 0.0);\n        }\n        this.updatePlanes();\n    }\n\n    /**\n     * @en Update all six planes of the frustum\n     * @zh 更新视锥体的所有面数据\n     */\n    public updatePlanes () {\n        // left plane\n        Plane.fromPoints(this.planes[0], this.vertices[1], this.vertices[6], this.vertices[5]);\n        // right plane\n        Plane.fromPoints(this.planes[1], this.vertices[3], this.vertices[4], this.vertices[7]);\n        // bottom plane\n        Plane.fromPoints(this.planes[2], this.vertices[6], this.vertices[3], this.vertices[7]);\n        // top plane\n        Plane.fromPoints(this.planes[3], this.vertices[0], this.vertices[5], this.vertices[4]);\n        // near plane\n        Plane.fromPoints(this.planes[4], this.vertices[2], this.vertices[0], this.vertices[3]);\n        // far plane\n        Plane.fromPoints(this.planes[5], this.vertices[7], this.vertices[5], this.vertices[6]);\n    }\n}\n","/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n * Searches the **sorted** number array for an element and returns the index of that element.\r\n * @param array The array to search in.\r\n * @param value The value to search.\r\n * @return The index of the searched element in the sorted array, if one is found;\r\n * otherwise, a negative number that is the bitwise complement of the index of the next element that is large than the searched value or,\r\n * if there is no larger element(include the case that the array is empty), the bitwise complement of array's length.\r\n */\r\nexport function binarySearch (array: number[], value: number) {\r\n    return binarySearchEpsilon(array, value, 0);\r\n}\r\n\r\n/**\r\n * Searches the **sorted** number array for an element and returns the index of that element.\r\n * @param array The array to search in.\r\n * @param value The value to search.\r\n * @param EPSILON The epsilon to compare the numbers. Default to `1e-6`.\r\n * @return The index of the searched element in the sorted array, if one is found;\r\n * otherwise, a negative number that is the bitwise complement of the index of the next element that is large than the searched value or,\r\n * if there is no larger element(include the case that the array is empty), the bitwise complement of array's length.\r\n */\r\nexport function binarySearchEpsilon (array: Readonly<ArrayLike<number>>, value: number, EPSILON = 1e-6) {\r\n    let low = 0;\r\n    let high = array.length - 1;\r\n    let middle = high >>> 1;\r\n    for (; low <= high; middle = (low + high) >>> 1) {\r\n        const test = array[middle];\r\n        if (test > (value + EPSILON)) {\r\n            high = middle - 1;\r\n        } else if (test < (value - EPSILON)) {\r\n            low = middle + 1;\r\n        } else {\r\n            return middle;\r\n        }\r\n    }\r\n    return ~low;\r\n}\r\n\r\n/**\r\n * Searches the **sorted** array for an element and returns the index of that element.\r\n * @param array The array to search in.\r\n * @param value The value to search.\r\n * @param lessThan The predicate which implements the less than semantic.\r\n * @return The index of the searched element in the sorted array, if one is found;\r\n * otherwise, a negative number that is the bitwise complement of the index of the next element that is large than the searched value or,\r\n * if there is no larger element(include the case that the array is empty), the bitwise complement of array's length.\r\n */\r\nexport function binarySearchBy<T, U> (array: T[], value: U, lessThan: (lhs: T, rhs: U) => number) {\r\n    let low = 0;\r\n    let high = array.length - 1;\r\n    let middle = high >>> 1;\r\n    for (; low <= high; middle = (low + high) >>> 1) {\r\n        const test = array[middle];\r\n        if (lessThan(test, value) < 0) {\r\n            high = middle - 1;\r\n        } else if (lessThan(test, value) > 0) {\r\n            low = middle + 1;\r\n        } else {\r\n            return middle;\r\n        }\r\n    }\r\n    return ~low;\r\n}\r\n","import { binarySearchEpsilon } from '../algorithm/binary-search';\nimport { CCClass } from '../data/class';\nimport { ccclass, serializable } from '../data/decorators';\nimport { assertIsTrue } from '../data/utils/asserts';\nimport { approx } from '../math';\nimport type { CurveBase } from './curve-base';\n\ntype KeyFrame<TKeyframeValue> = [number, TKeyframeValue];\n\n/**\n * @en\n * Keyframe curve.\n * @zh\n * 关键帧曲线。\n */\nexport class KeyframeCurve<TKeyframeValue> implements CurveBase, Iterable<KeyFrame<TKeyframeValue>> {\n    /**\n     * @en\n     * Gets the count of keyframes.\n     * @zh\n     * 获取关键帧数量。\n     */\n    get keyFramesCount () {\n        return this._times.length;\n    }\n\n    /**\n     * @en\n     * Gets the minimal keyframe time on this curve.\n     * @zh\n     * 获取此曲线上最小的关键帧时间。\n     */\n    get rangeMin () {\n        return this._times[0];\n    }\n\n    /**\n     * @en\n     * Gets the maximum keyframe time on this curve.\n     * @zh\n     * 获取此曲线上最大的关键帧时间。\n     */\n    get rangeMax () {\n        return this._times[this._values.length - 1];\n    }\n\n    /**\n     * @en\n     * Returns an iterator to keyframe pairs.\n     * @zh\n     * 返回关键帧对的迭代器。\n     */\n    [Symbol.iterator] () {\n        let index = 0;\n        return {\n            next: (): IteratorResult<KeyFrame<TKeyframeValue>> => {\n                if (index >= this._times.length) {\n                    return {\n                        done: true,\n                        value: undefined,\n                    };\n                } else {\n                    const value: KeyFrame<TKeyframeValue> = [this._times[index], this._values[index]];\n                    ++index;\n                    return {\n                        done: false,\n                        value,\n                    };\n                }\n            },\n        };\n    }\n\n    /**\n     * @en\n     * Returns an iterator to keyframe pairs.\n     * @zh\n     * 返回关键帧对的迭代器。\n     */\n    public keyframes (): Iterable<KeyFrame<TKeyframeValue>> {\n        return this;\n    }\n\n    /**\n     * @en\n     * Returns an iterator to keyframe times.\n     * @zh\n     * 返回关键帧时间的迭代器。\n     */\n    public times (): Iterable<number> {\n        return this._times;\n    }\n\n    /**\n     * @en\n     * Returns an iterator to keyframe values.\n     * @zh\n     * 返回关键帧值的迭代器。\n     */\n    public values (): Iterable<TKeyframeValue> {\n        return this._values;\n    }\n\n    /**\n     * @en\n     * Gets the time of specified keyframe.\n     * @zh\n     * 获取指定关键帧上的时间。\n     * @param index Index to the keyframe.\n     * @returns The keyframe 's time.\n     */\n    public getKeyframeTime (index: number): number {\n        return this._times[index];\n    }\n\n    /**\n     * @en\n     * Gets the value of specified keyframe.\n     * @zh\n     * 获取指定关键帧上的值。\n     * @param index Index to the keyframe.\n     * @returns The keyframe 's value.\n     */\n    public getKeyframeValue (index: number): TKeyframeValue {\n        return this._values[index];\n    }\n\n    /**\n     * @en\n     * Adds a keyframe into this curve.\n     * @zh\n     * 添加一个关键帧到此曲线中。\n     * @param time Time of the keyframe.\n     * @param keyframeValue Value of the keyframe.\n     * @returns The index to the new keyframe.\n     */\n    public addKeyFrame (time: number, keyframeValue: TKeyframeValue): number {\n        return this._insertNewKeyframe(time, keyframeValue);\n    }\n\n    /**\n     * @en\n     * Removes a keyframe from this curve.\n     * @zh\n     * 移除此曲线的一个关键帧。\n     * @param index Index to the keyframe.\n     */\n    public removeKeyframe (index: number) {\n        this._times.splice(index, 1);\n        this._values.splice(index, 1);\n    }\n\n    /**\n     * @en\n     * Searches for the keyframe at specified time.\n     * @zh\n     * 搜索指定时间上的关键帧。\n     * @param time Time to search.\n     * @returns Index to the keyframe or negative number if not found.\n     */\n    public indexOfKeyframe (time: number) {\n        return binarySearchEpsilon(this._times, time);\n    }\n\n    /**\n     * @en\n     * Updates the time of a keyframe.\n     * @zh\n     * 更新关键帧的时间。\n     * @param index Index to the keyframe.\n     * @param time New time.\n     */\n    public updateTime (index: number, time: number) {\n        const value = this._values[index];\n        this.removeKeyframe(index);\n        this._insertNewKeyframe(time, value);\n    }\n\n    /**\n     * @en\n     * Assigns all keyframes.\n     * @zh\n     * 赋值所有关键帧。\n     * @param keyframes An iterable to keyframes. The keyframes should be sorted by their time.\n     */\n    public assignSorted (keyframes: Iterable<[number, TKeyframeValue]>): void;\n\n    /**\n     * @en\n     * Assigns all keyframes.\n     * @zh\n     * 赋值所有关键帧。\n     * @param times Times array. Should be sorted.\n     * @param values Values array. Corresponding to each time in `times`.\n     */\n    public assignSorted (times: readonly number[], values: TKeyframeValue[]): void;\n\n    public assignSorted (times: Iterable<[number, TKeyframeValue]> | readonly number[], values?: readonly TKeyframeValue[]) {\n        if (values !== undefined) {\n            assertIsTrue(Array.isArray(times));\n            this.setKeyframes(\n                times.slice(),\n                values.slice(),\n            );\n        } else {\n            const keyframes = Array.from(times as Iterable<[number, TKeyframeValue]>);\n            this.setKeyframes(\n                keyframes.map(([time]) => time),\n                keyframes.map(([, value]) => value),\n            );\n        }\n    }\n\n    /**\n     * @en\n     * Removes all key frames.\n     * @zh\n     * 移除所有关键帧。\n     */\n    public clear () {\n        this._times.length = 0;\n        this._values.length = 0;\n    }\n\n    protected searchKeyframe (time: number) {\n        return binarySearchEpsilon(this._times, time);\n    }\n\n    protected setKeyframes (times: number[], values: TKeyframeValue[]) {\n        assertIsTrue(times.length === values.length);\n        assertIsTrue(isSorted(times));\n        this._times = times;\n        this._values = values;\n    }\n\n    private _insertNewKeyframe (time: number, value: TKeyframeValue) {\n        const times = this._times;\n        const values = this._values;\n        const nFrames = times.length;\n\n        const index = binarySearchEpsilon(times, time);\n        if (index >= 0) {\n            return index;\n        }\n        const iNext = ~index;\n        if (iNext === 0) {\n            times.unshift(time);\n            values.unshift(value);\n        } else if (iNext === nFrames) {\n            times.push(time);\n            values.push(value);\n        } else {\n            assertIsTrue(nFrames > 1);\n            times.splice(iNext - 1, 0, time);\n            values.splice(iNext - 1, 0, value);\n        }\n        return iNext;\n    }\n\n    // Times are always sorted and 1-1 correspond to values.\n    protected _times: number[] = [];\n\n    protected _values: TKeyframeValue[] = [];\n}\n\nCCClass.fastDefine('cc.KeyframeCurve', KeyframeCurve, {\n    _times: [],\n    _values: [],\n});\n\nfunction isSorted (values: number[]) {\n    return values.every(\n        (value, index, array) => index === 0\n            || value > array[index - 1] || approx(value, array[index - 1], 1e-6),\n    );\n}\n","/**\n * @en\n * The method used for interpolation method between value of a keyframe and its next keyframe.\n * @zh\n * 在某关键帧（前一帧）和其下一帧之间插值时使用的插值方式。\n */\nexport enum RealInterpolationMode {\n    /**\n     * @en\n     * Perform linear interpolation between previous keyframe value and next keyframe value.\n     * @zh\n     * 在前一帧和后一帧之间执行线性插值。\n     */\n    LINEAR,\n\n    /**\n     * @en\n     * Always use the value from this keyframe.\n     * @zh\n     * 永远使用前一帧的值。\n     */\n    CONSTANT,\n\n    /**\n     * @en\n     * Perform cubic(hermite) interpolation between previous keyframe value and next keyframe value.\n     * @zh\n     * 在前一帧和后一帧之间执行立方插值。\n     */\n    CUBIC,\n}\n\n/**\n * @en\n * Specifies how to extrapolate the value\n * if input time is underflow(less than the the first frame time) or\n * overflow(greater than the last frame time) when evaluating an curve.\n * @zh\n * 在求值曲线时，指定当输入时间下溢（小于第一帧的时间）或上溢（大于最后一帧的时间）时应该如何推断结果值。\n */\nexport enum ExtrapolationMode {\n    /**\n     * @en\n     * Compute the result\n     * according to the first two frame's linear trend in the case of underflow and\n     * according to the last two frame's linear trend in the case of overflow.\n     * If there are less than two frames, fallback to `CLAMP`.\n     * @zh\n     * 下溢时，根据前两帧的线性趋势计算结果；上溢时，根据最后两帧的线性趋势计算结果。\n     * 如果曲线帧数小于 2，回退到  `CLAMP`。\n     */\n    LINEAR,\n\n    /**\n     * @en\n     * Use first frame's value in the case of underflow,\n     * use last frame's value in the case of overflow.\n     * @zh\n     * 下溢时，使用第一帧的值；上溢时，使用最后一帧的值。\n     */\n    CLAMP,\n\n    /**\n     * @en\n     * Computes the result as if the curve is infinitely and continuously looped.\n     * @zh\n     * 求值时将该曲线视作是无限连续循环的。\n     */\n    LOOP,\n\n    /**\n     * @en\n     * Computes the result as if the curve is infinitely and continuously looped in a ping-pong manner.\n     * @zh\n     * 求值时将该曲线视作是以“乒乓”的形式无限连续循环的。\n     */\n    PING_PONG,\n}\n\n/**\n * @en\n * Specifies both side tangent weight mode of a keyframe value.\n * @zh\n * 指定关键帧两侧的切线权重模式。\n */\nexport enum TangentWeightMode {\n    /**\n     * @en\n     * Neither side of the keyframe carries tangent weight information.\n     * @zh\n     * 关键帧的两侧都不携带切线权重信息。\n     */\n    NONE = 0,\n\n    /**\n     * @en\n     * Only left side of the keyframe carries tangent weight information.\n     * @zh\n     * 仅关键帧的左侧携带切线权重信息。\n     */\n    LEFT = 1,\n\n    /**\n     * @en\n     * Only right side of the keyframe carries tangent weight information.\n     * @zh\n     * 仅关键帧的右侧携带切线权重信息。\n     */\n    RIGHT = 2,\n\n    /**\n     * @en\n     * Both sides of the keyframe carries tangent weight information.\n     * @zh\n     * 关键帧的两侧都携带切线权重信息。\n     */\n    BOTH = 1 | 2,\n}\n","// cSpell:words Cardano's irreducibilis\r\n\r\n/**\r\n * Solve Cubic Equation using Cardano's formula.\r\n * The equation is formed from coeff0 + coeff1 * x + coeff2 * x^2 + coeff3 * x^3 = 0.\r\n * Modified from https://github.com/erich666/GraphicsGems/blob/master/gems/Roots3And4.c .\r\n */\r\nexport function solveCubic (coeff0: number, coeff1: number, coeff2: number, coeff3: number, solutions: [number, number, number]) {\r\n    // normal form: x^3 + Ax^2 + Bx + C = 0\r\n    const a = coeff2 / coeff3;\r\n    const b = coeff1 / coeff3;\r\n    const c = coeff0 / coeff3;\r\n\r\n    // substitute x = y - A/3 to eliminate quadric term:\r\n    // x^3 +px + q = 0\r\n    const sqrA = a * a;\r\n    const p = 1.0 / 3.0 * (-1.0 / 3 * sqrA + b);\r\n    const q = 1.0 / 2.0 * (2.0 / 27.0 * a * sqrA - 1.0 / 3 * a * b + c);\r\n\r\n    // use Cardano's formula\r\n    const cubicP = p * p * p;\r\n    const d = q * q + cubicP;\r\n\r\n    let nSolutions = 0;\r\n    if (isZero(d)) {\r\n        if (isZero(q)) { // one triple solution\r\n            solutions[0] = 0;\r\n            return 1;\r\n        } else { // one single and one double solution\r\n            const u = Math.cbrt(-q);\r\n            solutions[0] = 2 * u;\r\n            solutions[1] = -u;\r\n            return 2;\r\n        }\r\n    } else if (d < 0) { // Casus irreducibilis: three real solutions\r\n        const phi = 1.0 / 3 * Math.acos(-q / Math.sqrt(-cubicP));\r\n        const t = 2 * Math.sqrt(-p);\r\n\r\n        solutions[0] =   t * Math.cos(phi);\r\n        solutions[1] = -t * Math.cos(phi + Math.PI / 3);\r\n        solutions[2] = -t * Math.cos(phi - Math.PI / 3);\r\n        nSolutions = 3;\r\n    } else { // one real solution\r\n        const sqrtD = Math.sqrt(d);\r\n        const u = Math.cbrt(sqrtD - q);\r\n        const v = -Math.cbrt(sqrtD + q);\r\n        solutions[0] = u + v;\r\n        nSolutions = 1;\r\n    }\r\n\r\n    const sub = 1.0 / 3 * a;\r\n    for (let i = 0; i < nSolutions; ++i) {\r\n        solutions[i] -= sub;\r\n    }\r\n\r\n    return nSolutions;\r\n}\r\n\r\nconst EQN_EPS = 1e-9;\r\n\r\nfunction isZero (x: number) {\r\n    return x > -EQN_EPS && x < EQN_EPS;\r\n}\r\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV } from 'internal:constants';\nimport { CCClass } from '../class';\nimport { error } from '../../platform/debug';\nimport { js } from '../../utils/js';\n\nexport type BabelPropertyDecoratorDescriptor = PropertyDescriptor & { initializer?: any };\n\n/**\n * @en\n * The signature compatible with both TypeScript legacy decorator and Babel legacy decorator.\n * The `descriptor` argument will only appear in Babel case.\n * @zh\n * 该签名同时兼容 TypeScript legacy 装饰器以及 Babel legacy 装饰器。\n * `descriptor` 参数只会在 Babel 情况下出现。\n */\nexport type LegacyPropertyDecorator = (target: Object, propertyKey: string | symbol, descriptor?: BabelPropertyDecoratorDescriptor) => void;\n\n/**\n * @en\n * A class(or property) decorator which does nothing.\n * @zh\n * 一个什么也不做的类（或属性）装饰器。\n */\nexport const emptyDecorator: ClassDecorator & LegacyPropertyDecorator = () => {};\n\n/**\n * @en\n * A function which ignore all arguments and return the `emptyDecorator`.\n * @zh\n * 一个忽略所有参数并且返回 `emptyDecorator` 的函数。\n */\nexport const emptyDecoratorFn = () => emptyDecorator;\n\n/**\n * @en\n * Acts like `emptyDecorator` if called in form of `@x`;\n * acts like `emptyDecoratorFn` if called in form of `@x(...args)`.\n * @zh\n * 当以 `@x` 形式调用时表现如同 `emptyDecorator`，当以 `@x(...args)` 形式调用时表现如同 `emptyDecoratorFn`。\n */\nexport const emptySmartClassDecorator = makeSmartClassDecorator(() => {});\n\n/**\n * @en\n * Make a smart class decorator which can properly handle the following form decorator syntax:\n * - `@x`\n * - `@x(arg0)`\n *\n * and forward both the decorated class and the `arg0` (in first form, `arg0` is forward as `undefined`) to\n * `decorate`.\n * @zh\n * 创建一个智能类装饰器，它能正确地处理以下形式的装饰器语法：\n * - `@x`\n * - `@x(arg0)`\n *\n * 并且，将被装饰的类和 `arg0`（若是第一种形式，`arg0` 就是 `undefined`）一起转发给 `decorate`。\n * @param decorate\n */\nexport function makeSmartClassDecorator<TArg> (\n    decorate: <TFunction extends Function>(constructor: TFunction, arg?: TArg) => ReturnType<ClassDecorator>,\n): ClassDecorator & ((arg?: TArg) => ClassDecorator) {\n    return proxyFn;\n    function proxyFn(...args: Parameters<ClassDecorator>): ReturnType<ClassDecorator>;\n    function proxyFn(arg?: TArg): ClassDecorator;\n    function proxyFn (target?: Parameters<ClassDecorator>[0] | TArg): ReturnType<ClassDecorator> {\n        if (typeof target === 'function') {\n            // If no parameter specified\n            return decorate(target);\n        } else {\n            return function <TFunction extends Function> (constructor: TFunction) {\n                return decorate(constructor, target);\n            };\n        }\n    }\n}\n\nfunction writeEditorClassProperty<TValue> (constructor: Function, propertyName: string, value: TValue) {\n    const cache = getClassCache(constructor, propertyName);\n    if (cache) {\n        const proto = getSubDict(cache, 'proto');\n        getSubDict(proto, 'editor')[propertyName] = value;\n    }\n}\n\n/**\n * @en\n * Make a function which accept an argument value and return a class decorator.\n * The decorator sets the editor property `propertyName`, on the decorated class, into that argument value.\n * @zh\n * 创建一个函数，该函数接受一个参数值并返回一个类装饰器。\n * 该装饰器将被装饰类的编辑器属性 `propertyName` 设置为该参数的值。\n * @param propertyName The editor property.\n */\nexport function makeEditorClassDecoratorFn<TValue> (propertyName: string): (value: TValue) => ClassDecorator {\n    return (value: TValue) => <TFunction extends Function>(constructor: TFunction) => {\n        writeEditorClassProperty(constructor, propertyName, value);\n    };\n}\n\n/**\n * Make a smart class decorator.\n * The smart decorator sets the editor property `propertyName`, on the decorated class, into:\n * - `defaultValue` if the decorator is called with `@x` form, or\n * - the argument if the decorator is called with an argument, eg, the `@x(arg0)` form.\n * @zh\n * 创建一个智能类装饰器。\n * 该智能类装饰器将根据以下情况来设置被装饰类的编辑器属性 `propertyName`：\n * - 如果该装饰器是以 `@x` 形式调用的，该属性将被设置为 `defaultValue`。\n * - 如果该装饰器是以一个参数的形式，即 `@x(arg0)` 的形式调用的，该属性将被设置为传入的参数值。\n * @param propertyName The editor property.\n */\nexport function makeSmartEditorClassDecorator<TValue> (propertyName: string, defaultValue: TValue) {\n    return makeSmartClassDecorator<TValue>((constructor, decoratedValue?: TValue) => {\n        writeEditorClassProperty(constructor, propertyName, (defaultValue !== undefined) ? defaultValue : decoratedValue);\n    });\n}\n\n// caches for class construction\nexport const CACHE_KEY = '__ccclassCache__';\n\nexport function getClassCache (ctor, decoratorName?) {\n    if (DEV && CCClass._isCCClass(ctor)) {\n        error('`@%s` should be used after @ccclass for class \"%s\"', decoratorName, js.getClassName(ctor));\n        return null;\n    }\n    return getSubDict(ctor, CACHE_KEY);\n}\n\nexport function getSubDict<T, TKey extends keyof T> (obj: T, key: TKey): NonNullable<T[TKey]> {\n    // @ts-expect-error I don't know how to fix it.\n    return obj[key] || (obj[key] = {});\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV } from 'internal:constants';\nimport { js } from '../../utils/js';\nimport { CCClass } from '../class';\nimport { doValidateMethodWithProps_DEV } from '../utils/preprocess-class';\nimport { CACHE_KEY, makeSmartClassDecorator } from './utils';\n\n/**\n * @en Declare a standard class as a CCClass, please refer to the [document](https://docs.cocos.com/creator3d/manual/en/scripting/ccclass.html)\n * @zh 将标准写法的类声明为 CC 类，具体用法请参阅[类型定义](https://docs.cocos.com/creator3d/manual/zh/scripting/ccclass.html)。\n * @param name - The class name used for serialization.\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass} = _decorator;\n *\n * // define a CCClass, omit the name\n *  @ccclass\n * class NewScript extends Component {\n *     // ...\n * }\n *\n * // define a CCClass with a name\n *  @ccclass('LoginData')\n * class LoginData {\n *     // ...\n * }\n * ```\n */\nexport const ccclass: ((name?: string) => ClassDecorator) & ClassDecorator = makeSmartClassDecorator<string>((constructor, name) => {\n    let base = js.getSuper(constructor);\n    if (base === Object) {\n        base = null;\n    }\n\n    const proto = {\n        name,\n        extends: base,\n        ctor: constructor,\n    };\n    const cache = constructor[CACHE_KEY];\n    if (cache) {\n        const decoratedProto = cache.proto;\n        if (decoratedProto) {\n            // decoratedProto.properties = createProperties(ctor, decoratedProto.properties);\n            js.mixin(proto, decoratedProto);\n        }\n        constructor[CACHE_KEY] = undefined;\n    }\n\n    const res = CCClass(proto);\n\n    // validate methods\n    if (DEV) {\n        const propNames = Object.getOwnPropertyNames(constructor.prototype);\n        for (let i = 0; i < propNames.length; ++i) {\n            const prop = propNames[i];\n            if (prop !== 'constructor') {\n                const desc = Object.getOwnPropertyDescriptor(constructor.prototype, prop);\n                const func = desc && desc.value;\n                if (typeof func === 'function') {\n                    doValidateMethodWithProps_DEV(func, prop, js.getClassName(constructor), constructor, base);\n                }\n            }\n        }\n    }\n\n    return res;\n});\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV } from 'internal:constants';\nimport { CCClass } from '../class';\nimport { makeEditorClassDecoratorFn, makeSmartEditorClassDecorator, emptySmartClassDecorator } from './utils';\n\n/**\n * @en Declare that the current component relies on another type of component.\n * If the required component doesn't exist, the engine will create a new empty instance of the required component and add to the node.\n * @zh 为声明为 CCClass 的组件添加依赖的其它组件。当组件添加到节点上时，如果依赖的组件不存在，引擎将会自动将依赖组件添加到同一个节点，防止脚本出错。该设置在运行时同样有效。\n * @param requiredComponent The required component type\n * @example\n * ```ts\n * import {_decorator, Sprite, Component} from cc;\n * import {ccclass, requireComponent} from _decorator;\n *\n * @ccclass\n * @requireComponent(Sprite)\n * class SpriteCtrl extends Component {\n *     // ...\n * }\n * ```\n */\nexport const requireComponent: (requiredComponent: Function | Function[]) => ClassDecorator = makeEditorClassDecoratorFn('requireComponent');\n\n/**\n * @en Set the component priority, it decides at which order the life cycle functions of components will be invoked. Smaller priority get invoked before larger priority.\n * This will affect `onLoad`, `onEnable`, `start`, `update` and `lateUpdate`, but `onDisable` and `onDestroy` won't be affected.\n * @zh 设置脚本生命周期方法调用的优先级。优先级小于 0 的组件将会优先执行，优先级大于 0 的组件将会延后执行。优先级仅会影响 onLoad, onEnable, start, update 和 lateUpdate，而 onDisable 和 onDestroy 不受影响。\n * @param priority - The execution order of life cycle methods for Component. Smaller priority get invoked before larger priority.\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, executionOrder} = _decorator;\n *\n * @ccclass\n * @executionOrder(1)\n * class CameraCtrl extends Component {\n *     // ...\n * }\n * ```\n */\nexport const executionOrder: (priority: number) => ClassDecorator = makeEditorClassDecoratorFn('executionOrder');\n\n/**\n * @en Forbid add multiple instances of the component to the same node.\n * @zh 防止多个相同类型（或子类型）的组件被添加到同一个节点。\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, disallowMultiple} = _decorator;\n *\n * @ccclass\n * @disallowMultiple\n * class CameraCtrl extends Component {\n *     // ...\n * }\n * ```\n */\nexport const disallowMultiple: ClassDecorator & ((yes?: boolean) => ClassDecorator) =    DEV ? makeSmartEditorClassDecorator('disallowMultiple', true) : emptySmartClassDecorator;\n\nexport const allowReplicated: ClassDecorator = (ctor) => {\n    CCClass.Attr.setClassAttr(ctor, 'replicated', 'visible', true);\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV, EDITOR, JSB, TEST } from 'internal:constants';\nimport { CCString, CCInteger, CCFloat, CCBoolean } from '../utils/attribute';\nimport { IExposedAttributes } from '../utils/attribute-defines';\nimport { LegacyPropertyDecorator, getSubDict, getClassCache, BabelPropertyDecoratorDescriptor } from './utils';\nimport { warnID, errorID } from '../../platform/debug';\nimport { js } from '../../utils/js';\nimport { getFullFormOfProperty } from '../utils/preprocess-class';\nimport { ClassStash, PropertyStash, PropertyStashInternalFlag } from '../class-stash';\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type SimplePropertyType = Function | string | typeof CCString | typeof CCInteger | typeof CCFloat | typeof CCBoolean;\n\nexport type PropertyType = SimplePropertyType | SimplePropertyType[];\n\n/**\n * @zh CCClass 属性选项。\n * @en CCClass property options\n */\nexport type IPropertyOptions = IExposedAttributes\n\n/**\n * @en Declare as a CCClass property with options\n * @zh 声明属性为 CCClass 属性。\n * @param options property options\n */\nexport function property (options?: IPropertyOptions): LegacyPropertyDecorator;\n\n/**\n * @en Declare as a CCClass property with the property type\n * @zh 标注属性为 cc 属性。<br/>\n * 等价于`@property({type})`。\n * @param type A [[ccclass]] type or a [[ValueType]]\n */\nexport function property (type: PropertyType): LegacyPropertyDecorator;\n\n/**\n * @en Declare as a CCClass property\n * @zh 标注属性为 cc 属性。<br/>\n * 等价于`@property()`。\n */\nexport function property (...args: Parameters<LegacyPropertyDecorator>): void;\n\nexport function property (\n    target?: Parameters<LegacyPropertyDecorator>[0],\n    propertyKey?: Parameters<LegacyPropertyDecorator>[1],\n    descriptor?: Parameters<LegacyPropertyDecorator>[2],\n) {\n    let options: IPropertyOptions | PropertyType | null = null;\n    function normalized (\n        target: Parameters<LegacyPropertyDecorator>[0],\n        propertyKey: Parameters<LegacyPropertyDecorator>[1],\n        descriptor: Parameters<LegacyPropertyDecorator>[2],\n    ) {\n        const classStash = getOrCreateClassStash(target);\n        const propertyStash = getOrCreateEmptyPropertyStash(\n            target,\n            propertyKey,\n        );\n        const classConstructor = target.constructor;\n        mergePropertyOptions(\n            classStash,\n            propertyStash,\n            classConstructor,\n            propertyKey,\n            options,\n            descriptor,\n        );\n    }\n\n    if (target === undefined) {\n        // @property() => LegacyPropertyDecorator\n        return property({\n            type: undefined,\n        });\n    } else if (typeof propertyKey === 'undefined') {\n        // @property(options) => LegacyPropertyDescriptor\n        // @property(type) => LegacyPropertyDescriptor\n        options = target;\n        return normalized;\n    } else {\n        // @property\n        normalized(target, propertyKey, descriptor);\n        return undefined;\n    }\n}\n\nfunction getDefaultFromInitializer (initializer: () => unknown) {\n    let value: unknown;\n    try {\n        value = initializer();\n    } catch (e) {\n        // just lazy initialize by CCClass\n        return initializer;\n    }\n    if (typeof value !== 'object' || value === null) {\n        // string boolean number function undefined null\n        return value;\n    } else {\n        // The default attribute will not be used in ES6 constructor actually,\n        // so we don't need to simplify into `{}` or `[]` or vec2 completely.\n        return initializer;\n    }\n}\n\nfunction extractActualDefaultValues (classConstructor: new () => unknown) {\n    let dummyObj: unknown;\n    try {\n        // eslint-disable-next-line new-cap\n        dummyObj = new classConstructor();\n    } catch (e) {\n        if (DEV) {\n            warnID(3652, js.getClassName(classConstructor), e);\n        }\n        return {};\n    }\n    return dummyObj;\n}\n\nfunction getOrCreateClassStash (target: Parameters<LegacyPropertyDecorator>[0]): ClassStash {\n    const cache = getClassCache(target.constructor) as ClassStash;\n    return cache;\n}\n\nfunction getOrCreateEmptyPropertyStash (\n    target: Parameters<LegacyPropertyDecorator>[0],\n    propertyKey: Parameters<LegacyPropertyDecorator>[1],\n): PropertyStash {\n    const classStash = getClassCache(target.constructor) as ClassStash;\n    const ccclassProto = getSubDict(classStash, 'proto');\n    const properties = getSubDict(ccclassProto, 'properties');\n    const propertyStash = properties[(propertyKey as string)] ??= {} as PropertyStash;\n    return propertyStash;\n}\n\nexport function getOrCreatePropertyStash (\n    target: Parameters<LegacyPropertyDecorator>[0],\n    propertyKey: Parameters<LegacyPropertyDecorator>[1],\n    descriptor?: BabelPropertyDecoratorDescriptor,\n): PropertyStash {\n    const classStash = getClassCache(target.constructor) as ClassStash;\n    const ccclassProto = getSubDict(classStash, 'proto');\n    const properties = getSubDict(ccclassProto, 'properties');\n    const propertyStash = properties[(propertyKey as string)] ??= {} as PropertyStash;\n    propertyStash.__internalFlags |= PropertyStashInternalFlag.STANDALONE;\n    if (descriptor && (descriptor.get || descriptor.set)) {\n        if (descriptor.get) {\n            propertyStash.get = descriptor.get;\n        }\n        if (descriptor.set) {\n            propertyStash.set = descriptor.set;\n        }\n    } else {\n        setDefaultValue(\n            classStash,\n            propertyStash,\n            target.constructor as new () => unknown,\n            propertyKey,\n            descriptor,\n        );\n    }\n    return propertyStash;\n}\n\nfunction mergePropertyOptions (\n    cache: ClassStash,\n    propertyStash: PropertyStash,\n    ctor,\n    propertyKey: Parameters<LegacyPropertyDecorator>[1],\n    options,\n    descriptor: Parameters<LegacyPropertyDecorator>[2] | undefined,\n) {\n    let fullOptions;\n    const isGetset = descriptor && (descriptor.get || descriptor.set);\n    if (options) {\n        fullOptions = getFullFormOfProperty(options, isGetset);\n    }\n    // @ts-expect-error enum PropertyStashInternalFlag is used as number\n    const propertyRecord: PropertyStash = js.mixin(propertyStash, fullOptions || options || {});\n\n    if (isGetset) {\n        // typescript or babel\n        if (DEV && options && ((fullOptions || options).get || (fullOptions || options).set)) {\n            const errorProps = getSubDict(cache, 'errorProps');\n            if (!errorProps[(propertyKey as string)]) {\n                errorProps[(propertyKey as string)] = true;\n                warnID(3655, propertyKey, js.getClassName(ctor), propertyKey, propertyKey);\n            }\n        }\n        if (descriptor!.get) {\n            propertyRecord.get = descriptor!.get;\n        }\n        if (descriptor!.set) {\n            propertyRecord.set = descriptor!.set;\n        }\n    } else { // Target property is non-accessor\n        if (DEV && (propertyRecord.get || propertyRecord.set)) {\n            // Specify \"accessor options\" for non-accessor property is forbidden.\n            errorID(3655, propertyKey, js.getClassName(ctor), propertyKey, propertyKey);\n            return;\n        }\n\n        setDefaultValue(\n            cache,\n            propertyRecord,\n            ctor,\n            propertyKey,\n            descriptor,\n        );\n\n        if ((EDITOR && !window.Build) || TEST) {\n            // eslint-disable-next-line no-prototype-builtins\n            if (!fullOptions && options && options.hasOwnProperty('default')) {\n                warnID(3653, propertyKey, js.getClassName(ctor));\n            }\n        }\n    }\n}\n\nfunction setDefaultValue<T> (\n    classStash: ClassStash,\n    propertyStash: PropertyStash,\n    classConstructor: new () => T,\n    propertyKey: PropertyKey,\n    descriptor: BabelPropertyDecoratorDescriptor | undefined,\n) {\n    // Default values are needed by editor, and now editor run with web version, so don't\n    // have to provide default values.\n    if (JSB) {\n        return;\n    }\n\n    if (descriptor) {\n        // In case of Babel, if an initializer is given for class field.\n        // That initializer is passed to `descriptor.initializer`.\n        // babel\n        if (descriptor.initializer) {\n            propertyStash.default = getDefaultFromInitializer(descriptor.initializer);\n        }\n    } else {\n        // In case of TypeScript, we can not directly capture the initializer.\n        // We have to be hacking to extract the value.\n        const actualDefaultValues = classStash.default || (classStash.default = extractActualDefaultValues(classConstructor));\n        // eslint-disable-next-line no-prototype-builtins\n        if ((actualDefaultValues as any).hasOwnProperty(propertyKey)) {\n            propertyStash.default = (actualDefaultValues as any)[propertyKey];\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, TEST } from 'internal:constants';\nimport { emptyDecorator, LegacyPropertyDecorator } from './utils';\nimport { getOrCreatePropertyStash } from './property';\nimport { PropertyStash, PropertyStashInternalFlag } from '../class-stash';\nimport { getOrCreateSerializationMetadata } from '../serialization-metadata';\n\n/**\n * True if serialization feature is enabled in current environment.\n */\nconst WITH_SERIALIZATION = EDITOR || TEST;\n\nexport const serializable: LegacyPropertyDecorator = (target, propertyKey, descriptor) => {\n    const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n    setImplicitSerializable(propertyStash);\n};\n\nexport function formerlySerializedAs (name: string): LegacyPropertyDecorator {\n    return (target, propertyKey, descriptor) => {\n        const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n        propertyStash.formerlySerializedAs = name;\n        setImplicitSerializable(propertyStash);\n    };\n}\n\n/**\n * @en\n * Marks the property as editor only.\n * @zh\n * 设置该属性仅在编辑器中生效。\n */\nexport const editorOnly: LegacyPropertyDecorator = (target, propertyKey, descriptor) => {\n    const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n    propertyStash.editorOnly = true;\n    setImplicitSerializable(propertyStash);\n};\n\nfunction setImplicitSerializable (propertyStash: PropertyStash) {\n    propertyStash.__internalFlags |= PropertyStashInternalFlag.IMPLICIT_SERIALIZABLE;\n}\n\n/**\n * @en\n * Marks the target class as \"uniquely referenced\" which means, in the aspect of serialization,\n * no more than one objects should reference to same instance of that class.\n * When serializing references to objects of such class,\n * they're treated as different object even they point to actually the same.\n * While deserializing, these two references would point two distinct objects.\n * For example:\n * ```ts\n * import { _decorator } from 'cc';\n * @_decorator.ccclass\n * @_decorator.uniquelyReferenced\n * class Foo { }\n *\n * @_decorator.ccclass\n * class Bar {\n *   @_decorator.property\n *   public foo = new Foo();\n * }\n *\n * const bar1 = new Bar();\n * const bar2 = new Bar();\n * bar2.foo = bar1.foo; // Programmatically let them reference to the same\n * ```\n * `bar1` and `bar2` reference to the same `Foo` object.\n * However, after deserializing, `bar1.foo === bar2.foo` always evaluates to `false`.\n * @zh\n * 将目标类标记为“被唯一引用”的，其意味着就序列化而言，不会有多个对象引用该类的同一实例。\n * 当序列化到该类的对象引用时，即使它们明面上指向同一对象，也会被当作是不同对象；\n * 而当反序列化后，这两个引用将指向截然不同的两个对象。\n * 例如：\n * ```ts\n * import { _decorator } from 'cc';\n * @_decorator.ccclass\n * @_decorator.uniquelyReferenced\n * class Foo { }\n *\n * @_decorator.ccclass\n * class Bar {\n *   @_decorator.property\n *   public foo = new Foo();\n * }\n *\n * const bar1 = new Bar();\n * const bar2 = new Bar();\n * bar2.foo = bar1.foo; // 由程序逻辑让它们引用同一个对象\n * ```\n * `bar1` 和 `bar2` 引用同一个 `Foo` 对象。\n * 但在反序列化之后，`bar1.foo === bar2.foo` 永不成立。\n */\nexport const uniquelyReferenced: ClassDecorator = !WITH_SERIALIZATION\n    ? emptyDecorator\n    // eslint-disable-next-line func-names, @typescript-eslint/ban-types\n    : function uniquelyReferenced<TFunction extends Function> (constructor: TFunction) {\n        const metadata = getOrCreateSerializationMetadata(constructor);\n        metadata.uniquelyReferenced = true;\n    };\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV, EDITOR } from 'internal:constants';\nimport { IExposedAttributes } from '../utils/attribute-defines';\nimport { getOrCreatePropertyStash } from './property';\nimport { PropertyStash, PropertyStashInternalFlag } from '../class-stash';\n\nimport { LegacyPropertyDecorator, emptyDecorator, makeSmartEditorClassDecorator, makeEditorClassDecoratorFn, emptySmartClassDecorator, emptyDecoratorFn } from './utils';\n\n/**\n * @en Makes a CCClass that inherit from component execute in edit mode.<br/>\n * By default, all components are only executed in play mode,<br/>\n * which means they will not have their callback functions executed while the Editor is in edit mode.<br/>\n * @zh 允许继承自 Component 的 CCClass 在编辑器里执行。<br/>\n * 默认情况下，所有 Component 都只会在运行时才会执行，也就是说它们的生命周期回调不会在编辑器里触发。\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, executeInEditMode} = _decorator;\n *\n *  @ccclass\n *  @executeInEditMode\n * class NewScript extends Component {\n *     // ...\n * }\n * ```\n */\nexport const executeInEditMode: ClassDecorator & ((yes?: boolean) => ClassDecorator) =    DEV ? makeSmartEditorClassDecorator('executeInEditMode', true) : emptySmartClassDecorator;\n\n/**\n * @en Add the current component to the specific menu path in `Add Component` selector of the inspector panel\n * @zh 将当前组件添加到组件菜单中，方便用户查找。例如 \"Rendering/CameraCtrl\"。\n * @param path - The path is the menu represented like a pathname. For example the menu could be \"Rendering/CameraCtrl\".\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, menu} = _decorator;\n *\n * @ccclass\n * @menu(\"Rendering/CameraCtrl\")\n * class NewScript extends Component {\n *     // ...\n * }\n * ```\n */\nexport const menu: (path: string) => ClassDecorator =    DEV ? makeEditorClassDecoratorFn('menu') : emptyDecoratorFn;\n\n/**\n * @en When [[_decorator.executeInEditMode]] is set,\n * this decorator will make the editor running in high FPS mode when a node with the component is focused\n * @zh 当指定了 [[_decorator.executeInEditMode]] 以后，playOnFocus 可以在选中当前组件所在的节点时，提高编辑器的场景刷新频率到 60 FPS，否则场景就只会在必要的时候进行重绘。\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, playOnFocus, executeInEditMode} = _decorator;\n *\n * @ccclass\n * @executeInEditMode\n * @playOnFocus\n * class CameraCtrl extends Component {\n *     // ...\n * }\n * ```\n */\nexport const playOnFocus: ClassDecorator & ((yes?: boolean) => ClassDecorator) =    DEV ? makeSmartEditorClassDecorator<boolean>('playOnFocus', true) : emptySmartClassDecorator;\n\n/**\n * @en Use a customized inspector page in the **inspector**\n * @zh 自定义当前组件在 **属性检查器** 中渲染时所用的 UI 页面描述。\n * @param url The url of the page definition in js\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, inspector} = _decorator;\n *\n * @ccclass\n * @inspector(\"packages://inspector/inspectors/comps/camera-ctrl.js\")\n * class NewScript extends Component {\n *     // ...\n * }\n * ```\n */\nexport const inspector: (url: string) => ClassDecorator =    DEV ? makeEditorClassDecoratorFn('inspector') : emptyDecoratorFn;\n\n/**\n * @en Define the icon of the component.\n * @zh 自定义当前组件在编辑器中显示的图标 url。\n * @param url\n * @private\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, icon} = _decorator;\n *\n *  @ccclass\n *  @icon(\"xxxx.png\")\n * class NewScript extends Component {\n *     // ...\n * }\n * ```\n */\nexport const icon: (url: string) => ClassDecorator =    DEV ? makeEditorClassDecoratorFn('icon') : emptyDecoratorFn;\n\n/**\n * @en Define the help documentation url,\n * if given, the component section in the **Inspector** will have a help documentation icon reference to the web page given.\n * @zh 指定当前组件的帮助文档的 url，设置过后，在 **属性检查器** 中就会出现一个帮助图标，用户点击将打开指定的网页。\n * @param url The url of the help documentation\n * @example\n * ```ts\n * import { _decorator, Component } from 'cc';\n * const {ccclass, help} = _decorator;\n *\n * @ccclass\n * @help(\"app://docs/html/components/spine.html\")\n * class NewScript extends Component {\n *     // ...\n * }\n * ```\n */\nexport const help: (url: string) => ClassDecorator = DEV ? makeEditorClassDecoratorFn('help') : emptyDecoratorFn;\n\n/**\n * @en\n * Enables the editor interoperability of the property.\n * @zh\n * 允许该属性与编辑器交互。\n */\nexport const editable: LegacyPropertyDecorator = !DEV\n    ? emptyDecorator\n    : (target, propertyKey, descriptor) => {\n        const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n        setImplicitVisible(propertyStash);\n    };\n\n/**\n * @en\n * Sets the condition to show the property.\n * @zh\n * 设置在编辑器展示该属性的条件。\n * @param condition 展示条件，当返回 `true` 时展示；否则不展示。\n */\nexport const visible: (condition: boolean | (() => boolean)) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('visible');\n\n/**\n * @en\n * Sets the property to be read only in editor.\n * @zh\n * 设置该属性在编辑器中仅是可读的。\n */\nexport const readOnly: LegacyPropertyDecorator = !DEV\n    ? emptyDecorator\n    : setPropertyStashWithImplicitVisible('readonly', true);\n\n/**\n * @en\n * Sets the display name of the property in editor.\n * @zh\n * 设置该属性在编辑器中的显示名称。\n * @param text 显示名称。\n */\nexport const displayName: (text: string) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('displayName');\n\n/**\n * @en\n * Sets the tooltip content of the property in editor.\n * @zh\n * 设置该属性在编辑器中的工具提示内容。\n * @param text 工具提示。\n */\nexport const tooltip: (text: string) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashWithImplicitI18n('tooltip');\n\n/**\n * @en\n * Sets the group where this property is organized into, on property inspector.\n * @zh\n * 设置在属性检查器上该属性所属的分类标签。\n * @param options 分组的配置。\n */\nexport const group: (options: NonNullable<IExposedAttributes['group']>) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('group');\n\n/**\n * @en\n * Sets the allowed range of the property in editor.\n * @zh\n * 设置该属性在编辑器中允许设置的范围。\n * @param values 范围。\n */\nexport const range: (values: [number, number, number] | [number, number]) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('range');\n\n/**\n * @en\n * Sets the allowed min value of the property in editor.\n * @zh\n * 设置该属性在编辑器中允许的最小值。\n * @param value 最小值。\n */\nexport const rangeMin: (value: number) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('min');\n\n/**\n * @en\n * Sets the allowed max value of the property in editor.\n * @zh\n * 设置该属性在编辑器中允许的最大值。\n * @param value 最大值。\n */\nexport const rangeMax: (value: number) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('max');\n\n/**\n * @en\n * Sets the step of the property in editor.\n * @zh\n * 设置该属性在编辑器中的步进值。\n * @param value 步进值。\n */\nexport const rangeStep: (value: number) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('step');\n\n/**\n * @en\n * Enable a slider be given to coordinate the property in editor.\n * @zh\n * 允许在编辑器中提供滑动条来调节值\n */\nexport const slide: LegacyPropertyDecorator = !DEV\n    ? emptyDecorator\n    : setPropertyStashWithImplicitVisible('slide', true);\n\n/**\n * @en\n * Sets the display order of the property in editor.\n * @zh\n * 设置该属性在编辑器中的显示顺序。\n * @param order 显示顺序。\n */\nexport const displayOrder: (order: number) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('displayOrder');\n\n/**\n * @en\n * Sets the unit of the property in editor.\n * @zh\n * 设置该属性在编辑器中的计量单位。\n * @param name 计量单位的名称。\n */\nexport const unit: (name:\n| 'lm'\n| 'lx'\n| 'cd/m²'\n) => LegacyPropertyDecorator = !DEV\n    ? emptyDecoratorFn\n    : setPropertyStashVar1WithImplicitVisible('unit');\n\n/**\n * @en\n * Sets to convert the value into radian before feed it to the property in editor.\n * @zh\n * 设置在编辑器中赋值该属性前将值先转换为弧度制。\n */\nexport const radian: LegacyPropertyDecorator = !DEV\n    ? emptyDecorator\n    : setPropertyStashWithImplicitVisible('radian', true);\n\n/**\n * @en\n * Enable multi-line display of the property in editor.\n * @zh\n * 允许在编辑器中对该属性进行多行显示。\n */\nexport const multiline: LegacyPropertyDecorator = !DEV\n    ? emptyDecorator\n    : setPropertyStashWithImplicitVisible('multiline', true);\n\n/**\n * @en\n * Sets the property so that it does not interop with the animation parts in editor.\n * @zh\n * 设置该属性不参与编辑器中动画相关的交互。\n */\nexport const disallowAnimation: LegacyPropertyDecorator = !DEV\n    ? emptyDecorator\n    : (target, propertyKey, descriptor) => {\n        const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n        propertyStash.animatable = false;\n    };\n\nfunction setPropertyStashWithImplicitVisible<TKey extends keyof PropertyStash> (\n    key: TKey,\n    value: NonNullable<PropertyStash[TKey]>,\n): LegacyPropertyDecorator {\n    return (target, propertyKey, descriptor) => {\n        const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n        propertyStash[key] = value;\n        setImplicitVisible(propertyStash);\n    };\n}\n\nfunction setPropertyStashVar1WithImplicitVisible<TKey extends keyof PropertyStash> (\n    key: TKey,\n) {\n    return (value: NonNullable<PropertyStash[TKey]>): LegacyPropertyDecorator => (target, propertyKey, descriptor) => {\n        const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n        propertyStash[key] = value;\n        setImplicitVisible(propertyStash);\n    };\n}\n\nfunction setImplicitVisible (propertyStash: PropertyStash) {\n    propertyStash.__internalFlags |= PropertyStashInternalFlag.IMPLICIT_VISIBLE;\n}\n\nfunction setPropertyStashWithImplicitI18n<TKey extends keyof PropertyStash> (\n    key: TKey,\n) {\n    return (value: NonNullable<PropertyStash[TKey]>): LegacyPropertyDecorator => (target, propertyKey, descriptor) => {\n        const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n        const prefix = 'i18n:';\n        if (value.startsWith(prefix)) {\n            const extensionPrefix = 'ENGINE.';\n            propertyStash[key] = `${prefix}${extensionPrefix}${value.substring(prefix.length)}`;\n        } else {\n            propertyStash[key] = value;\n        }\n        setImplicitVisible(propertyStash);\n    };\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { LegacyPropertyDecorator } from './utils';\nimport { property } from './property';\nimport { CCString, CCInteger, CCFloat, CCBoolean, PrimitiveType } from '../utils/attribute';\n\n/**\n * @en Declare the property as integer\n * @zh 将该属性标记为整数。\n */\nexport const integer = type(CCInteger);\n\n/**\n * @en Declare the property as float\n * @zh 将该属性标记为浮点数。\n */\nexport const float = type(CCFloat);\n\n/**\n * @en Declare the property as boolean\n * @zh 将该属性标记为布尔值。\n */\nexport const boolean = type(CCBoolean);\n\n/**\n * @en Declare the property as string\n * @zh 将该属性标记为字符串。\n */\nexport const string = type(CCString);\n\n/**\n * @en Declare the property as the given type\n * @zh 标记该属性的类型。\n * @param type\n */\nexport function type (type: Function | [Function] | any): PropertyDecorator;\n\nexport function type<T> (type: PrimitiveType<T> | [PrimitiveType<T>]): PropertyDecorator;\n\nexport function type<T> (type: PrimitiveType<T> | Function | [PrimitiveType<T>] | [Function]): LegacyPropertyDecorator {\n    return property({\n        type,\n    });\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { LegacyPropertyDecorator } from './utils';\nimport { getOrCreatePropertyStash } from './property';\n\nexport const override: LegacyPropertyDecorator = (target, propertyKey, descriptor) => {\n    const propertyStash = getOrCreatePropertyStash(target, propertyKey, descriptor);\n    propertyStash.override = true;\n};\n","import { EDITOR } from 'internal:constants';\nimport { ccclass, editorOnly } from 'cc.decorator';\nimport { js } from '../utils/js';\nimport { CCClass } from './class';\nimport { EditorExtendableObject, editorExtrasTag } from './editor-extras-tag';\nimport { assertIsTrue } from './utils/asserts';\n\n// Functions and classes exposed from this module are useful to\n// make a class to be `EditorExtendableObject`.\n//\n// These helpers are used internally, don't expose them to user.\n\n/**\n * Creates a mixin class which inherits from specific base class and implements the `EditorExtendableObject` interface.\n * @param Base The base class.\n * @param className Assign an optional cc class name. If the base class is not cc class, this param is required.\n * @returns The mixin class.\n */\nexport function EditorExtendableMixin<T> (Base: new (...args: any[]) => T, className?: string) {\n    return editorExtendableInternal(Base);\n}\n\nclass Empty {}\n\n/**\n * Class which implements the `EditorExtendableObject` interface.\n */\nexport const EditorExtendable = editorExtendableInternal();\n\nexport type EditorExtendable = InstanceType<typeof EditorExtendable>;\n\n// Note: Babel does not support decorators on computed property currently.\n// So we have to use its literal value below.\nassertIsTrue(editorExtrasTag === '__editorExtras__', 'editorExtrasTag needs to be updated.');\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction editorExtendableInternal<T> (Base?: (new (...args: any[]) => T), className?: string) {\n    type ResultType = new (...args: any[]) => (T & EditorExtendableObject);\n\n    if (!EDITOR) {\n        return (Base ?? Empty) as unknown as ResultType;\n    }\n\n    let name: string;\n    if (className) {\n        name = className;\n    } else if (!Base) {\n        name = `cc.EditorExtendable`;\n    } else {\n        const baseName = js.getClassName(Base);\n        if (baseName) {\n            name = `cc.EditorExtendable/${baseName}`;\n        } else {\n            throw new Error(`You should supply a class name to EditorExtendable when mixin with ${Base.name}.`);\n        }\n    }\n\n    let EditorExtendable: any;\n    if (Base) {\n        @ccclass(name)\n        class C extends (Base as unknown as any) implements EditorExtendableObject {\n            @editorOnly\n            public __editorExtras__!: unknown;\n        }\n\n        EditorExtendable = C;\n    } else {\n        @ccclass(name)\n        class C implements EditorExtendableObject {\n            @editorOnly\n            public __editorExtras__!: unknown;\n        }\n\n        EditorExtendable = C;\n    }\n\n    return EditorExtendable as unknown as ResultType;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { js } from '../utils/js';\n\nexport interface ICache<T> {\n    add (key: string, val: T): T;\n    get (key: string): T | undefined | null;\n    has (key: string): boolean;\n    remove (key: string): T | undefined | null;\n    clear (): void;\n    forEach (func: (val: T, key: string) => void): void;\n    find (predicate: (val: T, key: string) => boolean): T | null;\n    readonly count: number;\n    destroy (): void;\n}\n\n/**\n * @en\n * use to cache something\n *\n * @zh\n * 用于缓存某些内容\n *\n */\nexport default class Cache<T = any> implements ICache<T> {\n    protected _map: Record<string, T> | null = null;\n    protected _count = 0;\n\n    /**\n     * @en\n     * Create a cache\n     *\n     * @zh\n     * 创建一个 cache\n     *\n     * @param map - An object used to initialize\n     *\n     */\n    constructor (map?: Record<string, T>) {\n        if (map) {\n            this._map = map;\n            this._count = Object.keys(map).length;\n        } else {\n            this._map = js.createMap(true);\n            this._count = 0;\n        }\n    }\n\n    /**\n     * @en\n     * Add Key-Value to cache\n     *\n     * @zh\n     * 增加键值对到缓存中\n     *\n     * @param key - The key\n     * @param val - The value\n     * @returns The value\n     *\n     * @example\n     * var cache = new Cache();\n     * cache.add('test', null);\n     *\n     */\n    public add (key: string, val: T): T {\n        if (!(key in this._map!)) {\n            this._count++;\n        }\n        return this._map![key] = val;\n    }\n\n    /**\n     * @en\n     * Get the cached content by key\n     *\n     * @zh\n     * 通过 key 获取对应的 value\n     *\n     * @param key - The key\n     * @returns The corresponding content\n     *\n     * @example\n     * let cache = new Cache();\n     * let test = cache.get('test');\n     *\n     */\n    public get (key: string): T | undefined | null {\n        return this._map![key];\n    }\n\n    /**\n     * @en\n     * Check whether or not content exists by key\n     *\n     * @zh\n     * 通过 Key 判断是否存在对应的内容\n     *\n     * @param key - The key\n     * @returns True indicates that content of the key exists\n     *\n     * @example\n     * var cache = new Cache();\n     * var exist = cache.has('test');\n     *\n     */\n    public has (key: string): boolean {\n        return key in this._map!;\n    }\n\n    /**\n     * @en\n     * Remove the cached content by key\n     *\n     * @zh\n     * 通过 Key 移除对应的内容\n     *\n     * @param key - The key\n     * @returns The removed content\n     *\n     * @example\n     * var cache = new Cache();\n     * var content = cache.remove('test');\n     *\n     */\n    public remove (key: string): T | undefined | null {\n        const out = this._map![key];\n        if (key in this._map!) {\n            delete this._map![key];\n            this._count--;\n        }\n        return out;\n    }\n\n    /**\n     * @en\n     * Clear all content\n     *\n     * @zh\n     * 清除所有内容\n     *\n     * @example\n     * var cache = new Cache();\n     * cache.clear();\n     *\n     */\n    public clear (): void {\n        if (this._count !== 0) {\n            this._map = js.createMap(true);\n            this._count = 0;\n        }\n    }\n\n    /**\n     * @en\n     * Enumerate all content and invoke function\n     *\n     * @zh\n     * 枚举所有内容并执行方法\n     *\n     * @param func - Function to be invoked\n     * @param func.val - The value\n     * @param func.key - The corresponding key\n     *\n     * @example\n     * var cache = new Cache();\n     * cache.forEach((val, key) => console.log(key));\n     *\n     */\n    public forEach (func: (val: T, key: string) => void): void {\n        for (const key in this._map) {\n            func(this._map[key], key);\n        }\n    }\n\n    /**\n     * @en\n     * Enumerate all content to find one element which can fulfill condition\n     *\n     * @zh\n     * 枚举所有内容，找到一个可以满足条件的元素\n     *\n     * @param predicate - The condition\n     * @returns content\n     *\n     * @example\n     * var cache = new Cache();\n     * var val = cache.find((val, key) => key === 'test');\n     *\n     */\n    public find (predicate: (val: T, key: string) => boolean): T | null {\n        for (const key in this._map) {\n            if (predicate(this._map[key], key)) {\n                return this._map[key];\n            }\n        }\n        return null;\n    }\n\n    /**\n     * @en\n     * The count of cached content\n     *\n     * @zh\n     * 缓存数量\n     *\n     */\n    get count (): number {\n        return this._count;\n    }\n\n    /**\n     * @en\n     * Destroy this cache\n     *\n     * @zh\n     * 销毁这个 cache\n     *\n     */\n    public destroy (): void {\n        this._map = null;\n    }\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { warnID } from '../platform/debug';\nimport { CompleteCallbackNoData } from './shared';\nimport Task from './task';\n\nexport type IAsyncPipe = (task: Task, done: CompleteCallbackNoData) => void;\nexport type ISyncPipe = (task: Task) => Error | void;\nexport type IPipe = IAsyncPipe | ISyncPipe;\n\n/**\n * @en\n * Pipeline can execute the task for some effect.\n *\n * @zh\n * 管线能执行任务达到某个效果\n *\n */\nexport class Pipeline {\n    private static _pipelineId = 0;\n\n    /**\n     * @en\n     * The id of pipeline\n     *\n     * @zh\n     * 管线的 id\n     *\n     */\n    public id: number = Pipeline._pipelineId++;\n\n    /**\n     * @en\n     * The name of pipeline\n     *\n     * @zh\n     * 管线的名字\n     *\n     */\n    public name = '';\n\n    /**\n     * @en\n     * All pipes of pipeline\n     *\n     * @zh\n     * 所有的管道\n     *\n     */\n    public pipes: IPipe[] = [];\n\n    /**\n     * @en\n     * Create a new pipeline\n     *\n     * @zh\n     * 创建一个管线\n     *\n     * @param name - The name of pipeline\n     * @param funcs - The array of pipe, every pipe must be function which take two parameters,\n     * the first is a `Task` flowed in pipeline, the second is complete callback\n     *\n     * @example\n     * const pipeline = new Pipeline('download', [\n     * (task, done) => {\n     *      const url = task.input;\n     *      assetManager.downloader.downloadFile(url, null, null, (err, result) => {\n     *          task.output = result;\n     *          done(err);\n     *      });\n     * },\n     * (task, done) => {\n     *      const text = task.input;\n     *      const json = JSON.stringify(text);\n     *      task.output = json;\n     *      done();\n     * }\n     * ]);\n     *\n     */\n    constructor (name: string, funcs: IPipe[]) {\n        this.name = name;\n        for (let i = 0, l = funcs.length; i < l; i++) {\n            this.pipes.push(funcs[i]);\n        }\n    }\n\n    /**\n     * @en\n     * At specific point insert a new pipe to pipeline\n     *\n     * @zh\n     * 在某个特定的点为管线插入一个新的 pipe\n     *\n     * @param func - The new pipe\n     * @param func.task - The task handled with pipeline will be transferred to this function\n     * @param func.done - Callback you need to invoke manually when this pipe is finished. if the pipeline is synchronous, callback is unnecessary.\n     * @param index - The specific point you want to insert at.\n     * @return pipeline\n     *\n     * @example\n     * var pipeline = new Pipeline('test', []);\n     * pipeline.insert((task, done) => {\n     *      // do something\n     *      done();\n     * }, 0);\n     *\n     */\n    public insert (func: IPipe, index: number): Pipeline {\n        if (index > this.pipes.length) {\n            warnID(4921);\n            return this;\n        }\n\n        this.pipes.splice(index, 0, func);\n        return this;\n    }\n\n    /**\n     * @en\n     * Append a new pipe to the pipeline\n     *\n     * @zh\n     * 添加一个管道到管线中\n     *\n     * @param func - The new pipe\n     * @param func.task - The task handled with pipeline will be transferred to this function\n     * @param func.done - Callback you need to invoke manually when this pipe is finished. if the pipeline is synchronous, callback is unnecessary.\n     * @return pipeline\n     *\n     * @example\n     * var pipeline = new Pipeline('test', []);\n     * pipeline.append((task, done) => {\n     *      // do something\n     *      done();\n     * });\n     *\n     */\n    public append (func: IPipe): Pipeline {\n        this.pipes.push(func);\n        return this;\n    }\n\n    /**\n     * @en\n     * Remove pipe which at specific point\n     *\n     * @zh\n     * 移除特定位置的管道\n     *\n     * @param index - The specific point\n     * @return pipeline\n     *\n     * @example\n     * var pipeline = new Pipeline('test', (task, done) => {\n     *      // do something\n     *      done();\n     * });\n     * pipeline.remove(0);\n     *\n     */\n    public remove (index: number): Pipeline {\n        this.pipes.splice(index, 1);\n        return this;\n    }\n\n    /**\n     * @en\n     * Execute task synchronously\n     *\n     * @zh\n     * 同步执行任务\n     *\n     * @param task - The task will be executed\n     * @returns result\n     *\n     * @example\n     * var pipeline = new Pipeline('sync', [(task) => {\n     *      let input = task.input;\n     *      task.output = doSomething(task.input);\n     * }]);\n     *\n     * var task = new Task({input: 'test'});\n     * console.log(pipeline.sync(task));\n     *\n     */\n    public sync (task: Task): any {\n        const pipes = this.pipes;\n        if (pipes.length === 0) { return null; }\n        task.isFinish = false;\n        for (let i = 0, l = pipes.length; i < l;) {\n            const pipe = pipes[i] as ISyncPipe;\n            const result = pipe(task);\n            if (result) {\n                task.isFinish = true;\n                return result;\n            }\n            i++;\n            if (i !== l) {\n                task.input = task.output;\n                task.output = null;\n            }\n        }\n        task.isFinish = true;\n        return task.output as unknown;\n    }\n\n    /**\n     * @en\n     * Execute task asynchronously\n     *\n     * @zh\n     * 异步执行任务\n     *\n     * @param task - The task will be executed\n     *\n     * @example\n     * var pipeline = new Pipeline('sync', [(task, done) => {\n     *      let input = task.input;\n     *      task.output = doSomething(task.input);\n     *      done();\n     * }]);\n     * var task = new Task({input: 'test', onComplete: (err, result) => console.log(result)});\n     * pipeline.async(task);\n     *\n     */\n    public async (task: Task): void {\n        const pipes = this.pipes;\n        if (pipes.length === 0) { return; }\n        task.isFinish = false;\n        this._flow(0, task);\n    }\n\n    private _flow (index: number, task: Task): void {\n        const pipe = this.pipes[index];\n        pipe(task, (result) => {\n            if (result) {\n                task.isFinish = true;\n                task.dispatch('complete', result);\n            } else {\n                index++;\n                if (index < this.pipes.length) {\n                    // move output to input\n                    task.input = task.output;\n                    task.output = null;\n                    this._flow(index, task);\n                } else {\n                    task.isFinish = true;\n                    task.dispatch('complete', result, task.output);\n                }\n            }\n        });\n    }\n}\n","import { js } from '../utils/js';\nimport { ICache } from './cache';\n\ndeclare class WeakRef<T> {\n    constructor (obj: T);\n    deref (): T | null;\n}\n\nexport default class WeakCache<T> implements ICache<T> {\n    protected _weakMap: Record<string, WeakRef<T>> = {};\n\n    constructor (map?: Record<string, T>) {\n        if (typeof window.WeakRef === 'undefined') throw new Error('this platform does not support WeakRef!');\n        if (map) {\n            for (const key in map) {\n                this._weakMap[key] = new WeakRef(map[key]);\n            }\n        }\n    }\n\n    public add (key: string, val: T): T {\n        this._weakMap[key] = new WeakRef(val);\n        return val;\n    }\n\n    public has (key: string): boolean {\n        return key in this._weakMap && !!this._weakMap[key].deref();\n    }\n\n    public get (key: string): T | undefined | null {\n        return this._weakMap[key] && this._weakMap[key].deref();\n    }\n\n    public remove (key: string): T | undefined | null {\n        const out = this._weakMap[key];\n        delete this._weakMap[key];\n        return out && out.deref();\n    }\n\n    public clear (): void {\n        this._weakMap = js.createMap(true);\n    }\n\n    public forEach (func: (val: T, key: string) => void): void {\n        for (const key in this._weakMap) {\n            const val = this.get(key);\n            if (val) {\n                func(val, key);\n            }\n        }\n    }\n\n    public find (predicate: (val: T, key: string) => boolean): T | null {\n        for (const key in this._weakMap) {\n            const val = this.get(key);\n            if (val && predicate(val, key)) {\n                return this._weakMap[key].deref();\n            }\n        }\n        return null;\n    }\n\n    get count (): number {\n        return Object.values(this._weakMap).filter((weakRef) => weakRef.deref()).length;\n    }\n\n    public destroy (): void {\n        this._weakMap = {};\n    }\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport Bundle from './bundle';\nimport Cache from './cache';\nimport { Pipeline } from './pipeline';\nimport RequestItem from './request-item';\nimport WeakCache from './weak-cache';\n\nexport type CompleteCallback<T = any> = (err: Error | null, data?: T | null) => void;\nexport type CompleteCallbackNoData = (err?: Error | null) => void;\nexport type CompleteCallbackWithData<T = any> = (err: Error | null, data: T) => void;\nexport type ProgressCallback = (finished: number, total: number, item: RequestItem) => void;\nexport type Request = string | string[] | IRequest | Array<IRequest>;\n\nexport interface IRequest extends IOptions {\n    uuid?: string;\n    url?: string;\n    path?: string;\n    dir?: string;\n    scene?: string;\n}\n\nexport interface IOptions extends IBundleOptions, IRemoteOptions {\n    type?: typeof Asset;\n    bundle?: string;\n}\n\nexport interface IRemoteOptions extends IAssetOptions {\n    ext?: string;\n}\n\nexport interface IXHROptions extends Record<string, any> {\n    xhrResponseType?: XMLHttpRequestResponseType;\n    xhrWithCredentials?: boolean;\n    xhrTimeout?: number;\n    xhrHeader?: Record<string, string>;\n    xhrMimeType?: string;\n}\n\nexport interface IAssetOptions extends INativeAssetOptions {\n    reloadAsset?: boolean;\n    cacheAsset?: boolean;\n}\n\nexport interface IJsonAssetOptions extends IAssetOptions {\n    assetId?: string;\n}\n\nexport interface IDownloadParseOptions extends IXHROptions {\n    priority?: number;\n    audioLoadMode?: number;\n    onFileProgress?: (loaded: number, total: number) => void;\n    maxConcurrency?: number;\n    maxRequestsPerFrame?: number;\n    maxRetryCount?: number;\n    cacheEnabled?: boolean;\n}\n\nexport interface IBundleOptions extends INativeAssetOptions {\n    version?: string;\n    scriptAsyncLoading?: boolean;\n}\n\nexport interface INativeAssetOptions extends IDownloadParseOptions {\n    preset?: string;\n}\n\nexport type AssetType<T = Asset> = Constructor<T>;\n\nexport const assets = EDITOR ? new WeakCache<Asset>() : new Cache<Asset>();\nexport const files = new Cache();\nexport const parsed = new Cache();\nexport const bundles = new Cache<Bundle>();\nexport const pipeline = new Pipeline('normal load', []);\nexport const fetchPipeline = new Pipeline('fetch', []);\nexport const transformPipeline = new Pipeline('transform url', []);\nexport const references = EDITOR ? new Cache<any[]>() : null;\nexport const assetsOverrideMap = new Map<string, string>();\n\nexport enum RequestType {\n\n    UUID = 'uuid',\n\n    PATH = 'path',\n\n    DIR = 'dir',\n\n    URL = 'url',\n\n    SCENE = 'scene',\n}\n\nexport const presets: Record<string, Record<string, any>> = {\n\n    default: {\n        priority: 0,\n    },\n\n    preload: {\n        maxConcurrency: 6,\n        maxRequestsPerFrame: 2,\n        priority: -1,\n    },\n\n    scene: {\n        maxConcurrency: 20,\n        maxRequestsPerFrame: 20,\n        priority: 1,\n    },\n\n    bundle: {\n        maxConcurrency: 20,\n        maxRequestsPerFrame: 20,\n        priority: 2,\n    },\n\n    remote: {\n        maxRetryCount: 4,\n    },\n};\n\n/**\n * @en\n * The builtin bundles\n *\n * @zh\n * 内置 bundle\n *\n */\nexport enum BuiltinBundleName {\n    /**\n     * @en\n     * The builtin bundle of default asset\n     *\n     * @zh\n     * 内置 bundle, 对应默认资源\n     */\n    INTERNAL = 'internal',\n\n    /**\n     * @en\n     * The builtin bundle corresponds to 'assets/resources'.\n     *\n     * @zh\n     * 内置 bundle, 对应 'assets/resources' 目录\n     *\n     */\n    RESOURCES = 'resources',\n\n    /**\n     * @en\n     * The builtin bundle\n     *\n     * @zh\n     * 内置 bundle\n     *\n     */\n    MAIN = 'main',\n\n    /**\n     * @en\n     * The builtin bundle, exists when Start Scene asset bundle is checked on the project building panel\n     *\n     * @zh\n     * 内置 bundle, 如果构建面板开启了首场景分包，则会有 START_SCENE bundle\n     *\n     */\n    START_SCENE = 'start-scene',\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nexport type TaskCompleteCallback = (err: Error | null | undefined, data: any) => void;\nexport type TaskProgressCallback = (...args: any[]) => void;\nexport type TaskErrorCallback = (...args: any[]) => void;\nexport interface ITaskOption {\n    onComplete?: TaskCompleteCallback | null;\n    onProgress?: TaskProgressCallback | null;\n    onError?: TaskErrorCallback | null;\n    input: any;\n    progress?: any;\n    options?: Record<string, any> | null;\n}\n\n/**\n * @en\n * Task is used to run in the pipeline for some effect\n *\n * @zh\n * 任务用于在管线中运行以达成某种效果\n *\n */\nexport default class Task {\n    public static MAX_DEAD_NUM = 500;\n\n    /**\n     * @en\n     * Create a new task from pool\n     *\n     * @zh\n     * 从对象池中创建 task\n     *\n     * @static\n     * @method create\n     * @param options - Some optional paramters\n     * @param options.onComplete - Callback when the task complete, if the pipeline is synchronous, onComplete is unnecessary.\n     * @param options.onProgress - Continuously callback when the task is runing, if the pipeline is synchronous, onProgress is unnecessary.\n     * @param options.onError - Callback when something goes wrong, if the pipeline is synchronous, onError is unnecessary.\n     * @param options.input - Something will be handled with pipeline\n     * @param options.progress - Progress information, you may need to assign it manually when multiple pipeline share one progress\n     * @param options.options - Custom parameters\n     * @returns task\n     *\n     */\n    public static create (options: ITaskOption): Task {\n        let out: Task;\n        if (Task._deadPool.length !== 0) {\n            out = Task._deadPool.pop() as Task;\n            out.set(options);\n        } else {\n            out = new Task(options);\n        }\n\n        return out;\n    }\n\n    private static _taskId = 0;\n    private static _deadPool: Task[] = [];\n\n    /**\n     * @en\n     * The id of task\n     *\n     * @zh\n     * 任务id\n     *\n     */\n    public id: number = Task._taskId++;\n\n    /**\n     * @en\n     * The callback when task is completed\n     *\n     * @zh\n     * 完成回调\n     *\n     */\n    public onComplete: TaskCompleteCallback | null = null;\n\n    /**\n     * @en\n     * The callback of progression\n     *\n     * @zh\n     * 进度回调\n     *\n     */\n    public onProgress: TaskProgressCallback | null = null;\n\n    /**\n     * @en\n     * The callback when something goes wrong\n     *\n     * @zh\n     * 错误回调\n     *\n     */\n    public onError: TaskErrorCallback | null = null;\n\n    /**\n     * @en\n     * The source of task\n     *\n     * @zh\n     * 任务的源\n     *\n     */\n    public source: any = null;\n\n    /**\n     * @en\n     * The output of task\n     *\n     * @zh\n     * 任务的输出\n     */\n    public output: any = null;\n\n    /**\n     * @en\n     * The input of task\n     *\n     * @zh\n     * 任务的输入\n     *\n     */\n    public input: any = null;\n\n    /**\n     * @en\n     * The progression of task\n     *\n     * @zh\n     * 任务的进度\n     *\n     */\n    public progress: any = null;\n\n    /**\n     * @en\n     * Custom options\n     *\n     * @zh\n     * 自定义参数\n     *\n     */\n    public options: Record<string, any> | null = null;\n\n    /**\n     * @en\n     * Whether or not this task is completed\n     *\n     * @zh\n     * 此任务是否已经完成\n     *\n     */\n    public isFinish = true;\n\n    /**\n     * @en\n     * Create a new Task\n     *\n     * @zh\n     * 创建一个任务\n     *\n     * @param options - Some optional paramters\n     * @param options.onComplete - Callback when the task is completed, if the pipeline is synchronous, onComplete is unnecessary.\n     * @param options.onProgress - Continuously callback when the task is runing, if the pipeline is synchronous, onProgress is unnecessary.\n     * @param options.onError - Callback when something goes wrong, if the pipeline is synchronous, onError is unnecessary.\n     * @param options.input - Something will be handled with pipeline\n     * @param options.progress - Progress information, you may need to assign it manually when multiple pipeline share one progress\n     * @param options.options - Custom parameters\n     */\n    public constructor (options?: ITaskOption) {\n        this.set(options);\n    }\n\n    /**\n     * @en\n     * Set parameters of this task\n     *\n     * @zh\n     * 设置任务的参数\n     *\n     * @param options - Some optional parameters\n     * @param options.onComplete - Callback when the task is completed, if the pipeline is synchronous, onComplete is unnecessary.\n     * @param options.onProgress - Continuously callback when the task is running, if the pipeline is synchronous, onProgress is unnecessary.\n     * @param options.onError - Callback when something goes wrong, if the pipeline is synchronous, onError is unnecessary.\n     * @param options.input - Something will be handled with pipeline\n     * @param options.progress - Progress information, you may need to assign it manually when multiple pipeline share one progress\n     * @param options.options - Custom parameters\n     *\n     * @example\n     * var task = new Task();\n     * task.set({input: ['test'], onComplete: (err, result) => console.log(err), onProgress: (finish, total) => console.log(finish / total)});\n     *\n     */\n    public set (options: ITaskOption = Object.create(null)) {\n        this.onComplete = options.onComplete || null;\n        this.onProgress = options.onProgress || null;\n        this.onError = options.onError || null;\n        this.source = this.input = options.input;\n        this.output = null;\n        this.progress = options.progress;\n        // custom data\n        this.options = options.options || Object.create(null);\n    }\n\n    /**\n     * @en\n     * Dispatch event\n     *\n     * @zh\n     * 发布事件\n     *\n     * @param event - The event name\n     * @param param1 - Parameter 1\n     * @param param2 - Parameter 2\n     * @param param3 - Parameter 3\n     * @param param4 - Parameter 4\n     *\n     * @example\n     * var task = Task.create();\n     * Task.onComplete = (msg) => console.log(msg);\n     * Task.dispatch('complete', 'hello world');\n     *\n     */\n    public dispatch (event: string, param1?: any, param2?: any, param3?: any, param4?: any): void {\n        switch (event) {\n        case 'complete':\n            if (this.onComplete) {\n                this.onComplete(param1, param2);\n            }\n            break;\n        case 'progress':\n            if (this.onProgress) {\n                this.onProgress(param1, param2, param3, param4);\n            }\n            break;\n        case 'error':\n            if (this.onError) {\n                this.onError(param1, param2, param3, param4);\n            }\n            break;\n        default: {\n            const str = `on${event[0].toUpperCase()}${event.substr(1)}`;\n            if (typeof this[str] === 'function') {\n                this[str](param1, param2, param3, param4);\n            }\n            break;\n        }\n        }\n    }\n\n    /**\n     * @en\n     * Recycle this for reuse\n     *\n     * @zh\n     * 回收 task 用于复用\n     *\n     */\n    public recycle (): void {\n        if (Task._deadPool.length === Task.MAX_DEAD_NUM) { return; }\n        this.onComplete = null;\n        this.onProgress = null;\n        this.onError = null;\n        this.source = this.output = this.input = null;\n        this.progress = null;\n        this.options = null;\n        Task._deadPool.push(this);\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { TEST } from 'internal:constants';\nimport { BASE64_VALUES } from './misc';\nimport { legacyCC } from '../global-exports';\n\nconst HexChars = '0123456789abcdef'.split('');\n\nconst _t = ['', '', '', ''];\nconst UuidTemplate = _t.concat(_t, '-', _t, '-', _t, '-', _t, '-', _t, _t, _t);\nconst Indices = UuidTemplate.map((x, i) => (x === '-' ? NaN : i)).filter(isFinite);\n\n/**\n * @en\n * Decode uuid, returns the original uuid\n *\n * @zh\n * 解码 uuid，返回原始 uuid\n *\n * @param  base64 - the encoded uuid\n * @returns the original uuid\n *\n * @example\n * ```ts\n * const uuid = 'fcmR3XADNLgJ1ByKhqcC5Z';\n * const originalUuid = decodeUuid(uuid); // fc991dd7-0033-4b80-9d41-c8a86a702e59\n * ```\n */\nexport default function decodeUuid (base64: string) {\n    const strs = base64.split('@');\n    const uuid = strs[0];\n    if (uuid.length !== 22) {\n        return base64;\n    }\n    UuidTemplate[0] = base64[0];\n    UuidTemplate[1] = base64[1];\n    for (let i = 2, j = 2; i < 22; i += 2) {\n        const lhs = BASE64_VALUES[base64.charCodeAt(i)];\n        const rhs = BASE64_VALUES[base64.charCodeAt(i + 1)];\n        UuidTemplate[Indices[j++]] = HexChars[lhs >> 2];\n        UuidTemplate[Indices[j++]] = HexChars[((lhs & 3) << 2) | rhs >> 4];\n        UuidTemplate[Indices[j++]] = HexChars[rhs & 0xF];\n    }\n    return base64.replace(uuid, UuidTemplate.join(''));\n}\n\nif (TEST) {\n    legacyCC._Test.decodeUuid = decodeUuid;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { legacyCC } from '../global-exports';\nimport { error } from '../platform/debug';\nimport RequestItem from './request-item';\nimport { bundles, Request, IOptions, transformPipeline } from './shared';\nimport Task from './task';\n\nconst _uuidRegex = /.*[/\\\\][0-9a-fA-F]{2}[/\\\\]([0-9a-fA-F-@]{8,}).*/;\n\nexport { default as decodeUuid } from '../utils/decode-uuid';\n\n/**\n * @en\n * Extract uuid from url\n *\n * @zh\n * 从 url 中提取 uuid\n *\n * @param url - url\n * @returns the uuid parsed from url\n *\n * @example\n * var url = 'res/import/fc/fc991dd7-0033-4b80-9d41-c8a86a702e59.json';\n * var uuid = getUuidFromURL(url); // fc991dd7-0033-4b80-9d41-c8a86a702e59\n */\nexport function getUuidFromURL (url: string): string {\n    const matches = _uuidRegex.exec(url);\n    if (matches) {\n        return matches[1];\n    }\n    return '';\n}\n\n/**\n * @en\n * Transform uuid to url\n *\n * @zh\n * 转换 uuid 为 url\n *\n * @param uuid - The uuid of asset\n * @param options - Some optional parameters\n * @param options.isNative - Indicates whether the path you want is a native resource path\n * @param options.nativeExt - Extension of the native resource path, it is required when isNative is true\n * @returns url\n *\n * @example\n * // json path, 'assets/main/import/fc/fc991dd7-0033-4b80-9d41-c8a86a702e59.json';\n * var url = getUrlWithUuid('fcmR3XADNLgJ1ByKhqcC5Z', {isNative: false});\n *\n * // png path, 'assets/main/native/fc/fc991dd7-0033-4b80-9d41-c8a86a702e59.png';\n * var url = getUrlWithUuid('fcmR3XADNLgJ1ByKhqcC5Z', {isNative: true, nativeExt: '.png'});\n *\n */\nexport function getUrlWithUuid (uuid: string, options?: { [k: string]: any, isNative: boolean, nativeExt?: string } | null): string {\n    options = options || Object.create(null);\n\n    options!.__isNative__ = options!.isNative;\n    if (options!.nativeExt) {\n        options!.ext = options!.nativeExt;\n    }\n    const bundle = bundles.find((b) => !!b.getAssetInfo(uuid));\n    if (bundle) {\n        options!.bundle = bundle.name;\n    }\n\n    return transform(uuid, options) as string;\n}\n\n/**\n * @en\n * Check if the type of asset is scene\n *\n * @zh\n * 检查资源类型是否是场景\n *\n * @method isScene\n * @param {*} asset - asset\n * @returns {boolean} - whether or not type is SceneAsset\n *\n */\nexport function isScene (asset) {\n    return !!asset && (asset instanceof legacyCC.SceneAsset || asset instanceof legacyCC.Scene);\n}\n\n/**\n * @en\n * Normalize url, strip './' and '/'\n *\n * @zh\n * 标准化 url ，去除 './' 和 '/'\n *\n * @param url - url\n * @returns - The normalized url\n */\nexport function normalize (url: string): string {\n    if (url) {\n        if (url.charCodeAt(0) === 46 && url.charCodeAt(1) === 47) {\n            // strip './'\n            url = url.slice(2);\n        } else if (url.charCodeAt(0) === 47) {\n            // strip '/'\n            url = url.slice(1);\n        }\n    }\n    return url;\n}\n\nexport function transform (input: Request, options?: IOptions | null): string | string[] {\n    const subTask = Task.create({ input, options });\n    const urls: string[] = [];\n    try {\n        const result: RequestItem[] = transformPipeline.sync(subTask);\n        for (const requestItem of result) {\n            const url = requestItem.url;\n            requestItem.recycle();\n            urls.push(url);\n        }\n    } catch (e) {\n        for (const item of subTask.output) {\n            item.recycle();\n        }\n        error((e as Error).message, (e as Error).stack);\n    }\n    subTask.recycle();\n    return urls.length > 1 ? urls : urls[0];\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { systemInfo } from 'pal/system-info';\nimport { OS } from '../../../pal/system-info/enum-type';\n\nconst EXTNAME_RE = /(\\.[^\\.\\/\\?\\\\]*)(\\?.*)?$/;\nconst DIRNAME_RE = /((.*)(\\/|\\\\|\\\\\\\\))?(.*?\\..*$)?/;\nconst NORMALIZE_RE = /[^\\.\\/]+\\/\\.\\.\\//;\n\n/**\n * @en Join strings to be a path.\n * @zh 拼接字符串为路径。\n * @example {@link cocos/core/utils/CCPath/join.js}\n */\nexport function join (...segments: string[]) {\n    let result = '';\n    for (const segment of segments) {\n        result = (result + (result === '' ? '' : '/') + segment).replace(/(\\/|\\\\\\\\)$/, '');\n    }\n    return result;\n}\n\n/**\n * @en Get the ext name of a path including '.', like '.png'.\n * @zh 返回 Path 的扩展名，包括 '.'，例如 '.png'。\n * @example {@link cocos/core/utils/CCPath/extname.js}\n */\nexport function extname (path: string) {\n    const temp = EXTNAME_RE.exec(path);\n    return temp ? temp[1] : '';\n}\n\n/**\n * @en Get the main name of a file name.\n * @zh 获取文件名的主名称。\n * @deprecated\n */\nexport function mainFileName (fileName: string) {\n    if (fileName) {\n        const idx = fileName.lastIndexOf('.');\n        if (idx !== -1) {\n            return fileName.substring(0, idx);\n        }\n    }\n    return fileName;\n}\n\n/**\n * @en Get the file name of a file path.\n * @zh 获取文件路径的文件名。\n * @example {@link cocos/core/utils/CCPath/basename.js}\n */\nexport function basename (path: string, extName?: string) {\n    const index = path.indexOf('?');\n    if (index > 0) {\n        path = path.substring(0, index);\n    }\n    const reg = /(\\/|\\\\)([^\\/\\\\]+)$/g;\n    const result = reg.exec(path.replace(/(\\/|\\\\)$/, ''));\n    if (!result) {\n        return path;\n    }\n    const baseName = result[2];\n    if (extName && path.substring(path.length - extName.length).toLowerCase() === extName.toLowerCase()) {\n        return baseName.substring(0, baseName.length - extName.length);\n    }\n    return baseName;\n}\n\n/**\n * @en Get dirname of a file path.\n * @zh 获取文件路径的目录名。\n * @example {@link cocos/core/utils/CCPath/dirname.js}\n */\nexport function dirname (path: string) {\n    const temp = DIRNAME_RE.exec(path);\n    return temp ? temp[2] : '';\n}\n\n/**\n * @en Change extname of a file path.\n * @zh 更改文件路径的扩展名。\n * @example {@link cocos/core/utils/CCPath/changeExtname.js}\n */\nexport function changeExtname (path: string, extName?: string) {\n    extName = extName || '';\n    let index = path.indexOf('?');\n    let tempStr = '';\n    if (index > 0) {\n        tempStr = path.substring(index);\n        path = path.substring(0, index);\n    }\n    index = path.lastIndexOf('.');\n    if (index < 0) {\n        return path + extName + tempStr;\n    }\n    return path.substring(0, index) + extName + tempStr;\n}\n\n/**\n * @en Change file name of a file path.\n * @zh 更改文件路径的文件名。\n * @example {@link cocos/core/utils/CCPath/changeBasename.js}\n */\nexport function changeBasename (path: string, baseName: string, isSameExt?: boolean) {\n    if (baseName.indexOf('.') === 0) {\n        return changeExtname(path, baseName);\n    }\n    let index = path.indexOf('?');\n    let tempStr = '';\n    const ext = isSameExt ? extname(path) : '';\n    if (index > 0) {\n        tempStr = path.substring(index);\n        path = path.substring(0, index);\n    }\n    index = path.lastIndexOf('/');\n    index = index <= 0 ? 0 : index + 1;\n    return path.substring(0, index) + baseName + ext + tempStr;\n}\n\n// todo make public after verification\nexport function _normalize (url) {\n    let oldUrl = url = String(url);\n\n    // removing all ../\n    do {\n        oldUrl = url;\n        url = url.replace(NORMALIZE_RE, '');\n    } while (oldUrl.length !== url.length);\n    return url;\n}\n\nexport function stripSep (path: string) {\n    return path.replace(/[\\/\\\\]$/, '');\n}\n\nexport function getSeperator () {\n    return systemInfo.os === OS.WINDOWS ? '\\\\' : '/';\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable } from 'cc.decorator';\nimport { EDITOR, PREVIEW } from 'internal:constants';\nimport { property } from '../data/decorators/property';\nimport { getUrlWithUuid } from '../asset-manager/helper';\nimport { Eventify } from '../event';\nimport { Node } from '../scene-graph';\nimport { legacyCC } from '../global-exports';\nimport { extname } from '../utils/path';\nimport { debug, getError, warn } from '../platform/debug';\nimport { CCObject } from '../data/object';\n\n/**\n * @en\n * Base class for handling assets used in Creator.<br/>\n *\n * You may want to override:<br/>\n * - createNode<br/>\n * - getset functions of _nativeAsset<br/>\n * - `Object._serialize`<br/>\n * - `Object._deserialize`<br/>\n * @zh\n * Creator 中的资源基类。<br/>\n *\n * 您可能需要重写：<br/>\n * - createNode <br/>\n * - _nativeAsset 的 getset 方法<br/>\n * - `Object._serialize`<br/>\n * - `Object._deserialize`<br/>\n *\n * @class Asset\n * @extends CCObject\n */\n@ccclass('cc.Asset')\nexport class Asset extends Eventify(CCObject) {\n    /**\n     * 应 AssetDB 要求提供这个方法。\n     * @internal\n     * @method deserialize\n     * @param {String} data\n     * @return {Asset}\n     */\n    public static deserialize (data) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return legacyCC.deserialize(data);\n    }\n\n    /**\n     * @en\n     * Whether the asset is loaded or not\n     * @zh\n     * 该资源是否已经成功加载。\n     *\n     * @deprecated since v3.3\n     */\n    public loaded = true;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public declare _uuid: string;\n\n    /**\n     * @internal\n     */\n    public declare isDefault: boolean;\n\n    /**\n     * @en\n     * Serializable url for native asset. For internal usage.\n     * @zh\n     * 用于本机资产的可序列化URL。供内部使用。\n     * @default \"\"\n     *\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    public _native = '';\n    /**\n     * @internal\n     */\n    public _nativeUrl = '';\n\n    private _file: any = null;\n    private _ref = 0;\n\n    /**\n     * @en\n     * Returns the url of this asset's native object, if none it will returns an empty string.\n     * @zh\n     * 返回该资源对应的目标平台资源的 URL，如果没有将返回一个空字符串。\n     * @readOnly\n     */\n    get nativeUrl () {\n        if (!this._nativeUrl) {\n            if (!this._native) return '';\n            const name = this._native;\n            if (name.charCodeAt(0) === 47) {    // '/'\n                // remove library tag\n                // not imported in library, just created on-the-fly\n                return name.slice(1);\n            }\n            if (name.charCodeAt(0) === 46) {  // '.'\n                // imported in dir where json exist\n                this._nativeUrl = getUrlWithUuid(this._uuid, { nativeExt: name, isNative: true });\n            } else {\n                // imported in an independent dir\n                this._nativeUrl = getUrlWithUuid(this._uuid, { __nativeName__: name, nativeExt: extname(name), isNative: true });\n            }\n        }\n        return this._nativeUrl;\n    }\n\n    /**\n     * @en\n     * The underlying native asset of this asset if one is available.<br>\n     * This property can be used to access additional details or functionality related to the asset.<br>\n     * This property will be initialized by the loader if `_native` is available.\n     * @zh\n     * 此资源的基础资源（如果有）。 此属性可用于访问与资源相关的其他详细信息或功能。<br>\n     * 如果`_native`可用，则此属性将由加载器初始化。\n     * @default null\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @property\n    get _nativeAsset () {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return this._file;\n    }\n    set _nativeAsset (obj) {\n        this._file = obj;\n    }\n\n    constructor (...args: ConstructorParameters<typeof CCObject>) {\n        super(...args);\n\n        Object.defineProperty(this, '_uuid', {\n            value: '',\n            writable: true,\n            // enumerable is false by default, to avoid uuid being assigned to empty string during destroy\n        });\n\n        if (EDITOR || PREVIEW) {\n            Object.defineProperty(this, 'isDefault', {\n                value: false,\n                writable: true,\n            });\n        }\n    }\n\n    /**\n     * @en\n     * Returns the string representation of the object.<br>\n     * The `Asset` object overrides the `toString()` method of the `Object` object.<br>\n     * JavaScript calls the toString() method automatically<br>\n     * when an asset is to be represented as a text value or when a texture is referred to in a string concatenation.<br>\n     * <br>\n     * For assets of the native type, it will return `this.nativeUrl`.<br>\n     * Otherwise, an empty string is returned.<br>\n     * This method may be overwritten by subclasses.\n     * @zh\n     * 返回对象的字符串表示形式。<br>\n     * `Asset` 对象将会重写 `Object` 对象的 `toString()` 方法。<br>\n     * 当资源要表示为文本值时或在字符串连接时引用时，<br>\n     * JavaScript 会自动调用 toString() 方法。<br>\n     * <br>\n     * 对于原始类型的资源，它将返回`this.nativeUrl`。<br>\n     * 否则，返回空字符串。<br>\n     * 子类可能会覆盖此方法。\n     * @method toString\n     * @return {String}\n     */\n    public toString () {\n        return this.nativeUrl;\n    }\n\n    /**\n     * 应 AssetDB 要求提供这个方法。\n     * 返回一个序列化后的对象\n     *\n     * @method serialize\n     * @return {String}\n     * @private\n     */\n    public serialize () { }\n\n    /**\n     * @en\n     * Set native file name for this asset.\n     * @zh\n     * 为此资源设置原始文件名。\n     * @seealso nativeUrl\n     *\n     * @param filename\n     * @param inLibrary\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _setRawAsset (filename: string, inLibrary = true) {\n        if (inLibrary !== false) {\n            this._native = filename || '';\n        } else {\n            this._native = `/${filename}`;  // simply use '/' to tag location where is not in the library\n        }\n    }\n\n    /**\n     * @en\n     * Create a new node using this asset in the scene.<br/>\n     * If this type of asset don't have its corresponding node type, this method should be null.\n     * @zh\n     * 使用该资源在场景中创建一个新节点。<br/>\n     * 如果这类资源没有相应的节点类型，该方法应该是空的。\n     */\n    public createNode? (callback: CreateNodeCallback): void;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public get _nativeDep () {\n        if (this._native) {\n            return { __isNative__: true, uuid: this._uuid, ext: this._native };\n        }\n        return undefined;\n    }\n\n    /**\n     * @en\n     * The number of reference\n     *\n     * @zh\n     * 引用的数量\n     */\n    public get refCount (): number {\n        return this._ref;\n    }\n\n    /**\n     * @en\n     * Add references of asset\n     *\n     * @zh\n     * 增加资源的引用\n     *\n     * @return itself\n     *\n     */\n    public addRef (): Asset {\n        this._ref++;\n        return this;\n    }\n\n    /**\n     * @en\n     * Reduce references of asset and it will be auto released when refCount equals 0.\n     *\n     * @zh\n     * 减少资源的引用并尝试进行自动释放。\n     *\n     * @return itself\n     *\n     */\n    public decRef (autoRelease = true): Asset {\n        if (this._ref > 0) {\n            this._ref--;\n        }\n        if (autoRelease) {\n            legacyCC.assetManager._releaseManager.tryRelease(this);\n        }\n        return this;\n    }\n\n    public onLoaded () {}\n\n    public initDefault (uuid?: string) {\n        if (uuid) { this._uuid = uuid; }\n        this.isDefault = true;\n    }\n\n    public validate (): boolean {\n        return true;\n    }\n\n    public destroy () {\n        debug(getError(12101, this._uuid));\n        return super.destroy();\n    }\n}\n\n/**\n * @param error - null or the error info\n * @param node - the created node or null\n */\ntype CreateNodeCallback = (error: Error | null, node: Node) => void;\n\nAsset.prototype.createNode = null!;\n\nlegacyCC.Asset = Asset;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass } from 'cc.decorator';\nimport { Asset } from './asset';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en The script asset base class\n * @zh 脚本资源基类。\n */\n@ccclass('cc.Script')\nexport class Script extends Asset {\n}\nlegacyCC._Script = Script;\n\n/**\n * @en JavaScript asset.\n * @zh JavaScript 脚本资源。\n */\n@ccclass('cc.JavaScript')\nexport class JavaScript extends Script {\n}\nlegacyCC._JavaScript = JavaScript;\n\n/**\n * @en TypeScript asset\n * @zh TypeScript 脚本资源。\n */\n@ccclass('cc.TypeScript')\nexport class TypeScript extends Script {\n}\nlegacyCC._TypeScript = TypeScript;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, type, serializable, editable, tooltip } from 'cc.decorator';\nimport type { Node } from '../scene-graph';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en\n * The EventHandler class sets the event callback in the scene.\n * This class allows the user to set the callback target node, target component name, component method name, and call the target method through the `emit` method.\n * @zh\n * “EventHandler” 类用来设置场景中的事件回调，该类允许用户设置回调目标节点，目标组件名，组件方法名，并可通过 emit 方法调用目标函数。\n *\n * @example\n * ```ts\n * // Let's say we have a MainMenu component on newTarget\n * // file: MainMenu.ts\n * @ccclass('MainMenu')\n * export class MainMenu extends Component {\n *     // sender: the node MainMenu.ts belongs to\n *     // eventType: CustomEventData\n *     onClick (sender, eventType) {\n *         cc.log('click');\n *     }\n * }\n *\n * import { Component } from 'cc';\n * const eventHandler = new Component.EventHandler();\n * eventHandler.target = newTarget;\n * eventHandler.component = \"MainMenu\";\n * eventHandler.handler = \"OnClick\";\n * eventHandler.customEventData = \"my data\";\n * ```\n */\n@ccclass('cc.ClickEvent')\nexport class EventHandler {\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    get _componentName () {\n        this._genCompIdIfNeeded();\n\n        return this._compId2Name(this._componentId);\n    }\n    set _componentName (value) {\n        this._componentId = this._compName2Id(value);\n    }\n\n    /**\n     * @en\n     * Dispatching component events.\n     * @zh\n     * 组件事件派发。\n     *\n     * @param events - The event list to be emitted\n     * @param args - The callback arguments\n     */\n    public static emitEvents (events: EventHandler[], ...args: any[]) {\n        for (let i = 0, l = events.length; i < l; i++) {\n            const event = events[i];\n            if (!(event instanceof EventHandler)) {\n                continue;\n            }\n\n            event.emit(args);\n        }\n    }\n    /**\n     * @en\n     * The node that contains target component\n     * @zh\n     * 事件响应组件和函数所在节点\n     */\n    // @type(Node) should be removed for avoid circle reference error\n    // the type definition of it deal with in the file './component-event-handler.schema.ts'\n    @serializable\n    @tooltip('i18n:button.click_event.target')\n    public target: Node | null = null;\n    /**\n     * @en\n     * The name of the component(script) that contains target callback, such as the name 'MainMenu' of the script in the example\n     * @zh\n     * 事件响应函数所在组件名（脚本名）, 比如例子中的脚本名 'MainMenu'\n     */\n    // only for deserializing old project component field\n    @serializable\n    @editable\n    @tooltip('i18n:button.click_event.component')\n    public component = '';\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    public _componentId = '';\n\n    /**\n     * @en\n     * Event handler, such as the callback function name 'onClick' in the example\n     * @zh\n     * 响应事件函数名，比如例子中的 'onClick' 方法名\n     */\n    @serializable\n    @editable\n    @tooltip('i18n:button.click_event.handler')\n    public handler = '';\n\n    /**\n     * @en\n     * Custom Event Data\n     * @zh\n     * 自定义事件数据\n     */\n    @serializable\n    @editable\n    @tooltip('i18n:button.click_event.customEventData')\n    public customEventData = '';\n\n    /**\n     * @en Trigger the target callback with given arguments\n     * @zh 触发目标组件上的指定 handler 函数，可以选择传递参数。\n     * @param params - The arguments for invoking the callback\n     * @example\n     * ```ts\n     * import { Component } from 'cc';\n     * const eventHandler = new Component.EventHandler();\n     * eventHandler.target = newTarget;\n     * eventHandler.component = \"MainMenu\";\n     * eventHandler.handler = \"OnClick\"\n     * eventHandler.emit([\"param1\", \"param2\", ....]);\n     * ```\n     */\n    public emit (params: any[]) {\n        const target = this.target;\n        if (!legacyCC.isValid(target)) { return; }\n\n        this._genCompIdIfNeeded();\n        const compType = legacyCC.js.getClassById(this._componentId);\n\n        const comp = target!.getComponent(compType);\n        if (!legacyCC.isValid(comp)) { return; }\n\n        const handler = comp![this.handler];\n        if (typeof (handler) !== 'function') { return; }\n\n        if (this.customEventData != null && this.customEventData !== '') {\n            params = params.slice();\n            params.push(this.customEventData);\n        }\n\n        handler.apply(comp, params);\n    }\n\n    private _compName2Id (compName) {\n        const comp = legacyCC.js.getClassByName(compName);\n        return legacyCC.js.getClassId(comp);\n    }\n\n    private _compId2Name (compId) {\n        const comp = legacyCC.js.getClassById(compId);\n        return legacyCC.js.getClassName(comp);\n    }\n\n    // to be deprecated in the future\n    private _genCompIdIfNeeded () {\n        if (!this._componentId) {\n            this._componentName = this.component;\n            this.component = '';\n        }\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, tooltip, displayName, type, serializable, disallowAnimation } from 'cc.decorator';\nimport { EDITOR, TEST } from 'internal:constants';\nimport { Script } from '../assets/scripts';\nimport { CCObject } from '../data/object';\nimport IDGenerator from '../utils/id-generator';\nimport { getClassName, value } from '../utils/js';\nimport { RenderScene } from '../renderer/core/render-scene';\nimport { Rect } from '../math';\nimport * as RF from '../data/utils/requiring-frame';\nimport { Node } from '../scene-graph';\nimport { legacyCC } from '../global-exports';\nimport { errorID, warnID, assertID } from '../platform/debug';\nimport { CompPrefabInfo } from '../utils/prefab/prefab-info';\nimport { EventHandler } from './component-event-handler';\n\nconst idGenerator = new IDGenerator('Comp');\nconst IsOnLoadCalled = CCObject.Flags.IsOnLoadCalled;\n\nconst NullNode = null as unknown as Node;\n\n/**\n * @en\n * Base class for everything attached to Node(Entity).<br/>\n * <br/>\n * NOTE: Not allowed to use construction parameters for Component's subclasses,\n *       because Component is created by the engine.\n * @zh\n * 所有附加到节点的基类。<br/>\n * <br/>\n * 注意：不允许使用组件的子类构造参数，因为组件是由引擎创建的。\n */\n@ccclass('cc.Component')\nclass Component extends CCObject {\n    public static EventHandler = EventHandler;\n\n    get name () {\n        if (this._name) {\n            return this._name;\n        }\n        let className = getClassName(this);\n        const trimLeft = className.lastIndexOf('.');\n        if (trimLeft >= 0) {\n            className = className.slice(trimLeft + 1);\n        }\n\n        if (this.node) {\n            return `${this.node.name}<${className}>`;\n        } else {\n            return className;\n        }\n    }\n    set name (value) {\n        this._name = value;\n    }\n\n    /**\n     * @en The uuid for editor.\n     * @zh 组件的 uuid，用于编辑器。\n     * @readOnly\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * log(comp.uuid);\n     * ```\n     */\n    get uuid () {\n        return this._id;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @displayName('Script')\n    @type(Script)\n    @tooltip('i18n:INSPECTOR.component.script')\n    @disallowAnimation\n    get __scriptAsset () { return null; }\n\n    /**\n     * @en Indicates whether this component is enabled or not.\n     * @zh 表示该组件自身是否启用。\n     * @default true\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * comp.enabled = true;\n     * log(comp.enabled);\n     * ```\n     */\n    get enabled () {\n        return this._enabled;\n    }\n    set enabled (value) {\n        if (this._enabled !== value) {\n            this._enabled = value;\n            if (this.node.activeInHierarchy) {\n                const compScheduler = legacyCC.director._compScheduler;\n                if (value) {\n                    compScheduler.enableComp(this);\n                } else {\n                    compScheduler.disableComp(this);\n                }\n            }\n        }\n    }\n\n    /**\n     * @en Indicates whether this component is enabled and its node is also active in the hierarchy.\n     * @zh 表示该组件是否被启用并且所在的节点也处于激活状态。\n     * @readOnly\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * log(comp.enabledInHierarchy);\n     * ```\n     */\n    get enabledInHierarchy () {\n        return this._enabled && this.node && this.node.activeInHierarchy;\n    }\n\n    /**\n     * @en Returns a value which used to indicate the onLoad get called or not.\n     * @zh 返回一个值用来判断 onLoad 是否被调用过，不等于 0 时调用过，等于 0 时未调用。\n     * @readOnly\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * log(this._isOnLoadCalled > 0);\n     * ```\n     *\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    get _isOnLoadCalled () {\n        return this._objFlags & IsOnLoadCalled;\n    }\n\n    public static system = null;\n\n    /**\n     * @en The node this component is attached to. A component is always attached to a node.\n     * @zh 该组件被附加到的节点。组件总会附加到一个节点。\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * log(comp.node);\n     * ```\n     */\n    @serializable\n    public node: Node = NullNode;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    public _enabled = true;\n\n    /**\n     * @internal\n     */\n    @serializable\n    public __prefab: CompPrefabInfo | null = null;\n\n    /**\n     * @internal\n     */\n    public _sceneGetter: null | (() => RenderScene) = null;\n\n    /**\n     * For internal usage.\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _id: string = idGenerator.getNewId();\n\n    // private __scriptUuid = '';\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _getRenderScene (): RenderScene {\n        if (this._sceneGetter) {\n            return this._sceneGetter();\n        }\n        return this.node.scene.renderScene!;\n    }\n\n    // PUBLIC\n\n    /**\n     * @en Adds a component class to the node. You can also add component to node by passing in the name of the script.\n     * @zh 向节点添加一个指定类型的组件类，你还可以通过传入脚本的名称来添加组件。\n     * @param classConstructor The class of component to be retrieved or to be created\n     * @example\n     * ```ts\n     * import { Sprite } from 'cc';\n     * const sprite = node.addComponent(Sprite);\n     * ```\n     */\n    public addComponent<T extends Component> (classConstructor: Constructor<T>): T | null;\n\n    /**\n     * @en Adds a component class to the node. You can also add component to node by passing in the name of the script.\n     * @zh 向节点添加一个指定类型的组件类，你还可以通过传入脚本的名称来添加组件。\n     * @param className A string for the class name of the component\n     * @example\n     * ```ts\n     * const test = node.addComponent(\"Test\");\n     * ```\n     */\n    public addComponent (className: string): Component | null;\n\n    public addComponent (typeOrClassName: any) {\n        return this.node.addComponent(typeOrClassName);\n    }\n\n    /**\n     * @en\n     * Returns the component of supplied type if the node has one attached, null if it doesn't.<br/>\n     * You can also get component in the node by passing in the name of the script.\n     * @zh\n     * 获取节点上指定类型的组件，如果节点有附加指定类型的组件，则返回，如果没有则为空。<br/>\n     * 传入参数也可以是脚本的名称。\n     * @param classConstructor The class of component to be retrieved or to be created\n     * @example\n     * ```ts\n     * import { Sprite } from 'cc';\n     * // get sprite component.\n     * var sprite = node.getComponent(Sprite);\n     * ```\n     */\n    public getComponent<T extends Component> (classConstructor: Constructor<T>): T | null;\n\n    /**\n     * @en\n     * Returns the component of supplied type if the node has one attached, null if it doesn't.<br/>\n     * You can also get component in the node by passing in the name of the script.\n     * @zh\n     * 获取节点上指定类型的组件，如果节点有附加指定类型的组件，则返回，如果没有则为空。<br/>\n     * 传入参数也可以是脚本的名称。\n     * @param className A string for the class name of the component\n     * @example\n     * ```ts\n     * // get custom test calss.\n     * var test = node.getComponent(\"Test\");\n     * ```\n     */\n    public getComponent (className: string): Component | null;\n\n    public getComponent (typeOrClassName: any) {\n        return this.node.getComponent(typeOrClassName);\n    }\n\n    /**\n     * @en Returns all components of supplied type in the node.\n     * @zh 返回节点上指定类型的所有组件。\n     * @param classConstructor The class of components to be retrieved\n     * @example\n     * ```ts\n     * import { Sprite } from 'cc';\n     * const sprites = node.getComponents(Sprite);\n     * ```\n     */\n    public getComponents<T extends Component> (classConstructor: Constructor<T>): T[];\n\n    /**\n     * @en Returns all components of supplied type in the node.\n     * @zh 返回节点上指定类型的所有组件。\n     * @param className A string for the class name of the components\n     * @example\n     * ```ts\n     * const tests = node.getComponents(\"Test\");\n     * ```\n     */\n    public getComponents (className: string): Component[];\n\n    public getComponents<T extends Component> (typeOrClassName: any) {\n        return this.node.getComponents(typeOrClassName);\n    }\n\n    /**\n     * @en Returns the component of supplied type in any of its children using depth first search.\n     * @zh 递归查找所有子节点中第一个匹配指定类型的组件。\n     * @param classConstructor The class of component to be retrieved\n     * @example\n     * ```ts\n     * import { Sprite } from 'cc';\n     * const sprite = node.getComponentInChildren(Sprite);\n     * ```\n     */\n    public getComponentInChildren<T extends Component> (classConstructor: Constructor<T>): T | null;\n\n    /**\n     * @en Returns the component of supplied type in any of its children using depth first search.\n     * @zh 递归查找所有子节点中第一个匹配指定类型的组件。\n     * @param className A string for the class name of the component\n     * @example\n     * ```ts\n     * var Test = node.getComponentInChildren(\"Test\");\n     * ```\n     */\n    public getComponentInChildren (className: string): Component | null;\n\n    public getComponentInChildren (typeOrClassName: any) {\n        return this.node.getComponentInChildren(typeOrClassName);\n    }\n\n    /**\n     * @en Returns all components of supplied type in self or any of its children.\n     * @zh 递归查找自身或所有子节点中指定类型的组件。\n     * @param classConstructor The class of components to be retrieved\n     * @example\n     * ```ts\n     * import { Sprite } from 'cc';\n     * const sprites = node.getComponentsInChildren(Sprite);\n     * ```\n     */\n    public getComponentsInChildren<T extends Component> (classConstructor: Constructor<T>): T[];\n\n    /**\n     * @en Returns all components of supplied type in self or any of its children.\n     * @zh 递归查找自身或所有子节点中指定类型的组件。\n     * @param className A string for the class name of the components\n     * @example\n     * ```ts\n     * const tests = node.getComponentsInChildren(\"Test\");\n     * ```\n     */\n    public getComponentsInChildren (className: string): Component[];\n\n    public getComponentsInChildren (typeOrClassName: any) {\n        return this.node.getComponentsInChildren(typeOrClassName);\n    }\n\n    // OVERRIDE\n\n    public destroy () {\n        if (EDITOR) {\n            // @ts-expect-error private function access\n            const depend = this.node._getDependComponent(this);\n            if (depend.length > 0) {\n                errorID(3626,\n                    getClassName(this), getClassName(depend[0]));\n                return false;\n            }\n        }\n        if (super.destroy()) {\n            if (this._enabled && this.node.activeInHierarchy) {\n                legacyCC.director._compScheduler.disableComp(this);\n            }\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onPreDestroy () {\n        // Schedules\n        this.unscheduleAllCallbacks();\n\n        // onDestroy\n        legacyCC.director._nodeActivator.destroyComp(this);\n\n        // do remove component\n        this.node._removeComponent(this);\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _instantiate (cloned?: Component) {\n        if (!cloned) {\n            cloned = legacyCC.instantiate._clone(this, this);\n        }\n\n        if (cloned) {\n            cloned.node = NullNode;\n        }\n\n        return cloned;\n    }\n\n    // Scheduler\n\n    /**\n     * @en\n     * Use Scheduler system to schedule a custom task.<br/>\n     * If the task is already scheduled, then the interval parameter will be updated without scheduling it again.\n     * @zh\n     * 使用定时器系统调度一个自定义的回调任务。<br/>\n     * 如果回调任务已调度，那么将不会重复调度它，只会更新时间间隔参数。\n     * @param callback  The callback function of the task\n     * @param interval  The time interval between each invocation\n     * @param repeat    The repeat count of this task, the task will be invoked (repeat + 1) times, use [[macro.REPEAT_FOREVER]] to repeat a task forever\n     * @param delay     The delay time for the first invocation, Unit: s\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * this.schedule((dt) => void log(`time: ${dt}`), 1);\n     * ```\n     */\n    public schedule (callback, interval = 0, repeat: number = legacyCC.macro.REPEAT_FOREVER, delay = 0) {\n        assertID(callback, 1619);\n\n        interval = interval || 0;\n        assertID(interval >= 0, 1620);\n\n        repeat = Number.isNaN(repeat) ? legacyCC.macro.REPEAT_FOREVER : repeat;\n        delay = delay || 0;\n\n        const scheduler = legacyCC.director.getScheduler();\n\n        // should not use enabledInHierarchy to judge whether paused,\n        // because enabledInHierarchy is assigned after onEnable.\n        // Actually, if not yet scheduled, resumeTarget/pauseTarget has no effect on component,\n        // therefore there is no way to guarantee the paused state other than isTargetPaused.\n        const paused = scheduler.isTargetPaused(this);\n\n        scheduler.schedule(callback, this, interval, repeat, delay, paused);\n    }\n\n    /**\n     * @en Use Scheduler system to schedule a task that runs only once, with a delay of 0 or larger.\n     * @zh 使用定时器系统调度一个只运行一次的回调任务，可以指定 0 让回调函数在下一帧立即执行或者在一定的延时之后执行。\n     * @method scheduleOnce\n     * @see [[schedule]]\n     * @param callback  The callback function of the task\n     * @param delay  The delay time for the first invocation, Unit: s\n     * @example\n     * ```ts\n     * import { log } from 'cc';\n     * this.scheduleOnce((dt) => void log(`time: ${dt}`), 2);\n     * ```\n     */\n    public scheduleOnce (callback, delay = 0) {\n        this.schedule(callback, 0, 0, delay);\n    }\n\n    /**\n     * @en Un-schedules a custom task.\n     * @zh 取消调度一个自定义的回调任务。\n     * @param callback_fn  The callback function of the task\n     * @example\n     * ```ts\n     * this.unschedule(_callback);\n     * ```\n     */\n    public unschedule (callback_fn) {\n        if (!callback_fn) {\n            return;\n        }\n\n        legacyCC.director.getScheduler().unschedule(callback_fn, this);\n    }\n\n    /**\n     * @en unschedule all scheduled tasks.\n     * @zh 取消调度所有已调度的回调函数。\n     * @example\n     * ```ts\n     * this.unscheduleAllCallbacks();\n     * ```\n     */\n    public unscheduleAllCallbacks () {\n        legacyCC.director.getScheduler().unscheduleAllForTarget(this);\n    }\n\n    // LIFECYCLE METHODS\n\n    // Cocos Creator provides lifecycle methods that you can specify to hook into this process.\n    // We provide Pre methods, which are called right before something happens, and Post methods which are called right after something happens.\n\n    /**\n     * @en Update is called every frame, if the Component is enabled.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.<br/>\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh 如果该组件启用，则每帧调用 update。<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     * @param dt - the delta time in seconds it took to complete the last frame\n     */\n    protected update? (dt: number): void;\n\n    /**\n     * @en LateUpdate is called every frame, if the Component is enabled.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.<br/>\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh 如果该组件启用，则每帧调用 LateUpdate。<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     * @param dt - the delta time in seconds it took to complete the last frame\n     */\n    protected lateUpdate? (dt: number): void;\n\n    /**\n     * @en `__preload` is called before every onLoad.<br/>\n     * It is used to initialize the builtin components internally,<br/>\n     * to avoid checking whether onLoad is called before every public method calls.<br/>\n     * This method should be removed if script priority is supported.\n     * @zh `__preload` 在每次onLoad之前调用。<br/>\n     * 它用于在内部初始化内置组件，<br/>\n     * 以避免在每次公有方法调用之前检查是否调用了onLoad。<br/>\n     * 如果支持脚本优先级，则应删除此方法。\n     * @private\n     */\n    protected __preload? (): void;\n\n    /**\n     * @en\n     * When attaching to an active node or its node first activated.<br/>\n     * onLoad is always called before any start functions, this allows you to order initialization of scripts.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.<br/>\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh\n     * 当附加到一个激活的节点上或者其节点第一次激活时候调用。onLoad 总是会在任何 start 方法调用前执行，这能用于安排脚本的初始化顺序。<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     */\n    protected onLoad? (): void;\n\n    /**\n     * @en\n     * Called before all scripts' update if the Component is enabled the first time.<br/>\n     * Usually used to initialize some logic which need to be called after all components' `onload` methods called.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.<br/>\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh\n     * 如果该组件第一次启用，则在所有组件的 update 之前调用。通常用于需要在所有组件的 onLoad 初始化完毕后执行的逻辑。<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     */\n    protected start? (): void;\n\n    /**\n     * @en Called when this component becomes enabled and its node is active.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh 当该组件被启用，并且它的节点也激活时。<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     */\n    protected onEnable? (): void;\n\n    /**\n     * @en Called when this component becomes disabled or its node becomes inactive.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh 当该组件被禁用或节点变为无效时调用。<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     */\n    protected onDisable? (): void;\n\n    /**\n     * @en Called when this component will be destroyed.<br/>\n     * This is a lifecycle method. It may not be implemented in the super class.<br/>\n     * You can only call its super class method inside it. It should not be called manually elsewhere.\n     * @zh 当该组件被销毁时调用<br/>\n     * 该方法为生命周期方法，父类未必会有实现。并且你只能在该方法内部调用父类的实现，不可在其它地方直接调用该方法。\n     */\n    protected onDestroy? (): void;\n\n    public onFocusInEditor? (): void;\n\n    public onLostFocusInEditor? (): void;\n\n    /**\n     * @en Called to initialize the component or node’s properties when adding the component the first time or when the Reset command is used.\n     * This function is only called in editor.<br/>\n     * @zh 用来初始化组件或节点的一些属性，当该组件被第一次添加到节点上或用户点击了它的 Reset 菜单时调用。这个回调只会在编辑器下调用。\n     */\n    public resetInEditor? (): void;\n\n    // VIRTUAL\n\n    /**\n     * @en\n     * If the component's bounding box is different from the node's, you can implement this method to supply\n     * a custom axis aligned bounding box (AABB), so the editor's scene view can perform hit test properly.\n     * @zh\n     * 如果组件的包围盒与节点不同，您可以实现该方法以提供自定义的轴向对齐的包围盒（AABB），\n     * 以便编辑器的场景视图可以正确地执行点选测试。\n     * @param out_rect - The rect to store the result bounding rect\n     * @private\n     */\n    protected _getLocalBounds? (out_rect: Rect): void;\n\n    /**\n     * @en\n     * onRestore is called after the user clicks the Reset item in the Inspector's context menu or performs\n     * an undo operation on this component.<br/>\n     * <br/>\n     * If the component contains the \"internal state\", short for \"temporary member variables which not included<br/>\n     * in its CCClass properties\", then you may need to implement this function.<br/>\n     * <br/>\n     * The editor will call the getset accessors of your component to record/restore the component's state<br/>\n     * for undo/redo operation. However, in extreme cases, it may not works well. Then you should implement<br/>\n     * this function to manually synchronize your component's \"internal states\" with its public properties.<br/>\n     * Once you implement this function, all the getset accessors of your component will not be called when<br/>\n     * the user performs an undo/redo operation. Which means that only the properties with default value<br/>\n     * will be recorded or restored by editor.<br/>\n     * <br/>\n     * Similarly, the editor may failed to reset your component correctly in extreme cases. Then if you need<br/>\n     * to support the reset menu, you should manually synchronize your component's \"internal states\" with its<br/>\n     * properties in this function. Once you implement this function, all the getset accessors of your component<br/>\n     * will not be called during reset operation. Which means that only the properties with default value<br/>\n     * will be reset by editor.\n     *\n     * This function is only called in editor mode.\n     * @zh\n     * onRestore 是用户在检查器菜单点击 Reset 时，对此组件执行撤消操作后调用的。<br/>\n     * <br/>\n     * 如果组件包含了“内部状态”（不在 CCClass 属性中定义的临时成员变量），那么你可能需要实现该方法。<br/>\n     * <br/>\n     * 编辑器执行撤销/重做操作时，将调用组件的 get set 来录制和还原组件的状态。\n     * 然而，在极端的情况下，它可能无法良好运作。<br/>\n     * 那么你就应该实现这个方法，手动根据组件的属性同步“内部状态”。\n     * 一旦你实现这个方法，当用户撤销或重做时，组件的所有 get set 都不会再被调用。\n     * 这意味着仅仅指定了默认值的属性将被编辑器记录和还原。<br/>\n     * <br/>\n     * 同样的，编辑可能无法在极端情况下正确地重置您的组件。<br/>\n     * 于是如果你需要支持组件重置菜单，你需要在该方法中手工同步组件属性到“内部状态”。<br/>\n     * 一旦你实现这个方法，组件的所有 get set 都不会在重置操作时被调用。\n     * 这意味着仅仅指定了默认值的属性将被编辑器重置。\n     * <br/>\n     * 此方法仅在编辑器下会被调用。\n     */\n    protected onRestore? (): void;\n}\n\nconst proto = Component.prototype;\n// @ts-expect-error modify prototype\nproto.update = null;\n// @ts-expect-error modify prototype\nproto.lateUpdate = null;\n// @ts-expect-error modify prototype\nproto.__preload = null;\n// @ts-expect-error modify prototype\nproto.onLoad = null;\n// @ts-expect-error modify prototype\nproto.start = null;\n// @ts-expect-error modify prototype\nproto.onEnable = null;\n// @ts-expect-error modify prototype\nproto.onDisable = null;\n// @ts-expect-error modify prototype\nproto.onDestroy = null;\n// @ts-expect-error modify prototype\nproto.onFocusInEditor = null;\n// @ts-expect-error modify prototype\nproto.onLostFocusInEditor = null;\n// @ts-expect-error modify prototype\nproto.resetInEditor = null;\n// @ts-expect-error modify prototype\nproto._getLocalBounds = null;\n// @ts-expect-error modify prototype\nproto.onRestore = null;\n// @ts-expect-error modify class\nComponent._requireComponent = null;\n// @ts-expect-error modify class\nComponent._executionOrder = 0;\n\nif (EDITOR || TEST) {\n    // INHERITABLE STATIC MEMBERS\n    // @ts-expect-error modify static member\n    Component._executeInEditMode = false;\n    // @ts-expect-error modify static member\n    Component._playOnFocus = false;\n    // @ts-expect-error modify static member\n    Component._disallowMultiple = null;\n    // @ts-expect-error modify static member\n    Component._help = '';\n\n    // NON-INHERITED STATIC MEMBERS\n    // (TypeScript 2.3 will still inherit them, so always check hasOwnProperty before using)\n\n    value(Component, '_inspector', '', true);\n    value(Component, '_icon', '', true);\n\n    // COMPONENT HELPERS\n\n    // TODO Keep temporarily, compatible with old version\n    legacyCC._componentMenuItems = [];\n}\n\n// we make this non-enumerable, to prevent inherited by sub classes.\nvalue(Component, '_registerEditorProps', (cls, props) => {\n    let reqComp = props.requireComponent;\n    if (reqComp) {\n        if (Array.isArray(reqComp)) {\n            reqComp = reqComp.filter(Boolean);\n        }\n        cls._requireComponent = reqComp;\n    }\n    const order = props.executionOrder;\n    if (order && typeof order === 'number') {\n        cls._executionOrder = order;\n    }\n    if (EDITOR || TEST) {\n        const name = getClassName(cls);\n        for (const key in props) {\n            const val = props[key];\n            switch (key) {\n            case 'executeInEditMode':\n                cls._executeInEditMode = !!val;\n                break;\n\n            case 'playOnFocus':\n                if (val) {\n                    const willExecuteInEditMode = ('executeInEditMode' in props) ? props.executeInEditMode : cls._executeInEditMode;\n                    if (willExecuteInEditMode) {\n                        cls._playOnFocus = true;\n                    } else {\n                        warnID(3601, name);\n                    }\n                }\n                break;\n\n            case 'inspector':\n                value(cls, '_inspector', val, true);\n                break;\n\n            case 'icon':\n                value(cls, '_icon', val, true);\n                break;\n\n            case 'menu':\n            {\n                const frame = RF.peek();\n                let menu = val;\n                if (frame && !menu.includes('/')) {\n                    menu = `i18n:menu.custom_script/${menu}`;\n                }\n\n                EDITOR && EditorExtends.Component.removeMenu(cls);\n                EDITOR && EditorExtends.Component.addMenu(cls, menu, props.menuPriority);\n                break;\n            }\n\n            case 'disallowMultiple':\n                cls._disallowMultiple = cls;\n                break;\n\n            case 'requireComponent':\n            case 'executionOrder':\n                // skip here\n                break;\n\n            case 'help':\n                cls._help = val;\n                break;\n\n            default:\n                warnID(3602, key, name);\n                break;\n            }\n        }\n    }\n});\n\nlegacyCC.Component = Component;\nexport { Component };\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, inspector, editorOnly, serializable, editable } from 'cc.decorator';\nimport { EDITOR } from 'internal:constants';\nimport { getClassById } from '../utils/js';\nimport { BUILTIN_CLASSID_RE } from '../utils/misc';\nimport { Component } from './component';\nimport { legacyCC } from '../global-exports';\nimport { warnID, error } from '../platform/debug';\n\n/**\n * @en\n * A temp fallback to contain the original component which can not be loaded.\n * @zh\n * 包含无法加载的原始组件的临时回退。\n */\n@ccclass('cc.MissingScript')\n@inspector('packages://inspector/inspectors/comps/missing-script.js')\nexport default class MissingScript extends Component {\n    // _scriptUuid: {\n    //    get: function () {\n    //        var id = this._$erialized.__type__;\n    //        if (EditorExtends.UuidUtils.isUuid(id)) {\n    //            return EditorExtends.UuidUtils.decompressUuid(id);\n    //        }\n    //        return '';\n    //    },\n    // },\n\n    /*\n     * @param {string} id\n     * @return {function} constructor\n     */\n    public static safeFindClass (id: string) {\n        const cls = getClassById(id);\n        if (cls) {\n            return cls;\n        }\n        legacyCC.deserialize.reportMissingClass(id);\n\n        return undefined;\n    }\n\n    // the serialized data for original script object\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    @editorOnly\n    public _$erialized = null;\n\n    constructor () {\n        super();\n    }\n\n    public onLoad () {\n        warnID(4600, this.node.name);\n    }\n}\n\nlegacyCC._MissingScript = MissingScript;\n\n// DEBUG: Check MissingScript class for issue 9878\n// import { error } from '../platform/debug';\ntry {\n    const props = MissingScript.__values__;\n    if (props.length === 0 || props[props.length - 1] !== '_$erialized') {\n        error(`The '_$erialized' prop in MissingScript is missing. Please contact jare.`);\n        error(`    Error props: ['${props}']`);\n        // props.push('_$erialized');\n    }\n} catch (e) {\n    error(`Error when checking MissingScript 5, ${e}`);\n}\n","import { assertIsNonNullable, assertIsTrue } from './utils/asserts';\n\n/**\n * Tag to define the custom serialization method.\n * @internal\n */\nexport const serializeTag = Symbol('[[Serialize]]');\n\n/**\n * Tag to define the custom deserialization method.\n * @internal\n */\nexport const deserializeTag = Symbol('[[Deserialize]]');\n\nexport interface SerializationInput {\n    /**\n     * Reads a property from input.\n     * @param name Property name.\n     * @returns The property's value, after deserialized.\n     */\n    readProperty(name: string): unknown;\n\n    /**\n     * Deserializes this object according to the original procedure.\n     */\n    readThis(): void;\n\n    /**\n      * Deserializes super according to the original procedure.\n      */\n    readSuper(): void;\n}\n\nexport interface SerializationOutput {\n    /**\n     * Writes a property into output.\n     * @param name Property name.\n     * @param value Property value.\n     */\n    writeProperty(name: string, value: unknown): void;\n\n    /**\n     * Serialize this object according to the original procedure.\n     */\n    writeThis(): void;\n\n    /**\n     * Serialize super according to the original procedure.\n     */\n    writeSuper(): void;\n}\n\nexport type SerializationContext = {\n    /**\n     * The main serializing asset or root node in the scene/prefab passed to serialization procedure.\n     */\n    root: unknown;\n\n    /**\n     * True if the serialization procedure is targeting CCON.\n     */\n    toCCON: boolean;\n\n    /**\n     * Customized arguments passed to serialization procedure.\n     */\n    customArguments: Record<PropertyKey, unknown>\n};\n\nexport type DeserializationContext = {\n    /**\n     * True if the deserialization procedure is deserializing from CCON.\n     */\n    fromCCON: boolean;\n};\n\nexport interface CustomSerializable {\n    [serializeTag](output: SerializationOutput, context: SerializationContext): void;\n\n    [deserializeTag]?(input: SerializationInput, context: DeserializationContext): void;\n}\n\n/**\n * Enables the custom serialize/deserialize method only if the (de)serialize procedure is targeting CCON.\n * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n */\nexport const enableIfCCON: MethodDecorator = <T>(\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    _target: Object,\n    propertyKey: PropertyKey,\n    descriptor: TypedPropertyDescriptor<T>,\n): TypedPropertyDescriptor<T> | void => {\n    const original = descriptor.value;\n    assertIsNonNullable(original);\n    if (propertyKey === serializeTag) {\n        return {\n            ...descriptor,\n            value: function wrapSerialize (output: SerializationOutput, context: SerializationContext) {\n                if (!context.toCCON) {\n                    output.writeThis();\n                } else {\n                    (original as unknown as CustomSerializable[typeof serializeTag]).call(this, output, context);\n                }\n            },\n        } as unknown as TypedPropertyDescriptor<T>;\n    } else {\n        assertIsTrue(propertyKey === deserializeTag, '@enableIfCCON should be only applied to custom (de)serialize method');\n        return {\n            ...descriptor,\n            value: function wrapDeserialize (input: SerializationInput, context: DeserializationContext) {\n                if (!context.fromCCON) {\n                    input.readThis();\n                } else {\n                    (original as unknown as NonNullable<CustomSerializable[typeof deserializeTag]>).call(this, input, context);\n                }\n            },\n        } as unknown as TypedPropertyDescriptor<T>;\n    }\n};\n","import legacyCC from '../../../predefine';\nimport { getError } from '../platform/debug';\n\nconst VERSION = 1;\n\nconst MAGIC = 0x4E4F4343;\n\nconst CHUNK_ALIGN_AS = 8;\n\nexport class CCON {\n    constructor (document: unknown, chunks: Uint8Array[]) {\n        this._document = document;\n        this._chunks = chunks;\n    }\n\n    get document () {\n        return this._document;\n    }\n\n    get chunks () {\n        return this._chunks;\n    }\n\n    private _document: unknown;\n    private _chunks: Uint8Array[];\n}\n\ninterface CCONPreface {\n    version: number;\n    document: unknown;\n    chunks: string[];\n}\n\nexport function encodeCCONJson (ccon: CCON, chunkURLs: string[]) {\n    return {\n        version: VERSION,\n        document: ccon.document,\n        chunks: chunkURLs,\n    } as unknown;\n}\n\nexport function parseCCONJson (json: unknown) {\n    const cconPreface = json as CCONPreface;\n\n    return {\n        chunks: cconPreface.chunks,\n        document: cconPreface.document,\n    };\n}\n\nexport function encodeCCONBinary (ccon: CCON) {\n    const { document, chunks } = ccon;\n\n    const jsonString = JSON.stringify(document);\n    const jsonBytes = encodeJson(jsonString);\n    const ccobBuilder = new BufferBuilder();\n\n    const header = new ArrayBuffer(12);\n    const headerView = new DataView(header);\n    headerView.setUint32(0, MAGIC, true); // Magic\n    headerView.setUint32(4, VERSION, true); // Version\n\n    ccobBuilder.append(headerView);\n\n    ccobBuilder.append(uint32Bytes(jsonBytes.byteLength));\n    ccobBuilder.append(jsonBytes);\n\n    for (const chunk of chunks) {\n        ccobBuilder.alignAs(CHUNK_ALIGN_AS);\n        ccobBuilder.append(uint32Bytes(chunk.byteLength));\n        ccobBuilder.append(chunk);\n    }\n\n    headerView.setUint32(8, ccobBuilder.byteLength, true);\n    return ccobBuilder.get();\n\n    function uint32Bytes (value: number): ArrayBufferView {\n        const bytes = new ArrayBuffer(4);\n        const view = new DataView(bytes);\n        view.setUint32(0, value, true);\n        return view;\n    }\n}\n\nexport function decodeCCONBinary (bytes: Uint8Array) {\n    if (bytes.length < 16) {\n        throw new InvalidCCONError(getError(13102));\n    }\n\n    const dataView = new DataView(\n        bytes.buffer,\n        bytes.byteOffset,\n        bytes.byteLength,\n    );\n\n    const magic = dataView.getUint32(0, true);\n    if (magic !== MAGIC) {\n        throw new InvalidCCONError(getError(13100));\n    }\n\n    const version = dataView.getUint32(4, true);\n    if (version !== VERSION) {\n        throw new InvalidCCONError(getError(13101, version));\n    }\n\n    const dataByteLength = dataView.getUint32(8, true);\n    if (dataByteLength !== dataView.byteLength) {\n        throw new InvalidCCONError(getError(13102));\n    }\n\n    let chunksStart = 12;\n\n    const jsonDataLength = dataView.getUint32(chunksStart, true);\n    chunksStart += 4;\n    const jsonData = new Uint8Array(dataView.buffer, chunksStart + dataView.byteOffset, jsonDataLength);\n    chunksStart += jsonDataLength;\n    const jsonString = decodeJson(jsonData);\n    let json: unknown;\n    try {\n        json = JSON.parse(jsonString);\n    } catch (err) {\n        throw new InvalidCCONError(err as string);\n    }\n\n    const chunks: Uint8Array[] = [];\n    while (chunksStart < dataView.byteLength) {\n        if (chunksStart % CHUNK_ALIGN_AS !== 0) {\n            const padding = CHUNK_ALIGN_AS - chunksStart % CHUNK_ALIGN_AS;\n            chunksStart += padding;\n        }\n        const chunkDataLength = dataView.getUint32(chunksStart, true);\n        chunksStart += 4;\n        chunks.push(new Uint8Array(dataView.buffer, chunksStart + dataView.byteOffset, chunkDataLength));\n        chunksStart += chunkDataLength;\n    }\n\n    if (chunksStart !== dataView.byteLength) {\n        throw new InvalidCCONError(getError(13102));\n    }\n\n    return new CCON(json, chunks);\n}\n\n/**\n * Partial signature of Node.js `Buffer`: https://nodejs.org/api/buffer.html\n */\ninterface Buffer {\n    buffer: ArrayBuffer;\n    byteOffset: number;\n    length: number;\n    toString(): string;\n}\n\ninterface BufferConstructor {\n    from(input: string, encoding: 'utf8'): Buffer;\n\n    from(buffer: ArrayBuffer, byteOffset?: number, byteLength?: number): Buffer;\n}\n\nfunction encodeJson (input: string) {\n    if (typeof TextEncoder !== 'undefined') {\n        return new TextEncoder().encode(input);\n    } else if ('Buffer' in globalThis) {\n        const { Buffer } = (globalThis as unknown as { Buffer: BufferConstructor });\n        const buffer = Buffer.from(input, 'utf8');\n        return new Uint8Array(\n            buffer.buffer,\n            buffer.byteOffset,\n            buffer.length,\n        );\n    } else {\n        throw new Error(getError(13103));\n    }\n}\n\nfunction decodeJson (data: Uint8Array) {\n    if (typeof TextDecoder !== 'undefined') {\n        return new TextDecoder().decode(data);\n    } else if ('Buffer' in globalThis) {\n        const { Buffer } = (globalThis as unknown as { Buffer: BufferConstructor });\n        // eslint-disable-next-line no-buffer-constructor\n        return Buffer.from(data.buffer, data.byteOffset, data.byteLength).toString();\n    } else {\n        throw new Error(getError(13104));\n    }\n}\n\nexport class InvalidCCONError extends Error { }\n\nexport class BufferBuilder {\n    private _viewOrPaddings: (ArrayBufferView | number)[] = [];\n    private _length = 0;\n\n    get byteLength () {\n        return this._length;\n    }\n\n    public alignAs (align: number) {\n        if (align !== 0) {\n            const remainder = this._length % align;\n            if (remainder !== 0) {\n                const padding = align - remainder;\n                this._viewOrPaddings.push(padding);\n                this._length += padding;\n                return padding;\n            }\n        }\n        return 0;\n    }\n\n    public append (view: ArrayBufferView) {\n        const result = this._length;\n        this._viewOrPaddings.push(view);\n        this._length += view.byteLength;\n        return result;\n    }\n\n    public get () {\n        const result = new Uint8Array(this._length);\n        let counter = 0;\n        this._viewOrPaddings.forEach((viewOrPadding) => {\n            if (typeof viewOrPadding === 'number') {\n                counter += viewOrPadding;\n            } else {\n                result.set(new Uint8Array(viewOrPadding.buffer, viewOrPadding.byteOffset, viewOrPadding.byteLength), counter);\n                counter += viewOrPadding.byteLength;\n            }\n        });\n        return result;\n    }\n}\n\nlegacyCC.internal.parseCCONJson = parseCCONJson;\nlegacyCC.internal.decodeCCONBinary = decodeCCONBinary;\nlegacyCC.internal.CCON = CCON;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, TEST, DEV, DEBUG, JSB, PREVIEW, SUPPORT_JIT } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport * as js from '../utils/js';\nimport * as misc from '../utils/misc';\nimport { CCClass, ENUM_TAG, BITMASK_TAG } from './class';\nimport * as Attr from './utils/attribute';\nimport MissingScript from '../components/missing-script';\nimport { Details } from './deserialize';\nimport { Platform } from '../../../pal/system-info/enum-type';\nimport { sys } from '../platform/sys';\nimport { error } from '../platform/debug';\nimport { CustomSerializable, DeserializationContext, deserializeTag, SerializationContext, SerializationInput } from './custom-serializable';\nimport type { deserialize, CCClassConstructor } from './deserialize';\nimport { CCON } from './ccon';\nimport { assertIsTrue } from './utils/asserts';\nimport { reportMissingClass as defaultReportMissingClass } from './report-missing-class';\nimport { Asset } from '..';\n\nfunction compileObjectTypeJit (\n    sources: string[],\n    defaultValue: unknown,\n    accessorToSet: string,\n    propNameLiteralToSet: string,\n    assumeHavePropIfIsValue: boolean,\n) {\n    if (defaultValue instanceof legacyCC.ValueType) {\n        // fast case\n        if (!assumeHavePropIfIsValue) {\n            sources.push('if(prop){');\n        }\n        const ctorCode = js.getClassName(defaultValue);\n        sources.push(`s._deserializeFastDefinedObject(o${accessorToSet},prop,${ctorCode});`);\n        if (!assumeHavePropIfIsValue) {\n            sources.push(`}else o${accessorToSet}=null;`);\n        }\n    } else {\n        sources.push(`\nif (prop) {\n    s._deserializeAndAssignField(o, prop, ${propNameLiteralToSet});\n} else {\n    o${accessorToSet}=null;\n}\n`);\n    }\n}\n\ntype ReportMissingClass = deserialize.ReportMissingClass;\n\ntype ClassFinder = deserialize.ClassFinder;\n\ntype SerializableClassConstructor = deserialize.SerializableClassConstructor;\n\nexport type CompiledDeserializeFn = (\n    deserializer: _Deserializer,\n    object: Record<string, unknown>,\n    deserialized: Record<string, unknown>,\n    constructor: AnyFunction,\n) => void;\n\nconst compileDeserialize = SUPPORT_JIT ? compileDeserializeJIT : compileDeserializeNative;\n\nconst DELIMITER = Attr.DELIMETER;\nconst POSTFIX_TYPE: `${typeof DELIMITER}type` = `${DELIMITER}type`;\nconst POSTFIX_EDITOR_ONLY: `${typeof DELIMITER}editorOnly` = `${DELIMITER}editorOnly`;\nconst POSTFIX_DEFAULT: `${typeof DELIMITER}default` = `${DELIMITER}default`;\nconst POSTFIX_FORMERLY_SERIALIZED_AS: `${typeof DELIMITER}formerlySerializedAs` = `${DELIMITER}formerlySerializedAs`;\ntype AttributeName = string;\ntype AttributeFormerlySerializedAs = `${AttributeName}${typeof POSTFIX_FORMERLY_SERIALIZED_AS}`;\ntype AttributeDefault = `${AttributeName}${typeof POSTFIX_DEFAULT}`;\ntype AttributeType = `${AttributeName}${typeof POSTFIX_TYPE}`;\ntype AttributeEditorOnly = `${AttributeName}${typeof POSTFIX_EDITOR_ONLY}`;\ntype AttrResult = {\n    [K: string]: typeof K extends AttributeFormerlySerializedAs ? string :\n        typeof K extends AttributeDefault ? unknown :\n        typeof K extends AttributeType ? AnyFunction :\n        typeof K extends AttributeEditorOnly ? boolean : never;\n};\n\nfunction compileDeserializeJIT (self: _Deserializer, klass: CCClassConstructor<unknown>): CompiledDeserializeFn {\n    const attrs: AttrResult = Attr.getClassAttrs(klass);\n\n    const props = klass.__values__;\n    // self, obj, serializedData, klass\n    const sources = [\n        'var prop;',\n    ];\n    const fastMode = misc.BUILTIN_CLASSID_RE.test(js.getClassId(klass));\n    // sources.push('var vb,vn,vs,vo,vu,vf;');    // boolean, number, string, object, undefined, function\n\n    for (let p = 0; p < props.length; p++) {\n        const propName = props[p];\n        // @ts-expect-error 2341\n        if ((PREVIEW || (EDITOR && self._ignoreEditorOnly)) && attrs[propName + POSTFIX_EDITOR_ONLY]) {\n            continue;   // skip editor only if in preview\n        }\n\n        let accessorToSet: string;\n        let propNameLiteralToSet: string;\n        if (CCClass.IDENTIFIER_RE.test(propName)) {\n            propNameLiteralToSet = `\"${propName}\"`;\n            accessorToSet = `.${propName}`;\n        } else {\n            propNameLiteralToSet = CCClass.escapeForJS(propName);\n            accessorToSet = `[${propNameLiteralToSet}]`;\n        }\n\n        let accessorToGet = accessorToSet;\n        if (attrs[propName + POSTFIX_FORMERLY_SERIALIZED_AS]) {\n            const propNameToRead = attrs[propName + POSTFIX_FORMERLY_SERIALIZED_AS] as string;\n            if (CCClass.IDENTIFIER_RE.test(propNameToRead)) {\n                accessorToGet = `.${propNameToRead}`;\n            } else {\n                accessorToGet = `[${CCClass.escapeForJS(propNameToRead)}]`;\n            }\n        }\n\n        sources.push(`prop=d${accessorToGet};`);\n        sources.push(`if(typeof ${JSB ? '(prop)' : 'prop'}!==\"undefined\"){`);\n\n        // function undefined object(null) string boolean number\n        const defaultValue = CCClass.getDefault(attrs[propName + POSTFIX_DEFAULT]);\n        const userType = attrs[propName + POSTFIX_TYPE] as AnyFunction | string | undefined;\n        if (fastMode && (defaultValue !== undefined || userType)) {\n            let isPrimitiveType;\n            if (defaultValue === undefined) {\n                isPrimitiveType = userType instanceof Attr.PrimitiveType || userType === ENUM_TAG || userType === BITMASK_TAG;\n            } else {\n                const defaultType = typeof defaultValue;\n                isPrimitiveType = defaultType === 'string'\n                                  || defaultType === 'number'\n                                  || defaultType === 'boolean';\n            }\n\n            if (isPrimitiveType) {\n                sources.push(`o${accessorToSet}=prop;`);\n            } else {\n                compileObjectTypeJit(sources, defaultValue, accessorToSet, propNameLiteralToSet, true);\n            }\n        } else {\n            sources.push(`${`if(typeof ${JSB ? '(prop)' : 'prop'}!==\"object\"){`\n                             + 'o'}${accessorToSet}=prop;`\n                         + `}else{`);\n            compileObjectTypeJit(sources, defaultValue, accessorToSet, propNameLiteralToSet, false);\n            sources.push('}');\n        }\n        sources.push('}');\n    }\n    if (legacyCC.js.isChildClassOf(klass, legacyCC._BaseNode) || legacyCC.js.isChildClassOf(klass, legacyCC.Component)) {\n        // @ts-expect-error 2341\n        if (PREVIEW || (EDITOR && self._ignoreEditorOnly)) {\n            const mayUsedInPersistRoot = js.isChildClassOf(klass, legacyCC.Node);\n            if (mayUsedInPersistRoot) {\n                sources.push('d._id&&(o._id=d._id);');\n            }\n        } else {\n            sources.push('d._id&&(o._id=d._id);');\n        }\n    }\n    if (props[props.length - 1] === '_$erialized') {\n        // deep copy original serialized data\n        sources.push('o._$erialized=JSON.parse(JSON.stringify(d));');\n        // parse the serialized data as primitive javascript object, so its __id__ will be dereferenced\n        sources.push('s._fillPlainObject(o._$erialized,d);');\n    }\n    // eslint-disable-next-line @typescript-eslint/no-implied-eval, no-new-func\n    return Function('s', 'o', 'd', 'k', sources.join('')) as CompiledDeserializeFn;\n}\n\nfunction compileDeserializeNative (_self: _Deserializer, klass: CCClassConstructor<unknown>): CompiledDeserializeFn {\n    const fastMode = misc.BUILTIN_CLASSID_RE.test(js.getClassId(klass));\n    const shouldCopyId = js.isChildClassOf(klass, legacyCC._BaseNode) || js.isChildClassOf(klass, legacyCC.Component);\n    let shouldCopyRawData = false;\n\n    const simpleProps: string[] = [];\n    let simplePropsToRead = simpleProps;\n    const advancedProps: string[] = [];\n    let advancedPropsToRead = advancedProps;\n    const advancedPropsValueType: any = [];\n\n    (() => {\n        const props: string[] = klass.__values__;\n        shouldCopyRawData = props[props.length - 1] === '_$erialized';\n\n        const attrs = Attr.getClassAttrs(klass);\n\n        for (let p = 0; p < props.length; p++) {\n            const propName = props[p];\n            let propNameToRead = propName;\n            if (attrs[propName + POSTFIX_FORMERLY_SERIALIZED_AS]) {\n                propNameToRead = attrs[propName + POSTFIX_FORMERLY_SERIALIZED_AS];\n            }\n            // function undefined object(null) string boolean number\n            const defaultValue = CCClass.getDefault(attrs[propName + POSTFIX_DEFAULT]);\n            const userType = attrs[propName + POSTFIX_TYPE] as AnyFunction | string | undefined;\n            let isPrimitiveType = false;\n            if (fastMode && (defaultValue !== undefined || userType)) {\n                if (defaultValue === undefined) {\n                    isPrimitiveType = userType instanceof Attr.PrimitiveType || userType === ENUM_TAG || userType === BITMASK_TAG;\n                } else {\n                    const defaultType = typeof defaultValue;\n                    isPrimitiveType = defaultType === 'string'\n                                      || defaultType === 'number'\n                                      || defaultType === 'boolean';\n                }\n            }\n            if (fastMode && isPrimitiveType) {\n                if (propNameToRead !== propName && simplePropsToRead === simpleProps) {\n                    simplePropsToRead = simpleProps.slice();\n                }\n                simpleProps.push(propName);\n                if (simplePropsToRead !== simpleProps) {\n                    simplePropsToRead.push(propNameToRead);\n                }\n            } else {\n                if (propNameToRead !== propName && advancedPropsToRead === advancedProps) {\n                    advancedPropsToRead = advancedProps.slice();\n                }\n                advancedProps.push(propName);\n                if (advancedPropsToRead !== advancedProps) {\n                    advancedPropsToRead.push(propNameToRead);\n                }\n                advancedPropsValueType.push((defaultValue instanceof legacyCC.ValueType) && defaultValue.constructor);\n            }\n        }\n    })();\n\n    return (s, o, d, k) => {\n        for (let i = 0; i < simpleProps.length; ++i) {\n            const prop = d[simplePropsToRead[i]];\n            if (prop !== undefined) {\n                o[simpleProps[i]] = prop;\n            }\n        }\n        for (let i = 0; i < advancedProps.length; ++i) {\n            const propName = advancedProps[i];\n            const prop = d[advancedPropsToRead[i]];\n            if (prop === undefined) {\n                continue;\n            }\n            if (!fastMode && typeof prop !== 'object') {\n                o[propName] = prop;\n            } else {\n                // fastMode (so will not simpleProp) or object\n                const valueTypeCtor = advancedPropsValueType[i];\n                if (valueTypeCtor) {\n                    if (fastMode || prop) {\n                        // @ts-expect-error 2341\n                        s._deserializeFastDefinedObject(o[propName] as Record<PropertyKey, unknown>, prop as SerializedGeneralTypedObject, valueTypeCtor);\n                    } else {\n                        o[propName] = null;\n                    }\n                } else if (prop) {\n                    // @ts-expect-error 2341\n                    s._deserializeAndAssignField(o, prop, propName);\n                } else {\n                    o[propName] = null;\n                }\n            }\n        }\n        if (shouldCopyId && d._id) {\n            o._id = d._id;\n        }\n        if (shouldCopyRawData) {\n            // deep copy original serialized data\n            o._$erialized = JSON.parse(JSON.stringify(d));\n            // parse the serialized data as primitive javascript object, so its __id__ will be dereferenced\n            // @ts-expect-error 2341\n            s._fillPlainObject(o._$erialized as Record<PropertyKey, unknown>, d);\n        }\n    };\n}\n\ntype TypedArrayViewConstructorName =\n    | 'Uint8Array' | 'Int8Array'\n    | 'Uint16Array' | 'Int16Array'\n    | 'Uint32Array' | 'Int32Array'\n    | 'Float32Array' | 'Float64Array';\n\ntype SerializedTypedArray = {\n    __id__: never;\n    __uuid__: never;\n    __type__: 'TypedArray';\n    array: number[];\n    ctor: TypedArrayViewConstructorName;\n};\n\ntype SerializedTypedArrayRef = {\n    __id__: never;\n    __uuid__: never;\n    __type__: 'TypedArrayRef';\n    ctor: TypedArrayViewConstructorName;\n    offset: number;\n    length: number;\n};\n\ntype SerializedGeneralTypedObject = {\n    __id__: never;\n    __uuid__: never;\n    __type__?: NotKnownTypeTag;\n} & Record<NotTypeTag, SerializedFieldValue>;\n\ntype SerializedObjectReference = {\n    __type__: never;\n    __uuid__: never;\n    __id__: number;\n}\n\ntype SerializedUUIDReference = {\n    __type__: never;\n    __id__: never;\n    __uuid__: string;\n    __expectedType__: string;\n};\n\ntype SerializedObject = SerializedTypedArray | SerializedTypedArrayRef | SerializedGeneralTypedObject;\n\ntype SerializedValue = SerializedObject | SerializedValue[] | string | number | boolean | null;\n\ntype SerializedPropertyKey = string | number;\n\ntype SerializedFieldObjectValue = SerializedObjectReference | SerializedUUIDReference | unknown;\n\ntype SerializedFieldValue = string | number | boolean | null | SerializedFieldObjectValue;\n\ntype NotA<T, ReservedNames> = T extends ReservedNames ? never : T;\n\ntype NotB<T, ReservedNames> = ReservedNames extends T ? never : T;\n\ntype FooName<T, ReservedNames> = NotA<T, ReservedNames> & NotB<T, ReservedNames>\n\ntype NotTypeTag = FooName<string, '__type__'>;\n\ntype NotKnownTypeTag = FooName<string, 'TypedArray' | 'TypedArrayRef'>;\n\ntype SerializedData = SerializedObject | SerializedObject[];\n\nclass DeserializerPool extends js.Pool<_Deserializer> {\n    constructor () {\n        super((deserializer: _Deserializer) => {\n            deserializer.clear();\n        }, 1);\n    }\n\n    // @ts-expect-error We only use this signature.\n    public get (\n        details: Details,\n        classFinder: ClassFinder,\n        reportMissingClass: ReportMissingClass,\n        customEnv: unknown,\n        ignoreEditorOnly: boolean | undefined,\n    ) {\n        const cache = this._get();\n        if (cache) {\n            cache.reset(details, classFinder, reportMissingClass, customEnv, ignoreEditorOnly);\n            return cache;\n        } else {\n            return new _Deserializer(details, classFinder, reportMissingClass, customEnv, ignoreEditorOnly);\n        }\n    }\n}\n\nclass _Deserializer {\n    public static pool: DeserializerPool = new DeserializerPool();\n\n    public declare result: Details;\n    public declare customEnv: unknown;\n    public deserializedList: Array<Record<PropertyKey, unknown> | undefined>;\n    public deserializedData: any;\n    private declare _classFinder: ClassFinder;\n    private declare _reportMissingClass: ReportMissingClass;\n    private declare _onDereferenced: ClassFinder['onDereferenced'];\n    private _ignoreEditorOnly: any;\n    private declare _mainBinChunk: Uint8Array;\n    private declare _serializedData: SerializedObject | SerializedObject[];\n    private declare _context: DeserializationContext;\n\n    constructor (result: Details, classFinder: ClassFinder, reportMissingClass: ReportMissingClass, customEnv: unknown, ignoreEditorOnly: unknown) {\n        this.result = result;\n        this.customEnv = customEnv;\n        this.deserializedList = [];\n        this.deserializedData = null;\n        this._classFinder = classFinder;\n        this._reportMissingClass = reportMissingClass;\n        this._onDereferenced = classFinder?.onDereferenced;\n        if (DEV) {\n            this._ignoreEditorOnly = ignoreEditorOnly;\n        }\n    }\n\n    public reset (result: Details, classFinder: ClassFinder, reportMissingClass: ReportMissingClass, customEnv: unknown, ignoreEditorOnly: unknown) {\n        this.result = result;\n        this.customEnv = customEnv;\n        this._classFinder = classFinder;\n        this._reportMissingClass = reportMissingClass;\n        this._onDereferenced = classFinder?.onDereferenced;\n        if (DEV) {\n            this._ignoreEditorOnly = ignoreEditorOnly;\n        }\n    }\n\n    public clear () {\n        this.result = null!;\n        this.customEnv = null;\n        this.deserializedList.length = 0;\n        this.deserializedData = null;\n        this._classFinder = null!;\n        this._reportMissingClass = null!;\n        this._onDereferenced = null!;\n    }\n\n    public deserialize (serializedData: SerializedData | CCON) {\n        let fromCCON = false;\n        let jsonObj: SerializedData;\n        if (serializedData instanceof CCON) {\n            fromCCON = true;\n            jsonObj = serializedData.document as SerializedData;\n            if (serializedData.chunks.length > 0) {\n                assertIsTrue(serializedData.chunks.length === 1);\n                this._mainBinChunk = serializedData.chunks[0];\n            }\n        } else {\n            jsonObj = serializedData;\n        }\n\n        this._serializedData = jsonObj;\n        this._context = {\n            fromCCON,\n        };\n\n        const serializedRootObject = Array.isArray(jsonObj) ? jsonObj[0] : jsonObj;\n\n        if (EDITOR || TEST) {\n            this.deserializedData = this._deserializeObject(serializedRootObject, 0, this.deserializedList, `${0}`);\n        } else {\n            this.deserializedData = this._deserializeObject(serializedRootObject, 0);\n        }\n\n        this._serializedData = undefined!;\n        this._mainBinChunk = undefined!;\n        this._context = undefined!;\n\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return this.deserializedData;\n    }\n\n    /**\n     * @param serialized - The object to deserialize, must be non-nil.\n     * @param globalIndex - If the object is deserialized from \"root objects\" array.\n     * @param owner - Tracing purpose.\n     * @param propName - Tracing purpose.\n     */\n    private _deserializeObject (\n        serialized: SerializedObject,\n        globalIndex: number,\n        owner?: Record<PropertyKey, unknown> | unknown[],\n        propName?: string,\n    ) {\n        switch (serialized.__type__) {\n        case 'TypedArray':\n            return this._deserializeTypedArrayView(serialized);\n        case 'TypedArrayRef':\n            return this._deserializeTypedArrayViewRef(serialized);\n        default:\n            if (serialized.__type__) { // Typed object (including CCClass)\n                return this._deserializeTypeTaggedObject(serialized, globalIndex, owner, propName);\n            } else if (!Array.isArray(serialized)) { // Embedded primitive javascript object\n                return this._deserializePlainObject(serialized);\n            } else { // Array\n                return this._deserializeArray(serialized);\n            }\n        }\n    }\n\n    private _deserializeTypedArrayView (value: SerializedTypedArray) {\n        return globalThis[value.ctor].from(value.array);\n    }\n\n    private _deserializeTypedArrayViewRef (value: SerializedTypedArrayRef) {\n        const { offset, length, ctor: constructorName } = value;\n        const obj = new globalThis[constructorName](\n            this._mainBinChunk.buffer,\n            this._mainBinChunk.byteOffset + offset,\n            length,\n        );\n        return obj;\n    }\n\n    private _deserializeArray (value: SerializedValue[]) {\n        const obj = new Array<unknown>(value.length);\n        let prop: unknown;\n        for (let i = 0; i < value.length; i++) {\n            prop = value[i];\n            if (typeof prop === 'object' && prop) {\n                const isAssetType = this._deserializeAndAssignField(obj, prop, `${i}`);\n                if (isAssetType) {\n                    // fill default value for primitive objects (no constructor)\n                    obj[i] = null;\n                }\n            } else {\n                obj[i] = prop;\n            }\n        }\n        return obj;\n    }\n\n    private _deserializePlainObject (value: Record<string, unknown>) {\n        const obj = {};\n        this._fillPlainObject(obj, value);\n        return obj;\n    }\n\n    private _deserializeTypeTaggedObject (\n        value: SerializedGeneralTypedObject,\n        globalIndex: number,\n        owner?: Record<PropertyKey, unknown> | unknown[],\n        propName?: string,\n    ) {\n        const type = value.__type__ as unknown as string;\n\n        const klass = this._classFinder(type, value, owner, propName);\n        if (!klass) {\n            const notReported = this._classFinder === js.getClassById;\n            if (notReported) {\n                this._reportMissingClass(type);\n            }\n            return null;\n        }\n\n        const createObject = (constructor: deserialize.SerializableClassConstructor) => {\n            // eslint-disable-next-line new-cap\n            const obj = new constructor() as Record<string, unknown>;\n            if (globalIndex >= 0) {\n                this.deserializedList[globalIndex] = obj;\n            }\n            return obj;\n        };\n\n        if (!(EDITOR && legacyCC.js.isChildClassOf(klass, legacyCC.Component))) {\n            const obj = createObject(klass);\n            this._deserializeInto(value, obj, klass);\n            return obj;\n        } else {\n            try {\n                const obj = createObject(klass);\n                this._deserializeInto(value, obj, klass);\n                return obj;\n            } catch (e: unknown) {\n                if (DEBUG) {\n                    error(`Deserialize ${klass.name} failed, ${(e as { stack: string; }).stack}`);\n                }\n                const obj = createObject(MissingScript);\n                this._deserializeInto(value, obj, MissingScript);\n                return obj;\n            }\n        }\n    }\n\n    private _deserializeInto (\n        value: SerializedGeneralTypedObject,\n        object: Record<PropertyKey, unknown>,\n        constructor: deserialize.SerializableClassConstructor,\n        skipCustomized = false,\n    ) {\n        if (!skipCustomized && (object as Partial<CustomSerializable>)[deserializeTag]) {\n            this._runCustomizedDeserialize(\n                value,\n                object as Record<PropertyKey, unknown> & CustomSerializable,\n                constructor,\n            );\n            return;\n        }\n\n        // cSpell:words Deserializable\n\n        type ClassicCustomizedDeserializable = { _deserialize: (content: unknown, deserializer: _Deserializer) => void; };\n        if ((object as Partial<ClassicCustomizedDeserializable>)._deserialize) {\n            // TODO: content check?\n            (object as ClassicCustomizedDeserializable)._deserialize((value as unknown as { content: unknown }).content, this);\n            return;\n        }\n\n        if (legacyCC.Class._isCCClass(constructor)) {\n            this._deserializeFireClass(object, value, constructor as CCClassConstructor<unknown>);\n        } else {\n            this._deserializeFastDefinedObject(object, value, constructor);\n        }\n    }\n\n    private _runCustomizedDeserialize (\n        value: SerializedGeneralTypedObject,\n        object: Record<PropertyKey, unknown> & CustomSerializable,\n        constructor: deserialize.SerializableClassConstructor,\n    ) {\n        const serializationInput: SerializationInput = {\n            readProperty: (name: string) => {\n                const serializedField = value[name];\n                if (typeof serializedField !== 'object' || !serializedField) {\n                    return serializedField as unknown;\n                } else {\n                    return this._deserializeObjectField(serializedField) as unknown;\n                }\n            },\n\n            readThis: () => {\n                this._deserializeInto(value, object, constructor, true);\n            },\n\n            readSuper: () => {\n                const superConstructor = js.getSuper(constructor);\n                if (superConstructor) {\n                    this._deserializeInto(value, object, superConstructor);\n                }\n            },\n        };\n\n        object[deserializeTag]!(serializationInput, this._context);\n    }\n\n    private _deserializeFireClass (obj: Record<PropertyKey, unknown>, serialized: SerializedGeneralTypedObject, klass: CCClassConstructor<unknown>) {\n        let deserialize: CompiledDeserializeFn;\n        // eslint-disable-next-line no-prototype-builtins\n        if (klass.hasOwnProperty('__deserialize__')) {\n            deserialize = klass.__deserialize__ as CompiledDeserializeFn;\n        } else {\n            deserialize = compileDeserialize(this, klass);\n\n            // DEBUG: Check MissingScript data for issue 9878\n            try {\n                if (klass === MissingScript) {\n                    const props: string[] = klass.__values__;\n                    if (props.length === 0 || props[props.length - 1] !== '_$erialized') {\n                        error(`The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save.`);\n                        error(`    Error props: ['${props}']. Please contact jare.`);\n                        // props.push('_$erialized');\n                    }\n\n                    const rawDeserialize: CompiledDeserializeFn = deserialize;\n                    deserialize = function (deserializer: _Deserializer,\n                        object: Record<string, unknown>,\n                        deserialized: Record<string, unknown>,\n                        constructor: AnyFunction) {\n                        rawDeserialize(deserializer, object, deserialized, constructor);\n                        if (!object._$erialized) {\n                            error(`Unable to stash previously serialized data. ${JSON.stringify(deserialized)}`);\n                        }\n                    };\n                }\n            } catch (e) {\n                error(`Error when checking MissingScript 6, ${e}`);\n            }\n\n            js.value(klass, '__deserialize__', deserialize, true);\n        }\n        deserialize(this, obj, serialized, klass);\n    }\n\n    private _deserializeAndAssignField (\n        obj: Record<PropertyKey, unknown> | unknown[],\n        serializedField: SerializedFieldObjectValue,\n        propName: string,\n    ) {\n        const id = (serializedField as Partial<SerializedObjectReference>).__id__;\n        if (typeof id === 'number') {\n            const field = this.deserializedList[id];\n            if (field) {\n                obj[propName] = field;\n            } else {\n                // TODO: assertion\n                const source = (this._serializedData as SerializedObject[])[id];\n                if (EDITOR || TEST) {\n                    obj[propName] = this._deserializeObject(source, id, obj, propName);\n                } else {\n                    obj[propName] = this._deserializeObject(source, id, undefined, propName);\n                }\n                this._onDereferenced?.(this.deserializedList, id, obj, propName);\n            }\n        } else {\n            const uuid = (serializedField as Partial<SerializedUUIDReference>).__uuid__;\n            if (uuid) {\n                const expectedType = (serializedField as SerializedUUIDReference).__expectedType__;\n                this.result.push(obj, propName, uuid, expectedType);\n            } else if (EDITOR || TEST) {\n                obj[propName] = this._deserializeObject(serializedField as SerializedObject, -1, obj, propName);\n            } else {\n                obj[propName] = this._deserializeObject(serializedField as SerializedObject, -1);\n            }\n        }\n        return false;\n    }\n\n    private _deserializeObjectField (serializedField: SerializedFieldObjectValue) {\n        const id = (serializedField as Partial<SerializedObjectReference>).__id__;\n        if (typeof id === 'number') {\n            const field = this.deserializedList[id];\n            if (field) {\n                return field;\n            } else {\n                // TODO: assertion\n                const source = (this._serializedData as SerializedObject[])[id];\n                const field = this._deserializeObject(source, id, undefined, undefined);\n                return field;\n            }\n        } else {\n            const uuid = (serializedField as Partial<SerializedUUIDReference>).__uuid__;\n            if (uuid) {\n                const _expectedType = (serializedField as SerializedUUIDReference).__expectedType__;\n                throw new Error(`Asset reference field serialization is currently not supported in custom serialization.`);\n            } else {\n                return this._deserializeObject(serializedField as SerializedObject, -1);\n            }\n        }\n    }\n\n    private _fillPlainObject (instance: Record<string, unknown>, serialized: Record<string, unknown>) {\n        for (const propName in serialized) {\n            // eslint-disable-next-line no-prototype-builtins\n            if (!serialized.hasOwnProperty(propName)) {\n                continue;\n            }\n            const prop = serialized[propName];\n            if (typeof prop !== 'object') {\n                if (propName !== '__type__'/* && k != '__id__' */) {\n                    instance[propName] = prop;\n                }\n            } else if (prop) {\n                const isAssetType = this._deserializeAndAssignField(instance, prop, propName);\n                if (isAssetType) {\n                    // fill default value for primitive objects (no constructor)\n                    instance[propName] = null;\n                }\n            } else {\n                instance[propName] = null;\n            }\n        }\n    }\n\n    private _deserializeFastDefinedObject (\n        instance: Record<PropertyKey, unknown>,\n        serialized: SerializedGeneralTypedObject,\n        klass: SerializableClassConstructor,\n    ) {\n        if (klass === legacyCC.Vec2) {\n            type SerializedVec2 = { x?: number; y?: number; };\n            instance.x = (serialized as SerializedVec2).x || 0;\n            instance.y = (serialized as SerializedVec2).y || 0;\n            return;\n        } else if (klass === legacyCC.Vec3) {\n            type SerializedVec3 = { x?: number; y?: number; z?: number; };\n            instance.x = (serialized as SerializedVec3).x || 0;\n            instance.y = (serialized as SerializedVec3).y || 0;\n            instance.z = (serialized as SerializedVec3).z || 0;\n            return;\n        } else if (klass === legacyCC.Color) {\n            type SerializedColor = { r?: number; g?: number; b?: number; a?: number; };\n            instance.r = (serialized as SerializedColor).r || 0;\n            instance.g = (serialized as SerializedColor).g || 0;\n            instance.b = (serialized as SerializedColor).b || 0;\n            const a = (serialized as SerializedColor).a;\n            instance.a = (a === undefined ? 255 : a);\n            return;\n        } else if (klass === legacyCC.Size) {\n            type SerializedSize = { width?: number; height?: number; };\n            instance.width = (serialized as SerializedSize).width || 0;\n            instance.height = (serialized as SerializedSize).height || 0;\n            return;\n        }\n\n        const attrs = Attr.getClassAttrs(klass);\n        // @ts-expect-error 2339\n        const props: string[] = klass.__values__;\n        if (DEBUG && !props) {\n            error(`Unable to deserialize ${js.getClassName(klass)}. `\n                + 'For non-CCClass types, they can only be marked as serializable by `CCClass.fastDefine`.');\n        }\n\n        for (let i = 0; i < props.length; i++) {\n            const propName: string = props[i];\n            let value = serialized[propName];\n            // eslint-disable-next-line no-prototype-builtins\n            const exists: boolean = (value !== undefined || serialized.hasOwnProperty(propName));\n            if (!exists) {\n                // not serialized,\n                // recover to default value in ValueType, because eliminated properties equals to\n                // its default value in ValueType, not default value in user class\n                value = CCClass.getDefault(attrs[propName + POSTFIX_DEFAULT]);\n            }\n\n            if (typeof value !== 'object') {\n                instance[propName] = value;\n            } else if (value) {\n                this._deserializeAndAssignField(instance, value, propName);\n            } else {\n                instance[propName] = null;\n            }\n        }\n    }\n}\n\nexport function deserializeDynamic (data: SerializedData | CCON, details: Details, options?: {\n    classFinder?: ClassFinder;\n    ignoreEditorOnly?: boolean;\n    createAssetRefs?: boolean;\n    customEnv?: unknown;\n    reportMissingClass?: ReportMissingClass;\n}) {\n    options = options || {};\n    const classFinder = options.classFinder || js.getClassById;\n    const createAssetRefs = options.createAssetRefs || sys.platform === Platform.EDITOR_CORE;\n    const customEnv = options.customEnv;\n    const ignoreEditorOnly = options.ignoreEditorOnly;\n    const reportMissingClass = options.reportMissingClass ?? legacyCC.deserialize.reportMissingClass;\n\n    // var oldJson = JSON.stringify(data, null, 2);\n\n    details.init();\n\n    const deserializer = _Deserializer.pool.get(details, classFinder, reportMissingClass, customEnv, ignoreEditorOnly);\n\n    legacyCC.game._isCloning = true;\n    const res = deserializer.deserialize(data);\n    legacyCC.game._isCloning = false;\n\n    _Deserializer.pool.put(deserializer);\n    if (createAssetRefs) {\n        details.assignAssetsBy((uuid, options) => (EditorExtends.serialize.asAsset(uuid, options.type) as Asset));\n    }\n\n    // var afterJson = JSON.stringify(data, null, 2);\n    // if (oldJson !== afterJson) {\n    //     throw new Error('JSON SHOULD not changed');\n    // }\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return res;\n}\n\nexport function parseUuidDependenciesDynamic (serialized: unknown) {\n    const depends = [];\n    const parseDependRecursively = (data: any, out: string[]) => {\n        if (!data || typeof data !== 'object' || typeof data.__id__ === 'number') { return; }\n        const uuid = data.__uuid__;\n        if (Array.isArray(data)) {\n            for (let i = 0, l = data.length; i < l; i++) {\n                parseDependRecursively(data[i], out);\n            }\n        } else if (uuid) {\n            out.push(uuid);\n        } else {\n            for (const prop in data) {\n                parseDependRecursively(data[prop], out);\n            }\n        }\n    };\n    parseDependRecursively(serialized, depends);\n    return depends;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, TEST, PREVIEW, BUILD, DEBUG, JSB, DEV } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport { ValueType } from '../value-types';\nimport { Vec2, Vec3, Vec4, Color, Size, Rect, Quat, Mat4 } from '../math';\nimport { warnID, errorID, getError } from '../platform/debug';\nimport * as js from '../utils/js';\n\nimport { deserializeDynamic, parseUuidDependenciesDynamic } from './deserialize-dynamic';\nimport { Asset } from '../assets/asset';\n\nimport { deserializeTag } from './custom-serializable';\nimport type { CCON } from './ccon';\nimport { reportMissingClass as defaultReportMissingClass } from './report-missing-class';\nimport type { CompiledDeserializeFn } from './deserialize-dynamic';\n\nconst FORCE_COMPILED = false; // TODO: BUILD;\n\n/** **************************************************************************\n * BUILT-IN TYPES / CONSTAINTS\n *************************************************************************** */\n\nconst SUPPORT_MIN_FORMAT_VERSION = 1;\nconst EMPTY_PLACEHOLDER = 0;\n\n// Used for Data.ValueType.\n// If a value type is not registered in this list, it will be serialized to Data.Class.\nconst BuiltinValueTypes: (typeof ValueType)[] = [\n    Vec2,   // 0\n    Vec3,   // 1\n    Vec4,   // 2\n    Quat,   // 3\n    Color,  // 4\n    Size,   // 5\n    Rect,   // 6\n    Mat4,   // 7\n];\n\n// Used for Data.ValueTypeCreated.\nfunction BuiltinValueTypeParsers_xyzw (obj: Vec4 | Quat, data: number[]) {\n    obj.x = data[1];\n    obj.y = data[2];\n    obj.z = data[3];\n    obj.w = data[4];\n}\nconst BuiltinValueTypeSetters: ((obj: any, data: number[]) => void)[] = [\n    (obj: Vec2, data: number[]) => {\n        obj.x = data[1];\n        obj.y = data[2];\n    },\n    (obj: Vec3, data: number[]) => {\n        obj.x = data[1];\n        obj.y = data[2];\n        obj.z = data[3];\n    },\n    BuiltinValueTypeParsers_xyzw,   // Vec4\n    BuiltinValueTypeParsers_xyzw,   // Quat\n    (obj: Color, data: number[]) => {\n        obj._val = data[1];\n    },\n    (obj: Size, data: number[]) => {\n        obj.width = data[1];\n        obj.height = data[2];\n    },\n    (obj: Rect, data: number[]) => {\n        obj.x = data[1];\n        obj.y = data[2];\n        obj.width = data[3];\n        obj.height = data[4];\n    },\n    (obj: Mat4, data: number[]) => {\n        Mat4.fromArray(obj, data, 1);\n    },\n];\n\nfunction serializeBuiltinValueTypes (obj: ValueType): IValueTypeData | null {\n    const ctor = obj.constructor as typeof ValueType;\n    const typeId = BuiltinValueTypes.indexOf(ctor);\n    switch (ctor) {\n    case Vec2:\n        // @ts-expect-error Complex typing\n        return [typeId, obj.x, obj.y];\n    case Vec3:\n        // @ts-expect-error Complex typing\n        return [typeId, obj.x, obj.y, obj.z];\n    case Vec4:\n    case Quat:\n        // @ts-expect-error Complex typing\n        return [typeId, obj.x, obj.y, obj.z, obj.w];\n    case Color:\n        // @ts-expect-error Complex typing\n        return [typeId, obj._val];\n    case Size:\n        // @ts-expect-error Complex typing\n        return [typeId, obj.width, obj.height];\n    case Rect:\n        // @ts-expect-error Complex typing\n        return [typeId, obj.x, obj.y, obj.width, obj.height];\n    case Mat4: {\n        // @ts-expect-error Complex typing\n        const res: IValueTypeData = new Array<number>(1 + 16);\n        res[VALUETYPE_SETTER] = typeId;\n        Mat4.toArray(res, obj as Mat4, 1);\n        return res;\n    }\n    default:\n        return null;\n    }\n}\n\n// // TODO: Used for Data.TypedArray.\n// const TypedArrays = [\n//     Float32Array,\n//     Float64Array,\n//\n//     Int8Array,\n//     Int16Array,\n//     Int32Array,\n//\n//     Uint8Array,\n//     Uint16Array,\n//     Uint32Array,\n//\n//     Uint8ClampedArray,\n//     // BigInt64Array,\n//     // BigUint64Array,\n// ];\n\n/** **************************************************************************\n * TYPE DECLARATIONS\n *************************************************************************** */\n\n// Includes Bitwise NOT value.\n// Both T and U have non-negative integer ranges.\n// When the value >= 0 represents T\n// When the value is < 0, it represents ~U. Use ~x to extract the value of U.\ntype Bnot<T extends number, U extends number> = T|U;\n\n// Combines a boolean and a number into one value.\n// The number must >= 0.\n// When the value >= 0, the boolean is true, the number is value.\n// When the value < 0, the boolean is false, the number is ~value.\ntype BoolAndNum<B extends boolean, N extends number> = Bnot<N, N>;\n\ntype SharedString = string;\ntype Empty = typeof EMPTY_PLACEHOLDER;\ntype StringIndex = number;\ntype InstanceIndex = number;\ntype RootInstanceIndex = InstanceIndex;\ntype NoNativeDep = boolean;  // Indicates whether the asset depends on a native asset\ntype RootInfo = BoolAndNum<NoNativeDep, RootInstanceIndex>;\n\n// When the value >= 0 represents the string index\n// When the value is < 0, it just represents non-negative integer. Use ~x to extract the value.\ntype StringIndexBnotNumber = Bnot<StringIndex, number>;\n\n// A reverse index used to assign current parsing object to target command buffer so it could be assembled later.\n// Should >= REF.OBJ_OFFSET\ntype ReverseIndex = number;\n\n// Used to index the current object\ntype InstanceBnotReverseIndex = Bnot<InstanceIndex, ReverseIndex>;\n\n// shared with the editor\nexport declare namespace deserialize.Internal {\n    export type SharedString_ = SharedString;\n    export type Empty_ = Empty;\n    export type StringIndex_ = StringIndex;\n    export type InstanceIndex_ = InstanceIndex;\n    export type StringIndexBnotNumber_ = StringIndexBnotNumber;\n}\n\nconst enum DataTypeID {\n\n    // Fields that can be assigned directly, can be values in any JSON, or even a complex JSON array, object (no type).\n    // Contains null, no undefined, JSON does not support serialization of undefined.\n    // This is the only type that supports null, and all other advanced fields are forbidden with null values.\n    // If the value of an object is likely to be null, it needs to exist as a new class,\n    // but the probability of this is very low and will be analyzed below.\n    SimpleType = 0,\n\n    // --------------------------------------------------------------------------\n    // Except Simple, the rest belong to Advanced Type.\n\n    // Rarely will it be NULL, as NULL will be dropped as the default value.\n    InstanceRef,\n\n    // Arrays of exactly equal types.\n    // Arrays will have default values that developers will rarely assign to null manually.\n    Array_InstanceRef,\n    Array_AssetRefByInnerObj,\n\n    // Embedded object\n    // Rarely will it be NULL, as NULL will be dropped as the default value.\n    Class,\n\n    // Existing ValueType (created by the Class constructor).\n    // Developers will rarely manually assign a null.\n    ValueTypeCreated,\n\n    // Resource reference for embedded objects (such as arrays), the value is the index of DEPEND_OBJS.\n    // (The objects in INSTANCES do not need to dynamically resolve resource reference relationships, so there is no need to have the AssetRef type.)\n    AssetRefByInnerObj,\n\n    // Common TypedArray for legacyCC.Node only. Never be null.\n    TRS,\n\n    // // From the point of view of simplified implementation,\n    // // it is not supported to deserialize TypedArray that is initialized to null in the constructor.\n    // // Also, the length of TypedArray cannot be changed.\n    // // Developers will rarely manually assign a null.\n    // TypedArray,\n\n    // ValueType without default value (in arrays, dictionaries).\n    // Developers will rarely manually assign a null.\n    ValueType,\n\n    Array_Class,\n\n    // CustomizedClass embedded in Class\n    CustomizedClass,\n\n    // Universal dictionary with unlimited types of values (except TypedArray)\n    Dict,\n\n    // Universal arrays, of any type (except TypedArray) and can be unequal.\n    // (The editor doesn't seem to have a good way of stopping arrays of unequal types either)\n    Array,\n\n    ARRAY_LENGTH,\n}\n\nexport declare namespace deserialize.Internal {\n    export import DataTypeID_ = DataTypeID;\n    export type DataTypes_ = DataTypes;\n}\n\ninterface DataTypes {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    [DataTypeID.SimpleType]: number | string | boolean | null | object;\n    [DataTypeID.InstanceRef]: InstanceBnotReverseIndex;\n    [DataTypeID.Array_InstanceRef]: DataTypes[DataTypeID.InstanceRef][];\n    [DataTypeID.Array_AssetRefByInnerObj]: DataTypes[DataTypeID.AssetRefByInnerObj][];\n    [DataTypeID.Class]: IClassObjectData;\n    [DataTypeID.ValueTypeCreated]: IValueTypeData;\n    [DataTypeID.AssetRefByInnerObj]: number;\n    [DataTypeID.TRS]: ITRSData;\n    // [DataTypeID.TypedArray]: Array<InstanceOrReverseIndex>;\n    [DataTypeID.ValueType]: IValueTypeData;\n    [DataTypeID.Array_Class]: DataTypes[DataTypeID.Class][];\n    [DataTypeID.CustomizedClass]: ICustomObjectData;\n    [DataTypeID.Dict]: IDictData;\n    [DataTypeID.Array]: IArrayData;\n}\n\ntype PrimitiveObjectTypeID = (\n    DataTypeID.SimpleType | // SimpleType also includes any pure JSON object\n    DataTypeID.Array |\n    DataTypeID.Array_Class |\n    DataTypeID.Array_AssetRefByInnerObj |\n    DataTypeID.Array_InstanceRef |\n    DataTypeID.Dict\n);\n\ntype AdvancedTypeID = Exclude<DataTypeID, DataTypeID.SimpleType>;\n\n// Collection of all data types\ntype AnyData = DataTypes[keyof DataTypes];\n\ntype AdvancedData = DataTypes[Exclude<keyof DataTypes, DataTypeID.SimpleType>];\n\ntype OtherObjectData = ICustomObjectDataContent | Exclude<DataTypes[PrimitiveObjectTypeID], (number|string|boolean|null)>;\n\n// class Index of DataTypeID.CustomizedClass or PrimitiveObjectTypeID\ntype OtherObjectTypeID = Bnot<number, PrimitiveObjectTypeID>;\n\ntype Ctor<T> = new() => T;\n// Includes normal CCClass and fast defined class\nexport interface CCClassConstructor<T> extends Ctor<T> {\n    __values__: string[]\n    __deserialize__?: CompiledDeserializeFn;\n}\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype AnyCtor = Ctor<Object>;\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype AnyCCClass = CCClassConstructor<Object>;\n\nexport declare namespace deserialize.Internal {\n    export type AnyData_ = AnyData;\n    export type OtherObjectData_ = OtherObjectData;\n    export type OtherObjectTypeID_ = OtherObjectTypeID;\n    export type AnyCCClass_ = AnyCCClass;\n}\n\n/**\n * If the value type is different, different Classes will be generated\n */\nconst CLASS_TYPE = 0;\nconst CLASS_KEYS = 1;\nconst CLASS_PROP_TYPE_OFFSET = 2;\ntype IClass = [\n    string|AnyCtor,\n    string[],\n    // offset - It is used to specify the correspondence between the elements in CLASS_KEYS and their AdvancedType,\n    //          which is only valid for AdvancedType.\n    // When parsing, the type of IClass[CLASS_KEYS][x] is IClass[x + IClass[CLASS_PROP_TYPE_OFFSET]]\n    // When serializing, IClass[CLASS_PROP_TYPE_OFFSET] = CLASS_PROP_TYPE_OFFSET + 1 - (The number of SimpleType)\n    number,\n    // The AdvancedType type corresponding to the property.\n    ...DataTypeID[]\n];\n\n/**\n * Mask is used to define the properties and types that need to be deserialized.\n * Instances of the same class may have different Masks due to different default properties removed.\n */\nconst MASK_CLASS = 0;\ntype IMask = [\n    // The index of its Class\n    number,\n    // The indices of the property that needs to be deserialized in IClass, except that the last number represents OFFSET.\n    // All properties before OFFSET are SimpleType, and those starting at OFFSET are AdvancedType.\n    // default is 1\n    ...number[]\n];\n\nconst OBJ_DATA_MASK = 0;\ntype IClassObjectData = [\n    // The index of its Mask\n    number,\n    // Starting from 1, the values corresponding to the properties in the Mask\n    ...AnyData[]\n];\n\ntype ICustomObjectDataContent = any;\n\nconst CUSTOM_OBJ_DATA_CLASS = 0;\nconst CUSTOM_OBJ_DATA_CONTENT = 1;\ninterface ICustomObjectData extends Array<any> {\n    // The index of its Class\n    [CUSTOM_OBJ_DATA_CLASS]: number;\n    // Content\n    [CUSTOM_OBJ_DATA_CONTENT]: ICustomObjectDataContent;\n}\n\nconst VALUETYPE_SETTER = 0;\ntype IValueTypeData = [\n    // Predefined parsing function index\n    number,\n    // Starting with 1, the corresponding value in the attributes are followed in order\n    ...number[]\n];\n\ntype ITRSData = [number, number, number, number, number,\n    number, number, number, number, number];\n\nconst DICT_JSON_LAYOUT = 0;\ninterface IDictData extends Array<any> {\n    // The raw json object\n    [DICT_JSON_LAYOUT]: any,\n    // key\n    // Shared strings are not considered here, can be defined as CCClass if it is required.\n    [1]: string;\n    // value type\n    // Should not be SimpleType, SimpleType is built directly into DICT_JSON_LAYOUT.\n    [2]: AdvancedTypeID;\n    // value\n    [3]: AdvancedData;\n    // More repeated key values\n    [index: number]: any,\n}\n\nconst ARRAY_ITEM_VALUES = 0;\ntype IArrayData = [\n    AnyData[],\n    // types\n    ...DataTypeID[]\n];\n\nexport declare namespace deserialize.Internal {\n    export type IClass_ = IClass;\n    export type IMask_ = IMask;\n    export type IClassObjectData_ = IClassObjectData;\n    export type ICustomObjectDataContent_ = ICustomObjectDataContent;\n    export type ICustomObjectData_ = ICustomObjectData;\n    export type ITRSData_ = ITRSData;\n    export type IDictData_ = IDictData;\n    export type IArrayData_ = IArrayData;\n}\n\n// const TYPEDARRAY_TYPE = 0;\n// const TYPEDARRAY_ELEMENTS = 1;\n// interface ITypedArrayData extends Array<number|number[]> {\n//     [TYPEDARRAY_TYPE]: number,\n//     [TYPEDARRAY_ELEMENTS]: number[],\n// }\n\nconst enum Refs {\n    EACH_RECORD_LENGTH = 3,\n    OWNER_OFFSET = 0,\n    KEY_OFFSET = 1,\n    TARGET_OFFSET = 2,\n}\n\ninterface IRefs extends Array<number> {\n    // owner\n    // The owner of all the objects in the front is of type object, starting from OFFSET * 3 are of type InstanceIndex\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    [0]: (object | InstanceIndex),\n    // property name\n    [1]?: StringIndexBnotNumber;\n    // target object\n    [2]?: InstanceIndex;\n    // All the following objects are arranged in the order of the first three values,\n    // except that the last number represents OFFSET.\n    [index: number]: any;\n}\n\nconst enum File {\n    Version = 0,\n    Context = 0,\n\n    SharedUuids,\n    SharedStrings,\n    SharedClasses,\n    SharedMasks,\n\n    Instances,\n    InstanceTypes,\n\n    Refs,\n\n    DependObjs,\n    DependKeys,\n    DependUuidIndices,\n\n    ARRAY_LENGTH,\n}\n\n// Main file structure\ninterface IFileData extends Array<any> {\n    // version\n    [File.Version]: number | FileInfo | any;\n\n    // Shared data area, the higher the number of references, the higher the position\n\n    [File.SharedUuids]: SharedString[] | Empty; // Shared uuid strings for dependent assets\n    [File.SharedStrings]: SharedString[] | Empty;\n    [File.SharedClasses]: (IClass|string|AnyCCClass)[];\n    [File.SharedMasks]: IMask[] | Empty;  // Shared Object layouts for IClassObjectData\n\n    // Data area\n\n    // A one-dimensional array to represent object datas, layout is [...IClassObjectData[], ...OtherObjectData[], RootInfo]\n    // If the last element is not RootInfo(number), the first element will be the root object to return and it doesn't have native asset\n    [File.Instances]: (IClassObjectData|OtherObjectData|RootInfo)[];\n    [File.InstanceTypes]: OtherObjectTypeID[] | Empty;\n    // Object references infomation\n    [File.Refs]: IRefs | Empty;\n\n    // Result area\n\n    // Asset-dependent objects that are deserialized and parsed into object arrays\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    [File.DependObjs]: (object|InstanceIndex)[];\n    // Asset-dependent key name or array index\n    [File.DependKeys]: (StringIndexBnotNumber|string)[];\n    // UUID of dependent assets\n    [File.DependUuidIndices]: (StringIndex|string)[];\n}\n\n// type Body = Pick<IFileData, File.Instances | File.InstanceTypes | File.Refs | File.DependObjs | File.DependKeys | File.DependUuidIndices>\ntype Shared = Pick<IFileData, File.Version | File.SharedUuids | File.SharedStrings | File.SharedClasses | File.SharedMasks>;\nconst PACKED_SECTIONS = File.Instances;\ninterface IPackedFileData extends Shared {\n    [PACKED_SECTIONS]: IFileData[];\n}\n\nexport declare namespace deserialize.Internal {\n    export import Refs_ = Refs;\n    export type IRefs_ = IRefs;\n    export import File_ = File;\n    export type IFileData_ = IFileData;\n    export type IPackedFileData_ = IPackedFileData;\n}\n\ninterface ICustomHandler {\n    result: Details,\n    customEnv: any,\n}\ntype ClassFinder = (type: string) => AnyCtor;\n\ninterface IOptions extends Partial<ICustomHandler> {\n    classFinder?: ClassFinder;\n    reportMissingClass: deserialize.ReportMissingClass;\n    _version?: number;\n}\ninterface ICustomClass {\n    _deserialize?: (content: any, context: ICustomHandler) => void;\n}\n\n/** **************************************************************************\n * IMPLEMENTS\n *************************************************************************** */\n\n/**\n * @en Contains information collected during deserialization\n * @zh 包含反序列化时的一些信息。\n * @class Details\n */\nexport class Details {\n    /**\n     * @en\n     * the object list whose field needs to load asset by uuid\n     * @zh\n     * 对象列表，其中每个对象有属性需要通过 uuid 进行资源加载\n     */\n    uuidObjList: IFileData[File.DependObjs] | null = null;\n    /**\n     * @en\n     * the corresponding field name which referenced to the asset\n     * @zh\n     * 引用着资源的字段名称\n     */\n    uuidPropList: IFileData[File.DependKeys] | null = null;\n    /**\n     * @en\n     * list of the depends assets' uuid\n     * @zh\n     * 依赖资源的 uuid 列表\n     */\n    uuidList: IFileData[File.DependUuidIndices] | null = null;\n\n    /**\n     * @en\n     * list of the depends assets' type\n     * @zh\n     * 依赖的资源类型列表\n     */\n    uuidTypeList: string[] = [];\n\n    static pool = new js.Pool((obj: Details) => {\n        obj.reset();\n    }, 5);\n\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    public declare assignAssetsBy: (getter: (uuid: string, options: {\n        type: Constructor<Asset>;\n        owner: Record<string, unknown>;\n        prop: string;\n    }) => Asset) => void;\n\n    /**\n     * @method init\n     * @param {Object} data\n     */\n    init (data?: IFileData) {\n        if (FORCE_COMPILED || data) {\n            this.uuidObjList = data![File.DependObjs];\n            this.uuidPropList = data![File.DependKeys];\n            this.uuidList = data![File.DependUuidIndices];\n        } else {\n            // could be used by deserialize-dynamic\n            const used = this.uuidList;\n            if (!used) {\n                this.uuidList = [];\n                this.uuidObjList = [];\n                this.uuidPropList = [];\n                this.uuidTypeList = [];\n            }\n        }\n    }\n\n    /**\n     * @method reset\n     */\n    reset  () {\n        if (FORCE_COMPILED) {\n            this.uuidList = null;\n            this.uuidObjList = null;\n            this.uuidPropList = null;\n        } else {\n            // could be reused by deserialize-dynamic\n            const used = this.uuidList;\n            if (used) {\n                this.uuidList!.length = 0;\n                this.uuidObjList!.length = 0;\n                this.uuidPropList!.length = 0;\n                this.uuidTypeList.length = 0;\n            }\n        }\n    }\n\n    /**\n     * @method push\n     * @param {Object} obj\n     * @param {String} propName\n     * @param {String} uuid\n     */\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    push (obj: object, propName: string, uuid: string, type?: string) {\n        this.uuidObjList!.push(obj);\n        this.uuidPropList!.push(propName);\n        this.uuidList!.push(uuid);\n        this.uuidTypeList.push(type || '');\n    }\n}\nDetails.pool.get = function () {\n    return this._get() || new Details();\n};\nif (EDITOR || TEST) {\n    Details.prototype.assignAssetsBy = function (getter: (uuid: string, options: {\n        type: Constructor<Asset>;\n        owner: Record<string, unknown>;\n        prop: string;\n    }) => any) {\n        for (let i = 0, len = this.uuidList!.length; i < len; i++) {\n            const obj = this.uuidObjList![i] as Record<string, unknown>;\n            const prop = this.uuidPropList![i] as string;\n            const uuid = this.uuidList![i];\n            const type = this.uuidTypeList[i];\n            const _type = js.getClassById(type) as Constructor<Asset> || Asset;\n            obj[prop] = getter(uuid as string, {\n                type: _type,\n                owner: obj,\n                prop,\n            });\n        }\n    };\n}\n\nexport function dereference (refs: IRefs, instances: IFileData[File.Instances], strings: IFileData[File.SharedStrings]): void {\n    const dataLength = refs.length - 1;\n    let i = 0;\n    // owner is object\n    const instanceOffset: number = refs[dataLength] * Refs.EACH_RECORD_LENGTH;\n    for (; i < instanceOffset; i += Refs.EACH_RECORD_LENGTH) {\n        const owner = refs[i];\n\n        const target = instances[refs[i + Refs.TARGET_OFFSET]];\n        const keyIndex = refs[i + Refs.KEY_OFFSET] as StringIndexBnotNumber;\n        if (keyIndex >= 0) {\n            owner[strings[keyIndex]] = target;\n        } else {\n            owner[~keyIndex] = target;\n        }\n    }\n    // owner is instance index\n    for (; i < dataLength; i += Refs.EACH_RECORD_LENGTH) {\n        const owner = instances[refs[i]];\n\n        const target = instances[refs[i + Refs.TARGET_OFFSET]];\n        const keyIndex = refs[i + Refs.KEY_OFFSET] as StringIndexBnotNumber;\n        if (keyIndex >= 0) {\n            owner[strings[keyIndex]] = target;\n        } else {\n            owner[~keyIndex] = target;\n        }\n    }\n}\n\n//\n\nfunction deserializeCCObject (data: IFileData, objectData: IClassObjectData) {\n    const mask = data[File.SharedMasks][objectData[OBJ_DATA_MASK]];\n    const clazz = mask[MASK_CLASS];\n    const ctor = clazz[CLASS_TYPE] as Exclude<AnyCtor, ICustomClass>;\n    // if (!ctor) {\n    //     return null;\n    // }\n\n    // eslint-disable-next-line new-cap\n    const obj = new ctor();\n\n    const keys = clazz[CLASS_KEYS];\n    const classTypeOffset = clazz[CLASS_PROP_TYPE_OFFSET];\n    const maskTypeOffset = mask[mask.length - 1];\n\n    // parse simple type\n    let i = MASK_CLASS + 1;\n    for (; i < maskTypeOffset; ++i) {\n        const key = keys[mask[i]];\n        obj[key] = objectData[i];\n    }\n\n    // parse advanced type\n    for (; i < objectData.length; ++i) {\n        const key = keys[mask[i]];\n        // eslint-disable-next-line @typescript-eslint/restrict-plus-operands\n        const type = clazz[mask[i] + classTypeOffset];\n        const op = ASSIGNMENTS[type];\n        op(data, obj, key, objectData[i]);\n    }\n\n    return obj;\n}\n\nfunction deserializeCustomCCObject (data: IFileData, ctor: Ctor<ICustomClass>, value: ICustomObjectDataContent) {\n    // eslint-disable-next-line new-cap\n    const obj = new ctor();\n    if (obj._deserialize) {\n        obj._deserialize(value, data[File.Context]);\n    } else {\n        errorID(5303, js.getClassName(ctor));\n    }\n    return obj;\n}\n\n// Parse Functions\n\ntype ParseFunction<T> = (data: IFileData, owner: any, key: string, value: T) => void;\n\nfunction assignSimple (data: IFileData, owner: any, key: string, value: DataTypes[DataTypeID.SimpleType]) {\n    owner[key] = value;\n}\n\nfunction assignInstanceRef (data: IFileData, owner: any, key: string, value: InstanceBnotReverseIndex) {\n    if (value >= 0) {\n        owner[key] = data[File.Instances][value];\n    } else {\n        (data[File.Refs] as IRefs)[(~value) * Refs.EACH_RECORD_LENGTH] = owner;\n    }\n}\n\nfunction genArrayParser<T> (parser: ParseFunction<T>): ParseFunction<T[]> {\n    return (data: IFileData, owner: any, key: string, value: T[]) => {\n        owner[key] = value;\n        for (let i = 0; i < value.length; ++i) {\n            parser(data, value, i as unknown as string, value[i]);\n        }\n    };\n}\n\nfunction parseAssetRefByInnerObj (data: IFileData, owner: any, key: string, value: number) {\n    owner[key] = null;\n    data[File.DependObjs][value] = owner;\n}\n\nfunction parseClass (data: IFileData, owner: any, key: string, value: IClassObjectData) {\n    owner[key] = deserializeCCObject(data, value);\n}\n\nfunction parseCustomClass (data: IFileData, owner: any, key: string, value: ICustomObjectData) {\n    const ctor = data[File.SharedClasses][value[CUSTOM_OBJ_DATA_CLASS]] as CCClassConstructor<ICustomClass>;\n    owner[key] = deserializeCustomCCObject(data, ctor, value[CUSTOM_OBJ_DATA_CONTENT]);\n}\n\nfunction parseValueTypeCreated (data: IFileData, owner: any, key: string, value: IValueTypeData) {\n    /**BuiltinValueTypes index: Vec2=0, Vec3=1, Vec4=2, Quat=3, Color=4, Size=5, Rect=6, Mat4=7\n       The native layer type corresponding to the BuiltinValueTypes has not been exported exclude Color,\n       so we need to set to native after value changed\n     * */\n    if (JSB) {\n        const tmp = owner[key];\n        BuiltinValueTypeSetters[value[VALUETYPE_SETTER]](tmp, value);\n        owner[key] = tmp;\n    } else {\n        BuiltinValueTypeSetters[value[VALUETYPE_SETTER]](owner[key], value);\n    }\n}\n\nfunction parseValueType (data: IFileData, owner: any, key: string, value: IValueTypeData) {\n    const val: ValueType = new BuiltinValueTypes[value[VALUETYPE_SETTER]]();\n    BuiltinValueTypeSetters[value[VALUETYPE_SETTER]](val, value);\n    owner[key] = val;\n}\n\nfunction parseTRS (data: IFileData, owner: any, key: string, value: ITRSData) {\n    const typedArray = owner[key] as (Float32Array | Float64Array);\n    typedArray.set(value);\n}\n\nfunction parseDict (data: IFileData, owner: any, key: string, value: IDictData) {\n    const dict = value[DICT_JSON_LAYOUT];\n    owner[key] = dict;\n    for (let i = DICT_JSON_LAYOUT + 1; i < value.length; i += 3) {\n        const subKey = value[i] as string;\n        const subType = value[i + 1] as DataTypeID;\n        const subValue = value[i + 2] as AnyData;\n        const op = ASSIGNMENTS[subType];\n        op(data, dict, subKey, subValue);\n    }\n}\n\nfunction parseArray (data: IFileData, owner: any, key: string, value: IArrayData) {\n    const array = value[ARRAY_ITEM_VALUES];\n    owner[key] = array;\n    for (let i = 0; i < array.length; ++i) {\n        const subValue = array[i];\n        const type = value[i + 1] as DataTypeID;\n        if (type !== DataTypeID.SimpleType) {\n            const op = ASSIGNMENTS[type];\n            op(data, array, i, subValue);\n        }\n    }\n}\n\n// function parseTypedArray (data: IFileData, owner: any, key: string, value: ITypedArrayData) {\n//     let val: ValueType = new TypedArrays[value[TYPEDARRAY_TYPE]]();\n//     BuiltinValueTypeSetters[value[VALUETYPE_SETTER]](val, value);\n//     // obj = new window[serialized.ctor](array.length);\n//     // for (let i = 0; i < array.length; ++i) {\n//     //     obj[i] = array[i];\n//     // }\n//     // return obj;\n//     owner[key] = val;\n// }\n\nconst ASSIGNMENTS: {\n    [K in keyof DataTypes]?: ParseFunction<DataTypes[K]>;\n// eslint-disable-next-line @typescript-eslint/ban-types\n} = new Array(DataTypeID.ARRAY_LENGTH) as {};\nASSIGNMENTS[DataTypeID.SimpleType] = assignSimple;    // Only be used in the instances array\nASSIGNMENTS[DataTypeID.InstanceRef] = assignInstanceRef;\nASSIGNMENTS[DataTypeID.Array_InstanceRef] = genArrayParser(assignInstanceRef);\nASSIGNMENTS[DataTypeID.Array_AssetRefByInnerObj] = genArrayParser(parseAssetRefByInnerObj);\nASSIGNMENTS[DataTypeID.Class] = parseClass;\nASSIGNMENTS[DataTypeID.ValueTypeCreated] = parseValueTypeCreated;\nASSIGNMENTS[DataTypeID.AssetRefByInnerObj] = parseAssetRefByInnerObj;\nASSIGNMENTS[DataTypeID.TRS] = parseTRS;\nASSIGNMENTS[DataTypeID.ValueType] = parseValueType;\nASSIGNMENTS[DataTypeID.Array_Class] = genArrayParser(parseClass);\nASSIGNMENTS[DataTypeID.CustomizedClass] = parseCustomClass;\nASSIGNMENTS[DataTypeID.Dict] = parseDict;\nASSIGNMENTS[DataTypeID.Array] = parseArray;\n// ASSIGNMENTS[DataTypeID.TypedArray] = parseTypedArray;\n\nfunction parseInstances (data: IFileData): RootInstanceIndex {\n    const instances = data[File.Instances];\n    const instanceTypes = data[File.InstanceTypes];\n    const instanceTypesLen = instanceTypes === EMPTY_PLACEHOLDER ? 0 : (instanceTypes).length;\n    let rootIndex = instances[instances.length - 1];\n    let normalObjectCount = instances.length - instanceTypesLen;\n    if (typeof rootIndex !== 'number') {\n        rootIndex = 0;\n    } else {\n        if (rootIndex < 0) {\n            rootIndex = ~rootIndex;\n        }\n        --normalObjectCount;\n    }\n\n    // DataTypeID.Class\n\n    let insIndex = 0;\n    for (; insIndex < normalObjectCount; ++insIndex) {\n        instances[insIndex] = deserializeCCObject(data, instances[insIndex] as IClassObjectData);\n    }\n\n    const classes = data[File.SharedClasses];\n    for (let typeIndex = 0; typeIndex < instanceTypesLen; ++typeIndex, ++insIndex) {\n        let type = instanceTypes[typeIndex] as OtherObjectTypeID;\n        const eachData = instances[insIndex];\n        if (type >= 0) {\n            // class index for DataTypeID.CustomizedClass\n\n            const ctor = classes[type] as CCClassConstructor<ICustomClass>;  // class\n            instances[insIndex] = deserializeCustomCCObject(data, ctor, eachData);\n        } else {\n            // Other\n\n            type = (~type) as PrimitiveObjectTypeID;\n            const op = ASSIGNMENTS[type];\n            op(data, instances, insIndex, eachData);\n        }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return rootIndex;\n}\n\n// const DESERIALIZE_AS = Attr.DELIMETER + 'deserializeAs';\n// function deserializeAs(klass: AnyCCClass, klassLayout: IClass) {\n//     var attrs = Attr.getClassAttrs(klass);\n//     let keys = klassLayout[CLASS_KEYS];\n//     for (let i = 0; i < keys.length; ++i) {\n//         let newKey = attrs[keys[i] + DESERIALIZE_AS];\n//         if (newKey) {\n//             // @ts-expect-error\n//             if (keys.includes(newKey)) {\n//                 // %s cannot be deserialized by property %s because %s was also present in the serialized data.\n//                 warnID(, newKey, keys[i], newKey);\n//             }\n//             else {\n//                 keys[i] = newKey;\n//             }\n//         }\n//     }\n// }\n\nfunction getMissingClass (hasCustomFinder, type, reportMissingClass: deserialize.ReportMissingClass) {\n    if (!hasCustomFinder) {\n        reportMissingClass(type);\n    }\n    return Object;\n}\nfunction doLookupClass (classFinder, type: string, container: any[], index: number, silent: boolean, hasCustomFinder, reportMissingClass: deserialize.ReportMissingClass) {\n    let klass = classFinder(type);\n    if (!klass) {\n        // if (klass.__FSA__) {\n        //     deserializeAs(klass, klassLayout as IClass);\n        // }\n        if (silent) {\n            // generate a lazy proxy for ctor\n            container[index] = ((c, i, t) => function proxy () {\n                const actualClass = classFinder(t) || getMissingClass(hasCustomFinder, t, reportMissingClass);\n                c[i] = actualClass;\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-return, new-cap\n                return new actualClass();\n            })(container, index, type);\n            return;\n        } else {\n            klass = getMissingClass(hasCustomFinder, type, reportMissingClass);\n        }\n    }\n    container[index] = klass;\n}\n\nfunction lookupClasses (data: IPackedFileData, silent: boolean, customFinder: ClassFinder | undefined, reportMissingClass: deserialize.ReportMissingClass) {\n    const classFinder = customFinder || js.getClassById;\n    const classes = data[File.SharedClasses];\n    for (let i = 0; i < classes.length; ++i) {\n        const klassLayout = classes[i];\n        if (typeof klassLayout !== 'string') {\n            if (DEBUG) {\n                if (typeof klassLayout[CLASS_TYPE] === 'function') {\n                    throw new Error('Can not deserialize the same JSON data again.');\n                }\n            }\n            const type: string = klassLayout[CLASS_TYPE];\n            doLookupClass(classFinder, type, klassLayout as IClass, CLASS_TYPE, silent, customFinder, reportMissingClass);\n        } else {\n            doLookupClass(classFinder, klassLayout, classes, i, silent, customFinder, reportMissingClass);\n        }\n    }\n}\n\nfunction cacheMasks (data: IPackedFileData) {\n    const masks = data[File.SharedMasks];\n    if (masks) {\n        const classes = data[File.SharedClasses];\n        for (let i = 0; i < masks.length; ++i) {\n            const mask = masks[i];\n            // @ts-expect-error Complex typing.\n            mask[MASK_CLASS] = classes[mask[MASK_CLASS]];\n        }\n    }\n}\n\nfunction parseResult (data: IFileData) {\n    const instances = data[File.Instances];\n    const sharedStrings = data[File.SharedStrings];\n    const dependSharedUuids = data[File.SharedUuids];\n\n    const dependObjs = data[File.DependObjs];\n    const dependKeys = data[File.DependKeys];\n    const dependUuids = data[File.DependUuidIndices];\n\n    for (let i = 0; i < dependObjs.length; ++i) {\n        const obj: any = dependObjs[i];\n        if (typeof obj === 'number') {\n            dependObjs[i] = instances[obj];\n        } else {\n            // assigned by DataTypeID.AssetRefByInnerObj or added by Details object directly in _deserialize\n        }\n        let key: any = dependKeys[i];\n        if (typeof key === 'number') {\n            if (key >= 0) {\n                key = sharedStrings[key];\n            } else {\n                key = ~key;\n            }\n            dependKeys[i] = key;\n        } else {\n            // added by Details object directly in _deserialize\n        }\n        const uuid = dependUuids[i];\n        if (typeof uuid === 'number') {\n            dependUuids[i] = (dependSharedUuids as SharedString[])[uuid];\n        } else {\n            // added by Details object directly in _deserialize\n        }\n    }\n}\n\nexport function isCompiledJson (json: unknown): boolean {\n    if (Array.isArray(json)) {\n        const version = json[0];\n        // array[0] will not be a number in the editor version\n        return typeof version === 'number' || version instanceof FileInfo;\n    } else {\n        return false;\n    }\n}\n\n/**\n * @module cc\n */\n\n/**\n * @en Deserializes a previously serialized object to reconstruct it to the original.\n * @zh 将序列化后的对象进行反序列化以使其复原。\n *\n * @param data Serialized data.\n * @param details - Additional loading result.\n * @param options Deserialization Options.\n * @return The original object.\n */\nexport function deserialize (data: IFileData | string | CCON | any, details: Details | any, options?: IOptions | any): unknown {\n    if (typeof data === 'string') {\n        data = JSON.parse(data);\n    }\n\n    const borrowDetails = !details;\n    details = details || Details.pool.get();\n    let res;\n\n    if (!FORCE_COMPILED && !isCompiledJson(data)) {\n        res = deserializeDynamic(data, details, options);\n    } else {\n        details.init(data);\n        options = options || {};\n\n        let version = data[File.Version];\n        let preprocessed = false;\n        if (typeof version === 'object') {\n            preprocessed = version.preprocessed;\n            version = version.version;\n        }\n        if (version < SUPPORT_MIN_FORMAT_VERSION) {\n            throw new Error(getError(5304, version));\n        }\n        options._version = version;\n        options.result = details;\n        data[File.Context] = options;\n\n        if (!preprocessed) {\n            lookupClasses(data, false, options.classFinder, options.reportMissingClass ?? deserialize.reportMissingClass);\n            cacheMasks(data);\n        }\n\n        legacyCC.game._isCloning = true;\n        const instances = data[File.Instances];\n        const rootIndex = parseInstances(data);\n        legacyCC.game._isCloning = false;\n\n        if (data[File.Refs]) {\n            dereference(data[File.Refs] as IRefs, instances, data[File.SharedStrings]);\n        }\n\n        parseResult(data);\n\n        res = instances[rootIndex];\n    }\n\n    if (borrowDetails) {\n        Details.pool.put(details);\n    }\n\n    return res;\n}\n\nexport declare namespace deserialize {\n    export type SerializableClassConstructor = new () => unknown;\n\n    export type ReportMissingClass = (id: string) => void;\n\n    export type ClassFinder = {\n        (id: string, serialized: unknown, owner?: unknown[] | Record<PropertyKey, unknown>, propName?: string): SerializableClassConstructor | undefined;\n\n        onDereferenced?: (deserializedList: Array<Record<PropertyKey, unknown> | undefined>, id: number, object: Record<string, unknown> | unknown[], propName: string) => void;\n    };\n}\n\ndeserialize.Details = Details;\ndeserialize.reportMissingClass = defaultReportMissingClass;\n\nclass FileInfo {\n    declare version: number;\n    preprocessed = true;\n    constructor (version: number) {\n        this.version = version;\n    }\n}\n\nexport function unpackJSONs (data: IPackedFileData, classFinder?: ClassFinder, reportMissingClass?: deserialize.ReportMissingClass): IFileData[] {\n    if (data[File.Version] < SUPPORT_MIN_FORMAT_VERSION) {\n        throw new Error(getError(5304, data[File.Version]));\n    }\n    lookupClasses(data, true, classFinder, reportMissingClass ?? deserialize.reportMissingClass);\n    cacheMasks(data);\n\n    const version = new FileInfo(data[File.Version]);\n    const sharedUuids = data[File.SharedUuids];\n    const sharedStrings = data[File.SharedStrings];\n    const sharedClasses = data[File.SharedClasses];\n    const sharedMasks = data[File.SharedMasks];\n\n    const sections = data[PACKED_SECTIONS];\n    for (let i = 0; i < sections.length; ++i) {\n        sections[i].unshift(version, sharedUuids, sharedStrings, sharedClasses, sharedMasks);\n    }\n    return sections;\n}\n\nexport function packCustomObjData (type: string, data: IClassObjectData|OtherObjectData, hasNativeDep?: boolean): IFileData {\n    return [\n        SUPPORT_MIN_FORMAT_VERSION, EMPTY_PLACEHOLDER, EMPTY_PLACEHOLDER,\n        [type],\n        EMPTY_PLACEHOLDER,\n        hasNativeDep ? [data, ~0] : [data],\n        [0],\n        EMPTY_PLACEHOLDER, [], [], [],\n    ];\n}\n\nexport function hasNativeDep (data: IFileData): boolean {\n    const instances = data[File.Instances];\n    const rootInfo = instances[instances.length - 1];\n    if (typeof rootInfo !== 'number') {\n        return false;\n    } else {\n        return rootInfo < 0;\n    }\n}\n\nfunction getDependUuidList (json: IFileData): string[] {\n    const sharedUuids = json[File.SharedUuids];\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return json[File.DependUuidIndices].map((index) => sharedUuids[index]);\n}\n\nexport function parseUuidDependencies (serialized: unknown) {\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    if (!DEV || isCompiledJson(serialized as object)) {\n        return getDependUuidList(serialized as IFileData);\n    } else {\n        return parseUuidDependenciesDynamic(serialized);\n    }\n}\n\nif (PREVIEW) {\n    deserialize.isCompiledJson = isCompiledJson;\n}\n\nif (EDITOR || TEST) {\n    deserialize._macros = {\n        EMPTY_PLACEHOLDER,\n        CUSTOM_OBJ_DATA_CLASS,\n        CUSTOM_OBJ_DATA_CONTENT,\n        CLASS_TYPE,\n        CLASS_KEYS,\n        CLASS_PROP_TYPE_OFFSET,\n        MASK_CLASS,\n        OBJ_DATA_MASK,\n        DICT_JSON_LAYOUT,\n        ARRAY_ITEM_VALUES,\n        PACKED_SECTIONS,\n    } as {\n        // freeze values (EMPTY_PLACEHOLDER: number -> EMPTY_PLACEHOLDER: 0)\n        EMPTY_PLACEHOLDER: typeof EMPTY_PLACEHOLDER,\n        CUSTOM_OBJ_DATA_CLASS: typeof CUSTOM_OBJ_DATA_CLASS,\n        CUSTOM_OBJ_DATA_CONTENT: typeof CUSTOM_OBJ_DATA_CONTENT,\n        CLASS_TYPE: typeof CLASS_TYPE,\n        CLASS_KEYS: typeof CLASS_KEYS,\n        CLASS_PROP_TYPE_OFFSET: typeof CLASS_PROP_TYPE_OFFSET,\n        MASK_CLASS: typeof MASK_CLASS,\n        OBJ_DATA_MASK: typeof OBJ_DATA_MASK,\n        DICT_JSON_LAYOUT: typeof DICT_JSON_LAYOUT,\n        ARRAY_ITEM_VALUES: typeof ARRAY_ITEM_VALUES,\n        PACKED_SECTIONS: typeof PACKED_SECTIONS,\n    };\n    deserialize._BuiltinValueTypes = BuiltinValueTypes;\n    deserialize._serializeBuiltinValueTypes = serializeBuiltinValueTypes;\n}\n\nif (TEST) {\n    legacyCC._Test.deserializeCompiled = {\n        deserialize,\n        dereference,\n        deserializeCCObject,\n        deserializeCustomCCObject,\n        parseInstances,\n        parseResult,\n        cacheMasks,\n        File: {\n            Version: File.Version,\n            Context: File.Context,\n            SharedUuids: File.SharedUuids,\n            SharedStrings: File.SharedStrings,\n            SharedClasses: File.SharedClasses,\n            SharedMasks: File.SharedMasks,\n            Instances: File.Instances,\n            InstanceTypes: File.InstanceTypes,\n            Refs: File.Refs,\n            DependObjs: File.DependObjs,\n            DependKeys: File.DependKeys,\n            DependUuidIndices: File.DependUuidIndices,\n            // ArrayLength: File.ArrayLength,\n        },\n        DataTypeID: {\n            SimpleType: DataTypeID.SimpleType,\n            InstanceRef: DataTypeID.InstanceRef,\n            Array_InstanceRef: DataTypeID.Array_InstanceRef,\n            Array_AssetRefByInnerObj: DataTypeID.Array_AssetRefByInnerObj,\n            Class: DataTypeID.Class,\n            ValueTypeCreated: DataTypeID.ValueTypeCreated,\n            AssetRefByInnerObj: DataTypeID.AssetRefByInnerObj,\n            TRS: DataTypeID.TRS,\n            ValueType: DataTypeID.ValueType,\n            Array_Class: DataTypeID.Array_Class,\n            CustomizedClass: DataTypeID.CustomizedClass,\n            Dict: DataTypeID.Dict,\n            Array: DataTypeID.Array,\n            // TypedArray: DataTypeID.TypedArray,\n        },\n        BuiltinValueTypes,\n        unpackJSONs,\n    };\n}\n\nlegacyCC.deserialize = deserialize;\n","import { EDITOR } from 'internal:constants';\nimport { errorID } from '../platform/debug';\n\nexport function reportMissingClass (id: string) {\n    if (EDITOR && EditorExtends.UuidUtils.isUuid(id)) {\n        id = EditorExtends.UuidUtils.decompressUuid(id);\n        errorID(5301, id);\n    } else {\n        errorID(5302, id);\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { DEV, JSB } from 'internal:constants';\nimport { isDomNode } from '../utils/misc';\nimport { ValueType } from '../value-types';\nimport { CCObject, isCCObject } from './object';\nimport { js } from '../utils/js';\nimport { getError, warn } from '../platform/debug';\nimport { legacyCC } from '../global-exports';\nimport { Prefab } from '../assets/prefab';\nimport { Node } from '../scene-graph/node';\nimport { updateChildrenForDeserialize } from '../utils/jsb-utils';\nimport { isCCClassOrFastDefined } from './class';\n\nconst Destroyed = CCObject.Flags.Destroyed;\nconst PersistentMask = CCObject.Flags.PersistentMask;\n\nconst objsToClearTmpVar: any = [];   // used to reset _iN$t variable\n\n/**\n * Invoke _instantiate method if supplied.\n * The _instantiate callback will be called only on the root object, its associated object will not be called.\n * @param instantiated If supplied, _instantiate just need to initialize the instantiated object, no need to create new object by itself.\n * @returns The instantiated object.\n */\ntype CustomInstantiation = <T>(this: T, instantiated?: T) => T;\n\n/**\n * @zh 从 Prefab 实例化出新节点。\n * @en Instantiate a node from the Prefab.\n * @param prefab The prefab.\n * @returns The instantiated node.\n * @example\n * ```ts\n * import { instantiate, director } from 'cc';\n * // Instantiate node from prefab.\n * const node = instantiate(prefabAsset);\n * node.parent = director.getScene();\n * ```\n */\nexport function instantiate (prefab: Prefab): Node;\n\n/**\n * @en Clones the object `original.\n * @zh 克隆指定的任意类型的对象。\n * @param original An existing object that you want to make a copy of.\n * It can be any JavaScript object(`typeof original === 'object'`) but:\n * - it shall not be array or null;\n * - it shall not be object of `Asset`;\n * - if it's an object of `CCObject`, it should not have been destroyed.\n * @returns The newly instantiated object.\n * @example\n * ```ts\n * import { instantiate, director } from 'cc';\n * // Clone a node.\n * const node = instantiate(targetNode);\n * node.parent = director.getScene();\n * ```\n */\nexport function instantiate<T> (original: T): T;\n\nexport function instantiate (original: any, internalForce?: boolean) {\n    if (!internalForce) {\n        if (DEV) {\n            if (typeof original !== 'object' || Array.isArray(original)) {\n                throw new TypeError(getError(6900));\n            }\n            if (!original) {\n                throw new TypeError(getError(6901));\n            }\n            if (!legacyCC.isValid(original)) {\n                throw new TypeError(getError(6901));\n            }\n            if (original instanceof legacyCC.Component) {\n                warn('Should not instantiate a single cc.Component directly, you must instantiate the entire node.');\n            }\n        }\n    }\n\n    let clone;\n\n    if (isCCObject(original)) {\n        if (original._instantiate) {\n            legacyCC.game._isCloning = true;\n            clone = original._instantiate(null, true);\n            legacyCC.game._isCloning = false;\n            if (JSB) {\n                updateChildrenForDeserialize(clone);\n            }\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n            return clone;\n        } else if (original instanceof legacyCC.Asset) {\n            throw new TypeError(getError(6903));\n        }\n    }\n\n    legacyCC.game._isCloning = true;\n    clone = doInstantiate(original);\n    legacyCC.game._isCloning = false;\n    if (JSB) {\n        updateChildrenForDeserialize(clone);\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return clone;\n}\n\n/*\n * @en\n * Do instantiate object, the object to instantiate must be non-nil.\n * @zh\n * 这是一个通用的 instantiate 方法，可能效率比较低。\n * 之后可以给各种类型重写快速实例化的特殊实现，但应该在单元测试中将结果和这个方法的结果进行对比。\n * 值得注意的是，这个方法不可重入。\n * @param obj - 该方法仅供内部使用，用户需负责保证参数合法。什么参数是合法的请参考 cc.instantiate 的实现。\n * @param parent - 只有在该对象下的场景物体会被克隆。\n * @return {Object}\n * @private\n */\nfunction doInstantiate (obj, parent?) {\n    if (DEV) {\n        if (Array.isArray(obj)) {\n            throw new TypeError(getError(6904));\n        }\n        if (isDomNode && isDomNode(obj)) {\n            throw new TypeError(getError(6905));\n        }\n    }\n\n    let clone;\n    if (obj._iN$t) {\n        // User can specify an existing object by assigning the \"_iN$t\" property.\n        // enumerateObject will always push obj to objsToClearTmpVar\n        clone = obj._iN$t;\n    } else if (obj.constructor) {\n        const Klass = obj.constructor;\n        clone = new Klass();\n    } else {\n        clone = Object.create(null);\n    }\n\n    enumerateObject(obj, clone, parent);\n\n    for (let i = 0, len = objsToClearTmpVar.length; i < len; ++i) {\n        objsToClearTmpVar[i]._iN$t = null;\n    }\n    objsToClearTmpVar.length = 0;\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return clone;\n}\n\n// @param {Object} obj - The object to instantiate, typeof must be 'object' and should not be an array.\n\nfunction enumerateCCClass (klass, obj, clone, parent) {\n    const props = klass.__values__;\n\n    for (let p = 0; p < props.length; p++) {\n        const key = props[p];\n        const value = obj[key];\n        if (typeof value === 'object' && value) {\n            const initValue = clone[key];\n            if (initValue instanceof ValueType\n                && initValue.constructor === value.constructor) {\n                initValue.set(value);\n            } else {\n                clone[key] = value._iN$t || instantiateObj(value, parent);\n            }\n        } else {\n            clone[key] = value;\n        }\n    }\n}\n\nfunction enumerateObject (obj, clone, parent) {\n    // 目前使用“_iN$t”这个特殊字段来存实例化后的对象，这样做主要是为了防止循环引用\n    // 注意，为了避免循环引用，所有新创建的实例，必须在赋值前被设为源对象的_iN$t\n    js.value(obj, '_iN$t', clone, true);\n    objsToClearTmpVar.push(obj);\n    const klass = obj.constructor;\n    if (isCCClassOrFastDefined(klass)) {\n        enumerateCCClass(klass, obj, clone, parent);\n    } else {\n        // primitive javascript object\n        for (const key in obj) {\n            // eslint-disable-next-line no-prototype-builtins\n            if (!obj.hasOwnProperty(key)\n                || (key.charCodeAt(0) === 95 && key.charCodeAt(1) === 95   // starts with \"__\"\n                 && key !== '__type__'\n                 && key !== '__prefab')\n            ) {\n                continue;\n            }\n            const value = obj[key];\n            if (typeof value === 'object' && value) {\n                if (value === clone) {\n                    continue;   // value is obj._iN$t\n                }\n                clone[key] = value._iN$t || instantiateObj(value, parent);\n            } else {\n                clone[key] = value;\n            }\n        }\n    }\n    if (isCCObject(obj)) {\n        clone._objFlags &= PersistentMask;\n    }\n}\n\n/*\n * @param {Object|Array} obj - the original non-nil object, typeof must be 'object'\n * @return {Object|Array} - the original non-nil object, typeof must be 'object'\n */\nfunction instantiateObj (obj, parent) {\n    if (obj instanceof ValueType) {\n        return obj.clone();\n    }\n    if (obj instanceof legacyCC.Asset) {\n        // 所有资源直接引用，不需要拷贝\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return obj;\n    }\n    let clone;\n    if (ArrayBuffer.isView(obj)) {\n        const len = (obj as any).length;\n        clone = new ((obj as any).constructor)(len);\n        // @ts-expect-error: unknown\n        obj._iN$t = clone;\n        objsToClearTmpVar.push(obj);\n        for (let i = 0; i < len; ++i) {\n            clone[i] = obj[i];\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return clone;\n    }\n    if (Array.isArray(obj)) {\n        const len = obj.length;\n        clone = new Array(len);\n        // @ts-expect-error: unknown\n        obj._iN$t = clone;\n        objsToClearTmpVar.push(obj);\n        for (let i = 0; i < len; ++i) {\n            const value = obj[i];\n            if (typeof value === 'object' && value) {\n                clone[i] = value._iN$t || instantiateObj(value, parent);\n            } else {\n                clone[i] = value;\n            }\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return clone;\n    } else if (obj._objFlags & Destroyed) {\n        // the same as cc.isValid(obj)\n        return null;\n    }\n\n    const ctor = obj.constructor;\n    if (isCCClassOrFastDefined(ctor)) {\n        if (parent) {\n            if (parent instanceof legacyCC.Component) {\n                if (obj instanceof legacyCC._BaseNode || obj instanceof legacyCC.Component) {\n                    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n                    return obj;\n                }\n            } else if (parent instanceof legacyCC._BaseNode) {\n                if (obj instanceof legacyCC._BaseNode) {\n                    if (!obj.isChildOf(parent)) {\n                        // should not clone other nodes if not descendant\n                        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n                        return obj;\n                    }\n                } else if (obj instanceof legacyCC.Component) {\n                    if (obj.node && !obj.node.isChildOf(parent)) {\n                        // should not clone other component if not descendant\n                        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n                        return obj;\n                    }\n                }\n            }\n        }\n        // eslint-disable-next-line new-cap\n        clone = new ctor();\n    } else if (ctor === Object) {\n        clone = {};\n    } else if (!ctor) {\n        clone = Object.create(null);\n    } else {\n        // unknown type\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return obj;\n    }\n    enumerateObject(obj, clone, parent);\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return clone;\n}\n\ninstantiate._clone = doInstantiate;\nlegacyCC.instantiate = instantiate;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, serializable } from 'cc.decorator';\nimport { Vec3, Quat, Vec4, Vec2, Mat4 } from '../../math';\n\nexport enum StorageUnit {\n    Uint8, Uint16, Uint32,\n    Int8, Int16, Int32,\n    Float32, Float64,\n}\n\nexport enum ElementType {\n    Scalar,\n    Vec2,\n    Vec3,\n    Vec4,\n    Quat,\n    Mat4,\n}\n\nconst elementTypeBits = 3;\n\nexport type StorageUnitElementType = number;\n\nexport function combineStorageUnitElementType (unit: StorageUnit, elementType: ElementType) {\n    return (elementType << elementTypeBits) + unit;\n}\n\nexport function extractStorageUnitElementType (combined: StorageUnitElementType) {\n    return {\n        storageUnit: ~(-1 << elementTypeBits) & combined,\n        elementType: combined >> elementTypeBits,\n    };\n}\n\n/**\n * @deprecated Since V3.5.0.\n */\n@ccclass('cc.CompactValueTypeArray')\nexport class CompactValueTypeArray {\n    public static StorageUnit = StorageUnit;\n\n    public static ElementType = ElementType;\n\n    /**\n     * Offset into buffer, in bytes.\n     */\n    @serializable\n    private _byteOffset = 0;\n\n    /**\n     * Unit count this CVTA occupies.\n     */\n    @serializable\n    private _unitCount = 0;\n\n    /**\n     * Element type this CVTA holds.\n     */\n    @serializable\n    private _unitElement = combineStorageUnitElementType(StorageUnit.Uint8, ElementType.Scalar);\n\n    /**\n     * Element count this CVTA holds.\n     */\n    @serializable\n    private _length = 0;\n\n    /**\n     * Returns the length in bytes that a buffer needs to encode the specified value array in form of CVTA.\n     * @param values The value array.\n     * @param unit Target element type.\n     */\n    public static lengthFor (values: any[], elementType: ElementType, unit: StorageUnit): number {\n        const elementTraits = getElementTraits(elementType);\n        return elementTraits.requiredUnits * values.length * getStorageConstructor(unit).BYTES_PER_ELEMENT;\n    }\n\n    /**\n     * Compresses the specified value array in form of CVTA into target buffer.\n     * @param values The value array.\n     * @param unit Target element type.\n     * @param arrayBuffer Target buffer.\n     * @param byteOffset Offset into target buffer.\n     */\n    public static compress (values: any[], elementType: ElementType, unit: StorageUnit, arrayBuffer: ArrayBuffer, byteOffset: number, presumedByteOffset: number): CompactValueTypeArray {\n        const elementTraits = getElementTraits(elementType);\n        const storageConstructor = getStorageConstructor(unit);\n        const unitCount = elementTraits.requiredUnits * values.length;\n        const storage = new storageConstructor(arrayBuffer, byteOffset, unitCount);\n        for (let i = 0; i < values.length; ++i) {\n            elementTraits.compress(storage, i, values[i]);\n        }\n\n        const result = new CompactValueTypeArray();\n        result._unitElement = combineStorageUnitElementType(unit, elementType);\n        result._byteOffset = presumedByteOffset;\n        result._unitCount = unitCount;\n        result._length = values.length;\n        return result;\n    }\n\n    /**\n     * Decompresses this CVTA.\n     * @param arrayBuffer The buffer this CVTA stored in.\n     */\n    public decompress<T> (arrayBuffer: ArrayBuffer): T[] {\n        const { storageUnit, elementType } = extractStorageUnitElementType(this._unitElement);\n        const elementTraits = getElementTraits(elementType);\n        const storageConstructor = getStorageConstructor(storageUnit);\n        const storage = new storageConstructor(arrayBuffer, this._byteOffset, this._unitCount);\n        const result = new Array<T>(this._length);\n        for (let i = 0; i < this._length; ++i) {\n            result[i] = elementTraits.decompress(storage, i);\n        }\n        return result;\n    }\n}\n\nfunction getElementTraits (elementType: ElementType) {\n    return BuiltinElementTypeTraits[elementType];\n}\n\nfunction getStorageConstructor (unit: StorageUnit) {\n    switch (unit) {\n    case StorageUnit.Uint8:\n        return Uint8Array;\n    case StorageUnit.Uint16:\n        return Uint16Array;\n    case StorageUnit.Uint32:\n        return Uint32Array;\n    case StorageUnit.Int8:\n        return Int8Array;\n    case StorageUnit.Int16:\n        return Int16Array;\n    case StorageUnit.Int32:\n        return Int32Array;\n    case StorageUnit.Float32:\n        return Float32Array;\n    case StorageUnit.Float64:\n        return Float64Array;\n    }\n}\n\ninterface CompactTraits {\n    requiredUnits: number;\n    compress (storage: CompactValueTypeArrayStorage, index: number, value: any): void;\n    decompress (storage: CompactValueTypeArrayStorage, index: number): any;\n}\n\nconst BuiltinElementTypeTraits: Record<ElementType, CompactTraits> = {\n    [ElementType.Scalar]: {\n        requiredUnits: 1,\n        compress (storage: CompactValueTypeArrayStorage, index: number, value: number) {\n            storage[index] = value;\n        },\n        decompress (storage: CompactValueTypeArrayStorage, index: number) {\n            return storage[index];\n        },\n    },\n    [ElementType.Vec2]: {\n        requiredUnits: 2,\n        compress (storage: CompactValueTypeArrayStorage, index: number, value: Vec2) {\n            storage[index * 2] = value.x;\n            storage[index * 2 + 1] = value.y;\n        },\n        decompress (storage: CompactValueTypeArrayStorage, index: number) {\n            return new Vec3(storage[index * 2], storage[index * 2 + 1]);\n        },\n    },\n    [ElementType.Vec3]: {\n        requiredUnits: 3,\n        compress (storage: CompactValueTypeArrayStorage, index: number, value: Vec3) {\n            storage[index * 3] = value.x;\n            storage[index * 3 + 1] = value.y;\n            storage[index * 3 + 2] = value.z;\n        },\n        decompress (storage: CompactValueTypeArrayStorage, index: number) {\n            return new Vec3(storage[index * 3], storage[index * 3 + 1], storage[index * 3 + 2]);\n        },\n    },\n    [ElementType.Vec4]: {\n        requiredUnits: 4,\n        compress (storage: CompactValueTypeArrayStorage, index: number, value: Vec4) {\n            storage[index * 4] = value.x;\n            storage[index * 4 + 1] = value.y;\n            storage[index * 4 + 2] = value.z;\n            storage[index * 4 + 3] = value.w;\n        },\n        decompress (storage: CompactValueTypeArrayStorage, index: number) {\n            return new Vec4(storage[index * 4], storage[index * 4 + 1], storage[index * 4 + 2], storage[index * 4 + 3]);\n        },\n    },\n    [ElementType.Quat]: {\n        requiredUnits: 4,\n        compress (storage: CompactValueTypeArrayStorage, index: number, value: Quat) {\n            storage[index * 4] = value.x;\n            storage[index * 4 + 1] = value.y;\n            storage[index * 4 + 2] = value.z;\n            storage[index * 4 + 3] = value.w;\n        },\n        decompress (storage: CompactValueTypeArrayStorage, index: number) {\n            return new Quat(storage[index * 4], storage[index * 4 + 1], storage[index * 4 + 2], storage[index * 4 + 3]);\n        },\n    },\n    [ElementType.Mat4]: {\n        requiredUnits: 16,\n        compress (storage: CompactValueTypeArrayStorage, index: number, value: Mat4) {\n            Mat4.toArray(storage, value, index * 16);\n        },\n        decompress (storage: CompactValueTypeArrayStorage, index: number) {\n            return Mat4.fromArray(new Mat4(), storage, index * 16);\n        },\n    },\n};\n\ninterface CompactValueTypeArrayStorage {\n    readonly length: number;\n    [n: number]: number;\n}\n\nexport function isCompactValueTypeArray (value: any): value is CompactValueTypeArray  {\n    return value instanceof CompactValueTypeArray;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nexport function constant () {\n    return 0;\n}\n\nexport function linear (k: number) {\n    return k;\n}\n\nexport function quadIn (k: number) {\n    return k * k;\n}\n\nexport function quadOut (k: number) {\n    return k * (2 - k);\n}\n\nexport function quadInOut (k: number) {\n    k *= 2;\n    if (k < 1) {\n        return 0.5 * k * k;\n    }\n    return -0.5 * (--k * (k - 2) - 1);\n}\n\nexport function cubicIn (k: number) {\n    return k * k * k;\n}\n\nexport function cubicOut (k: number) {\n    return --k * k * k + 1;\n}\n\nexport function cubicInOut (k: number) {\n    k *= 2;\n    if (k < 1) {\n        return 0.5 * k * k * k;\n    }\n    return 0.5 * ((k -= 2) * k * k + 2);\n}\n\nexport function quartIn (k: number) {\n    return k * k * k * k;\n}\n\nexport function quartOut (k: number) {\n    return 1 - (--k * k * k * k);\n}\n\nexport function quartInOut (k: number) {\n    k *= 2;\n    if (k < 1) {\n        return 0.5 * k * k * k * k;\n    }\n    return -0.5 * ((k -= 2) * k * k * k - 2);\n}\n\nexport function quintIn (k: number) {\n    return k * k * k * k * k;\n}\n\nexport function quintOut (k: number) {\n    return --k * k * k * k * k + 1;\n}\n\nexport function quintInOut (k: number) {\n    k *= 2;\n    if (k < 1) {\n        return 0.5 * k * k * k * k * k;\n    }\n    return 0.5 * ((k -= 2) * k * k * k * k + 2);\n}\n\nexport function sineIn (k: number) {\n    if (k === 1) {\n        return 1;\n    }\n    return 1 - Math.cos(k * Math.PI / 2);\n}\n\nexport function sineOut (k: number) {\n    return Math.sin(k * Math.PI / 2);\n}\n\nexport function sineInOut (k: number) {\n    return 0.5 * (1 - Math.cos(Math.PI * k));\n}\n\nexport function expoIn (k: number) {\n    return k === 0 ? 0 : Math.pow(1024, k - 1);\n}\n\nexport function expoOut (k: number) {\n    return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);\n}\n\nexport function expoInOut (k: number) {\n    if (k === 0) {\n        return 0;\n    }\n    if (k === 1) {\n        return 1;\n    }\n    k *= 2;\n    if (k < 1) {\n        return 0.5 * Math.pow(1024, k - 1);\n    }\n    return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);\n}\n\nexport function circIn (k: number) {\n    return 1 - Math.sqrt(1 - k * k);\n}\n\nexport function circOut (k: number) {\n    return Math.sqrt(1 - (--k * k));\n}\n\nexport function circInOut (k: number) {\n    k *= 2;\n    if (k < 1) {\n        return -0.5 * (Math.sqrt(1 - k * k) - 1);\n    }\n    return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n}\n\nexport function elasticIn (k: number) {\n    let s;\n    let a = 0.1;\n    const p = 0.4;\n    if (k === 0) {\n        return 0;\n    }\n    if (k === 1) {\n        return 1;\n    }\n    if (!a || a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = p * Math.asin(1 / a) / (2 * Math.PI);\n    }\n    return -(a * Math.pow(2, 10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p));\n}\n\nexport function elasticOut (k: number) {\n    let s;\n    let a = 0.1;\n    const p = 0.4;\n    if (k === 0) {\n        return 0;\n    }\n    if (k === 1) {\n        return 1;\n    }\n    if (!a || a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = p * Math.asin(1 / a) / (2 * Math.PI);\n    }\n    return (a * Math.pow(2, -10 * k) * Math.sin((k - s) * (2 * Math.PI) / p) + 1);\n}\n\nexport function elasticInOut (k: number) {\n    let s;\n    let a = 0.1;\n    const p = 0.4;\n    if (k === 0) {\n        return 0;\n    }\n    if (k === 1) {\n        return 1;\n    }\n    if (!a || a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = p * Math.asin(1 / a) / (2 * Math.PI);\n    }\n    k *= 2;\n    if (k < 1) {\n        return -0.5\n            * (a * Math.pow(2, 10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p));\n    }\n    return a * Math.pow(2, -10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p) * 0.5 + 1;\n}\n\nexport function backIn (k: number) {\n    if (k === 1) {\n        return 1;\n    }\n    const s = 1.70158;\n    return k * k * ((s + 1) * k - s);\n}\n\nexport function backOut (k: number) {\n    if (k === 0) {\n        return 0;\n    }\n    const s = 1.70158;\n    return --k * k * ((s + 1) * k + s) + 1;\n}\n\nexport function backInOut (k: number) {\n    const s = 1.70158 * 1.525;\n    k *= 2;\n    if (k < 1) {\n        return 0.5 * (k * k * ((s + 1) * k - s));\n    }\n    return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n}\n\nexport function bounceIn (k: number) {\n    return 1 - bounceOut(1 - k);\n}\n\nexport function bounceOut (k: number) {\n    if (k < (1 / 2.75)) {\n        return 7.5625 * k * k;\n    } else if (k < (2 / 2.75)) {\n        return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n    } else if (k < (2.5 / 2.75)) {\n        return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n    } else {\n        return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n    }\n}\n\nexport function bounceInOut (k: number) {\n    if (k < 0.5) {\n        return bounceIn(k * 2) * 0.5;\n    }\n    return bounceOut(k * 2 - 1) * 0.5 + 0.5;\n}\n\nexport function smooth (k: number) {\n    if (k <= 0) {\n        return 0;\n    }\n    if (k >= 1) {\n        return 1;\n    }\n    return k * k * (3 - 2 * k);\n}\n\nexport function fade (k: number) {\n    if (k <= 0) {\n        return 0;\n    }\n    if (k >= 1) {\n        return 1;\n    }\n    return k * k * k * (k * (k * 6 - 15) + 10);\n}\n\nexport const quadOutIn = _makeOutIn(quadIn, quadOut);\nexport const cubicOutIn = _makeOutIn(cubicIn, cubicOut);\nexport const quartOutIn = _makeOutIn(quartIn, quartOut);\nexport const quintOutIn = _makeOutIn(quintIn, quintOut);\nexport const sineOutIn = _makeOutIn(sineIn, sineOut);\nexport const expoOutIn = _makeOutIn(expoIn, expoOut);\nexport const circOutIn = _makeOutIn(circIn, circOut);\nexport const elasticOutIn = _makeOutIn(elasticIn, elasticOut);\nexport const backOutIn = _makeOutIn(backIn, backOut);\nexport const bounceOutIn = _makeOutIn(bounceIn, bounceOut);\n\nfunction _makeOutIn (fnIn: (k: number) => number, fnOut: (k: number) => number) {\n    return (k: number) => {\n        if (k < 0.5) {\n            return fnOut(k * 2) / 2;\n        }\n        return fnIn(2 * k - 1) / 2 + 0.5;\n    };\n}\n","/*\n Copyright (c) 2018-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport * as _decorator from './class-decorator';\nimport { legacyCC } from '../global-exports';\n\nlegacyCC._decorator = _decorator;\nexport { _decorator };\nexport { CCClass } from './class';\nexport { CCObject, isValid } from './object';\nexport { deserialize } from './deserialize';\nexport { Details } from './deserialize';\nexport { getSerializationMetadata } from './serialization-metadata';\nexport type { SerializationMetadata } from './serialization-metadata';\nexport { instantiate } from './instantiate';\nexport { CCInteger, CCFloat, CCBoolean, CCString } from './utils/attribute';\nexport { CompactValueTypeArray } from './utils/compact-value-type-array';\nexport { editorExtrasTag } from './editor-extras-tag';\nexport { deserializeTag, serializeTag } from './custom-serializable';\nexport type {\n    SerializationInput,\n    SerializationOutput,\n    SerializationContext,\n    CustomSerializable,\n} from './custom-serializable';\n","import * as easing from '../easing/easing';\nimport { assertIsTrue } from '../data/utils/asserts';\n\nexport enum EasingMethod {\n    LINEAR,\n    CONSTANT,\n    QUAD_IN,\n    QUAD_OUT,\n    QUAD_IN_OUT,\n    QUAD_OUT_IN,\n    CUBIC_IN,\n    CUBIC_OUT,\n    CUBIC_IN_OUT,\n    CUBIC_OUT_IN,\n    QUART_IN,\n    QUART_OUT,\n    QUART_IN_OUT,\n    QUART_OUT_IN,\n    QUINT_IN,\n    QUINT_OUT,\n    QUINT_IN_OUT,\n    QUINT_OUT_IN,\n    SINE_IN,\n    SINE_OUT,\n    SINE_IN_OUT,\n    SINE_OUT_IN,\n    EXPO_IN,\n    EXPO_OUT,\n    EXPO_IN_OUT,\n    EXPO_OUT_IN,\n    CIRC_IN,\n    CIRC_OUT,\n    CIRC_IN_OUT,\n    CIRC_OUT_IN,\n    ELASTIC_IN,\n    ELASTIC_OUT,\n    ELASTIC_IN_OUT,\n    ELASTIC_OUT_IN,\n    BACK_IN,\n    BACK_OUT,\n    BACK_IN_OUT,\n    BACK_OUT_IN,\n    BOUNCE_IN,\n    BOUNCE_OUT,\n    BOUNCE_IN_OUT,\n    BOUNCE_OUT_IN,\n    SMOOTH,\n    FADE,\n}\n\ntype EasingMethodFn = (k: number) => number;\n\nconst easingMethodFnMap: Record<EasingMethod, EasingMethodFn> = {\n    [EasingMethod.CONSTANT]: easing.constant,\n    [EasingMethod.LINEAR]: easing.linear,\n\n    [EasingMethod.QUAD_IN]: easing.quadIn,\n    [EasingMethod.QUAD_OUT]: easing.quadOut,\n    [EasingMethod.QUAD_IN_OUT]: easing.quadInOut,\n    [EasingMethod.QUAD_OUT_IN]: easing.quadOutIn,\n    [EasingMethod.CUBIC_IN]: easing.cubicIn,\n    [EasingMethod.CUBIC_OUT]: easing.cubicOut,\n    [EasingMethod.CUBIC_IN_OUT]: easing.cubicInOut,\n    [EasingMethod.CUBIC_OUT_IN]: easing.cubicOutIn,\n    [EasingMethod.QUART_IN]: easing.quartIn,\n    [EasingMethod.QUART_OUT]: easing.quartOut,\n    [EasingMethod.QUART_IN_OUT]: easing.quartInOut,\n    [EasingMethod.QUART_OUT_IN]: easing.quartOutIn,\n    [EasingMethod.QUINT_IN]: easing.quintIn,\n    [EasingMethod.QUINT_OUT]: easing.quintOut,\n    [EasingMethod.QUINT_IN_OUT]: easing.quintInOut,\n    [EasingMethod.QUINT_OUT_IN]: easing.quintOutIn,\n    [EasingMethod.SINE_IN]: easing.sineIn,\n    [EasingMethod.SINE_OUT]: easing.sineOut,\n    [EasingMethod.SINE_IN_OUT]: easing.sineInOut,\n    [EasingMethod.SINE_OUT_IN]: easing.sineOutIn,\n    [EasingMethod.EXPO_IN]: easing.expoIn,\n    [EasingMethod.EXPO_OUT]: easing.expoOut,\n    [EasingMethod.EXPO_IN_OUT]: easing.expoInOut,\n    [EasingMethod.EXPO_OUT_IN]: easing.expoOutIn,\n    [EasingMethod.CIRC_IN]: easing.circIn,\n    [EasingMethod.CIRC_OUT]: easing.circOut,\n    [EasingMethod.CIRC_IN_OUT]: easing.circInOut,\n    [EasingMethod.CIRC_OUT_IN]: easing.circOutIn,\n    [EasingMethod.ELASTIC_IN]: easing.elasticIn,\n    [EasingMethod.ELASTIC_OUT]: easing.elasticOut,\n    [EasingMethod.ELASTIC_IN_OUT]: easing.elasticInOut,\n    [EasingMethod.ELASTIC_OUT_IN]: easing.elasticOutIn,\n    [EasingMethod.BACK_IN]: easing.backIn,\n    [EasingMethod.BACK_OUT]: easing.backOut,\n    [EasingMethod.BACK_IN_OUT]: easing.backInOut,\n    [EasingMethod.BACK_OUT_IN]: easing.backOutIn,\n    [EasingMethod.BOUNCE_IN]: easing.bounceIn,\n    [EasingMethod.BOUNCE_OUT]: easing.bounceOut,\n    [EasingMethod.BOUNCE_IN_OUT]: easing.bounceInOut,\n    [EasingMethod.BOUNCE_OUT_IN]: easing.bounceOutIn,\n    [EasingMethod.SMOOTH]: easing.smooth,\n    [EasingMethod.FADE]: easing.fade,\n};\n\nexport function getEasingFn (easingMethod: EasingMethod): EasingMethodFn {\n    assertIsTrue(easingMethod in easingMethodFnMap);\n    return easingMethodFnMap[easingMethod];\n}\n","import { assertIsTrue } from '../data/utils/asserts';\nimport { approx, lerp, pingPong, repeat } from '../math';\nimport { KeyframeCurve } from './keyframe-curve';\nimport { ccclass, serializable, uniquelyReferenced } from '../data/decorators';\nimport { RealInterpolationMode, ExtrapolationMode, TangentWeightMode } from './real-curve-param';\nimport { binarySearchEpsilon } from '../algorithm/binary-search';\nimport { solveCubic } from './solve-cubic';\nimport { EditorExtendable, EditorExtendableMixin } from '../data/editor-extendable';\nimport { CCClass, deserializeTag, editorExtrasTag, SerializationContext, SerializationInput, SerializationOutput, serializeTag } from '../data';\nimport { DeserializationContext } from '../data/custom-serializable';\nimport { EasingMethod, getEasingFn } from './easing-method';\nimport { getOrCreateSerializationMetadata } from '../data/serialization-metadata';\nimport { popCount } from '../math/bits';\n\nexport { RealInterpolationMode, ExtrapolationMode, TangentWeightMode, EasingMethod };\n\nconst REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_START = 0;\nconst REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_MASK = 0xFF << REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_START;\n\nconst REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START = 8;\nconst REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_MASK = 0xFF << REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START;\n\nconst REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_START = 16;\nconst REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_MASK = 0xFF << REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_START;\n\n// The following assertions ensure they're adjacent and non-overlapped.\n\nassertIsTrue(REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START\n    === REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_START + popCount(REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_MASK));\n\nassertIsTrue(REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_START\n    === REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START + popCount(REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_MASK));\n\nconst REAL_KEYFRAME_VALUE_DEFAULT_FLAGS = (RealInterpolationMode.LINEAR << REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_START)\n    | (TangentWeightMode.NONE << REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START)\n    | (EasingMethod.LINEAR << REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_START);\n\n/**\n * @en View to a real frame value.\n * Note, the view may be invalidated due to keyframe change/add/remove.\n * @zh 实数帧值的视图。\n * 注意，该视图可能因关键帧的添加、改变、移除而失效。\n */\nclass RealKeyframeValue extends EditorExtendable {\n    /**\n     * @en\n     * When perform interpolation, the interpolation method should be taken\n     * when for this keyframe is used as starting keyframe.\n     * @zh\n     * 在执行插值时，当以此关键帧作为起始关键帧时应当使用的插值方式。\n     */\n    get interpolationMode (): RealInterpolationMode {\n        return (this._flags & REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_MASK) >> REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_START;\n    }\n\n    set interpolationMode (value) {\n        this._flags &= ~REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_MASK;\n        this._flags |= (value << REAL_KEYFRAME_VALUE_FLAGS_INTERPOLATION_MODE_START);\n    }\n\n    /**\n     * @en\n     * Tangent weight mode when perform cubic interpolation\n     * This field is regarded if current interpolation mode is not cubic.\n     * @zh\n     * 当执行三次插值时，此关键帧使用的切线权重模式。\n     * 若当前的插值模式不是三次插值时，该字段无意义。\n     */\n    get tangentWeightMode (): TangentWeightMode {\n        return (this._flags & REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_MASK) >> REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START;\n    }\n\n    set tangentWeightMode (value) {\n        this._flags &= ~REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_MASK;\n        this._flags |= (value << REAL_KEYFRAME_VALUE_FLAGS_TANGENT_WEIGHT_MODE_START);\n    }\n\n    /**\n     * @en\n     * Value of the keyframe.\n     * @zh\n     * 该关键帧的值。\n     */\n    public value = 0.0;\n\n    /**\n     * @en\n     * The tangent of this keyframe\n     * when it's used as starting point during cubic interpolation.\n     * Regarded otherwise.\n     * @zh\n     * 当此关键帧作为三次插值的起始点时，此关键帧的切线。其他情况下该字段无意义。\n     */\n    public rightTangent = 0.0;\n\n    /**\n     * @en\n     * The tangent weight of this keyframe\n     * when it's used as starting point during weighted cubic interpolation.\n     * Regarded otherwise.\n     * @zh\n     * 当此关键帧作为三次插值的起始点时，此关键帧的切线权重。其他情况下该字段无意义。\n     */\n    public rightTangentWeight = 0.0;\n\n    /**\n     * @en\n     * The tangent of this keyframe\n     * when it's used as ending point during cubic interpolation.\n     * Regarded otherwise.\n     * @zh\n     * 当此关键帧作为三次插值的目标点时，此关键帧的切线。其他情况下该字段无意义。\n     */\n    public leftTangent = 0.0;\n\n    /**\n     * @en\n     * The tangent weight of this keyframe\n     * when it's used as ending point during weighted cubic interpolation.\n     * Regarded otherwise.\n     * @zh\n     * 当此关键帧作为三次插值的目标点时，此关键帧的切线权重。其他情况下该字段无意义。\n     */\n    public leftTangentWeight = 0.0;\n\n    /**\n     * @deprecated Reserved for backward compatibility. Will be removed in future.\n     */\n    get easingMethod (): EasingMethod {\n        return (this._flags & REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_MASK) >> REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_START;\n    }\n\n    set easingMethod (value) {\n        this._flags &= ~REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_MASK;\n        this._flags |= (value << REAL_KEYFRAME_VALUE_FLAGS_EASING_METHOD_START);\n    }\n\n    private _flags = REAL_KEYFRAME_VALUE_DEFAULT_FLAGS;\n}\n\nCCClass.fastDefine(\n    'cc.RealKeyframeValue',\n    RealKeyframeValue, {\n        interpolationMode: RealInterpolationMode.LINEAR,\n        tangentWeightMode: TangentWeightMode.NONE,\n        value: 0.0,\n        rightTangent: 0.0,\n        rightTangentWeight: 0.0,\n        leftTangent: 0.0,\n        leftTangentWeight: 0.0,\n        easingMethod: EasingMethod.LINEAR,\n        [editorExtrasTag]: undefined,\n    },\n);\n\nCCClass.Attr.setClassAttr(\n    RealKeyframeValue,\n    editorExtrasTag,\n    'editorOnly',\n    true,\n);\n\ngetOrCreateSerializationMetadata(RealKeyframeValue).uniquelyReferenced = true;\n\nexport type { RealKeyframeValue };\n\n/**\n * @en\n * The parameter describing a real keyframe value.\n * In the case of partial keyframe value,\n * each component of the keyframe value is taken from the parameter.\n * For unspecified components, default values are taken:\n * - Interpolation mode: `InterpolationMode.Linear`\n * - Tangent weight mode: `TangentWeightMode.None`\n * - Value/Tangents/Tangent weights: `0.0`\n * @zh\n * 用于描述实数关键帧值的参数。\n * 若是部分关键帧的形式，关键帧值的每个分量都是从该参数中取得。\n * 对于未指定的分量，使用默认值：\n * - 插值模式：`InterpolationMode.Linear`\n * - 切线权重模式：`TangentWeightMode.None`\n * - 值/切线/切线权重：`0.0`\n */\ntype RealKeyframeValueParameters = number | Partial<RealKeyframeValue>;\n\nfunction createRealKeyframeValue (params: RealKeyframeValueParameters) {\n    const realKeyframeValue = new RealKeyframeValue();\n    if (typeof params === 'number') {\n        realKeyframeValue.value = params;\n    } else {\n        const {\n            interpolationMode,\n            tangentWeightMode,\n            value,\n            rightTangent,\n            rightTangentWeight,\n            leftTangent,\n            leftTangentWeight,\n            easingMethod,\n            [editorExtrasTag]: editorExtras,\n        } = params;\n        realKeyframeValue.value = value ?? realKeyframeValue.value;\n        realKeyframeValue.rightTangent = rightTangent ?? realKeyframeValue.rightTangent;\n        realKeyframeValue.rightTangentWeight = rightTangentWeight ?? realKeyframeValue.rightTangentWeight;\n        realKeyframeValue.leftTangent = leftTangent ?? realKeyframeValue.leftTangent;\n        realKeyframeValue.leftTangentWeight = leftTangentWeight ?? realKeyframeValue.leftTangentWeight;\n        realKeyframeValue.interpolationMode = interpolationMode ?? realKeyframeValue.interpolationMode;\n        realKeyframeValue.tangentWeightMode = tangentWeightMode ?? realKeyframeValue.tangentWeightMode;\n        realKeyframeValue.easingMethod = easingMethod ?? realKeyframeValue.easingMethod;\n        if (editorExtras) {\n            realKeyframeValue[editorExtrasTag] = editorExtras;\n        }\n    }\n    return realKeyframeValue;\n}\n\n/**\n * @en\n * Real curve.\n *\n * The real curve is a kind of keyframe curve.\n * When evaluating a real curve:\n * - If the input is just the time of a keyframe,\n *   keyframe value's numeric value is used as result.\n * - Otherwise, if the input is less than the time of the first keyframe or\n *   is greater than the time of the last keyframe time, it performs so-called extrapolation.\n * - Otherwise, the input falls between two keyframes and then it interpolates between the two keyframes.\n *\n * Every keyframe may specify an interpolation mode\n * to indicates how to perform the interpolation\n * from current keyframe to next keyframe.\n * Interpolation modes of keyframes may differ from each other.\n *\n * Real curve allows three interpolation modes: constant, linear and cubic.\n * The constant and linear mode is easy.\n * In case of cubic interpolation,\n * the interpolation algorithm is effectively equivalent to cubic bezier(or cubic hermite) interpolation.\n *\n * Related quantities related to cubic interpolation are:\n * - Keyframe times and numeric values.\n * - The tangent and tangent weight of the previous keyframe and next keyframe.\n *\n * While performing the cubic bezier interpolation,\n * The first control point is calculated from right tangent and right tangent weight of previous keyframe,\n * the second control point is calculated from left tangent and left tangent weight of next keyframe.\n *\n * In equivalent bezier representation,\n * the tangent is the line slope between sample point and control point\n * and the tangent weight is the distance between sample point and control point.\n * The tangent weight on either side can be marked as \"not specified\" through tangent weight mode.\n * If either side weight is not specified,\n * the tangent weight is treated at `sqrt(d_t^2 + (d_t * tangent)^2) * (1 / 3)`\n * where `d_t` is the difference between two keyframes 's time and `tangent` is the tangent of that side.\n *\n * Note, in some cases, tangent/tangent weight/tangent weight mode may be \"meaningless\".\n * The meaningless means that value can may not be stored(or serialized).\n * @zh\n * 实数曲线。\n *\n * 实数曲线是关键帧曲线的一种。\n * 在求值实数曲线时：\n * - 若输入正好就是关键帧上的时间，关键帧上的数值就作为结果。\n * - 否则，如果输入小于第一个关键帧上的时间或大于最后一个关键帧上的时间，它会进行所谓的外推。\n * - 否则，输入落于两帧之间，将通过插值两帧得到结果。\n *\n * 每个关键帧都可以指定插值模式，\n * 以表示从当前帧数值变化到下一帧数值所采用的插值算法，\n * 每个关键帧的插值模式都可以是各不相同的。\n *\n * 实数曲线允许三种插值模式：常量、线性和三次方的（也称立方）。\n * 常量和线性模式都比较简单。\n * 在三次插值的情况下，插值算法实质上等价于三次贝塞尔（或三次埃尔米特）插值。\n *\n * 三次插值的相关量有：\n * - 关键帧上的时间和数值；\n * - 前一关键帧和后一关键帧上的切线和切线权重。\n *\n * 当两帧之间进行三次贝塞尔曲线插值时，\n * 会取前一帧的右切线、右切线权重来计算出第一个控制点，\n * 会取后一帧的左切线、左切线权重来计算出第二个控制点。\n *\n * 在等效的贝塞尔表示中，\n * 切线就是样本点和控制点之间的切线斜率，而切线权重就是样本点和控制点之间的距离。\n * 任意一端的切线权重都可以通过切线权重模式来标记为“未指定的”。\n * 若任意一端的切线权重是未指定的，\n * 此端上的切线权重将被视为 `sqrt(d_t^2 + (d_t * tangent)^2) * (1 / 3)`，其中，\n * `d_t` 是两帧时间的差，`tangent` 是此端上的切线。\n *\n * 注意，切线/切线权重/切线权重模式在某些情况下可能是“无意义的”。\n * 无意义意味着这些值可能不会被存储或序列化。\n */\nexport class RealCurve extends KeyframeCurve<RealKeyframeValue> {\n    /**\n     * @en\n     * Gets or sets the pre-extrapolation-mode of this curve.\n     * Defaults to `ExtrapolationMode.CLAMP`.\n     * @zh\n     * 获取或设置此曲线的前向外推模式。\n     * 默认为 `ExtrapolationMode.CLAMP`。\n     */\n    public preExtrapolation: ExtrapolationMode = ExtrapolationMode.CLAMP;\n\n    /**\n     * @en\n     * Gets or sets the post-extrapolation-mode of this curve.\n     * Defaults to `ExtrapolationMode.CLAMP`.\n     * @zh\n     * 获取或设置此曲线的后向外推模式。\n     * 默认为 `ExtrapolationMode.CLAMP`。\n     */\n    public postExtrapolation: ExtrapolationMode = ExtrapolationMode.CLAMP;\n\n    /**\n     * @en\n     * Evaluates this curve at specified time.\n     * @zh\n     * 计算此曲线在指定时间上的值。\n     * @param time Input time.\n     * @returns Result value.\n     */\n    public evaluate (time: number): number {\n        const {\n            _times: times,\n            _values: values,\n        } = this;\n\n        const nFrames = times.length;\n\n        if (nFrames === 0) {\n            return 0.0;\n        }\n\n        const firstTime = times[0];\n        const lastTime = times[nFrames - 1];\n        if (time < firstTime) {\n            // Underflow\n            const { preExtrapolation } = this;\n            const preValue = values[0];\n            if (preExtrapolation === ExtrapolationMode.CLAMP || nFrames < 2) {\n                return preValue.value;\n            }\n            switch (preExtrapolation) {\n            case ExtrapolationMode.LINEAR:\n                return linearTrend(firstTime, values[0].value, times[1], values[1].value, time);\n            case ExtrapolationMode.LOOP:\n                time = wrapRepeat(time, firstTime, lastTime);\n                break;\n            case ExtrapolationMode.PING_PONG:\n                time = wrapPingPong(time, firstTime, lastTime);\n                break;\n            default:\n                return preValue.value;\n            }\n        } else if (time > lastTime) {\n            // Overflow\n            const { postExtrapolation } = this;\n            const preFrame = values[nFrames - 1];\n            if (postExtrapolation === ExtrapolationMode.CLAMP || nFrames < 2) {\n                return preFrame.value;\n            }\n            switch (postExtrapolation) {\n            case ExtrapolationMode.LINEAR:\n                return linearTrend(lastTime, preFrame.value, times[nFrames - 2], values[nFrames - 2].value, time);\n            case ExtrapolationMode.LOOP:\n                time = wrapRepeat(time, firstTime, lastTime);\n                break;\n            case ExtrapolationMode.PING_PONG:\n                time = wrapPingPong(time, firstTime, lastTime);\n                break;\n            default:\n                return preFrame.value;\n            }\n        }\n\n        const index = binarySearchEpsilon(times, time);\n        if (index >= 0) {\n            return values[index].value;\n        }\n\n        const iNext = ~index;\n        assertIsTrue(iNext !== 0 && iNext !== nFrames && nFrames > 1);\n\n        const iPre = iNext - 1;\n        const preTime = times[iPre];\n        const preValue = values[iPre];\n        const nextTime = times[iNext];\n        const nextValue = values[iNext];\n        assertIsTrue(nextTime > time && time > preTime);\n        const dt = nextTime - preTime;\n\n        const ratio = (time - preTime) / dt;\n        return evalBetweenTwoKeyFrames(preTime, preValue, nextTime, nextValue, ratio);\n    }\n\n    /**\n     * @en\n     * Adds a keyframe into this curve.\n     * @zh\n     * 添加一个关键帧到此曲线。\n     * @param time Time of the keyframe.\n     * @param value Value of the keyframe.\n     * @returns The index to the new keyframe.\n     */\n    public addKeyFrame (time: number, value: RealKeyframeValueParameters): number {\n        return super.addKeyFrame(time, createRealKeyframeValue(value));\n    }\n\n    /**\n     * @en\n     * Assigns all keyframes.\n     * @zh\n     * 赋值所有关键帧。\n     * @param keyframes An iterable to keyframes. The keyframes should be sorted by their time.\n     */\n    public assignSorted (keyframes: Iterable<[number, RealKeyframeValueParameters]>): void;\n\n    /**\n      * Assigns all keyframes.\n      * @param times Times array. Should be sorted.\n      * @param values Values array. Corresponding to each time in `times`.\n      */\n    public assignSorted (times: readonly number[], values: RealKeyframeValueParameters[]): void;\n\n    public assignSorted (\n        times: Iterable<[number, RealKeyframeValueParameters]> | readonly number[],\n        values?: readonly RealKeyframeValueParameters[],\n    ) {\n        if (values !== undefined) {\n            assertIsTrue(Array.isArray(times));\n            this.setKeyframes(\n                times.slice(),\n                values.map((value) => createRealKeyframeValue(value)),\n            );\n        } else {\n            const keyframes = Array.from(times as Iterable<[number, Partial<RealKeyframeValue>]>);\n            this.setKeyframes(\n                keyframes.map(([time]) => time),\n                keyframes.map(([, value]) => createRealKeyframeValue(value)),\n            );\n        }\n    }\n\n    /**\n     * @en\n     * Returns if this curve is constant.\n     * @zh\n     * 返回此曲线是否是常量曲线。\n     * @param tolerance The tolerance.\n     * @returns Whether it is constant.\n     */\n    public isConstant (tolerance: number) {\n        if (this._values.length <= 1) {\n            return true;\n        }\n        const firstVal = this._values[0].value;\n        return this._values.every((frame) => approx(frame.value, firstVal, tolerance));\n    }\n\n    /**\n     * @internal\n     */\n    public [serializeTag] (output: SerializationOutput, context: SerializationContext) {\n        if (!context.toCCON) {\n            output.writeThis();\n            return;\n        }\n\n        const {\n            _times: times,\n            _values: keyframeValues,\n        } = this;\n\n        const nKeyframes = times.length;\n\n        const dataSize = 0\n            + OVERFLOW_BYTES + OVERFLOW_BYTES\n            + FRAME_COUNT_BYTES\n            + TIME_BYTES * nKeyframes\n            + REAL_KEY_FRAME_VALUE_MAX_SIZE * nKeyframes;\n\n        const dataView = new DataView(new ArrayBuffer(dataSize));\n        let currentOffset = 0;\n\n        // Overflow operations\n        dataView.setUint8(currentOffset, this.preExtrapolation); currentOffset += OVERFLOW_BYTES;\n        dataView.setUint8(currentOffset, this.postExtrapolation); currentOffset += OVERFLOW_BYTES;\n\n        // Frame count\n        dataView.setUint32(currentOffset, nKeyframes, true); currentOffset += FRAME_COUNT_BYTES;\n\n        // Times\n        times.forEach((time, index) => dataView.setFloat32(currentOffset + TIME_BYTES * index, time, true));\n        currentOffset += TIME_BYTES * nKeyframes;\n\n        // Frame values\n        for (const keyframeValue of keyframeValues) {\n            currentOffset = saveRealKeyFrameValue(dataView, keyframeValue, currentOffset);\n        }\n\n        const bytes = new Uint8Array(dataView.buffer, 0, currentOffset);\n        output.writeProperty('bytes', bytes);\n\n        const keyframeValueEditorExtras = keyframeValues.map((keyframeValue) => keyframeValue[editorExtrasTag]);\n        if (keyframeValueEditorExtras.some((extras) => extras !== undefined)) {\n            output.writeProperty(`keyframeValueEditorExtras`, keyframeValueEditorExtras);\n        }\n    }\n\n    /**\n     * @internal\n     */\n    public [deserializeTag] (input: SerializationInput, context: DeserializationContext) {\n        if (!context.fromCCON) {\n            input.readThis();\n            return;\n        }\n\n        const bytes = input.readProperty('bytes') as Uint8Array;\n\n        const dataView = new DataView(bytes.buffer, bytes.byteOffset, bytes.byteLength);\n        let currentOffset = 0;\n\n        // Overflow operations\n        this.preExtrapolation = dataView.getUint8(currentOffset); currentOffset += OVERFLOW_BYTES;\n        this.postExtrapolation = dataView.getUint8(currentOffset); currentOffset += OVERFLOW_BYTES;\n\n        // Frame count\n        const nKeyframes = dataView.getUint32(currentOffset, true); currentOffset += FRAME_COUNT_BYTES;\n\n        // Times\n        const times = Array.from({ length: nKeyframes },\n            (_, index) => dataView.getFloat32(currentOffset + TIME_BYTES * index, true));\n        currentOffset += TIME_BYTES * nKeyframes;\n\n        // Frame values\n        const keyframeValues = new Array<RealKeyframeValue>(nKeyframes);\n        for (let iKeyFrame = 0; iKeyFrame < nKeyframes; ++iKeyFrame) {\n            const keyframeValue = createRealKeyframeValue({});\n            currentOffset = loadRealKeyFrameValue(dataView, keyframeValue, currentOffset);\n            keyframeValues[iKeyFrame] = keyframeValue;\n        }\n\n        assertIsTrue(currentOffset === bytes.byteLength);\n\n        const keyframeValueEditorExtras = input.readProperty(`keyframeValueEditorExtras`) as unknown[];\n        if (keyframeValueEditorExtras) {\n            assertIsTrue(keyframeValueEditorExtras.length === nKeyframes);\n            keyframeValueEditorExtras.forEach(\n                (extras, index) => keyframeValues[index][editorExtrasTag] = extras,\n            );\n        }\n\n        this._times = times;\n        this._values = keyframeValues;\n    }\n}\n\nCCClass.fastDefine('cc.RealCurve', RealCurve, {\n    _times: [],\n    _values: [],\n    preExtrapolation: ExtrapolationMode.CLAMP,\n    postExtrapolation: ExtrapolationMode.CLAMP,\n});\n\nconst FLAGS_EASING_METHOD_BITS_START = 8;\nconst FLAG_EASING_METHOD_MASK = 0xFF << FLAGS_EASING_METHOD_BITS_START; // 8-16 bits\n\nenum KeyframeValueFlagMask {\n    VALUE = 1 << 0,\n    INTERPOLATION_MODE = 1 << 1,\n    TANGENT_WEIGHT_MODE = 1 << 2,\n    LEFT_TANGENT = 1 << 3,\n    LEFT_TANGENT_WEIGHT = 1 << 4,\n    RIGHT_TANGENT = 1 << 5,\n    RIGHT_TANGENT_WEIGHT = 1 << 6,\n}\n\nconst OVERFLOW_BYTES = 1;\nconst FRAME_COUNT_BYTES = 4;\nconst TIME_BYTES = 4;\nconst KEY_FRAME_VALUE_FLAGS_BYTES = 4;\nconst VALUE_BYTES = 4;\nconst INTERPOLATION_MODE_BYTES = 1;\nconst TANGENT_WEIGHT_MODE_BYTES = 1;\nconst LEFT_TANGENT_BYTES = 4;\nconst LEFT_TANGENT_WEIGHT_BYTES = 4;\nconst RIGHT_TANGENT_BYTES = 4;\nconst RIGHT_TANGENT_WEIGHT_BYTES = 4;\n\nconst {\n    interpolationMode: DEFAULT_INTERPOLATION_MODE,\n    tangentWeightMode: DEFAULT_TANGENT_WEIGHT_MODE,\n    leftTangent: DEFAULT_LEFT_TANGENT,\n    leftTangentWeight: DEFAULT_LEFT_TANGENT_WEIGHT,\n    rightTangent: DEFAULT_RIGHT_TANGENT,\n    rightTangentWeight: DEFAULT_RIGHT_TANGENT_WEIGHT,\n} = createRealKeyframeValue({});\n\nconst REAL_KEY_FRAME_VALUE_MAX_SIZE = KEY_FRAME_VALUE_FLAGS_BYTES\n    + VALUE_BYTES\n    + INTERPOLATION_MODE_BYTES\n    + TANGENT_WEIGHT_MODE_BYTES\n    + LEFT_TANGENT_BYTES\n    + LEFT_TANGENT_WEIGHT_BYTES\n    + RIGHT_TANGENT_BYTES\n    + RIGHT_TANGENT_WEIGHT_BYTES\n    + 0;\n\nfunction saveRealKeyFrameValue (dataView: DataView, keyframeValue: RealKeyframeValue, offset: number) {\n    let flags = 0;\n\n    let currentOffset = offset;\n\n    const pFlags = currentOffset; // Place holder for flags\n    currentOffset += KEY_FRAME_VALUE_FLAGS_BYTES;\n\n    const {\n        value,\n        interpolationMode,\n        tangentWeightMode,\n        rightTangent,\n        rightTangentWeight,\n        leftTangent,\n        leftTangentWeight,\n        easingMethod,\n    } = keyframeValue;\n\n    dataView.setFloat32(currentOffset, value, true);\n    currentOffset += VALUE_BYTES;\n\n    if (interpolationMode !== DEFAULT_INTERPOLATION_MODE) {\n        flags |= KeyframeValueFlagMask.INTERPOLATION_MODE;\n        dataView.setUint8(currentOffset, interpolationMode);\n        currentOffset += INTERPOLATION_MODE_BYTES;\n    }\n\n    if (tangentWeightMode !== DEFAULT_TANGENT_WEIGHT_MODE) {\n        flags |= KeyframeValueFlagMask.TANGENT_WEIGHT_MODE;\n        dataView.setUint8(currentOffset, tangentWeightMode);\n        currentOffset += TANGENT_WEIGHT_MODE_BYTES;\n    }\n\n    if (leftTangent !== DEFAULT_LEFT_TANGENT) {\n        flags |= KeyframeValueFlagMask.LEFT_TANGENT;\n        dataView.setFloat32(currentOffset, leftTangent, true);\n        currentOffset += LEFT_TANGENT_BYTES;\n    }\n\n    if (leftTangentWeight !== DEFAULT_LEFT_TANGENT_WEIGHT) {\n        flags |= KeyframeValueFlagMask.LEFT_TANGENT_WEIGHT;\n        dataView.setFloat32(currentOffset, leftTangentWeight, true);\n        currentOffset += LEFT_TANGENT_WEIGHT_BYTES;\n    }\n\n    if (rightTangent !== DEFAULT_RIGHT_TANGENT) {\n        flags |= KeyframeValueFlagMask.RIGHT_TANGENT;\n        dataView.setFloat32(currentOffset, rightTangent, true);\n        currentOffset += RIGHT_TANGENT_BYTES;\n    }\n\n    if (rightTangentWeight !== DEFAULT_RIGHT_TANGENT_WEIGHT) {\n        flags |= KeyframeValueFlagMask.RIGHT_TANGENT_WEIGHT;\n        dataView.setFloat32(currentOffset, rightTangentWeight, true);\n        currentOffset += RIGHT_TANGENT_WEIGHT_BYTES;\n    }\n\n    flags |= (easingMethod << FLAGS_EASING_METHOD_BITS_START);\n\n    dataView.setUint32(pFlags, flags, true);\n\n    return currentOffset;\n}\n\nfunction loadRealKeyFrameValue (dataView: DataView, keyframeValue: RealKeyframeValue, offset: number) {\n    let currentOffset = offset;\n\n    const flags = dataView.getUint32(currentOffset, true);\n    currentOffset += KEY_FRAME_VALUE_FLAGS_BYTES;\n\n    keyframeValue.value = dataView.getFloat32(currentOffset, true);\n    currentOffset += VALUE_BYTES;\n\n    if (flags & KeyframeValueFlagMask.INTERPOLATION_MODE) {\n        keyframeValue.interpolationMode = dataView.getUint8(currentOffset);\n        currentOffset += INTERPOLATION_MODE_BYTES;\n    }\n\n    if (flags & KeyframeValueFlagMask.TANGENT_WEIGHT_MODE) {\n        keyframeValue.tangentWeightMode = dataView.getUint8(currentOffset);\n        currentOffset += TANGENT_WEIGHT_MODE_BYTES;\n    }\n\n    if (flags & KeyframeValueFlagMask.LEFT_TANGENT) {\n        keyframeValue.leftTangent = dataView.getFloat32(currentOffset, true);\n        currentOffset += LEFT_TANGENT_BYTES;\n    }\n\n    if (flags & KeyframeValueFlagMask.LEFT_TANGENT_WEIGHT) {\n        keyframeValue.leftTangentWeight = dataView.getFloat32(currentOffset, true);\n        currentOffset += LEFT_TANGENT_WEIGHT_BYTES;\n    }\n\n    if (flags & KeyframeValueFlagMask.RIGHT_TANGENT) {\n        keyframeValue.rightTangent = dataView.getFloat32(currentOffset, true);\n        currentOffset += RIGHT_TANGENT_BYTES;\n    }\n\n    if (flags & KeyframeValueFlagMask.RIGHT_TANGENT_WEIGHT) {\n        keyframeValue.rightTangentWeight = dataView.getFloat32(currentOffset, true);\n        currentOffset += RIGHT_TANGENT_WEIGHT_BYTES;\n    }\n\n    const easingMethod = ((flags & FLAG_EASING_METHOD_MASK) >> FLAGS_EASING_METHOD_BITS_START) as EasingMethod;\n    keyframeValue.easingMethod = easingMethod;\n\n    return currentOffset;\n}\n\nfunction wrapRepeat (time: number, prevTime: number, nextTime: number) {\n    return prevTime + repeat(time - prevTime, nextTime - prevTime);\n}\n\nfunction wrapPingPong (time: number, prevTime: number, nextTime: number) {\n    return prevTime + pingPong(time - prevTime, nextTime - prevTime);\n}\n\nfunction linearTrend (\n    prevTime: number,\n    prevValue: number,\n    nextTime: number,\n    nextValue: number,\n    time: number,\n) {\n    const slope = (nextValue - prevValue) / (nextTime - prevTime);\n    return prevValue + (time - prevTime) * slope;\n}\n\nfunction evalBetweenTwoKeyFrames (\n    prevTime: number,\n    prevValue: RealKeyframeValue,\n    nextTime: number,\n    nextValue: RealKeyframeValue,\n    ratio: number,\n) {\n    const dt = nextTime - prevTime;\n    switch (prevValue.interpolationMode) {\n    default:\n    case RealInterpolationMode.CONSTANT:\n        return prevValue.value;\n    case RealInterpolationMode.LINEAR: {\n        const transformedRatio = prevValue.easingMethod === EasingMethod.LINEAR\n            ? ratio\n            : getEasingFn(prevValue.easingMethod)(ratio);\n        return lerp(prevValue.value, nextValue.value, transformedRatio);\n    }\n    case RealInterpolationMode.CUBIC: {\n        const ONE_THIRD = 1.0 / 3.0;\n        const {\n            rightTangent: prevTangent,\n            rightTangentWeight: prevTangentWeightSpecified,\n        } = prevValue;\n        const prevTangentWeightEnabled = isRightTangentWeightEnabled(prevValue.tangentWeightMode);\n        const {\n            leftTangent: nextTangent,\n            leftTangentWeight: nextTangentWeightSpecified,\n        } = nextValue;\n        const nextTangentWeightEnabled = isLeftTangentWeightEnabled(nextValue.tangentWeightMode);\n\n        if (!prevTangentWeightEnabled && !nextTangentWeightEnabled) {\n            // Optimize for the case when both x components of tangents are 1.\n            // See below.\n            const p1 = prevValue.value + ONE_THIRD * prevTangent * dt;\n            const p2 = nextValue.value - ONE_THIRD * nextTangent * dt;\n            return bezierInterpolate(prevValue.value, p1, p2, nextValue.value, ratio);\n        } else {\n            let prevTangentWeight = 0.0;\n            if (prevTangentWeightEnabled) {\n                prevTangentWeight = prevTangentWeightSpecified;\n            } else {\n                const x = dt;\n                const y = dt * prevTangent;\n                prevTangentWeight = Math.sqrt(x * x + y * y) * ONE_THIRD;\n            }\n            const angle0 = Math.atan(prevTangent);\n            const tx0 = Math.cos(angle0) * prevTangentWeight + prevTime;\n            const ty0 = Math.sin(angle0) * prevTangentWeight + prevValue.value;\n\n            let nextTangentWeight = 0.0;\n            if (nextTangentWeightEnabled) {\n                nextTangentWeight = nextTangentWeightSpecified;\n            } else {\n                const x = dt;\n                const y = dt * nextTangent;\n                nextTangentWeight = Math.sqrt(x * x + y * y) * ONE_THIRD;\n            }\n            const angle1 = Math.atan(nextTangent);\n            const tx1 = -Math.cos(angle1) * nextTangentWeight + nextTime;\n            const ty1 = -Math.sin(angle1) * nextTangentWeight + nextValue.value;\n\n            const dx = dt;\n            // Hermite to Bezier\n            const u0x = (tx0 - prevTime) / dx;\n            const u1x = (tx1 - prevTime) / dx;\n            const u0y = ty0;\n            const u1y = ty1;\n            // Converts from Bernstein Basis to Power Basis.\n            // Formula: [1, 0, 0, 0; -3, 3, 0, 0; 3, -6, 3, 0; -1, 3, -3, 1] * [p_0; p_1; p_2; p_3]\n            // --------------------------------------\n            // | Basis | Coeff\n            // | t^3   | 3 * p_1 - p_0 - 3 * p_2 + p_3\n            // | t^2   | 3 * p_0 - 6 * p_1 + 3 * p_2\n            // | t^1   | 3 * p_1 - 3 * p_0\n            // | t^0   | p_0\n            // --------------------------------------\n            // where: p_0 = 0, p_1 = u0x, p_2 = u1x, p_3 = 1\n            // Especially, when both tangents are 1, we will have u0x = 1/3 and u1x = 2/3\n            // and then: ratio = t, eg. the ratios are\n            // 1-1 corresponding to param t. That's why we can do optimization like above.\n            const coeff0 = 0.0; // 0\n            const coeff1 = 3.0 * u0x; // 1\n            const coeff2 = 3.0 * u1x - 6.0 * u0x; // -1\n            const coeff3 = 3.0 * (u0x - u1x) + 1.0; // 1\n            // Solves the param t from equation X(t) = ratio.\n            const solutions = [0.0, 0.0, 0.0] as [number, number, number];\n            const nSolutions = solveCubic(coeff0 - ratio, coeff1, coeff2, coeff3, solutions);\n            const param = getParamFromCubicSolution(solutions, nSolutions, ratio);\n            // Solves Y.\n            const y = bezierInterpolate(prevValue.value, u0y, u1y, nextValue.value, param);\n            return y;\n        }\n    }\n    }\n}\n\nfunction isLeftTangentWeightEnabled (tangentWeightMode: TangentWeightMode) {\n    return (tangentWeightMode & TangentWeightMode.LEFT) !== 0;\n}\n\nfunction isRightTangentWeightEnabled (tangentWeightMode: TangentWeightMode) {\n    return (tangentWeightMode & TangentWeightMode.RIGHT) !== 0;\n}\n\nfunction bezierInterpolate (p0: number, p1: number, p2: number, p3: number, t: number) {\n    const u = 1 - t;\n    const coeff0 = u * u * u;\n    const coeff1 = 3 * u * u * t;\n    const coeff2 = 3 * u * t * t;\n    const coeff3 = t * t * t;\n    return coeff0 * p0 + coeff1 * p1 + coeff2 * p2 + coeff3 * p3;\n}\n\nfunction getParamFromCubicSolution (solutions: readonly [number, number, number], solutionsCount: number, x: number) {\n    let param = x;\n    if (solutionsCount === 1) {\n        param = solutions[0];\n    } else {\n        param = -Infinity;\n        for (let iSolution = 0; iSolution < solutionsCount; ++iSolution) {\n            const solution = solutions[iSolution];\n            if (solution >= 0.0 && solution <= 1.0) {\n                if (solution > param) {\n                    param = solution;\n                }\n            }\n        }\n        if (param === -Infinity) {\n            param = 0.0;\n        }\n    }\n    return param;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { legacyCC } from '../global-exports';\n\nexport type BezierControlPoints = [ number, number, number, number ];\n\nexport function bezier (C1: number, C2: number, C3: number, C4: number, t: number) {\n    const t1 = 1 - t;\n    return t1 * (t1 * (C1 + (C2 * 3 - C1) * t) + C3 * 3 * t * t) + C4 * t * t * t;\n}\nlegacyCC.bezier = bezier;\n\n// var sin = Math.sin;\nconst cos = Math.cos;\nconst acos = Math.acos;\nconst max = Math.max;\n// var atan2 = Math.atan2;\nconst pi = Math.PI;\nconst tau = 2 * pi;\nconst sqrt = Math.sqrt;\n\nfunction crt (v: number) {\n    if (v < 0) {\n        return -Math.pow(-v, 1 / 3);\n    } else {\n        return Math.pow(v, 1 / 3);\n    }\n}\n\n// Modified from http://jsbin.com/yibipofeqi/1/edit, optimized for animations.\n// The origin Cardano's algorithm is based on http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\nfunction cardano (curve: BezierControlPoints, x: number) {\n    // align curve with the intersecting line:\n    // var line = {p1: {x: x, y: 0}, p2: {x: x, y: 1}};\n    // var aligned = align(curve, line);\n    /// / and rewrite from [a(1-t)^3 + 3bt(1-t)^2 + 3c(1-t)t^2 + dt^3] form\n    //    pa = aligned[0].y,\n    //    pb = aligned[1].y,\n    //    pc = aligned[2].y,\n    //    pd = aligned[3].y;\n    /// /// curve = [{x:0, y:1}, {x: curve[0], y: 1-curve[1]}, {x: curve[2], y: 1-curve[3]}, {x:1, y:0}];\n    const pa = x - 0;\n    const pb = x - curve[0];\n    const pc = x - curve[2];\n    const pd = x - 1;\n\n    // to [t^3 + at^2 + bt + c] form:\n    const pa3 = pa * 3;\n    const pb3 = pb * 3;\n    const pc3 = pc * 3;\n    const d = (-pa + pb3 - pc3 + pd);\n    const rd = 1 / d;\n    const r3 = 1 / 3;\n    const a = (pa3 - 6 * pb + pc3) * rd;\n    const a3 = a * r3;\n    const b = (-pa3 + pb3) * rd;\n    const c = pa * rd;\n    // then, determine p and q:\n    const p = (3 * b - a * a) * r3;\n    const p3 = p * r3;\n    const q = (2 * a * a * a - 9 * a * b + 27 * c) / 27;\n    const q2 = q / 2;\n    // and determine the discriminant:\n    const discriminant = q2 * q2 + p3 * p3 * p3;\n    // and some reserved variables\n    let u1;\n    let v1;\n    let x1;\n    let x2;\n    let x3;\n\n    // If the discriminant is negative, use polar coordinates\n    // to get around square roots of negative numbers\n    if (discriminant < 0) {\n        const mp3 = -p * r3;\n        const mp33 = mp3 * mp3 * mp3;\n        const r = sqrt(mp33);\n        // compute cosphi corrected for IEEE float rounding:\n        const t = -q / (2 * r);\n        const cosphi = t < -1 ? -1 : t > 1 ? 1 : t;\n        const phi = acos(cosphi);\n        const crtr = crt(r);\n        const t1 = 2 * crtr;\n        x1 = t1 * cos(phi * r3) - a3;\n        x2 = t1 * cos((phi + tau) * r3) - a3;\n        x3 = t1 * cos((phi + 2 * tau) * r3) - a3;\n\n        // choose best percentage\n        if (x1 >= 0 && x1 <= 1) {\n            if (x2 >= 0 && x2 <= 1) {\n                if (x3 >= 0 && x3 <= 1) {\n                    return max(x1, x2, x3);\n                } else {\n                    return max(x1, x2);\n                }\n            } else if (x3 >= 0 && x3 <= 1) {\n                return max(x1, x3);\n            } else {\n                return x1;\n            }\n        } else if (x2 >= 0 && x2 <= 1) {\n            if (x3 >= 0 && x3 <= 1) {\n                return max(x2, x3);\n            } else {\n                return x2;\n            }\n        } else {\n            return x3;\n        }\n    } else if (discriminant === 0) {\n        u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n        x1 = 2 * u1 - a3;\n        x2 = -u1 - a3;\n\n        // choose best percentage\n        if (x1 >= 0 && x1 <= 1) {\n            if (x2 >= 0 && x2 <= 1) {\n                return max(x1, x2);\n            } else {\n                return x1;\n            }\n        } else {\n            return x2;\n        }\n    }\n    // one real root, and two imaginary roots\n    else {\n        const sd = sqrt(discriminant);\n        u1 = crt(-q2 + sd);\n        v1 = crt(q2 + sd);\n        x1 = u1 - v1 - a3;\n        return x1;\n    }\n}\n\nexport function bezierByTime (controlPoints: BezierControlPoints, x: number) {\n    const percent = cardano(controlPoints, x);    // t\n    const p1y = controlPoints[1]; // b\n    const p2y = controlPoints[3]; // c\n    // return bezier(0, p1y, p2y, 1, percent);\n    return ((1 - percent) * (p1y + (p2y - p1y) * percent) * 3 + percent * percent) * percent;\n}\nlegacyCC.bezierByTime = bezierByTime;\n","import { assertIsTrue } from '../data/utils/asserts';\nimport { IQuatLike, pingPong, Quat, repeat } from '../math';\nimport { KeyframeCurve } from './keyframe-curve';\nimport { EasingMethod, ExtrapolationMode } from './curve';\nimport { binarySearchEpsilon } from '../algorithm/binary-search';\nimport { ccclass, serializable, uniquelyReferenced } from '../data/decorators';\nimport { deserializeTag, SerializationContext, SerializationInput, SerializationOutput, serializeTag } from '../data';\nimport { DeserializationContext } from '../data/custom-serializable';\nimport { getEasingFn } from './easing-method';\nimport { bezierByTime } from './bezier';\n\n/**\n * @en\n * The method used for interpolation between values of a quaternion keyframe and its next keyframe.\n * @zh\n * 在某四元数关键帧（前一帧）和其下一帧之间插值时使用的插值方式。\n */\nexport enum QuatInterpolationMode {\n    /**\n     * @en\n     * Perform spherical linear interpolation between previous keyframe value and next keyframe value.\n     * @zh\n     * 在前一帧和后一帧之间执行球面线性插值。\n     */\n    SLERP,\n\n    /**\n     * @en\n     * Always use the value from this keyframe.\n     * @zh\n     * 永远使用前一帧的值。\n     */\n    CONSTANT,\n\n    // #region TODO: Spherical Quadrangle Interpolation\n    /**\n     * TODO: Spherical Quadrangle Interpolation\n     * - https://theory.org/software/qfa/writeup/node12.html\n     * - http://digitalrune.github.io/DigitalRune-Documentation/html/58f74cca-83a3-5e9e-6d5d-63b09a723f90.htm\n     */\n    // SQUAD,\n    // #endregion\n}\n\n/**\n * View to a quaternion frame value.\n * Note, the view may be invalidated due to keyframe change/add/remove.\n */\n@ccclass('cc.QuatKeyframeValue')\n@uniquelyReferenced\nclass QuatKeyframeValue {\n    /**\n     * @en\n     * When perform interpolation, the interpolation method should be taken\n     * when for this keyframe is used as starting keyframe.\n     * @zh\n     * 在执行插值时，当以此关键帧作为起始关键帧时应当使用的插值方式。\n     */\n    @serializable\n    public interpolationMode: QuatInterpolationMode = QuatInterpolationMode.SLERP;\n\n    /**\n     * @en\n     * Value of the keyframe.\n     * @zh\n     * 该关键帧的值。\n     */\n    @serializable\n    public value: IQuatLike = Quat.clone(Quat.IDENTITY);\n\n    /**\n     * @internal Reserved for backward compatibility. Will be removed in future.\n     */\n    @serializable\n    public easingMethod: EasingMethod | [number, number, number, number] = EasingMethod.LINEAR;\n\n    constructor ({\n        value,\n        interpolationMode,\n        easingMethod,\n    }:  Partial<QuatKeyframeValue> = {}) {\n        // TODO: shall we normalize it?\n        this.value = value ? Quat.clone(value) : this.value;\n        this.interpolationMode = interpolationMode ?? this.interpolationMode;\n        this.easingMethod = easingMethod ?? this.easingMethod;\n    }\n}\n\nexport type { QuatKeyframeValue };\n\n/**\n * The parameter describing a real keyframe value.\n * In the case of partial keyframe value,\n * each component of the keyframe value is taken from the parameter.\n * For unspecified components, default values are taken:\n * - Interpolation mode: slerp\n * - Value: Identity quaternion\n * @zh\n * 用于描述实数关键帧值的参数。\n * 若是部分关键帧的形式，关键帧值的每个分量都是从该参数中取得。\n * 对于未指定的分量，使用默认值：\n * - 插值模式：球面线性插值\n * - 值：单位四元数\n */\ntype QuatKeyframeValueParameters = Partial<QuatKeyframeValue>;\n\nfunction createQuatKeyframeValue (params: QuatKeyframeValueParameters) {\n    return new QuatKeyframeValue(params);\n}\n\n/**\n * @en\n * Quaternion curve.\n * @zh\n * 四元数曲线\n */\n@ccclass('cc.QuatCurve')\nexport class QuatCurve extends KeyframeCurve<QuatKeyframeValue> {\n    /**\n     * @en\n     * Gets or sets the pre-extrapolation-mode of this curve.\n     * Defaults to `ExtrapolationMode.CLAMP`.\n     * @zh\n     * 获取或设置此曲线的前向外推模式。\n     * 默认为 `ExtrapolationMode.CLAMP`。\n     */\n    @serializable\n    public preExtrapolation: ExtrapolationMode = ExtrapolationMode.CLAMP;\n\n    /**\n     * @en\n     * Gets or sets the post-extrapolation-mode of this curve.\n     * Defaults to `ExtrapolationMode.CLAMP`.\n     * @zh\n     * 获取或设置此曲线的后向外推模式。\n     * 默认为 `ExtrapolationMode.CLAMP`。\n     */\n    @serializable\n    public postExtrapolation: ExtrapolationMode = ExtrapolationMode.CLAMP;\n\n    /**\n     * @en\n     * Evaluates this curve at specified time.\n     * @zh\n     * 计算此曲线在指定时间上的值。\n     * @param time Input time.\n     * @param quat If specified, this value will be filled and returned.\n     * Otherwise a new quaternion object will be filled and returned.\n     * @returns Result value.\n     */\n    public evaluate (time: number, quat?: Quat): Quat {\n        quat ??= new Quat();\n\n        const {\n            _times: times,\n            _values: values,\n            postExtrapolation,\n            preExtrapolation,\n        } = this;\n        const nFrames = times.length;\n\n        if (nFrames === 0) {\n            return quat;\n        }\n\n        const firstTime = times[0];\n        const lastTime = times[nFrames - 1];\n        if (time < firstTime) {\n            // Underflow\n            const preValue = values[0];\n            switch (preExtrapolation) {\n            case ExtrapolationMode.LOOP:\n                time = firstTime + repeat(time - firstTime, lastTime - firstTime);\n                break;\n            case ExtrapolationMode.PING_PONG:\n                time = firstTime + pingPong(time - firstTime, lastTime - firstTime);\n                break;\n            case ExtrapolationMode.CLAMP:\n            default:\n                return Quat.copy(quat, preValue.value);\n            }\n        } else if (time > lastTime) {\n            // Overflow\n            const preValue = values[nFrames - 1];\n            switch (postExtrapolation) {\n            case ExtrapolationMode.LOOP:\n                time = firstTime + repeat(time - firstTime, lastTime - firstTime);\n                break;\n            case ExtrapolationMode.PING_PONG:\n                time = firstTime + pingPong(time - firstTime, lastTime - firstTime);\n                break;\n            case ExtrapolationMode.CLAMP:\n            default:\n                return Quat.copy(quat, preValue.value);\n            }\n        }\n\n        const index = binarySearchEpsilon(times, time);\n        if (index >= 0) {\n            return Quat.copy(quat, values[index].value);\n        }\n\n        const iNext = ~index;\n        assertIsTrue(iNext !== 0 && iNext !== nFrames && nFrames > 1);\n\n        const iPre = iNext - 1;\n        const preTime = times[iPre];\n        const preValue = values[iPre];\n        const nextTime = times[iNext];\n        const nextValue = values[iNext];\n        assertIsTrue(nextTime > time && time > preTime);\n        const dt = nextTime - preTime;\n\n        const ratio = (time - preTime) / dt;\n        switch (preValue.interpolationMode) {\n        default:\n        case QuatInterpolationMode.CONSTANT:\n            return Quat.copy(quat, preValue.value);\n        case QuatInterpolationMode.SLERP: {\n            const { easingMethod } = preValue;\n            const transformedRatio = easingMethod === EasingMethod.LINEAR\n                ? ratio\n                : Array.isArray(easingMethod)\n                    ? bezierByTime(easingMethod, ratio)\n                    : getEasingFn(easingMethod)(ratio);\n            return Quat.slerp(quat, preValue.value, nextValue.value, transformedRatio);\n        }\n        }\n    }\n\n    /**\n     * Adds a keyframe into this curve.\n     * @param time Time of the keyframe.\n     * @param value Value of the keyframe.\n     * @returns The index to the new keyframe.\n     */\n    public addKeyFrame (time: number, value: QuatKeyframeValueParameters): number {\n        const keyframeValue = new QuatKeyframeValue(value);\n        return super.addKeyFrame(time, keyframeValue);\n    }\n\n    /**\n     * Assigns all keyframes.\n     * @param keyframes An iterable to keyframes. The keyframes should be sorted by their time.\n     */\n    public assignSorted (keyframes: Iterable<[number, QuatKeyframeValueParameters]>): void;\n\n    /**\n       * Assigns all keyframes.\n       * @param times Times array. Should be sorted.\n       * @param values Values array. Corresponding to each time in `times`.\n       */\n    public assignSorted (times: readonly number[], values: QuatKeyframeValueParameters[]): void;\n\n    public assignSorted (\n        times: Iterable<[number, QuatKeyframeValueParameters]> | readonly number[],\n        values?: readonly QuatKeyframeValueParameters[],\n    ) {\n        if (values !== undefined) {\n            assertIsTrue(Array.isArray(times));\n            this.setKeyframes(\n                times.slice(),\n                values.map((value) => createQuatKeyframeValue(value)),\n            );\n        } else {\n            const keyframes = Array.from(times as Iterable<[number, QuatKeyframeValueParameters]>);\n            this.setKeyframes(\n                keyframes.map(([time]) => time),\n                keyframes.map(([, value]) => createQuatKeyframeValue(value)),\n            );\n        }\n    }\n\n    /**\n     * @internal\n     */\n    public [serializeTag] (output: SerializationOutput, context: SerializationContext) {\n        if (!context.toCCON) {\n            output.writeThis();\n            return;\n        }\n\n        const {\n            _times: times,\n            _values: keyframeValues,\n        } = this;\n\n        let interpolationModeRepeated = true;\n        keyframeValues.forEach((keyframeValue, _index, [firstKeyframeValue]) => {\n            // Values are unlikely to be unified.\n            if (interpolationModeRepeated\n                && keyframeValue.interpolationMode !== firstKeyframeValue.interpolationMode) { interpolationModeRepeated = false; }\n        });\n\n        const nKeyframes = times.length;\n\n        const nFrames = nKeyframes;\n        const interpolationModesSize = INTERPOLATION_MODE_BYTES * (interpolationModeRepeated ? 1 : nFrames);\n        const easingMethodsSize = keyframeValues.reduce(\n            (result, { easingMethod }) => result += (Array.isArray(easingMethod)\n                ? EASING_METHOD_BYTES + (EASING_METHOD_BEZIER_COMPONENT_BYTES * 4)\n                : EASING_METHOD_BYTES), 0,\n        );\n\n        let dataSize = 0;\n        dataSize += (\n            FLAGS_BYTES\n            + FRAME_COUNT_BYTES\n            + TIME_BYTES * nFrames\n            + VALUE_BYTES * 4 * nFrames\n            + easingMethodsSize\n            + interpolationModesSize\n            + 0\n        );\n\n        const dataView = new DataView(new ArrayBuffer(dataSize));\n        let P = 0;\n\n        // Flags\n        let flags = 0;\n        if (interpolationModeRepeated) { flags |= KeyframeValueFlagMask.INTERPOLATION_MODE; }\n        dataView.setUint32(P, flags, true); P += FLAGS_BYTES;\n\n        // Frame count\n        dataView.setUint32(P, nFrames, true); P += FRAME_COUNT_BYTES;\n\n        // Times\n        times.forEach((time, index) => dataView.setFloat32(P + TIME_BYTES * index, time, true));\n        P += TIME_BYTES * nFrames;\n\n        // Values\n        keyframeValues.forEach(({ value: { x, y, z, w } }, index) => {\n            const pQuat = P + VALUE_BYTES * 4 * index;\n            dataView.setFloat32(pQuat + VALUE_BYTES * 0, x, true);\n            dataView.setFloat32(pQuat + VALUE_BYTES * 1, y, true);\n            dataView.setFloat32(pQuat + VALUE_BYTES * 2, z, true);\n            dataView.setFloat32(pQuat + VALUE_BYTES * 3, w, true);\n        });\n        P += VALUE_BYTES * 4 * nFrames;\n\n        // Easing methods\n        keyframeValues.forEach(({ easingMethod }, index) => {\n            if (!Array.isArray(easingMethod)) {\n                dataView.setUint8(P, easingMethod);\n                ++P;\n            } else {\n                dataView.setUint8(P, EASING_METHOD_BEZIER_TAG);\n                ++P;\n                dataView.setFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 0, easingMethod[0], true);\n                dataView.setFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 1, easingMethod[1], true);\n                dataView.setFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 2, easingMethod[2], true);\n                dataView.setFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 3, easingMethod[3], true);\n                P += (EASING_METHOD_BEZIER_COMPONENT_BYTES * 4);\n            }\n        });\n\n        // Frame values\n        const INTERPOLATION_MODES_START = P; P += interpolationModesSize;\n        let pInterpolationMode = INTERPOLATION_MODES_START;\n        keyframeValues.forEach(({ interpolationMode }) => {\n            dataView.setUint8(pInterpolationMode, interpolationMode);\n\n            if (!interpolationModeRepeated) { pInterpolationMode += INTERPOLATION_MODE_BYTES; }\n        });\n\n        const bytes = new Uint8Array(dataView.buffer);\n        output.writeProperty('bytes', bytes);\n    }\n\n    /**\n     * @internal\n     */\n    public [deserializeTag] (input: SerializationInput, context: DeserializationContext) {\n        if (!context.fromCCON) {\n            input.readThis();\n            return;\n        }\n\n        const bytes = input.readProperty('bytes') as Uint8Array;\n\n        const dataView = new DataView(bytes.buffer, bytes.byteOffset, bytes.byteLength);\n        let P = 0;\n\n        // Flags\n        const flags = dataView.getUint32(P, true); P += FLAGS_BYTES;\n        const interpolationModeRepeated = flags & KeyframeValueFlagMask.INTERPOLATION_MODE;\n\n        // Frame count\n        const nFrames = dataView.getUint32(P, true); P += FRAME_COUNT_BYTES;\n\n        // Times\n        const times = Array.from({ length: nFrames },\n            (_, index) => dataView.getFloat32(P + TIME_BYTES * index, true));\n        P += TIME_BYTES * nFrames;\n\n        // Frame values\n        const P_VALUES = P; P += VALUE_BYTES * 4 * nFrames;\n        const keyframeValues = Array.from({ length: nFrames },\n            (_, index) => {\n                const pQuat = P_VALUES + VALUE_BYTES * 4 * index;\n                const x = dataView.getFloat32(pQuat + VALUE_BYTES * 0, true);\n                const y = dataView.getFloat32(pQuat + VALUE_BYTES * 1, true);\n                const z = dataView.getFloat32(pQuat + VALUE_BYTES * 2, true);\n                const w = dataView.getFloat32(pQuat + VALUE_BYTES * 3, true);\n                const easingMethod = dataView.getUint8(P);\n                ++P;\n                const keyframeValue = createQuatKeyframeValue({\n                    value: { x, y, z, w },\n                });\n                if (easingMethod !== EASING_METHOD_BEZIER_TAG) {\n                    keyframeValue.easingMethod = easingMethod as EasingMethod;\n                } else {\n                    keyframeValue.easingMethod = [\n                        dataView.getFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 0, true),\n                        dataView.getFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 1, true),\n                        dataView.getFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 2, true),\n                        dataView.getFloat32(P + EASING_METHOD_BEZIER_COMPONENT_BYTES * 3, true),\n                    ];\n                    P += EASING_METHOD_BEZIER_COMPONENT_BYTES * 4;\n                }\n                return keyframeValue;\n            });\n\n        if (interpolationModeRepeated) {\n            const interpolationMode = dataView.getUint8(P);\n            ++P;\n            for (let iKeyframe = 0; iKeyframe < nFrames; ++iKeyframe) {\n                keyframeValues[iKeyframe].interpolationMode = interpolationMode;\n            }\n        } else {\n            for (let iKeyframe = 0; iKeyframe < nFrames; ++iKeyframe) {\n                const interpolationMode = dataView.getUint8(P + iKeyframe);\n                keyframeValues[iKeyframe].interpolationMode = interpolationMode;\n            }\n            P += nFrames;\n        }\n\n        this._times = times;\n        this._values = keyframeValues;\n    }\n}\n\nenum KeyframeValueFlagMask {\n    INTERPOLATION_MODE = 1 << 0,\n}\n\nconst FLAGS_BYTES = 1;\nconst FRAME_COUNT_BYTES = 4;\nconst TIME_BYTES = 4;\nconst VALUE_BYTES = 4;\nconst INTERPOLATION_MODE_BYTES = 1;\nconst EASING_METHOD_BYTES = 1;\nconst EASING_METHOD_BEZIER_TAG = 255;\nconst EASING_METHOD_BEZIER_COMPONENT_BYTES = 4;\n","import { ccclass } from '../data/decorators';\r\nimport { clamp } from '../math';\r\nimport { KeyframeCurve } from './keyframe-curve';\r\n\r\nexport type ObjectCurveKeyframe<T> = T;\r\n\r\n@ccclass('cc.ObjectCurve')\r\nexport class ObjectCurve<T> extends KeyframeCurve<ObjectCurveKeyframe<T>> {\r\n    public evaluate (time: number) {\r\n        const iSearch = this.searchKeyframe(time);\r\n        if (iSearch >= 0) {\r\n            return this._values[iSearch];\r\n        }\r\n        const iPrev = clamp((~iSearch) - 1, 0, this._values.length - 1);\r\n        return this._values[iPrev];\r\n    }\r\n}\r\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { assertIsTrue } from '../data/utils/asserts';\nimport { clamp, Vec3 } from '../math';\nimport { warnID } from '../platform/debug';\nimport enums from './enums';\n\nexport enum SplineMode {\n    /**\n     * Broken line:\n     * Each knot is connected with a straight line from the beginning to the end to form a curve. At least two knots.\n     */\n    LINEAR = 0,\n\n    /**\n     * Piecewise Bezier curve:\n     * Every four knots form a curve. Total knots number must be a multiple of 4.\n     * Each curve passes only the first and fourth knots, and does not pass through the middle two control knots.\n     *\n     * If you need a whole continuous curve:\n     * (1) Suppose the four knots of the previous curve are A, B, C, D\n     * (2) The four knots of the next curve must be D, E, F, G\n     * (3) C and E need to be symmetrical about D\n     */\n    BEZIER = 1,\n\n    /**\n     * Catmull Rom curve:\n     * All knots(including start & end knots) form a whole continuous curve. At least two knots.\n     * The whole curve passes through all knots.\n     */\n    CATMULL_ROM = 2\n}\n\nconst SPLINE_WHOLE_INDEX = 0xffffffff;\n\nconst _v0 = new Vec3();\nconst _v1 = new Vec3();\nconst _v2 = new Vec3();\nconst _v3 = new Vec3();\n\n/**\n * @en\n * Basic Geometry: Spline.\n * @zh\n * 基础几何 Spline\n */\n\nexport class Spline {\n    private readonly _type: number;\n    private _mode: SplineMode = SplineMode.CATMULL_ROM;\n    private _knots: Vec3[] = [];\n\n    private constructor (mode: SplineMode = SplineMode.CATMULL_ROM, knots: Readonly<Vec3[]> = []) {\n        this._type = enums.SHAPE_SPLINE;\n        this._mode = mode;\n\n        for (let i = 0; i < knots.length; i++) {\n            this._knots[i] = new Vec3(knots[i]);\n        }\n    }\n\n    public static create (mode: SplineMode, knots: Vec3[] = []) {\n        return new Spline(mode, knots);\n    }\n\n    public static clone (s: Spline) {\n        return new Spline(s.mode, s.knots);\n    }\n\n    public static copy (out: Spline, s: Spline) {\n        out._mode = s.mode;\n        out._knots.length = 0;\n\n        const knots = s.knots;\n        const length = knots.length;\n        for (let i = 0; i < length; i++) {\n            out._knots[i] = new Vec3(knots[i]);\n        }\n\n        return out;\n    }\n\n    get type () {\n        return this._type;\n    }\n\n    get mode () {\n        return this._mode;\n    }\n\n    get knots (): Readonly<Vec3[]> {\n        return this._knots;\n    }\n\n    public setModeAndKnots (mode: SplineMode, knots: Vec3[]) {\n        this._mode = mode;\n        this._knots.length = 0;\n\n        for (let i = 0; i < knots.length; i++) {\n            this._knots[i] = new Vec3(knots[i]);\n        }\n    }\n\n    public clearKnots () {\n        this._knots.length = 0;\n    }\n\n    public getKnotCount () {\n        return this._knots.length;\n    }\n\n    public addKnot (knot: Vec3) {\n        this._knots.push(new Vec3(knot));\n    }\n\n    public insertKnot (index: number, knot: Vec3) {\n        const item = new Vec3(knot);\n        if (index >= this._knots.length) {\n            this._knots.push(item);\n            return;\n        }\n\n        this._knots.splice(index, 0, item);\n    }\n\n    public removeKnot (index: number) {\n        assertIsTrue(index >= 0 && index < this._knots.length, 'Spline: invalid index');\n\n        this._knots.splice(index, 1);\n    }\n\n    public setKnot (index: number, knot: Vec3) {\n        assertIsTrue(index >= 0 && index < this._knots.length, 'Spline: invalid index');\n\n        this._knots[index].set(knot);\n    }\n\n    public getKnot (index: number): Readonly<Vec3> {\n        assertIsTrue(index >= 0 && index < this._knots.length, 'Spline: invalid index');\n\n        return this._knots[index];\n    }\n\n    // get a point at t with repect to the `index` segment of curve or the whole curve.\n    public getPoint (t: number, index: number = SPLINE_WHOLE_INDEX) {\n        t = clamp(t, 0.0, 1.0);\n\n        const segments = this.getSegments();\n        if (segments == 0) {\n            return new Vec3(0.0, 0.0, 0.0);\n        }\n\n        if (index == SPLINE_WHOLE_INDEX) {\n            const deltaT = 1.0 / segments;\n\n            index = Math.floor(t / deltaT);\n            t     = (t % deltaT) / deltaT;\n        }\n\n        if (index >= segments) {\n            return new Vec3(this._knots[this._knots.length - 1]);\n        }\n\n        switch (this._mode) {\n        case SplineMode.LINEAR:\n            return Spline.calcLinear(this._knots[index], this._knots[index + 1], t);\n        case SplineMode.BEZIER:\n            return Spline.calcBezier(this._knots[index * 4], this._knots[index * 4 + 1], this._knots[index * 4 + 2], this._knots[index * 4 + 3], t);\n        case SplineMode.CATMULL_ROM: {\n            const v0 = index > 0 ? this._knots[index - 1] : this._knots[index];\n            const v3 = index + 2 < this._knots.length ? this._knots[index + 2] : this._knots[index + 1];\n            return Spline.calcCatmullRom(v0, this._knots[index], this._knots[index + 1], v3, t);\n        }\n        default:\n            return new Vec3(0.0, 0.0, 0.0);\n        }\n    }\n\n    // get num points from 0 to 1 uniformly with repect to the `index` segment of curve or the whole curve\n    public getPoints (num: number, index: number = SPLINE_WHOLE_INDEX): Vec3[] {\n        if (num == 0) {\n            return [];\n        }\n\n        if (num == 1) {\n            const point = this.getPoint(0.0, index);\n            return [point];\n        }\n\n        const points: Vec3[] = [];\n        const deltaT = 1.0 / (num - 1.0);\n\n        for (let i = 0; i < num; i++) {\n            const t     = i * deltaT;\n            const point = this.getPoint(t, index);\n\n            points.push(point);\n        }\n\n        return points;\n    }\n\n    private getSegments () {\n        const count = this._knots.length;\n        switch (this._mode) {\n        case SplineMode.LINEAR:\n        case SplineMode.CATMULL_ROM:\n            if (count < 2) {\n                warnID(14300);\n                return 0;\n            }\n\n            return count - 1;\n        case SplineMode.BEZIER:\n            if (count < 4 || count % 4 != 0) {\n                warnID(14301);\n                return 0;\n            }\n\n            return count / 4;\n        default:\n            assertIsTrue(false, 'Spline error: invalid mode');\n        }\n    }\n\n    private static calcLinear (v0: Vec3, v1: Vec3, t: number) {\n        const result = new Vec3();\n        Vec3.multiplyScalar(_v0, v0, (1.0 - t));\n        Vec3.multiplyScalar(_v1, v1, t);\n        Vec3.add(result, _v0, _v1);\n\n        return result;\n    }\n\n    private static calcBezier (v0: Vec3, v1: Vec3, v2: Vec3, v3: Vec3, t: number) {\n        const result = new Vec3();\n        const s = 1.0 - t;\n        Vec3.multiplyScalar(_v0, v0, s * s * s);\n        Vec3.multiplyScalar(_v1, v1, 3.0 * t * s * s);\n        Vec3.multiplyScalar(_v2, v2, 3.0 * t * t * s);\n        Vec3.multiplyScalar(_v3, v3, t * t * t);\n        Vec3.add(_v0, _v0, _v1);\n        Vec3.add(_v2, _v2, _v3);\n        Vec3.add(result, _v0, _v2);\n\n        return result;\n    }\n    private static calcCatmullRom (v0: Vec3, v1: Vec3, v2: Vec3, v3: Vec3, t: number) {\n        const result = new Vec3();\n        const t2 = t * t;\n        const t3 = t2 * t;\n        Vec3.multiplyScalar(_v0, v0, -0.5 * t3 + t2 - 0.5 * t);\n        Vec3.multiplyScalar(_v1, v1, 1.5 * t3 - 2.5 * t2 + 1.0);\n        Vec3.multiplyScalar(_v2, v2, -1.5 * t3 + 2.0 * t2 + 0.5 * t);\n        Vec3.multiplyScalar(_v3, v3, 0.5 * t3 - 0.5 * t2);\n        Vec3.add(_v0, _v0, _v1);\n        Vec3.add(_v2, _v2, _v3);\n        Vec3.add(result, _v0, _v2);\n\n        return result;\n    }\n}\n","import { replaceProperty } from '../utils/x-deprecated';\n\nimport intersect from './intersect';\nimport { Line } from './line';\nimport { Plane } from './plane';\nimport { Ray } from './ray';\nimport { Triangle } from './triangle';\nimport { Sphere } from './sphere';\nimport { AABB } from './aabb';\nimport { OBB } from './obb';\nimport { Capsule } from './capsule';\nimport { Frustum } from './frustum';\n\nreplaceProperty(intersect, 'intersect', [\n    {\n        name: 'ray_aabb',\n        newName: 'rayAABB',\n    },\n    {\n        name: 'ray_plane',\n        newName: 'rayPlane',\n    },\n    {\n        name: 'ray_triangle',\n        newName: 'rayTriangle',\n    },\n    {\n        name: 'ray_sphere',\n        newName: 'raySphere',\n    },\n    {\n        name: 'ray_obb',\n        newName: 'rayOBB',\n    },\n    {\n        name: 'ray_capsule',\n        newName: 'rayCapsule',\n    },\n    {\n        name: 'ray_subMesh',\n        newName: 'raySubMesh',\n    },\n    {\n        name: 'ray_mesh',\n        newName: 'rayMesh',\n    },\n    {\n        name: 'ray_model',\n        newName: 'rayModel',\n    },\n    {\n        name: 'line_plane',\n        newName: 'linePlane',\n    },\n    {\n        name: 'line_triangle',\n        newName: 'lineTriangle',\n    },\n    {\n        name: 'line_aabb',\n        newName: 'lineAABB',\n    },\n    {\n        name: 'line_obb',\n        newName: 'lineOBB',\n    },\n    {\n        name: 'line_sphere',\n        newName: 'lineSphere',\n    },\n    {\n        name: 'aabb_aabb',\n        newName: 'aabbWithAABB',\n    },\n    {\n        name: 'aabb_obb',\n        newName: 'aabbWithOBB',\n    },\n    {\n        name: 'aabb_plane',\n        newName: 'aabbPlane',\n    },\n    {\n        name: 'aabb_frustum',\n        newName: 'aabbFrustum',\n    },\n    {\n        name: 'aabbFrustum_accurate',\n        newName: 'aabbFrustumAccurate',\n    },\n    {\n        name: 'obb_point',\n        newName: 'obbPoint',\n    },\n    {\n        name: 'obb_plane',\n        newName: 'obbPlane',\n    },\n    {\n        name: 'obb_frustum',\n        newName: 'obbFrustum',\n    },\n    {\n        name: 'obbFrustum_accurate',\n        newName: 'obbFrustumAccurate',\n    },\n    {\n        name: 'obb_obb',\n        newName: 'obbWithOBB',\n    },\n    {\n        name: 'obb_capsule',\n        newName: 'obbCapsule',\n    },\n    {\n        name: 'sphere_plane',\n        newName: 'spherePlane',\n    },\n    {\n        name: 'sphere_frustum',\n        newName: 'sphereFrustum',\n    },\n    {\n        name: 'sphereFrustum_accurate',\n        newName: 'sphereFrustumAccurate',\n    },\n    {\n        name: 'sphere_sphere',\n        newName: 'sphereWithSphere',\n    },\n    {\n        name: 'sphere_aabb',\n        newName: 'sphereAABB',\n    },\n    {\n        name: 'sphere_obb',\n        newName: 'sphereOBB',\n    },\n    {\n        name: 'sphere_capsule',\n        newName: 'sphereCapsule',\n    },\n    {\n        name: 'capsule_capsule',\n        newName: 'capsuleWithCapsule',\n    },\n]);\n\nfunction deprecatedClassMessage (oldClassName: string, newClassName) {\n    console.warn(`${oldClassName} is deprecated, please use ${newClassName} instead.`);\n}\n\n/**\n * @en\n * Alias of [[geometry.Line]]\n * @zh\n * [[geometry.Line]] 别名类\n *\n * @deprecated Since v3.0, please use Line instead\n */\nexport class line extends Line {\n    constructor () {\n        super();\n        deprecatedClassMessage('line', 'Line');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.Plane]]\n *\n * @zh\n * [[geometry.Plane]] 别名类\n *\n * @deprecated Since v3.0, please use Plane instead\n */\nexport class plane extends Plane {\n    constructor () {\n        super();\n        deprecatedClassMessage('plane', 'Plane');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.Ray]]\n * @zh\n * [[geometry.Ray]] 别名类\n * @deprecated Since v3.0, please use Ray instead\n */\nexport class ray extends Ray {\n    constructor () {\n        super();\n        deprecatedClassMessage('ray', 'Ray');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.Triangle]]\n *\n * @zh\n * [[geometry.Triangle]] 别名类\n * @deprecated Since v3.0, please use Triangle instead\n */\nexport class triangle extends Triangle {\n    constructor () {\n        super();\n        deprecatedClassMessage('triangle', 'Triangle');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.Sphere]]\n *\n * @zh\n * [[geometry.Sphere]] 别名类\n * @deprecated Since v3.0, please use Sphere instead\n */\nexport class sphere extends Sphere {\n    constructor () {\n        super();\n        deprecatedClassMessage('sphere', 'Sphere');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.AABB]]\n *\n * @zh\n * [[geometry.AABB]] 别名类\n * @deprecated Since v3.0, please use AABB instead\n */\nexport class aabb extends AABB {\n    constructor () {\n        super();\n        deprecatedClassMessage('aabb', 'AABB');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.OBB]]\n *\n * @zh\n * [[geometry.OBB]] 别名类\n * @deprecated Since v3.0, please use OBB instead\n */\nexport class obb extends OBB {\n    constructor () {\n        super();\n        deprecatedClassMessage('obb', 'OBB');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.Capsule]]\n *\n * @zh\n * [[geometry.Capsule]] 别名类\n * @deprecated Since v3.0, please use Capsule instead\n */\nexport class capsule extends Capsule {\n    constructor () {\n        super();\n        deprecatedClassMessage('capsule', 'Capsule');\n    }\n}\n\n/**\n * @en\n * Alias of [[geometry.Frustum]]\n *\n * @zh\n * [[geometry.Frustum]] 别名类\n * @deprecated Since v3.0, please use Frustum instead\n */\nexport class frustum extends Frustum {\n    constructor () {\n        super();\n        deprecatedClassMessage('frustum', 'Frustum');\n    }\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { BitMask, Enum } from '../value-types';\nimport { legacyCC } from '../global-exports';\nimport { log2 } from '../math/bits';\nimport { js } from '../utils/js';\nimport { assertIsTrue } from '../data/utils/asserts';\nimport { getError } from '../platform/debug';\nimport { Settings, settings } from '../settings';\n\n// built-in layers, users can use 0~19 bits, 20~31 are system preserve bits.\nconst layerList = {\n    NONE: 0,\n    IGNORE_RAYCAST: (1 << 20),\n    GIZMOS: (1 << 21),\n    EDITOR: (1 << 22),\n    UI_3D: (1 << 23),\n    SCENE_GIZMO: (1 << 24),\n    UI_2D: (1 << 25),\n\n    PROFILER: (1 << 28),\n    DEFAULT: (1 << 30),\n    ALL: 0xffffffff,\n};\n\nexport interface LayerItem {\n    name: string;\n    bit: number;\n}\n\n/**\n * @zh 节点层管理器，层数据是以掩码数据方式存储在 [[Node.layer]] 中，用于射线检测、物理碰撞和用户自定义脚本逻辑。\n * 每个节点可属于一个或多个层，可通过 “包含式” 或 “排除式” 两种检测器进行层检测。\n * @en Node's layer manager, it's stored as bit mask data in [[Node.layer]].\n * Layer information is widely used in raycast, physics and user logic.\n * Every node can be assigned to multiple layers with different bit masks, you can setup layer with inclusive or exclusive operation.\n */\nexport class Layers {\n    /**\n     * @en All layers in an Enum\n     * @zh 以 Enum 形式存在的所有层列表\n     */\n    public static Enum = Enum(layerList);\n\n    /**\n     * @en All layers in [[BitMask]] type\n     * @zh 包含所有层的 [[BitMask]]\n     */\n    public static BitMask = BitMask({ ...layerList });\n\n    /**\n     * @internal\n     */\n    public static init () {\n        const userLayers = settings.querySettings<LayerItem[]>(Settings.Category.ENGINE, 'customLayers');\n        if (!userLayers) return;\n        for (let i = 0; i < userLayers.length; i++) {\n            const layer = userLayers[i];\n            Layers.addLayer(layer.name, layer.bit);\n        }\n    }\n\n    /**\n     * @en\n     * Make a layer mask accepting nothing but the listed layers\n     * @zh\n     * 创建一个包含式层检测器，只接受列表中的层\n     * @param includes All accepted layers\n     * @return A filter which can detect all accepted layers\n     */\n    public static makeMaskInclude (includes: number[]): number {\n        let mask = 0;\n        for (const inc of includes) {\n            mask |= inc;\n        }\n        return mask;\n    }\n\n    /**\n     * @en\n     * Make a layer mask accepting everything but the listed layers\n     * @zh\n     * 创建一个排除式层检测器，只拒绝列表中的层\n     * @param excludes All excluded layers\n     * @return A filter which can detect for excluded layers\n     */\n    public static makeMaskExclude (excludes: number[]): number {\n        return ~Layers.makeMaskInclude(excludes);\n    }\n\n    /**\n     * @zh 添加一个新层，用户可编辑 0 - 19 位为用户自定义层\n     * @en Add a new layer, user can use layers from bit position 0 to 19, other bits are reserved.\n     * @param name Layer's name\n     * @param bitNum Layer's bit position\n     */\n    public static addLayer (name: string, bitNum: number) {\n        if (bitNum === undefined) {\n            console.warn('bitNum can\\'t be undefined');\n            return;\n        }\n        if (bitNum > 19 || bitNum < 0) {\n            console.warn('maximum layers reached.');\n            return;\n        }\n        const val = 1 << bitNum;\n        assertIsTrue(!Layers.Enum[name], getError(2104, name));\n        Layers.Enum[name] = val;\n        js.value(Layers.Enum, String(val), name);\n        Layers.BitMask[name] = val;\n        js.value(Layers.BitMask, String(val), name);\n    }\n\n    /**\n     * @en Remove a layer, user can remove layers from bit position 0 to 19, other bits are reserved.\n     * @zh 移除一个层，用户可编辑 0 - 19 位为用户自定义层\n     * @param bitNum Layer's bit position\n     */\n    public static deleteLayer (bitNum: number) {\n        if (bitNum > 19 || bitNum < 0) {\n            console.warn('do not change buildin layers.');\n            return;\n        }\n        const val = 1 << bitNum;\n        delete Layers.Enum[Layers.Enum[val]];\n        delete Layers.Enum[val];\n        delete Layers.BitMask[Layers.BitMask[val]];\n        delete Layers.BitMask[val];\n    }\n\n    /**\n     * @en Given a layer name, returns the layer index as defined by either a Builtin or a User Layer in the Tags and Layers manager.\n     * @zh 给定层名称，返回由标记和层管理器中的内置层或用户层定义的层索引。\n     * @param name layer's name\n     */\n    public static nameToLayer (name: string): number {\n        if (name === undefined) {\n            console.warn('name can\\'t be undefined');\n            return -1;\n        }\n\n        return log2(Layers.Enum[name] as number);\n    }\n\n    /**\n     * @en Given a layer number, returns the name of the layer as defined in either a Builtin or a User Layer in the Tags and Layers manager.\n     * @zh 给定层数，返回在标记和层管理器中的内置层或用户层中定义的层名称。\n     * @param bitNum layer's value\n     */\n    public static layerToName (bitNum: number): string {\n        if (bitNum > 31 || bitNum < 0) {\n            console.warn('Unable to access unknown layer.');\n            return '';\n        }\n\n        return Layers.Enum[1 << bitNum] as string;\n    }\n}\nexport declare namespace Layers {\n    export type Enum = EnumAlias<typeof Layers.Enum>;\n    export type BitMask = EnumAlias<typeof Layers.BitMask>;\n}\n\nlegacyCC.Layers = Layers;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Pass } from '../renderer/core/pass';\nimport { Model } from '../renderer/scene/model';\nimport { SubModel } from '../renderer/scene/submodel';\nimport { Layers } from '../scene-graph/layers';\nimport { legacyCC } from '../global-exports';\nimport { BindingMappingInfo, DescriptorType, Type, ShaderStageFlagBit, UniformStorageBuffer, DescriptorSetLayoutBinding,\n    Uniform, UniformBlock, UniformSamplerTexture, UniformStorageImage, Device, FormatFeatureBit, Format, API,\n} from '../gfx';\n\nexport const PIPELINE_FLOW_MAIN = 'MainFlow';\nexport const PIPELINE_FLOW_FORWARD = 'ForwardFlow';\nexport const PIPELINE_FLOW_SHADOW = 'ShadowFlow';\nexport const PIPELINE_FLOW_SMAA = 'SMAAFlow';\nexport const PIPELINE_FLOW_TONEMAP = 'ToneMapFlow';\n\n/**\n * @en The predefined render pass stage ids\n * @zh 预设的渲染阶段。\n */\nexport enum RenderPassStage {\n    DEFAULT = 100,\n    UI = 200,\n}\nlegacyCC.RenderPassStage = RenderPassStage;\n\n/**\n * @en The predefined render priorities\n * @zh 预设的渲染优先级。\n */\nexport enum RenderPriority {\n    MIN = 0,\n    MAX = 0xff,\n    DEFAULT = 0x80,\n}\n\n/**\n * @en Render object interface\n * @zh 渲染对象接口。\n */\nexport interface IRenderObject {\n    model: Model;\n    depth: number;\n}\n\n/*\n * @en The render pass interface\n * @zh 渲染过程接口。\n */\nexport interface IRenderPass {\n    priority: number;\n    hash: number;\n    depth: number;\n    shaderId: number;\n    subModel: SubModel;\n    passIdx: number;\n}\n\n/**\n * @en Render batch interface\n * @zh 渲染批次接口。\n */\nexport interface IRenderBatch {\n    pass: Pass;\n}\n\n/**\n * @en Render queue descriptor\n * @zh 渲染队列描述。\n */\nexport interface IRenderQueueDesc {\n    isTransparent: boolean;\n    phases: number;\n    sortFunc: (a: IRenderPass, b: IRenderPass) => number;\n}\n\nexport interface IDescriptorSetLayoutInfo {\n    bindings: DescriptorSetLayoutBinding[];\n    layouts: Record<string, UniformBlock | UniformSamplerTexture | UniformStorageImage | UniformStorageBuffer>;\n}\n\nexport const globalDescriptorSetLayout: IDescriptorSetLayoutInfo = { bindings: [], layouts: {} };\nexport const localDescriptorSetLayout: IDescriptorSetLayoutInfo = { bindings: [], layouts: {} };\n\n/**\n * @en The uniform bindings\n * @zh Uniform 参数绑定。\n */\nexport enum PipelineGlobalBindings {\n    UBO_GLOBAL,\n    UBO_CAMERA,\n    UBO_SHADOW,\n    UBO_CSM, // should reserve slot for this optional ubo\n\n    SAMPLER_SHADOWMAP,\n    SAMPLER_ENVIRONMENT, // don't put this as the first sampler binding due to Mac GL driver issues: cubemap at texture unit 0 causes rendering issues\n    SAMPLER_SPOT_SHADOW_MAP,\n    SAMPLER_DIFFUSEMAP,\n\n    COUNT,\n}\nconst GLOBAL_UBO_COUNT = PipelineGlobalBindings.SAMPLER_SHADOWMAP;\nconst GLOBAL_SAMPLER_COUNT = PipelineGlobalBindings.COUNT - GLOBAL_UBO_COUNT;\n\nexport enum ModelLocalBindings {\n    UBO_LOCAL,\n    UBO_FORWARD_LIGHTS,\n    UBO_SKINNING_ANIMATION,\n    UBO_SKINNING_TEXTURE,\n    UBO_MORPH,\n    UBO_UI_LOCAL,\n\n    SAMPLER_JOINTS,\n    SAMPLER_MORPH_POSITION,\n    SAMPLER_MORPH_NORMAL,\n    SAMPLER_MORPH_TANGENT,\n    SAMPLER_LIGHTMAP,\n    SAMPLER_SPRITE,\n    SAMPLER_REFLECTION,\n\n    STORAGE_REFLECTION,\n\n    COUNT,\n}\nconst LOCAL_UBO_COUNT = ModelLocalBindings.SAMPLER_JOINTS;\nconst LOCAL_SAMPLER_COUNT = ModelLocalBindings.STORAGE_REFLECTION - LOCAL_UBO_COUNT;\nconst LOCAL_STORAGE_IMAGE_COUNT = ModelLocalBindings.COUNT - LOCAL_UBO_COUNT - LOCAL_SAMPLER_COUNT;\n\nexport enum SetIndex {\n    GLOBAL,\n    MATERIAL,\n    LOCAL,\n}\n// parameters passed to GFX Device\nexport const bindingMappingInfo = new BindingMappingInfo(\n    [GLOBAL_UBO_COUNT, 0, LOCAL_UBO_COUNT],         // Uniform Buffer Counts\n    [GLOBAL_SAMPLER_COUNT, 0, LOCAL_SAMPLER_COUNT], // Combined Sampler Texture Counts\n    [0, 0, 0],                                      // Sampler Counts\n    [0, 0, 0],                                      // Texture Counts\n    [0, 0, 0],                                      // Storage Buffer Counts\n    [0, 0, LOCAL_STORAGE_IMAGE_COUNT],              // Storage Image Counts\n    [0, 0, 0],                                      // Subpass Input Counts\n    [0, 2, 1],                                      // Set Order Indices\n);\n\n/**\n * @en The global uniform buffer object\n * @zh 全局 UBO。\n */\nexport class UBOGlobal {\n    public static readonly TIME_OFFSET = 0;\n    public static readonly SCREEN_SIZE_OFFSET = UBOGlobal.TIME_OFFSET + 4;\n    public static readonly NATIVE_SIZE_OFFSET = UBOGlobal.SCREEN_SIZE_OFFSET + 4;\n\n    public static readonly DEBUG_VIEW_MODE_OFFSET = UBOGlobal.NATIVE_SIZE_OFFSET + 4;\n    public static readonly DEBUG_VIEW_COMPOSITE_PACK_1_OFFSET = UBOGlobal.DEBUG_VIEW_MODE_OFFSET + 4;\n    public static readonly DEBUG_VIEW_COMPOSITE_PACK_2_OFFSET = UBOGlobal.DEBUG_VIEW_COMPOSITE_PACK_1_OFFSET + 4;\n    public static readonly DEBUG_VIEW_COMPOSITE_PACK_3_OFFSET = UBOGlobal.DEBUG_VIEW_COMPOSITE_PACK_2_OFFSET + 4;\n\n    public static readonly COUNT = UBOGlobal.DEBUG_VIEW_COMPOSITE_PACK_3_OFFSET + 4;\n    public static readonly SIZE = UBOGlobal.COUNT * 4;\n\n    public static readonly NAME = 'CCGlobal';\n    public static readonly BINDING = PipelineGlobalBindings.UBO_GLOBAL;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOGlobal.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.ALL);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.GLOBAL, UBOGlobal.BINDING, UBOGlobal.NAME, [\n        new Uniform('cc_time', Type.FLOAT4, 1),\n        new Uniform('cc_screenSize', Type.FLOAT4, 1),\n        new Uniform('cc_nativeSize', Type.FLOAT4, 1),\n\n        new Uniform('cc_debug_view_mode', Type.FLOAT, 4),\n        new Uniform('cc_debug_view_composite_pack_1', Type.FLOAT, 4),\n        new Uniform('cc_debug_view_composite_pack_2', Type.FLOAT, 4),\n        new Uniform('cc_debug_view_composite_pack_3', Type.FLOAT, 4),\n    ], 1);\n}\nglobalDescriptorSetLayout.layouts[UBOGlobal.NAME] = UBOGlobal.LAYOUT;\nglobalDescriptorSetLayout.bindings[UBOGlobal.BINDING] = UBOGlobal.DESCRIPTOR;\n\n/**\n * @en The global camera uniform buffer object\n * @zh 全局相机 UBO。\n */\nexport class UBOCamera {\n    public static readonly MAT_VIEW_OFFSET = 0;\n    public static readonly MAT_VIEW_INV_OFFSET = UBOCamera.MAT_VIEW_OFFSET + 16;\n    public static readonly MAT_PROJ_OFFSET = UBOCamera.MAT_VIEW_INV_OFFSET + 16;\n    public static readonly MAT_PROJ_INV_OFFSET = UBOCamera.MAT_PROJ_OFFSET + 16;\n    public static readonly MAT_VIEW_PROJ_OFFSET = UBOCamera.MAT_PROJ_INV_OFFSET + 16;\n    public static readonly MAT_VIEW_PROJ_INV_OFFSET = UBOCamera.MAT_VIEW_PROJ_OFFSET + 16;\n    public static readonly CAMERA_POS_OFFSET = UBOCamera.MAT_VIEW_PROJ_INV_OFFSET + 16;\n    public static readonly SURFACE_TRANSFORM_OFFSET = UBOCamera.CAMERA_POS_OFFSET + 4;\n    public static readonly SCREEN_SCALE_OFFSET = UBOCamera.SURFACE_TRANSFORM_OFFSET + 4;\n    public static readonly EXPOSURE_OFFSET = UBOCamera.SCREEN_SCALE_OFFSET + 4;\n    public static readonly MAIN_LIT_DIR_OFFSET = UBOCamera.EXPOSURE_OFFSET + 4;\n    public static readonly MAIN_LIT_COLOR_OFFSET = UBOCamera.MAIN_LIT_DIR_OFFSET + 4;\n    public static readonly AMBIENT_SKY_OFFSET = UBOCamera.MAIN_LIT_COLOR_OFFSET + 4;\n    public static readonly AMBIENT_GROUND_OFFSET = UBOCamera.AMBIENT_SKY_OFFSET + 4;\n    public static readonly GLOBAL_FOG_COLOR_OFFSET = UBOCamera.AMBIENT_GROUND_OFFSET + 4;\n    public static readonly GLOBAL_FOG_BASE_OFFSET = UBOCamera.GLOBAL_FOG_COLOR_OFFSET + 4;\n    public static readonly GLOBAL_FOG_ADD_OFFSET = UBOCamera.GLOBAL_FOG_BASE_OFFSET + 4;\n    public static readonly NEAR_FAR_OFFSET = UBOCamera.GLOBAL_FOG_ADD_OFFSET + 4;\n    public static readonly VIEW_PORT_OFFSET = UBOCamera.NEAR_FAR_OFFSET + 4;\n    public static readonly COUNT = UBOCamera.VIEW_PORT_OFFSET + 4;\n    public static readonly SIZE = UBOCamera.COUNT * 4;\n\n    public static readonly NAME = 'CCCamera';\n    public static readonly BINDING = PipelineGlobalBindings.UBO_CAMERA;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOCamera.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.ALL);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.GLOBAL, UBOCamera.BINDING, UBOCamera.NAME, [\n        new Uniform('cc_matView', Type.MAT4, 1),\n        new Uniform('cc_matViewInv', Type.MAT4, 1),\n        new Uniform('cc_matProj', Type.MAT4, 1),\n        new Uniform('cc_matProjInv', Type.MAT4, 1),\n        new Uniform('cc_matViewProj', Type.MAT4, 1),\n        new Uniform('cc_matViewProjInv', Type.MAT4, 1),\n        new Uniform('cc_cameraPos', Type.FLOAT4, 1),\n        new Uniform('cc_surfaceTransform', Type.FLOAT4, 1),\n        new Uniform('cc_screenScale', Type.FLOAT4, 1),\n        new Uniform('cc_exposure', Type.FLOAT4, 1),\n        new Uniform('cc_mainLitDir', Type.FLOAT4, 1),\n        new Uniform('cc_mainLitColor', Type.FLOAT4, 1),\n        new Uniform('cc_ambientSky', Type.FLOAT4, 1),\n        new Uniform('cc_ambientGround', Type.FLOAT4, 1),\n        new Uniform('cc_fogColor', Type.FLOAT4, 1),\n        new Uniform('cc_fogBase', Type.FLOAT4, 1),\n        new Uniform('cc_fogAdd', Type.FLOAT4, 1),\n        new Uniform('cc_nearFar', Type.FLOAT4, 1),\n        new Uniform('cc_viewPort', Type.FLOAT4, 1),\n    ], 1);\n}\nglobalDescriptorSetLayout.layouts[UBOCamera.NAME] = UBOCamera.LAYOUT;\nglobalDescriptorSetLayout.bindings[UBOCamera.BINDING] = UBOCamera.DESCRIPTOR;\n\n/**\n * @en The uniform buffer object for 'cast shadow(fixed || csm)' && 'dir fixed area shadow' && 'spot shadow' && 'sphere shadow' && 'planar shadow'\n * @zh 这个 UBO 仅仅只给 'cast shadow(fixed || csm)' && 'dir fixed area shadow' && 'spot shadow' && 'sphere shadow' && 'planar shadow' 使用\n */\nexport class UBOShadow {\n    public static readonly MAT_LIGHT_VIEW_OFFSET = 0;\n    public static readonly MAT_LIGHT_VIEW_PROJ_OFFSET = UBOShadow.MAT_LIGHT_VIEW_OFFSET + 16;\n    public static readonly SHADOW_INV_PROJ_DEPTH_INFO_OFFSET = UBOShadow.MAT_LIGHT_VIEW_PROJ_OFFSET + 16;\n    public static readonly SHADOW_PROJ_DEPTH_INFO_OFFSET = UBOShadow.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET + 4;\n    public static readonly SHADOW_PROJ_INFO_OFFSET = UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 4;\n    public static readonly SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET = UBOShadow.SHADOW_PROJ_INFO_OFFSET + 4;\n    public static readonly SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET = UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET + 4;\n    public static readonly SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET = UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 4;\n    public static readonly SHADOW_COLOR_OFFSET = UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 4;\n    public static readonly PLANAR_NORMAL_DISTANCE_INFO_OFFSET = UBOShadow.SHADOW_COLOR_OFFSET + 4;\n    public static readonly COUNT: number = UBOShadow.PLANAR_NORMAL_DISTANCE_INFO_OFFSET + 4;\n    public static readonly SIZE = UBOShadow.COUNT * 4;\n    public static readonly NAME = 'CCShadow';\n    public static readonly BINDING = PipelineGlobalBindings.UBO_SHADOW;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOShadow.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.ALL);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.GLOBAL, UBOShadow.BINDING, UBOShadow.NAME, [\n        new Uniform('cc_matLightView', Type.MAT4, 1),\n        new Uniform('cc_matLightViewProj', Type.MAT4, 1),\n        new Uniform('cc_shadowInvProjDepthInfo', Type.FLOAT4, 1),\n        new Uniform('cc_shadowProjDepthInfo', Type.FLOAT4, 1),\n        new Uniform('cc_shadowProjInfo', Type.FLOAT4, 1),\n        new Uniform('cc_shadowNFLSInfo', Type.FLOAT4, 1),\n        new Uniform('cc_shadowWHPBInfo', Type.FLOAT4, 1),\n        new Uniform('cc_shadowLPNNInfo', Type.FLOAT4, 1),\n        new Uniform('cc_shadowColor', Type.FLOAT4, 1),\n        new Uniform('cc_planarNDInfo', Type.FLOAT4, 1),\n    ], 1);\n}\nglobalDescriptorSetLayout.layouts[UBOShadow.NAME] = UBOShadow.LAYOUT;\nglobalDescriptorSetLayout.bindings[UBOShadow.BINDING] = UBOShadow.DESCRIPTOR;\n\n/**\n * @en The uniform buffer object only for dir csm shadow(level: 1 ~ 4)\n * @zh 级联阴影使用的UBO\n */\nexport class UBOCSM {\n    public static readonly CSM_LEVEL_COUNT = 4;\n    public static readonly CSM_VIEW_DIR_0_OFFSET = 0;\n    public static readonly CSM_VIEW_DIR_1_OFFSET = UBOCSM.CSM_VIEW_DIR_0_OFFSET + 4 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly CSM_VIEW_DIR_2_OFFSET = UBOCSM.CSM_VIEW_DIR_1_OFFSET + 4 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly CSM_ATLAS_OFFSET = UBOCSM.CSM_VIEW_DIR_2_OFFSET + 4 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly MAT_CSM_VIEW_PROJ_OFFSET = UBOCSM.CSM_ATLAS_OFFSET + 4 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly CSM_PROJ_DEPTH_INFO_OFFSET = UBOCSM.MAT_CSM_VIEW_PROJ_OFFSET + 16 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly CSM_PROJ_INFO_OFFSET = UBOCSM.CSM_PROJ_DEPTH_INFO_OFFSET + 4 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly CSM_SPLITS_INFO_OFFSET = UBOCSM.CSM_PROJ_INFO_OFFSET + 4 * UBOCSM.CSM_LEVEL_COUNT;\n    public static readonly COUNT: number = UBOCSM.CSM_SPLITS_INFO_OFFSET + 4;\n    public static readonly SIZE = UBOCSM.COUNT * 4;\n\n    public static readonly NAME = 'CCCSM';\n    public static readonly BINDING = PipelineGlobalBindings.UBO_CSM;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOCSM.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.ALL);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.GLOBAL, UBOCSM.BINDING, UBOCSM.NAME, [\n        new Uniform('cc_csmViewDir0', Type.FLOAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_csmViewDir1', Type.FLOAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_csmViewDir2', Type.FLOAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_csmAtlas', Type.FLOAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_matCSMViewProj', Type.MAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_csmProjDepthInfo', Type.FLOAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_csmProjInfo', Type.FLOAT4, UBOCSM.CSM_LEVEL_COUNT),\n        new Uniform('cc_csmSplitsInfo', Type.FLOAT4, 1),\n    ], 1);\n}\nglobalDescriptorSetLayout.layouts[UBOCSM.NAME] = UBOCSM.LAYOUT;\nglobalDescriptorSetLayout.bindings[UBOCSM.BINDING] = UBOCSM.DESCRIPTOR;\n\n/* eslint-disable max-len */\n\n/**\n * @en The sampler for Main light shadow map\n * @zh 主光源阴影纹理采样器\n */\nconst UNIFORM_SHADOWMAP_NAME = 'cc_shadowMap';\nexport const UNIFORM_SHADOWMAP_BINDING = PipelineGlobalBindings.SAMPLER_SHADOWMAP;\nconst UNIFORM_SHADOWMAP_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_SHADOWMAP_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_SHADOWMAP_LAYOUT = new UniformSamplerTexture(SetIndex.GLOBAL, UNIFORM_SHADOWMAP_BINDING, UNIFORM_SHADOWMAP_NAME, Type.SAMPLER2D, 1);\nglobalDescriptorSetLayout.layouts[UNIFORM_SHADOWMAP_NAME] = UNIFORM_SHADOWMAP_LAYOUT;\nglobalDescriptorSetLayout.bindings[UNIFORM_SHADOWMAP_BINDING] = UNIFORM_SHADOWMAP_DESCRIPTOR;\n\nconst UNIFORM_ENVIRONMENT_NAME = 'cc_environment';\nexport const UNIFORM_ENVIRONMENT_BINDING = PipelineGlobalBindings.SAMPLER_ENVIRONMENT;\nconst UNIFORM_ENVIRONMENT_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_ENVIRONMENT_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_ENVIRONMENT_LAYOUT = new UniformSamplerTexture(SetIndex.GLOBAL, UNIFORM_ENVIRONMENT_BINDING, UNIFORM_ENVIRONMENT_NAME, Type.SAMPLER_CUBE, 1);\nglobalDescriptorSetLayout.layouts[UNIFORM_ENVIRONMENT_NAME] = UNIFORM_ENVIRONMENT_LAYOUT;\nglobalDescriptorSetLayout.bindings[UNIFORM_ENVIRONMENT_BINDING] = UNIFORM_ENVIRONMENT_DESCRIPTOR;\n\nconst UNIFORM_DIFFUSEMAP_NAME = 'cc_diffuseMap';\nexport const UNIFORM_DIFFUSEMAP_BINDING = PipelineGlobalBindings.SAMPLER_DIFFUSEMAP;\nconst UNIFORM_DIFFUSEMAP_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_DIFFUSEMAP_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_DIFFUSEMAP_LAYOUT = new UniformSamplerTexture(SetIndex.GLOBAL, UNIFORM_DIFFUSEMAP_BINDING, UNIFORM_DIFFUSEMAP_NAME, Type.SAMPLER_CUBE, 1);\nglobalDescriptorSetLayout.layouts[UNIFORM_DIFFUSEMAP_NAME] = UNIFORM_DIFFUSEMAP_LAYOUT;\nglobalDescriptorSetLayout.bindings[UNIFORM_DIFFUSEMAP_BINDING] = UNIFORM_DIFFUSEMAP_DESCRIPTOR;\n\n/**\n * @en The sampler for spot light shadow map\n * @zh 聚光灯阴影纹理采样器\n */\nconst UNIFORM_SPOT_SHADOW_MAP_TEXTURE_NAME = 'cc_spotShadowMap';\nexport const UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING = PipelineGlobalBindings.SAMPLER_SPOT_SHADOW_MAP;\nconst UNIFORM_SPOT_SHADOW_MAP_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_SPOT_SHADOW_MAP_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.GLOBAL, UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, UNIFORM_SPOT_SHADOW_MAP_TEXTURE_NAME, Type.SAMPLER2D, 1);\nglobalDescriptorSetLayout.layouts[UNIFORM_SPOT_SHADOW_MAP_TEXTURE_NAME] = UNIFORM_SPOT_SHADOW_MAP_TEXTURE_LAYOUT;\nglobalDescriptorSetLayout.bindings[UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING] = UNIFORM_SPOT_SHADOW_MAP_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The local uniform buffer object\n * @zh 本地 UBO。\n */\nexport class UBOLocal {\n    public static readonly MAT_WORLD_OFFSET = 0;\n    public static readonly MAT_WORLD_IT_OFFSET = UBOLocal.MAT_WORLD_OFFSET + 16;\n    public static readonly LIGHTINGMAP_UVPARAM = UBOLocal.MAT_WORLD_IT_OFFSET + 16;\n    public static readonly LOCAL_SHADOW_BIAS = UBOLocal.LIGHTINGMAP_UVPARAM + 4;\n    public static readonly COUNT = UBOLocal.LOCAL_SHADOW_BIAS + 4;\n    public static readonly SIZE = UBOLocal.COUNT * 4;\n\n    public static readonly NAME = 'CCLocal';\n    public static readonly BINDING = ModelLocalBindings.UBO_LOCAL;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOLocal.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX | ShaderStageFlagBit.COMPUTE);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOLocal.BINDING, UBOLocal.NAME, [\n        new Uniform('cc_matWorld', Type.MAT4, 1),\n        new Uniform('cc_matWorldIT', Type.MAT4, 1),\n        new Uniform('cc_lightingMapUVParam', Type.FLOAT4, 1),\n        new Uniform('cc_localShadowBias', Type.FLOAT4, 1),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOLocal.NAME] = UBOLocal.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOLocal.BINDING] = UBOLocal.DESCRIPTOR;\n\n/**\n * @en The world bound uniform buffer object\n * @zh 世界空间包围盒 UBO。\n */\nexport class UBOWorldBound {\n    public static readonly WORLD_BOUND_CENTER = 0;\n    public static readonly WORLD_BOUND_HALF_EXTENTS = UBOWorldBound.WORLD_BOUND_CENTER + 4;\n    public static readonly COUNT = UBOWorldBound.WORLD_BOUND_HALF_EXTENTS + 4;\n    public static readonly SIZE = UBOWorldBound.COUNT * 4;\n\n    public static readonly NAME = 'CCWorldBound';\n    public static readonly BINDING = ModelLocalBindings.UBO_LOCAL;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOWorldBound.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX | ShaderStageFlagBit.COMPUTE);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOWorldBound.BINDING, UBOWorldBound.NAME, [\n        new Uniform('cc_worldBoundCenter', Type.FLOAT4, 1),\n        new Uniform('cc_worldBoundHalfExtents', Type.FLOAT4, 1),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOWorldBound.NAME] = UBOWorldBound.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOWorldBound.BINDING] = UBOWorldBound.DESCRIPTOR;\n\nexport const INST_MAT_WORLD = 'a_matWorld0';\n\nexport class UBOLocalBatched {\n    public static readonly BATCHING_COUNT = 10;\n    public static readonly MAT_WORLDS_OFFSET = 0;\n    public static readonly COUNT = 16 * UBOLocalBatched.BATCHING_COUNT;\n    public static readonly SIZE = UBOLocalBatched.COUNT * 4;\n\n    public static readonly NAME = 'CCLocalBatched';\n    public static readonly BINDING = ModelLocalBindings.UBO_LOCAL;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOLocalBatched.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX | ShaderStageFlagBit.COMPUTE);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOLocalBatched.BINDING, UBOLocalBatched.NAME, [\n        new Uniform('cc_matWorlds', Type.MAT4, UBOLocalBatched.BATCHING_COUNT),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOLocalBatched.NAME] = UBOLocalBatched.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOLocalBatched.BINDING] = UBOLocalBatched.DESCRIPTOR;\n\n/**\n * @en The uniform buffer object for forward lighting\n * @zh 前向灯光 UBO。\n */\nexport class UBOForwardLight {\n    public static readonly LIGHTS_PER_PASS = 1;\n\n    public static readonly LIGHT_POS_OFFSET = 0;\n    public static readonly LIGHT_COLOR_OFFSET = UBOForwardLight.LIGHT_POS_OFFSET + UBOForwardLight.LIGHTS_PER_PASS * 4;\n    public static readonly LIGHT_SIZE_RANGE_ANGLE_OFFSET = UBOForwardLight.LIGHT_COLOR_OFFSET + UBOForwardLight.LIGHTS_PER_PASS * 4;\n    public static readonly LIGHT_DIR_OFFSET = UBOForwardLight.LIGHT_SIZE_RANGE_ANGLE_OFFSET + UBOForwardLight.LIGHTS_PER_PASS * 4;\n    public static readonly COUNT = UBOForwardLight.LIGHT_DIR_OFFSET + UBOForwardLight.LIGHTS_PER_PASS * 4;\n    public static readonly SIZE = UBOForwardLight.COUNT * 4;\n\n    public static readonly NAME = 'CCForwardLight';\n    public static readonly BINDING = ModelLocalBindings.UBO_FORWARD_LIGHTS;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOForwardLight.BINDING, DescriptorType.DYNAMIC_UNIFORM_BUFFER, 1, ShaderStageFlagBit.FRAGMENT);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOForwardLight.BINDING, UBOForwardLight.NAME, [\n        new Uniform('cc_lightPos', Type.FLOAT4, UBOForwardLight.LIGHTS_PER_PASS),\n        new Uniform('cc_lightColor', Type.FLOAT4, UBOForwardLight.LIGHTS_PER_PASS),\n        new Uniform('cc_lightSizeRangeAngle', Type.FLOAT4, UBOForwardLight.LIGHTS_PER_PASS),\n        new Uniform('cc_lightDir', Type.FLOAT4, UBOForwardLight.LIGHTS_PER_PASS),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOForwardLight.NAME] = UBOForwardLight.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOForwardLight.BINDING] = UBOForwardLight.DESCRIPTOR;\n\nexport class UBODeferredLight {\n    public static readonly LIGHTS_PER_PASS = 10;\n}\n\nexport const JOINT_UNIFORM_CAPACITY = 30;\n\n/**\n * @en The uniform buffer object for skinning texture\n * @zh 骨骼贴图 UBO。\n */\nexport class UBOSkinningTexture {\n    public static readonly JOINTS_TEXTURE_INFO_OFFSET = 0;\n    public static readonly COUNT = UBOSkinningTexture.JOINTS_TEXTURE_INFO_OFFSET + 4;\n    public static readonly SIZE = UBOSkinningTexture.COUNT * 4;\n\n    public static readonly NAME = 'CCSkinningTexture';\n    public static readonly BINDING = ModelLocalBindings.UBO_SKINNING_TEXTURE;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOSkinningTexture.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOSkinningTexture.BINDING, UBOSkinningTexture.NAME, [\n        new Uniform('cc_jointTextureInfo', Type.FLOAT4, 1),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOSkinningTexture.NAME] = UBOSkinningTexture.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOSkinningTexture.BINDING] = UBOSkinningTexture.DESCRIPTOR;\n\nexport class UBOSkinningAnimation {\n    public static readonly JOINTS_ANIM_INFO_OFFSET = 0;\n    public static readonly COUNT = UBOSkinningAnimation.JOINTS_ANIM_INFO_OFFSET + 4;\n    public static readonly SIZE = UBOSkinningAnimation.COUNT * 4;\n\n    public static readonly NAME = 'CCSkinningAnimation';\n    public static readonly BINDING = ModelLocalBindings.UBO_SKINNING_ANIMATION;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOSkinningAnimation.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOSkinningAnimation.BINDING, UBOSkinningAnimation.NAME, [\n        new Uniform('cc_jointAnimInfo', Type.FLOAT4, 1),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOSkinningAnimation.NAME] = UBOSkinningAnimation.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOSkinningAnimation.BINDING] = UBOSkinningAnimation.DESCRIPTOR;\n\nexport const INST_JOINT_ANIM_INFO = 'a_jointAnimInfo';\nexport class UBOSkinning {\n    private static _jointUniformCapacity = 0;\n    public static get JOINT_UNIFORM_CAPACITY () { return UBOSkinning._jointUniformCapacity; }\n    private static _count = 0;\n    public static get COUNT () { return UBOSkinning._count; }\n    private static _size = 0;\n    public static get SIZE () { return UBOSkinning._size; }\n\n    public static readonly NAME = 'CCSkinning';\n    public static readonly BINDING = ModelLocalBindings.UBO_SKINNING_TEXTURE;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOSkinning.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOSkinning.BINDING, UBOSkinning.NAME, [\n        new Uniform('cc_joints', Type.FLOAT4, 1),\n    ], 1);\n\n    /**\n     * @internal This method only used init UBOSkinning configure.\n    */\n    public static initLayout (capacity: number) {\n        UBOSkinning._jointUniformCapacity = capacity;\n        UBOSkinning._count = capacity * 12;\n        UBOSkinning._size = UBOSkinning._count * 4;\n        UBOSkinning.LAYOUT.members[0].count = capacity * 3;\n    }\n}\n\n/**\n * @internal This method only used to init localDescriptorSetLayout.layouts[UBOSkinning.NAME]\n*/\nexport function localDescriptorSetLayout_ResizeMaxJoints (maxCount: number) {\n    UBOSkinning.initLayout(maxCount);\n    localDescriptorSetLayout.layouts[UBOSkinning.NAME] = UBOSkinning.LAYOUT;\n    localDescriptorSetLayout.bindings[UBOSkinning.BINDING] = UBOSkinning.DESCRIPTOR;\n}\n\n/**\n * @en The uniform buffer object for morph setting\n * @zh 形变配置的 UBO\n */\nexport class UBOMorph {\n    public static readonly MAX_MORPH_TARGET_COUNT = 60;\n    public static readonly OFFSET_OF_WEIGHTS = 0;\n    public static readonly OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH = 4 * UBOMorph.MAX_MORPH_TARGET_COUNT;\n    public static readonly OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT = UBOMorph.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH + 4;\n    public static readonly OFFSET_OF_VERTICES_COUNT = UBOMorph.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT + 4;\n    public static readonly COUNT_BASE_4_BYTES = 4 * Math.ceil(UBOMorph.MAX_MORPH_TARGET_COUNT / 4) + 4;\n    public static readonly SIZE = UBOMorph.COUNT_BASE_4_BYTES * 4;\n\n    public static readonly NAME = 'CCMorph';\n    public static readonly BINDING = ModelLocalBindings.UBO_MORPH;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOMorph.BINDING, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOMorph.BINDING, UBOMorph.NAME, [\n        new Uniform('cc_displacementWeights', Type.FLOAT4, UBOMorph.MAX_MORPH_TARGET_COUNT / 4),\n        new Uniform('cc_displacementTextureInfo', Type.FLOAT4, 1),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOMorph.NAME] = UBOMorph.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOMorph.BINDING] = UBOMorph.DESCRIPTOR;\n\n// UI local uniform UBO\nexport class UBOUILocal { // pre one vec4\n    public static readonly NAME = 'CCUILocal';\n    public static readonly BINDING = ModelLocalBindings.UBO_UI_LOCAL;\n    public static readonly DESCRIPTOR = new DescriptorSetLayoutBinding(UBOUILocal.BINDING, DescriptorType.DYNAMIC_UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX);\n    public static readonly LAYOUT = new UniformBlock(SetIndex.LOCAL, UBOUILocal.BINDING, UBOUILocal.NAME, [\n        new Uniform('cc_local_data', Type.FLOAT4, 1),\n    ], 1);\n}\nlocalDescriptorSetLayout.layouts[UBOUILocal.NAME] = UBOUILocal.LAYOUT;\nlocalDescriptorSetLayout.bindings[UBOUILocal.BINDING] = UBOUILocal.DESCRIPTOR;\n\n/**\n * @en The sampler for joint texture\n * @zh 骨骼纹理采样器。\n */\nconst UNIFORM_JOINT_TEXTURE_NAME = 'cc_jointTexture';\nexport const UNIFORM_JOINT_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_JOINTS;\nconst UNIFORM_JOINT_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_JOINT_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.VERTEX);\nconst UNIFORM_JOINT_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_JOINT_TEXTURE_BINDING, UNIFORM_JOINT_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_JOINT_TEXTURE_NAME] = UNIFORM_JOINT_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_JOINT_TEXTURE_BINDING] = UNIFORM_JOINT_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for real-time joint texture\n * @zh 实时骨骼纹理采样器。\n */\nconst UNIFORM_REALTIME_JOINT_TEXTURE_NAME = 'cc_realtimeJoint';\nexport const UNIFORM_REALTIME_JOINT_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_JOINTS;\nconst UNIFORM_REALTIME_JOINT_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_REALTIME_JOINT_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.VERTEX);\nconst UNIFORM_REALTIME_JOINT_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_REALTIME_JOINT_TEXTURE_BINDING, UNIFORM_REALTIME_JOINT_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_REALTIME_JOINT_TEXTURE_NAME] = UNIFORM_REALTIME_JOINT_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_REALTIME_JOINT_TEXTURE_BINDING] = UNIFORM_REALTIME_JOINT_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for morph texture of position\n * @zh 位置形变纹理采样器。\n */\nconst UNIFORM_POSITION_MORPH_TEXTURE_NAME = 'cc_PositionDisplacements';\nexport const UNIFORM_POSITION_MORPH_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_MORPH_POSITION;\nconst UNIFORM_POSITION_MORPH_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_POSITION_MORPH_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.VERTEX);\nconst UNIFORM_POSITION_MORPH_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_POSITION_MORPH_TEXTURE_BINDING, UNIFORM_POSITION_MORPH_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_POSITION_MORPH_TEXTURE_NAME] = UNIFORM_POSITION_MORPH_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_POSITION_MORPH_TEXTURE_BINDING] = UNIFORM_POSITION_MORPH_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for morph texture of normal\n * @zh 法线形变纹理采样器。\n */\nconst UNIFORM_NORMAL_MORPH_TEXTURE_NAME = 'cc_NormalDisplacements';\nexport const UNIFORM_NORMAL_MORPH_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_MORPH_NORMAL;\nconst UNIFORM_NORMAL_MORPH_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_NORMAL_MORPH_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.VERTEX);\nconst UNIFORM_NORMAL_MORPH_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_NORMAL_MORPH_TEXTURE_BINDING,\n    UNIFORM_NORMAL_MORPH_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_NORMAL_MORPH_TEXTURE_NAME] = UNIFORM_NORMAL_MORPH_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_NORMAL_MORPH_TEXTURE_BINDING] = UNIFORM_NORMAL_MORPH_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for morph texture of tangent\n * @zh 切线形变纹理采样器。\n */\nconst UNIFORM_TANGENT_MORPH_TEXTURE_NAME = 'cc_TangentDisplacements';\nexport const UNIFORM_TANGENT_MORPH_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_MORPH_TANGENT;\nconst UNIFORM_TANGENT_MORPH_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_TANGENT_MORPH_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.VERTEX);\nconst UNIFORM_TANGENT_MORPH_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_TANGENT_MORPH_TEXTURE_BINDING,\n    UNIFORM_TANGENT_MORPH_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_TANGENT_MORPH_TEXTURE_NAME] = UNIFORM_TANGENT_MORPH_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_TANGENT_MORPH_TEXTURE_BINDING] = UNIFORM_TANGENT_MORPH_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for light map texture\n * @zh 光照图纹理采样器。\n */\nconst UNIFORM_LIGHTMAP_TEXTURE_NAME = 'cc_lightingMap';\nexport const UNIFORM_LIGHTMAP_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_LIGHTMAP;\nconst UNIFORM_LIGHTMAP_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_LIGHTMAP_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_LIGHTMAP_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_LIGHTMAP_TEXTURE_BINDING,\n    UNIFORM_LIGHTMAP_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_LIGHTMAP_TEXTURE_NAME] = UNIFORM_LIGHTMAP_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_LIGHTMAP_TEXTURE_BINDING] = UNIFORM_LIGHTMAP_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for UI sprites.\n * @zh UI 精灵纹理采样器。\n */\nconst UNIFORM_SPRITE_TEXTURE_NAME = 'cc_spriteTexture';\nexport const UNIFORM_SPRITE_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_SPRITE;\nconst UNIFORM_SPRITE_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_SPRITE_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_SPRITE_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_SPRITE_TEXTURE_BINDING, UNIFORM_SPRITE_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_SPRITE_TEXTURE_NAME] = UNIFORM_SPRITE_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_SPRITE_TEXTURE_BINDING] = UNIFORM_SPRITE_TEXTURE_DESCRIPTOR;\n\n/**\n * @en The sampler for reflection\n * @zh 反射纹理采样器。\n */\nconst UNIFORM_REFLECTION_TEXTURE_NAME = 'cc_reflectionTexture';\nexport const UNIFORM_REFLECTION_TEXTURE_BINDING = ModelLocalBindings.SAMPLER_REFLECTION;\nconst UNIFORM_REFLECTION_TEXTURE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_REFLECTION_TEXTURE_BINDING, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT);\nconst UNIFORM_REFLECTION_TEXTURE_LAYOUT = new UniformSamplerTexture(SetIndex.LOCAL, UNIFORM_REFLECTION_TEXTURE_BINDING, UNIFORM_REFLECTION_TEXTURE_NAME, Type.SAMPLER2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_REFLECTION_TEXTURE_NAME] = UNIFORM_REFLECTION_TEXTURE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_REFLECTION_TEXTURE_BINDING] = UNIFORM_REFLECTION_TEXTURE_DESCRIPTOR;\n\n/**\n  * @en The storage image for reflection\n  * @zh 反射纹理存储。\n  */\nconst UNIFORM_REFLECTION_STORAGE_NAME = 'cc_reflectionStorage';\nexport const UNIFORM_REFLECTION_STORAGE_BINDING = ModelLocalBindings.STORAGE_REFLECTION;\nconst UNIFORM_REFLECTION_STORAGE_DESCRIPTOR = new DescriptorSetLayoutBinding(UNIFORM_REFLECTION_STORAGE_BINDING, DescriptorType.STORAGE_IMAGE, 1, ShaderStageFlagBit.COMPUTE);\nconst UNIFORM_REFLECTION_STORAGE_LAYOUT = new UniformStorageImage(SetIndex.LOCAL, UNIFORM_REFLECTION_STORAGE_BINDING, UNIFORM_REFLECTION_STORAGE_NAME, Type.IMAGE2D, 1);\nlocalDescriptorSetLayout.layouts[UNIFORM_REFLECTION_STORAGE_NAME] = UNIFORM_REFLECTION_STORAGE_LAYOUT;\nlocalDescriptorSetLayout.bindings[UNIFORM_REFLECTION_STORAGE_BINDING] = UNIFORM_REFLECTION_STORAGE_DESCRIPTOR;\n\nexport const CAMERA_DEFAULT_MASK = Layers.makeMaskExclude([Layers.BitMask.UI_2D, Layers.BitMask.GIZMOS, Layers.BitMask.EDITOR,\n    Layers.BitMask.SCENE_GIZMO, Layers.BitMask.PROFILER]);\n\nexport const CAMERA_EDITOR_MASK = Layers.makeMaskExclude([Layers.BitMask.UI_2D, Layers.BitMask.PROFILER]);\n\nexport const MODEL_ALWAYS_MASK = Layers.Enum.ALL;\n\n/**\n * @en Does the device support single-channeled half float texture? (for both color attachment and sampling)\n * @zh 当前设备是否支持单通道半浮点贴图？（颜色输出和采样）\n */\nexport function supportsR16HalfFloatTexture (device: Device) {\n    return (device.getFormatFeatures(Format.R16F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE))\n        === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);\n}\n\n/**\n * @en Does the device support single-channeled float texture? (for both color attachment and sampling)\n * @zh 当前设备是否支持单通道浮点贴图？（颜色输出和采样）\n */\nexport function supportsR32FloatTexture (device: Device) {\n    return (device.getFormatFeatures(Format.R32F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE))\n        === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)\n        && !(device.gfxAPI === API.WEBGL); // wegl 1  Single-channel float type is not supported under webgl1, so it is excluded\n}\n\n/* eslint-enable max-len */\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Type } from '../../gfx';\nimport { Color, Mat3, Mat4, Vec2, Vec3, Vec4, Quat, IVec2Like, IVec3Like, IVec4Like, IMat3Like, IMat4Like } from '../../math';\n\nconst typeMask    = 0xfc000000; //  6 bits => 64 types\nconst bindingMask = 0x03f00000; //  6 bits => 64 bindings\nconst countMask   = 0x000ff000; //  8 bits => 256 vectors\nconst offsetMask  = 0x00000fff; // 12 bits => 1024 vectors\n\nexport const genHandle = (binding: number, type: Type, count: number, offset = 0): number => ((type << 26) & typeMask)\n    | ((binding << 20) & bindingMask) | (count << 12) & countMask | (offset & offsetMask);\nexport const getTypeFromHandle = (handle: number): number => (handle & typeMask) >>> 26;\nexport const getBindingFromHandle = (handle: number): number => (handle & bindingMask) >>> 20;\nexport const getCountFromHandle = (handle: number): number => (handle & countMask) >>> 12;\nexport const getOffsetFromHandle = (handle: number): number => (handle & offsetMask);\nexport const customizeType = (handle: number, type: Type): number => (handle & ~typeMask) | ((type << 26) & typeMask);\n\n/**\n * @en Vector type uniforms\n * @zh 向量类型 uniform\n */\nexport type MaterialProperty = number | Vec2 | Vec3 | Vec4 | Color | Mat3 | Mat4 | Quat;\n\nexport const type2reader = {\n    [Type.UNKNOWN]: (a: Float32Array, v: number, idx = 0): void => console.warn('illegal uniform handle'),\n    [Type.INT]: (a: Int32Array, v: number, idx = 0): number => a[idx],\n    [Type.INT2]: (a: Int32Array, v: IVec2Like, idx = 0): IVec2Like => Vec2.fromArray(v, a, idx),\n    [Type.INT3]: (a: Int32Array, v: IVec3Like, idx = 0): IVec3Like => Vec3.fromArray(v, a, idx),\n    [Type.INT4]: (a: Int32Array, v: IVec4Like, idx = 0): IVec4Like => Vec4.fromArray(v, a, idx),\n    [Type.FLOAT]: (a: Float32Array, v: number, idx = 0): number => a[idx],\n    [Type.FLOAT2]: (a: Float32Array, v: IVec2Like, idx = 0): IVec2Like => Vec2.fromArray(v, a, idx),\n    [Type.FLOAT3]: (a: Float32Array, v: IVec3Like, idx = 0): IVec3Like => Vec3.fromArray(v, a, idx),\n    [Type.FLOAT4]: (a: Float32Array, v: IVec4Like, idx = 0): IVec4Like => Vec4.fromArray(v, a, idx),\n    [Type.MAT3]: (a: Float32Array, v: IMat3Like, idx = 0): IMat3Like => Mat3.fromArray(v, a, idx),\n    [Type.MAT4]: (a: Float32Array, v: IMat4Like, idx = 0): IMat4Like => Mat4.fromArray(v, a, idx),\n};\n\nexport const type2writer = {\n    [Type.UNKNOWN]: (a: Float32Array, v: number, idx = 0): void => console.warn('illegal uniform handle'),\n    [Type.INT]: (a: Int32Array, v: number, idx = 0): number => a[idx] = v,\n    [Type.INT2]: (a: Int32Array, v: IVec2Like, idx = 0): Int32Array => Vec2.toArray(a, v, idx),\n    [Type.INT3]: (a: Int32Array, v: IVec3Like, idx = 0): Int32Array => Vec3.toArray(a, v, idx),\n    [Type.INT4]: (a: Int32Array, v: IVec4Like, idx = 0): Int32Array => Vec4.toArray(a, v, idx),\n    [Type.FLOAT]: (a: Float32Array, v: number, idx = 0): number => a[idx] = v,\n    [Type.FLOAT2]: (a: Float32Array, v: IVec2Like, idx = 0): Float32Array => Vec2.toArray(a, v, idx),\n    [Type.FLOAT3]: (a: Float32Array, v: IVec3Like, idx = 0): Float32Array => Vec3.toArray(a, v, idx),\n    [Type.FLOAT4]: (a: Float32Array, v: IVec4Like, idx = 0): Float32Array => Vec4.toArray(a, v, idx),\n    [Type.MAT3]: (a: Float32Array, v: IMat3Like, idx = 0): Float32Array => Mat3.toArray(a, v, idx),\n    [Type.MAT4]: (a: Float32Array, v: IMat4Like, idx = 0): Float32Array => Mat4.toArray(a, v, idx),\n};\n\nconst defaultValues = [\n    Object.freeze([0]),\n    Object.freeze([0, 0]),\n    Object.freeze([0, 0, 0, 0]),\n    Object.freeze([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]),\n];\n\n/**\n * @en Gets the default values for the given type of uniform\n * @zh 根据指定的 Uniform 类型来获取默认值\n * @param type The type of the uniform\n */\nexport function getDefaultFromType (type: Type): readonly number[] | string {\n    switch (type) {\n    case Type.BOOL:\n    case Type.INT:\n    case Type.UINT:\n    case Type.FLOAT:\n        return defaultValues[0];\n    case Type.BOOL2:\n    case Type.INT2:\n    case Type.UINT2:\n    case Type.FLOAT2:\n        return defaultValues[1];\n    case Type.BOOL4:\n    case Type.INT4:\n    case Type.UINT4:\n    case Type.FLOAT4:\n        return defaultValues[2];\n    case Type.MAT4:\n        return defaultValues[3];\n    case Type.SAMPLER2D:\n        return 'default-texture';\n    case Type.SAMPLER_CUBE:\n        return 'default-cube-texture';\n    case Type.SAMPLER2D_ARRAY:\n        return 'default-array-texture';\n    case Type.SAMPLER3D:\n        return 'default-3d-texture';\n    default:\n    }\n    return defaultValues[0];\n}\n\nexport function getStringFromType (type: Type) : string {\n    switch (type) {\n    case Type.SAMPLER2D:\n        return '-texture';\n    case Type.SAMPLER_CUBE:\n        return '-cube-texture';\n    case Type.SAMPLER2D_ARRAY:\n        return '-array-texture';\n    case Type.SAMPLER3D:\n        return '-3d-texture';\n    default:\n        return '-unknown';\n    }\n}\n\n/**\n * @en Combination of preprocess macros\n * @zh 预处理宏组合\n */\nexport type MacroRecord = Record<string, number | boolean | string>;\n\n/**\n * @en Override the preprocess macros\n * @zh 覆写预处理宏\n * @param target Target preprocess macros to be overridden\n * @param source Preprocess macros used for override\n */\nexport function overrideMacros (target: MacroRecord, source: MacroRecord): boolean {\n    const entries = Object.entries(source);\n    let isDifferent = false;\n    for (let i = 0; i < entries.length; i++) {\n        if (target[entries[i][0]] !== entries[i][1]) {\n            target[entries[i][0]] = entries[i][1];\n            isDifferent = true;\n        }\n    }\n    return isDifferent;\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EffectAsset } from '../../assets/effect-asset';\nimport { SetIndex, IDescriptorSetLayoutInfo, globalDescriptorSetLayout, localDescriptorSetLayout } from '../../pipeline/define';\nimport { Pipeline, PipelineRuntime } from '../../pipeline/custom/pipeline';\nimport { genHandle, MacroRecord } from './pass-utils';\nimport { legacyCC } from '../../global-exports';\nimport { PipelineLayoutInfo, Device, Attribute, UniformBlock, ShaderInfo,\n    Uniform, ShaderStage, DESCRIPTOR_SAMPLER_TYPE, DESCRIPTOR_BUFFER_TYPE,\n    DescriptorSetLayout, DescriptorSetLayoutBinding, DescriptorSetLayoutInfo,\n    DescriptorType, GetTypeSize, ShaderStageFlagBit, API, UniformSamplerTexture, PipelineLayout,\n    Shader, UniformStorageBuffer, UniformStorageImage, UniformSampler, UniformTexture, UniformInputAttachment } from '../../gfx';\nimport { debug } from '../../platform/debug';\nimport { UpdateFrequency } from '../../pipeline/custom/types';\n\nconst _dsLayoutInfo = new DescriptorSetLayoutInfo();\n\ninterface IDefineRecord extends EffectAsset.IDefineInfo {\n    _map: (value: any) => number;\n    _offset: number;\n}\n\nexport interface ITemplateInfo {\n    gfxAttributes: Attribute[];\n    shaderInfo: ShaderInfo;\n    blockSizes: number[];\n    setLayouts: DescriptorSetLayout[];\n    pipelineLayout: PipelineLayout;\n    handleMap: Record<string, number>;\n    bindings: DescriptorSetLayoutBinding[];\n    samplerStartBinding: number;\n}\n\nexport interface IProgramInfo extends EffectAsset.IShaderInfo {\n    effectName: string;\n    defines: IDefineRecord[];\n    constantMacros: string;\n    uber: boolean; // macro number exceeds default limits, will fallback to string hash\n}\n\ninterface IMacroInfo {\n    name: string;\n    value: string;\n    isDefault: boolean;\n}\n\nfunction getBitCount (cnt: number) {\n    return Math.ceil(Math.log2(Math.max(cnt, 2)));\n}\n\nfunction mapDefine (info: EffectAsset.IDefineInfo, def: number | string | boolean) {\n    switch (info.type) {\n    case 'boolean': return typeof def === 'number' ? def.toString() : (def ? '1' : '0');\n    case 'string': return def !== undefined ? def as string : info.options![0];\n    case 'number': return def !== undefined ? def.toString() : info.range![0].toString();\n    default:\n        console.warn(`unknown define type '${info.type}'`);\n        return '-1'; // should neven happen\n    }\n}\n\nfunction prepareDefines (defs: MacroRecord, tDefs: EffectAsset.IDefineInfo[]) {\n    const macros: IMacroInfo[] = [];\n    for (let i = 0; i < tDefs.length; i++) {\n        const tmpl = tDefs[i];\n        const name = tmpl.name;\n        const v = defs[name];\n        const value = mapDefine(tmpl, v);\n        const isDefault = !v || v === '0';\n        macros.push({ name, value, isDefault });\n    }\n    return macros;\n}\n\nfunction getShaderInstanceName (name: string, macros: IMacroInfo[]) {\n    return name + macros.reduce((acc, cur) => (cur.isDefault ? acc : `${acc}|${cur.name}${cur.value}`), '');\n}\n\nfunction insertBuiltinBindings (\n    tmpl: IProgramInfo, tmplInfo: ITemplateInfo, source: IDescriptorSetLayoutInfo,\n    type: 'locals' | 'globals', outBindings?: DescriptorSetLayoutBinding[],\n) {\n    const target = tmpl.builtins[type];\n    const tempBlocks: UniformBlock[] = [];\n    for (let i = 0; i < target.blocks.length; i++) {\n        const b = target.blocks[i];\n        const info = source.layouts[b.name] as UniformBlock | undefined;\n        const binding = info && source.bindings.find((bd) => bd.binding === info.binding);\n        if (!info || !binding || !(binding.descriptorType & DESCRIPTOR_BUFFER_TYPE)) {\n            console.warn(`builtin UBO '${b.name}' not available!`);\n            continue;\n        }\n        tempBlocks.push(info);\n        if (outBindings && !outBindings.includes(binding)) outBindings.push(binding);\n    }\n    Array.prototype.unshift.apply(tmplInfo.shaderInfo.blocks, tempBlocks);\n    const tempSamplerTextures: UniformSamplerTexture[] = [];\n    for (let i = 0; i < target.samplerTextures.length; i++) {\n        const s = target.samplerTextures[i];\n        const info = source.layouts[s.name] as UniformSamplerTexture;\n        const binding = info && source.bindings.find((bd) => bd.binding === info.binding);\n        if (!info || !binding || !(binding.descriptorType & DESCRIPTOR_SAMPLER_TYPE)) {\n            console.warn(`builtin samplerTexture '${s.name}' not available!`);\n            continue;\n        }\n        tempSamplerTextures.push(info);\n        if (outBindings && !outBindings.includes(binding)) outBindings.push(binding);\n    }\n    Array.prototype.unshift.apply(tmplInfo.shaderInfo.samplerTextures, tempSamplerTextures);\n    if (outBindings) outBindings.sort((a, b) => a.binding - b.binding);\n}\n\nfunction getSize (block: EffectAsset.IBlockInfo) {\n    return block.members.reduce((s, m) => s + GetTypeSize(m.type) * m.count, 0);\n}\n\nfunction genHandles (tmpl: IProgramInfo) {\n    const handleMap: Record<string, number> = {};\n    // block member handles\n    for (let i = 0; i < tmpl.blocks.length; i++) {\n        const block = tmpl.blocks[i];\n        const members = block.members;\n        let offset = 0;\n        for (let j = 0; j < members.length; j++) {\n            const uniform = members[j];\n            handleMap[uniform.name] = genHandle(block.binding, uniform.type, uniform.count, offset);\n            offset += (GetTypeSize(uniform.type) >> 2) * uniform.count; // assumes no implicit padding, which is guaranteed by effect compiler\n        }\n    }\n    // samplerTexture handles\n    for (let i = 0; i < tmpl.samplerTextures.length; i++) {\n        const samplerTexture = tmpl.samplerTextures[i];\n        handleMap[samplerTexture.name] = genHandle(samplerTexture.binding, samplerTexture.type, samplerTexture.count);\n    }\n    return handleMap;\n}\n\nfunction dependencyCheck (dependencies: string[], defines: MacroRecord) {\n    for (let i = 0; i < dependencies.length; i++) {\n        const d = dependencies[i];\n        if (d[0] === '!') { // negative dependency\n            if (defines[d.slice(1)]) { return false; }\n        } else if (!defines[d]) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction getActiveAttributes (tmpl: IProgramInfo, tmplInfo: ITemplateInfo, defines: MacroRecord) {\n    const out: Attribute[] = [];\n    const attributes = tmpl.attributes;\n    const gfxAttributes = tmplInfo.gfxAttributes;\n    for (let i = 0; i < attributes.length; i++) {\n        if (!dependencyCheck(attributes[i].defines, defines)) { continue; }\n        out.push(gfxAttributes[i]);\n    }\n    return out;\n}\n\n/**\n * @en The global maintainer of all shader resources.\n * @zh 维护 shader 资源实例的全局管理器。\n */\nclass ProgramLib {\n    protected _templates: Record<string, IProgramInfo> = {}; // per shader\n    protected _cache: Record<string, Shader> = {};\n    protected _templateInfos: Record<number, ITemplateInfo> = {};\n\n    public register (effect: EffectAsset) {\n        for (let i = 0; i < effect.shaders.length; i++) {\n            const tmpl = this.define(effect.shaders[i]);\n            tmpl.effectName = effect.name;\n        }\n        for (let i = 0; i < effect.techniques.length; i++) {\n            const tech = effect.techniques[i];\n            for (let j = 0; j < tech.passes.length; j++) {\n                const pass = tech.passes[j];\n                // grab default property declaration if there is none\n                if (pass.propertyIndex !== undefined && pass.properties === undefined) {\n                    pass.properties = tech.passes[pass.propertyIndex].properties;\n                }\n            }\n        }\n    }\n\n    /**\n     * @en Register the shader template with the given info\n     * @zh 注册 shader 模板。\n     */\n    public define (shader: EffectAsset.IShaderInfo) {\n        const curTmpl = this._templates[shader.name];\n        if (curTmpl && curTmpl.hash === shader.hash) { return curTmpl; }\n        const tmpl = ({ ...shader }) as IProgramInfo;\n        // calculate option mask offset\n        let offset = 0;\n        for (let i = 0; i < tmpl.defines.length; i++) {\n            const def = tmpl.defines[i];\n            let cnt = 1;\n            if (def.type === 'number') {\n                const range = def.range!;\n                cnt = getBitCount(range[1] - range[0] + 1); // inclusive on both ends\n                def._map = (value: number) => value - range[0];\n            } else if (def.type === 'string') {\n                cnt = getBitCount(def.options!.length);\n                def._map = (value: any) => Math.max(0, def.options!.findIndex((s) => s === value));\n            } else if (def.type === 'boolean') {\n                def._map = (value: any) => (value ? 1 : 0);\n            }\n            def._offset = offset;\n            offset += cnt;\n        }\n        if (offset > 31) { tmpl.uber = true; }\n        // generate constant macros\n        tmpl.constantMacros = '';\n        for (const key in tmpl.builtins.statistics) {\n            tmpl.constantMacros += `#define ${key} ${tmpl.builtins.statistics[key]}\\n`;\n        }\n        // store it\n        this._templates[shader.name] = tmpl;\n        if (!this._templateInfos[tmpl.hash]) {\n            const tmplInfo = {} as ITemplateInfo;\n            // cache material-specific descriptor set layout\n            tmplInfo.samplerStartBinding = tmpl.blocks.length;\n            tmplInfo.shaderInfo = new ShaderInfo();\n            tmplInfo.blockSizes = []; tmplInfo.bindings = [];\n            for (let i = 0; i < tmpl.blocks.length; i++) {\n                const block = tmpl.blocks[i];\n                tmplInfo.blockSizes.push(getSize(block));\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(block.binding,\n                    DescriptorType.UNIFORM_BUFFER, 1, block.stageFlags));\n                tmplInfo.shaderInfo.blocks.push(new UniformBlock(SetIndex.MATERIAL, block.binding, block.name,\n                    block.members.map((m) => new Uniform(m.name, m.type, m.count)), 1)); // effect compiler guarantees block count = 1\n            }\n            for (let i = 0; i < tmpl.samplerTextures.length; i++) {\n                const samplerTexture = tmpl.samplerTextures[i];\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(samplerTexture.binding,\n                    DescriptorType.SAMPLER_TEXTURE, samplerTexture.count, samplerTexture.stageFlags));\n                tmplInfo.shaderInfo.samplerTextures.push(new UniformSamplerTexture(\n                    SetIndex.MATERIAL, samplerTexture.binding, samplerTexture.name, samplerTexture.type, samplerTexture.count,\n                ));\n            }\n            for (let i = 0; i < tmpl.samplers.length; i++) {\n                const sampler = tmpl.samplers[i];\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(sampler.binding,\n                    DescriptorType.SAMPLER, sampler.count, sampler.stageFlags));\n                tmplInfo.shaderInfo.samplers.push(new UniformSampler(\n                    SetIndex.MATERIAL, sampler.binding, sampler.name, sampler.count,\n                ));\n            }\n            for (let i = 0; i < tmpl.textures.length; i++) {\n                const texture = tmpl.textures[i];\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(texture.binding,\n                    DescriptorType.TEXTURE, texture.count, texture.stageFlags));\n                tmplInfo.shaderInfo.textures.push(new UniformTexture(\n                    SetIndex.MATERIAL, texture.binding, texture.name, texture.type, texture.count,\n                ));\n            }\n            for (let i = 0; i < tmpl.buffers.length; i++) {\n                const buffer = tmpl.buffers[i];\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(buffer.binding,\n                    DescriptorType.STORAGE_BUFFER, 1, buffer.stageFlags));\n                tmplInfo.shaderInfo.buffers.push(new UniformStorageBuffer(\n                    SetIndex.MATERIAL, buffer.binding, buffer.name, 1, buffer.memoryAccess,\n                )); // effect compiler guarantees buffer count = 1\n            }\n            for (let i = 0; i < tmpl.images.length; i++) {\n                const image = tmpl.images[i];\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(image.binding,\n                    DescriptorType.STORAGE_IMAGE, image.count, image.stageFlags));\n                tmplInfo.shaderInfo.images.push(new UniformStorageImage(\n                    SetIndex.MATERIAL, image.binding, image.name, image.type, image.count, image.memoryAccess,\n                ));\n            }\n            for (let i = 0; i < tmpl.subpassInputs.length; i++) {\n                const subpassInput = tmpl.subpassInputs[i];\n                tmplInfo.bindings.push(new DescriptorSetLayoutBinding(subpassInput.binding,\n                    DescriptorType.INPUT_ATTACHMENT, subpassInput.count, subpassInput.stageFlags));\n                tmplInfo.shaderInfo.subpassInputs.push(new UniformInputAttachment(\n                    SetIndex.MATERIAL, subpassInput.binding, subpassInput.name, subpassInput.count,\n                ));\n            }\n            tmplInfo.gfxAttributes = [];\n            for (let i = 0; i < tmpl.attributes.length; i++) {\n                const attr = tmpl.attributes[i];\n                tmplInfo.gfxAttributes.push(new Attribute(attr.name, attr.format, attr.isNormalized, 0, attr.isInstanced, attr.location));\n            }\n            insertBuiltinBindings(tmpl, tmplInfo, localDescriptorSetLayout, 'locals');\n\n            tmplInfo.shaderInfo.stages.push(new ShaderStage(ShaderStageFlagBit.VERTEX, ''));\n            tmplInfo.shaderInfo.stages.push(new ShaderStage(ShaderStageFlagBit.FRAGMENT, ''));\n            tmplInfo.handleMap = genHandles(tmpl);\n            tmplInfo.setLayouts = [];\n\n            this._templateInfos[tmpl.hash] = tmplInfo;\n        }\n\n        return tmpl;\n    }\n\n    /**\n     * @en Gets the shader template with its name\n     * @zh 通过名字获取 Shader 模板\n     * @param name Target shader name\n     */\n    public getTemplate (name: string) {\n        return this._templates[name];\n    }\n\n    /**\n     * @en Gets the shader template info with its name\n     * @zh 通过名字获取 Shader 模版信息\n     * @param name Target shader name\n     */\n    public getTemplateInfo (name: string) {\n        const hash = this._templates[name].hash;\n        return this._templateInfos[hash];\n    }\n\n    /**\n     * @en Gets the pipeline layout of the shader template given its name\n     * @zh 通过名字获取 Shader 模板相关联的管线布局\n     * @param name Target shader name\n     */\n    public getDescriptorSetLayout (device: Device, name: string, isLocal = false) {\n        const tmpl = this._templates[name];\n        const tmplInfo = this._templateInfos[tmpl.hash];\n        if (!tmplInfo.setLayouts.length) {\n            _dsLayoutInfo.bindings = tmplInfo.bindings;\n            tmplInfo.setLayouts[SetIndex.MATERIAL] = device.createDescriptorSetLayout(_dsLayoutInfo);\n            _dsLayoutInfo.bindings = localDescriptorSetLayout.bindings;\n            tmplInfo.setLayouts[SetIndex.LOCAL] = device.createDescriptorSetLayout(_dsLayoutInfo);\n        }\n        return tmplInfo.setLayouts[isLocal ? SetIndex.LOCAL : SetIndex.MATERIAL];\n    }\n\n    /**\n     * @en\n     * Does this library has the specified program\n     * @zh\n     * 当前是否有已注册的指定名字的 shader\n     * @param name Target shader name\n     */\n    public hasProgram (name: string) {\n        return this._templates[name] !== undefined;\n    }\n\n    /**\n     * @en Gets the shader key with the name and a macro combination\n     * @zh 根据 shader 名和预处理宏列表获取 shader key。\n     * @param name Target shader name\n     * @param defines The combination of preprocess macros\n     */\n    public getKey (name: string, defines: MacroRecord) {\n        const tmpl = this._templates[name];\n        const tmplDefs = tmpl.defines;\n        if (tmpl.uber) {\n            let key = '';\n            for (let i = 0; i < tmplDefs.length; i++) {\n                const tmplDef = tmplDefs[i];\n                const value = defines[tmplDef.name];\n                if (!value || !tmplDef._map) {\n                    continue;\n                }\n                const mapped = tmplDef._map(value);\n                const offset = tmplDef._offset;\n                key += `${offset}${mapped}|`;\n            }\n            return `${key}${tmpl.hash}`;\n        }\n        let key = 0;\n        for (let i = 0; i < tmplDefs.length; i++) {\n            const tmplDef = tmplDefs[i];\n            const value = defines[tmplDef.name];\n            if (!value || !tmplDef._map) {\n                continue;\n            }\n            const mapped = tmplDef._map(value);\n            const offset = tmplDef._offset;\n            key |= mapped << offset;\n        }\n        return `${key.toString(16)}|${tmpl.hash}`;\n    }\n\n    /**\n     * @en Destroy all shader instance match the preprocess macros\n     * @zh 销毁所有完全满足指定预处理宏特征的 shader 实例。\n     * @param defines The preprocess macros as filter\n     */\n    public destroyShaderByDefines (defines: MacroRecord) {\n        const names = Object.keys(defines); if (!names.length) { return; }\n        const regexes = names.map((cur) => {\n            let val = defines[cur];\n            if (typeof val === 'boolean') { val = val ? '1' : '0'; }\n            return new RegExp(`${cur}${val}`);\n        });\n        const keys = Object.keys(this._cache).filter((k) => regexes.every((re) => re.test(this._cache[k].name)));\n        for (let i = 0; i < keys.length; i++) {\n            const k = keys[i];\n            const prog = this._cache[k];\n            debug(`destroyed shader ${prog.name}`);\n            prog.destroy();\n            delete this._cache[k];\n        }\n    }\n\n    /**\n     * @en Gets the shader resource instance with given information\n     * @zh 获取指定 shader 的渲染资源实例\n     * @param name Shader name\n     * @param defines Preprocess macros\n     * @param pipeline The [[RenderPipeline]] which owns the render command\n     * @param key The shader cache key, if already known\n     */\n    public getGFXShader (device: Device, name: string, defines: MacroRecord, pipeline: PipelineRuntime, key?: string) {\n        Object.assign(defines, pipeline.macros);\n        if (!key) key = this.getKey(name, defines);\n        const res = this._cache[key];\n        if (res) { return res; }\n\n        const tmpl = this._templates[name];\n        const tmplInfo = this._templateInfos[tmpl.hash];\n        if (!tmplInfo.pipelineLayout) {\n            this.getDescriptorSetLayout(device, name); // ensure set layouts have been created\n            insertBuiltinBindings(tmpl, tmplInfo, globalDescriptorSetLayout, 'globals');\n            tmplInfo.setLayouts[SetIndex.GLOBAL] = pipeline.descriptorSetLayout;\n            tmplInfo.pipelineLayout = device.createPipelineLayout(new PipelineLayoutInfo(tmplInfo.setLayouts));\n        }\n\n        const macroArray = prepareDefines(defines, tmpl.defines);\n        const prefix = pipeline.constantMacros + tmpl.constantMacros\n            + macroArray.reduce((acc, cur) => `${acc}#define ${cur.name} ${cur.value}\\n`, '');\n\n        let src = tmpl.glsl3;\n        const deviceShaderVersion = getDeviceShaderVersion(device);\n        if (deviceShaderVersion) {\n            src = tmpl[deviceShaderVersion];\n        } else {\n            console.error('Invalid GFX API!');\n        }\n        tmplInfo.shaderInfo.stages[0].source = prefix + src.vert;\n        tmplInfo.shaderInfo.stages[1].source = prefix + src.frag;\n\n        // strip out the active attributes only, instancing depend on this\n        tmplInfo.shaderInfo.attributes = getActiveAttributes(tmpl, tmplInfo, defines);\n\n        tmplInfo.shaderInfo.name = getShaderInstanceName(name, macroArray);\n        return this._cache[key] = device.createShader(tmplInfo.shaderInfo);\n    }\n}\n\nexport function getDeviceShaderVersion (device: Device) {\n    switch (device.gfxAPI) {\n    case API.GLES2:\n    case API.WEBGL: return 'glsl1';\n    case API.GLES3:\n    case API.WEBGL2: return 'glsl3';\n    default: return 'glsl4';\n    }\n}\n\nexport const programLib = new ProgramLib();\nlegacyCC.programLib = programLib;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable, editable, editorOnly } from 'cc.decorator';\nimport { EDITOR } from 'internal:constants';\nimport { Root } from '../root';\nimport { BlendState, DepthStencilState, RasterizerState,\n    DynamicStateFlags, PrimitiveMode, ShaderStageFlags, Type, Uniform, MemoryAccess, Format, deviceManager } from '../gfx';\nimport { RenderPassStage } from '../pipeline/define';\nimport { MacroRecord } from '../renderer/core/pass-utils';\nimport { programLib } from '../renderer/core/program-lib';\nimport { Asset } from './asset';\nimport { legacyCC } from '../global-exports';\nimport { warnID } from '../platform/debug';\n\nexport declare namespace EffectAsset {\n    export interface IPropertyInfo {\n        type: number; // auto-extracted from shader\n        handleInfo?: [string, number, number]; // auto-generated from 'target'\n        samplerHash?: number; // auto-generated from 'sampler'\n        value?: number[] | string; // default value\n        linear?: boolean; // whether to convert the input to linear space first before applying\n    }\n    // Pass instance itself are compliant to IPassStates too\n    export interface IPassStates {\n        priority?: number;\n        primitive?: PrimitiveMode;\n        stage?: RenderPassStage;\n        rasterizerState?: RasterizerState;\n        depthStencilState?: DepthStencilState;\n        blendState?: BlendState;\n        dynamicStates?: DynamicStateFlags;\n        phase?: string | number;\n    }\n    export interface IPassInfo extends IPassStates {\n        program: string; // auto-generated from 'vert' and 'frag'\n        embeddedMacros?: MacroRecord;\n        propertyIndex?: number;\n        switch?: string;\n        properties?: Record<string, IPropertyInfo>;\n    }\n    export interface ITechniqueInfo {\n        passes: IPassInfo[];\n        name?: string;\n    }\n\n    export interface IBlockInfo {\n        binding: number;\n        name: string;\n        members: Uniform[];\n        stageFlags: ShaderStageFlags;\n    }\n    export interface ISamplerTextureInfo {\n        binding: number;\n        name: string;\n        type: Type;\n        count: number;\n        stageFlags: ShaderStageFlags;\n    }\n    export interface ISamplerInfo {\n        set: number;\n        binding: number;\n        name: string;\n        count: number;\n        stageFlags: ShaderStageFlags;\n    }\n    export interface ITextureInfo {\n        set: number;\n        binding: number;\n        name: string;\n        type: Type;\n        count: number;\n        stageFlags: ShaderStageFlags;\n    }\n    export interface IBufferInfo {\n        binding: number;\n        name: string;\n        memoryAccess: MemoryAccess;\n        stageFlags: ShaderStageFlags;\n    }\n    export interface IImageInfo {\n        binding: number;\n        name: string;\n        type: Type;\n        count: number;\n        memoryAccess: MemoryAccess;\n        stageFlags: ShaderStageFlags;\n    }\n\n    export interface IInputAttachmentInfo {\n        set: number;\n        binding: number;\n        name: string;\n        count: number;\n        stageFlags: ShaderStageFlags;\n    }\n    export interface IAttributeInfo {\n        name: string;\n        format: Format;\n        isNormalized: boolean;\n        stream: number;\n        isInstanced: boolean;\n        location: number;\n        defines: string[];\n    }\n    export interface IDefineInfo {\n        name: string;\n        type: string;\n        range?: number[];\n        options?: string[];\n        default?: string;\n    }\n    export interface IBuiltin {\n        name: string;\n        defines: string[];\n    }\n    export interface IBuiltinInfo {\n        buffers: IBuiltin[];\n        blocks: IBuiltin[];\n        samplerTextures: IBuiltin[];\n        images: IBuiltin[];\n    }\n    export interface IShaderInfo {\n        name: string;\n        hash: number;\n        glsl4: { vert: string, frag: string };\n        glsl3: { vert: string, frag: string };\n        glsl1: { vert: string, frag: string };\n        builtins: { globals: IBuiltinInfo, locals: IBuiltinInfo, statistics: Record<string, number> };\n        defines: IDefineInfo[];\n        attributes: IAttributeInfo[];\n        blocks: IBlockInfo[];\n        samplerTextures: ISamplerTextureInfo[];\n        samplers: ISamplerInfo[];\n        textures: ITextureInfo[];\n        buffers: IBufferInfo[];\n        images: IImageInfo[];\n        subpassInputs: IInputAttachmentInfo[];\n    }\n    export interface IPreCompileInfo {\n        [name: string]: boolean[] | number[] | string[];\n    }\n}\n\nconst legacyBuiltinEffectNames = [\n    'planar-shadow',\n    'skybox',\n    'deferred-lighting',\n    'bloom',\n    'post-process',\n    'profiler',\n    'splash-screen',\n    'standard',\n    'unlit',\n    'sprite',\n    'particle',\n    'particle-gpu',\n    'particle-trail',\n    'billboard',\n    'terrain',\n    'graphics',\n    'clear-stencil',\n    'spine',\n    'occlusion-query',\n    'geometry-renderer',\n    'debug-renderer',\n];\n\n/**\n * @en Effect asset is the base template for instantiating material, all effects should be unique globally.\n * All effects are managed in a static map of EffectAsset.\n * @zh Effect 资源，作为材质实例初始化的模板，每个 effect 资源都应是全局唯一的。\n * 所有 Effect 资源都由此类的一个静态对象管理。\n */\n@ccclass('cc.EffectAsset')\nexport class EffectAsset extends Asset {\n    /**\n     * @en Register the effect asset to the static map\n     * @zh 将指定 effect 注册到全局管理器。\n     */\n    public static register (asset: EffectAsset) {\n        EffectAsset._effects[asset.name] = asset;\n        EffectAsset._layoutValid = false;\n    }\n\n    /**\n     * @en Unregister the effect asset from the static map\n     * @zh 将指定 effect 从全局管理器移除。\n     */\n    public static remove (asset: EffectAsset | string) {\n        if (typeof asset !== 'string') {\n            if (EffectAsset._effects[asset.name] && EffectAsset._effects[asset.name] === asset) {\n                delete EffectAsset._effects[asset.name];\n            }\n        } else {\n            if (EffectAsset._effects[asset]) { delete EffectAsset._effects[asset]; return; }\n            for (const n in EffectAsset._effects) {\n                if (EffectAsset._effects[n]._uuid === asset) {\n                    delete EffectAsset._effects[n];\n                    return;\n                }\n            }\n        }\n    }\n\n    /**\n     * @en Get the effect asset by the given name.\n     * @zh 获取指定名字的 effect 资源。\n     */\n    public static get (name: string) {\n        if (EffectAsset._effects[name]) { return EffectAsset._effects[name]; }\n        for (const n in EffectAsset._effects) {\n            if (EffectAsset._effects[n]._uuid === name) {\n                return EffectAsset._effects[n];\n            }\n        }\n        if (legacyBuiltinEffectNames.includes(name)) {\n            warnID(16101, name);\n        }\n        return null;\n    }\n\n    /**\n     * @en Get all registered effect assets.\n     * @zh 获取所有已注册的 effect 资源。\n     */\n    public static getAll () { return EffectAsset._effects; }\n    protected static _effects: Record<string, EffectAsset> = {};\n\n    public static isLayoutValid (): boolean { return EffectAsset._layoutValid; }\n    public static setLayoutValid (): void { EffectAsset._layoutValid = true; }\n    protected static _layoutValid = true;\n\n    /**\n     * @en The techniques used by the current effect.\n     * @zh 当前 effect 的所有可用 technique。\n     */\n    @serializable\n    @editable\n    public techniques: EffectAsset.ITechniqueInfo[] = [];\n\n    /**\n     * @en The shaders used by the current effect.\n     * @zh 当前 effect 使用的所有 shader。\n     */\n    @serializable\n    @editable\n    public shaders: EffectAsset.IShaderInfo[] = [];\n\n    /**\n     * @en The preprocess macro combinations for the shader\n     * @zh 每个 shader 需要预编译的宏定义组合。\n     */\n    @serializable\n    @editable\n    public combinations: EffectAsset.IPreCompileInfo[] = [];\n\n    @serializable\n    @editorOnly\n    public hideInEditor = false;\n\n    /**\n     * @en The loaded callback which should be invoked by the [[CCLoader]], will automatically register the effect.\n     * @zh 通过 [[CCLoader]] 加载完成时的回调，将自动注册 effect 资源。\n     */\n    public onLoaded () {\n        programLib.register(this);\n        EffectAsset.register(this);\n        if (!EDITOR || legacyCC.GAME_VIEW) { legacyCC.game.once(legacyCC.Game.EVENT_RENDERER_INITED, this._precompile, this); }\n    }\n\n    protected _precompile () {\n        const root = legacyCC.director.root as Root;\n        for (let i = 0; i < this.shaders.length; i++) {\n            const shader = this.shaders[i];\n            const combination = this.combinations[i];\n            if (!combination) { continue; }\n            const defines = Object.keys(combination).reduce((out, name) => out.reduce((acc, cur) => {\n                const choices = combination[name];\n                for (let i = 0; i < choices.length; ++i) {\n                    const defines = { ...cur };\n                    defines[name] = choices[i];\n                    acc.push(defines);\n                }\n                return acc;\n            }, [] as MacroRecord[]), [{}] as MacroRecord[]);\n            defines.forEach(\n                (defines) => programLib.getGFXShader(deviceManager.gfxDevice, shader.name, defines, root.pipeline),\n            );\n        }\n    }\n\n    public destroy () {\n        EffectAsset.remove(this);\n        return super.destroy();\n    }\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        const effect = EffectAsset.get('builtin-unlit');\n        this.name = 'builtin-unlit';\n        this.shaders = effect!.shaders;\n        this.combinations = effect!.combinations;\n        this.techniques = effect!.techniques;\n    }\n\n    public validate () {\n        return this.techniques.length > 0 && this.shaders.length > 0;\n    }\n}\n\nlegacyCC.EffectAsset = EffectAsset;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Address, Filter as GFXFilter, Format } from '../gfx';\n\n// define a specified number for the pixel format which gfx do not have a standard definition.\nconst CUSTOM_PIXEL_FORMAT = 1024;\n\n/**\n * @en\n * The texture pixel format, default value is RGBA8888,<br>\n * you should note that textures loaded by normal image files (png, jpg) can only support RGBA8888 format,<br>\n * other formats are supported by compressed file types or raw data.\n * @zh\n * 纹理像素格式，默认值为RGBA8888，<br>\n * 你应该注意到普通图像文件（png，jpg）加载的纹理只能支持RGBA8888格式，<br>\n * 压缩文件类型或原始数据支持其他格式。\n */\nexport enum PixelFormat {\n    /**\n     * @en\n     * 16-bit pixel format containing red, green and blue channels\n     * @zh\n     * 包含 RGB 通道的 16 位纹理。\n     */\n    RGB565 = Format.R5G6B5,\n    /**\n     * @en\n     * 16-bit pixel format containing red, green, blue channels with 5 bits per channel and one bit alpha channel: RGB5A1\n     * @zh\n     * 包含 RGB（分别占 5 bits）和 1 bit 的 alpha 通道的 16 位纹理：RGB5A1。\n     */\n    RGB5A1 = Format.RGB5A1,\n    /**\n     * @en\n     * 16-bit pixel format containing red, green, blue and alpha channels: RGBA4444\n     * @zh\n     * 包含 RGBA 通道的 16 位纹理：RGBA4444。\n     */\n    RGBA4444 = Format.RGBA4,\n    /**\n     * @en\n     * 24-bit pixel format containing red, green and blue channels: RGB888\n     * @zh\n     * 包含 RGB 通道的 24 位纹理：RGB888。\n     */\n    RGB888 = Format.RGB8,\n    /**\n     * @en\n     * 32-bit float pixel format containing red, green and blue channels: RGBA32F\n     * @zh\n     * 包含 RGB 通道的 32 位浮点数像素格式：RGBA32F。\n     */\n    RGB32F = Format.RGB32F,\n    /**\n     * @en\n     * 32-bit pixel format containing red, green, blue and alpha channels: RGBA8888\n     * @zh\n     * 包含 RGBA 四通道的 32 位整形像素格式：RGBA8888。\n     */\n    RGBA8888 = Format.RGBA8,\n    /**\n     * @en\n     * 32-bit float pixel format containing red, green, blue and alpha channels: RGBA32F\n     * @zh\n     * 32位浮点数像素格式：RGBA32F。\n     */\n    RGBA32F = Format.RGBA32F,\n    /**\n     * @en\n     * 8-bit pixel format used as masks\n     * @zh\n     * 用作蒙版的8位纹理。\n     */\n    A8 = Format.A8,\n    /**\n     * @en\n     * 8-bit intensity pixel format\n     * @zh\n     * 8位强度纹理。\n     */\n    I8 = Format.L8,\n    /**\n     * @en\n     * 16-bit pixel format used as masks\n     * @zh\n     * 用作蒙版的16位纹理。\n     */\n    AI8 = Format.LA8,\n    /**\n     * @en A pixel format containing red, green, and blue channels that is PVR 2bpp compressed.\n     * @zh 包含 RGB 通道的 PVR 2BPP 压缩纹理格式\n     */\n    RGB_PVRTC_2BPPV1 = Format.PVRTC_RGB2,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is PVR 2bpp compressed.\n     * @zh 包含 RGBA 通道的 PVR 2BPP 压缩纹理格式\n     */\n    RGBA_PVRTC_2BPPV1 = Format.PVRTC_RGBA2,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is PVR 2bpp compressed.\n     * RGB_A_PVRTC_2BPPV1 texture is a 2x height RGB_PVRTC_2BPPV1 format texture.\n     * It separate the origin alpha channel to the bottom half atlas, the origin rgb channel to the top half atlas.\n     * @zh 包含 RGBA 通道的 PVR 2BPP 压缩纹理格式\n     * 这种压缩纹理格式贴图的高度是普通 RGB_PVRTC_2BPPV1 贴图高度的两倍，使用上半部分作为原始 RGB 通道数据，下半部分用来存储透明通道数据。\n     */\n    RGB_A_PVRTC_2BPPV1 = CUSTOM_PIXEL_FORMAT,\n    /**\n     * @en A pixel format containing red, green, and blue channels that is PVR 4bpp compressed.\n     * @zh 包含 RGB 通道的 PVR 4BPP 压缩纹理格式\n     */\n    RGB_PVRTC_4BPPV1 = Format.PVRTC_RGB4,\n    /**\n     * @en A pixel format containing red, green, blue and alpha channels that is PVR 4bpp compressed.\n     * @zh 包含 RGBA 通道的 PVR 4BPP 压缩纹理格式\n     */\n    RGBA_PVRTC_4BPPV1 = Format.PVRTC_RGBA4,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is PVR 4bpp compressed.\n     * RGB_A_PVRTC_4BPPV1 texture is a 2x height RGB_PVRTC_4BPPV1 format texture.\n     * It separate the origin alpha channel to the bottom half atlas, the origin rgb channel to the top half atlas.\n     * @zh 包含 RGBA 通道的 PVR 4BPP 压缩纹理格式\n    * 这种压缩纹理格式贴图的高度是普通 RGB_PVRTC_4BPPV1 贴图高度的两倍，使用上半部分作为原始 RGB 通道数据，下半部分用来存储透明通道数据。\n     */\n    RGB_A_PVRTC_4BPPV1 = CUSTOM_PIXEL_FORMAT + 1,\n    /**\n     * @en A pixel format containing red, green, and blue channels that is ETC1 compressed.\n     * @zh 包含 RGB 通道的 ETC1 压缩纹理格式\n     */\n    RGB_ETC1 = Format.ETC_RGB8,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ETC1 compressed.\n     * @zh 包含 RGBA 通道的 ETC1 压缩纹理格式\n     */\n    RGBA_ETC1 = CUSTOM_PIXEL_FORMAT + 2,\n    /**\n     * @en A pixel format containing red, green, and blue channels that is ETC2 compressed.\n     * @zh 包含 RGB 通道的 ETC2 压缩纹理格式\n     */\n    RGB_ETC2 = Format.ETC2_RGB8,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ETC2 compressed.\n     * @zh 包含 RGBA 通道的 ETC2 压缩纹理格式\n     */\n    RGBA_ETC2 = Format.ETC2_RGBA8,\n\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 4x4 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 4x4\n     */\n    RGBA_ASTC_4x4 = Format.ASTC_RGBA_4X4,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 5x4 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 5x4\n     */\n    RGBA_ASTC_5x4 = Format.ASTC_RGBA_5X4,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 5x5 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 5x5\n     */\n    RGBA_ASTC_5x5 = Format.ASTC_RGBA_5X5,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 6x5 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 6x5\n     */\n    RGBA_ASTC_6x5 = Format.ASTC_RGBA_6X5,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 6x6 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 6x6\n     */\n    RGBA_ASTC_6x6 = Format.ASTC_RGBA_6X6,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 8x5 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 8x5\n     */\n    RGBA_ASTC_8x5 = Format.ASTC_RGBA_8X5,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 8x6 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 8x6\n     */\n    RGBA_ASTC_8x6 = Format.ASTC_RGBA_8X6,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 8x8 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 8x8\n     */\n    RGBA_ASTC_8x8 = Format.ASTC_RGBA_8X8,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 10x5 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 10x5\n     */\n    RGBA_ASTC_10x5 = Format.ASTC_RGBA_10X5,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 10x6 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 10x6\n     */\n    RGBA_ASTC_10x6 = Format.ASTC_RGBA_10X6,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 10x8 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 10x8\n     */\n    RGBA_ASTC_10x8 = Format.ASTC_RGBA_10X8,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 10x10 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 10x10\n     */\n    RGBA_ASTC_10x10 = Format.ASTC_RGBA_10X10,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 12x10 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 12x10\n     */\n    RGBA_ASTC_12x10 = Format.ASTC_RGBA_12X10,\n    /**\n     * @en A pixel format containing red, green, blue, and alpha channels that is ASTC compressed with 12x12 block size.\n     * @zh 包含 RGBA 通道的 ASTC 压缩纹理格式，压缩分块大小为 12x12\n     */\n    RGBA_ASTC_12x12 = Format.ASTC_RGBA_12X12,\n}\n\n/**\n * @en\n * The texture wrap mode.\n * @zh\n * 纹理环绕方式。\n */\nexport enum WrapMode {\n    /**\n     * @en\n     * Specifies that the repeat warp mode will be used.\n     * @zh\n     * 指定环绕模式：重复纹理图像。\n     */\n    REPEAT = Address.WRAP,\n    /**\n     * @en\n     * Specifies that the clamp to edge warp mode will be used.\n     * @zh\n     * 指定环绕模式：纹理边缘拉伸效果。\n     */\n    CLAMP_TO_EDGE = Address.CLAMP,\n    /**\n     * @en\n     * Specifies that the mirrored repeat warp mode will be used.\n     * @zh\n     * 指定环绕模式：以镜像模式重复纹理图像。\n     */\n    MIRRORED_REPEAT = Address.MIRROR,\n    /**\n     * @en\n     * Specifies that the  clamp to border wrap mode will be used.\n     * @zh\n     * 指定环绕模式：超出纹理坐标部分以用户指定颜色填充。\n     */\n    CLAMP_TO_BORDER = Address.BORDER,\n}\n\n/**\n * @en\n * The texture filter mode\n * @zh\n * 纹理过滤模式。\n */\nexport enum Filter {\n    NONE = GFXFilter.NONE,\n    /**\n     * @en\n     * Specifies linear filtering.\n     * @zh\n     * 线性过滤模式。\n     */\n    LINEAR = GFXFilter.LINEAR,\n    /**\n     * @en\n     * Specifies nearest filtering.\n     * @zh\n     * 临近过滤模式。\n     */\n    NEAREST = GFXFilter.POINT,\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n// @ts-check\nimport { EDITOR, JSB, TEST } from 'internal:constants';\nimport { ccclass, serializable } from 'cc.decorator';\nimport IDGenerator from '../utils/id-generator';\nimport { Asset } from './asset';\nimport { Filter, PixelFormat, WrapMode } from './asset-enum';\nimport { Sampler, Texture, Device, Format, SamplerInfo, Address, Filter as GFXFilter, deviceManager } from '../gfx';\nimport { legacyCC } from '../global-exports';\nimport { errorID } from '../platform/debug';\nimport { murmurhash2_32_gc } from '../utils/murmurhash2_gc';\nimport { ccenum } from '../value-types/enum';\n\nccenum(Format);\n\nconst idGenerator = new IDGenerator('Tex');\n/**\n * @en The base texture class, it defines features shared by all textures.\n * @zh 贴图资源基类。它定义了所有贴图共用的概念。\n */\n@ccclass('cc.TextureBase')\nexport class TextureBase extends Asset {\n    /**\n     * @en Whether the pixel data is compressed.\n     * @zh 此贴图是否为压缩的像素格式。\n     */\n    public get isCompressed (): boolean {\n        return (this._format >= PixelFormat.RGB_ETC1 && this._format <= PixelFormat.RGBA_ASTC_12x12)\n        || (this._format >= PixelFormat.RGB_A_PVRTC_2BPPV1 && this._format <= PixelFormat.RGBA_ETC1);\n    }\n\n    /**\n     * @en Pixel width of the texture\n     * @zh 此贴图的像素宽度。\n     */\n    public get width (): number {\n        return this._width;\n    }\n\n    /**\n     * @en Pixel height of the texture\n     * @zh 此贴图的像素高度。\n     */\n    public get height (): number {\n        return this._height;\n    }\n\n    /**\n     * @en The pixel format enum.\n     * @zh 像素格式枚举类型\n     */\n    public static PixelFormat = PixelFormat;\n\n    /**\n     * @en The wrap mode enum.\n     * @zh 环绕模式枚举类型\n     */\n    public static WrapMode = WrapMode;\n\n    /**\n     * @en The texture filter mode enum\n     * @zh 纹理过滤模式枚举类型\n     */\n    public static Filter = Filter;\n\n    @serializable\n    protected _format = PixelFormat.RGBA8888;\n\n    @serializable\n    protected _minFilter = Filter.LINEAR;\n\n    @serializable\n    protected _magFilter = Filter.LINEAR;\n\n    @serializable\n    protected _mipFilter = Filter.NONE;\n\n    @serializable\n    protected _wrapS = WrapMode.REPEAT;\n\n    @serializable\n    protected _wrapT = WrapMode.REPEAT;\n\n    @serializable\n    protected _wrapR = WrapMode.REPEAT;\n\n    @serializable\n    protected _anisotropy = 0;\n\n    protected _width = 1;\n    protected _height = 1;\n\n    private _id: string;\n    private _samplerInfo = new SamplerInfo();\n    private _gfxSampler: Sampler | null = null;\n    private _gfxDevice: Device | null = null;\n\n    private _textureHash = 0;\n\n    constructor () {\n        super();\n\n        // Id for generate hash in material\n        this._id = idGenerator.getNewId();\n        this._gfxDevice = this._getGFXDevice();\n        this._textureHash = murmurhash2_32_gc(this._id, 666);\n    }\n\n    /**\n     * @en Gets the id of the texture\n     * @zh 获取标识符。\n     * @returns The id\n     */\n    public getId () {\n        return this._id;\n    }\n\n    /**\n     * @en Gets the pixel format\n     * @zh 获取像素格式。\n     * @returns The pixel format\n     */\n    public getPixelFormat () {\n        return this._format;\n    }\n\n    /**\n     * @en Gets the anisotropy\n     * @zh 获取各向异性。\n     * @returns The anisotropy\n     */\n    public getAnisotropy () {\n        return this._anisotropy;\n    }\n\n    /**\n     * @en Sets the wrap mode of the texture.\n     * Be noted, if the size of the texture is not power of two, only [[WrapMode.CLAMP_TO_EDGE]] is allowed.\n     * @zh 设置此贴图的缠绕模式。\n     * 注意，若贴图尺寸不是 2 的整数幂，缠绕模式仅允许 [[WrapMode.CLAMP_TO_EDGE]]。\n     * @param wrapS S(U) coordinate wrap mode\n     * @param wrapT T(V) coordinate wrap mode\n     * @param wrapR R(W) coordinate wrap mode\n     */\n    public setWrapMode (wrapS: WrapMode, wrapT: WrapMode, wrapR?: WrapMode) {\n        if (wrapR === undefined) wrapR = wrapS; // wrap modes should be as consistent as possible for performance\n\n        this._wrapS = wrapS;\n        this._samplerInfo.addressU = wrapS as unknown as Address;\n        this._wrapT = wrapT;\n        this._samplerInfo.addressV = wrapT as unknown as Address;\n        this._wrapR = wrapR;\n        this._samplerInfo.addressW = wrapR as unknown as Address;\n\n        if (this._gfxDevice) {\n            this._gfxSampler = this._gfxDevice.getSampler(this._samplerInfo);\n        }\n    }\n\n    /**\n     * @en Sets the texture's filter mode\n     * @zh 设置此贴图的过滤算法。\n     * @param minFilter Filter mode for scale down\n     * @param magFilter Filter mode for scale up\n     */\n    public setFilters (minFilter: Filter, magFilter: Filter) {\n        this._minFilter = minFilter;\n        this._samplerInfo.minFilter = minFilter as unknown as GFXFilter;\n        this._magFilter = magFilter;\n        this._samplerInfo.magFilter = magFilter as unknown as GFXFilter;\n\n        if (this._gfxDevice) {\n            this._gfxSampler = this._gfxDevice.getSampler(this._samplerInfo);\n        }\n    }\n\n    /**\n     * @en Sets the texture's mip filter\n     * @zh 设置此贴图的缩小过滤算法。\n     * @param mipFilter Filter mode for scale down\n     */\n    public setMipFilter (mipFilter: Filter) {\n        this._mipFilter = mipFilter;\n        this._samplerInfo.mipFilter = mipFilter as unknown as GFXFilter;\n\n        if (this._gfxDevice) {\n            this._gfxSampler = this._gfxDevice.getSampler(this._samplerInfo);\n        }\n    }\n\n    /**\n     * @en Sets the texture's anisotropy\n     * @zh 设置此贴图的各向异性。\n     * @param anisotropy\n     */\n    public setAnisotropy (anisotropy: number) {\n        this._anisotropy = anisotropy;\n        this._samplerInfo.maxAnisotropy = anisotropy;\n\n        if (this._gfxDevice) {\n            this._gfxSampler = this._gfxDevice.getSampler(this._samplerInfo);\n        }\n    }\n\n    /**\n     * @en Destroy the current texture, clear up the related GPU resources.\n     * @zh 销毁此贴图，并释放占用的 GPU 资源。\n     */\n    public destroy () {\n        const destroyed = super.destroy();\n        if (destroyed && legacyCC.director.root?.batcher2D) {\n            legacyCC.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash);\n        }\n        return destroyed;\n    }\n\n    /**\n     * @en Gets the texture hash.\n     * @zh 获取此贴图的哈希值。\n     */\n    public getHash () {\n        return this._textureHash;\n    }\n\n    /**\n     * @en Gets the GFX Texture resource\n     * @zh 获取此贴图底层的 GFX 贴图对象。\n     */\n    public getGFXTexture (): Texture | null {\n        return null;\n    }\n\n    /**\n     * @en Gets the internal GFX sampler hash.\n     * @zh 获取此贴图内部使用的 GFX 采样器信息。\n     * @private\n     */\n    public getSamplerInfo (): Readonly<SamplerInfo> {\n        return this._samplerInfo;\n    }\n\n    /**\n     * @en Gets the sampler resource for the texture\n     * @zh 获取此贴图底层的 GFX 采样信息。\n     */\n    public getGFXSampler () {\n        if (!this._gfxSampler) {\n            if (this._gfxDevice) {\n                this._gfxSampler = this._gfxDevice.getSampler(this._samplerInfo);\n            } else {\n                errorID(9302);\n            }\n        }\n        return this._gfxSampler!;\n    }\n\n    // SERIALIZATION\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _serialize (ctxForExporting: any): any {\n        if (EDITOR || TEST) {\n            return `${this._minFilter},${this._magFilter},${\n                this._wrapS},${this._wrapT},${\n                this._mipFilter},${this._anisotropy}`;\n        }\n        return '';\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _deserialize (serializedData: any, handle: any) {\n        const data = serializedData as string;\n        const fields = data.split(',');\n        fields.unshift('');\n        if (fields.length >= 5) {\n            // decode filters\n            this.setFilters(parseInt(fields[1]), parseInt(fields[2]));\n            // decode wraps\n            this.setWrapMode(parseInt(fields[3]), parseInt(fields[4]));\n        }\n        if (fields.length >= 7) {\n            this.setMipFilter(parseInt(fields[5]));\n            this.setAnisotropy(parseInt(fields[6]));\n        }\n    }\n\n    protected _getGFXDevice (): Device | null {\n        return deviceManager.gfxDevice;\n    }\n\n    protected _getGFXFormat () {\n        return this._getGFXPixelFormat(this._format);\n    }\n\n    protected _setGFXFormat (format?: PixelFormat) {\n        this._format = format === undefined ? PixelFormat.RGBA8888 : format;\n    }\n\n    protected _getGFXPixelFormat (format: PixelFormat) {\n        if (format === PixelFormat.RGBA_ETC1) {\n            format = PixelFormat.RGB_ETC1;\n        } else if (format === PixelFormat.RGB_A_PVRTC_4BPPV1) {\n            format = PixelFormat.RGB_PVRTC_4BPPV1;\n        } else if (format === PixelFormat.RGB_A_PVRTC_2BPPV1) {\n            format = PixelFormat.RGB_PVRTC_2BPPV1;\n        }\n        return format as unknown as Format;\n    }\n}\n\nlegacyCC.TextureBase = TextureBase;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n// @ts-check\nimport { ccclass, override } from 'cc.decorator';\nimport { EDITOR, ALIPAY, XIAOMI, JSB, TEST, BAIDU } from 'internal:constants';\nimport { Device, Format, FormatFeatureBit, deviceManager } from '../gfx';\nimport { Asset } from './asset';\nimport { PixelFormat } from './asset-enum';\nimport { legacyCC } from '../global-exports';\nimport { warnID } from '../platform/debug';\nimport { macro } from '../platform/macro';\nimport { sys } from '../platform/sys';\n\n/**\n * @en Image source in memory\n * @zh 内存图像源。\n */\nexport interface IMemoryImageSource {\n    _data: ArrayBufferView | null;\n    _compressed: boolean;\n    width: number;\n    height: number;\n    format: number;\n}\n\n/**\n * @en The image source, can be HTML canvas, image type or image in memory data\n * @zh 图像资源的原始图像源。可以来源于 HTML 元素也可以来源于内存。\n */\nexport type ImageSource = HTMLCanvasElement | HTMLImageElement | IMemoryImageSource | ImageBitmap;\n\nfunction isImageBitmap (imageSource: any): boolean {\n    return !!(sys.hasFeature(sys.Feature.IMAGE_BITMAP) && imageSource instanceof ImageBitmap);\n}\n\nfunction fetchImageSource (imageSource: ImageSource) {\n    return '_data' in imageSource ? imageSource._data : imageSource;\n}\n\n// 返回该图像源是否是平台提供的图像对象。\nfunction isNativeImage (imageSource: ImageSource): imageSource is (HTMLImageElement | HTMLCanvasElement | ImageBitmap) {\n    if (ALIPAY || XIAOMI || BAIDU) {\n        // We're unable to grab the constructors of Alipay native image or canvas object.\n        return !('_data' in imageSource);\n    }\n    if (JSB && (imageSource as IMemoryImageSource)._compressed === true) {\n        return false;\n    }\n\n    return imageSource instanceof HTMLImageElement || imageSource instanceof HTMLCanvasElement || isImageBitmap(imageSource);\n}\n\n/**\n * @en Image Asset.\n * @zh 图像资源。\n */\n@ccclass('cc.ImageAsset')\nexport class ImageAsset extends Asset {\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @override\n    get _nativeAsset () {\n        // Maybe returned to pool in webgl.\n        return this._nativeData;\n    }\n    set _nativeAsset (value: ImageSource) {\n        if (!(value instanceof HTMLElement) && !isImageBitmap(value)) {\n            // @ts-expect-error internal API usage\n            value.format = value.format || this._format;\n        }\n        this.reset(value);\n    }\n\n    /**\n     * @en Image data.\n     * @zh 此图像资源的图像数据。\n     */\n    get data () {\n        if (this._nativeData && isNativeImage(this._nativeData)) {\n            return this._nativeData;\n        }\n\n        return this._nativeData && this._nativeData._data;\n    }\n\n    /**\n     * @en The pixel width of the image.\n     * @zh 此图像资源的像素宽度。\n     */\n    get width () {\n        return this._nativeData.width || this._width;\n    }\n\n    /**\n     * @en The pixel height of the image.\n     * @zh 此图像资源的像素高度。\n     */\n    get height () {\n        return this._nativeData.height || this._height;\n    }\n\n    /**\n     * @en The pixel format of the image.\n     * @zh 此图像资源的像素格式。\n     */\n    get format () {\n        return this._format;\n    }\n\n    /**\n     * @en Whether the image is in compressed texture format.\n     * @zh 此图像资源是否为压缩像素格式。\n     */\n    get isCompressed () {\n        return (this._format >= PixelFormat.RGB_ETC1 && this._format <= PixelFormat.RGBA_ASTC_12x12)\n        || (this._format >= PixelFormat.RGB_A_PVRTC_2BPPV1 && this._format <= PixelFormat.RGBA_ETC1);\n    }\n\n    /**\n     * @en The original source image URL, it could be empty.\n     * @zh 此图像资源的原始图像源的 URL。当原始图像元不是 HTML 文件时可能为空。\n     * @deprecated Please use [[nativeUrl]]\n     */\n    get url () {\n        return this.nativeUrl;\n    }\n\n    private static extnames = ['.png', '.jpg', '.jpeg', '.bmp', '.webp', '.pvr', '.pkm', '.astc'];\n\n    private _nativeData: ImageSource;\n\n    private _exportedExts: string[] | null | undefined = undefined;\n\n    private _format: PixelFormat = PixelFormat.RGBA8888;\n\n    private _width = 0;\n\n    private _height = 0;\n\n    constructor (nativeAsset?: ImageSource) {\n        super();\n\n        this._nativeData = {\n            _data: null,\n            width: 0,\n            height: 0,\n            format: 0,\n            _compressed: false,\n        };\n\n        if (EDITOR) {\n            this._exportedExts = null;\n        }\n\n        if (nativeAsset !== undefined) {\n            this.reset(nativeAsset);\n        }\n    }\n\n    /**\n     * @en Reset the source of the image asset.\n     * @zh 重置此图像资源使用的原始图像源。\n     * @param data The new source\n     */\n    public reset (data: ImageSource) {\n        if (isImageBitmap(data)) {\n            this._nativeData = data;\n        } else if (!(data instanceof HTMLElement)) {\n            // this._nativeData = Object.create(data);\n            this._nativeData = data;\n            // @ts-expect-error internal api usage\n            this._format = data.format;\n        } else {\n            this._nativeData = data;\n        }\n    }\n\n    public destroy () {\n        if (this.data && this.data instanceof HTMLImageElement) {\n            this.data.src = '';\n            this._setRawAsset('');\n            // @ts-expect-error JSB element should destroy native data.\n            if (JSB) this.data.destroy();\n        } else if (isImageBitmap(this.data)) {\n            // @ts-expect-error internal api usage\n            this.data.close && this.data.close();\n        }\n        return super.destroy();\n    }\n\n    // SERIALIZATION\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    // eslint-disable-next-line consistent-return\n    public _serialize () {\n        if (EDITOR || TEST) {\n            let targetExtensions = this._exportedExts;\n            if (!targetExtensions && this._native) {\n                targetExtensions = [this._native];\n            }\n\n            if (!targetExtensions) {\n                return '';\n            }\n\n            const extensionIndices: string[] = [];\n            for (const targetExtension of targetExtensions) {\n                const extensionFormat = targetExtension.split('@');\n                const i = ImageAsset.extnames.indexOf(extensionFormat[0]);\n                let exportedExtensionID = i < 0 ? targetExtension : `${i}`;\n                if (extensionFormat[1]) {\n                    exportedExtensionID += `@${extensionFormat[1]}`;\n                }\n                extensionIndices.push(exportedExtensionID);\n            }\n            return { fmt: extensionIndices.join('_'), w: this.width, h: this.height };\n        }\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _deserialize (data: any) {\n        let fmtStr = '';\n        if (typeof data === 'string') {\n            fmtStr = data;\n        } else {\n            this._width = data.w;\n            this._height = data.h;\n            fmtStr = data.fmt;\n        }\n        const device = _getGlobalDevice();\n        const extensionIDs = fmtStr.split('_');\n\n        let preferedExtensionIndex = Number.MAX_VALUE;\n        let format = this._format;\n        let ext = '';\n        const SupportTextureFormats = macro.SUPPORT_TEXTURE_FORMATS;\n        for (const extensionID of extensionIDs) {\n            const extFormat = extensionID.split('@');\n\n            const i = parseInt(extFormat[0], undefined);\n            const tmpExt = ImageAsset.extnames[i] || extFormat[0];\n\n            const index = SupportTextureFormats.indexOf(tmpExt);\n            if (index !== -1 && index < preferedExtensionIndex) {\n                const fmt = extFormat[1] ? parseInt(extFormat[1]) : this._format;\n                // check whether or not support compressed texture\n                if (tmpExt === '.astc' && (!device || !(device.getFormatFeatures(Format.ASTC_RGBA_4X4) & FormatFeatureBit.SAMPLED_TEXTURE))) {\n                    continue;\n                } else if (tmpExt === '.pvr' && (!device || !(device.getFormatFeatures(Format.PVRTC_RGBA4) & FormatFeatureBit.SAMPLED_TEXTURE))) {\n                    continue;\n                } else if ((fmt === PixelFormat.RGB_ETC1 || fmt === PixelFormat.RGBA_ETC1)\n                    && (!device || !(device.getFormatFeatures(Format.ETC_RGB8) & FormatFeatureBit.SAMPLED_TEXTURE))) {\n                    continue;\n                } else if ((fmt === PixelFormat.RGB_ETC2 || fmt === PixelFormat.RGBA_ETC2)\n                    && (!device || !(device.getFormatFeatures(Format.ETC2_RGB8) & FormatFeatureBit.SAMPLED_TEXTURE))) {\n                    continue;\n                } else if (tmpExt === '.webp' && !sys.hasFeature(sys.Feature.WEBP)) {\n                    continue;\n                }\n                preferedExtensionIndex = index;\n                ext = tmpExt;\n                format = fmt;\n            }\n        }\n\n        if (ext) {\n            this._setRawAsset(ext);\n            this._format = format;\n        } else {\n            warnID(3121);\n        }\n    }\n\n    private static _sharedPlaceHolderCanvas: HTMLCanvasElement | null = null;\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        if (!ImageAsset._sharedPlaceHolderCanvas) {\n            const canvas = document.createElement('canvas');\n            const context = canvas.getContext('2d')!;\n            const l = canvas.width = canvas.height = 2;\n            context.fillStyle = '#ff00ff';\n            context.fillRect(0, 0, l, l);\n            this.reset(canvas);\n            ImageAsset._sharedPlaceHolderCanvas = canvas;\n        } else {\n            this.reset(ImageAsset._sharedPlaceHolderCanvas);\n        }\n    }\n\n    public validate () {\n        return !!this.data;\n    }\n}\n\nfunction _getGlobalDevice (): Device | null {\n    return deviceManager.gfxDevice;\n}\nlegacyCC.ImageAsset = ImageAsset;\n","import type { Asset } from '../assets/asset';\r\nimport type { IDependProp } from './deserialize';\r\n\r\nexport const dependMap: WeakMap<Asset, IDependProp[]> = new WeakMap();\r\n\r\nexport const nativeDependMap: WeakSet<Asset> = new WeakSet();\r\n\r\nexport const onLoadedInvokedMap: WeakSet<Asset> = new WeakSet();\r\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport MissingScript from '../components/missing-script';\nimport { deserialize, Details } from '../data/deserialize';\nimport { error } from '../platform/debug';\nimport { js } from '../utils/js';\nimport { dependMap, nativeDependMap } from './depend-maps';\nimport { decodeUuid } from './helper';\n\nconst missingClass = EDITOR && EditorExtends.MissingReporter.classInstance;\n\nexport interface IDependProp {\n    uuid: string;\n    owner: any;\n    prop: string;\n    type?: Constructor<Asset>;\n}\n\nexport default function deserializeAsset (json: Record<string, any>, options: Record<string, any> & {\n    __uuid__?: string;\n}): Asset {\n    let classFinder: deserialize.ClassFinder;\n    if (EDITOR) {\n        classFinder = (type, data, owner, propName): Constructor<unknown> => {\n            const res = missingClass.classFinder(type, data, owner, propName);\n            if (res) {\n                return res as Constructor<unknown>;\n            }\n            return MissingScript;\n        };\n        classFinder.onDereferenced = missingClass.classFinder.onDereferenced;\n    } else {\n        classFinder = MissingScript.safeFindClass;\n    }\n\n    const tdInfo = Details.pool.get() as Details;\n\n    let asset: Asset;\n    try {\n        asset = deserialize(json, tdInfo, {\n            classFinder,\n            customEnv: options,\n        }) as Asset;\n    } catch (e) {\n        error(e);\n        Details.pool.put(tdInfo);\n        throw e;\n    }\n\n    asset._uuid = options.__uuid__ || '';\n\n    if (EDITOR) {\n        missingClass.reportMissingClass(asset);\n        missingClass.reset();\n    }\n\n    const uuidList = tdInfo.uuidList! as string[];\n    const objList = tdInfo.uuidObjList!;\n    const propList = tdInfo.uuidPropList! as string[];\n    const typeList = (tdInfo.uuidTypeList || []);\n    const depends: IDependProp[] = [];\n\n    for (let i = 0; i < uuidList.length; i++) {\n        const dependUuid = uuidList[i];\n        depends[i] = {\n            uuid: decodeUuid(dependUuid),\n            owner: objList[i],\n            prop: propList[i],\n            type: js.getClassById(typeList[i]) as Constructor<Asset>,\n        };\n    }\n\n    // non-native deps\n    dependMap.set(asset, depends);\n    // native dep\n    if (asset._native) {\n        nativeDependMap.add(asset);\n    }\n    Details.pool.put(tdInfo);\n    return asset;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { BUILD, DEV, EDITOR } from 'internal:constants';\nimport { Asset } from '..';\nimport { hasNativeDep, isCompiledJson, parseUuidDependencies } from '../data/deserialize';\nimport Cache from './cache';\nimport deserialize, { IDependProp } from './deserialize';\nimport { decodeUuid } from './helper';\nimport { files, parsed } from './shared';\nimport { dependMap, nativeDependMap } from './depend-maps';\nimport { assertIsNonNullable } from '../data/utils/asserts';\nimport { CCON } from '../data/ccon';\n\nexport interface IDependencies {\n    nativeDep?: Record<string, any>;\n    deps: string[];\n    parsedFromExistAsset?: boolean;\n    persistDeps?: string[];\n}\n\n/**\n * @en\n * Control asset's dependency list, it is a singleton. All member can be accessed with `assetManager.dependUtil`\n *\n * @zh\n * 控制资源的依赖列表，这是一个单例, 所有成员能通过 `assetManager.dependUtil` 访问\n *\n */\nexport class DependUtil {\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _depends: Cache<IDependencies> = new Cache<IDependencies>();\n\n    public init (): void {\n        this._depends.clear();\n    }\n\n    /**\n     * @en\n     * Get asset's native dependency. For example, Texture's native dependency is image.\n     *\n     * @zh\n     * 获取资源的原生依赖，例如 Texture 的原生依赖是图片\n     *\n     * @param uuid - asset's uuid\n     * @returns native dependency\n     *\n     * @example\n     * var dep = dependUtil.getNativeDep('fcmR3XADNLgJ1ByKhqcC5Z');\n     */\n    public getNativeDep (uuid: string): Record<string, any> | null {\n        const depend = this._depends.get(uuid);\n        if (depend && depend.nativeDep) {\n            return { ...depend.nativeDep };\n        }\n        return null;\n    }\n\n    /**\n     * @en\n     * Get asset's direct referencing non-native dependency list. For example, Material's non-native dependencies are Texture.\n     *\n     * @zh\n     * 获取资源直接引用的非原生依赖列表，例如，材质的非原生依赖是 Texture\n     *\n     * @param uuid - asset's uuid\n     * @returns direct referencing non-native dependency list\n     *\n     * @example\n     * var deps = dependUtil.getDeps('fcmR3XADNLgJ1ByKhqcC5Z');\n     *\n     */\n    public getDeps (uuid: string): string[] {\n        if (this._depends.has(uuid)) {\n            return this._depends.get(uuid)!.deps;\n        }\n        return [];\n    }\n\n    /**\n     * @en\n     * Get non-native dependency list of the loaded asset, include indirect reference.\n     * The returned array stores the dependencies with their uuid, after retrieve dependencies,\n     *\n     * @zh\n     * 获取某个已经加载好的资源的所有非原生依赖资源列表，包括间接引用的资源，并保存在数组中返回。\n     * 返回的数组将仅保存依赖资源的 uuid。\n     *\n     * @param uuid - The asset's uuid\n     * @returns non-native dependency list\n     *\n     * @example\n     * var deps = dependUtil.getDepsRecursively('fcmR3XADNLgJ1ByKhqcC5Z');\n     *\n     */\n    public getDepsRecursively (uuid: string): string[] {\n        const exclude = Object.create(null);\n        const depends = [];\n        this._descend(uuid, exclude, depends);\n        return depends;\n    }\n\n    public remove (uuid: string) {\n        this._depends.remove(uuid);\n    }\n\n    /**\n     * @en\n     * Extract dependency list from serialized data or asset and then store in cache.\n     *\n     * @zh\n     * 从序列化数据或资源中提取出依赖列表，并且存储在缓存中。\n     *\n     * @param uuid - The uuid of serialized data or asset\n     * @param json - Serialized data or asset\n     * @returns dependency list, include non-native and native dependency\n     *\n     * @example\n     * downloader.downloadFile('test.json', { xhrResponseType: 'json'}, null, (err, file) => {\n     *     var dependencies = parse('fcmR3XADNLgJ1ByKhqcC5Z', file);\n     * });\n     *\n     */\n    public parse (uuid: string, json: any): IDependencies {\n        let out: IDependencies | null = null;\n        if (Array.isArray(json) || json.__type__ || json instanceof CCON) {\n            if (this._depends.has(uuid)) {\n                return this._depends.get(uuid)!;\n            }\n\n            // @ts-expect-error unknown json\n            if (Array.isArray(json) && (!(BUILD || isCompiledJson(json)) || !hasNativeDep(json))) {\n                out = {\n                    deps: this._parseDepsFromJson(json),\n                };\n            } else {\n                try {\n                    const asset = deserialize(json, { __uuid__: uuid });\n                    out = this._parseDepsFromAsset(asset);\n                    if (out.nativeDep) {\n                        out.nativeDep.uuid = uuid;\n                    }\n                    parsed.add(`${uuid}@import`, asset);\n                } catch (e) {\n                    files.remove(`${uuid}@import`);\n                    out = { deps: [] };\n                }\n            }\n        } else { // get deps from an existing asset\n            if (!EDITOR && this._depends.has(uuid)) {\n                out = this._depends.get(uuid)!;\n                if (out.parsedFromExistAsset) {\n                    return out;\n                }\n            }\n            out = this._parseDepsFromAsset(json);\n        }\n        // cache dependency list\n        this._depends.add(uuid, out);\n        return out;\n    }\n\n    private _parseDepsFromAsset (asset: Asset): IDependencies {\n        const out: IDependencies = {\n            deps: [],\n            parsedFromExistAsset: true,\n        };\n\n        const deps = dependMap.get(asset);\n        assertIsNonNullable(deps);\n        for (let i = 0, l = deps.length; i < l; i++) {\n            out.deps.push(deps[i].uuid);\n        }\n\n        if (nativeDependMap.has(asset)) {\n            out.nativeDep = asset._nativeDep;\n        }\n\n        return out;\n    }\n\n    private _parseDepsFromJson (json: any[]): string[] {\n        const depends = parseUuidDependencies(json);\n        depends.forEach((uuid, index) => depends[index] = decodeUuid(uuid));\n        return depends;\n    }\n\n    private _descend (uuid: string, exclude: Record<string, any>, depends: string[]): void {\n        const deps = this.getDeps(uuid);\n        for (let i = 0; i < deps.length; i++) {\n            const depend = deps[i];\n            if (!exclude[depend]) {\n                exclude[depend] = true;\n                depends.push(depend);\n                this._descend(depend, exclude, depends);\n            }\n        }\n    }\n}\n\nexport default new DependUtil();\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass } from 'cc.decorator';\nimport { DEV } from 'internal:constants';\nimport { TextureFlagBit, TextureUsageBit, API, Texture, TextureInfo, TextureViewInfo, Device, BufferTextureCopy } from '../gfx';\nimport { assertID, error } from '../platform/debug';\nimport { Filter } from './asset-enum';\nimport { ImageAsset } from './image-asset';\nimport { TextureBase } from './texture-base';\nimport { legacyCC } from '../global-exports';\nimport { macro } from '../platform/macro';\nimport dependUtil from '../asset-manager/depend-util';\nimport { fastRemoveAt } from '../utils/array';\n\nconst _regions: BufferTextureCopy[] = [new BufferTextureCopy()];\n\nexport type PresumedGFXTextureInfo = Pick<TextureInfo, 'usage' | 'flags' | 'format' | 'levelCount'>;\nexport type PresumedGFXTextureViewInfo = Pick<TextureViewInfo, 'texture' | 'format' | 'baseLevel' | 'levelCount'>;\n\nfunction getMipLevel (width: number, height: number) {\n    let size = Math.max(width, height);\n    let level = 0;\n    while (size) { size >>= 1; level++; }\n    return level;\n}\n\nfunction isPOT (n: number) { return n && (n & (n - 1)) === 0; }\nfunction canGenerateMipmap (device: Device, w: number, h: number) {\n    const needCheckPOT = device.gfxAPI === API.WEBGL;\n    if (needCheckPOT) { return isPOT(w) && isPOT(h); }\n    return true;\n}\n\n/**\n * @en The simple texture base class.\n * It create the GFX Texture and can set mipmap levels.\n * @zh 简单贴图基类。\n * 简单贴图内部创建了 GFX 贴图和该贴图上的 GFX 贴图视图。\n * 简单贴图允许指定不同的 Mipmap 层级。\n */\n@ccclass('cc.SimpleTexture')\nexport class SimpleTexture extends TextureBase {\n    protected _gfxTexture: Texture | null = null;\n    protected _gfxTextureView: Texture | null = null;\n    private _mipmapLevel = 1;\n    // Cache these data to reduce JSB invoking.\n    private _textureWidth = 0;\n    private _textureHeight = 0;\n\n    protected _baseLevel = 0;\n    protected _maxLevel = 1000;\n\n    /**\n     * @en The mipmap level of the texture\n     * @zh 贴图中的 Mipmap 层级数量\n     */\n    get mipmapLevel () {\n        return this._mipmapLevel;\n    }\n\n    /**\n     * @en The GFX Texture resource\n     * @zh 获取此贴图底层的 GFX 贴图对象。\n     */\n    public getGFXTexture () {\n        return this._gfxTextureView;\n    }\n\n    public destroy () {\n        this._tryDestroyTextureView();\n        this._tryDestroyTexture();\n        return super.destroy();\n    }\n\n    /**\n     * @en Update the level 0 mipmap image.\n     * @zh 更新 0 级 Mipmap。\n     */\n    public updateImage () {\n        this.updateMipmaps(0);\n    }\n\n    /**\n     * @en Update the given level mipmap image.\n     * @zh 更新指定层级范围内的 Mipmap。当 Mipmap 数据发生了改变时应调用此方法提交更改。\n     * 若指定的层级范围超出了实际已有的层级范围，只有覆盖的那些层级范围会被更新。\n     * @param firstLevel First level to be updated\n     * @param count Mipmap level count to be updated\n     */\n    public updateMipmaps (firstLevel = 0, count?: number) {\n\n    }\n\n    /**\n     * @en Upload data to the given mipmap level.\n     * The size of the image will affect how the mipmap is updated.\n     * - When the image is an ArrayBuffer, the size of the image must match the mipmap size.\n     * - If the image size matches the mipmap size, the mipmap data will be updated entirely.\n     * - If the image size is smaller than the mipmap size, the mipmap will be updated from top left corner.\n     * - If the image size is larger, an error will be raised\n     * @zh 上传图像数据到指定层级的 Mipmap 中。\n     * 图像的尺寸影响 Mipmap 的更新范围：\n     * - 当图像是 `ArrayBuffer` 时，图像的尺寸必须和 Mipmap 的尺寸一致；否则，\n     * - 若图像的尺寸与 Mipmap 的尺寸相同，上传后整个 Mipmap 的数据将与图像数据一致；\n     * - 若图像的尺寸小于指定层级 Mipmap 的尺寸（不管是长或宽），则从贴图左上角开始，图像尺寸范围内的 Mipmap 会被更新；\n     * - 若图像的尺寸超出了指定层级 Mipmap 的尺寸（不管是长或宽），都将引起错误。\n     * @param source The source image or image data\n     * @param level Mipmap level to upload the image to\n     * @param arrayIndex The array index\n     */\n    public uploadData (source: HTMLCanvasElement | HTMLImageElement | ArrayBufferView | ImageBitmap, level = 0, arrayIndex = 0) {\n        if (!this._gfxTexture || this._mipmapLevel <= level) {\n            return;\n        }\n\n        const gfxDevice = this._getGFXDevice();\n        if (!gfxDevice) {\n            return;\n        }\n\n        const region = _regions[0];\n        region.texExtent.width = this._textureWidth >> level;\n        region.texExtent.height = this._textureHeight >> level;\n        region.texSubres.mipLevel = level;\n        region.texSubres.baseArrayLayer = arrayIndex;\n\n        if (DEV) {\n            if (source instanceof HTMLElement) {\n                if (source.height > region.texExtent.height\n                    || source.width > region.texExtent.width) {\n                    error(`Image source(${this.name}) bounds override.`);\n                }\n            }\n        }\n\n        if (ArrayBuffer.isView(source)) {\n            gfxDevice.copyBuffersToTexture([source], this._gfxTexture, _regions);\n        } else {\n            gfxDevice.copyTexImagesToTexture([source], this._gfxTexture, _regions);\n        }\n    }\n\n    protected _assignImage (image: ImageAsset, level: number, arrayIndex?: number) {\n        const data = image.data;\n        if (!data) {\n            return;\n        }\n        this.uploadData(data, level, arrayIndex);\n        this._checkTextureLoaded();\n\n        if (macro.CLEANUP_IMAGE_CACHE) {\n            const deps = dependUtil.getDeps(this._uuid);\n            const index = deps.indexOf(image._uuid);\n            if (index !== -1) {\n                fastRemoveAt(deps, index);\n                image.decRef();\n            }\n        }\n    }\n\n    protected _checkTextureLoaded () {\n        this._textureReady();\n    }\n\n    protected _textureReady () {\n        this.loaded = true;\n        this.emit('load');\n    }\n\n    /**\n     * @en\n     * Set mipmap level of this texture.\n     * The value is passes as presumed info to `this._getGfxTextureCreateInfo()`.\n     * @zh\n     * 设置此贴图的 mipmap 层级\n     * @param value The mipmap level.\n     */\n    protected _setMipmapLevel (value: number) {\n        this._mipmapLevel = value < 1 ? 1 : value;\n    }\n\n    protected _setMipRange (baseLevel: number, maxLevel: number) {\n        this._baseLevel = baseLevel < 1 ? 0 : baseLevel;\n        this._maxLevel = maxLevel < 1 ? 0 : maxLevel;\n    }\n\n    /**\n     * @en Set mipmap level range for this texture.\n     * @zh 设置当前贴图的 mipmap 范围。\n     * @param baseLevel The base mipmap level.\n     * @param maxLevel The maximum mipmap level.\n     */\n    public setMipRange (baseLevel: number, maxLevel: number) {\n        assertID(baseLevel <= maxLevel, 3124);\n\n        this._setMipRange(baseLevel, maxLevel);\n\n        const device = this._getGFXDevice();\n        if (!device) {\n            return;\n        }\n        // create a new texture view before the destruction of the previous one to bypass the bug that\n        // vulkan destroys textureview in use. This is a temporary solution, should be fixed later.\n        const textureView = this._createTextureView(device);\n        this._tryDestroyTextureView();\n        this._gfxTextureView = textureView;\n    }\n\n    /**\n     * @en This method is override by derived classes to provide GFX texture info.\n     * @zh 这个方法被派生类重写以提供 GFX 纹理信息。\n     * @param presumed The presumed GFX texture info.\n     */\n    protected _getGfxTextureCreateInfo (presumed: PresumedGFXTextureInfo): TextureInfo | null {\n        return null;\n    }\n\n    /**\n     * @en This method is overrided by derived classes to provide GFX TextureViewInfo.\n     * @zh 这个方法被派生类重写以提供 GFX 纹理视图信息。\n     * @param presumed The presumed GFX TextureViewInfo.\n     */\n    protected _getGfxTextureViewCreateInfo (presumed: PresumedGFXTextureViewInfo): TextureViewInfo | null {\n        return null;\n    }\n\n    protected _tryReset () {\n        this._tryDestroyTextureView();\n        this._tryDestroyTexture();\n        if (this._mipmapLevel === 0) {\n            return;\n        }\n        const device = this._getGFXDevice();\n        if (!device) {\n            return;\n        }\n        this._createTexture(device);\n        this._gfxTextureView = this._createTextureView(device);\n    }\n\n    /**\n     * @en Whether mipmaps are baked convolutional maps.\n     * @zh mipmaps是否为烘焙出来的卷积图。\n     */\n    public isUsingOfflineMipmaps (): boolean {\n        return false;\n    }\n\n    protected _createTexture (device: Device) {\n        if (this._width === 0 || this._height === 0) { return; }\n        let flags = TextureFlagBit.NONE;\n        if (this._mipFilter !== Filter.NONE && canGenerateMipmap(device, this._width, this._height)) {\n            this._mipmapLevel = getMipLevel(this._width, this._height);\n            if (!this.isUsingOfflineMipmaps()) {\n                flags = TextureFlagBit.GEN_MIPMAP;\n            }\n        }\n        const textureCreateInfo = this._getGfxTextureCreateInfo({\n            usage: TextureUsageBit.SAMPLED | TextureUsageBit.TRANSFER_DST,\n            format: this._getGFXFormat(),\n            levelCount: this._mipmapLevel,\n            flags,\n        });\n        if (!textureCreateInfo) {\n            return;\n        }\n\n        const texture = device.createTexture(textureCreateInfo);\n        this._textureWidth = textureCreateInfo.width;\n        this._textureHeight = textureCreateInfo.height;\n\n        this._gfxTexture = texture;\n    }\n\n    protected _createTextureView (device: Device): Texture | null {\n        if (!this._gfxTexture) {\n            return null;\n        }\n        const maxLevel = this._maxLevel < this._mipmapLevel ? this._maxLevel : this._mipmapLevel - 1;\n        const textureViewCreateInfo = this._getGfxTextureViewCreateInfo({\n            texture: this._gfxTexture,\n            format: this._getGFXFormat(),\n            baseLevel: this._baseLevel,\n            levelCount: maxLevel - this._baseLevel + 1,\n        });\n        if (!textureViewCreateInfo) {\n            return null;\n        }\n\n        return device.createTexture(textureViewCreateInfo);\n    }\n\n    protected _tryDestroyTexture () {\n        if (this._gfxTexture) {\n            this._gfxTexture.destroy();\n            this._gfxTexture = null;\n        }\n    }\n\n    protected _tryDestroyTextureView () {\n        if (this._gfxTextureView) {\n            this._gfxTextureView.destroy();\n            this._gfxTextureView = null;\n        }\n    }\n}\n\nlegacyCC.SimpleTexture = SimpleTexture;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, TEST } from 'internal:constants';\nimport { ccclass, serializable } from 'cc.decorator';\nimport { TextureType, TextureInfo, TextureViewInfo } from '../gfx';\nimport { ImageAsset } from './image-asset';\nimport { PresumedGFXTextureInfo, PresumedGFXTextureViewInfo, SimpleTexture } from './simple-texture';\nimport { ITexture2DCreateInfo, Texture2D } from './texture-2d';\nimport { legacyCC } from '../global-exports';\nimport { js } from '../utils/js';\n\nexport type ITextureCubeCreateInfo = ITexture2DCreateInfo;\n/**\n * @en The MipmapAtlas region interface\n * @zh MipmapAtlas的region接口。\n */\ninterface IMipmapAtlasLayout {\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n    level: number;\n}\n/**\n * @en The texture cube MipmapAtlas interface\n * @zh 立方体贴图的 MipmapAtlas 接口。\n */\ninterface ITextureCubeMipmapAtlas {\n    atlas: ITextureCubeMipmap;\n    layout: IMipmapAtlasLayout[];\n}\n\n/**\n * @en The texture cube mipmap interface\n * @zh 立方体贴图的 Mipmap 接口。\n */\ninterface ITextureCubeMipmap {\n    front: ImageAsset;\n    back: ImageAsset;\n    left: ImageAsset;\n    right: ImageAsset;\n    top: ImageAsset;\n    bottom: ImageAsset;\n}\n\n/**\n * @en The index for all faces of the cube\n * @zh 立方体每个面的约定索引。\n */\nenum FaceIndex {\n    right = 0,\n    left = 1,\n    top = 2,\n    bottom = 3,\n    front = 4,\n    back = 5,\n}\n/**\n * @en The way to fill mipmaps.\n * @zh 填充mipmaps的方式。\n */\nexport enum MipmapMode {\n    /**\n     * @zh\n     * 不使用mipmaps\n     * @en\n     * Not using mipmaps\n     * @readonly\n     */\n    NONE = 0,\n    /**\n     * @zh\n     * 使用自动生成的mipmaps\n     * @en\n     * Using the automatically generated mipmaps\n     * @readonly\n     */\n    AUTO = 1,\n    /**\n     * @zh\n     * 使用卷积图填充mipmaps\n     * @en\n     * Filling mipmaps with convolutional maps\n     * @readonly\n     */\n    BAKED_CONVOLUTION_MAP = 2,\n}\n\n/**\n * @en The texture cube asset.\n * Each mipmap level of a texture cube have 6 [[ImageAsset]], represents 6 faces of the cube.\n * @zh 立方体贴图资源。\n * 立方体贴图资源的每个 Mipmap 层级都为 6 张 [[ImageAsset]]，分别代表了立方体贴图的 6 个面。\n */\n@ccclass('cc.TextureCube')\nexport class TextureCube extends SimpleTexture {\n    public static FaceIndex = FaceIndex;\n\n    @serializable\n    isRGBE = false;\n\n    @serializable\n    _mipmapAtlas: ITextureCubeMipmapAtlas | null = null;\n\n    @serializable\n    _mipmapMode = MipmapMode.NONE;\n\n    /**\n     * @en All levels of mipmap images, be noted, automatically generated mipmaps are not included.\n     * When setup mipmap, the size of the texture and pixel format could be modified.\n     * @zh 所有层级 Mipmap，注意，这里不包含自动生成的 Mipmap。\n     * 当设置 Mipmap 时，贴图的尺寸以及像素格式可能会改变。\n     */\n    get mipmaps () {\n        return this._mipmaps;\n    }\n\n    set mipmaps (value) {\n        this._mipmaps = value;\n        this._setMipmapLevel(this._mipmaps.length);\n        if (this._mipmaps.length > 0) {\n            const imageAsset: ImageAsset = this._mipmaps[0].front;\n            this.reset({\n                width: imageAsset.width,\n                height: imageAsset.height,\n                format: imageAsset.format,\n                mipmapLevel: this._mipmaps.length,\n                baseLevel: this._baseLevel,\n                maxLevel: this._maxLevel,\n            });\n            this._mipmaps.forEach((mipmap, level) => {\n                _forEachFace(mipmap, (face, faceIndex) => {\n                    this._assignImage(face, level, faceIndex);\n                });\n            });\n        } else {\n            this.reset({\n                width: 0,\n                height: 0,\n                mipmapLevel: this._mipmaps.length,\n                baseLevel: this._baseLevel,\n                maxLevel: this._maxLevel,\n            });\n        }\n    }\n\n    /**\n     * @en Fill mipmaps with convolutional maps.\n     * @zh 使用卷积图填充mipmaps。\n     * @param value All mipmaps of each face of the cube map are stored in the form of atlas\n     * and the value contains the atlas of the 6 faces and the layout information of each mipmap layer.\n     */\n    set mipmapAtlas (value: ITextureCubeMipmapAtlas | null) {\n        this._mipmapAtlas = value;\n        if (!this._mipmapAtlas) {\n            this.reset({\n                width: 0,\n                height: 0,\n                mipmapLevel: 0,\n            });\n            return;\n        }\n        const imageAtlasAsset: ImageAsset = this._mipmapAtlas.atlas.front;\n        if (!imageAtlasAsset.data) {\n            return;\n        }\n        const faceAtlas = this._mipmapAtlas.atlas;\n        const layout = this._mipmapAtlas.layout;\n        const mip0Layout = layout[0];\n\n        const ctx = Object.assign(document.createElement('canvas'), {\n            width: imageAtlasAsset.width,\n            height: imageAtlasAsset.height,\n        }).getContext('2d');\n\n        this.reset({\n            width: mip0Layout.width,\n            height: mip0Layout.height,\n            format: imageAtlasAsset.format,\n            mipmapLevel: layout.length,\n        });\n\n        for (let j = 0; j < layout.length; j++) {\n            const layoutInfo = layout[j];\n            _forEachFace(faceAtlas, (face, faceIndex) => {\n                ctx!.clearRect(0, 0, imageAtlasAsset.width, imageAtlasAsset.height);\n                const drawImg = face.data as HTMLImageElement;\n                ctx!.drawImage(drawImg, 0, 0);\n                const rawData = ctx!.getImageData(layoutInfo.left, layoutInfo.top, layoutInfo.width, layoutInfo.height);\n\n                const bufferAsset = new ImageAsset({\n                    _data: rawData.data,\n                    _compressed: face.isCompressed,\n                    width: rawData.width,\n                    height: rawData.height,\n                    format: face.format,\n                });\n                this._assignImage(bufferAsset, layoutInfo.level, faceIndex);\n            });\n        }\n    }\n\n    get mipmapAtlas () {\n        return this._mipmapAtlas;\n    }\n\n    /**\n     * @en Whether mipmaps are baked convolutional maps.\n     * @zh mipmaps是否为烘焙出来的卷积图。\n     */\n    public isUsingOfflineMipmaps (): boolean {\n        return this._mipmapMode === MipmapMode.BAKED_CONVOLUTION_MAP;\n    }\n\n    /**\n     * @en Level 0 mipmap image.\n     * Be noted, `this.image = img` equals `this.mipmaps = [img]`,\n     * sets image will clear all previous mipmaps.\n     * @zh 0 级 Mipmap。\n     * 注意，`this.image = img` 等价于 `this.mipmaps = [img]`，\n     * 也就是说，通过 `this.image` 设置 0 级 Mipmap 时将隐式地清除之前的所有 Mipmap。\n     */\n    get image () {\n        return this._mipmaps.length === 0 ? null : this._mipmaps[0];\n    }\n\n    set image (value) {\n        this.mipmaps = value ? [value] : [];\n    }\n\n    /**\n     * @en Create a texture cube with an array of [[Texture2D]] which represents 6 faces of the texture cube.\n     * @zh 通过二维贴图数组指定每个 Mipmap 的每个面创建立方体贴图。\n     * @param textures Texture array, the texture count must be multiple of 6. Every 6 textures are 6 faces of a mipmap level.\n     * The order should obey [[FaceIndex]] order.\n     * @param out Output texture cube, if not given, will create a new texture cube.\n     * @returns The created texture cube.\n     * @example\n     * ```ts\n     * const textures = new Array<Texture2D>(6);\n     * textures[TextureCube.FaceIndex.front] = frontImage;\n     * textures[TextureCube.FaceIndex.back] = backImage;\n     * textures[TextureCube.FaceIndex.left] = leftImage;\n     * textures[TextureCube.FaceIndex.right] = rightImage;\n     * textures[TextureCube.FaceIndex.top] = topImage;\n     * textures[TextureCube.FaceIndex.bottom] = bottomImage;\n     * const textureCube = TextureCube.fromTexture2DArray(textures);\n     * ```\n     */\n\n    public static fromTexture2DArray (textures: Texture2D[], out?: TextureCube) {\n        const mipmaps: ITextureCubeMipmap[] = [];\n        const nMipmaps = textures.length / 6;\n        for (let i = 0; i < nMipmaps; i++) {\n            const x = i * 6;\n            mipmaps.push({\n                front: textures[x + FaceIndex.front].image!,\n                back: textures[x + FaceIndex.back].image!,\n                left: textures[x + FaceIndex.left].image!,\n                right: textures[x + FaceIndex.right].image!,\n                top: textures[x + FaceIndex.top].image!,\n                bottom: textures[x + FaceIndex.bottom].image!,\n            });\n        }\n        out = out || new TextureCube();\n        out.mipmaps = mipmaps;\n        return out;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    public _mipmaps: ITextureCubeMipmap[] = [];\n\n    public onLoaded () {\n        if (this._mipmapMode === MipmapMode.BAKED_CONVOLUTION_MAP) {\n            this.mipmapAtlas = this._mipmapAtlas;\n        } else {\n            this.mipmaps = this._mipmaps;\n        }\n    }\n\n    /**\n     * @en Reset the current texture with given size, pixel format and mipmap images.\n     * After reset, the gfx resource will become invalid, you must use [[uploadData]] explicitly to upload the new mipmaps to GPU resources.\n     * @zh 将当前贴图重置为指定尺寸、像素格式以及指定 mipmap 层级。重置后，贴图的像素数据将变为未定义。\n     * mipmap 图像的数据不会自动更新到贴图中，你必须显式调用 [[uploadData]] 来上传贴图数据。\n     * @param info The create information\n     */\n    public reset (info: ITextureCubeCreateInfo) {\n        this._width = info.width;\n        this._height = info.height;\n        this._setGFXFormat(info.format);\n        const mipLevels = info.mipmapLevel === undefined ? 1 : info.mipmapLevel;\n        this._setMipmapLevel(mipLevels);\n        const minLod = info.baseLevel === undefined ? 0 : info.baseLevel;\n        const maxLod = info.maxLevel === undefined ? 1000 : info.maxLevel;\n        this._setMipRange(minLod, maxLod);\n        this._tryReset();\n    }\n\n    public updateMipmaps (firstLevel = 0, count?: number) {\n        if (firstLevel >= this._mipmaps.length) {\n            return;\n        }\n\n        const nUpdate = Math.min(\n            count === undefined ? this._mipmaps.length : count,\n            this._mipmaps.length - firstLevel,\n        );\n\n        for (let i = 0; i < nUpdate; ++i) {\n            const level = firstLevel + i;\n            _forEachFace(this._mipmaps[level], (face, faceIndex) => {\n                this._assignImage(face, level, faceIndex);\n            });\n        }\n    }\n\n    /**\n     * @en Destroy this texture, clear all mipmaps and release GPU resources\n     * @zh 销毁此贴图，清空所有 Mipmap 并释放占用的 GPU 资源。\n     */\n    public destroy () {\n        this._mipmaps = [];\n        this._mipmapAtlas = null;\n        return super.destroy();\n    }\n\n    /**\n     * @en Release used GPU resources.\n     * @zh 释放占用的 GPU 资源。\n     * @deprecated please use [[destroy]] instead\n     */\n    public releaseTexture () {\n        this.mipmaps = [];\n        this._mipmapAtlas = null;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _serialize (ctxForExporting: any): Record<string, unknown> | null {\n        if (EDITOR || TEST) {\n            if (this._mipmapMode === MipmapMode.BAKED_CONVOLUTION_MAP) {\n                const atlas = this._mipmapAtlas!.atlas;\n                let uuids = {};\n                if (ctxForExporting && ctxForExporting._compressUuid) {\n                    uuids = {\n                        front: EditorExtends.UuidUtils.compressUuid(atlas.front._uuid, true),\n                        back: EditorExtends.UuidUtils.compressUuid(atlas.back._uuid, true),\n                        left: EditorExtends.UuidUtils.compressUuid(atlas.left._uuid, true),\n                        right: EditorExtends.UuidUtils.compressUuid(atlas.right._uuid, true),\n                        top: EditorExtends.UuidUtils.compressUuid(atlas.top._uuid, true),\n                        bottom: EditorExtends.UuidUtils.compressUuid(atlas.bottom._uuid, true),\n                    };\n                } else {\n                    uuids = {\n                        front: atlas.front._uuid,\n                        back: atlas.back._uuid,\n                        left: atlas.left._uuid,\n                        right: atlas.right._uuid,\n                        top: atlas.top._uuid,\n                        bottom: atlas.bottom._uuid,\n                    };\n                }\n                return {\n                    base: super._serialize(ctxForExporting),\n                    rgbe: this.isRGBE,\n                    mipmapMode: this._mipmapMode,\n                    mipmapAtlas: uuids,\n                    mipmapLayout: this._mipmapAtlas!.layout,\n                };\n            } else {\n                return {\n                    base: super._serialize(ctxForExporting),\n                    rgbe: this.isRGBE,\n                    mipmaps: this._mipmaps.map((mipmap) => ((ctxForExporting && ctxForExporting._compressUuid) ? {\n                        front: EditorExtends.UuidUtils.compressUuid(mipmap.front._uuid, true),\n                        back: EditorExtends.UuidUtils.compressUuid(mipmap.back._uuid, true),\n                        left: EditorExtends.UuidUtils.compressUuid(mipmap.left._uuid, true),\n                        right: EditorExtends.UuidUtils.compressUuid(mipmap.right._uuid, true),\n                        top: EditorExtends.UuidUtils.compressUuid(mipmap.top._uuid, true),\n                        bottom: EditorExtends.UuidUtils.compressUuid(mipmap.bottom._uuid, true),\n                    } : {\n                        front: mipmap.front._uuid,\n                        back: mipmap.back._uuid,\n                        left: mipmap.left._uuid,\n                        right: mipmap.right._uuid,\n                        top: mipmap.top._uuid,\n                        bottom: mipmap.bottom._uuid,\n                    })),\n                };\n            }\n        }\n        return null;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _deserialize (serializedData: ITextureCubeSerializeData, handle: any) {\n        const data = serializedData;\n        super._deserialize(data.base, handle);\n        this.isRGBE = data.rgbe;\n        this._mipmapMode = data.mipmapMode;\n        if (this._mipmapMode === MipmapMode.BAKED_CONVOLUTION_MAP) {\n            const mipmapAtlas = data.mipmapAtlas;\n            const mipmapLayout = data.mipmapLayout;\n            this._mipmapAtlas = {\n                atlas: {} as ITextureCubeMipmap,\n                layout: mipmapLayout,\n            };\n            this._mipmapAtlas.atlas = {\n                front: new ImageAsset(),\n                back: new ImageAsset(),\n                left: new ImageAsset(),\n                right: new ImageAsset(),\n                top: new ImageAsset(),\n                bottom: new ImageAsset(),\n            };\n            const imageAssetClassId = js.getClassId(ImageAsset);\n            handle.result.push(this._mipmapAtlas.atlas, `front`, mipmapAtlas.front, imageAssetClassId);\n            handle.result.push(this._mipmapAtlas.atlas, `back`, mipmapAtlas.back, imageAssetClassId);\n            handle.result.push(this._mipmapAtlas.atlas, `left`, mipmapAtlas.left, imageAssetClassId);\n            handle.result.push(this._mipmapAtlas.atlas, `right`, mipmapAtlas.right, imageAssetClassId);\n            handle.result.push(this._mipmapAtlas.atlas, `top`, mipmapAtlas.top, imageAssetClassId);\n            handle.result.push(this._mipmapAtlas.atlas, `bottom`, mipmapAtlas.bottom, imageAssetClassId);\n        } else {\n            this._mipmaps = new Array(data.mipmaps.length);\n            for (let i = 0; i < data.mipmaps.length; ++i) {\n                // Prevent resource load failed\n                this._mipmaps[i] = {\n                    front: new ImageAsset(),\n                    back: new ImageAsset(),\n                    left: new ImageAsset(),\n                    right: new ImageAsset(),\n                    top: new ImageAsset(),\n                    bottom: new ImageAsset(),\n                };\n                const mipmap = data.mipmaps[i];\n                const imageAssetClassId = js.getClassId(ImageAsset);\n                handle.result.push(this._mipmaps[i], `front`, mipmap.front, imageAssetClassId);\n                handle.result.push(this._mipmaps[i], `back`, mipmap.back, imageAssetClassId);\n                handle.result.push(this._mipmaps[i], `left`, mipmap.left, imageAssetClassId);\n                handle.result.push(this._mipmaps[i], `right`, mipmap.right, imageAssetClassId);\n                handle.result.push(this._mipmaps[i], `top`, mipmap.top, imageAssetClassId);\n                handle.result.push(this._mipmaps[i], `bottom`, mipmap.bottom, imageAssetClassId);\n            }\n        }\n    }\n\n    protected _getGfxTextureCreateInfo (presumed: PresumedGFXTextureInfo): TextureInfo {\n        const texInfo = new TextureInfo(TextureType.CUBE);\n        texInfo.width = this._width;\n        texInfo.height = this._height;\n        texInfo.layerCount = 6;\n        Object.assign(texInfo, presumed);\n        return texInfo;\n    }\n\n    protected _getGfxTextureViewCreateInfo (presumed: PresumedGFXTextureViewInfo) {\n        const texViewInfo = new TextureViewInfo();\n        texViewInfo.type = TextureType.CUBE;\n        texViewInfo.baseLayer = 0;\n        texViewInfo.layerCount = 6;\n        Object.assign(texViewInfo, presumed);\n        return texViewInfo;\n    }\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n\n        const imageAsset = new ImageAsset();\n        imageAsset.initDefault();\n        this.mipmaps = [{\n            front: imageAsset,\n            back: imageAsset,\n            top: imageAsset,\n            bottom: imageAsset,\n            left: imageAsset,\n            right: imageAsset,\n        }];\n    }\n\n    public validate () {\n        if (this._mipmapMode === MipmapMode.BAKED_CONVOLUTION_MAP) {\n            if (this.mipmapAtlas === null || this.mipmapAtlas.layout.length === 0) {\n                return false;\n            }\n            const atlas = this.mipmapAtlas.atlas;\n            return !!(atlas.top && atlas.bottom && atlas.front && atlas.back && atlas.left && atlas.right);\n        } else {\n            return this._mipmaps.length !== 0 && !this._mipmaps.find((x) => !(x.top && x.bottom && x.front && x.back && x.left && x.right));\n        }\n    }\n}\n\nlegacyCC.TextureCube = TextureCube;\n\ninterface ITextureCubeSerializeData {\n    base: string;\n    rgbe: boolean;\n    mipmapMode: number;\n    mipmapAtlas: {\n        front: string;\n        back: string;\n        left: string;\n        right: string;\n        top: string;\n        bottom: string;\n    };\n    mipmapLayout: [];\n    mipmaps: {\n        front: string;\n        back: string;\n        left: string;\n        right: string;\n        top: string;\n        bottom: string;\n    }[];\n}\n\n/**\n * @param {Mipmap} mipmap\n * @param {(face: ImageAsset) => void} callback\n */\nfunction _forEachFace (mipmap: ITextureCubeMipmap, callback: (face: ImageAsset, faceIndex: number) => void) {\n    callback(mipmap.front, FaceIndex.front);\n    callback(mipmap.back, FaceIndex.back);\n    callback(mipmap.left, FaceIndex.left);\n    callback(mipmap.right, FaceIndex.right);\n    callback(mipmap.top, FaceIndex.top);\n    callback(mipmap.bottom, FaceIndex.bottom);\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, TEST } from 'internal:constants';\nimport { ccclass, type } from 'cc.decorator';\nimport { TextureType, TextureInfo, TextureViewInfo } from '../gfx';\nimport { PixelFormat } from './asset-enum';\nimport { ImageAsset } from './image-asset';\nimport { PresumedGFXTextureInfo, PresumedGFXTextureViewInfo, SimpleTexture } from './simple-texture';\nimport { legacyCC } from '../global-exports';\nimport { js } from '../utils/js';\n\n/**\n * @en The create information for [[Texture2D]]\n * @zh 用来创建贴图的信息。\n */\nexport interface ITexture2DCreateInfo {\n    /**\n     * @en The pixel width\n     * @zh 像素宽度。\n     */\n    width: number;\n\n    /**\n     * @en The pixel height\n     * @zh 像素高度。\n     */\n    height: number;\n\n    /**\n     * @en The pixel format\n     * @zh 像素格式。\n     * @default PixelFormat.RGBA8888\n     */\n    format?: PixelFormat;\n\n    /**\n     * @en The mipmap level count\n     * @zh mipmap 层级。\n     * @default 1\n     */\n    mipmapLevel?: number;\n\n    /**\n     * @en The selected base mipmap level\n     * @zh 选择使用的最小 mipmap 层级。\n     * @default 1\n     */\n    baseLevel?: number;\n\n    /**\n     * @en The selected maximum mipmap level\n     * @zh 选择使用的最大 mipmap 层级。\n     * @default 1000\n     */\n    maxLevel?: number;\n}\n\n/**\n * @en The 2D texture asset. It supports mipmap, each level of mipmap use an [[ImageAsset]].\n * @zh 二维贴图资源。二维贴图资源的每个 Mipmap 层级都为一张 [[ImageAsset]]。\n */\n@ccclass('cc.Texture2D')\nexport class Texture2D extends SimpleTexture {\n    /**\n     * @en All levels of mipmap images, be noted, automatically generated mipmaps are not included.\n     * When setup mipmap, the size of the texture and pixel format could be modified.\n     * @zh 所有层级 Mipmap，注意，这里不包含自动生成的 Mipmap。\n     * 当设置 Mipmap 时，贴图的尺寸以及像素格式可能会改变。\n     */\n    get mipmaps () {\n        return this._mipmaps;\n    }\n    set mipmaps (value) {\n        this._mipmaps = value;\n        this._setMipmapLevel(this._mipmaps.length);\n        if (this._mipmaps.length > 0) {\n            const imageAsset: ImageAsset = this._mipmaps[0];\n            this.reset({\n                width: imageAsset.width,\n                height: imageAsset.height,\n                format: imageAsset.format,\n                mipmapLevel: this._mipmaps.length,\n                baseLevel: this._baseLevel,\n                maxLevel: this._maxLevel,\n            });\n            this._mipmaps.forEach((mipmap, level) => {\n                this._assignImage(mipmap, level);\n            });\n        } else {\n            this.reset({\n                width: 0,\n                height: 0,\n                mipmapLevel: this._mipmaps.length,\n                baseLevel: this._baseLevel,\n                maxLevel: this._maxLevel,\n            });\n        }\n    }\n\n    /**\n     * @en Level 0 mipmap image.\n     * Be noted, `this.image = img` equals `this.mipmaps = [img]`,\n     * sets image will clear all previous mipmaps.\n     * @zh 0 级 Mipmap。\n     * 注意，`this.image = img` 等价于 `this.mipmaps = [img]`，\n     * 也就是说，通过 `this.image` 设置 0 级 Mipmap 时将隐式地清除之前的所有 Mipmap。\n     */\n    get image () {\n        return this._mipmaps.length === 0 ? null : this._mipmaps[0];\n    }\n\n    set image (value) {\n        this.mipmaps = value ? [value] : [];\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @type([ImageAsset])\n    public _mipmaps: ImageAsset[] = [];\n\n    public initialize () {\n        this.mipmaps = this._mipmaps;\n    }\n\n    public onLoaded () {\n        this.initialize();\n    }\n\n    /**\n     * @en Reset the current texture with given size, pixel format and mipmap images.\n     * After reset, the gfx resource will become invalid, you must use [[uploadData]] explicitly to upload the new mipmaps to GPU resources.\n     * @zh 将当前贴图重置为指定尺寸、像素格式以及指定 mipmap 层级。重置后，贴图的像素数据将变为未定义。\n     * mipmap 图像的数据不会自动更新到贴图中，你必须显式调用 [[uploadData]] 来上传贴图数据。\n     * @param info The create information\n     */\n    public reset (info: ITexture2DCreateInfo) {\n        this._width = info.width;\n        this._height = info.height;\n        this._setGFXFormat(info.format);\n        const mipLevels = info.mipmapLevel === undefined ? 1 : info.mipmapLevel;\n        this._setMipmapLevel(mipLevels);\n        const minLod = info.baseLevel === undefined ? 0 : info.baseLevel;\n        const maxLod = info.maxLevel === undefined ? 1000 : info.maxLevel;\n        this._setMipRange(minLod, maxLod);\n        this._tryReset();\n    }\n\n    /**\n     * @en Reset the current texture with given size, pixel format and mipmap images.\n     * After reset, the gfx resource will become invalid, you must use [[uploadData]] explicitly to upload the new mipmaps to GPU resources.\n     * @zh 将当前贴图重置为指定尺寸、像素格式以及指定 mipmap 层级。重置后，贴图的像素数据将变为未定义。\n     * mipmap 图像的数据不会自动更新到贴图中，你必须显式调用 [[uploadData]] 来上传贴图数据。\n     * @param width Pixel width\n     * @param height Pixel height\n     * @param format Pixel format\n     * @param mipmapLevel Mipmap level count\n     * @param baseLevel Mipmap base level\n     * @param maxLevel Mipmap maximum level\n     * @deprecated since v1.0 please use [[reset]] instead\n     */\n    public create (width: number, height: number, format = PixelFormat.RGBA8888, mipmapLevel = 1, baseLevel = 0, maxLevel = 1000) {\n        this.reset({\n            width,\n            height,\n            format,\n            mipmapLevel,\n            baseLevel,\n            maxLevel,\n        });\n    }\n\n    public toString () {\n        return this._mipmaps.length !== 0 ? this._mipmaps[0].url : '';\n    }\n\n    public updateMipmaps (firstLevel = 0, count?: number) {\n        if (firstLevel >= this._mipmaps.length) {\n            return;\n        }\n\n        const nUpdate = Math.min(\n            count === undefined ? this._mipmaps.length : count,\n            this._mipmaps.length - firstLevel,\n        );\n\n        for (let i = 0; i < nUpdate; ++i) {\n            const level = firstLevel + i;\n            this._assignImage(this._mipmaps[level], level);\n        }\n    }\n\n    /**\n     * @en If the level 0 mipmap image is a HTML element, then return it, otherwise return null.\n     * @zh 若此贴图 0 级 Mipmap 的图像资源的实际源存在并为 HTML 元素则返回它，否则返回 `null`。\n     * @returns HTML element or `null`\n     * @deprecated Please use [[ImageAsset.data]] instead\n     */\n    public getHtmlElementObj () {\n        return (this._mipmaps[0] && (this._mipmaps[0].data instanceof HTMLElement)) ? this._mipmaps[0].data : null;\n    }\n\n    /**\n     * @en Destroy the current 2d texture, clear up all mipmap levels and the related GPU resources.\n     * @zh 销毁此贴图，清空所有 Mipmap 并释放占用的 GPU 资源。\n     */\n    public destroy () {\n        this._mipmaps = [];\n        return super.destroy();\n    }\n\n    /**\n     * @en Gets the description of the 2d texture\n     * @zh 返回此贴图的描述。\n     * @returns The description\n     */\n    public description () {\n        const url = this._mipmaps[0] ? this._mipmaps[0].url : '';\n        return `<cc.Texture2D | Name = ${url} | Dimension = ${this.width} x ${this.height}>`;\n    }\n\n    /**\n     * @en Release used GPU resources.\n     * @zh 释放占用的 GPU 资源。\n     * @deprecated please use [[destroy]] instead\n     */\n    public releaseTexture () {\n        this.destroy();\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _serialize (ctxForExporting: any) {\n        if (EDITOR || TEST) {\n            return {\n                base: super._serialize(ctxForExporting),\n                mipmaps: this._mipmaps.map((mipmap) => {\n                    if (!mipmap || !mipmap._uuid) {\n                        return null;\n                    }\n                    if (ctxForExporting && ctxForExporting._compressUuid) {\n                        // ctxForExporting.dependsOn('_textureSource', texture); TODO\n                        return EditorExtends.UuidUtils.compressUuid(mipmap._uuid, true);\n                    }\n                    return mipmap._uuid;\n                }),\n            };\n        }\n        return null;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _deserialize (serializedData: any, handle: any) {\n        const data = serializedData as ITexture2DSerializeData;\n        super._deserialize(data.base, handle);\n\n        this._mipmaps = new Array(data.mipmaps.length);\n        for (let i = 0; i < data.mipmaps.length; ++i) {\n            // Prevent resource load failed\n            this._mipmaps[i] = new ImageAsset();\n            if (!data.mipmaps[i]) {\n                continue;\n            }\n            const mipmapUUID = data.mipmaps[i];\n            handle.result.push(this._mipmaps, `${i}`, mipmapUUID, js.getClassId(ImageAsset));\n        }\n    }\n\n    protected _getGfxTextureCreateInfo (presumed: PresumedGFXTextureInfo) {\n        const texInfo = new TextureInfo(TextureType.TEX2D);\n        texInfo.width = this._width;\n        texInfo.height = this._height;\n        Object.assign(texInfo, presumed);\n        return texInfo;\n    }\n\n    protected _getGfxTextureViewCreateInfo (presumed: PresumedGFXTextureViewInfo) {\n        const texViewInfo = new TextureViewInfo();\n        texViewInfo.type = TextureType.TEX2D;\n        Object.assign(texViewInfo, presumed);\n        return texViewInfo;\n    }\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        const imageAsset = new ImageAsset();\n        imageAsset.initDefault();\n        this.image = imageAsset;\n    }\n\n    public validate () {\n        return this.mipmaps && this.mipmaps.length !== 0;\n    }\n}\n\nlegacyCC.Texture2D = Texture2D;\n\nexport interface ITexture2DSerializeData {\n    base: string;\n    mipmaps: string[];\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { EDITOR, TEST } from 'internal:constants';\nimport { Asset } from '../assets';\nimport { legacyCC } from '../global-exports';\nimport { js } from '../utils/js';\nimport Cache from './cache';\nimport { decodeUuid, normalize } from './helper';\nimport { AssetType } from './shared';\n\nexport interface IConfigOption {\n    importBase: string;\n    nativeBase: string;\n    base: string;\n    name: string;\n    deps: string[];\n    uuids: string[];\n    paths: Record<string, any[]>;\n    scenes: Record<string, string>;\n    packs: Record<string, string[]>;\n    versions: { import: string[], native: string[] };\n    redirect: string[];\n    debug: boolean;\n    types: string[];\n    extensionMap: Record<string, string[]>;\n}\n\nexport interface IAssetInfo {\n    uuid: string;\n    packs?: IPackInfo[];\n    redirect?: string;\n    ver?: string;\n    nativeVer?: string;\n    extension?: string;\n}\n\nexport interface IPackInfo extends IAssetInfo {\n    packedUuids: string[];\n    ext: string;\n}\n\nexport interface IAddressableInfo extends IAssetInfo {\n    path: string;\n    ctor: AssetType;\n}\n\nexport interface ISceneInfo extends IAssetInfo {\n    url: string;\n}\n\nconst isMatchByWord = (path: string, test: string): boolean => {\n    if (path.length > test.length) {\n        const nextAscii = path.charCodeAt(test.length);\n        return nextAscii === 47; // '/'\n    }\n    return true;\n};\n\nconst processOptions = (options: IConfigOption) => {\n    if (EDITOR || TEST) { return; }\n    let uuids = options.uuids;\n    const paths = options.paths;\n    const types = options.types;\n    const bundles = options.deps;\n    const realEntries = options.paths = Object.create(null);\n\n    if (options.debug === false) {\n        for (let i = 0, l = uuids.length; i < l; i++) {\n            uuids[i] = decodeUuid(uuids[i]);\n        }\n\n        for (const id in paths) {\n            const entry = paths[id];\n            const type = entry[1];\n            entry[1] = types[type];\n        }\n    } else {\n        const out = Object.create(null);\n        for (let i = 0, l = uuids.length; i < l; i++) {\n            const uuid = uuids[i];\n            uuids[i] = out[uuid] = decodeUuid(uuid);\n        }\n        uuids = out;\n    }\n\n    for (const id in paths) {\n        const entry = paths[id];\n        realEntries[uuids[id]] = entry;\n    }\n\n    const scenes = options.scenes;\n    for (const name in scenes) {\n        const uuid = scenes[name];\n        scenes[name] = uuids[uuid];\n    }\n\n    const packs = options.packs;\n    for (const packId in packs) {\n        const packedIds = packs[packId];\n        for (let j = 0; j < packedIds.length; ++j) {\n            packedIds[j] = uuids[packedIds[j]];\n        }\n    }\n\n    const versions = options.versions;\n    if (versions) {\n        for (const folder in versions) {\n            const entries = versions[folder];\n            for (let i = 0; i < entries.length; i += 2) {\n                const uuid = entries[i];\n                entries[i] = uuids[uuid] || uuid;\n            }\n        }\n    }\n\n    const redirect = options.redirect;\n    if (redirect) {\n        for (let i = 0; i < redirect.length; i += 2) {\n            redirect[i] = uuids[redirect[i]];\n            redirect[i + 1] = bundles[redirect[i + 1]];\n        }\n    }\n\n    const extensionMap = options.extensionMap;\n    if (extensionMap) {\n        for (const ext in options.extensionMap) {\n            if (!Object.prototype.hasOwnProperty.call(options.extensionMap, ext)) {\n                continue;\n            }\n            options.extensionMap[ext].forEach((uuid, index) => {\n                options.extensionMap[ext][index] = uuids[uuid] || uuid;\n            });\n        }\n    }\n};\n\nexport default class Config {\n    public name = '';\n\n    public base = '';\n\n    public importBase = '';\n\n    public nativeBase = '';\n\n    public deps: string[] | null = null;\n\n    public assetInfos = new Cache<IAssetInfo>();\n\n    public scenes = new Cache<ISceneInfo>();\n\n    public paths = new Cache<IAddressableInfo[]>();\n\n    public init (options: IConfigOption) {\n        processOptions(options);\n\n        this.importBase = options.importBase || '';\n        this.nativeBase = options.nativeBase || '';\n        this.base = options.base || '';\n        this.name = options.name || '';\n        this.deps = options.deps || [];\n        // init\n        this._initUuid(options.uuids);\n        this._initPath(options.paths);\n        this._initScene(options.scenes);\n        this._initPackage(options.packs);\n        this._initVersion(options.versions);\n        this._initRedirect(options.redirect);\n        for (const ext in options.extensionMap) {\n            if (!Object.prototype.hasOwnProperty.call(options.extensionMap, ext)) {\n                continue;\n            }\n            options.extensionMap[ext].forEach((uuid) => {\n                const assetInfo = this.assetInfos.get(uuid);\n                if (assetInfo) {\n                    assetInfo.extension = ext;\n                }\n            });\n        }\n    }\n\n    public getInfoWithPath (path: string, type?: AssetType | null): IAddressableInfo | null {\n        if (!path) {\n            return null;\n        }\n        path = normalize(path);\n        const items = this.paths.get(path);\n        if (items) {\n            if (type) {\n                for (let i = 0, l = items.length; i < l; i++) {\n                    const assetInfo = items[i];\n                    if (js.isChildClassOf(assetInfo.ctor, type)) {\n                        return assetInfo;\n                    }\n                }\n            } else {\n                return items[0];\n            }\n        }\n        return null;\n    }\n\n    public getDirWithPath (path: string, type?: AssetType | null, out?: IAddressableInfo[]): IAddressableInfo[] {\n        path = normalize(path);\n        if (path[path.length - 1] === '/') {\n            path = path.slice(0, -1);\n        }\n\n        const infos = out || [];\n        this.paths.forEach((items, p) => {\n            if ((p.startsWith(path) && isMatchByWord(p, path)) || !path) {\n                for (let i = 0, l = items.length; i < l; i++) {\n                    const entry = items[i];\n                    if (!type || js.isChildClassOf(entry.ctor, type)) {\n                        infos.push(entry);\n                    }\n                }\n            }\n        });\n\n        return infos;\n    }\n\n    public getAssetInfo (uuid: string): IAssetInfo | null {\n        return this.assetInfos.get(uuid) || null;\n    }\n\n    public getSceneInfo (name: string): ISceneInfo | null {\n        if (!name.endsWith('.scene')) {\n            name += '.scene';\n        }\n        if (name[0] !== '/' && !name.startsWith('db://')) {\n            name = `/${name}`;\n        }\n        // search scene\n        const info = this.scenes.find((val, key) => key.endsWith(name));\n        return info;\n    }\n\n    public destroy () {\n        this.paths.destroy();\n        this.scenes.destroy();\n        this.assetInfos.destroy();\n    }\n\n    private _initUuid (uuidList: string[]) {\n        if (!uuidList) {\n            return;\n        }\n        this.assetInfos.clear();\n        for (let i = 0, l = uuidList.length; i < l; i++) {\n            const uuid = uuidList[i];\n            this.assetInfos.add(uuid, { uuid });\n        }\n    }\n\n    private _initPath (pathList: Record<string, string[]>) {\n        if (!pathList) { return; }\n        const paths = this.paths;\n        paths.clear();\n        for (const uuid in pathList) {\n            const info = pathList[uuid];\n            const path = info[0];\n            const type = info[1];\n            const isSubAsset = info.length === 3;\n\n            const assetInfo = this.assetInfos.get(uuid) as IAddressableInfo;\n            assetInfo.path = path;\n            assetInfo.ctor = js.getClassById(type) as Constructor<Asset>;\n            if (paths.has(path)) {\n                if (isSubAsset) {\n                    paths.get(path)!.push(assetInfo);\n                } else {\n                    paths.get(path)!.unshift(assetInfo);\n                }\n            } else {\n                paths.add(path, [assetInfo]);\n            }\n        }\n    }\n\n    private _initScene (sceneList: Record<string, string>) {\n        if (!sceneList) { return; }\n        const scenes = this.scenes;\n        scenes.clear();\n        const assetInfos = this.assetInfos;\n        for (const sceneName in sceneList) {\n            const uuid = sceneList[sceneName];\n            const assetInfo = assetInfos.get(uuid) as ISceneInfo;\n            assetInfo.url = sceneName;\n            scenes.add(sceneName, assetInfo);\n        }\n    }\n\n    private _initPackage (packageList: Record<string, string[]>) {\n        if (!packageList) { return; }\n        const assetInfos = this.assetInfos;\n        for (const packUuid in packageList) {\n            const uuids = packageList[packUuid];\n            const pack = { uuid: packUuid, packedUuids: uuids, ext: '.json' };\n            assetInfos.add(packUuid, pack);\n\n            for (let i = 0, l = uuids.length; i < l; i++) {\n                const uuid = uuids[i];\n                const assetInfo = assetInfos.get(uuid)!;\n                const assetPacks = assetInfo.packs;\n                if (assetPacks) {\n                    if (l === 1) {\n                        assetPacks.unshift(pack);\n                    } else {\n                        assetPacks.push(pack);\n                    }\n                } else {\n                    assetInfo.packs = [pack];\n                }\n            }\n        }\n    }\n\n    private _initVersion (versions: { import?: string[], native?: string[] }) {\n        if (!versions) { return; }\n        const assetInfos = this.assetInfos;\n        let entries = versions.import;\n        if (entries) {\n            for (let i = 0, l = entries.length; i < l; i += 2) {\n                const uuid = entries[i];\n                const assetInfo = assetInfos.get(uuid)!;\n                assetInfo.ver = entries[i + 1];\n            }\n        }\n        entries = versions.native;\n        if (entries) {\n            for (let i = 0, l = entries.length; i < l; i += 2) {\n                const uuid = entries[i];\n                const assetInfo = assetInfos.get(uuid)!;\n                assetInfo.nativeVer = entries[i + 1];\n            }\n        }\n    }\n\n    private _initRedirect (redirect: string[]) {\n        if (!redirect) { return; }\n        const assetInfos = this.assetInfos;\n        for (let i = 0, l = redirect.length; i < l; i += 2) {\n            const uuid = redirect[i];\n            const assetInfo = assetInfos.get(uuid)!;\n            assetInfo.redirect = redirect[i + 1];\n        }\n    }\n}\n\nif (TEST) {\n    legacyCC._Test.Config = Config;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, TEST } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport { isValid } from '../data/object';\nimport { Node, Scene } from '../scene-graph';\nimport Cache from './cache';\nimport dependUtil from './depend-util';\nimport { assets, references } from './shared';\nimport { callInNextTick } from '../utils/misc';\nimport { js } from '../utils/js';\n\nfunction visitAsset (asset: Asset, deps: string[]) {\n    // Skip assets generated programmatically or by user (e.g. label texture)\n    if (!asset._uuid) {\n        return;\n    }\n    deps.push(asset._uuid);\n}\n\nfunction visitComponent (comp: any, deps: string[]) {\n    const props = Object.getOwnPropertyNames(comp);\n    for (let i = 0; i < props.length; i++) {\n        const propName = props[i];\n        if (propName === 'node' || propName === '__eventTargets') { continue; }\n        const value = comp[propName];\n        if (typeof value === 'object' && value) {\n            if (Array.isArray(value)) {\n                for (let j = 0; j < value.length; j++) {\n                    const val = value[j];\n                    if (val instanceof Asset) {\n                        visitAsset(val, deps);\n                    }\n                }\n            } else if (!value.constructor || value.constructor === Object) {\n                const keys = Object.getOwnPropertyNames(value);\n                for (let j = 0; j < keys.length; j++) {\n                    const val = value[keys[j]];\n                    if (val instanceof Asset) {\n                        visitAsset(val, deps);\n                    }\n                }\n            } else if (value instanceof Asset) {\n                visitAsset(value, deps);\n            }\n        }\n    }\n}\n\nfunction visitNode (node: any, deps: string[]) {\n    for (let i = 0; i < node._components.length; i++) {\n        visitComponent(node._components[i], deps);\n    }\n    for (let i = 0; i < node._children.length; i++) {\n        visitNode(node._children[i], deps);\n    }\n}\n\nfunction descendOpRef (asset: Asset, refs: Record<string, number>, exclude: string[], op: number) {\n    exclude.push(asset._uuid);\n    const depends = dependUtil.getDeps(asset._uuid);\n    for (let i = 0, l = depends.length; i < l; i++) {\n        const dependAsset = assets.get(depends[i]);\n        if (!dependAsset) { continue; }\n        const uuid = dependAsset._uuid;\n        if (!(uuid in refs)) {\n            refs[uuid] = dependAsset.refCount + op;\n        } else {\n            refs[uuid] += op;\n        }\n        if (exclude.includes(uuid)) { continue; }\n        descendOpRef(dependAsset, refs, exclude, op);\n    }\n}\n\nconst _temp = [];\nfunction checkCircularReference (asset: Asset): number {\n    // check circular reference\n    const refs: Record<string, number> = Object.create(null);\n    refs[asset._uuid] = asset.refCount;\n    descendOpRef(asset, refs, _temp, -1);\n    _temp.length = 0;\n    if (refs[asset._uuid] !== 0) { return refs[asset._uuid]; }\n\n    for (const uuid in refs) {\n        if (refs[uuid] !== 0) {\n            descendOpRef(assets.get(uuid)!, refs, _temp, 1);\n        }\n    }\n    _temp.length = 0;\n\n    return refs[asset._uuid];\n}\n\nclass ReleaseManager {\n    private _persistNodeDeps = new Cache<string[]>();\n    private _toDelete = new Cache<Asset>();\n    private _eventListener = false;\n    private _dontDestroyAssets: string[] = [];\n\n    public addIgnoredAsset (asset: Asset) {\n        this._dontDestroyAssets.push(asset._uuid);\n    }\n\n    public init (): void {\n        this._persistNodeDeps.clear();\n        this._toDelete.clear();\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _addPersistNodeRef (node: Node) {\n        const deps = [];\n        visitNode(node, deps);\n        for (let i = 0, l = deps.length; i < l; i++) {\n            const dependAsset = assets.get(deps[i]);\n            if (dependAsset) {\n                dependAsset.addRef();\n            }\n        }\n        this._persistNodeDeps.add(node.uuid, deps);\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _removePersistNodeRef (node: Node) {\n        if (!this._persistNodeDeps.has(node.uuid)) { return; }\n\n        const deps = this._persistNodeDeps.get(node.uuid) as string[];\n        for (let i = 0, l = deps.length; i < l; i++) {\n            const dependAsset = assets.get(deps[i]);\n            if (dependAsset) {\n                dependAsset.decRef();\n            }\n        }\n        this._persistNodeDeps.remove(node.uuid);\n    }\n\n    // do auto release\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _autoRelease (oldScene: Scene, newScene: Scene, persistNodes: Record<string, Node>) {\n        if (oldScene) {\n            const childs = dependUtil.getDeps(oldScene.uuid);\n            for (let i = 0, l = childs.length; i < l; i++) {\n                const asset = assets.get(childs[i]);\n                if (asset) {\n                    asset.decRef(TEST || oldScene.autoReleaseAssets);\n                }\n            }\n\n            const dependencies = dependUtil._depends.get(oldScene.uuid);\n            if (dependencies && dependencies.persistDeps) {\n                const persistDeps = dependencies.persistDeps;\n                for (let i = 0, l = persistDeps.length; i < l; i++) {\n                    const asset = assets.get(persistDeps[i]);\n                    if (asset) {\n                        asset.decRef(TEST || oldScene.autoReleaseAssets);\n                    }\n                }\n            }\n\n            if (oldScene.uuid !== newScene.uuid) {\n                dependUtil.remove(oldScene.uuid);\n            }\n        }\n\n        // transfer refs from persist nodes to new scene\n        const sceneDeps = dependUtil._depends.get(newScene.uuid);\n        if (sceneDeps) { sceneDeps.persistDeps = []; }\n        for (const key in persistNodes) {\n            const node = persistNodes[key];\n            const deps = this._persistNodeDeps.get(node.uuid) as string[];\n            for (const dep of deps) {\n                const dependAsset = assets.get(dep);\n                if (dependAsset) {\n                    dependAsset.addRef();\n                }\n            }\n            if (!sceneDeps) { continue; }\n            sceneDeps.persistDeps!.push(...deps);\n        }\n    }\n\n    public tryRelease (asset: Asset, force = false): void {\n        if (!(asset instanceof Asset)) { return; }\n        if (force) {\n            this._free(asset, force);\n            return;\n        }\n\n        this._toDelete.add(asset._uuid, asset);\n        if (TEST) return;\n        if (!this._eventListener) {\n            this._eventListener = true;\n            callInNextTick(this._freeAssets.bind(this));\n        }\n    }\n\n    private _freeAssets () {\n        this._eventListener = false;\n        this._toDelete.forEach((asset) => {\n            this._free(asset);\n        });\n        this._toDelete.clear();\n    }\n\n    private _free (asset: Asset, force = false) {\n        const uuid = asset._uuid;\n        this._toDelete.remove(uuid);\n\n        if (!isValid(asset, true) || this._dontDestroyAssets.indexOf(uuid) !== -1) { return; }\n\n        if (!force) {\n            if (asset.refCount > 0) {\n                if (checkCircularReference(asset) > 0) { return; }\n            }\n        }\n\n        // remove from cache\n        assets.remove(uuid);\n        const depends = dependUtil.getDeps(uuid);\n        for (let i = 0, l = depends.length; i < l; i++) {\n            const dependAsset = assets.get(depends[i]);\n            if (dependAsset) {\n                dependAsset.decRef(false);\n                // no need to release dependencies recursively in editor\n                if (!EDITOR) {\n                    this._free(dependAsset, false);\n                }\n            }\n        }\n        // only release non-gc asset in editor\n        if (!EDITOR) {\n            asset.destroy();\n        }\n        dependUtil.remove(uuid);\n        if (EDITOR) {\n            const dependant = references!.get(uuid);\n            if (dependant && dependant.length === 0) {\n                references!.remove(uuid);\n            }\n            references!.forEach((dependance, key) => {\n                for (let i = dependance.length - 1; i >= 0; i--) {\n                    if (dependance[i][0].deref() === asset) {\n                        js.array.fastRemoveAt(dependance, i);\n                    }\n                }\n                if (dependance.length === 0) {\n                    references!.remove(key);\n                }\n            });\n        }\n    }\n}\n\nexport default new ReleaseManager();\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Asset } from '../assets/asset';\nimport { SceneAsset } from '../assets/scene-asset';\nimport { legacyCC } from '../global-exports';\nimport { error, errorID } from '../platform/debug';\nimport Config, { IAddressableInfo, IAssetInfo, IConfigOption, ISceneInfo } from './config';\nimport releaseManager from './release-manager';\nimport RequestItem from './request-item';\nimport { assets, AssetType, bundles, CompleteCallbackWithData, CompleteCallbackNoData, IAssetOptions, ProgressCallback, RequestType } from './shared';\nimport { parseLoadResArgs, parseParameters } from './utilities';\n\n/**\n * @en\n * A bundle contains an amount of assets(includes scene), you can load, preload, release asset which is in this bundle\n *\n * @zh\n * 一个包含一定数量资源（包括场景）的包，你可以加载，预加载，释放此包内的资源\n *\n */\nexport default class Bundle {\n    private _config: Config = new Config();\n\n    /**\n     * for internal use\n     * @private\n     */\n    public get config (): Config {\n        return this._config;\n    }\n\n    /**\n     * @en\n     * The name of this bundle\n     *\n     * @zh\n     * 此 bundle 的名称\n     *\n     */\n    public get name (): string {\n        return this._config.name;\n    }\n\n    /**\n     * @en\n     * The dependency of this bundle\n     *\n     * @zh\n     * 此 bundle 的依赖\n     *\n     */\n    public get deps (): string[] {\n        return this._config.deps!;\n    }\n\n    /**\n     * @en\n     * The root path of this bundle, such like 'http://example.com/bundle1'\n     *\n     * @zh\n     * 此 bundle 的根路径, 例如 'http://example.com/bundle1'\n     *\n     */\n    public get base (): string {\n        return this._config.base;\n    }\n\n    /**\n     * @en\n     * Get asset's info using path, only valid when asset is in bundle folder.\n     *\n     * @zh\n     * 使用 path 获取资源的配置信息\n     *\n     * @param path - The relative path of asset, such as 'images/a'\n     * @param type - The constructor of asset, such as  `Texture2D`\n     * @returns The asset info\n     *\n     * @example\n     * var info = bundle.getInfoWithPath('image/a', Texture2D);\n     *\n     */\n    public getInfoWithPath (path: string, type?: AssetType | null): IAddressableInfo | null {\n        return this._config.getInfoWithPath(path, type);\n    }\n\n    /**\n     * @en\n     * Get all asset's info within specific folder\n     *\n     * @zh\n     * 获取在某个指定文件夹下的所有资源信息\n     *\n     * @param path - The relative path of folder, such as 'images'\n     * @param type - The constructor should be used to filter paths\n     * @param out - The output array\n     * @returns Infos\n     *\n     * @example\n     * var infos = [];\n     * bundle.getDirWithPath('images', Texture2D, infos);\n     */\n    public getDirWithPath (path: string, type?: AssetType | null, out?: IAddressableInfo[]): IAddressableInfo[] {\n        return this._config.getDirWithPath(path, type, out);\n    }\n\n    /**\n     * @en\n     * Get asset's info with uuid\n     *\n     * @zh\n     * 通过 uuid 获取资源信息\n     *\n     * @method getAssetInfo\n     * @param  uuid - The asset's uuid\n     * @returns info\n     *\n     * @example\n     * var info = bundle.getAssetInfo('fcmR3XADNLgJ1ByKhqcC5Z');\n     *\n     */\n    public getAssetInfo (uuid: string): IAssetInfo | null {\n        return this._config.getAssetInfo(uuid);\n    }\n\n    /**\n     * @en\n     * Get scene'info with name\n     *\n     * @zh\n     * 通过场景名获取场景信息\n     *\n     * @method getSceneInfo\n     * @param name - The name of scene\n     * @return info\n     *\n     * @example\n     * var info = bundle.getSceneInfo('first.fire');\n     *\n     */\n    public getSceneInfo (name: string): ISceneInfo | null {\n        return this._config.getSceneInfo(name);\n    }\n\n    /**\n     * @en\n     * Initialize this bundle with options\n     *\n     * @zh\n     * 初始化此 bundle\n     *\n     * @param options\n     *\n     */\n    public init (options: IConfigOption) {\n        this._config.init(options);\n        bundles.add(options.name, this);\n    }\n\n    /**\n     * @en\n     * Load the asset within this bundle by the path which is relative to bundle's path\n     *\n     * @zh\n     * 通过相对路径加载分包中的资源。路径是相对分包文件夹路径的相对路径\n     *\n     * @param paths - Paths of the target assets.The path is relative to the bundle's folder, extensions must be omitted.\n     * @param type - Only asset of type will be loaded if this argument is supplied.\n     * @param onProgress - Callback invoked when progression change.\n     * @param onProgress.finish - The number of the items that are already completed.\n     * @param onProgress.total - The total number of the items.\n     * @param onProgress.item - The finished request item.\n     * @param onComplete - Callback invoked when all assets loaded.\n     * @param onComplete.error - The error info or null if loaded successfully.\n     * @param onComplete.assets - The loaded assets.\n     *\n     * @example\n     * // load the texture (${project}/assets/resources/textures/background.jpg) from resources\n     * resources.load('textures/background', Texture2D, (err, texture) => console.log(err));\n     *\n     * // load the audio (${project}/assets/resources/music/hit.mp3) from resources\n     * resources.load('music/hit', AudioClip, (err, audio) => console.log(err));\n     *\n     * // load the prefab (${project}/assets/bundle1/misc/character/cocos) from bundle1 folder\n     * bundle1.load('misc/character/cocos', Prefab, (err, prefab) => console.log(err));\n     *\n     * // load the sprite frame (${project}/assets/some/xxx/bundle2/imgs/cocos.png) from bundle2 folder\n     * bundle2.load('imgs/cocos', SpriteFrame, null, (err, spriteFrame) => console.log(err));\n     *\n     */\n    public load<T extends Asset> (\n        paths: string,\n        type: AssetType<T> | null,\n        onProgress: ProgressCallback | null,\n        onComplete: CompleteCallbackWithData<T> | null): void;\n    public load<T extends Asset> (\n        paths: string[], type: AssetType<T> | null,\n        onProgress: ProgressCallback | null,\n        onComplete: CompleteCallbackWithData<T[]> | null): void;\n    public load<T extends Asset> (paths: string, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<T> | null): void;\n    public load<T extends Asset> (paths: string[], onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<T[]> | null): void;\n    public load<T extends Asset> (paths: string, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public load<T extends Asset> (paths: string[], onComplete?: CompleteCallbackWithData<T[]> | null): void;\n    public load<T extends Asset> (paths: string, type: AssetType<T> | null, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public load<T extends Asset> (paths: string[], type: AssetType<T> | null, onComplete?: CompleteCallbackWithData<T[]> | null): void;\n    public load<T extends Asset> (\n        paths: string|string[],\n        type?: AssetType<T> | ProgressCallback | CompleteCallbackWithData<T|T[]> | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<T|T[]> | null,\n        onComplete?: CompleteCallbackWithData<T|T[]> | null,\n    ) {\n        const { type: _type, onProgress: onProg, onComplete: onComp } = parseLoadResArgs(type, onProgress, onComplete);\n        const options = { __requestType__: RequestType.PATH, type: _type, bundle: this.name, __outputAsArray__: Array.isArray(paths) };\n        legacyCC.assetManager.loadAny(paths, options, onProg, onComp);\n    }\n\n    /**\n     * @en\n     * Preload the asset within this bundle by the path which is relative to bundle's path.\n     * After calling this method, you still need to finish loading by calling `Bundle.load`.\n     * It will be totally fine to call `Bundle.load` at any time even if the preloading is not\n     * yet finished\n     *\n     * @zh\n     * 通过相对路径预加载分包中的资源。路径是相对分包文件夹路径的相对路径。调用完后，你仍然需要通过 `Bundle.load` 来完成加载。\n     * 就算预加载还没完成，你也可以直接调用 `Bundle.load`。\n     *\n     * @param paths - Paths of the target asset.The path is relative to bundle folder, extensions must be omitted.\n     * @param type - Only asset of type will be loaded if this argument is supplied.\n     * @param onProgress - Callback invoked when progression change.\n     * @param onProgress.finish - The number of the items that are already completed.\n     * @param onProgress.total - The total number of the items.\n     * @param onProgress.item - The finished request item.\n     * @param onComplete - Callback invoked when the resource loaded.\n     * @param onComplete.error - The error info or null if loaded successfully.\n     * @param onComplete.items - The preloaded items.\n     *\n     * @example\n     * // preload the texture (${project}/assets/resources/textures/background.jpg) from resources\n     * resources.preload('textures/background', Texture2D);\n     *\n     * // preload the audio (${project}/assets/resources/music/hit.mp3) from resources\n     * resources.preload('music/hit', AudioClip);\n     * // wait for while\n     * resources.load('music/hit', AudioClip, (err, audioClip) => {});\n     *\n     * * // preload the prefab (${project}/assets/bundle1/misc/character/cocos) from bundle1 folder\n     * bundle1.preload('misc/character/cocos', Prefab);\n     *\n     * // load the sprite frame of (${project}/assets/bundle2/imgs/cocos.png) from bundle2 folder\n     * bundle2.preload('imgs/cocos', SpriteFrame);\n     * // wait for while\n     * bundle2.load('imgs/cocos', SpriteFrame, (err, spriteFrame) => {});\n     *\n     */\n    public preload (paths: string|string[], type: AssetType|null, onProgress: ProgressCallback|null, onComplete: CompleteCallbackWithData<RequestItem[]>|null): void;\n    public preload (paths: string|string[], onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preload (paths: string|string[], onComplete?: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preload (paths: string|string[], type: AssetType | null, onComplete?: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preload (\n        paths: string|string[],\n        type?: AssetType | ProgressCallback | CompleteCallbackWithData<RequestItem[]> | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<RequestItem[]> | null,\n        onComplete?: CompleteCallbackWithData<RequestItem[]> | null,\n    ) {\n        const { type: _type, onProgress: onProg, onComplete: onComp } = parseLoadResArgs(type, onProgress, onComplete);\n        legacyCC.assetManager.preloadAny(paths, { __requestType__: RequestType.PATH, type: _type, bundle: this.name }, onProg, onComp);\n    }\n\n    /**\n     * @en\n     * Load all assets under a folder inside the bundle folder.<br>\n     * <br>\n     * Note: All asset paths in Creator use forward slashes, paths using backslashes will not work.\n     *\n     * @zh\n     * 加载目标文件夹中的所有资源, 注意：路径中只能使用斜杠，反斜杠将停止工作\n     *\n     * @param dir - path of the target folder.The path is relative to the bundle folder, extensions must be omitted.\n     * @param type - Only asset of type will be loaded if this argument is supplied.\n     * @param onProgress - Callback invoked when progression change.\n     * @param onProgress.finish - The number of the items that are already completed.\n     * @param onProgress.total - The total number of the items.\n     * @param onProgress.item - The latest request item\n     * @param onComplete - A callback which is called when all assets have been loaded, or an error occurs.\n     * @param onComplete.error - If one of the asset failed, the complete callback is immediately called with the error.\n     *                           If all assets are loaded successfully, error will be null.\n     * @param onComplete.assets - An array of all loaded assets.\n     *\n     * @example\n     * // load all audios (resources/audios/)\n     * resources.loadDir('audios', AudioClip, (err, audios) => {});\n     *\n     * // load all textures in \"resources/imgs/\"\n     * resources.loadDir('imgs', Texture2D, null, function (err, textures) {\n     *     var texture1 = textures[0];\n     *     var texture2 = textures[1];\n     * });\n     *\n     * // load all prefabs (${project}/assets/bundle1/misc/characters/) from bundle1 folder\n     * bundle1.loadDir('misc/characters', Prefab, (err, prefabs) => console.log(err));\n     *\n     * // load all sprite frame (${project}/assets/some/xxx/bundle2/skills/) from bundle2 folder\n     * bundle2.loadDir('skills', SpriteFrame, null, (err, spriteFrames) => console.log(err));\n     *\n     */\n    public loadDir<T extends Asset> (dir: string, type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<T[]> | null): void;\n    public loadDir<T extends Asset> (dir: string, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<T[]> | null): void;\n    public loadDir<T extends Asset> (dir: string, onComplete?: CompleteCallbackWithData<T[]> | null): void;\n    public loadDir<T extends Asset> (dir: string, type: AssetType<T> | null, onComplete?: CompleteCallbackWithData<T[]> | null): void;\n    public loadDir<T extends Asset> (\n        dir: string,\n        type?: AssetType<T> | ProgressCallback | CompleteCallbackWithData<T[]> | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<T[]> | null,\n        onComplete?: CompleteCallbackWithData<T[]> | null,\n    ) {\n        const { type: _type, onProgress: onProg, onComplete: onComp } = parseLoadResArgs(type, onProgress, onComplete);\n        legacyCC.assetManager.loadAny(dir, { __requestType__: RequestType.DIR, type: _type, bundle: this.name, __outputAsArray__: true }, onProg, onComp);\n    }\n\n    /**\n     * @en\n     * Preload all assets under a folder inside the bundle folder.<br> After calling this method, you still need to\n     * finish loading by calling `Bundle.loadDir`.\n     * It will be totally fine to call `Bundle.loadDir` at any time even if the preloading is not yet finished\n     *\n     * @zh\n     * 预加载目标文件夹中的所有资源。调用完后，你仍然需要通过 `Bundle.loadDir` 来完成加载。\n     * 就算预加载还没完成，你也可以直接调用 `Bundle.loadDir`。\n     *\n     * @param dir - path of the target folder.The path is relative to the bundle folder, extensions must be omitted.\n     * @param type - Only asset of type will be preloaded if this argument is supplied.\n     * @param onProgress - Callback invoked when progression change.\n     * @param onProgress.finish - The number of the items that are already completed.\n     * @param onProgress.total - The total number of the items.\n     * @param onProgress.item - The latest request item\n     * @param onComplete - A callback which is called when all assets have been loaded, or an error occurs.\n     * @param onComplete.error - If one of the asset failed, the complete callback is immediately called with the error.\n     *                                   If all assets are preloaded successfully, error will be null.\n     * @param onComplete.items - An array of all preloaded items.\n     *\n     * @example\n     * // preload all audios (resources/audios/)\n     * resources.preloadDir('audios', AudioClip);\n     *\n     * // preload all textures in \"resources/imgs/\"\n     * resources.preloadDir('imgs', Texture2D);\n     * // wait for while\n     * resources.loadDir('imgs', Texture2D, (err, textures) => {});\n     *\n     * // preload all prefabs (${project}/assets/bundle1/misc/characters/) from bundle1 folder\n     * bundle1.preloadDir('misc/characters', Prefab);\n     *\n     * // preload all sprite frame (${project}/assets/some/xxx/bundle2/skills/) from bundle2 folder\n     * bundle2.preloadDir('skills', SpriteFrame);\n     * // wait for while\n     * bundle2.loadDir('skills', SpriteFrame, (err, spriteFrames) => {});\n     */\n    public preloadDir (dir: string, type: AssetType | null, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadDir (dir: string, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadDir (dir: string, onComplete?: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadDir (dir: string, type: AssetType | null, onComplete?: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadDir (\n        dir: string,\n        type?: AssetType | ProgressCallback | CompleteCallbackWithData<RequestItem[]>| null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<RequestItem[]>| null,\n        onComplete?: CompleteCallbackWithData<RequestItem[]>| null,\n    ) {\n        const { type: _type, onProgress: onProg, onComplete: onComp } = parseLoadResArgs(type, onProgress, onComplete);\n        legacyCC.assetManager.preloadAny(dir, { __requestType__: RequestType.DIR, type: _type, bundle: this.name }, onProg, onComp);\n    }\n\n    /**\n     * @en\n     * Loads the scene asset within this bundle by its name.\n     *\n     * @zh\n     * 通过场景名称加载分包中的场景资源。\n     *\n     * @param sceneName - The name of the scene to load.\n     * @param options - Some optional parameters\n     * @param onProgress - Callback invoked when progression change.\n     * @param onProgress.finish - The number of the items that are already completed.\n     * @param onProgress.total - The total number of the items.\n     * @param onProgress.item - The latest request item\n     * @param onComplete - callback, will be called after scene launched.\n     * @param onComplete.err - The occurred error, null indicetes success\n     * @param onComplete.sceneAsset - The scene asset\n     *\n     * @example\n     * bundle1.loadScene('first', (err, sceneAsset) => director.runScene(sceneAsset));\n     *\n     */\n    public loadScene (sceneName: string, options: IAssetOptions | null, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<SceneAsset> | null): void;\n    public loadScene (sceneName: string, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<SceneAsset> | null): void;\n    public loadScene (sceneName: string, options: IAssetOptions | null, onComplete?: CompleteCallbackWithData<SceneAsset> | null): void;\n    public loadScene (sceneName: string, onComplete?: CompleteCallbackWithData<SceneAsset> | null): void;\n    public loadScene (\n        sceneName: string,\n        options?: IAssetOptions | ProgressCallback | CompleteCallbackWithData<SceneAsset> | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<SceneAsset> | null,\n        onComplete?: CompleteCallbackWithData<SceneAsset> | null,\n    ) {\n        const { options: opts, onProgress: onProg, onComplete: onComp } = parseParameters<CompleteCallbackWithData<SceneAsset>>(options, onProgress, onComplete);\n\n        opts.preset = opts.preset || 'scene';\n        opts.bundle = this.name;\n        legacyCC.assetManager.loadAny({ scene: sceneName }, opts, onProg, (err, sceneAsset) => {\n            if (err) {\n                error(err.message, err.stack);\n            } else if (sceneAsset.scene) {\n                const scene = sceneAsset.scene;\n                scene._id = sceneAsset._uuid;\n                scene.name = sceneAsset.name;\n            } else {\n                err = new Error(`The asset ${sceneAsset._uuid} is not a scene`);\n            }\n            if (onComp) { onComp(err, sceneAsset); }\n        });\n    }\n\n    /**\n     * @en\n     * Preload the scene asset within this bundle by its name. After calling this method, you still need to finish loading\n     * by calling `Bundle.loadScene` or `director.loadScene`.It will be totally fine to call `Bundle.loadDir` at any\n     * time even if the preloading is not yet finished\n     *\n     * @zh\n     * 通过场景名称预加载分包中的场景资源.调用完后，你仍然需要通过 `Bundle.loadScene` 或 `director.loadScene` 来完成加载。\n     * 就算预加载还没完成，你也可以直接调用 `Bundle.loadScene` 或 `director.loadScene`。\n     *\n     * @param sceneName - The name of the scene to preload.\n     * @param options - Some optional parameters\n     * @param onProgress - callback, will be called when the load progression change.\n     * @param onProgress.finish - The number of the items that are already completed\n     * @param onProgress.total - The total number of the items\n     * @param onProgress.item The latest request item\n     * @param onComplete - callback, will be called after scene loaded.\n     * @param onComplete.error - null or the error object.\n     *\n     * @example\n     * bundle1.preloadScene('first');\n     * // wait for a while\n     * bundle1.loadScene('first', (err, scene) => director.runScene(scene));\n     *\n     */\n    public preloadScene (sceneName: string, options: IAssetOptions | null, onProgress: ProgressCallback, onComplete: CompleteCallbackNoData | null): void;\n    public preloadScene (sceneName: string, onProgress: ProgressCallback | null, onComplete: CompleteCallbackNoData | null): void;\n    public preloadScene (sceneName: string, options: IAssetOptions | null, onComplete?: CompleteCallbackNoData | null): void;\n    public preloadScene (sceneName: string, onComplete?: CompleteCallbackNoData | null): void;\n    public preloadScene (\n        sceneName: string,\n        options?: IAssetOptions | ProgressCallback | CompleteCallbackNoData | null,\n        onProgress?: ProgressCallback | CompleteCallbackNoData | null,\n        onComplete?: CompleteCallbackNoData | null,\n    ) {\n        const { options: opts, onProgress: onProg, onComplete: onComp } = parseParameters<CompleteCallbackNoData>(options, onProgress, onComplete);\n\n        opts.bundle = this.name;\n        legacyCC.assetManager.preloadAny({ scene: sceneName }, opts, onProg, (err) => {\n            if (err) {\n                errorID(1210, sceneName, err.message);\n            }\n            if (onComp) { onComp(err); }\n        });\n    }\n\n    /**\n     * @en\n     * Get cached asset within this bundle by path and type. <br>\n     * After you load asset with [[load]] or [[loadDir]],\n     * you can acquire them by passing the path to this API.\n     *\n     * NOTE：The `path` and `type` parameters passed need to be the same as those passed to `Bundle.load`,\n     * otherwise it may return some other resources with the same name!\n     *\n     * @zh\n     * 通过路径与类型获取已缓存资源。在你使用 [[load]] 或者 [[loadDir]] 之后，\n     * 你能通过传路径通过这个 API 获取到这些资源。\n     *\n     * 注意：传入的 path 与 type 参数需要与 `Bundle.load` 加载资源时传入的参数一致，否则可能会获取到其他同名资源\n     *\n     * @param path - The path of asset\n     * @param type - Only asset of type will be returned if this argument is supplied.\n     * @returns - the asset has been cached\n     *\n     * @example\n     * bundle1.get('music/hit', AudioClip);\n     */\n    public get<T extends Asset> (path: string, type?: AssetType<T> | null): T | null {\n        const info = this.getInfoWithPath(path, type);\n        if (info) {\n            return assets.get(info.uuid) as T || null;\n        }\n\n        return null;\n    }\n\n    /**\n     * @en\n     * Release the asset loaded by [[load]] or [[loadDir]]\n     * and it's dependencies. Refer to [[AssetManager.releaseAsset]] for detailed informations.\n     *\n     * NOTE：The `path` and `type` parameters passed need to be the same as those passed to `Bundle.load`,\n     * otherwise it may release some other resources with the same name!\n     *\n     * @zh\n     * 释放通过 [[load]] 或者 [[loadDir]] 加载的资源。\n     * 详细信息请参考 [[AssetManager.releaseAsset]]\n     *\n     * 注意：传入的 path 与 type 参数需要与 `Bundle.load` 加载资源时传入的参数一致，否则可能会释放到其他同名资源\n     *\n     * @param path - The path of asset\n     * @param type - Only asset of type will be released if this argument is supplied.\n     *\n     * @example\n     * // release a texture which is no longer need\n     * bundle1.release('misc/character/cocos');\n     *\n     */\n    public release (path: string, type?: AssetType | null) {\n        const asset = this.get(path, type);\n        if (asset) {\n            releaseManager.tryRelease(asset, true);\n        }\n    }\n\n    /**\n     * @en\n     * Release all unused assets within this bundle. Refer to [[AssetManager.releaseAll]] for detailed informations.\n     *\n     * @zh\n     * 释放此包中的所有没有用到的资源。详细信息请参考 [[AssetManager.releaseAll]]\n     *\n     * @private\n     *\n     * @example\n     * // release all unused asset within bundle1\n     * bundle1.releaseUnusedAssets();\n     *\n     */\n    public releaseUnusedAssets () {\n        assets.forEach((asset) => {\n            const info = this.getAssetInfo(asset._uuid);\n            if (info && !info.redirect) {\n                releaseManager.tryRelease(asset);\n            }\n        });\n    }\n\n    /**\n     * @en\n     * Release all assets within this bundle. Refer to [[AssetManager.releaseAll]] for detailed information.\n     *\n     * @zh\n     * 释放此包中的所有资源。详细信息请参考 [[AssetManager.releaseAll]]\n     *\n     * @example\n     * // release all asset within bundle1\n     * bundle1.releaseAll();\n     */\n    public releaseAll () {\n        assets.forEach((asset) => {\n            const info = this.getAssetInfo(asset._uuid);\n            if (info && !info.redirect) {\n                releaseManager.tryRelease(asset, true);\n            }\n        });\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _destroy () {\n        this._config.destroy();\n    }\n}\n\n/**\n * @en\n * resources is a bundle and controls all asset under assets/resources\n *\n * @zh\n * resources 是一个 bundle，用于管理所有在 assets/resources 下的资源\n */\nexport const resources: Bundle = new Bundle();\nlegacyCC.resources = resources;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { getError } from '../platform/debug';\nimport { CompleteCallback, IDownloadParseOptions } from './shared';\n\nexport default function downloadDomImage (\n    url: string,\n    options: IDownloadParseOptions,\n    onComplete: CompleteCallback<HTMLImageElement>,\n): HTMLImageElement {\n    const img = new Image();\n\n    if (window.location.protocol !== 'file:') {\n        img.crossOrigin = 'anonymous';\n    }\n\n    function loadCallback () {\n        img.removeEventListener('load', loadCallback);\n        img.removeEventListener('error', errorCallback);\n        if (onComplete) { onComplete(null, img); }\n    }\n\n    function errorCallback () {\n        img.removeEventListener('load', loadCallback);\n        img.removeEventListener('error', errorCallback);\n        if (onComplete) { onComplete(new Error(getError(4930, url))); }\n    }\n\n    img.addEventListener('load', loadCallback);\n    img.addEventListener('error', errorCallback);\n    img.src = url;\n    return img;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { CompleteCallback, IXHROptions } from './shared';\n\ntype FileProgressCallback = (loaded: number, total: number) => void;\n\nexport default function downloadFile (\n    url: string,\n    options: IXHROptions,\n    onProgress: FileProgressCallback | null | undefined,\n    onComplete: CompleteCallback,\n): XMLHttpRequest {\n    const xhr = new XMLHttpRequest();\n    const errInfo = `download failed: ${url}, status: `;\n\n    xhr.open('GET', url, true);\n\n    if (options.xhrResponseType !== undefined) { xhr.responseType = options.xhrResponseType; }\n    if (options.xhrWithCredentials !== undefined) { xhr.withCredentials = options.xhrWithCredentials; }\n    if (options.xhrMimeType !== undefined && xhr.overrideMimeType) { xhr.overrideMimeType(options.xhrMimeType); }\n    if (options.xhrTimeout !== undefined) { xhr.timeout = options.xhrTimeout; }\n\n    if (options.xhrHeader) {\n        for (const header in options.xhrHeader) {\n            xhr.setRequestHeader(header, options.xhrHeader[header]);\n        }\n    }\n\n    xhr.onload = () => {\n        if (xhr.status === 200 || xhr.status === 0) {\n            if (onComplete) { onComplete(null, xhr.response); }\n        } else if (onComplete) { onComplete(new Error(`${errInfo}${xhr.status}(no response)`)); }\n    };\n\n    if (onProgress) {\n        xhr.onprogress = (e) => {\n            if (e.lengthComputable) {\n                onProgress(e.loaded, e.total);\n            }\n        };\n    }\n\n    xhr.onerror = () => {\n        if (onComplete) { onComplete(new Error(`${errInfo}${xhr.status}(error)`)); }\n    };\n\n    xhr.ontimeout = () => {\n        if (onComplete) { onComplete(new Error(`${errInfo}${xhr.status}(time out)`)); }\n    };\n\n    xhr.onabort = () => {\n        if (onComplete) { onComplete(new Error(`${errInfo}${xhr.status}(abort)`)); }\n    };\n\n    xhr.send(null);\n\n    return xhr;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { getError } from '../platform/debug';\nimport { CompleteCallback, IBundleOptions } from './shared';\n\nconst downloaded = {};\n\nexport default function downloadScript (\n    url: string,\n    options: IBundleOptions,\n    onComplete: CompleteCallback,\n): HTMLScriptElement | null {\n    // no need to load script again\n    if (downloaded[url]) {\n        if (onComplete) { onComplete(null); }\n        return null;\n    }\n\n    const script = document.createElement('script');\n\n    if (window.location.protocol !== 'file:') {\n        script.crossOrigin = 'anonymous';\n    }\n\n    script.async = options.scriptAsyncLoading || false;\n    script.src = url;\n    function loadHandler () {\n        script.parentNode!.removeChild(script);\n        script.removeEventListener('load', loadHandler, false);\n        script.removeEventListener('error', errorHandler, false);\n        downloaded[url] = true;\n        if (onComplete) { onComplete(null); }\n    }\n\n    function errorHandler () {\n        script.parentNode!.removeChild(script);\n        script.removeEventListener('load', loadHandler, false);\n        script.removeEventListener('error', errorHandler, false);\n        if (onComplete) { onComplete(new Error(getError(4928, url))); }\n    }\n\n    script.addEventListener('load', loadHandler, false);\n    script.addEventListener('error', errorHandler, false);\n    document.body.appendChild(script);\n    return script;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { BUILD, EDITOR } from 'internal:constants';\nimport { sys } from '../platform/sys';\nimport { js } from '../utils/js';\nimport { callInNextTick } from '../utils/misc';\nimport { basename, mainFileName } from '../utils/path';\nimport Cache from './cache';\nimport downloadDomImage from './download-dom-image';\nimport downloadFile from './download-file';\nimport downloadScript from './download-script';\nimport { CompleteCallback, CompleteCallbackNoData, IBundleOptions, IDownloadParseOptions, files } from './shared';\nimport { retry, RetryFunction, urlAppendTimestamp } from './utilities';\nimport { legacyCC } from '../global-exports';\nimport { IConfigOption } from './config';\nimport { CCON, parseCCONJson, decodeCCONBinary } from '../data/ccon';\n\nexport type DownloadHandler = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback) => void;\n\ninterface IDownloadRequest {\n    id: string;\n    priority: number;\n    url: string;\n    options: IDownloadParseOptions;\n    done: CompleteCallback;\n    handler: DownloadHandler;\n}\n\nconst REGEX = /^(?:\\w+:\\/\\/|\\.+\\/).+/;\n\nconst downloadImage = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback) => {\n    // if createImageBitmap is valid, we can transform blob to ImageBitmap. Otherwise, just use HTMLImageElement to load\n    const func = sys.hasFeature(sys.Feature.IMAGE_BITMAP) && legacyCC.assetManager.allowImageBitmap ? downloadBlob : downloadDomImage;\n    func(url, options, onComplete);\n};\n\nconst downloadBlob = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback) => {\n    options.xhrResponseType = 'blob';\n    downloadFile(url, options, options.onFileProgress, onComplete);\n};\n\nconst downloadJson = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback<Record<string, any>>) => {\n    options.xhrResponseType = 'json';\n    downloadFile(url, options, options.onFileProgress, onComplete);\n};\n\nconst downloadArrayBuffer = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback) => {\n    options.xhrResponseType = 'arraybuffer';\n    downloadFile(url, options, options.onFileProgress, onComplete);\n};\n\nconst downloadCCON = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback<CCON>) => {\n    downloadJson(url, options, (err, json) => {\n        if (err) {\n            onComplete(err);\n            return;\n        }\n        const cconPreface = parseCCONJson(json);\n        const chunkPromises = Promise.all(cconPreface.chunks.map((chunk) => new Promise<Uint8Array>((resolve, reject) => {\n            downloadArrayBuffer(`${mainFileName(url)}${chunk}`, {}, (errChunk, chunkBuffer) => {\n                if (err) {\n                    reject(err);\n                } else {\n                    resolve(new Uint8Array(chunkBuffer));\n                }\n            });\n        })));\n        chunkPromises.then((chunks) => {\n            const ccon = new CCON(cconPreface.document, chunks);\n            onComplete(null, ccon);\n        }).catch((err) => {\n            onComplete(err);\n        });\n    });\n};\n\nconst downloadCCONB = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback<CCON>) => {\n    downloadArrayBuffer(url, options, (err, arrayBuffer: ArrayBuffer) => {\n        if (err) {\n            onComplete(err);\n            return;\n        }\n        try {\n            const ccon = decodeCCONBinary(new Uint8Array(arrayBuffer));\n            onComplete(null, ccon);\n        } catch (err) {\n            onComplete(err as Error);\n        }\n    });\n};\n\nconst downloadText = (url: string, options: IDownloadParseOptions, onComplete: CompleteCallback) => {\n    options.xhrResponseType = 'text';\n    downloadFile(url, options, options.onFileProgress, onComplete);\n};\n\nconst downloadBundle = (nameOrUrl: string, options: IBundleOptions, onComplete: CompleteCallback) => {\n    const bundleName = basename(nameOrUrl);\n    let url = nameOrUrl;\n    if (!REGEX.test(url)) {\n        if (downloader.remoteBundles.indexOf(bundleName) !== -1) {\n            url = `${downloader.remoteServerAddress}remote/${bundleName}`;\n        } else {\n            url = `assets/${bundleName}`;\n        }\n    }\n    const version = options.version || downloader.bundleVers![bundleName];\n    let count = 0;\n    const config = `${url}/config.${version ? `${version}.` : ''}json`;\n    let out: IConfigOption | null = null;\n    let error: Error | null = null;\n    downloadJson(config, options, (err, response) => {\n        error = err;\n        out = response as IConfigOption;\n        if (out) { out.base = `${url}/`; }\n        if (++count === 2) {\n            onComplete(error, out);\n        }\n    });\n\n    const jspath = `${url}/index.${version ? `${version}.` : ''}js`;\n    downloadScript(jspath, options, (err) => {\n        error = err;\n        if (++count === 2) {\n            onComplete(err, out);\n        }\n    });\n};\n\n/**\n * @en\n * Control all download process, it is a singleton.\n * All member can be accessed with `assetManager.downloader`, it can download several types of files:\n * 1. Text\n * 2. Image\n * 3. Audio\n * 4. Assets\n * 5. Scripts\n *\n * @zh\n * 管理所有下载过程，downloader 是个单例，所有成员能通过 `assetManager.downloader` 访问，它能下载以下几种类型的文件：\n * 1. 文本\n * 2. 图片\n * 3. 音频\n * 4. 资源\n * 5. 脚本\n *\n */\nexport class Downloader {\n    /**\n     * @en\n     * The maximum number of concurrent when downloading\n     *\n     * @zh\n     * 下载时的最大并发数\n     */\n    public maxConcurrency = 6;\n\n    /**\n     * @en\n     * The maximum number of request can be launched per frame when downloading\n     *\n     * @zh\n     * 下载时每帧可以启动的最大请求数\n     *\n     */\n    public maxRequestsPerFrame = 6;\n\n    /**\n     * @en\n     * The address of remote server\n     *\n     * @zh\n     * 远程服务器地址\n     *\n     */\n    public get remoteServerAddress () {\n        return this._remoteServerAddress;\n    }\n\n    /**\n     * @en\n     * The max number of retries when fail\n     *\n     * @zh\n     * 失败重试次数\n     *\n     * @property maxRetryCount\n     * @type {Number}\n     */\n    public maxRetryCount = BUILD ? 3 : 0;\n\n    public appendTimeStamp = !!EDITOR;\n\n    public limited = !EDITOR;\n\n    /**\n     * @en\n     * Wait for while before another retry, unit: ms\n     *\n     * @zh\n     * 重试的间隔时间\n     *\n     */\n    public retryInterval = 2000;\n\n    public bundleVers: Record<string, string> | null = null;\n\n    public remoteBundles: string[] = [];\n\n    public downloadDomImage = downloadDomImage;\n\n    public downloadDomAudio: DownloadHandler | null = null;\n\n    public downloadFile = downloadFile;\n\n    public downloadScript = downloadScript;\n\n    // default handler map\n    private _downloaders: Record<string, DownloadHandler> = {\n        // Images\n        '.png': downloadImage,\n        '.jpg': downloadImage,\n        '.bmp': downloadImage,\n        '.jpeg': downloadImage,\n        '.gif': downloadImage,\n        '.ico': downloadImage,\n        '.tiff': downloadImage,\n        '.webp': downloadImage,\n        '.image': downloadImage,\n        '.pvr': downloadArrayBuffer,\n        '.pkm': downloadArrayBuffer,\n        '.astc': downloadArrayBuffer,\n\n        // Txt\n        '.txt': downloadText,\n        '.xml': downloadText,\n        '.vsh': downloadText,\n        '.fsh': downloadText,\n        '.atlas': downloadText,\n\n        '.tmx': downloadText,\n        '.tsx': downloadText,\n\n        '.json': downloadJson,\n        '.ExportJson': downloadJson,\n        '.plist': downloadText,\n\n        '.ccon': downloadCCON,\n        '.cconb': downloadCCONB,\n\n        '.fnt': downloadText,\n\n        // Binary\n        '.binary': downloadArrayBuffer,\n        '.bin': downloadArrayBuffer,\n        '.dbbin': downloadArrayBuffer,\n        '.skel': downloadArrayBuffer,\n\n        '.js': downloadScript,\n\n        bundle: downloadBundle,\n\n        default: downloadText,\n    };\n\n    private _downloading = new Cache<CompleteCallback[]>();\n    private _queue: IDownloadRequest[] = [];\n    private _queueDirty = false;\n    // the number of loading thread\n    private _totalNum = 0;\n    // the number of request that launched in this period\n    private _totalNumThisPeriod = 0;\n    // last time, if now - lastTime > period, refresh _totalNumThisPeriod.\n    private _lastDate = -1;\n    // if _totalNumThisPeriod equals max, move request to next period using setTimeOut.\n    private _checkNextPeriod = false;\n    private _remoteServerAddress = '';\n    private _maxInterval = 1 / 30;\n\n    public init (remoteServerAddress = '', bundleVers: Record<string, string> = {}, remoteBundles: string[] = []) {\n        this._downloading.clear();\n        this._queue.length = 0;\n        this._remoteServerAddress = remoteServerAddress;\n        this.bundleVers = bundleVers;\n        this.remoteBundles = remoteBundles;\n    }\n\n    /**\n     * @en\n     * Register custom handler if you want to change default behavior or extend downloader to download other format file\n     *\n     * @zh\n     * 当你想修改默认行为或者拓展 downloader 来下载其他格式文件时可以注册自定义的 handler\n     *\n     * @param type - Extension likes '.jpg' or map likes {'.jpg': jpgHandler, '.png': pngHandler}\n     * @param handler - handler\n     * @param handler.url - url\n     * @param handler.options - some optional parameters will be transferred to handler.\n     * @param handler.onComplete - callback when finishing downloading\n     *\n     * @example\n     * downloader.register('.tga', (url, options, onComplete) => onComplete(null, null));\n     * downloader.register({'.tga': (url, options, onComplete) => onComplete(null, null),\n     *                      '.ext': (url, options, onComplete) => onComplete(null, null)});\n     *\n     */\n    public register (type: string, handler: DownloadHandler): void;\n    public register (map: Record<string, DownloadHandler>): void;\n    public register (type: string | Record<string, DownloadHandler>, handler?: DownloadHandler) {\n        if (typeof type === 'object') {\n            js.mixin(this._downloaders, type);\n        } else {\n            this._downloaders[type] = handler as DownloadHandler;\n        }\n    }\n\n    /**\n     * @en\n     * Use corresponding handler to download file under limitation\n     *\n     * @zh\n     * 在限制下使用对应的 handler 来下载文件\n     *\n     * @param id - The unique id of this download\n     * @param url - The url should be downloaded\n     * @param type - The type indicates that which handler should be used to download, such as '.jpg'\n     * @param options - some optional parameters will be transferred to the corresponding handler.\n     * @param options.onFileProgress - progressive callback will be transferred to handler.\n     * @param options.maxRetryCount - How many times should retry when download failed\n     * @param options.maxConcurrency - The maximum number of concurrent when downloading\n     * @param options.maxRequestsPerFrame - The maximum number of request can be launched per frame when downloading\n     * @param options.priority - The priority of this url, default is 0, the greater number is higher priority.\n     * @param onComplete - callback when finishing downloading\n     * @param onComplete.err - The occurred error, null indicates success\n     * @param onComplete.content - The downloaded file\n     *\n     * @example\n     * download('http://example.com/test.tga', '.tga', { onFileProgress: (loaded, total) => console.log(loaded/total) },\n     *      onComplete: (err) => console.log(err));\n     */\n    public download (id: string, url: string, type: string, options: IDownloadParseOptions, onComplete: CompleteCallback): void {\n        // if it is downloaded, don't download again\n        const file = files.get(id);\n        if (file) {\n            onComplete(null, file);\n            return;\n        }\n\n        const downloadCallbacks = this._downloading.get(id);\n        if (downloadCallbacks) {\n            downloadCallbacks.push(onComplete);\n            const request = this._queue.find((x) => x.id === id);\n            if (!request) { return; }\n            const priority: number = options.priority || 0;\n            if (request.priority < priority) {\n                request.priority = priority;\n                this._queueDirty = true;\n            }\n            return;\n        }\n\n        // if download fail, should retry\n        const maxRetryCount = typeof options.maxRetryCount !== 'undefined' ? options.maxRetryCount : this.maxRetryCount;\n        const maxConcurrency = typeof options.maxConcurrency !== 'undefined' ? options.maxConcurrency : this.maxConcurrency;\n        const maxRequestsPerFrame = typeof options.maxRequestsPerFrame !== 'undefined' ? options.maxRequestsPerFrame : this.maxRequestsPerFrame;\n        const handler = this._downloaders[type] || this._downloaders.default;\n\n        const process: RetryFunction = (index, callback) => {\n            if (index === 0) {\n                this._downloading.add(id, [onComplete]);\n            }\n\n            if (!this.limited) {\n                handler(urlAppendTimestamp(url, this.appendTimeStamp), options, callback);\n                return;\n            }\n\n            // refresh\n            this._updateTime();\n\n            const done: CompleteCallback = (err, data) => {\n                // when finish downloading, update _totalNum\n                this._totalNum--;\n                this._handleQueueInNextFrame(maxConcurrency, maxRequestsPerFrame);\n                callback(err, data);\n            };\n\n            if (this._totalNum < maxConcurrency && this._totalNumThisPeriod < maxRequestsPerFrame) {\n                handler(urlAppendTimestamp(url, this.appendTimeStamp), options, done);\n                this._totalNum++;\n                this._totalNumThisPeriod++;\n            } else {\n                // when number of request up to limitation, cache the rest\n                this._queue.push({ id, priority: options.priority || 0, url, options, done, handler });\n                this._queueDirty = true;\n\n                if (this._totalNum < maxConcurrency) { this._handleQueueInNextFrame(maxConcurrency, maxRequestsPerFrame); }\n            }\n        };\n\n        // when retry finished, invoke callbacks\n        const finale = (err, result) => {\n            if (!err) { files.add(id, result); }\n            const callbacks = this._downloading.remove(id) as CompleteCallback[];\n            for (let i = 0, l = callbacks.length; i < l; i++) {\n                callbacks[i](err, result);\n            }\n        };\n\n        retry(process, maxRetryCount, this.retryInterval, finale);\n    }\n\n    /**\n     * @en Load sub package with name.\n     * @zh 通过子包名加载子包代码。\n     * @param name - Sub package name\n     * @param completeCallback -  Callback invoked when sub package loaded\n     * @param {Error} completeCallback.error - error information\n     *\n     * @deprecated loader.downloader.loadSubpackage is deprecated, please use AssetManager.loadBundle instead\n     */\n    public loadSubpackage (name: string, completeCallback?: CompleteCallbackNoData) {\n        legacyCC.assetManager.loadBundle(name, null, completeCallback);\n    }\n\n    private _updateTime () {\n        const now = performance.now();\n        // use deltaTime as interval\n        const deltaTime = legacyCC.game.deltaTime;\n        const interval = deltaTime > this._maxInterval ? this._maxInterval : deltaTime;\n        if (now - this._lastDate > interval * 1000) {\n            this._totalNumThisPeriod = 0;\n            this._lastDate = now;\n        }\n    }\n\n    // handle the rest request in next period\n    private _handleQueue (maxConcurrency: number, maxRequestsPerFrame: number) {\n        this._checkNextPeriod = false;\n        this._updateTime();\n        while (this._queue.length > 0 && this._totalNum < maxConcurrency && this._totalNumThisPeriod < maxRequestsPerFrame) {\n            if (this._queueDirty) {\n                this._queue.sort((a, b) => a.priority - b.priority);\n                this._queueDirty = false;\n            }\n            const request = this._queue.pop();\n            if (!request) {\n                break;\n            }\n            this._totalNum++;\n            this._totalNumThisPeriod++;\n            request.handler(urlAppendTimestamp(request.url, this.appendTimeStamp), request.options, request.done);\n        }\n\n        this._handleQueueInNextFrame(maxConcurrency, maxRequestsPerFrame);\n    }\n\n    private _handleQueueInNextFrame (maxConcurrency: number, maxRequestsPerFrame: number) {\n        if (!this._checkNextPeriod && this._queue.length > 0) {\n            callInNextTick(this._handleQueue.bind(this), maxConcurrency, maxRequestsPerFrame);\n            this._checkNextPeriod = true;\n        }\n    }\n}\n\nconst downloader = new Downloader();\n\nexport default downloader;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable, editable } from 'cc.decorator';\nimport { Asset } from './asset';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Json asset, it will automatically parse the json to a JS object.\n * @zh Json 资源。\n * Json 资源加载后将直接解析为对象。如果你希望获得 JSON 的原始文本，你需要使用文本资源（使用文件名后缀“.txt”）。\n */\n@ccclass('cc.JsonAsset')\nexport default class JsonAsset extends Asset {\n    /**\n     * @en The parsed JS object\n     * @zh 解析后的对象。\n     */\n    @serializable\n    @editable\n    public json: object | null = null;\n}\n\nlegacyCC.JsonAsset = JsonAsset;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable, editable } from 'cc.decorator';\nimport { Asset } from './asset';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Class for text file.\n * @zh 文本资源。\n */\n@ccclass('cc.TextAsset')\nexport default class TextAsset extends Asset {\n    /**\n     * @en The text content.\n     * @zh 此资源包含的文本。\n     */\n    @serializable\n    @editable\n    public text = '';\n\n    public toString () {\n        return this.text;\n    }\n}\n\nlegacyCC.TextAsset = TextAsset;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, override } from 'cc.decorator';\nimport { assertIsNonNullable } from '../data/utils/asserts';\nimport { legacyCC } from '../global-exports';\nimport { Asset } from './asset';\n\n@ccclass('cc.BufferAsset')\nexport class BufferAsset extends Asset {\n    private _buffer: ArrayBuffer | null = null;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @override\n    get _nativeAsset () {\n        return this._buffer as ArrayBuffer;\n    }\n    set _nativeAsset (bin: ArrayBufferView | ArrayBuffer) {\n        if (bin instanceof ArrayBuffer) {\n            this._buffer = bin;\n        } else {\n            this._buffer = bin.buffer;\n        }\n    }\n\n    /**\n     * @zh 获取此资源中的缓冲数据。\n     * @en Get the ArrayBuffer data of this asset.\n     * @returns @en The ArrayBuffer. @zh 缓冲数据。\n     */\n    public buffer () {\n        assertIsNonNullable(this._buffer);\n        return this._buffer;\n    }\n\n    public validate () {\n        return !!this.buffer;\n    }\n}\n\nlegacyCC.BufferAsset = BufferAsset;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport { ImageAsset } from '../assets/image-asset';\nimport JsonAsset from '../assets/json-asset';\nimport TextAsset from '../assets/text-asset';\nimport { Asset } from '../assets/asset';\nimport { BufferAsset } from '../assets/buffer-asset';\nimport { js } from '../utils/js';\nimport Bundle, { resources } from './bundle';\nimport Cache from './cache';\nimport { IConfigOption } from './config';\nimport {\n    assets, BuiltinBundleName, bundles, CompleteCallback, IRemoteOptions,\n    IDownloadParseOptions,\n} from './shared';\n\nimport { cache } from './utilities';\n\nexport type CreateHandler = (id: string, data: any, options: IDownloadParseOptions, onComplete: CompleteCallback<Asset|Bundle>) => void;\n\nfunction createImageAsset (id: string, data: HTMLImageElement, options: IDownloadParseOptions, onComplete: CompleteCallback<ImageAsset>) {\n    let out: ImageAsset | null = null;\n    let err: Error | null = null;\n    try {\n        out = new ImageAsset();\n        out._nativeUrl = id;\n        out._nativeAsset = data;\n    } catch (e) {\n        err = e as Error;\n    }\n    onComplete(err, out);\n}\n\nfunction createJsonAsset (id: string, data: Record<string, any>, options: IDownloadParseOptions, onComplete: CompleteCallback<JsonAsset>) {\n    const out = new JsonAsset();\n    out.json = data;\n    onComplete(null, out);\n}\n\nfunction createTextAsset (id: string, data: string, options: IDownloadParseOptions, onComplete: CompleteCallback<TextAsset>) {\n    const out = new TextAsset();\n    out.text = data;\n    onComplete(null, out);\n}\n\nfunction createBufferAsset (id: string, data: ArrayBufferView, options: IDownloadParseOptions, onComplete: CompleteCallback<BufferAsset>) {\n    const out = new BufferAsset();\n    out._nativeUrl = id;\n    out._nativeAsset = data;\n    onComplete(null, out);\n}\n\nfunction createAsset (id: string, data: any, options: IDownloadParseOptions, onComplete: CompleteCallback<Asset>) {\n    const out = new Asset();\n    out._nativeUrl = id;\n    out._nativeAsset = data;\n    onComplete(null, out);\n}\n\nfunction createBundle (id: string, data: IConfigOption, options: IDownloadParseOptions, onComplete: CompleteCallback<Bundle>) {\n    let bundle = bundles.get(data.name);\n    if (!bundle) {\n        bundle = data.name === BuiltinBundleName.RESOURCES ? resources : new Bundle();\n        data.base = data.base || `${id}/`;\n        bundle.init(data);\n    }\n    //HACK: Can not import scripts in GameView due to the difference of Scripting System between the GameView and Preview\n    if (!EDITOR) {\n        import(`virtual:///prerequisite-imports/${bundle.name}`).then(() => {\n            onComplete(null, bundle);\n        }).catch(onComplete);\n    } else {\n        onComplete(null, bundle);\n    }\n}\n\nexport class Factory {\n    private _creating = new Cache<CompleteCallback[]>();\n\n    private _producers: Record<string, CreateHandler> = {\n        // Images\n        '.png': createImageAsset,\n        '.jpg': createImageAsset,\n        '.bmp': createImageAsset,\n        '.jpeg': createImageAsset,\n        '.gif': createImageAsset,\n        '.ico': createImageAsset,\n        '.tiff': createImageAsset,\n        '.webp': createImageAsset,\n        '.image': createImageAsset,\n        '.pvr': createImageAsset,\n        '.pkm': createImageAsset,\n\n        // Txt\n        '.txt': createTextAsset,\n        '.xml': createTextAsset,\n        '.vsh': createTextAsset,\n        '.fsh': createTextAsset,\n        '.atlas': createTextAsset,\n\n        '.tmx': createTextAsset,\n        '.tsx': createTextAsset,\n        '.fnt': createTextAsset,\n\n        '.json': createJsonAsset,\n        '.ExportJson': createJsonAsset,\n\n        // Binary\n        '.binary': createBufferAsset,\n        '.bin': createBufferAsset,\n        '.dbbin': createBufferAsset,\n        '.skel': createBufferAsset,\n\n        bundle: createBundle,\n\n        default: createAsset,\n\n    };\n\n    public register (type: string | Record<string, CreateHandler>, handler?: CreateHandler): void {\n        if (typeof type === 'object') {\n            js.mixin(this._producers, type);\n        } else {\n            this._producers[type] = handler!;\n        }\n    }\n\n    public create (id: string, data: any, type: string, options: IRemoteOptions, onComplete: CompleteCallback<Asset | Bundle>): void {\n        const handler = this._producers[type] || this._producers.default;\n        const asset = assets.get(id);\n        if (!options.reloadAsset && asset) {\n            onComplete(null, asset);\n            return;\n        }\n        const creating = this._creating.get(id);\n        if (creating) {\n            creating.push(onComplete);\n            return;\n        }\n\n        this._creating.add(id, [onComplete]);\n        handler(id, data, options, (err, result) => {\n            if (!err && result instanceof Asset) {\n                result._uuid = id;\n                cache(id, result, options.cacheAsset);\n            }\n            const callbacks = this._creating.remove(id);\n            for (let i = 0, l = callbacks!.length; i < l; i++) {\n                callbacks![i](err, result);\n            }\n        });\n    }\n}\n\nexport default new Factory();\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ImageAsset } from '../assets/image-asset';\nimport { Texture2D } from '../assets/texture-2d';\nimport { packCustomObjData, unpackJSONs } from '../data/deserialize';\nimport { error, errorID } from '../platform/debug';\nimport { js } from '../utils/js';\nimport Cache from './cache';\nimport downloader from './downloader';\nimport { transform } from './helper';\nimport RequestItem from './request-item';\nimport { CompleteCallback, files, IDownloadParseOptions } from './shared';\n\nexport type Unpacker = (packUuid: string[], data: any, options: IDownloadParseOptions, onComplete: CompleteCallback) => void;\n\ninterface IUnpackRequest {\n    onComplete: CompleteCallback;\n    id: string;\n}\n\n/**\n * @en\n * Handle the packed asset, include unpacking, loading, cache and so on. It is a singleton. All member can be accessed with `assetManager.packManager`\n *\n * @zh\n * 处理打包资源，包括拆包，加载，缓存等等，这是一个单例, 所有成员能通过 `assetManager.packManager` 访问\n *\n */\nexport class PackManager {\n    private _loading = new Cache<IUnpackRequest[]>();\n    private _unpackers: Record<string, Unpacker> = {\n        '.json': this.unpackJson,\n    };\n\n    /**\n     * @en\n     * Unpack the json, revert to what it was before packing\n     *\n     * @zh\n     * 拆解 json 包，恢复为打包之前的内容\n     *\n     * @param pack - The pack\n     * @param json - The content of pack\n     * @param options - Some optional parameters\n     * @param onComplete - Callback when finish unpacking\n     * @param onComplete.err - The occurred error, null indicates success\n     * @param onComplete.content - The unpacked assets\n     *\n     * @example\n     * downloader.downloadFile('pack.json', { xhrResponseType: 'json'}, null, (err, file) => {\n     *      packManager.unpackJson(['a', 'b'], file, null, (err, data) => console.log(err));\n     * });\n     *\n     */\n    public unpackJson (pack: string[], json: any, options: IDownloadParseOptions, onComplete: CompleteCallback<Record<string, any>>): void {\n        let out = js.createMap(true);\n        let err: Error | null = null;\n\n        if (Array.isArray(json)) {\n            json = unpackJSONs(json as any);\n\n            if (json.length !== pack.length) {\n                errorID(4915);\n            }\n            for (let i = 0; i < pack.length; i++) {\n                out[`${pack[i]}@import`] = json[i];\n            }\n        } else {\n            const textureType = js.getClassId(Texture2D);\n            const imageAssetType = js.getClassId(ImageAsset);\n            if (json.type === textureType && json.data) {\n                const datas = json.data;\n                if (datas.length !== pack.length) {\n                    errorID(4915);\n                }\n                for (let i = 0; i < pack.length; i++) {\n                    out[`${pack[i]}@import`] = packCustomObjData(textureType, { base: datas[i][0], mipmaps: datas[i][1] });\n                }\n            } else if (json.type === imageAssetType && json.data) {\n                const datas = json.data;\n                if (datas.length !== pack.length) {\n                    errorID(4915);\n                }\n                for (let i = 0; i < pack.length; i++) {\n                    out[`${pack[i]}@import`] = datas[i];\n                }\n            } else {\n                err = new Error('unmatched type pack!');\n                out = null;\n            }\n        }\n        onComplete(err, out);\n    }\n\n    public init () {\n        this._loading.clear();\n    }\n\n    /**\n     * @en\n     * Register custom handler if you want to change default behavior or extend packManager to unpack other format pack\n     *\n     * @zh\n     * 当你想修改默认行为或者拓展 packManager 来拆分其他格式的包时可以注册自定义的 handler\n     *\n     * @param type - Extension likes '.bin' or map likes {'.bin': binHandler, '.ab': abHandler}\n     * @param handler - handler\n     * @param handler.packUuid - The uuid of pack\n     * @param handler.data - The content of pack\n     * @param handler.options - Some optional parameters\n     * @param handler.onComplete - Callback when finishing unpacking\n     *\n     * @example\n     * packManager.register('.bin', (packUuid, file, options, onComplete) => onComplete(null, null));\n     * packManager.register({\n     *  '.bin': (packUuid, file, options, onComplete) => onComplete(null, null),\n     *  '.ab': (packUuid, file, options, onComplete) => onComplete(null, null),\n     * });\n     */\n    public register (type: string, handler: Unpacker): void;\n    public register (map: Record<string, Unpacker>): void;\n    public register (type: string | Record<string, Unpacker>, handler?: Unpacker) {\n        if (typeof type === 'object') {\n            js.mixin(this._unpackers, type);\n        } else {\n            this._unpackers[type] = handler!;\n        }\n    }\n\n    /**\n     * @en\n     * Use corresponding handler to unpack package\n     *\n     * @zh\n     * 用对应的 handler 来进行解包\n     *\n     * @method unpack\n     * @param pack - The uuid of packed assets\n     * @param data - The packed data\n     * @param type - The type indicates that which handler should be used to download, such as '.jpg'\n     * @param options - Some optional parameter\n     * @param onComplete - callback when finishing unpacking\n     * @param onComplete.err -  The occurred error, null indicates success\n     * @param onComplete.data - Original assets\n     *\n     * @example\n     * downloader.downloadFile('pack.json', {xhrResponseType: 'json'}, null, (err, file) => {\n     *      packManager.unpack(['2fawq123d', '1zsweq23f'], file, '.json', null, (err, data) => console.log(err));\n     * });\n     *\n     */\n    public unpack (pack: string[], data: any, type: string, options: IDownloadParseOptions, onComplete: CompleteCallback): void {\n        if (!data) {\n            onComplete(new Error('package data is wrong!'));\n            return;\n        }\n        const unpacker = this._unpackers[type];\n        unpacker(pack, data, options, onComplete);\n    }\n\n    /**\n     * @en\n     * Download request item, If item is not in any package, download as usual. Otherwise, download the corresponding package and unpack it.\n     * And then retrieve the corresponding content form it.\n     *\n     * @zh\n     * 下载请求对象，如果请求对象不在任何包内，则正常下载，否则下载对应的 package 并进行拆解，并取回包内对应的内容\n     *\n     * @param item - Some item you want to download\n     * @param options - Some optional parameters\n     * @param onComplete - Callback when finished\n     * @param onComplete.err - The occurred error, null indicates success\n     * @param onComplete.data - The unpacked data retrieved from package\n     *\n     * @example\n     * var requestItem = AssetManager.RequestItem.create();\n     * requestItem.uuid = 'fcmR3XADNLgJ1ByKhqcC5Z';\n     * requestItem.info = config.getAssetInfo('fcmR3XADNLgJ1ByKhqcC5Z');\n     * packManager.load(requestItem, null, (err, data) => console.log(err));\n     *\n     */\n    public load (item: RequestItem, options: IDownloadParseOptions | null, onComplete: CompleteCallback): void {\n        // if not in any package, download as uausl\n        if (item.isNative || !item.info || !item.info.packs) {\n            downloader.download(item.id, item.url, item.ext, item.options, onComplete);\n            return;\n        }\n\n        if (files.has(item.id)) {\n            onComplete(null, files.get(item.id));\n            return;\n        }\n\n        const packs = item.info.packs;\n\n        // find a loading package\n        let pack = packs.find((val) => this._loading.has(val.uuid));\n\n        if (pack) {\n            this._loading.get(pack.uuid)!.push({ onComplete, id: item.id });\n            return;\n        }\n\n        // download a new package\n        pack = packs[0];\n        this._loading.add(pack.uuid, [{ onComplete, id: item.id }]);\n\n        // find the url of pack\n        const url = transform(pack.uuid, { ext: pack.ext, bundle: item.config!.name }) as string;\n\n        downloader.download(pack.uuid, url, pack.ext, item.options, (err, data) => {\n            files.remove(pack!.uuid);\n            if (err) {\n                error(err.message, err.stack);\n            }\n            // unpack package\n            this.unpack(pack!.packedUuids, data, pack!.ext, item.options, (err2, result) => {\n                if (!err2) {\n                    for (const id in result) {\n                        files.add(id, result[id]);\n                    }\n                }\n                const callbacks = this._loading.remove(pack!.uuid);\n                for (let i = 0, l = callbacks!.length; i < l; i++) {\n                    const cb = callbacks![i];\n                    if (err || err2) {\n                        cb.onComplete(err || err2);\n                        continue;\n                    }\n\n                    const unpackedData = result[cb.id];\n                    if (!unpackedData) {\n                        cb.onComplete(new Error('can not retrieve data from package'));\n                    } else {\n                        cb.onComplete(null, unpackedData);\n                    }\n                }\n            });\n        });\n    }\n}\n\nexport default new PackManager();\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Asset } from '../assets';\nimport { error } from '../platform/debug';\nimport packManager from './pack-manager';\nimport RequestItem from './request-item';\nimport { assets, CompleteCallbackNoData, fetchPipeline } from './shared';\nimport Task from './task';\nimport { clear, forEach, getDepends } from './utilities';\nimport { legacyCC } from '../global-exports';\n\nexport default function fetch (task: Task, done: CompleteCallbackNoData) {\n    let firstTask = false;\n    if (!task.progress) {\n        task.progress = { finish: 0, total: task.input.length, canInvoke: true };\n        firstTask = true;\n    }\n\n    const { options, progress } = task;\n    const depends = [];\n    const total = progress.total as number;\n    const exclude = options!.__exclude__ = options!.__exclude__ || Object.create(null);\n\n    task.output = [];\n\n    forEach(task.input as RequestItem[], (item, cb) => {\n        if (!item.isNative && assets.has(item.uuid)) {\n            const asset = assets.get(item.uuid);\n            item.content = asset!.addRef();\n            task.output.push(item);\n            if (progress.canInvoke) {\n                task.dispatch('progress', ++progress.finish, progress.total, item);\n            }\n            cb();\n            return;\n        }\n\n        packManager.load(item, task.options, (err, data) => {\n            if (err) {\n                if (!task.isFinish) {\n                    if (!legacyCC.assetManager.force || firstTask) {\n                        error(err.message, err.stack);\n                        progress.canInvoke = false;\n                        done(err);\n                    } else {\n                        task.output.push(item);\n                        if (progress.canInvoke) {\n                            task.dispatch('progress', ++progress.finish, progress.total, item);\n                        }\n                    }\n                }\n            } else if (!task.isFinish) {\n                item.file = data;\n                task.output.push(item);\n                if (!item.isNative) {\n                    exclude[item.uuid] = true;\n                    getDepends(item.uuid, data, exclude, depends, item.config!);\n                    progress.total = total + depends.length;\n                }\n                if (progress.canInvoke) {\n                    task.dispatch('progress', ++progress.finish, progress.total, item);\n                }\n            }\n            cb();\n        });\n    }, () => {\n        if (task.isFinish) {\n            clear(task, true);\n            task.dispatch('error');\n            return;\n        }\n        if (depends.length > 0) {\n            // stage 2 , download depend asset\n            const subTask = Task.create({\n                input: depends,\n                progress,\n                options,\n                onProgress: task.onProgress,\n                onError: Task.prototype.recycle,\n                onComplete: (err) => {\n                    if (!err) {\n                        task.output.push(...subTask.output);\n                        subTask.recycle();\n                    }\n                    if (firstTask) { decreaseRef(task); }\n                    done(err);\n                },\n            });\n            fetchPipeline.async(subTask);\n            return;\n        }\n        if (firstTask) { decreaseRef(task); }\n        done();\n    });\n}\n\nfunction decreaseRef (task: Task) {\n    const output = task.output as RequestItem[];\n    for (let i = 0, l = output.length; i < l; i++) {\n        if (output[i].content) {\n            (output[i].content as Asset).decRef(false);\n        }\n    }\n}\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport { warnID } from '../platform/debug';\n\n/**\n * A SAX Parser\n * @class saxParser\n */\nexport class SAXParser {\n    private _parser: DOMParser | null = null;\n    constructor () {\n        if (window.DOMParser) {\n            this._parser = new DOMParser();\n        }\n    }\n\n    /**\n     * @method parse\n     * @param {String} xmlTxt\n     * @return {Document}\n     */\n    public parse (xmlTxt: string): Document {\n        return this._parseXML(xmlTxt);\n    }\n\n    protected _parseXML (textxml: string): Document {\n        // get a reference to the requested corresponding xml file\n        if (this._parser) {\n            return this._parser.parseFromString(textxml, 'text/xml');\n        }\n        throw new Error('Dom parser is not supported in this platform!');\n    }\n}\n\n/**\n *\n * plistParser is a singleton object for parsing plist files\n * @class plistParser\n * @extends SAXParser\n */\nclass PlistParser extends SAXParser {\n    /**\n     * @en parse a xml string as plist object.\n     * @zh 将xml字符串解析为plist对象。\n     * @param {String} xmlTxt - plist xml contents\n     * @return {*} plist object\n     */\n    public parse (xmlTxt): any {\n        const xmlDoc = this._parseXML(xmlTxt);\n        const plist = xmlDoc.documentElement;\n        if (plist.tagName !== 'plist') {\n            warnID(5100);\n            return {};\n        }\n\n        // Get first real node\n        let node: HTMLElement | null = null;\n        for (let i = 0, len = plist.childNodes.length; i < len; i++) {\n            node = plist.childNodes[i] as HTMLElement;\n            if (node.nodeType === 1) {\n                break;\n            }\n        }\n        return this._parseNode(node!);\n    }\n\n    private _parseNode (node: HTMLElement): unknown {\n        let data: any = null;\n        const tagName = node.tagName;\n        if (tagName === 'dict') {\n            data = this._parseDict(node);\n        } else if (tagName === 'array') {\n            data = this._parseArray(node);\n        } else if (tagName === 'string') {\n            if (node.childNodes.length === 1) {\n                data = node.firstChild!.nodeValue;\n            } else {\n                // handle Firefox's 4KB nodeValue limit\n                data = '';\n                for (let i = 0; i < node.childNodes.length; i++) {\n                    data += node.childNodes[i].nodeValue;\n                }\n            }\n        } else if (tagName === 'false') {\n            data = false;\n        } else if (tagName === 'true') {\n            data = true;\n        } else if (tagName === 'real') {\n            data = parseFloat(node.firstChild!.nodeValue!);\n        } else if (tagName === 'integer') {\n            data = parseInt(node.firstChild!.nodeValue!, 10);\n        }\n        return data;\n    }\n\n    private _parseArray (node: HTMLElement): unknown[] {\n        const data: any[] = [];\n        for (let i = 0, len = node.childNodes.length; i < len; i++) {\n            const child = node.childNodes[i];\n            if (child.nodeType !== 1) {\n                continue;\n            }\n            data.push(this._parseNode(child as HTMLElement));\n        }\n        return data;\n    }\n\n    private _parseDict (node: HTMLElement): Record<string, any> {\n        const data = {};\n        let key = '';\n        for (let i = 0, len = node.childNodes.length; i < len; i++) {\n            const child = node.childNodes[i] as HTMLElement;\n            if (child.nodeType !== 1) {\n                continue;\n            }\n\n            // Grab the key, next noe should be the value\n            if (child.tagName === 'key') {\n                key = child.firstChild!.nodeValue!;\n            } else {\n                data[key] = this._parseNode(child);\n            }                 // Parse the value node\n        }\n        return data;\n    }\n}\n\n/**\n * @type {PlistParser}\n * @name plistParser\n * A Plist Parser\n */\nconst plistParser = new PlistParser();\n\nexport default plistParser;\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Asset } from '..';\nimport { IMemoryImageSource } from '../assets/image-asset';\nimport { js } from '../utils/js';\nimport Cache from './cache';\nimport deserialize from './deserialize';\nimport { isScene } from './helper';\nimport plistParser from './plist-parser';\nimport { CompleteCallback, IDownloadParseOptions, files, parsed } from './shared';\n\nimport { PixelFormat } from '../assets/asset-enum';\nimport { CCON } from '../data/ccon';\n\n// PVR constants //\n// https://github.com/toji/texture-tester/blob/master/js/webgl-texture-util.js#L424\nconst PVR_HEADER_LENGTH = 13; // The header length in 32 bit ints.\nconst PVR_MAGIC = 0x03525650; // 0x50565203;\n\n// Offsets into the header array.\nconst PVR_HEADER_MAGIC = 0;\nconst PVR_HEADER_FORMAT = 2;\nconst PVR_HEADER_HEIGHT = 6;\nconst PVR_HEADER_WIDTH = 7;\nconst PVR_HEADER_MIPMAPCOUNT = 11;\nconst PVR_HEADER_METADATA = 12;\n\n// ETC constants //\nconst ETC_PKM_HEADER_SIZE = 16;\n\nconst ETC_PKM_FORMAT_OFFSET = 6;\nconst ETC_PKM_ENCODED_WIDTH_OFFSET = 8;\nconst ETC_PKM_ENCODED_HEIGHT_OFFSET = 10;\nconst ETC_PKM_WIDTH_OFFSET = 12;\nconst ETC_PKM_HEIGHT_OFFSET = 14;\n\nconst ETC1_RGB_NO_MIPMAPS = 0;\nconst ETC2_RGB_NO_MIPMAPS = 1;\nconst ETC2_RGBA_NO_MIPMAPS = 3;\n\n//= ==============//\n// ASTC constants //\n//= ==============//\n\n// struct astc_header\n// {\n//  uint8_t magic[4];\n//  uint8_t blockdim_x;\n//  uint8_t blockdim_y;\n//  uint8_t blockdim_z;\n//  uint8_t xsize[3]; // x-size = xsize[0] + xsize[1] + xsize[2]\n//  uint8_t ysize[3]; // x-size, y-size and z-size are given in texels;\n//  uint8_t zsize[3]; // block count is inferred\n// };\nconst ASTC_MAGIC = 0x5CA1AB13;\n\nconst ASTC_HEADER_LENGTH = 16; // The header length\nconst ASTC_HEADER_MAGIC = 4;\nconst ASTC_HEADER_BLOCKDIM = 3;\n\nconst ASTC_HEADER_SIZE_X_BEGIN = 7;\nconst ASTC_HEADER_SIZE_Y_BEGIN = 10;\nconst ASTC_HEADER_SIZE_Z_BEGIN = 13;\n\nfunction getASTCFormat (xdim, ydim) {\n    if (xdim === 4) {\n        return PixelFormat.RGBA_ASTC_4x4;\n    } if (xdim === 5) {\n        if (ydim === 4) {\n            return PixelFormat.RGBA_ASTC_5x4;\n        }\n        return PixelFormat.RGBA_ASTC_5x5;\n    } if (xdim === 6) {\n        if (ydim === 5) {\n            return PixelFormat.RGBA_ASTC_6x5;\n        }\n        return PixelFormat.RGBA_ASTC_6x6;\n    } if (xdim === 8) {\n        if (ydim === 5) {\n            return PixelFormat.RGBA_ASTC_8x5;\n        } if (ydim === 6) {\n            return PixelFormat.RGBA_ASTC_8x6;\n        }\n        return PixelFormat.RGBA_ASTC_8x8;\n    } if (xdim === 10) {\n        if (ydim === 5) {\n            return PixelFormat.RGBA_ASTC_10x5;\n        } if (ydim === 6) {\n            return PixelFormat.RGBA_ASTC_10x6;\n        } if (ydim === 8) {\n            return PixelFormat.RGBA_ASTC_10x8;\n        }\n        return PixelFormat.RGBA_ASTC_10x10;\n    }\n    if (ydim === 10) {\n        return PixelFormat.RGBA_ASTC_12x10;\n    }\n    return PixelFormat.RGBA_ASTC_12x12;\n}\n\nfunction readBEUint16 (header, offset: number) {\n    return (header[offset] << 8) | header[offset + 1];\n}\n\nexport type ParseHandler = (file: any, options: IDownloadParseOptions, onComplete: CompleteCallback) => void;\n\n/**\n * @en\n * Parse the downloaded file, it's a singleton, all member can be accessed with `assetManager.parser`\n *\n * @zh\n * 解析已下载的文件，parser 是一个单例, 所有成员能通过 `assetManaager.parser` 访问\n *\n */\nexport class Parser {\n    private _parsing = new Cache<CompleteCallback[]>();\n\n    private _parsers: Record<string, ParseHandler> = {\n        '.png': this.parseImage,\n        '.jpg': this.parseImage,\n        '.bmp': this.parseImage,\n        '.jpeg': this.parseImage,\n        '.gif': this.parseImage,\n        '.ico': this.parseImage,\n        '.tiff': this.parseImage,\n        '.webp': this.parseImage,\n        '.image': this.parseImage,\n        '.pvr': this.parsePVRTex,\n        '.pkm': this.parsePKMTex,\n        '.astc': this.parseASTCTex,\n\n        // plist\n        '.plist': this.parsePlist,\n        import: this.parseImport,\n\n        '.ccon': this.parseImport,\n        '.cconb': this.parseImport,\n    };\n\n    public parseImage (file: HTMLImageElement | Blob, options: IDownloadParseOptions, onComplete: CompleteCallback<HTMLImageElement|ImageBitmap>) {\n        if (file instanceof HTMLImageElement) {\n            onComplete(null, file);\n            return;\n        }\n        createImageBitmap(file, { premultiplyAlpha: 'none' }).then((result) => {\n            onComplete(null, result);\n        }, (err) => {\n            onComplete(err, null);\n        });\n    }\n\n    public parsePVRTex (file: ArrayBuffer | ArrayBufferView, options: IDownloadParseOptions, onComplete: CompleteCallback<IMemoryImageSource>) {\n        let err: Error | null = null;\n        let out: IMemoryImageSource | null = null;\n        try {\n            const buffer = file instanceof ArrayBuffer ? file : file.buffer;\n            // Get a view of the arrayBuffer that represents the DDS header.\n            const header = new Int32Array(buffer, 0, PVR_HEADER_LENGTH);\n\n            // Do some sanity checks to make sure this is a valid DDS file.\n            if (header[PVR_HEADER_MAGIC] === PVR_MAGIC) {\n                // Gather other basic metrics and a view of the raw the DXT data.\n                const width = header[PVR_HEADER_WIDTH];\n                const height = header[PVR_HEADER_HEIGHT];\n                const dataOffset = header[PVR_HEADER_METADATA] + 52;\n                // todo: use new Uint8Array(buffer, dataOffset) instead\n                // buffer = buffer.slice(dataOffset, buffer.byteLength);\n                const pvrtcData = new Uint8Array(buffer, dataOffset);\n                out = {\n                    _data: pvrtcData,\n                    _compressed: true,\n                    width,\n                    height,\n                    format: 0,\n                };\n            } else if (header[11] === 0x21525650) {\n                const headerLength = header[0];\n                const height = header[1];\n                const width = header[2];\n                // todo: use new Uint8Array(buffer, headerLength) instead\n                // buffer = buffer.slice(headerLength, buffer.byteLength);\n                const pvrtcData = new Uint8Array(buffer, headerLength);\n                out = {\n                    _data: pvrtcData,\n                    _compressed: true,\n                    width,\n                    height,\n                    format: 0,\n                };\n            } else {\n                throw new Error('Invalid magic number in PVR header');\n            }\n        } catch (e) {\n            err = e as Error;\n        }\n        onComplete(err, out);\n    }\n\n    public parsePKMTex (file: ArrayBuffer | ArrayBufferView, options: IDownloadParseOptions, onComplete: CompleteCallback<IMemoryImageSource>) {\n        let err: Error | null = null;\n        let out: IMemoryImageSource | null = null;\n        try {\n            const buffer = file instanceof ArrayBuffer ? file : file.buffer;\n            const header = new Uint8Array(buffer);\n            const format = readBEUint16(header, ETC_PKM_FORMAT_OFFSET);\n            if (format !== ETC1_RGB_NO_MIPMAPS && format !== ETC2_RGB_NO_MIPMAPS && format !== ETC2_RGBA_NO_MIPMAPS) {\n                throw new Error('Invalid magic number in ETC header');\n            }\n            const width = readBEUint16(header, ETC_PKM_WIDTH_OFFSET);\n            const height = readBEUint16(header, ETC_PKM_HEIGHT_OFFSET);\n            const encodedWidth = readBEUint16(header, ETC_PKM_ENCODED_WIDTH_OFFSET);\n            const encodedHeight = readBEUint16(header, ETC_PKM_ENCODED_HEIGHT_OFFSET);\n            const etcData = new Uint8Array(buffer, ETC_PKM_HEADER_SIZE);\n            out = {\n                _data: etcData,\n                _compressed: true,\n                width,\n                height,\n                format: 0,\n            };\n        } catch (e) {\n            err = e as Error;\n        }\n        onComplete(err, out);\n    }\n\n    public parseASTCTex (file: ArrayBuffer | ArrayBufferView, options: IDownloadParseOptions, onComplete: CompleteCallback<IMemoryImageSource>) {\n        let err: Error | null = null;\n        let out: IMemoryImageSource | null = null;\n        try {\n            const buffer = file instanceof ArrayBuffer ? file : file.buffer;\n            const header = new Uint8Array(buffer);\n\n            const magicval = header[0] + (header[1] << 8) + (header[2] << 16) + (header[3] << 24);\n            if (magicval !== ASTC_MAGIC) {\n                throw new Error('Invalid magic number in ASTC header');\n            }\n\n            const xdim = header[ASTC_HEADER_MAGIC];\n            const ydim = header[ASTC_HEADER_MAGIC + 1];\n            const zdim = header[ASTC_HEADER_MAGIC + 2];\n            if ((xdim < 3 || xdim > 6 || ydim < 3 || ydim > 6 || zdim < 3 || zdim > 6)\n                && (xdim < 4 || xdim === 7 || xdim === 9 || xdim === 11 || xdim > 12\n                || ydim < 4 || ydim === 7 || ydim === 9 || ydim === 11 || ydim > 12 || zdim !== 1)) {\n                throw new Error('Invalid block number in ASTC header');\n            }\n\n            const format = getASTCFormat(xdim, ydim);\n\n            const xsize = header[ASTC_HEADER_SIZE_X_BEGIN] + (header[ASTC_HEADER_SIZE_X_BEGIN + 1] << 8)\n                + (header[ASTC_HEADER_SIZE_X_BEGIN + 2] << 16);\n            const ysize = header[ASTC_HEADER_SIZE_Y_BEGIN] + (header[ASTC_HEADER_SIZE_Y_BEGIN + 1] << 8)\n                + (header[ASTC_HEADER_SIZE_Y_BEGIN + 2] << 16);\n            const zsize = header[ASTC_HEADER_SIZE_Z_BEGIN] + (header[ASTC_HEADER_SIZE_Z_BEGIN + 1] << 8)\n                + (header[ASTC_HEADER_SIZE_Z_BEGIN + 2] << 16);\n\n            // buffer = buffer.slice(ASTC_HEADER_LENGTH, buffer.byteLength);\n            const astcData = new Uint8Array(buffer, ASTC_HEADER_LENGTH);\n\n            out = {\n                _data: astcData,\n                _compressed: true,\n                width: xsize,\n                height: ysize,\n                format,\n            };\n        } catch (e) {\n            err = e as Error;\n        }\n        onComplete(err, out);\n    }\n\n    public parsePlist (file: string, options: IDownloadParseOptions, onComplete: CompleteCallback) {\n        let err: Error | null = null;\n        const result = plistParser.parse(file);\n        if (!result) { err = new Error('parse failed'); }\n        onComplete(err, result);\n    }\n\n    public parseImport (file: Record<string, any> | CCON, options: IDownloadParseOptions, onComplete: CompleteCallback<Asset>) {\n        if (!file) {\n            onComplete(new Error(`The json file of asset ${options.__uuid__ as string} is empty or missing`));\n            return;\n        }\n        let result: Asset | null = null;\n        let err: Error | null = null;\n        try {\n            result = deserialize(file, options);\n        } catch (e) {\n            err = e as Error;\n        }\n        onComplete(err, result);\n    }\n\n    public init () {\n        this._parsing.clear();\n    }\n\n    /**\n     * @en\n     * Register custom handler if you want to change default behavior or extend parser to parse other format file\n     *\n     * @zh\n     * 当你想修改默认行为或者拓展 parser 来解析其他格式文件时可以注册自定义的handler\n     *\n     * @param type - Extension likes '.jpg' or map likes {'.jpg': jpgHandler, '.png': pngHandler}\n     * @param handler - The corresponding handler\n     * @param handler.file - File\n     * @param handler.options - Some optional paramter\n     * @param handler.onComplete - callback when finishing parsing\n     *\n     * @example\n     * parser.register('.tga', (file, options, onComplete) => onComplete(null, null));\n     * parser.register({'.tga': (file, options, onComplete) => onComplete(null, null),\n     *                  '.ext': (file, options, onComplete) => onComplete(null, null)});\n     *\n     */\n    public register (type: string, handler: ParseHandler): void;\n    public register (map: Record<string, ParseHandler>): void;\n    public register (type: string | Record<string, ParseHandler>, handler?: ParseHandler) {\n        if (typeof type === 'object') {\n            js.mixin(this._parsers, type);\n        } else {\n            this._parsers[type] = handler as ParseHandler;\n        }\n    }\n\n    /**\n     * @en\n     * Use corresponding handler to parse file\n     *\n     * @zh\n     * 使用对应的handler来解析文件\n     *\n     * @param id - The id of file\n     * @param file - File\n     * @param type - The corresponding type of file, likes '.jpg'.\n     * @param options - Some optional parameters will be transferred to the corresponding handler.\n     * @param onComplete - callback when finishing downloading\n     * @param onComplete.err - The occurred error, null indicates success\n     * @param onComplete.content - The parsed file\n     *\n     * @example\n     * downloader.download('test.jpg', 'test.jpg', '.jpg', {}, (err, file) => {\n     *      parser.parse('test.jpg', file, '.jpg', null, (err, img) => console.log(err));\n     * });\n     *\n     */\n    public parse (id: string, file: any, type: string, options: IDownloadParseOptions, onComplete: CompleteCallback): void {\n        const parsedAsset = parsed.get(id);\n        if (parsedAsset) {\n            onComplete(null, parsedAsset);\n            return;\n        }\n        const parsing = this._parsing.get(id);\n        if (parsing) {\n            parsing.push(onComplete);\n            return;\n        }\n\n        const parseHandler = this._parsers[type];\n        if (!parseHandler) {\n            onComplete(null, file);\n            return;\n        }\n\n        this._parsing.add(id, [onComplete]);\n        parseHandler(file, options, (err, data) => {\n            if (err) {\n                files.remove(id);\n            } else if (!isScene(data)) {\n                parsed.add(id, data);\n            }\n            const callbacks = this._parsing.remove(id);\n            for (let i = 0, l = callbacks!.length; i < l; i++) {\n                callbacks![i](err, data);\n            }\n        });\n    }\n}\n\nexport default new Parser();\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { BUILD, EDITOR, PREVIEW } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport { error, warn } from '../platform/debug';\nimport packManager from './pack-manager';\nimport parser from './parser';\nimport { Pipeline } from './pipeline';\nimport RequestItem from './request-item';\nimport { CompleteCallbackNoData, assets, files, parsed, pipeline } from './shared';\nimport Task from './task';\nimport { cache, checkCircleReference, clear, forEach, gatherAsset, getDepends, setProperties } from './utilities';\nimport { legacyCC } from '../global-exports';\nimport { nativeDependMap, onLoadedInvokedMap } from './depend-maps';\n\ninterface IProgress {\n    finish: number;\n    total: number;\n    canInvoke: boolean;\n}\n\ninterface ILoadingRequest {\n    content: Asset;\n    finish: boolean;\n    err?: Error | null;\n    callbacks: Array<{ done: CompleteCallbackNoData; item: RequestItem }>;\n}\n\nexport default function load (task: Task, done: CompleteCallbackNoData) {\n    let firstTask = false;\n    if (!task.progress) {\n        task.progress = { finish: 0, total: task.input.length, canInvoke: true };\n        firstTask = true;\n    }\n\n    const { options, progress } = task;\n\n    options!.__exclude__ = options!.__exclude__ || Object.create(null);\n\n    task.output = [];\n\n    forEach(task.input as RequestItem[], (item, cb) => {\n        const subTask = Task.create({\n            input: item,\n            onProgress: task.onProgress,\n            options,\n            progress,\n            onComplete: (err, result) => {\n                if (err && !task.isFinish) {\n                    if (!legacyCC.assetManager.force || firstTask) {\n                        if (BUILD) {\n                            error(err.message, err.stack);\n                        }\n                        progress.canInvoke = false;\n                        done(err);\n                    } else if (progress.canInvoke) {\n                        task.dispatch('progress', ++progress.finish, progress.total, item);\n                    }\n                }\n                task.output.push(result);\n                subTask.recycle();\n                cb(null);\n            },\n        });\n\n        loadOneAssetPipeline.async(subTask);\n    }, () => {\n        options!.__exclude__ = null;\n\n        if (task.isFinish) {\n            clear(task, true);\n            task.dispatch('error');\n            return;\n        }\n\n        gatherAsset(task);\n        clear(task, true);\n        done();\n    });\n}\n\nconst loadOneAssetPipeline = new Pipeline('loadOneAsset', [\n\n    function fetch (task, done) {\n        const item = task.output = task.input as RequestItem;\n        const { options, isNative, uuid, file } = item;\n        const { reloadAsset } = options;\n\n        if (file || (!reloadAsset && !isNative && assets.has(uuid))) {\n            done();\n            return;\n        }\n\n        packManager.load(item, task.options, (err, data) => {\n            item.file = data;\n            done(err);\n        });\n    },\n\n    function parse (task, done) {\n        const item: RequestItem = task.output = task.input;\n        const progress: IProgress = task.progress;\n        const exclude: Record<string, ILoadingRequest> = task.options!.__exclude__;\n        const { id, file, options } = item;\n\n        if (item.isNative) {\n            parser.parse(id, file, item.ext, options, (err, asset) => {\n                if (err) {\n                    done(err);\n                    return;\n                }\n                item.content = asset;\n                if (progress.canInvoke) {\n                    task.dispatch('progress', ++progress.finish, progress.total, item);\n                }\n                files.remove(id);\n                parsed.remove(id);\n                done();\n            });\n        } else {\n            const { uuid } = item;\n            if (uuid in exclude) {\n                const { finish, content, err, callbacks } = exclude[uuid];\n                if (progress.canInvoke) {\n                    task.dispatch('progress', ++progress.finish, progress.total, item);\n                }\n\n                if (finish || checkCircleReference(uuid, uuid, exclude)) {\n                    if (content) { content.addRef(); }\n                    item.content = content;\n                    done(err);\n                } else {\n                    callbacks.push({ done, item });\n                }\n            } else if (!options.reloadAsset && assets.has(uuid)) {\n                const asset = assets.get(uuid)!;\n                item.content = asset.addRef();\n                if (progress.canInvoke) {\n                    task.dispatch('progress', ++progress.finish, progress.total, item);\n                }\n                done();\n            } else {\n                options.__uuid__ = uuid;\n                parser.parse(id, file, 'import', options, (err, asset: Asset) => {\n                    if (err) {\n                        done(err);\n                        return;\n                    }\n                    loadDepends(task, asset, done);\n                });\n            }\n        }\n    },\n]);\n\nfunction loadDepends (task: Task, asset: Asset, done: CompleteCallbackNoData) {\n    const { input: item, progress } = task;\n    const { uuid, id, options, config } = item as RequestItem;\n    const { cacheAsset } = options;\n\n    const depends = [];\n    // add reference avoid being released during loading dependencies\n    if (asset.addRef) {\n        asset.addRef();\n    }\n    getDepends(uuid, asset, Object.create(null), depends, config!);\n    if (progress.canInvoke) {\n        task.dispatch('progress', ++progress.finish, progress.total += depends.length, item);\n    }\n\n    const repeatItem: ILoadingRequest = task.options!.__exclude__[uuid] = { content: asset, finish: false, callbacks: [{ done, item }] };\n\n    const subTask = Task.create({\n        input: depends,\n        options: task.options,\n        onProgress: task.onProgress,\n        onError: Task.prototype.recycle,\n        progress,\n        onComplete: (err) => {\n            if (asset.decRef) {\n                asset.decRef(false);\n            }\n            repeatItem.finish = true;\n            repeatItem.err = err;\n\n            if (!err) {\n                const output = Array.isArray(subTask.output) ? subTask.output : [subTask.output];\n                const map: Record<string, any> = Object.create(null);\n                for (const dependAsset of output) {\n                    if (!dependAsset) { continue; }\n                    map[dependAsset instanceof Asset ? `${dependAsset._uuid}@import` : `${uuid}@native`] = dependAsset;\n                }\n\n                setProperties(uuid, asset, map);\n                try {\n                    if (typeof asset.onLoaded === 'function' && !onLoadedInvokedMap.has(asset) && !nativeDependMap.has(asset)) {\n                        asset.onLoaded();\n                        onLoadedInvokedMap.add(asset);\n                    }\n                } catch (e) {\n                    error(`The asset ${uuid} is invalid for some reason, detail message: ${(e as Error).message}, stack: ${(e as Error).stack!}`);\n                    if (EDITOR || PREVIEW) {\n                        if (asset instanceof Asset) {\n                            asset.initDefault();\n                        } else {\n                            // TODO: remove it.\n                            // scene asset might be a json in editor or preview\n                            legacyCC.SceneAsset.prototype.initDefault.call(asset);\n                        }\n                    }\n                }\n                files.remove(id);\n                parsed.remove(id);\n                if (!BUILD && asset.validate && !asset.validate()) {\n                    error(`The asset ${uuid} is invalid for some reason and will be reverted to default asset, please check it out!`);\n                    asset.initDefault();\n                }\n                cache(uuid, asset, cacheAsset);\n                subTask.recycle();\n            }\n\n            const callbacks = repeatItem.callbacks;\n\n            for (let i = 0, l = callbacks.length; i < l; i++) {\n                const cb = callbacks[i];\n                if (asset.addRef) {\n                    asset.addRef();\n                }\n                cb.item.content = asset;\n                cb.done(err);\n            }\n\n            callbacks.length = 0;\n        },\n    });\n\n    pipeline.async(subTask);\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { CompleteCallbackNoData, RequestType, transformPipeline } from './shared';\nimport Task from './task';\n\nexport default function preprocess (task: Task, done: CompleteCallbackNoData) {\n    const options = task.options;\n    const subOptions = Object.create(null);\n    const leftOptions = Object.create(null);\n\n    for (const op in options) {\n        switch (op) {\n        // can't set these attributes in options\n        case RequestType.PATH:\n        case RequestType.UUID:\n        case RequestType.DIR:\n        case RequestType.SCENE:\n        case RequestType.URL: break;\n            // only need these attributes to transform url\n        case '__requestType__':\n        case '__isNative__':\n        case 'ext':\n        case 'type':\n        case '__nativeName__':\n        case 'audioLoadMode':\n        case 'bundle':\n            subOptions[op] = options[op];\n            break;\n            // other settings, left to next pipe\n        case '__exclude__':\n        case '__outputAsArray__':\n            leftOptions[op] = options[op];\n            break;\n        default:\n            subOptions[op] = options[op];\n            leftOptions[op] = options[op];\n            break;\n        }\n    }\n    task.options = leftOptions;\n\n    // transform url\n    const subTask = Task.create({ input: task.input, options: subOptions });\n    let err: Error | null = null;\n    try {\n        task.output = task.source = transformPipeline.sync(subTask);\n    } catch (e) {\n        err = e as Error;\n        for (let i = 0, l = subTask.output.length; i < l; i++) {\n            subTask.output[i].recycle();\n        }\n    }\n    subTask.recycle();\n    done(err);\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport Config, { IAssetInfo } from './config';\n\n/**\n * @en\n * A collection of information about a request\n *\n * @zh\n * 请求的相关信息集合\n *\n */\nexport default class RequestItem {\n    /**\n     * @en\n     * The id of request, combined from uuid and isNative\n     *\n     * @zh\n     * 请求的 id, 由 uuid 和 isNative 组合而成\n     */\n    get id (): string {\n        if (!this._id) {\n            this._id = `${this.overrideUuid || this.uuid}@${this.isNative ? 'native' : 'import'}`;\n        }\n        return this._id;\n    }\n\n    public static MAX_DEAD_NUM = 500;\n\n    /**\n     * @en\n     * Create a new request item from pool\n     *\n     * @zh\n     * 从对象池中创建 requestItem\n     *\n     * @returns requestItem\n     *\n     */\n    public static create (): RequestItem {\n        let out: RequestItem;\n        if (RequestItem._deadPool.length !== 0) {\n            out = RequestItem._deadPool.pop() as RequestItem;\n        } else {\n            out = new RequestItem();\n        }\n\n        return out;\n    }\n\n    private static _deadPool: RequestItem[] = [];\n\n    /**\n     * @en\n     * The uuid of request\n     *\n     * @zh\n     * 请求资源的uuid\n     *\n     */\n    public uuid = '';\n\n    public overrideUuid = '';\n\n    /**\n     * @en\n     * The final url of request\n     *\n     * @zh\n     * 请求的最终url\n     *\n     */\n    public url = '';\n\n    /**\n     * @en\n     * The extension name of asset\n     *\n     * @zh\n     * 资源的扩展名\n     *\n     */\n    public ext = '.json';\n\n    /**\n     * @en\n     * The content of asset\n     *\n     * @zh\n     * 资源的内容\n     *\n     */\n    public content: any = null;\n\n    /**\n     * @en\n     * The file of asset\n     *\n     * @zh\n     * 资源的文件\n     *\n     */\n    public file: any = null;\n\n    /**\n     * @en\n     * The information of asset\n     *\n     * @zh\n     * 资源的相关信息\n     *\n     */\n    public info: IAssetInfo | null = null;\n\n    public config: Config | null = null;\n\n    /**\n     * @en\n     * Whether or not it is native asset\n     *\n     * @zh\n     * 资源是否是原生资源\n     *\n     */\n    public isNative = false;\n\n    /**\n     * @en\n     * Custom options\n     *\n     * @zh\n     * 自定义参数\n     *\n     */\n    public options: Record<string, any> = Object.create(null);\n\n    private _id = '';\n\n    /**\n     * @en\n     * Recycle this for reuse\n     *\n     * @zh\n     * 回收 requestItem 用于复用\n     *\n     */\n    public recycle (): void {\n        if (RequestItem._deadPool.length === RequestItem.MAX_DEAD_NUM) { return; }\n        this._id = '';\n        this.uuid = '';\n        this.overrideUuid = '';\n        this.url = '';\n        this.ext = '.json';\n        this.content = null;\n        this.file = null;\n        this.info = null;\n        this.config = null;\n        this.isNative = false;\n        this.options = Object.create(null);\n        RequestItem._deadPool.push(this);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, PREVIEW } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport { warnID } from '../platform/debug';\nimport { js } from '../utils/js';\nimport * as path from '../utils/path';\nimport Config, { IAddressableInfo, IAssetInfo } from './config';\nimport { decodeUuid } from './helper';\nimport RequestItem from './request-item';\nimport { assetsOverrideMap, bundles, presets, RequestType } from './shared';\nimport Task from './task';\n\nconst infos: IAddressableInfo[] = [];\n\nexport function parse (task: Task) {\n    const options = task.options;\n    const input = Array.isArray(task.input) ? task.input : [task.input];\n\n    task.output = [];\n    for (let i = 0; i < input.length; i++) {\n        let item = input[i];\n        let out: RequestItem | null = RequestItem.create();\n        let config: Config | null = null;\n        let info: IAssetInfo | null = null;\n        if (typeof item === 'string') {\n            item = Object.create(null);\n            item[options!.__requestType__ || RequestType.UUID] = input[i];\n        }\n        if (typeof item === 'object') {\n            // local options will overlap glabal options\n            js.addon(item, options);\n            if (item.preset) {\n                js.addon(item, presets[item.preset]);\n            }\n            for (const key in item) {\n                switch (key) {\n                case RequestType.UUID: {\n                    const uuid = out.uuid = decodeUuid(item.uuid);\n                    if (!item.bundle) {\n                        const bundle = bundles.find((bundle) => !!bundle.getAssetInfo(uuid));\n                        item.bundle = (bundle && bundle.name);\n                    }\n                    if (bundles.has(item.bundle)) {\n                        config = bundles.get(item.bundle)!.config;\n                        info = config.getAssetInfo(uuid);\n                        if (info && info.redirect) {\n                            if (!bundles.has(info.redirect)) { throw new Error(`Please load bundle ${info.redirect} first`); }\n                            config = bundles.get(info.redirect)!.config;\n                            info = config.getAssetInfo(uuid);\n                        }\n                        out.config = config;\n                        out.info = info;\n                    }\n                    out.ext = item.ext || info?.extension || '.json';\n                    break;\n                }\n                case '__requestType__':\n                case 'ext':\n                case 'bundle':\n                case 'preset':\n                case 'type': break;\n                case RequestType.DIR:\n                    if (bundles.has(item.bundle)) {\n                        bundles.get(item.bundle)!.config.getDirWithPath(item.dir, item.type, infos);\n                        for (const assetInfo of infos) {\n                            input.push({ uuid: assetInfo.uuid, __isNative__: false, ext: assetInfo.extension || '.json', bundle: item.bundle });\n                        }\n                        infos.length = 0;\n                    }\n                    out.recycle();\n                    out = null;\n                    break;\n                case RequestType.PATH:\n                    if (bundles.has(item.bundle)) {\n                        config = bundles.get(item.bundle)!.config;\n                        info = config.getInfoWithPath(item.path, item.type);\n\n                        if (info && info.redirect) {\n                            if (!bundles.has(info.redirect)) { throw new Error(`you need to load bundle ${info.redirect} first`); }\n                            config = bundles.get(info.redirect)!.config;\n                            info = config.getAssetInfo(info.uuid);\n                        }\n\n                        if (!info) {\n                            out.recycle();\n                            throw new Error(`Bundle ${item.bundle} doesn't contain ${item.path}`);\n                        }\n                        out.config = config;\n                        out.uuid = info.uuid;\n                        out.info = info;\n                    }\n                    out.ext = item.ext || info?.extension || '.json';\n                    break;\n                case RequestType.SCENE:\n                    if (!item.bundle) {\n                        const bundle = bundles.find((bundle) => !!bundle.getSceneInfo(item.scene));\n                        item.bundle = bundle && bundle.name;\n                    }\n                    if (bundles.has(item.bundle)) {\n                        config = bundles.get(item.bundle)!.config;\n                        info = config.getSceneInfo(item.scene);\n\n                        if (info && info.redirect) {\n                            if (!bundles.has(info.redirect)) { throw new Error(`you need to load bundle ${info.redirect} first`); }\n                            config = bundles.get(info.redirect)!.config;\n                            info = config.getAssetInfo(info.uuid);\n                        }\n                        if (!info) {\n                            out.recycle();\n                            throw new Error(`Bundle ${config.name} doesn't contain scene ${item.scene}`);\n                        }\n                        out.config = config;\n                        out.uuid = info.uuid;\n                        out.info = info;\n                    }\n                    break;\n                case '__isNative__':\n                    out.isNative = item.__isNative__;\n                    break;\n                case RequestType.URL:\n                    out.url = item.url;\n                    out.uuid = item.uuid || item.url;\n                    out.ext = item.ext || path.extname(item.url);\n                    out.isNative = item.__isNative__ !== undefined ? item.__isNative__ : true;\n                    break;\n                default: out.options[key] = item[key];\n                }\n                if (!out) { break; }\n            }\n        }\n        if (!out) { continue; }\n        task.output.push(out);\n        if (!out.uuid && !out.url) { throw new Error(`Can not parse this input:${JSON.stringify(item)}`); }\n    }\n    return null;\n}\n\nexport function replaceOverrideAsset (task: Task) {\n    const input = task.output = task.input;\n    for (let i = 0; i < input.length; i++) {\n        const item = input[i] as RequestItem;\n        if (assetsOverrideMap.has(item.uuid)) {\n            const uuid = assetsOverrideMap.get(item.uuid)!;\n            if (EDITOR || PREVIEW) {\n                // In EDITOR, there is no bundle, so just change uuid.\n                item.overrideUuid = uuid;\n                item.ext = item.isNative ? item.ext : '.json';\n                continue;\n            }\n            const bundle = bundles.find((bundle) => !!bundle.getAssetInfo(uuid));\n            if (bundle) {\n                item.overrideUuid = uuid;\n                let config = bundle.config;\n                let info = config.getAssetInfo(uuid);\n                if (info && info.redirect) {\n                    if (!bundles.has(info.redirect)) { throw new Error(`Please load bundle ${info.redirect} first`); }\n                    config = bundles.get(info.redirect)!.config;\n                    info = config.getAssetInfo(uuid);\n                }\n                item.config = config;\n                item.info = info;\n                item.ext = item.isNative ? item.ext : (info?.extension || '.json');\n            } else {\n                warnID(16201, uuid, item.uuid);\n            }\n        }\n    }\n}\n\nexport function combine (task: Task) {\n    const input = task.output = task.input;\n    for (let i = 0; i < input.length; i++) {\n        const item = input[i] as RequestItem;\n        if (item.url) { continue; }\n\n        let url = '';\n        let base = '';\n        const config = item.config;\n        if (item.isNative) {\n            base = (config && config.nativeBase) ? (config.base + config.nativeBase) : legacyCC.assetManager.generalNativeBase;\n        } else {\n            base = (config && config.importBase) ? (config.base + config.importBase) : legacyCC.assetManager.generalImportBase;\n        }\n\n        const uuid = item.overrideUuid || item.uuid;\n\n        let ver = '';\n        if (item.info) {\n            if (item.isNative) {\n                ver = item.info.nativeVer ? (`.${item.info.nativeVer}`) : '';\n            } else {\n                ver = item.info.ver ? (`.${item.info.ver}`) : '';\n            }\n        }\n\n        // ugly hack, WeChat does not support loading font likes 'myfont.dw213.ttf'. So append hash to directory\n        if (item.ext === '.ttf') {\n            url = `${base}/${uuid.slice(0, 2)}/${uuid}${ver}/${item.options.__nativeName__}`;\n        } else {\n            url = `${base}/${uuid.slice(0, 2)}/${uuid}${ver}${item.ext}`;\n        }\n\n        item.url = url;\n    }\n    return null;\n}\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { BUILD, EDITOR, PREVIEW, TEST } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport { legacyCC } from '../global-exports';\nimport { error } from '../platform/debug';\nimport { sys } from '../platform/sys';\nimport { Settings, settings } from '../settings';\nimport { basename, extname } from '../utils/path';\nimport Bundle from './bundle';\nimport Cache, { ICache } from './cache';\nimport CacheManager from './cache-manager';\nimport dependUtil from './depend-util';\nimport downloader from './downloader';\nimport factory from './factory';\nimport fetch from './fetch';\nimport * as helper from './helper';\nimport load from './load';\nimport packManager from './pack-manager';\nimport parser from './parser';\nimport { IPipe, Pipeline } from './pipeline';\nimport preprocess from './preprocess';\nimport releaseManager from './release-manager';\nimport RequestItem from './request-item';\nimport {\n    CompleteCallbackWithData,\n    ProgressCallback,\n    IBundleOptions,\n    IOptions,\n    IRemoteOptions,\n    presets,\n    Request,\n    references,\n    IJsonAssetOptions,\n    assets, BuiltinBundleName, bundles, fetchPipeline, files, parsed, pipeline, transformPipeline, assetsOverrideMap } from './shared';\n\nimport Task from './task';\nimport { combine, parse, replaceOverrideAsset } from './url-transformer';\nimport { asyncify, parseParameters } from './utilities';\n\n/**\n * @zh\n * AssetManager 配置。\n * @en\n * AssetManager configuration.\n */\nexport interface IAssetManagerOptions {\n    /* Only valid on Editor */\n    importBase?: string;\n    /* Only valid on Editor */\n    nativeBase?: string;\n    /* Only valid on native */\n    jsbDownloaderMaxTasks?: number;\n    /* Only valid on native */\n    jsbDownloaderTimeout?: number;\n\n    /**\n     * @zh\n     * 所有 bundle 的版本信息\n     * @en\n     * Version for all bundles\n     */\n    bundleVers?: Record<string, string>;\n\n    /**\n     * @zh\n     * 远程服务器地址\n     * @en\n     * Remote server address\n     */\n    server?: string;\n\n    /**\n     * @zh\n     * 配置为子包的 bundle\n     * @en\n     * All subpackages\n     */\n    subpackages?: string[];\n\n    /**\n     * @zh\n     * 配置为远程包的 bundle\n     * @en\n     * All remote bundles\n     */\n    remoteBundles?: string[];\n\n}\n\n/**\n * @en\n * This module controls asset's behaviors and information, include loading, releasing etc. it is a singleton\n * All member can be accessed with `assetManager`.\n *\n * @zh\n * 此模块管理资源的行为和信息，包括加载，释放等，这是一个单例，所有成员能够通过 `assetManager` 调用\n *\n */\nexport class AssetManager {\n    /**\n     * @en\n     * Normal loading pipeline\n     *\n     * @zh\n     * 正常加载管线\n     *\n     */\n    public pipeline: Pipeline = pipeline.append(preprocess).append(load);\n\n    /**\n     * @en\n     * Fetching pipeline\n     *\n     * @zh\n     * 下载管线\n     *\n     */\n    public fetchPipeline: Pipeline = fetchPipeline.append(preprocess).append(fetch);\n\n    /**\n     * @en\n     * Url transformer\n     *\n     * @zh\n     * Url 转换器\n     *\n     */\n    public transformPipeline: Pipeline = transformPipeline.append(parse).append(replaceOverrideAsset).append(combine);\n\n    /**\n     * @en\n     * The collection of bundle which is already loaded, you can remove cache with [[removeBundle]]\n     *\n     * @zh\n     * 已加载 bundle 的集合， 你能通过 [[removeBundle]] 来移除缓存\n     *\n     */\n    public bundles: ICache<Bundle> = bundles;\n\n    /**\n     * @en\n     * The collection of asset which is already loaded, you can remove cache with [[releaseAsset]]\n     *\n     * @zh\n     * 已加载资源的集合， 你能通过 [[releaseAsset]] 来移除缓存\n     */\n    public assets: ICache<Asset> = assets;\n\n    /**\n     * @internal only using in L10N for now\n     */\n    public readonly assetsOverrideMap = assetsOverrideMap;\n\n    public generalImportBase = '';\n    public generalNativeBase = '';\n\n    /**\n     * @en\n     * Manage relationship between asset and its dependencies\n     *\n     * @zh\n     * 管理资源依赖关系\n     */\n    public dependUtil = dependUtil;\n\n    /**\n     * @en\n     * Whether or not load asset forcibly, if it is true, asset will be loaded regardless of error\n     *\n     * @zh\n     * 是否强制加载资源, 如果为 true ，加载资源将会忽略报错\n     *\n     */\n    public force = EDITOR || PREVIEW;\n\n    /**\n     * @en\n     * Whether to use image bitmap to load image first. If enabled, images loading will become faster but memory usage will increase.\n     *\n     * @zh\n     * 是否优先使用 image bitmap 来加载图片，启用之后，图片加载速度会更快, 但内存占用会变高，\n     *\n     */\n    public allowImageBitmap = !sys.isMobile;\n\n    /**\n     * @en\n     * Some useful function\n     *\n     * @zh\n     * 一些有用的方法\n     *\n     */\n    public utils = helper;\n\n    /**\n     * @en\n     * Manage all downloading task\n     *\n     * @zh\n     * 管理所有下载任务\n     *\n     */\n    public downloader = downloader;\n\n    /**\n     * @en\n     * Manage all parsing task\n     *\n     * @zh\n     * 管理所有解析任务\n     *\n     */\n    public parser = parser;\n\n    /**\n     * @en\n     * Manage all packed asset\n     *\n     * @zh\n     * 管理所有合并后的资源\n     *\n     */\n    public packManager = packManager;\n\n    /**\n     * @en\n     * Whether or not cache the loaded asset\n     *\n     * @zh\n     * 是否缓存已加载的资源\n     *\n     */\n    public cacheAsset = true;\n\n    /**\n     * @en\n     * Cache manager is a module which controls all caches downloaded from server in non-web platform.\n     *\n     * @zh\n     * 缓存管理器是一个模块，在非 WEB 平台上，用于管理所有从服务器上下载下来的缓存\n     *\n     */\n    public cacheManager: CacheManager | null = null;\n\n    /**\n     * @en\n     * The preset of options\n     *\n     * @zh\n     * 可选参数的预设集\n     *\n     */\n    public presets = presets;\n\n    public factory = factory;\n\n    public preprocessPipe: IPipe = preprocess;\n\n    public fetchPipe: IPipe = fetch;\n\n    public loadPipe: IPipe = load;\n\n    public references = references;\n\n    private _releaseManager = releaseManager;\n\n    private _files = files;\n\n    private _parsed = parsed;\n    private _parsePipeline = BUILD ? null : new Pipeline('parse existing json', [this.loadPipe]);\n    private _projectBundles: string[] = [];\n\n    /**\n     * @en\n     * The builtin 'main' bundle\n     *\n     * @zh\n     * 内置 main 包\n     */\n    public get main (): Bundle | null {\n        return bundles.get(BuiltinBundleName.MAIN) || null;\n    }\n\n    /**\n     * @en\n     * The builtin 'resources' bundle\n     *\n     * @zh\n     * 内置 resources 包\n     *\n     */\n    public get resources (): Bundle | null {\n        return bundles.get(BuiltinBundleName.RESOURCES) || null;\n    }\n\n    /**\n     * @en\n     * Initialize assetManager with options\n     *\n     * @zh\n     * 初始化资源管理器\n     *\n     * @param options - the configuration\n     *\n     */\n    public init (options: IAssetManagerOptions = {}) {\n        const server = options.server || settings.querySettings(Settings.Category.ASSETS, 'server') || '';\n        const bundleVers = options.bundleVers || settings.querySettings(Settings.Category.ASSETS, 'bundleVers') || {};\n        const remoteBundles = options.remoteBundles || settings.querySettings(Settings.Category.ASSETS, 'remoteBundles') || [];\n        this._files.clear();\n        this._parsed.clear();\n        this._releaseManager.init();\n        this.assets.clear();\n        this.bundles.clear();\n        this.packManager.init();\n        this.downloader.init(server, bundleVers, remoteBundles);\n        this.parser.init();\n        this.dependUtil.init();\n        let importBase = options.importBase || settings.querySettings(Settings.Category.ASSETS, 'importBase') || '';\n        if (importBase && importBase.endsWith('/')) {\n            importBase = importBase.substr(0, importBase.length - 1);\n        }\n        let nativeBase = options.nativeBase || settings.querySettings(Settings.Category.ASSETS, 'nativeBase') || '';\n        if (nativeBase && nativeBase.endsWith('/')) {\n            nativeBase = nativeBase.substr(0, nativeBase.length - 1);\n        }\n        this.generalImportBase = importBase;\n        this.generalNativeBase = nativeBase;\n        this._projectBundles = settings.querySettings(Settings.Category.ASSETS, 'projectBundles') || [];\n        const assetsOverride = settings.querySettings(Settings.Category.ASSETS, 'assetsOverrides') || {};\n        for (const key in assetsOverride) {\n            this.assetsOverrideMap.set(key, assetsOverride[key]);\n        }\n    }\n\n    /**\n     * @en\n     * Get the bundle which has been loaded\n     *\n     * @zh\n     * 获取已加载的分包\n     *\n     * @param name - The name of bundle\n     * @return - The loaded bundle\n     *\n     * @example\n     * // ${project}/assets/test1\n     * assetManager.getBundle('test1');\n     *\n     * assetManager.getBundle('resources');\n     *\n     */\n    public getBundle (name: string): Bundle | null {\n        return bundles.get(name) || null;\n    }\n\n    /**\n     * @en\n     * Remove this bundle. NOTE: The asset within this bundle will not be released automatically,\n     * you can call [[AssetManager.Bundle.releaseAll]] manually before remove it if you need\n     *\n     * @zh\n     * 移除此包, 注意：这个包内的资源不会自动释放, 如果需要的话你可以在摧毁之前手动调用 [[AssetManager.Bundle.releaseAll]] 进行释放\n     *\n     * @param bundle - The bundle to be removed\n     *\n     * @typescript\n     * removeBundle(bundle: AssetManager.Bundle): void\n     */\n    public removeBundle (bundle: Bundle) {\n        bundle._destroy();\n        bundles.remove(bundle.name);\n    }\n\n    /**\n     * @en\n     * General interface used to load assets with a progression callback and a complete callback. You can achieve almost all\n     * effect you want with combination of `requests` and `options`.It is highly recommended that you use more simple API,\n     * such as `load`, `loadDir` etc. Every custom parameter in `options` will be distribute to each of `requests`. if request\n     * already has same one, the parameter in request will be given priority. Besides, if request has dependencies, `options`\n     * will distribute to dependencies too. Every custom parameter in `requests` will be transferred to handler of `downloader`\n     * and `parser` as `options`. You can register you own handler downloader or parser to collect these custom parameters for some effect.\n     *\n     * Reserved Keyword: `uuid`, `url`, `path`, `dir`, `scene`, `type`, `priority`, `preset`, `audioLoadMode`, `ext`,\n     * `bundle`, `onFileProgress`, `maxConcurrency`, `maxRequestsPerFrame`, `maxRetryCount`, `version`, `xhrResponseType`,\n     * `xhrWithCredentials`, `xhrMimeType`, `xhrTimeout`, `xhrHeader`, `reloadAsset`, `cacheAsset`, `cacheEnabled`,\n     * Please DO NOT use these words as custom options!\n     *\n     * @zh\n     * 通用加载资源接口，可传入进度回调以及完成回调，通过组合 `request` 和 `options` 参数，几乎可以实现和扩展所有想要的加载效果。非常建议\n     * 你使用更简单的API，例如 `load`、`loadDir` 等。`options` 中的自定义参数将会分发到 `requests` 的每一项中，如果request中已存在同名的\n     * 参数则以 `requests` 中为准，同时如果有其他依赖资源，则 `options` 中的参数会继续向依赖项中分发。request中的自定义参数都会以 `options`\n     * 形式传入加载流程中的 `downloader`, `parser` 的方法中, 你可以扩展 `downloader`, `parser` 收集参数完成想实现的效果。\n     *\n     * 保留关键字: `uuid`, `url`, `path`, `dir`, `scene`, `type`, `priority`, `preset`, `audioLoadMode`, `ext`, `bundle`, `onFileProgress`,\n     *  `maxConcurrency`, `maxRequestsPerFrame`, `maxRetryCount`, `version`, `xhrResponseType`, `xhrWithCredentials`, `xhrMimeType`, `xhrTimeout`, `xhrHeader`,\n     *  `reloadAsset`, `cacheAsset`, `cacheEnabled`, 请不要使用这些字段为自定义参数!\n     *\n     * @param requests - The request you want to load\n     * @param options - Optional parameters\n     * @param onProgress - Callback invoked when progression change\n     * @param onProgress.finished - The number of the items that are already completed\n     * @param onProgress.total - The total number of the items\n     * @param onProgress.item - The current request item\n     * @param onComplete - Callback invoked when finish loading\n     * @param onComplete.err - The error occurred in loading process.\n     * @param onComplete.data - The loaded content\n     *\n     * @example\n     * assetManager.loadAny({url: 'http://example.com/a.png'}, (err, img) => log(img));\n     * assetManager.loadAny(['60sVXiTH1D/6Aft4MRt9VC'], (err, assets) => log(assets));\n     * assetManager.loadAny([{ uuid: '0cbZa5Y71CTZAccaIFluuZ'}, {url: 'http://example.com/a.png'}], (err, assets) => log(assets));\n     * assetManager.downloader.register('.asset', (url, options, onComplete) => {\n     *      url += '?userName=' + options.userName + \"&password=\" + options.password;\n     *      assetManager.downloader.downloadFile(url, null, onComplete);\n     * });\n     * assetManager.parser.register('.asset', (file, options, onComplete) => {\n     *      var json = JSON.parse(file);\n     *      var skin = json[options.skin];\n     *      var model = json[options.model];\n     *      onComplete(null, {skin, model});\n     * });\n     * assetManager.loadAny({ url: 'http://example.com/my.asset', skin: 'xxx', model: 'xxx', userName: 'xxx', password: 'xxx' });\n     *\n     */\n    public loadAny (requests: Request, options: IOptions | null, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData | null): void;\n    public loadAny (requests: Request, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData | null): void;\n    public loadAny (requests: Request, options: IOptions | null, onComplete?: CompleteCallbackWithData | null): void;\n    public loadAny<T extends Asset> (requests: string, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public loadAny<T extends Asset> (requests: string[], onComplete?: CompleteCallbackWithData<T[]> | null): void;\n    public loadAny (requests: Request, onComplete?: CompleteCallbackWithData | null): void;\n    public loadAny (\n        requests: Request,\n        options?: IOptions | ProgressCallback | CompleteCallbackWithData | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData | null,\n        onComplete?: CompleteCallbackWithData | null,\n    ) {\n        const { options: opts, onProgress: onProg, onComplete: onComp } = parseParameters(options, onProgress, onComplete);\n        opts.preset = opts.preset || 'default';\n        requests = Array.isArray(requests) ? requests.slice() : requests;\n        const task = Task.create({ input: requests, onProgress: onProg, onComplete: asyncify(onComp), options: opts });\n        pipeline.async(task);\n    }\n\n    /**\n     * @en\n     * General interface used to preload assets with a progression callback and a complete callback.It is highly recommended that you use\n     * more simple API, such as `preloadRes`, `preloadResDir` etc. Everything about preload is just likes `assetManager.loadAny`, the\n     * difference is `assetManager.preloadAny` will only download asset but not parse asset. You need to invoke `assetManager.loadAny(preloadTask)`\n     * to finish loading asset\n     *\n     * @zh\n     * 通用预加载资源接口，可传入进度回调以及完成回调，非常建议你使用更简单的 API ，例如 `preloadRes`, `preloadResDir` 等。`preloadAny` 和 `loadAny`\n     * 几乎一样，区别在于 `preloadAny` 只会下载资源，不会去解析资源，你需要调用 `assetManager.loadAny(preloadTask)` 来完成资源加载。\n     *\n     * @param requests - The request you want to preload\n     * @param options - Optional parameters\n     * @param onProgress - Callback invoked when progression change\n     * @param onProgress.finished - The number of the items that are already completed\n     * @param onProgress.total - The total number of the items\n     * @param onProgress.item - The current request item\n     * @param onComplete - Callback invoked when finish preloading\n     * @param onComplete.err - The error occurred in preloading process.\n     * @param onComplete.items - The preloaded content\n     *\n     * @example\n     * assetManager.preloadAny('0cbZa5Y71CTZAccaIFluuZ', (err) => assetManager.loadAny('0cbZa5Y71CTZAccaIFluuZ'));\n     *\n     */\n    public preloadAny (\n        requests: Request,\n        options: IOptions | null,\n        onProgress: ProgressCallback | null,\n        onComplete: CompleteCallbackWithData<RequestItem[]>|null): void;\n    public preloadAny (requests: Request, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadAny (requests: Request, options: IOptions | null, onComplete?: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadAny (requests: Request, onComplete?: CompleteCallbackWithData<RequestItem[]> | null): void;\n    public preloadAny (\n        requests: Request,\n        options?: IOptions | ProgressCallback | CompleteCallbackWithData<RequestItem[]> | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<RequestItem[]> | null,\n        onComplete?: CompleteCallbackWithData<RequestItem[]> | null,\n    ) {\n        const { options: opts, onProgress: onProg, onComplete: onComp } = parseParameters(options, onProgress, onComplete);\n        opts.preset = opts.preset || 'preload';\n        requests = Array.isArray(requests) ? requests.slice() : requests;\n        const task = Task.create({ input: requests, onProgress: onProg, onComplete: asyncify(onComp), options: opts });\n        fetchPipeline.async(task);\n    }\n\n    /**\n     * @en\n     * Load remote asset with url, such as audio, image, text and so on.\n     *\n     * @zh\n     * 使用 url 加载远程资源，例如音频，图片，文本等等。\n     *\n     * @param url - The url of asset\n     * @param options - Some optional parameters\n     * @param options.audioLoadMode - Indicate which mode audio you want to load\n     * @param options.ext - If the url does not have a extension name, you can specify one manually.\n     * @param onComplete - Callback invoked when finish loading\n     * @param onComplete.err - The error occurred in loading process.\n     * @param onComplete.asset - The loaded texture\n     *\n     * @example\n     * assetManager.loadRemote('http://www.cloud.com/test1.jpg', (err, texture) => console.log(err));\n     * assetManager.loadRemote('http://www.cloud.com/test2.mp3', (err, audioClip) => console.log(err));\n     * assetManager.loadRemote('http://www.cloud.com/test3', { ext: '.png' }, (err, texture) => console.log(err));\n     *\n     */\n    public loadRemote<T extends Asset> (url: string, options: IRemoteOptions | null, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public loadRemote<T extends Asset> (url: string, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public loadRemote<T extends Asset> (url: string, options?: IRemoteOptions | CompleteCallbackWithData<T> | null, onComplete?: CompleteCallbackWithData<T> | null) {\n        const { options: opts, onComplete: onComp } = parseParameters<CompleteCallbackWithData<T>>(options, undefined, onComplete);\n\n        if (!opts.reloadAsset && this.assets.has(url)) {\n            asyncify(onComp)(null, this.assets.get(url));\n            return;\n        }\n\n        opts.__isNative__ = true;\n        opts.preset = opts.preset || 'remote';\n        this.loadAny({ url }, opts, null, (err, data) => {\n            if (err) {\n                error(err.message, err.stack);\n                if (onComp) { onComp(err, data); }\n            } else {\n                factory.create(url, data, opts.ext || extname(url), opts, (p1, p2) => {\n                    if (onComp) { onComp(p1, p2 as T); }\n                });\n            }\n        });\n    }\n\n    /**\n     * @en\n     * load bundle\n     *\n     * @zh\n     * 加载资源包\n     *\n     * @param nameOrUrl - The name or root path of bundle\n     * @param options - Some optional paramter, same like downloader.downloadFile\n     * @param options.version - The version of this bundle, you can check config.json in this bundle\n     * @param onComplete - Callback when bundle loaded or failed\n     * @param onComplete.err - The occurred error, null indicates success\n     * @param onComplete.bundle - The loaded bundle\n     *\n     * @example\n     * loadBundle('http://localhost:8080/test', null, (err, bundle) => console.log(err));\n     *\n     */\n    public loadBundle (nameOrUrl: string, options: IBundleOptions | null, onComplete?: CompleteCallbackWithData<Bundle> | null): void;\n    public loadBundle (nameOrUrl: string, onComplete?: CompleteCallbackWithData<Bundle> | null): void;\n    public loadBundle (nameOrUrl: string, options?: IBundleOptions | CompleteCallbackWithData<Bundle> | null, onComplete?: CompleteCallbackWithData<Bundle> | null) {\n        const { options: opts, onComplete: onComp } = parseParameters<CompleteCallbackWithData<Bundle>>(options, undefined, onComplete);\n\n        const bundleName = basename(nameOrUrl);\n\n        if (this.bundles.has(bundleName)) {\n            asyncify(onComp)(null, this.getBundle(bundleName));\n            return;\n        }\n\n        opts.preset = opts.preset || 'bundle';\n        opts.ext = 'bundle';\n        opts.__isNative__ = true;\n        this.loadAny({ url: nameOrUrl }, opts, null, (err, data) => {\n            if (err) {\n                error(err.message, err.stack);\n                if (onComp) { onComp(err, data); }\n            } else {\n                factory.create(nameOrUrl, data, 'bundle', opts, (p1, p2) => {\n                    if (onComp) { onComp(p1, p2 as Bundle); }\n                });\n            }\n        });\n    }\n\n    /**\n     * @en\n     * Release asset and it's dependencies.\n     * This method will not only remove the cache of the asset in assetManager, but also clean up its content.\n     * For example, if you release a texture, the texture asset and its gl texture data will be freed up.\n     * Notice, this method may cause the texture to be unusable, if there are still other nodes use the same texture,\n     * they may turn to black and report gl errors.\n     *\n     * @zh\n     * 释放资源以及其依赖资源, 这个方法不仅会从 assetManager 中删除资源的缓存引用，还会清理它的资源内容。\n     * 比如说，当你释放一个 texture 资源，这个 texture 和它的 gl 贴图数据都会被释放。\n     * 注意，这个函数可能会导致资源贴图或资源所依赖的贴图不可用，如果场景中存在节点仍然依赖同样的贴图，它们可能会变黑并报 GL 错误。\n     *\n     * @param asset - The asset to be released\n     *\n     * @example\n     * // release a texture which is no longer need\n     * assetManager.releaseAsset(texture);\n     *\n     */\n    public releaseAsset (asset: Asset): void {\n        releaseManager.tryRelease(asset, true);\n    }\n\n    /**\n     * @en\n     * Release all unused assets. Refer to [[releaseAsset]] for detailed information.\n     *\n     * @zh\n     * 释放所有没有用到的资源。详细信息请参考 [[releaseAsset]]\n     *\n     * @engineInternal\n     *\n     */\n    public releaseUnusedAssets () {\n        assets.forEach((asset) => {\n            releaseManager.tryRelease(asset);\n        });\n    }\n\n    /**\n     * @en\n     * Release all assets. Refer to [[releaseAsset]] for detailed information.\n     *\n     * @zh\n     * 释放所有资源。详细信息请参考 [[releaseAsset]]\n     *\n     */\n    public releaseAll () {\n        assets.forEach((asset) => {\n            releaseManager.tryRelease(asset, true);\n        });\n    }\n\n    /**\n     * For internal usage.\n     * @param json\n     * @param options\n     * @param onComplete\n     * @private\n     */\n    public loadWithJson<T extends Asset> (\n        json: Record<string, any>,\n        options: IJsonAssetOptions | null,\n        onProgress: ProgressCallback | null,\n        onComplete: CompleteCallbackWithData<T> | null): void;\n    public loadWithJson<T extends Asset> (json: Record<string, any>, onProgress: ProgressCallback | null, onComplete: CompleteCallbackWithData<T> | null): void;\n    public loadWithJson<T extends Asset> (json: Record<string, any>, options: IJsonAssetOptions | null, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public loadWithJson<T extends Asset> (json: Record<string, any>, onComplete?: CompleteCallbackWithData<T> | null): void;\n    public loadWithJson<T extends Asset> (\n        json: Record<string, any>,\n        options?: IJsonAssetOptions | CompleteCallbackWithData<T> | null,\n        onProgress?: ProgressCallback | CompleteCallbackWithData<T> | null,\n        onComplete?: CompleteCallbackWithData<T> | null,\n    ) {\n        if (BUILD) { throw new Error('Only valid in Editor'); }\n\n        const { options: opts, onProgress: onProg, onComplete: onComp } = parseParameters<CompleteCallbackWithData<T>>(options, onProgress, onComplete);\n\n        const item = RequestItem.create();\n        item.isNative = false;\n        item.uuid = opts.assetId || (`${new Date().getTime()}${Math.random()}`);\n        item.file = json;\n        item.ext = '.json';\n\n        const task = Task.create({\n            input: [item],\n            onProgress: onProg,\n            options: opts,\n            onComplete: asyncify((err, data: T) => {\n                if (!err) {\n                    if (!opts.assetId) {\n                        data._uuid = '';\n                    }\n                }\n                if (onComp) { onComp(err, data); }\n            }),\n        });\n        this._parsePipeline!.async(task);\n    }\n}\n\nAssetManager.Pipeline = Pipeline;\nAssetManager.Task = Task;\nAssetManager.Cache = Cache;\nAssetManager.RequestItem = RequestItem;\nAssetManager.Bundle = Bundle;\nAssetManager.BuiltinBundleName = BuiltinBundleName;\n\nexport declare namespace AssetManager {\n    export { Pipeline };\n    export { Task };\n    export { Cache };\n    export { RequestItem };\n    export { Bundle };\n    export { BuiltinBundleName };\n}\n\nexport default legacyCC.assetManager = new AssetManager();\nlegacyCC.AssetManager = AssetManager;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nexport const getPhaseID = (() => {\n    const phases: Map<string, number> = new Map<string, number>();\n    let phaseNum = 0;\n    return (phaseName: string | number) => {\n        if (typeof phaseName === 'number') { return phaseName; }\n        if (!phases.has(phaseName)) {\n            phases.set(phaseName, 1 << phaseNum);\n            phaseNum++;\n        }\n        return phases.get(phaseName)!;\n    };\n})();\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR } from 'internal:constants';\nimport { Root } from '../../root';\nimport { TextureBase } from '../../assets/texture-base';\nimport { builtinResMgr } from '../../builtin/builtin-res-mgr';\nimport { getPhaseID } from '../../pipeline/pass-phase';\nimport { murmurhash2_32_gc } from '../../utils/murmurhash2_gc';\nimport { BufferUsageBit, DynamicStateFlagBit, DynamicStateFlags, Feature, GetTypeSize, MemoryUsageBit, PrimitiveMode, Type, Color,\n    BlendState, BlendTarget, Buffer, BufferInfo, BufferViewInfo, DepthStencilState, DescriptorSet,\n    DescriptorSetInfo, DescriptorSetLayout, Device, RasterizerState, Sampler, Texture, Shader, PipelineLayout, deviceManager,\n} from '../../gfx';\nimport { EffectAsset } from '../../assets/effect-asset';\nimport { IProgramInfo, programLib } from './program-lib';\nimport { MacroRecord, MaterialProperty, customizeType, getBindingFromHandle, getDefaultFromType, getStringFromType,\n    getOffsetFromHandle, getTypeFromHandle, type2reader, type2writer, getCountFromHandle,\n} from './pass-utils';\nimport { RenderPassStage, RenderPriority } from '../../pipeline/define';\nimport { errorID } from '../../platform/debug';\nimport { InstancedBuffer } from '../../pipeline/instanced-buffer';\nimport { BatchedBuffer } from '../../pipeline/batched-buffer';\n\nexport interface IPassInfoFull extends EffectAsset.IPassInfo {\n    // generated part\n    passIndex: number;\n    defines: MacroRecord;\n    stateOverrides?: PassOverrides;\n}\nexport type PassOverrides = RecursivePartial<EffectAsset.IPassStates>;\n\nexport interface IMacroPatch {\n    name: string;\n    value: boolean | number | string;\n}\n\ninterface IPassDynamics {\n    [type: number]: {\n        dirty: boolean;\n        value: number;\n    };\n}\n\nconst _bufferInfo = new BufferInfo(\n    BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n    MemoryUsageBit.DEVICE,\n);\n\nconst _bufferViewInfo = new BufferViewInfo(null!);\n\nconst _dsInfo = new DescriptorSetInfo(null!);\n\nexport enum BatchingSchemes {\n    NONE = 0,\n    INSTANCING = 1,\n    VB_MERGING = 2,\n}\n\nexport declare namespace Pass {\n    export type getTypeFromHandle = typeof Pass.getTypeFromHandle;\n    export type getBindingFromHandle = typeof Pass.getBindingFromHandle;\n    export type fillPipelineInfo = typeof Pass.fillPipelineInfo;\n    export type getPassHash = typeof Pass.getPassHash;\n    export type getCountFromHandle = typeof Pass.getCountFromHandle;\n}\n\n/**\n * @en Render pass, store actual resources for the rendering process\n * @zh 渲染 pass，储存实际描述绘制过程的各项资源。\n */\nexport class Pass {\n    /**\n     * @en Get the type of member in uniform buffer object with the handle\n     * @zh 根据 handle 获取 uniform 的具体类型。\n     */\n    public static getTypeFromHandle = getTypeFromHandle;\n\n    /**\n     * @en Get the binding with handle\n     * @zh 根据 handle 获取 binding。\n     */\n    public static getBindingFromHandle = getBindingFromHandle;\n\n    /**\n     * @en Get the array length with handle\n     * @zh 根据 handle 获取数组长度。\n     */\n    public static getCountFromHandle = getCountFromHandle;\n\n    protected static getOffsetFromHandle = getOffsetFromHandle;\n\n    /**\n     * @en Fill a pass represented by the given pass handle with the given override info\n     * @param hPass The pass handle point to the pass\n     * @param info The pass override info\n     */\n    public static fillPipelineInfo (pass: Pass, info: PassOverrides): void {\n        if (info.priority !== undefined) { pass._priority = info.priority; }\n        if (info.primitive !== undefined) { pass._primitive = info.primitive; }\n        if (info.stage !== undefined) { pass._stage = info.stage; }\n        if (info.dynamicStates !== undefined) { pass._dynamicStates = info.dynamicStates; }\n        if (info.phase !== undefined) { pass._phase = getPhaseID(info.phase); }\n\n        const bs = pass._bs;\n        if (info.blendState) {\n            const bsInfo = info.blendState;\n            const { targets } = bsInfo;\n            if (targets) {\n                targets.forEach((t, i) => {\n                    bs.setTarget(i, t as BlendTarget);\n                });\n            }\n\n            if (bsInfo.isA2C !== undefined) { bs.isA2C = bsInfo.isA2C; }\n            if (bsInfo.isIndepend !== undefined) { bs.isIndepend = bsInfo.isIndepend; }\n            if (bsInfo.blendColor !== undefined) { bs.blendColor = bsInfo.blendColor as Color; }\n        }\n        pass._rs.assign(info.rasterizerState as RasterizerState);\n        pass._dss.assign(info.depthStencilState as DepthStencilState);\n    }\n\n    /**\n     * @en Get pass hash value by [[renderer.Pass]] hash information.\n     * @zh 根据 [[renderer.Pass]] 的哈希信息获取哈希值。\n     *\n     * @param hPass Handle of the pass info used to compute hash value.\n     */\n    public static getPassHash (pass: Pass): number {\n        const shaderKey = programLib.getKey(pass.program, pass.defines);\n        let res = `${shaderKey},${pass._primitive},${pass._dynamicStates}`;\n        res += serializeBlendState(pass._bs);\n        res += serializeDepthStencilState(pass._dss);\n        res += serializeRasterizerState(pass._rs);\n\n        return murmurhash2_32_gc(res, 666);\n    }\n\n    // internal resources\n    protected _rootBuffer: Buffer | null = null;\n    protected _buffers: Buffer[] = [];\n    protected _descriptorSet: DescriptorSet = null!;\n    protected _pipelineLayout: PipelineLayout = null!;\n    // internal data\n    protected _passIndex = 0;\n    protected _propertyIndex = 0;\n    protected _programName = '';\n    protected _dynamics: IPassDynamics = {};\n    protected _propertyHandleMap: Record<string, number> = {};\n    protected _rootBlock: ArrayBuffer | null = null;\n    protected _blocksInt: Int32Array[] = [];\n    protected _blocks: Float32Array[] = [];\n    protected _shaderInfo: IProgramInfo = null!;\n    protected _defines: MacroRecord = {};\n    protected _properties: Record<string, EffectAsset.IPropertyInfo> = {};\n    protected _shader: Shader | null = null\n    protected _bs: BlendState = new BlendState();\n    protected _dss: DepthStencilState = new DepthStencilState();\n    protected _rs: RasterizerState = new RasterizerState();\n    protected _priority: RenderPriority = RenderPriority.DEFAULT;\n    protected _stage: RenderPassStage = RenderPassStage.DEFAULT;\n    protected _phase = getPhaseID('default');\n    protected _primitive: PrimitiveMode = PrimitiveMode.TRIANGLE_LIST;\n    protected _batchingScheme: BatchingSchemes = BatchingSchemes.NONE;\n    protected _dynamicStates: DynamicStateFlagBit = DynamicStateFlagBit.NONE;\n    protected _instancedBuffers: Record<number, InstancedBuffer> = {};\n    protected _batchedBuffers: Record<number, BatchedBuffer> = {};\n    protected _hash = 0;\n    // external references\n    protected _root: Root;\n    protected _device: Device;\n\n    protected  _rootBufferDirty = false;\n\n    constructor (root: Root) {\n        this._root = root;\n        this._device = deviceManager.gfxDevice;\n    }\n\n    /**\n     * @en Initialize the pass with given pass info, shader will be compiled in the init process\n     * @zh 根据指定参数初始化当前 pass，shader 会在这一阶段就尝试编译。\n     */\n    public initialize (info: IPassInfoFull): void {\n        this._doInit(info);\n        this.resetUBOs();\n        this.resetTextures();\n        this.tryCompile();\n    }\n\n    /**\n     * @en Get the handle of a UBO member, or specific channels of it.\n     * @zh 获取指定 UBO 成员，或其更具体分量的读写句柄。默认以成员自身的类型为目标读写类型（即读写时必须传入与成员类型相同的变量）。\n     * @param name Name of the target UBO member.\n     * @param offset Channel offset into the member.\n     * @param targetType Target type of the handle, i.e. the type of data when read/write to it.\n     * @example\n     * ```\n     * import { Vec3, gfx } from 'cc';\n     * // say 'pbrParams' is a uniform vec4\n     * const hParams = pass.getHandle('pbrParams'); // get the default handle\n     * pass.setUniform(hAlbedo, new Vec3(1, 0, 0)); // wrong! pbrParams.w is NaN now\n     *\n     * // say 'albedoScale' is a uniform vec4, and we only want to modify the w component in the form of a single float\n     * const hThreshold = pass.getHandle('albedoScale', 3, gfx.Type.FLOAT);\n     * pass.setUniform(hThreshold, 0.5); // now, albedoScale.w = 0.5\n     * ```\n     */\n    public getHandle (name: string, offset = 0, targetType = Type.UNKNOWN): number {\n        let handle = this._propertyHandleMap[name]; if (!handle) { return 0; }\n        if (targetType) {\n            handle = customizeType(handle, targetType);\n        } else if (offset) {\n            handle = customizeType(handle, getTypeFromHandle(handle) - offset);\n        }\n        return handle + offset;\n    }\n\n    /**\n     * @en Gets the uniform binding with its name\n     * @zh 获取指定 uniform 的 binding。\n     * @param name The name of target uniform\n     */\n    public getBinding (name: string): number {\n        const handle = this.getHandle(name);\n        if (!handle) { return -1; }\n        return Pass.getBindingFromHandle(handle);\n    }\n\n    /**\n     * @en Sets a vector type uniform value, if a uniform requires frequent update, please use this method.\n     * @zh 设置指定普通向量类 uniform 的值，如果需要频繁更新请尽量使用此接口。\n     * @param handle The handle for the target uniform\n     * @param value New value\n     */\n    public setUniform (handle: number, value: MaterialProperty): void {\n        const binding = Pass.getBindingFromHandle(handle);\n        const type = Pass.getTypeFromHandle(handle);\n        const ofs = Pass.getOffsetFromHandle(handle);\n        const block = this._getBlockView(type, binding);\n        type2writer[type](block, value, ofs);\n        this._rootBufferDirty = true;\n    }\n\n    /**\n     * @en Gets a uniform's value.\n     * @zh 获取指定普通向量类 uniform 的值。\n     * @param handle The handle for the target uniform\n     * @param out The output property to store the result\n     */\n    public getUniform<T extends MaterialProperty> (handle: number, out: T): T {\n        const binding = Pass.getBindingFromHandle(handle);\n        const type = Pass.getTypeFromHandle(handle);\n        const ofs = Pass.getOffsetFromHandle(handle);\n        const block = this._getBlockView(type, binding);\n        return type2reader[type](block, out, ofs) as T;\n    }\n\n    /**\n     * @en Sets an array type uniform value, if a uniform requires frequent update, please use this method.\n     * @zh 设置指定数组类 uniform 的值，如果需要频繁更新请尽量使用此接口。\n     * @param handle The handle for the target uniform\n     * @param value New value\n     */\n    public setUniformArray (handle: number, value: MaterialProperty[]): void {\n        const binding = Pass.getBindingFromHandle(handle);\n        const type = Pass.getTypeFromHandle(handle);\n        const stride = GetTypeSize(type) >> 2;\n        const block = this._getBlockView(type, binding);\n        let ofs = Pass.getOffsetFromHandle(handle);\n        for (let i = 0; i < value.length; i++, ofs += stride) {\n            if (value[i] === null) { continue; }\n            type2writer[type](block, value[i], ofs);\n        }\n        this._rootBufferDirty = true;\n    }\n\n    /**\n     * @en Bind a GFX [[gfx.Texture]] the the given uniform binding\n     * @zh 绑定实际 GFX [[gfx.Texture]] 到指定 binding。\n     * @param binding The binding for target uniform of texture type\n     * @param value Target texture\n     */\n    public bindTexture (binding: number, value: Texture, index?: number): void {\n        this._descriptorSet.bindTexture(binding, value, index || 0);\n    }\n\n    /**\n     * @en Bind a GFX [[gfx.Sampler]] the the given uniform binding\n     * @zh 绑定实际 GFX [[gfx.Sampler]] 到指定 binding。\n     * @param binding The binding for target uniform of sampler type\n     * @param value Target sampler\n     */\n    public bindSampler (binding: number, value: Sampler, index?: number): void {\n        this._descriptorSet.bindSampler(binding, value, index || 0);\n    }\n\n    /**\n     * @en Sets the dynamic pipeline state property at runtime\n     * @zh 设置运行时 pass 内可动态更新的管线状态属性。\n     * @param state Target dynamic state\n     * @param value Target value\n     */\n    public setDynamicState (state: DynamicStateFlagBit, value: number): void {\n        const ds = this._dynamics[state];\n        if (ds && ds.value === value) { return; }\n        ds.value = value; ds.dirty = true;\n    }\n\n    /**\n     * @en Override all pipeline states with the given pass override info.\n     * @zh 重载当前所有管线状态。\n     * @param original The original pass info\n     * @param value The override pipeline state info\n     */\n    public overridePipelineStates (original: EffectAsset.IPassInfo, overrides: PassOverrides): void {\n        console.warn('base pass cannot override states, please use pass instance instead.');\n    }\n\n    public _setRootBufferDirty (val: boolean) {\n        this._rootBufferDirty = val;\n    }\n\n    /**\n     * @en Update the current uniforms data.\n     * @zh 更新当前 Uniform 数据。\n     */\n    public update (): void {\n        if (!this._descriptorSet) {\n            errorID(12006);\n            return;\n        }\n\n        if (this._rootBuffer && this._rootBufferDirty) {\n            this._rootBuffer.update(this._rootBlock!);\n            this._rootBufferDirty = false;\n        }\n        this._descriptorSet.update();\n    }\n\n    public getInstancedBuffer (extraKey = 0) {\n        return this._instancedBuffers[extraKey] || (this._instancedBuffers[extraKey] = new InstancedBuffer(this));\n    }\n\n    public getBatchedBuffer (extraKey = 0) {\n        return this._batchedBuffers[extraKey] || (this._batchedBuffers[extraKey] = new BatchedBuffer(this));\n    }\n\n    /**\n     * @en Destroy the current pass.\n     * @zh 销毁当前 pass。\n     */\n    public destroy (): void {\n        for (let i = 0; i < this._shaderInfo.blocks.length; i++) {\n            const u = this._shaderInfo.blocks[i];\n            this._buffers[u.binding].destroy();\n        }\n        this._buffers = [];\n\n        if (this._rootBuffer) {\n            this._rootBuffer.destroy();\n            this._rootBuffer = null;\n        }\n\n        for (const ib in this._instancedBuffers) {\n            this._instancedBuffers[ib].destroy();\n        }\n\n        for (const bb in this._batchedBuffers) {\n            this._batchedBuffers[bb].destroy();\n        }\n\n        this._descriptorSet.destroy();\n        this._rs.destroy();\n        this._dss.destroy();\n        this._bs.destroy();\n    }\n\n    /**\n     * @en Resets the value of the given uniform by name to the default value in [[EffectAsset]].\n     * This method does not support array type uniform.\n     * @zh 重置指定（非数组） Uniform 为 [[EffectAsset]] 默认值。\n     */\n    public resetUniform (name: string): void {\n        const handle = this.getHandle(name);\n        if (!handle) { return; }\n        const type = Pass.getTypeFromHandle(handle);\n        const binding = Pass.getBindingFromHandle(handle);\n        const ofs = Pass.getOffsetFromHandle(handle);\n        const count = Pass.getCountFromHandle(handle);\n        const block = this._getBlockView(type, binding);\n        const info = this._properties[name];\n        const givenDefault = info && info.value;\n        const value = (givenDefault || getDefaultFromType(type)) as number[];\n        const size = (GetTypeSize(type) >> 2) * count;\n        for (let k = 0; k + value.length <= size; k += value.length) { block.set(value, ofs + k); }\n        this._rootBufferDirty = true;\n    }\n\n    /**\n     * @en Resets the value of the given texture by name to the default value in [[EffectAsset]].\n     * @zh 重置指定贴图为 [[EffectAsset]] 默认值。\n     */\n    public resetTexture (name: string, index?: number): void {\n        const handle = this.getHandle(name);\n        if (!handle) { return; }\n        const type = Pass.getTypeFromHandle(handle);\n        const binding = Pass.getBindingFromHandle(handle);\n        const info = this._properties[name];\n        const value = info && info.value;\n        const texName = value ? `${value as string}${getStringFromType(type)}` : getDefaultFromType(type) as string;\n        const textureBase = builtinResMgr.get<TextureBase>(texName);\n        const texture = textureBase && textureBase.getGFXTexture()!;\n        const samplerInfo = info && info.samplerHash !== undefined\n            ? Sampler.unpackFromHash(info.samplerHash) : textureBase && textureBase.getSamplerInfo();\n        const sampler = this._device.getSampler(samplerInfo);\n        this._descriptorSet.bindSampler(binding, sampler, index || 0);\n        this._descriptorSet.bindTexture(binding, texture, index || 0);\n    }\n\n    /**\n     * @en Resets all uniform buffer objects to the default values in [[EffectAsset]]\n     * @zh 重置所有 UBO 为默认值。\n     */\n    public resetUBOs (): void {\n        for (let i = 0; i < this._shaderInfo.blocks.length; i++) {\n            const u = this._shaderInfo.blocks[i];\n            let ofs = 0;\n            for (let j = 0; j < u.members.length; j++) {\n                const cur = u.members[j];\n                const block = this._getBlockView(cur.type, u.binding);\n                const info = this._properties[cur.name];\n                const givenDefault = info && info.value;\n                const value = (givenDefault || getDefaultFromType(cur.type)) as number[];\n                const size = (GetTypeSize(cur.type) >> 2) * cur.count;\n                for (let k = 0; k + value.length <= size; k += value.length) { block.set(value, ofs + k); }\n                ofs += size;\n            }\n        }\n        this._rootBufferDirty = true;\n    }\n\n    /**\n     * @en Resets all textures and samplers to the default values in [[EffectAsset]]\n     * @zh 重置所有 texture 和 sampler 为初始默认值。\n     */\n    public resetTextures (): void {\n        for (let i = 0; i < this._shaderInfo.samplerTextures.length; i++) {\n            const u = this._shaderInfo.samplerTextures[i];\n            for (let j = 0; j < u.count; j++) {\n                this.resetTexture(u.name, j);\n            }\n        }\n    }\n\n    /**\n     * @en Try to compile the shader and retrieve related resources references.\n     * @zh 尝试编译 shader 并获取相关资源引用。\n     */\n    public tryCompile (): boolean {\n        const { pipeline } = this._root;\n        if (!pipeline) { return false; }\n        this._syncBatchingScheme();\n        const shader = programLib.getGFXShader(this._device, this._programName, this._defines, pipeline);\n        if (!shader) { console.warn(`create shader ${this._programName} failed`); return false; }\n        this._shader = shader;\n        this._pipelineLayout = programLib.getTemplateInfo(this._programName).pipelineLayout;\n        this._hash = Pass.getPassHash(this);\n        return true;\n    }\n\n    /**\n     * @en Gets the shader variant of the current pass and given macro patches\n     * @zh 结合指定的编译宏组合获取当前 Pass 的 Shader Variant\n     * @param patches The macro patches\n     */\n    public getShaderVariant (patches: IMacroPatch[] | null = null): Shader | null {\n        if (!this._shader && !this.tryCompile()) {\n            console.warn('pass resources incomplete');\n            return null;\n        }\n\n        if (!patches) {\n            return this._shader;\n        }\n\n        if (EDITOR) {\n            for (let i = 0; i < patches.length; i++) {\n                if (!patches[i].name.startsWith('CC_')) {\n                    console.warn('cannot patch non-builtin macros');\n                    return null;\n                }\n            }\n        }\n\n        const { pipeline } = this._root;\n        for (let i = 0; i < patches.length; i++) {\n            const patch = patches[i];\n            this._defines[patch.name] = patch.value;\n        }\n\n        const shader = programLib.getGFXShader(this._device, this._programName, this._defines, pipeline);\n\n        for (let i = 0; i < patches.length; i++) {\n            const patch = patches[i];\n            delete this._defines[patch.name];\n        }\n        return shader;\n    }\n\n    // internal use\n    /**\n     * @private\n     */\n    public beginChangeStatesSilently (): void {}\n\n    /**\n     * @private\n     */\n    public endChangeStatesSilently (): void {}\n\n    protected _doInit (info: IPassInfoFull, copyDefines = false): void {\n        this._priority = RenderPriority.DEFAULT;\n        this._stage = RenderPassStage.DEFAULT;\n        this._phase = getPhaseID('default');\n        this._primitive = PrimitiveMode.TRIANGLE_LIST;\n\n        this._passIndex = info.passIndex;\n        this._propertyIndex = info.propertyIndex !== undefined ? info.propertyIndex : info.passIndex;\n        this._programName = info.program;\n        this._defines = copyDefines ? ({ ...info.defines }) : info.defines;\n        this._shaderInfo = programLib.getTemplate(info.program);\n        this._properties = info.properties || this._properties;\n\n        const device = this._device;\n        Pass.fillPipelineInfo(this, info);\n        if (info.stateOverrides) { Pass.fillPipelineInfo(this, info.stateOverrides); }\n\n        // init descriptor set\n        _dsInfo.layout = programLib.getDescriptorSetLayout(this._device, info.program);\n        this._descriptorSet = this._device.createDescriptorSet(_dsInfo);\n\n        // calculate total size required\n        const blocks = this._shaderInfo.blocks;\n        const tmplInfo = programLib.getTemplateInfo(info.program);\n        const { blockSizes, handleMap } = tmplInfo;\n        const alignment = device.capabilities.uboOffsetAlignment;\n        const startOffsets: number[] = [];\n        let lastSize = 0; let lastOffset = 0;\n        for (let i = 0; i < blocks.length; i++) {\n            const size = blockSizes[i];\n            startOffsets.push(lastOffset);\n            lastOffset += Math.ceil(size / alignment) * alignment;\n            lastSize = size;\n        }\n        // create gfx buffer resource\n        const totalSize = startOffsets[startOffsets.length - 1] + lastSize;\n        if (totalSize) {\n            // https://bugs.chromium.org/p/chromium/issues/detail?id=988988\n            _bufferInfo.size = Math.ceil(totalSize / 16) * 16;\n            this._rootBuffer = device.createBuffer(_bufferInfo);\n            this._rootBlock = new ArrayBuffer(totalSize);\n        }\n        // create buffer views\n        for (let i = 0, count = 0; i < blocks.length; i++) {\n            const { binding } = blocks[i];\n            const size = blockSizes[i];\n            _bufferViewInfo.buffer = this._rootBuffer!;\n            _bufferViewInfo.offset = startOffsets[count++];\n            _bufferViewInfo.range = Math.ceil(size / 16) * 16;\n            const bufferView = this._buffers[binding] = device.createBuffer(_bufferViewInfo);\n            // non-builtin UBO data pools, note that the effect compiler\n            // guarantees these bindings to be consecutive, starting from 0 and non-array-typed\n            this._blocks[binding] = new Float32Array(this._rootBlock!, _bufferViewInfo.offset,\n                size / Float32Array.BYTES_PER_ELEMENT);\n            this._blocksInt[binding] = new Int32Array(this._blocks[binding].buffer, this._blocks[binding].byteOffset, this._blocks[binding].length);\n            this._descriptorSet.bindBuffer(binding, bufferView);\n        }\n        // store handles\n        const directHandleMap = this._propertyHandleMap = handleMap;\n        const indirectHandleMap: Record<string, number> = {};\n        for (const name in this._properties) {\n            const prop = this._properties[name];\n            if (!prop.handleInfo) { continue; }\n            indirectHandleMap[name] = this.getHandle.apply(this, prop.handleInfo)!;\n        }\n        Object.assign(directHandleMap, indirectHandleMap);\n    }\n\n    protected _syncBatchingScheme (): void {\n        if (this._defines.USE_INSTANCING) {\n            if (this._device.hasFeature(Feature.INSTANCED_ARRAYS)) {\n                this._batchingScheme = BatchingSchemes.INSTANCING;\n            } else {\n                this._defines.USE_INSTANCING = false;\n                this._batchingScheme = BatchingSchemes.NONE;\n            }\n        } else if (this._defines.USE_BATCHING) {\n            this._batchingScheme = BatchingSchemes.VB_MERGING;\n        } else {\n            this._batchingScheme = BatchingSchemes.NONE;\n        }\n    }\n\n    private _getBlockView (type: Type, binding: number) {\n        return type < Type.FLOAT ? this._blocksInt[binding] : this._blocks[binding];\n    }\n\n    // Only for UI\n    private _initPassFromTarget (target: Pass, dss: DepthStencilState, hashFactor: number) {\n        this._priority = target.priority;\n        this._stage = target.stage;\n        this._phase = target.phase;\n        this._batchingScheme = target.batchingScheme;\n        this._primitive = target.primitive;\n        this._dynamicStates = target.dynamicStates;\n        this._bs = target.blendState;\n        this._dss = dss;\n        this._descriptorSet = target.descriptorSet;\n        this._rs = target.rasterizerState;\n        this._passIndex = target.passIndex;\n        this._propertyIndex = target.propertyIndex;\n        this._programName = target.program;\n        this._defines = target.defines;\n        this._shaderInfo = target._shaderInfo;\n        this._properties = target._properties;\n\n        this._blocks = target._blocks;\n        this._blocksInt = target._blocksInt;\n        this._dynamics =  target._dynamics;\n\n        this._shader = target._shader;\n\n        this._pipelineLayout = programLib.getTemplateInfo(this._programName).pipelineLayout;\n        this._hash = target._hash ^ hashFactor;\n    }\n\n    // Only for UI\n    private _updatePassHash () {\n        this._hash = Pass.getPassHash(this);\n    }\n\n    // infos\n    get root (): Root { return this._root; }\n    get device (): Device { return this._device; }\n    get shaderInfo (): IProgramInfo { return this._shaderInfo; }\n    get localSetLayout (): DescriptorSetLayout { return programLib.getDescriptorSetLayout(this._device, this._programName, true); }\n    get program (): string { return this._programName; }\n    get properties (): Record<string, EffectAsset.IPropertyInfo> { return this._properties; }\n    get defines (): Record<string, string | number | boolean> { return this._defines; }\n    get passIndex (): number { return this._passIndex; }\n    get propertyIndex (): number { return this._propertyIndex; }\n    // data\n    get dynamics (): IPassDynamics { return this._dynamics; }\n    get blocks (): Float32Array[] { return this._blocks; }\n    get blocksInt (): Int32Array[] { return this._blocksInt; }\n    get rootBufferDirty (): boolean { return this._rootBufferDirty; }\n    // states\n    get priority (): RenderPriority { return this._priority; }\n    get primitive (): PrimitiveMode { return this._primitive; }\n    get stage (): RenderPassStage { return this._stage; }\n    get phase (): number { return this._phase; }\n    get rasterizerState (): RasterizerState { return this._rs; }\n    get depthStencilState (): DepthStencilState { return this._dss; }\n    get blendState (): BlendState { return this._bs; }\n    get dynamicStates (): DynamicStateFlags { return this._dynamicStates; }\n    get batchingScheme (): BatchingSchemes { return this._batchingScheme; }\n    get descriptorSet (): DescriptorSet { return this._descriptorSet; }\n    get hash (): number { return this._hash; }\n    get pipelineLayout (): PipelineLayout { return this._pipelineLayout; }\n}\n\nfunction serializeBlendState (bs: BlendState): string {\n    let res = `,bs,${bs.isA2C}`;\n    for (const t of bs.targets) {\n        res += `,bt,${t.blend},${t.blendEq},${t.blendAlphaEq},${t.blendColorMask}`;\n        res += `,${t.blendSrc},${t.blendDst},${t.blendSrcAlpha},${t.blendDstAlpha}`;\n    }\n    return res;\n}\n\nfunction serializeRasterizerState (rs: RasterizerState): string {\n    return `,rs,${rs.cullMode},${rs.depthBias},${rs.isFrontFaceCCW}`;\n}\n\nfunction serializeDepthStencilState (dss: DepthStencilState): string {\n    let res = `,dss,${dss.depthTest},${dss.depthWrite},${dss.depthFunc}`;\n    res += `,${dss.stencilTestFront},${dss.stencilFuncFront},${dss.stencilRefFront},${dss.stencilReadMaskFront}`;\n    res += `,${dss.stencilFailOpFront},${dss.stencilZFailOpFront},${dss.stencilPassOpFront},${dss.stencilWriteMaskFront}`;\n    res += `,${dss.stencilTestBack},${dss.stencilFuncBack},${dss.stencilRefBack},${dss.stencilReadMaskBack}`;\n    res += `,${dss.stencilFailOpBack},${dss.stencilZFailOpBack},${dss.stencilPassOpBack},${dss.stencilWriteMaskBack}`;\n    return res;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, TEST } from 'internal:constants';\nimport { Asset } from '../assets/asset';\nimport { ImageAsset, ImageSource } from '../assets/image-asset';\nimport { SpriteFrame } from '../../2d/assets/sprite-frame';\nimport { Texture2D } from '../assets/texture-2d';\nimport { TextureCube } from '../assets/texture-cube';\nimport { legacyCC } from '../global-exports';\nimport assetManager from '../asset-manager/asset-manager';\nimport { BuiltinBundleName } from '../asset-manager/shared';\nimport Bundle from '../asset-manager/bundle';\nimport { Settings, settings } from '../settings';\nimport releaseManager from '../asset-manager/release-manager';\nimport { Material } from '../assets';\n\nclass BuiltinResMgr {\n    protected _resources: Record<string, Asset> = {};\n    protected _materialsToBeCompiled: Material[] = [];\n\n    // this should be called after renderer initialized\n    public init () {\n        const resources = this._resources;\n        const len = 2;\n        const numChannels = 4;\n\n        const blackValueView   = new Uint8Array(len * len * numChannels);\n        const emptyValueView   = new Uint8Array(len * len * numChannels);\n        const greyValueView    = new Uint8Array(len * len * numChannels);\n        const whiteValueView   = new Uint8Array(len * len * numChannels);\n        const normalValueView  = new Uint8Array(len * len * numChannels);\n\n        let offset = 0;\n        for (let i = 0; i < len * len; i++) {\n            blackValueView[offset]     = 0;\n            blackValueView[offset + 1] = 0;\n            blackValueView[offset + 2] = 0;\n            blackValueView[offset + 3] = 255;\n\n            emptyValueView[offset]     = 0;\n            emptyValueView[offset + 1] = 0;\n            emptyValueView[offset + 2] = 0;\n            emptyValueView[offset + 3] = 0;\n\n            greyValueView[offset]     = 119;\n            greyValueView[offset + 1] = 119;\n            greyValueView[offset + 2] = 119;\n            greyValueView[offset + 3] = 255;\n\n            whiteValueView[offset]     = 255;\n            whiteValueView[offset + 1] = 255;\n            whiteValueView[offset + 2] = 255;\n            whiteValueView[offset + 3] = 255;\n\n            normalValueView[offset]     = 127;\n            normalValueView[offset + 1] = 127;\n            normalValueView[offset + 2] = 255;\n            normalValueView[offset + 3] = 255;\n\n            offset += numChannels;\n        }\n\n        const defaultSize = 16;\n        const halfDefaultSize = defaultSize / 2;\n        const defaultValueView = new Uint8Array(defaultSize * defaultSize * numChannels);\n\n        offset = 0;\n        for (let i = 0; i < defaultSize * defaultSize; i++) {\n            defaultValueView[offset]     = 221;\n            defaultValueView[offset + 1] = 221;\n            defaultValueView[offset + 2] = 221;\n            defaultValueView[offset + 3] = 255;\n\n            offset += numChannels;\n        }\n        offset = 0;\n        for (let i = 0; i < halfDefaultSize; i++) {\n            for (let j = 0; j < halfDefaultSize; j++) {\n                defaultValueView[offset]     = 85;\n                defaultValueView[offset + 1] = 85;\n                defaultValueView[offset + 2] = 85;\n                defaultValueView[offset + 3] = 255;\n\n                offset += numChannels;\n            }\n            offset += halfDefaultSize * numChannels;\n        }\n        offset += halfDefaultSize * numChannels;\n        for (let i = 0; i < halfDefaultSize; i++) {\n            for (let j = 0; j < halfDefaultSize; j++) {\n                defaultValueView[offset]     = 85;\n                defaultValueView[offset + 1] = 85;\n                defaultValueView[offset + 2] = 85;\n                defaultValueView[offset + 3] = 255;\n\n                offset += numChannels;\n            }\n            offset += halfDefaultSize * numChannels;\n        }\n\n        const blackMemImageSource: ImageSource = {\n            width: len,\n            height: len,\n            _data: blackValueView,\n            _compressed: false,\n            format: Texture2D.PixelFormat.RGBA8888,\n        };\n\n        const emptyMemImageSource: ImageSource = {\n            width: len,\n            height: len,\n            _data: emptyValueView,\n            _compressed: false,\n            format: Texture2D.PixelFormat.RGBA8888,\n        };\n\n        const greyMemImageSource: ImageSource = {\n            width: len,\n            height: len,\n            _data: greyValueView,\n            _compressed: false,\n            format: Texture2D.PixelFormat.RGBA8888,\n        };\n\n        const whiteMemImageSource: ImageSource = {\n            width: len,\n            height: len,\n            _data: whiteValueView,\n            _compressed: false,\n            format: Texture2D.PixelFormat.RGBA8888,\n        };\n\n        const normalMemImageSource: ImageSource = {\n            width: len,\n            height: len,\n            _data: normalValueView,\n            _compressed: false,\n            format: Texture2D.PixelFormat.RGBA8888,\n        };\n\n        const defaultMemImageSource: ImageSource = {\n            width: defaultSize,\n            height: defaultSize,\n            _data: defaultValueView,\n            _compressed: false,\n            format: Texture2D.PixelFormat.RGBA8888,\n        };\n\n        // ============================\n        // builtin textures\n        // type string postfix according to getStringFromType()\n        // ============================\n\n        // black texture\n        const imgAsset = new ImageAsset(blackMemImageSource);\n        const blackTexture = new Texture2D();\n        blackTexture._uuid = 'black-texture';\n        blackTexture.image = imgAsset;\n        resources[blackTexture._uuid] = blackTexture;\n\n        // empty texture\n        const emptyImgAsset = new ImageAsset(emptyMemImageSource);\n        const emptyTexture = new Texture2D();\n        emptyTexture._uuid = 'empty-texture';\n        emptyTexture.image = emptyImgAsset;\n        resources[emptyTexture._uuid] = emptyTexture;\n\n        // black cube texture\n        const blackCubeTexture = new TextureCube();\n        blackCubeTexture._uuid = 'black-cube-texture';\n        blackCubeTexture.setMipFilter(TextureCube.Filter.NEAREST);\n        blackCubeTexture.image = {\n            front: new ImageAsset(blackMemImageSource),\n            back: new ImageAsset(blackMemImageSource),\n            left: new ImageAsset(blackMemImageSource),\n            right: new ImageAsset(blackMemImageSource),\n            top: new ImageAsset(blackMemImageSource),\n            bottom: new ImageAsset(blackMemImageSource),\n        };\n        resources[blackCubeTexture._uuid] = blackCubeTexture;\n\n        // grey texture\n        const greyImgAsset = new ImageAsset(greyMemImageSource);\n        const greyTexture = new Texture2D();\n        greyTexture._uuid = 'grey-texture';\n        greyTexture.image = greyImgAsset;\n        resources[greyTexture._uuid] = greyTexture;\n\n        // grey cube texture\n        const greyCubeTexture = new TextureCube();\n        greyCubeTexture._uuid = 'grey-cube-texture';\n        greyCubeTexture.setMipFilter(TextureCube.Filter.NEAREST);\n        greyCubeTexture.image = {\n            front: new ImageAsset(greyMemImageSource),\n            back: new ImageAsset(greyMemImageSource),\n            left: new ImageAsset(greyMemImageSource),\n            right: new ImageAsset(greyMemImageSource),\n            top: new ImageAsset(greyMemImageSource),\n            bottom: new ImageAsset(greyMemImageSource),\n        };\n        resources[greyCubeTexture._uuid] = greyCubeTexture;\n\n        // white texture\n        const whiteImgAsset = new ImageAsset(whiteMemImageSource);\n        const whiteTexture = new Texture2D();\n        whiteTexture._uuid = 'white-texture';\n        whiteTexture.image = whiteImgAsset;\n        resources[whiteTexture._uuid] = whiteTexture;\n\n        // white cube texture\n        const whiteCubeTexture = new TextureCube();\n        whiteCubeTexture._uuid = 'white-cube-texture';\n        whiteCubeTexture.setMipFilter(TextureCube.Filter.NEAREST);\n        whiteCubeTexture.image = {\n            front: new ImageAsset(whiteMemImageSource),\n            back: new ImageAsset(whiteMemImageSource),\n            left: new ImageAsset(whiteMemImageSource),\n            right: new ImageAsset(whiteMemImageSource),\n            top: new ImageAsset(whiteMemImageSource),\n            bottom: new ImageAsset(whiteMemImageSource),\n        };\n        resources[whiteCubeTexture._uuid] = whiteCubeTexture;\n\n        // normal texture\n        const normalImgAsset = new ImageAsset(normalMemImageSource);\n        const normalTexture = new Texture2D();\n        normalTexture._uuid = 'normal-texture';\n        normalTexture.image = normalImgAsset;\n        resources[normalTexture._uuid] = normalTexture;\n\n        // default texture\n        const defaultImgAsset = new ImageAsset(defaultMemImageSource);\n        const defaultTexture = new Texture2D();\n        defaultTexture._uuid = 'default-texture';\n        defaultTexture.image = defaultImgAsset;\n        resources[defaultTexture._uuid] = defaultTexture;\n\n        // default cube texture\n        const defaultCubeTexture = new TextureCube();\n        defaultCubeTexture.setMipFilter(TextureCube.Filter.NEAREST);\n        defaultCubeTexture._uuid = 'default-cube-texture';\n        defaultCubeTexture.image = {\n            front: new ImageAsset(defaultMemImageSource),\n            back: new ImageAsset(defaultMemImageSource),\n            left: new ImageAsset(defaultMemImageSource),\n            right: new ImageAsset(defaultMemImageSource),\n            top: new ImageAsset(defaultMemImageSource),\n            bottom: new ImageAsset(defaultMemImageSource),\n        };\n        resources[defaultCubeTexture._uuid] = defaultCubeTexture;\n\n        if (legacyCC.SpriteFrame) {\n            const spriteFrame = new legacyCC.SpriteFrame() as SpriteFrame;\n            const image = imgAsset;\n            const texture = new Texture2D();\n            texture.image = image;\n            spriteFrame.texture = texture;\n            spriteFrame._uuid = 'default-spriteframe';\n            resources[spriteFrame._uuid] = spriteFrame;\n        }\n\n        if (EDITOR) {\n            const builtinAssets = settings.querySettings<string[]>(Settings.Category.ENGINE, 'builtinAssets');\n            const builtinBundle = new Bundle();\n            builtinBundle.init({\n                name: BuiltinBundleName.INTERNAL,\n                uuids: builtinAssets || [],\n                deps: [],\n                importBase: '',\n                nativeBase: '',\n                base: '',\n                paths: {},\n                scenes: {},\n                packs: {},\n                versions: { import: [], native: [] },\n                redirect: [],\n                debug: false,\n                types: [],\n                extensionMap: {},\n            });\n        }\n    }\n\n    public addAsset (key: string, asset: Asset) {\n        this._resources[key] = asset;\n    }\n\n    public get<T extends Asset> (uuid: string) {\n        return this._resources[uuid] as T;\n    }\n\n    /**\n     * @internal\n     */\n    public loadBuiltinAssets () {\n        const builtinAssets = settings.querySettings<string[]>(Settings.Category.ENGINE, 'builtinAssets');\n        if (TEST || !builtinAssets) return Promise.resolve();\n        const resources = this._resources;\n        return new Promise<void>((resolve, reject) => {\n            assetManager.loadBundle(BuiltinBundleName.INTERNAL, (err, bundle) => {\n                if (err) {\n                    reject(err);\n                    return;\n                }\n                assetManager.loadAny(builtinAssets, (err, assets) => {\n                    if (err) {\n                        reject(err);\n                    } else {\n                        assets.forEach((asset) => {\n                            resources[asset.name] = asset;\n                            // In Editor, no need to ignore asset destroy, we use auto gc to handle destroy\n                            if (!EDITOR || legacyCC.GAME_VIEW) { releaseManager.addIgnoredAsset(asset); }\n                            if (asset instanceof legacyCC.Material) {\n                                this._materialsToBeCompiled.push(asset as Material);\n                            }\n                        });\n                        resolve();\n                    }\n                });\n            });\n        });\n    }\n\n    public compileBuiltinMaterial () {\n        // NOTE: Builtin material should be compiled again after the render pipeline setup\n        for (let i = 0; i < this._materialsToBeCompiled.length; ++i) {\n            const mat = this._materialsToBeCompiled[i];\n            for (let j = 0; j < mat.passes.length; ++j) {\n                mat.passes[j].tryCompile();\n            }\n        }\n        this._materialsToBeCompiled.length = 0;\n    }\n}\n\nconst builtinResMgr = legacyCC.builtinResMgr = new BuiltinResMgr();\nexport { builtinResMgr };\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Pass } from '../renderer';\nimport { IInstancedAttributeBlock, SubModel } from '../renderer/scene';\nimport { UNIFORM_LIGHTMAP_TEXTURE_BINDING } from './define';\nimport { BufferUsageBit, MemoryUsageBit, Device, Texture, InputAssembler, InputAssemblerInfo,\n    Attribute, Buffer, BufferInfo, CommandBuffer, Shader, DescriptorSet  } from '../gfx';\n\nexport interface IInstancedItem {\n    count: number;\n    capacity: number;\n    vb: Buffer;\n    data: Uint8Array;\n    ia: InputAssembler;\n    stride: number;\n    shader: Shader | null;\n    descriptorSet: DescriptorSet;\n    lightingMap: Texture;\n}\n\nconst INITIAL_CAPACITY = 32;\nconst MAX_CAPACITY = 1024;\n\nexport class InstancedBuffer {\n    public instances: IInstancedItem[] = [];\n    public pass: Pass;\n    public hasPendingModels = false;\n    public dynamicOffsets: number[] = [];\n    private _device: Device;\n\n    constructor (pass: Pass) {\n        this._device = pass.device;\n        this.pass = pass;\n    }\n\n    public destroy () {\n        for (let i = 0; i < this.instances.length; ++i) {\n            const instance = this.instances[i];\n            instance.vb.destroy();\n            instance.ia.destroy();\n        }\n        this.instances.length = 0;\n    }\n\n    public merge (subModel: SubModel, passIdx: number, shaderImplant: Shader | null = null) {\n        const attrs = subModel.instancedAttributeBlock;\n        const stride = attrs.buffer.length;\n        if (!stride) { return; } // we assume per-instance attributes are always present\n        const sourceIA = subModel.inputAssembler;\n        const lightingMap = subModel.descriptorSet.getTexture(UNIFORM_LIGHTMAP_TEXTURE_BINDING);\n        let shader = shaderImplant;\n        if (!shader) {\n            shader = subModel.shaders[passIdx];\n        }\n        const descriptorSet = subModel.descriptorSet;\n        for (let i = 0; i < this.instances.length; ++i) {\n            const instance = this.instances[i];\n            if (instance.ia.indexBuffer?.objectID !== sourceIA.indexBuffer?.objectID || instance.count >= MAX_CAPACITY) { continue; }\n\n            // check same binding\n            if (instance.lightingMap.objectID !== lightingMap.objectID) {\n                continue;\n            }\n\n            if (instance.stride !== stride) {\n                // we allow this considering both baked and non-baked\n                // skinning models may be present in the same buffer\n                continue;\n            }\n            if (instance.count >= instance.capacity) { // resize buffers\n                instance.capacity <<= 1;\n                const newSize = instance.stride * instance.capacity;\n                const oldData = instance.data;\n                instance.data = new Uint8Array(newSize);\n                instance.data.set(oldData);\n                instance.vb.resize(newSize);\n            }\n            instance.shader = shader;\n            instance.descriptorSet = descriptorSet;\n            instance.data.set(attrs.buffer, instance.stride * instance.count++);\n            this.hasPendingModels = true;\n            return;\n        }\n\n        // Create a new instance\n        const vb = this._device.createBuffer(new BufferInfo(\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            stride * INITIAL_CAPACITY,\n            stride,\n        ));\n        const data = new Uint8Array(stride * INITIAL_CAPACITY);\n        const vertexBuffers = sourceIA.vertexBuffers.slice();\n        const attributes = sourceIA.attributes.slice();\n        const indexBuffer = sourceIA.indexBuffer;\n\n        for (let i = 0; i < attrs.attributes.length; i++) {\n            const attr = attrs.attributes[i];\n            const newAttr = new Attribute(attr.name, attr.format, attr.isNormalized, vertexBuffers.length, true);\n            attributes.push(newAttr);\n        }\n        data.set(attrs.buffer);\n\n        vertexBuffers.push(vb);\n        const iaInfo = new InputAssemblerInfo(attributes, vertexBuffers, indexBuffer);\n        const ia = this._device.createInputAssembler(iaInfo);\n        this.instances.push({ count: 1, capacity: INITIAL_CAPACITY, vb, data, ia, stride, shader, descriptorSet, lightingMap });\n        this.hasPendingModels = true;\n    }\n\n    public uploadBuffers (cmdBuff: CommandBuffer) {\n        for (let i = 0; i < this.instances.length; ++i) {\n            const instance = this.instances[i];\n            if (!instance.count) { continue; }\n            instance.ia.instanceCount = instance.count;\n            cmdBuff.updateBuffer(instance.vb, instance.data);\n        }\n    }\n\n    public clear () {\n        for (let i = 0; i < this.instances.length; ++i) {\n            const instance = this.instances[i];\n            instance.count = 0;\n        }\n        this.hasPendingModels = false;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { BufferUsageBit, Format, MemoryUsageBit, Device, DescriptorSet, InputAssembler,\n    InputAssemblerInfo, Attribute, Buffer, BufferInfo, Shader } from '../gfx';\nimport { Mat4 } from '../math';\nimport { SubModel } from '../renderer/scene/submodel';\nimport { UBOLocalBatched } from './define';\nimport { Pass } from '../renderer';\nimport { Model } from '../renderer/scene';\n\nexport interface IBatchedItem {\n    vbs: Buffer[];\n    vbDatas: Uint8Array[];\n    vbIdx: Buffer;\n    vbIdxData: Float32Array;\n    vbCount: number;\n    mergeCount: number;\n    ia: InputAssembler;\n    ubo: Buffer;\n    uboData: Float32Array;\n    descriptorSet: DescriptorSet;\n    pass: Pass;\n    shader: Shader | null;\n}\n\nexport class BatchedBuffer {\n    public batches: IBatchedItem[] = [];\n    public dynamicOffsets: number[] = [];\n    private _device: Device;\n\n    constructor (pass: Pass) {\n        this._device = pass.device;\n    }\n\n    public destroy () {\n        for (let i = 0; i < this.batches.length; ++i) {\n            const batch = this.batches[i];\n            for (let j = 0; j < batch.vbs.length; ++j) {\n                batch.vbs[j].destroy();\n            }\n            batch.vbIdx.destroy();\n            batch.ia.destroy();\n            batch.ubo.destroy();\n        }\n        this.batches.length = 0;\n    }\n\n    public merge (subModel: SubModel, passIdx: number, model: Model) {\n        const flatBuffers = subModel.subMesh.flatBuffers;\n        if (flatBuffers.length === 0) { return; }\n        let vbSize = 0;\n        let vbIdxSize = 0;\n        const vbCount = flatBuffers[0].count;\n        const pass = subModel.passes[passIdx];\n        const shader = subModel.shaders[passIdx];\n        const descriptorSet = subModel.descriptorSet;\n        let isBatchExist = false;\n        for (let i = 0; i < this.batches.length; ++i) {\n            const batch = this.batches[i];\n            if (batch.vbs.length === flatBuffers.length && batch.mergeCount < UBOLocalBatched.BATCHING_COUNT) {\n                isBatchExist = true;\n                for (let j = 0; j < batch.vbs.length; ++j) {\n                    const vb = batch.vbs[j];\n                    if (vb.stride !== flatBuffers[j].stride) {\n                        isBatchExist = false;\n                        break;\n                    }\n                }\n\n                if (isBatchExist) {\n                    for (let j = 0; j < batch.vbs.length; ++j) {\n                        const flatBuff = flatBuffers[j];\n                        const batchVB = batch.vbs[j];\n                        const vbBuf = batch.vbDatas[j];\n                        vbSize = (vbCount + batch.vbCount) * flatBuff.stride;\n                        if (vbSize > batchVB.size) {\n                            batchVB.resize(vbSize);\n                            batch.vbDatas[j] = new Uint8Array(vbSize);\n                            batch.vbDatas[j].set(vbBuf);\n                        }\n                        batch.vbDatas[j].set(flatBuff.buffer, batch.vbCount * flatBuff.stride);\n                    }\n\n                    let vbIdxBuf = batch.vbIdxData;\n                    vbIdxSize = (vbCount + batch.vbCount) * 4;\n                    if (vbIdxSize > batch.vbIdx.size) {\n                        batch.vbIdx.resize(vbIdxSize);\n                        batch.vbIdxData = new Float32Array(vbIdxSize / Float32Array.BYTES_PER_ELEMENT);\n                        batch.vbIdxData.set(vbIdxBuf);\n                        vbIdxBuf = batch.vbIdxData;\n                    }\n\n                    const start = batch.vbCount;\n                    const end = start + vbCount;\n                    const mergeCount = batch.mergeCount;\n                    if (vbIdxBuf[start] !== mergeCount || vbIdxBuf[end - 1] !== mergeCount) {\n                        for (let j = start; j < end; j++) {\n                            vbIdxBuf[j] = mergeCount + 0.1; // guard against underflow\n                        }\n                    }\n\n                    // update world matrix\n                    Mat4.toArray(batch.uboData, model.transform.worldMatrix, UBOLocalBatched.MAT_WORLDS_OFFSET + batch.mergeCount * 16);\n                    if (!batch.mergeCount) {\n                        descriptorSet.bindBuffer(UBOLocalBatched.BINDING, batch.ubo);\n                        descriptorSet.update();\n                        batch.pass = pass;\n                        batch.shader = shader;\n                        batch.descriptorSet = descriptorSet;\n                    }\n\n                    ++batch.mergeCount;\n                    batch.vbCount += vbCount;\n                    batch.ia.vertexCount += vbCount;\n\n                    return;\n                }\n            }\n        }\n\n        // Create a new batch\n        const vbs: Buffer[] = [];\n        const vbDatas: Uint8Array[] = [];\n        const totalVBs: Buffer[] = [];\n        for (let i = 0; i < flatBuffers.length; ++i) {\n            const flatBuff = flatBuffers[i];\n            const newVB = this._device.createBuffer(new BufferInfo(\n                BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n                MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n                flatBuff.count * flatBuff.stride,\n                flatBuff.stride,\n            ));\n            newVB.update(flatBuff.buffer.buffer);\n            vbs.push(newVB);\n            vbDatas.push(new Uint8Array(newVB.size));\n            totalVBs.push(newVB);\n        }\n\n        const vbIdx = this._device.createBuffer(new BufferInfo(\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            vbCount * 4,\n            4,\n        ));\n        const vbIdxData = new Float32Array(vbCount);\n        vbIdxData.fill(0);\n        vbIdx.update(vbIdxData);\n        totalVBs.push(vbIdx);\n\n        const attributes = subModel.inputAssembler.attributes;\n        const attrs = new Array<Attribute>(attributes.length + 1);\n        for (let a = 0; a < attributes.length; ++a) {\n            attrs[a] = attributes[a];\n        }\n        attrs[attributes.length] = new Attribute('a_dyn_batch_id', Format.R32F, false, flatBuffers.length);\n\n        const iaInfo = new InputAssemblerInfo(attrs, totalVBs);\n        const ia = this._device.createInputAssembler(iaInfo);\n\n        const ubo = this._device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            UBOLocalBatched.SIZE,\n            UBOLocalBatched.SIZE,\n        ));\n\n        descriptorSet.bindBuffer(UBOLocalBatched.BINDING, ubo);\n        descriptorSet.update();\n\n        const uboData = new Float32Array(UBOLocalBatched.COUNT);\n        Mat4.toArray(uboData, model.transform.worldMatrix, UBOLocalBatched.MAT_WORLDS_OFFSET);\n\n        this.batches.push({\n            mergeCount: 1,\n            vbs,\n            vbDatas,\n            vbIdx,\n            vbIdxData,\n            vbCount,\n            ia,\n            ubo,\n            uboData,\n            pass,\n            shader,\n            descriptorSet,\n        });\n    }\n\n    public clear () {\n        for (let i = 0; i < this.batches.length; ++i) {\n            const batch = this.batches[i];\n            batch.vbCount = 0;\n            batch.mergeCount = 0;\n            batch.ia.vertexCount = 0;\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Shader, RenderPass, InputAssembler, Device, PipelineState, InputState, PipelineStateInfo } from '../gfx';\nimport { Pass } from '../renderer/core/pass';\n\nexport class PipelineStateManager {\n    private static _PSOHashMap: Map<number, PipelineState> = new Map<number, PipelineState>();\n\n    // pass is only needed on TS.\n    static getOrCreatePipelineState (device: Device, pass: Pass, shader: Shader, renderPass: RenderPass, ia: InputAssembler) {\n        const hash1 = pass.hash;\n        const hash2 = renderPass.hash;\n        const hash3 = ia.attributesHash;\n        const hash4 = shader.typedID;\n\n        const newHash = hash1 ^ hash2 ^ hash3 ^ hash4;\n        let pso = this._PSOHashMap.get(newHash);\n        if (!pso) {\n            const pipelineLayout = pass.pipelineLayout;\n            const inputState = new InputState(ia.attributes);\n            const psoInfo = new PipelineStateInfo(\n                shader, pipelineLayout, renderPass, inputState,\n                pass.rasterizerState,\n                pass.depthStencilState,\n                pass.blendState,\n                pass.primitive,\n                pass.dynamicStates,\n            );\n            pso = device.createPipelineState(psoInfo);\n            this._PSOHashMap.set(newHash, pso);\n        }\n\n        return pso;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { CommandBuffer, Device, Rect, RenderPass, Swapchain, Viewport } from '../gfx';\nimport { IVec4Like } from '../math';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { SetIndex } from './define';\nimport { Camera, Model } from '../renderer/scene';\n\nconst profilerViewport = new Viewport();\nconst profilerScissor = new Rect();\n\n/**\n * @en Convert color in SRGB space to linear space\n * @zh SRGB 颜色空间转换为线性空间。\n * @param out Output color object\n * @param gamma Gamma value in SRGB space\n */\nexport function SRGBToLinear (out: IVec4Like, gamma: IVec4Like) {\n    // out.x = Math.pow(gamma.x, 2.2);\n    // out.y = Math.pow(gamma.y, 2.2);\n    // out.z = Math.pow(gamma.z, 2.2);\n    out.x = gamma.x * gamma.x;\n    out.y = gamma.y * gamma.y;\n    out.z = gamma.z * gamma.z;\n}\n\n/**\n * @en Convert color in linear space to SRGB space\n * @zh 线性空间转换为 SRGB 颜色空间。\n * @param out Output color object\n * @param linear Color value in linear space\n */\nexport function LinearToSRGB (out: IVec4Like, linear: IVec4Like) {\n    // out.x = Math.pow(linear.x, 0.454545);\n    // out.y = Math.pow(linear.y, 0.454545);\n    // out.z = Math.pow(linear.z, 0.454545);\n    out.x = Math.sqrt(linear.x);\n    out.y = Math.sqrt(linear.y);\n    out.z = Math.sqrt(linear.z);\n}\n\nlet profilerCamera: Camera | null = null;\n\nexport function decideProfilerCamera (cameras: Camera[]) {\n    for (let i = cameras.length - 1; i >= 0; --i) {\n        const camera = cameras[i];\n        if (camera.window.swapchain) {\n            profilerCamera = camera;\n            return;\n        }\n    }\n    profilerCamera = null;\n}\n\nexport function renderProfiler (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer, profiler: Model | null, camera: Camera) {\n    if (profiler && profiler.enabled && camera === profilerCamera) {\n        const { inputAssembler, passes, shaders, descriptorSet } = profiler.subModels[0];\n        profilerViewport.width = profilerScissor.width = camera.window.width;\n        profilerViewport.height = profilerScissor.height = camera.window.height;\n        const pso = PipelineStateManager.getOrCreatePipelineState(device, passes[0], shaders[0], renderPass, inputAssembler);\n\n        cmdBuff.setViewport(profilerViewport);\n        cmdBuff.setScissor(profilerScissor);\n        cmdBuff.bindPipelineState(pso);\n        cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, passes[0].descriptorSet);\n        cmdBuff.bindDescriptorSet(SetIndex.LOCAL, descriptorSet);\n        cmdBuff.bindInputAssembler(inputAssembler);\n        cmdBuff.draw(inputAssembler);\n    }\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable, type } from 'cc.decorator';\nimport { Asset } from './asset';\nimport { EffectAsset } from './effect-asset';\nimport { Texture, Type } from '../gfx';\nimport { TextureBase } from './texture-base';\nimport { legacyCC } from '../global-exports';\nimport { IPassInfoFull, Pass, PassOverrides } from '../renderer/core/pass';\nimport { MacroRecord, MaterialProperty } from '../renderer/core/pass-utils';\nimport { Color } from '../math/color';\nimport { warnID } from '../platform/debug';\nimport { Vec4 } from '../math';\nimport { SRGBToLinear } from '../pipeline/pipeline-funcs';\nimport { Renderer } from '../components/renderer';\n\nconst v4_1 = new Vec4();\n\n/**\n * @en The basic infos for material initialization.\n * @zh 用来初始化材质的基本信息。\n */\nexport interface IMaterialInfo {\n    /**\n     * @en The EffectAsset to use. Must provide if `effectName` is not specified.\n     * @zh\n     * 这个材质将使用的 EffectAsset，直接提供资源引用，和 `effectName` 至少要指定一个。\n     */\n    effectAsset?: EffectAsset | null;\n    /**\n     * @en\n     * The name of the EffectAsset to use. Must provide if `effectAsset` is not specified.\n     * @zh\n     * 这个材质将使用的 EffectAsset，通过 effect 名指定，和 `effectAsset` 至少要指定一个。\n     */\n    effectName?: string;\n    /**\n     * @en\n     * The index of the technique to use.\n     * @zh\n     * 这个材质将使用第几个 technique，默认为 0。\n     */\n    technique?: number;\n    /**\n     * @en\n     * The shader macro definitions. Default to 0 or the specified value in [[EffectAsset]].\n     * @zh\n     * 这个材质定义的预处理宏，默认全为 0，或 [[EffectAsset]] 中的指定值。\n     */\n    defines?: MacroRecord | MacroRecord[];\n    /**\n     * @en\n     * The override values on top of the pipeline states specified in [[EffectAsset]].\n     * @zh\n     * 这个材质的自定义管线状态，将覆盖 effect 中的属性。<br>\n     * 注意在可能的情况下请尽量少的自定义管线状态，以减小对渲染效率的影响。\n     */\n    states?: PassOverrides | PassOverrides[];\n}\n\ntype MaterialPropertyFull = MaterialProperty | TextureBase | Texture | null;\n\n/**\n * @en The material asset, specifies in details how a model is drawn on screen.\n * @zh 材质资源类，包含模型绘制方式的全部细节描述。\n */\n@ccclass('cc.Material')\nexport class Material extends Asset {\n    /**\n     * @en Get hash for a material\n     * @zh 获取一个材质的哈希值\n     * @param material\n     */\n    public static getHash (material: Material) {\n        let hash = 0;\n        for (const pass of material.passes) {\n            hash ^= pass.hash;\n        }\n        return hash;\n    }\n\n    @type(EffectAsset)\n    protected _effectAsset: EffectAsset | null = null;\n\n    @serializable\n    protected _techIdx = 0;\n\n    @serializable\n    protected _defines: MacroRecord[] = [];\n\n    @serializable\n    protected _states: PassOverrides[] = [];\n\n    @serializable\n    protected _props: Record<string, MaterialPropertyFull | MaterialPropertyFull[]>[] = [];\n\n    protected _passes: Pass[] = [];\n\n    protected _hash = 0;\n\n    constructor () {\n        super();\n    }\n\n    /**\n     * @en The current [[EffectAsset]].\n     * @zh 当前使用的 [[EffectAsset]] 资源。\n     */\n    get effectAsset () {\n        return this._effectAsset;\n    }\n\n    /**\n     * @en Name of the current [[EffectAsset]].\n     * @zh 当前使用的 [[EffectAsset]] 资源名。\n     */\n    get effectName () {\n        return this._effectAsset ? this._effectAsset.name : '';\n    }\n\n    /**\n     * @en The current technique index.\n     * @zh 当前的 technique 索引。\n     */\n    get technique () {\n        return this._techIdx;\n    }\n\n    /**\n     * @en The passes defined in this material.\n     * @zh 当前正在使用的 pass 数组。\n     */\n    get passes () {\n        return this._passes;\n    }\n\n    /**\n     * @en The hash value of this material.\n     * @zh 材质的 hash。\n     */\n    get hash () {\n        return this._hash;\n    }\n\n    /**\n     * @en The parent material\n     * @zh 父材质\n     */\n    get parent (): Material | null {\n        return null;\n    }\n\n    /**\n     * @en The owner render component\n     * @zh 该材质所归属的渲染组件\n     */\n    get owner (): Renderer | null {\n        return null;\n    }\n\n    /**\n     * @en Initialize this material with the given information.\n     * @zh 根据所给信息初始化这个材质，初始化正常结束后材质即可立即用于渲染。\n     * @param info Material description info.\n     */\n    public initialize (info: IMaterialInfo) {\n        if (this._passes.length) {\n            warnID(12005);\n            return;\n        }\n\n        if (!this._defines) { this._defines = []; }\n        if (!this._states) { this._states = []; }\n        if (!this._props) { this._props = []; }\n        this._fillInfo(info);\n        this._update();\n    }\n\n    public reset (info: IMaterialInfo) { // to be consistent with other assets\n        this.initialize(info);\n    }\n\n    /**\n     * @en\n     * Destroy the material definitively.<br>\n     * Cannot re-initialize after destroy.<br>\n     * Modifications on active materials can be acheived by<br>\n     * creating a new Material, invoke the `copy` function<br>\n     * with the desired overrides, and assigning it to the target components.\n     * @zh\n     * 彻底销毁材质，注意销毁后无法重新初始化。<br>\n     * 如需修改现有材质，请创建一个新材质，<br>\n     * 调用 copy 函数传入需要的 overrides 并赋给目标组件。\n     */\n    public destroy () {\n        this._doDestroy();\n        return super.destroy();\n    }\n\n    /**\n     * @en Recompile the shader with the specified macro overrides. Allowed only on material instances.\n     * @zh 使用指定预处理宏重新编译当前 pass（数组）中的 shader。只允许对材质实例执行。\n     * @param overrides The shader macro override values.\n     * @param passIdx The pass to apply to. Will apply to all passes if not specified.\n     */\n    public recompileShaders (overrides: MacroRecord, passIdx?: number) {\n        console.warn(`Shaders in material asset '${this.name}' cannot be modified at runtime, please instantiate the material first.`);\n    }\n\n    /**\n     * @en Override the passes with the specified pipeline states. Allowed only on material instances.\n     * @zh 使用指定管线状态重载当前的 pass（数组）。只允许对材质实例执行。\n     * @param overrides The pipeline state override values.\n     * @param passIdx The pass to apply to. Will apply to all passes if not specified.\n     */\n    public overridePipelineStates (overrides: PassOverrides, passIdx?: number) {\n        console.warn(`Pipeline states in material asset '${this.name}' cannot be modified at runtime, please instantiate the material first.`);\n    }\n\n    /**\n     * @en Callback function after material is loaded in [[CCLoader]]. Initialize the resources automatically.\n     * @zh 通过 [[CCLoader]] 加载完成时的回调，将自动初始化材质资源。\n     */\n    public onLoaded () {\n        this._update();\n    }\n\n    /**\n     * @en Reset all the uniforms to the default value specified in [[EffectAsset]].\n     * @zh 重置材质的所有 uniform 参数数据为 [[EffectAsset]] 中的默认初始值。\n     * @param clearPasses Will the rendering data be cleared too?\n     */\n    public resetUniforms (clearPasses = true) {\n        this._props.length = this._passes.length;\n        for (let i = 0; i < this._props.length; i++) { this._props[i] = {}; }\n        if (!clearPasses) { return; }\n        for (const pass of this._passes) {\n            pass.resetUBOs();\n            pass.resetTextures();\n        }\n    }\n\n    /**\n     * @en\n     * Convenient property setter provided for quick material setup.<br>\n     * [[renderer.Pass.setUniform]] should be used instead if you need to do per-frame uniform update.\n     * @zh\n     * 设置材质 uniform 参数的统一入口。<br>\n     * 注意如果需要每帧更新 uniform，建议使用 [[renderer.Pass.setUniform]] 以获得更好的性能。\n     * @param name The target uniform name.\n     * @param val The target value.\n     * @param passIdx The pass to apply to. Will apply to all passes if not specified.\n     */\n    public setProperty (name: string, val: MaterialPropertyFull | MaterialPropertyFull[], passIdx?: number) {\n        let success = false;\n        if (passIdx === undefined) { // try set property for all applicable passes\n            const passes = this._passes;\n            const len = passes.length;\n            for (let i = 0; i < len; i++) {\n                const pass = passes[i];\n                if (this._uploadProperty(pass, name, val)) {\n                    this._props[pass.propertyIndex][name] = val;\n                    success = true;\n                }\n            }\n        } else {\n            if (passIdx >= this._passes.length) { console.warn(`illegal pass index: ${passIdx}.`); return; }\n            const pass = this._passes[passIdx];\n            if (this._uploadProperty(pass, name, val)) {\n                this._props[pass.propertyIndex][name] = val;\n                success = true;\n            }\n        }\n        if (!success) {\n            console.warn(`illegal property name: ${name}.`);\n        }\n    }\n\n    /**\n     * @en\n     * Get the specified uniform value for this material.<br>\n     * Note that only uniforms set through [[Material.setProperty]] can be acquired here.<br>\n     * For the complete rendering data, use [[renderer.Pass.getUniform]] instead.\n     * @zh\n     * 获取当前材质的指定 uniform 参数的值。<br>\n     * 注意只有通过 [[Material.setProperty]] 函数设置的参数才能从此函数取出，<br>\n     * 如需取出完整的渲染数据，请使用 [[renderer.Pass.getUniform]]。\n     * @param name The property or uniform name.\n     * @param passIdx The target pass index. If not specified, return the first found value in all passes.\n     */\n    public getProperty (name: string, passIdx?: number) {\n        if (passIdx === undefined) { // try get property in all possible passes\n            const propsArray = this._props;\n            const len = propsArray.length;\n            for (let i = 0; i < len; i++) {\n                const props = propsArray[i];\n                if (name in props) { return props[name]; }\n            }\n        } else {\n            if (passIdx >= this._props.length) { console.warn(`illegal pass index: ${passIdx}.`); return null; }\n            const props = this._props[this._passes[passIdx].propertyIndex];\n            if (name in props) { return props[name]; }\n        }\n        return null;\n    }\n\n    /**\n     * @en Copy the target material, with optional overrides.\n     * @zh 复制目标材质到当前实例，允许提供重载信息。\n     * @param mat The material to be copied.\n     * @param overrides The overriding states on top of the original material.\n     */\n    public copy (mat: Material, overrides?: IMaterialInfo) {\n        this._techIdx = mat._techIdx;\n        this._props.length = mat._props.length;\n        for (let i = 0; i < mat._props.length; i++) {\n            this._props[i] = { ...mat._props[i] };\n        }\n        this._defines.length = mat._defines.length;\n        for (let i = 0; i < mat._defines.length; i++) {\n            this._defines[i] = { ...mat._defines[i] };\n        }\n        this._states.length = mat._states.length;\n        for (let i = 0; i < mat._states.length; i++) {\n            this._states[i] = { ...mat._states[i] };\n        }\n        this._effectAsset = mat._effectAsset;\n        if (overrides) this._fillInfo(overrides);\n        this._update();\n    }\n\n    protected _fillInfo (info: IMaterialInfo) {\n        if (info.technique !== undefined) { this._techIdx = info.technique; }\n        if (info.effectAsset) {\n            this._effectAsset = info.effectAsset;\n        } else if (info.effectName) {\n            this._effectAsset = EffectAsset.get(info.effectName);\n        }\n        if (info.defines) { this._prepareInfo(info.defines, this._defines); }\n        if (info.states) { this._prepareInfo(info.states, this._states); }\n    }\n\n    protected _prepareInfo (patch: Record<string, unknown> | Record<string, unknown>[], cur: Record<string, unknown>[]) {\n        let patchArray = patch;\n        if (!Array.isArray(patchArray)) { // fill all the passes if not specified\n            const len = this._effectAsset ? this._effectAsset.techniques[this._techIdx].passes.length : 1;\n            patchArray = Array(len).fill(patchArray);\n        }\n        for (let i = 0; i < patchArray.length; ++i) {\n            Object.assign(cur[i] || (cur[i] = {}), patchArray[i]);\n        }\n    }\n\n    protected _createPasses () {\n        const tech = this._effectAsset!.techniques[this._techIdx || 0];\n        if (!tech) { return []; }\n        const passNum = tech.passes.length;\n        const passes: Pass[] = [];\n        for (let k = 0; k < passNum; ++k) {\n            const passInfo = tech.passes[k] as IPassInfoFull;\n            const propIdx = passInfo.passIndex = k;\n            const defines = passInfo.defines = this._defines[propIdx] || (this._defines[propIdx] = {});\n            passInfo.stateOverrides = this._states[propIdx] || (this._states[propIdx] = {});\n            if (passInfo.propertyIndex !== undefined) {\n                Object.assign(defines, this._defines[passInfo.propertyIndex]);\n            }\n            if (passInfo.embeddedMacros !== undefined) {\n                Object.assign(defines, passInfo.embeddedMacros);\n            }\n            if (passInfo.switch && !defines[passInfo.switch]) { continue; }\n            const pass = new Pass(legacyCC.director.root);\n            pass.initialize(passInfo);\n            passes.push(pass);\n        }\n        return passes;\n    }\n\n    protected _update (keepProps = true) {\n        if (this._effectAsset) {\n            this._passes = this._createPasses();\n            // handle property values\n            const totalPasses = this._effectAsset.techniques[this._techIdx].passes.length;\n            this._props.length = totalPasses;\n            if (keepProps) {\n                this._passes.forEach((pass, i) => {\n                    let props = this._props[i];\n                    if (!props) { props = this._props[i] = {}; }\n                    if (pass.propertyIndex !== undefined) {\n                        Object.assign(props, this._props[pass.propertyIndex]);\n                    }\n                    for (const p in props) {\n                        this._uploadProperty(pass, p, props[p]);\n                    }\n                });\n            } else {\n                for (let i = 0; i < this._props.length; i++) { this._props[i] = {}; }\n            }\n        }\n        this._hash = Material.getHash(this);\n    }\n\n    protected _uploadProperty (pass: Pass, name: string, val: MaterialPropertyFull | MaterialPropertyFull[]) {\n        const handle = pass.getHandle(name);\n        if (!handle) { return false; }\n        const type = Pass.getTypeFromHandle(handle);\n        if (type < Type.SAMPLER1D) {\n            if (Array.isArray(val)) {\n                pass.setUniformArray(handle, val as MaterialProperty[]);\n            } else if (val !== null) {\n                if (pass.properties[name]?.linear) {\n                    const v4 = val as Vec4;\n                    SRGBToLinear(v4_1, v4);\n                    v4_1.w = v4.w;\n                    val = v4_1;\n                }\n                pass.setUniform(handle, val as MaterialProperty);\n            } else {\n                pass.resetUniform(name);\n            }\n        } else if (Array.isArray(val)) {\n            for (let i = 0; i < val.length; i++) {\n                this._bindTexture(pass, handle, val[i], i);\n            }\n        } else if (val) {\n            this._bindTexture(pass, handle, val);\n        } else {\n            pass.resetTexture(name);\n        }\n        return true;\n    }\n\n    protected _bindTexture (pass: Pass, handle: number, val: MaterialPropertyFull, index?: number) {\n        const binding = Pass.getBindingFromHandle(handle);\n        if (val instanceof Texture) {\n            pass.bindTexture(binding, val, index);\n        } else if (val instanceof TextureBase) {\n            const texture: Texture | null = val.getGFXTexture();\n            if (!texture || !texture.width || !texture.height) {\n                // console.warn(`material '${this._uuid}' received incomplete texture asset '${val._uuid}'`);\n                return;\n            }\n            pass.bindTexture(binding, texture, index);\n            pass.bindSampler(binding, val.getGFXSampler(), index);\n        }\n    }\n\n    protected _doDestroy () {\n        if (this._passes && this._passes.length) {\n            for (const pass of this._passes) {\n                pass.destroy();\n            }\n        }\n        this._passes.length = 0;\n    }\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        this.initialize({\n            effectName: 'builtin-unlit',\n            defines: { USE_COLOR: true },\n            technique: 0,\n        });\n        this.setProperty('mainColor', new Color('#ff00ff'));\n    }\n\n    public validate () {\n        return !!this._effectAsset && !this._effectAsset.isDefault && this.passes.length > 0;\n    }\n}\n\nlegacyCC.Material = Material;\n","/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { DEV } from 'internal:constants';\r\n\r\nfunction deepFlatten (strList, array) {\r\n    for (const item of array) {\r\n        if (Array.isArray(item)) {\r\n            deepFlatten(strList, item);\r\n        }\r\n        // else if (item instanceof Declaration) {\r\n        //     strList.push(item.toString());\r\n        // }\r\n        else {\r\n            strList.push(item);\r\n        }\r\n    }\r\n}\r\n\r\nexport function flattenCodeArray (array) {\r\n    const separator = DEV ? '\\n' : '';\r\n    const strList = [];\r\n    deepFlatten(strList, array);\r\n    return strList.join(separator);\r\n}\r\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { deprecateModuleExportedName } from './x-deprecated';\n\ndeprecateModuleExportedName({\n    replaceProperty: {\n        since: '3.6.0',\n        removed: false,\n    },\n    removeProperty: {\n        since: '3.6.0',\n        removed: false,\n    },\n    markAsWarning: {\n        since: '3.6.0',\n        removed: false,\n    },\n    setDefaultLogTimes: {\n        since: '3.6.0',\n        removed: false,\n    },\n});\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n// Some helper methods for compile instantiation code\n\nimport { TEST } from 'internal:constants';\nimport * as js from '../utils/js';\nimport { CCClass, isCCClassOrFastDefined } from './class';\nimport { CCObject, isCCObject } from './object';\nimport * as Attr from './utils/attribute';\nimport { flattenCodeArray } from './utils/compiler';\nimport { legacyCC } from '../global-exports';\n\nconst Destroyed = CCObject.Flags.Destroyed;\nconst PersistentMask = CCObject.Flags.PersistentMask;\nconst DEFAULT = `${Attr.DELIMETER}default`;\nconst IDENTIFIER_RE = CCClass.IDENTIFIER_RE;\n\nconst VAR = 'var ';\nconst LOCAL_OBJ = 'o';\nconst LOCAL_TEMP_OBJ = 't';\nconst LOCAL_ARRAY = 'a';\nconst LINE_INDEX_OF_NEW_OBJ = 0;\n\nconst DEFAULT_MODULE_CACHE = {\n    'cc.ClickEvent': false,\n    'cc.PrefabInfo': false,\n};\n\nconst escapeForJS = CCClass.escapeForJS;\n\n// HELPER CLASSES\n\n// ('foo', 'bar')\n// -> 'var foo = bar;'\nclass Declaration {\n    public varName: any;\n    public expression: any;\n\n    constructor (varName, expression) {\n        this.varName = varName;\n        this.expression = expression;\n    }\n\n    public toString () {\n        return `${VAR + this.varName}=${this.expression};`;\n    }\n}\n\n// ('a =', 'var b = x')\n// -> 'var b = a = x';\n// ('a =', 'x')\n// -> 'a = x';\nfunction mergeDeclaration (statement, expression) {\n    if (expression instanceof Declaration) {\n        return new Declaration(expression.varName, statement + expression.expression);\n    } else {\n        return statement + expression;\n    }\n}\n\n// ('a', ['var b = x', 'b.foo = bar'])\n// -> 'var b = a = x;'\n// -> 'b.foo = bar;'\n// ('a', 'var b = x')\n// -> 'var b = a = x;'\n// ('a', 'x')\n// -> 'a = x;'\nfunction writeAssignment (codeArray, statement, expression) {\n    if (Array.isArray(expression)) {\n        expression[0] = mergeDeclaration(statement, expression[0]);\n        codeArray.push(expression);\n    } else {\n        codeArray.push(`${mergeDeclaration(statement, expression)};`);\n    }\n}\n\n// ('foo', 'bar')\n// -> 'targetExpression.foo = bar'\n// ('foo1', 'bar1')\n// ('foo2', 'bar2')\n// -> 't = targetExpression;'\n// -> 't.foo1 = bar1;'\n// -> 't.foo2 = bar2;'\nclass Assignments {\n    public static pool: js.Pool<{}>;\n\n    private _exps: any[];\n    private _targetExp: any;\n\n    constructor (targetExpression?) {\n        this._exps = [];\n        this._targetExp = targetExpression;\n    }\n    public append (key, expression) {\n        this._exps.push([key, expression]);\n    }\n    public writeCode (codeArray) {\n        let targetVar;\n        if (this._exps.length > 1) {\n            codeArray.push(`${LOCAL_TEMP_OBJ}=${this._targetExp};`);\n            targetVar = LOCAL_TEMP_OBJ;\n        } else if (this._exps.length === 1) {\n            targetVar = this._targetExp;\n        } else {\n            return;\n        }\n\n        for (let i = 0; i < this._exps.length; i++) {\n            const pair = this._exps[i];\n            writeAssignment(codeArray, `${targetVar + getPropAccessor(pair[0])}=`, pair[1]);\n        }\n    }\n}\n\nAssignments.pool = new js.Pool((obj: any) => {\n    obj._exps.length = 0;\n    obj._targetExp = null;\n}, 1);\n// @ts-expect-error\nAssignments.pool.get = function (targetExpression) {\n    const cache: any = this._get() || new Assignments();\n    cache._targetExp = targetExpression;\n    return cache;\n};\n\n// HELPER FUNCTIONS\n\nfunction getPropAccessor (key) {\n    return IDENTIFIER_RE.test(key) ? (`.${key}`) : (`[${escapeForJS(key)}]`);\n}\n\n//\n\n/*\n * Variables:\n * {Object[]} O - objs list\n * {Function[]} F - constructor list\n * {Node} [R] - specify an instantiated prefabRoot that all references to prefabRoot in prefab will redirect to\n * {Object} o - current creating object\n */\nclass Parser {\n    public parent: any;\n    public objsToClear_iN$t: any[];\n    public codeArray: any[];\n    public objs: any[];\n    public funcs: any[];\n    public funcModuleCache: any;\n    public globalVariables: any[];\n    public globalVariableId: number;\n    public localVariableId: number;\n    public result: any;\n    /*\n    * @method constructor\n    * @param {Object} obj - the object to parse\n    * @param {Node} [parent]\n    */\n    constructor (obj, parent) {\n        this.parent = parent;\n\n        this.objsToClear_iN$t = [];   // used to reset _iN$t variable\n        this.codeArray = [];\n\n        // datas for generated code\n        this.objs = [];\n        this.funcs = [];\n\n        this.funcModuleCache = js.createMap();\n        js.mixin(this.funcModuleCache, DEFAULT_MODULE_CACHE);\n\n        // {String[]} - variable names for circular references,\n        //              not really global, just local variables shared between sub functions\n        this.globalVariables = [];\n        // incremental id for new global variables\n        this.globalVariableId = 0;\n        // incremental id for new local variables\n        this.localVariableId = 0;\n\n        // generate codeArray\n        // if (Array.isArray(obj)) {\n        //    this.codeArray.push(this.instantiateArray(obj));\n        // }\n        // else {\n        this.codeArray.push(`${VAR + LOCAL_OBJ},${LOCAL_TEMP_OBJ};`,\n            'if(R){',\n            `${LOCAL_OBJ}=R;`,\n            '}else{',\n            `${LOCAL_OBJ}=R=new ${this.getFuncModule(obj.constructor, true)}();`,\n            '}');\n        obj._iN$t = { globalVar: 'R' };\n        this.objsToClear_iN$t.push(obj);\n        this.enumerateObject(this.codeArray, obj);\n        // }\n\n        // generate code\n        let globalVariablesDeclaration;\n        if (this.globalVariables.length > 0) {\n            globalVariablesDeclaration = `${VAR + this.globalVariables.join(',')};`;\n        }\n        const code = flattenCodeArray(['return (function(R){',\n            globalVariablesDeclaration || [],\n            this.codeArray,\n            'return o;',\n            '})']);\n\n        // generate method and bind with objs\n        this.result = Function('O', 'F', code)(this.objs, this.funcs);\n\n        // if (TEST && !isPhantomJS) {\n        //     console.log(code);\n        // }\n\n        // cleanup\n        for (let i = 0, len = this.objsToClear_iN$t.length; i < len; ++i) {\n            this.objsToClear_iN$t[i]._iN$t = null;\n        }\n        this.objsToClear_iN$t.length = 0;\n    }\n\n    public getFuncModule (func, usedInNew?) {\n        const clsName = js.getClassName(func);\n        if (clsName) {\n            const cache = this.funcModuleCache[clsName];\n            if (cache) {\n                return cache;\n            } else if (cache === undefined) {\n                let clsNameIsModule = clsName.indexOf('.') !== -1;\n                if (clsNameIsModule) {\n                    try {\n                        // ensure is module\n                        clsNameIsModule = (func === Function(`return ${clsName}`)());\n                        if (clsNameIsModule) {\n                            this.funcModuleCache[clsName] = clsName;\n                            return clsName;\n                        }\n                    } catch (e) {}\n                }\n            }\n        }\n        let index = this.funcs.indexOf(func);\n        if (index < 0) {\n            index = this.funcs.length;\n            this.funcs.push(func);\n        }\n        let res = `F[${index}]`;\n        if (usedInNew) {\n            res = `(${res})`;\n        }\n        this.funcModuleCache[clsName] = res;\n        return res;\n    }\n\n    public getObjRef (obj) {\n        let index = this.objs.indexOf(obj);\n        if (index < 0) {\n            index = this.objs.length;\n            this.objs.push(obj);\n        }\n        return `O[${index}]`;\n    }\n\n    public setValueType (codeArray, defaultValue, srcValue, targetExpression) {\n        // @ts-expect-error\n        const assignments: any = Assignments.pool.get(targetExpression);\n        let fastDefinedProps = defaultValue.constructor.__props__;\n        if (!fastDefinedProps) {\n            fastDefinedProps = Object.keys(defaultValue);\n        }\n        for (let i = 0; i < fastDefinedProps.length; i++) {\n            const propName = fastDefinedProps[i];\n            const prop = srcValue[propName];\n            if (defaultValue[propName] === prop) {\n                continue;\n            }\n            const expression = this.enumerateField(srcValue, propName, prop);\n            assignments.append(propName, expression);\n        }\n        assignments.writeCode(codeArray);\n        Assignments.pool.put(assignments);\n    }\n\n    public enumerateCCClass (codeArray, obj, klass) {\n        const props = klass.__values__;\n        const attrs = Attr.getClassAttrs(klass);\n        for (let p = 0; p < props.length; p++) {\n            const key = props[p];\n            const val = obj[key];\n            let defaultValue = attrs[key + DEFAULT];\n            if (equalsToDefault(defaultValue, val)) {\n                continue;\n            }\n            if (typeof val === 'object' && val instanceof legacyCC.ValueType) {\n                defaultValue = CCClass.getDefault(defaultValue);\n                if (defaultValue && defaultValue.constructor === val.constructor) {\n                    // fast case\n                    const targetExpression = LOCAL_OBJ + getPropAccessor(key);\n                    this.setValueType(codeArray, defaultValue, val, targetExpression);\n                    continue;\n                }\n            }\n            this.setObjProp(codeArray, obj, key, val);\n        }\n    }\n\n    public instantiateArray (value) {\n        if (value.length === 0) {\n            return '[]';\n        }\n\n        const arrayVar = LOCAL_ARRAY + (++this.localVariableId);\n        const declaration = new Declaration(arrayVar, `new Array(${value.length})`);\n        const codeArray = [declaration];\n\n        // assign a _iN$t flag to indicate that this object has been parsed.\n        value._iN$t = {\n            globalVar: '',      // the name of declared global variable used to access this object\n            source: codeArray,  // the source code array for this object\n        };\n        this.objsToClear_iN$t.push(value);\n\n        for (let i = 0; i < value.length; ++i) {\n            const statement = `${arrayVar}[${i}]=`;\n            const expression = this.enumerateField(value, i, value[i]);\n            writeAssignment(codeArray, statement, expression);\n        }\n        return codeArray;\n    }\n\n    public instantiateTypedArray (value) {\n        const type = value.constructor.name;\n        if (value.length === 0) {\n            return `new ${type}`;\n        }\n\n        const arrayVar = LOCAL_ARRAY + (++this.localVariableId);\n        const declaration = new Declaration(arrayVar, `new ${type}(${value.length})`);\n        const codeArray = [declaration];\n\n        // assign a _iN$t flag to indicate that this object has been parsed.\n        value._iN$t = {\n            globalVar: '',      // the name of declared global variable used to access this object\n            source: codeArray,  // the source code array for this object\n        };\n        this.objsToClear_iN$t.push(value);\n\n        for (let i = 0; i < value.length; ++i) {\n            if (value[i] !== 0) {\n                const statement = `${arrayVar}[${i}]=`;\n                writeAssignment(codeArray, statement, value[i]);\n            }\n        }\n        return codeArray;\n    }\n\n    public enumerateField (obj, key, value) {\n        if (typeof value === 'object' && value) {\n            const _iN$t = value._iN$t;\n            if (_iN$t) {\n                // parsed\n                let globalVar = _iN$t.globalVar;\n                if (!globalVar) {\n                    // declare a global var\n                    globalVar = _iN$t.globalVar = `v${++this.globalVariableId}`;\n                    this.globalVariables.push(globalVar);\n                    // insert assignment statement to assign to global var\n                    const line = _iN$t.source[LINE_INDEX_OF_NEW_OBJ];\n                    _iN$t.source[LINE_INDEX_OF_NEW_OBJ] = mergeDeclaration(`${globalVar}=`, line);\n                    // if (typeof line ==='string' && line.startsWith(VAR)) {\n                    //     // var o=xxx -> var o=global=xxx\n                    //     var LEN_OF_VAR_O = 5;\n                    //     _iN$t.source[LINE_INDEX_OF_NEW_OBJ] = line.slice(0, LEN_OF_VAR_O) + '=' + globalVar + line.slice(LEN_OF_VAR_O);\n                    // }\n                }\n                return globalVar;\n            } else if (ArrayBuffer.isView(value)) {\n                return this.instantiateTypedArray(value);\n            } else if (Array.isArray(value)) {\n                return this.instantiateArray(value);\n            } else {\n                return this.instantiateObj(value);\n            }\n        } else if (typeof value === 'function') {\n            return this.getFuncModule(value);\n        } else if (typeof value === 'string') {\n            return escapeForJS(value);\n        } else {\n            if (key === '_objFlags' && isCCObject(obj)) {\n                value &= PersistentMask;\n            }\n            return value;\n        }\n    }\n\n    public setObjProp (codeArray, obj, key, value) {\n        const statement = `${LOCAL_OBJ + getPropAccessor(key)}=`;\n        const expression = this.enumerateField(obj, key, value);\n        writeAssignment(codeArray, statement, expression);\n    }\n\n    // codeArray - the source code array for this object\n    public enumerateObject (codeArray, obj) {\n        const klass = obj.constructor;\n        if (isCCClassOrFastDefined(klass)) {\n            this.enumerateCCClass(codeArray, obj, klass);\n        } else {\n            // primitive javascript object\n            for (const key in obj) {\n                if (!obj.hasOwnProperty(key)\n                    || (key.charCodeAt(0) === 95 && key.charCodeAt(1) === 95   // starts with \"__\"\n                    && key !== '__type__')\n                ) {\n                    continue;\n                }\n                const value = obj[key];\n                if (typeof value === 'object' && value && value === obj._iN$t) {\n                    continue;\n                }\n                this.setObjProp(codeArray, obj, key, value);\n            }\n        }\n    }\n\n    public instantiateObj (obj) {\n        if (obj instanceof legacyCC.ValueType) {\n            return CCClass.getNewValueTypeCode(obj);\n        }\n        if (obj instanceof legacyCC.Asset) {\n            // register to asset list and just return the reference.\n            return this.getObjRef(obj);\n        }\n        if (obj._objFlags & Destroyed) {\n            // the same as cc.isValid(obj)\n            return null;\n        }\n\n        let createCode;\n        const ctor = obj.constructor;\n        if (isCCClassOrFastDefined(ctor)) {\n            if (this.parent) {\n                if (this.parent instanceof legacyCC.Component) {\n                    if (obj instanceof legacyCC._BaseNode || obj instanceof legacyCC.Component) {\n                        return this.getObjRef(obj);\n                    }\n                } else if (this.parent instanceof legacyCC._BaseNode) {\n                    if (obj instanceof legacyCC._BaseNode) {\n                        if (!obj.isChildOf(this.parent)) {\n                            // should not clone other nodes if not descendant\n                            return this.getObjRef(obj);\n                        }\n                    } else if (obj instanceof legacyCC.Component) {\n                        if (!obj.node?.isChildOf(this.parent)) {\n                            // should not clone other component if not descendant\n                            return this.getObjRef(obj);\n                        }\n                    }\n                }\n            }\n            createCode = new Declaration(LOCAL_OBJ, `new ${this.getFuncModule(ctor, true)}()`);\n        } else if (ctor === Object) {\n            createCode = new Declaration(LOCAL_OBJ, '{}');\n        } else if (!ctor) {\n            createCode = new Declaration(LOCAL_OBJ, 'Object.create(null)');\n        } else {\n            // do not clone unknown type\n            return this.getObjRef(obj);\n        }\n\n        const codeArray = [createCode];\n\n        // assign a _iN$t flag to indicate that this object has been parsed.\n        obj._iN$t = {\n            globalVar: '',      // the name of declared global variable used to access this object\n            source: codeArray,  // the source code array for this object\n            // propName: '',     // the propName this object defined in its source code,\n            //                  // if defined, use LOCAL_OBJ.propName to access the obj, else just use o\n        };\n        this.objsToClear_iN$t.push(obj);\n\n        this.enumerateObject(codeArray, obj);\n        return ['(function(){',\n            codeArray,\n            'return o;})();'];\n    }\n}\n\nexport function equalsToDefault (def: any, value: any) {\n    if (typeof def === 'function') {\n        try {\n            def = def();\n        } catch (e) {\n            return false;\n        }\n    }\n    if (def === value) {\n        return true;\n    }\n    if (def && value\n        && typeof def === 'object' && typeof value === 'object'\n        && def.constructor === value.constructor\n    ) {\n        if (def instanceof legacyCC.ValueType) {\n            if (def.equals(value)) {\n                return true;\n            }\n        } else if (Array.isArray(def)) {\n            return def.length === 0 && value.length === 0;\n        } else if (def.constructor === Object) {\n            return js.isEmptyObject(def) && js.isEmptyObject(value);\n        }\n    }\n    return false;\n}\n\nexport function compile (node) {\n    const root = (node instanceof legacyCC._BaseNode) && node;\n    const parser = new Parser(node, root);\n    return parser.result;\n}\n\nif (TEST) {\n    legacyCC._Test.IntantiateJit = {\n        equalsToDefault,\n        compile,\n    };\n}\n","/*\n Copyright (c) 2019-2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/**\n * @en All event types which [[Node]] could emit\n * @zh 所有 [[Node]] 可能派发的事件类型\n */\nexport enum NodeEventType {\n    /**\n     * @en\n     * The event type for touch start event\n     *\n     * @zh\n     * 手指开始触摸事件。\n     */\n    TOUCH_START = 'touch-start',\n\n    /**\n     * @en\n     * The event type for touch move event\n     *\n     * @zh\n     * 当手指在屏幕上移动时。\n     */\n    TOUCH_MOVE = 'touch-move',\n\n    /**\n     * @en\n     * The event type for touch end event\n     *\n     * @zh\n     * 手指结束触摸事件。\n     */\n    TOUCH_END = 'touch-end',\n\n    /**\n     * @en\n     * The event type for touch end event\n     *\n     * @zh\n     * 当手指在目标节点区域外离开屏幕时。\n     */\n    TOUCH_CANCEL = 'touch-cancel',\n\n    /**\n     * @en\n     * The event type for mouse down events\n     *\n     * @zh\n     * 当鼠标按下时触发一次。\n     */\n    MOUSE_DOWN = 'mouse-down',\n\n    /**\n     * @en\n     * The event type for mouse move events\n     *\n     * @zh\n     * 当鼠标在目标节点在目标节点区域中移动时，不论是否按下。\n     */\n    MOUSE_MOVE = 'mouse-move',\n\n    /**\n     * @en\n     * The event type for mouse up events\n     *\n     * @zh\n     * 当鼠标从按下状态松开时触发一次。\n     */\n    MOUSE_UP = 'mouse-up',\n\n    /**\n     * @en\n     * The event type for mouse wheel events\n     *\n     * @zh 手指开始触摸事件\n     */\n    MOUSE_WHEEL = 'mouse-wheel',\n\n    /**\n     * @en\n     * The event type for mouse leave target events\n     *\n     * @zh\n     * 当鼠标移入目标节点区域时，不论是否按下.\n     */\n    MOUSE_ENTER = 'mouse-enter',\n\n    /**\n     * @en\n     * The event type for mouse leave target events\n     *\n     * @zh\n     * 当鼠标移出目标节点区域时，不论是否按下。\n     */\n    MOUSE_LEAVE = 'mouse-leave',\n\n    /**\n     * @en The event type for press the key down event, the event will be continuously dispatched in the key pressed state\n     * @zh 当按下按键时触发的事件, 该事件在按下状态会持续派发\n     * @deprecated since v3.3, please use SystemEvent.EventType.KEY_DOWN instead\n     */\n    KEY_DOWN = 'keydown',\n\n    /**\n     * @en The event type for press the key up event\n     * @zh 当松开按键时触发的事件\n     * @deprecated since v3.3, please use SystemEvent.EventType.KEY_UP instead\n     */\n    KEY_UP = 'keyup',\n\n    /**\n     * @en\n     * The event type for press the devicemotion event\n     *\n     * @zh\n     * 重力感应\n     *\n     * @deprecated since v3.3, please use SystemEvent.EventType.DEVICEMOTION instead\n     */\n    DEVICEMOTION = 'devicemotion',\n\n    /**\n     * @en\n     * The event type for position, rotation, scale changed.Use the type parameter as `Node.TransformBit` to check which part is changed\n     *\n     * @zh\n     * 节点改变位置、旋转或缩放事件。如果具体需要判断是哪一个事件，可通过判断回调的第一个参数类型是 `Node.TransformBit` 中的哪一个来获取\n     * @example\n     * ```\n     * this.node.on(Node.EventType.TRANSFORM_CHANGED, (type)=>{\n     *  if (type & Node.TransformBit.POSITION) {\n     *       //...\n     *   }\n     * }, this);\n     * ```\n     */\n    TRANSFORM_CHANGED = 'transform-changed',\n\n    /**\n     * @en The event type for notifying the host scene has been changed for a persist node.\n     * @zh 当场景常驻节点的场景发生改变时触发的事件，一般在切换场景过程中触发。\n     */\n    SCENE_CHANGED_FOR_PERSISTS = 'scene-changed-for-persists',\n\n    /**\n     * @en\n     * The event type for size change events.\n     * Performance note, this event will be triggered every time corresponding properties being changed,\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\n     *\n     * @zh\n     * 当节点尺寸改变时触发的事件。\n     * 性能警告：这个事件会在每次对应的属性被修改时触发，如果事件回调损耗较高，有可能对性能有很大的负面影响，请尽量避免这种情况。\n     */\n    SIZE_CHANGED = 'size-changed',\n\n    /**\n     * @en\n     * The event type for anchor point change events.\n     * Performance note, this event will be triggered every time corresponding properties being changed,\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\n     *\n     * @zh\n     * 当节点的 UITransform 锚点改变时触发的事件。\n     * 性能警告：这个事件会在每次对应的属性被修改时触发，如果事件回调损耗较高，有可能对性能有很大的负面影响，请尽量避免这种情况。\n     */\n    ANCHOR_CHANGED = 'anchor-changed',\n\n    /**\n     * @en\n     * The event type for color change events.\n     * Performance note, this event will be triggered every time corresponding properties being changed,\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\n     *\n     * @zh\n     * 当节点的 UI 渲染组件颜色属性改变时触发的事件。\n     * 性能警告：这个事件会在每次对应的属性被修改时触发，如果事件回调损耗较高，有可能对性能有很大的负面影响，请尽量避免这种情况。\n     */\n    COLOR_CHANGED = 'color-changed',\n\n    /**\n     * @en\n     * The event type for adding a new child node to the target node.\n     *\n     * @zh\n     * 给目标节点添加子节点时触发的事件。\n     */\n    CHILD_ADDED = 'child-added',\n\n    /**\n     * @en\n     * The event type for removing a child node from the target node.\n     *\n     * @zh\n     * 给目标节点移除子节点时触发的事件。\n     */\n    CHILD_REMOVED = 'child-removed',\n\n    /**\n     * @en The event type for changing the parent of the target node\n     * @zh 目标节点的父节点改变时触发的事件。\n     */\n    PARENT_CHANGED = 'parent-changed',\n\n    /**\n     * @en The event type for destroying the target node\n     * @zh 目标节点被销毁时触发的事件。\n     */\n    NODE_DESTROYED = 'node-destroyed',\n\n    /**\n     * @en The event type for node layer change events.\n     * @zh 节点 layer 改变时触发的事件。\n     */\n    LAYER_CHANGED = 'layer-changed',\n\n    /**\n     * @en The event type for node's sibling order changed.\n     * @zh 当节点在兄弟节点中的顺序发生变化时触发的事件。\n     */\n    SIBLING_ORDER_CHANGED = 'sibling-order-changed',\n\n    /**\n     * @en\n     * Note: This event is only emitted from the top most node whose active value did changed,\n     * not including its child nodes.\n     * @zh\n     * 注意：此节点激活时，此事件仅从最顶部的节点发出。\n     */\n    ACTIVE_IN_HIERARCHY_CHANGED = 'active-in-hierarchy-changed',\n\n    /**\n     * @en\n     * The event occur when node add a new component.\n     * @zh\n     * 当节点上增加组件时触发的事件\n     */\n    COMPONENT_ADDED = 'component-added',\n\n    /**\n     * @en\n     * The event occur when node remove a component.\n     * @zh\n     * 当节点上移除组件时触发的事件\n     */\n    COMPONENT_REMOVED = 'component-removed',\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { UIRenderer } from '../../2d/framework/ui-renderer';\nimport { UITransform } from '../../2d/framework/ui-transform';\nimport { warnID } from '../platform/debug';\nimport { UIMeshRenderer } from '../../2d';\n\n/**\n * @en Node's UI properties abstraction\n * @zh 节点上 UI 相关的属性抽象类\n */\nexport class NodeUIProperties {\n    /**\n     * @en The UI transform component\n     * @zh UI 变换组件\n     */\n    get uiTransformComp () {\n        if (!this._uiTransformComp) {\n            this._uiTransformComp = this._node.getComponent('cc.UITransform') as UITransform;\n        }\n\n        return this._uiTransformComp;\n    }\n    set uiTransformComp (value: UITransform | null) {\n        this._uiTransformComp = value;\n    }\n\n    /**\n     * @en The base UI component\n     * @zh UI 基类组件\n     */\n    get uiComp () {\n        return this._uiComp;\n    }\n    set uiComp (comp: UIMeshRenderer | UIRenderer | null) {\n        if (this._uiComp && comp) {\n            warnID(12002);\n            return;\n        }\n        this._uiComp = comp;\n    }\n\n    private _uiComp: UIMeshRenderer | UIRenderer | null = null;\n\n    /**\n     * @en The opacity of the UI node for final rendering\n     * @zh 最终显示的 UI 透明度，受父节点透明度影响\n     */\n    private _opacity = 1;\n    public get opacity () { return this._opacity; }\n\n    /**\n     * @en The opacity of the UI node itself\n     * @zh 本节点的 UI 透明度\n     */\n    private _localOpacity = 1;\n    get localOpacity () { return this._localOpacity; }\n    set localOpacity (val) {\n        this._localOpacity = val;\n        this.colorDirty = true;\n    }\n\n    public colorDirty = true;\n    protected _uiTransformComp: UITransform | null = null;\n    private _node: any;\n\n    constructor (node: any) {\n        this._node = node;\n    }\n\n    /**\n     * @deprecated since v3.4\n     */\n    public applyOpacity (effectOpacity) {\n        this._opacity = this._localOpacity * effectOpacity;\n    }\n\n    /**\n     * @en Make the opacity state of node tree is dirty, not effect anymore\n     * @zh 为结点树的透明度状态设置脏标签，不再有效果\n     * @deprecated since v3.4\n     */\n    public static markOpacityTree (node, isDirty = true) {}\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, DEV, TEST } from 'internal:constants';\nimport { CCObject } from '../data/object';\nimport * as js from '../utils/js';\nimport { legacyCC } from '../global-exports';\nimport { error, errorID, getError } from '../platform/debug';\nimport { Component } from '../components';\n\nconst Destroying = CCObject.Flags.Destroying;\n\nexport function baseNodePolyfill (BaseNode) {\n    if (EDITOR || TEST) {\n        BaseNode.prototype._checkMultipleComp = function (ctor) {\n            const existing = this.getComponent(ctor._disallowMultiple);\n            if (existing) {\n                if (existing.constructor === ctor) {\n                    throw Error(getError(3805, js.getClassName(ctor), this._name));\n                } else {\n                    throw Error(getError(3806, js.getClassName(ctor), this._name, js.getClassName(existing)));\n                }\n            }\n            return true;\n        };\n\n        /**\n         * This api should only used by undo system\n         * @method _addComponentAt\n         * @param {Component} comp\n         * @param {Number} index\n         */\n        BaseNode.prototype._addComponentAt = function (comp, index) {\n            if (this._objFlags & Destroying) {\n                return error('isDestroying');\n            }\n            if (!(comp instanceof legacyCC.Component)) {\n                return errorID(3811);\n            }\n            if (index > this._components.length) {\n                return errorID(3812);\n            }\n\n            // recheck attributes because script may changed\n            const ctor = comp.constructor;\n            if (ctor._disallowMultiple) {\n                if (!this._checkMultipleComp(ctor)) {\n                    return undefined;\n                }\n            }\n\n            // remove dependency and return directly by editor\n            // const ReqComp = ctor._requireComponent;\n            // if (ReqComp && !this.getComponent(ReqComp)) {\n            //     if (index === this._components.length) {\n            //         // If comp should be last component, increase the index because required component added\n            //         ++index;\n            //     }\n            //     const depended = this.addComponent(ReqComp);\n            //     if (!depended) {\n            //         // depend conflicts\n            //         return null;\n            //     }\n            // }\n\n            comp.node = this;\n            this._components.splice(index, 0, comp);\n            if (EDITOR && EditorExtends.Node && EditorExtends.Component) {\n                const node = EditorExtends.Node.getNode(this._id);\n                if (node) {\n                    EditorExtends.Component.add(comp._id, comp);\n                }\n            }\n            if (this._activeInHierarchy) {\n                legacyCC.director._nodeActivator.activateComp(comp);\n            }\n            return undefined;\n        };\n\n        /**\n         * @method _getDependComponent\n         * @param {Component} depended\n         * @return {Component[]}\n         */\n        BaseNode.prototype._getDependComponent = function (depended) {\n            const dependant: Component[] = [];\n            for (let i = 0; i < this._components.length; i++) {\n                const comp = this._components[i];\n                if (comp !== depended && comp.isValid && !legacyCC.Object._willDestroy(comp)) {\n                    const reqComps = comp.constructor._requireComponent;\n                    if (reqComps) {\n                        if (Array.isArray(reqComps)) {\n                            for (let i = 0; i < reqComps.length; i++) {\n                                if (depended instanceof reqComps[i]) {\n                                    dependant.push(comp);\n                                }\n                            }\n                        } else if (depended instanceof reqComps) {\n                            dependant.push(comp);\n                        }\n                    }\n                }\n            }\n            return dependant;\n        };\n\n        BaseNode.prototype.onRestore = function () {\n            // check activity state\n            const shouldActiveNow = this._active && !!(this._parent && this._parent._activeInHierarchy);\n            if (this._activeInHierarchy !== shouldActiveNow) {\n                legacyCC.director._nodeActivator.activateNode(this, shouldActiveNow);\n            }\n        };\n\n        BaseNode.prototype._onPreDestroy = function () {\n            const destroyByParent: boolean = this._onPreDestroyBase();\n            if (!destroyByParent) {\n                // ensure this node can reattach to scene by undo system\n                // (simulate some destruct logic to make undo system work correctly)\n                this._parent = null;\n            }\n            return destroyByParent;\n        };\n\n        BaseNode.prototype._onRestoreBase = BaseNode.prototype.onRestore;\n    }\n\n    if (EDITOR || TEST) {\n        BaseNode.prototype._registerIfAttached = function (register) {\n            if (!this._id) {\n                console.warn(`Node(${this && this.name}}) is invalid or its data is corrupted.`);\n                return;\n            }\n            if (EditorExtends.Node && EditorExtends.Component) {\n                if (register) {\n                    EditorExtends.Node.add(this._id, this);\n\n                    for (let i = 0; i < this._components.length; i++) {\n                        const comp = this._components[i];\n                        if (!comp || !comp._id) {\n                            console.warn(`Component attached to node:${this.name} is corrupted`);\n                        } else {\n                            EditorExtends.Component.add(comp._id, comp);\n                        }\n                    }\n                } else {\n                    for (let i = 0; i < this._components.length; i++) {\n                        const comp = this._components[i];\n                        if (!comp || !comp._id) {\n                            console.warn(`Component attached to node:${this.name} is corrupted`);\n                        } else {\n                            EditorExtends.Component.remove(comp._id);\n                        }\n                    }\n\n                    EditorExtends.Node.remove(this._id);\n                }\n            }\n\n            const children = this._children;\n            for (let i = 0, len = children.length; i < len; ++i) {\n                const child = children[i];\n                child._registerIfAttached!(register);\n            }\n        };\n    }\n\n    if (DEV) {\n        // promote debug info\n        js.get(BaseNode.prototype, ' INFO ', function () {\n            let path = '';\n            // @ts-expect-error\n            let node = this;\n            while (node && !(node instanceof legacyCC.Scene)) {\n                if (path) {\n                    path = `${node.name}/${path}`;\n                } else {\n                    path = node.name;\n                }\n                node = node._parent;\n            }\n            // @ts-expect-error\n            return `${this.name}, path: ${path}`;\n        });\n    }\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, editable, serializable } from 'cc.decorator';\nimport { DEV, DEBUG, EDITOR } from 'internal:constants';\nimport { Component } from '../components/component';\nimport { property } from '../data/decorators/property';\nimport { CCObject } from '../data/object';\nimport { Event } from '../../input/types';\nimport { errorID, warnID, error, warn, log, getError } from '../platform/debug';\nimport { ISchedulable } from '../scheduler';\nimport IdGenerator from '../utils/id-generator';\nimport * as js from '../utils/js';\nimport { baseNodePolyfill } from './base-node-dev';\nimport { legacyCC } from '../global-exports';\nimport { Node } from './node';\nimport type { Scene } from './scene';\nimport { PrefabInfo } from '../utils/prefab/prefab-info';\nimport { NodeEventType } from './node-event';\n\nconst Destroying = CCObject.Flags.Destroying;\nconst DontDestroy = CCObject.Flags.DontDestroy;\nconst Deactivating = CCObject.Flags.Deactivating;\n\nexport const TRANSFORM_ON = 1 << 0;\n// const CHILD_ADDED = 'child-added';\n// const CHILD_REMOVED = 'child-removed';\n\nconst idGenerator = new IdGenerator('Node');\n\nfunction getConstructor<T> (typeOrClassName: string | Constructor<T> | AbstractedConstructor<T>): Constructor<T> | AbstractedConstructor<T> | null | undefined {\n    if (!typeOrClassName) {\n        errorID(3804);\n        return null;\n    }\n    if (typeof typeOrClassName === 'string') {\n        return js.getClassByName(typeOrClassName) as Constructor<T> | undefined;\n    }\n\n    return typeOrClassName;\n}\n\n/**\n * @en The base class for [[Node]], it:\n * - maintains scene hierarchy and life cycle logic\n * - provides EventTarget ability\n * - emits events if some properties changed, ref: [[Node.EventType]]\n * - manages components\n * @zh [[Node]] 的基类，他会负责：\n * - 维护场景树以及节点生命周期管理\n * - 提供 EventTarget 的事件管理和注册能力\n * - 派发节点状态相关的事件，参考：[[Node.EventType]]\n * - 管理组件\n */\n@ccclass('cc.BaseNode')\nexport class BaseNode extends CCObject implements ISchedulable {\n    /**\n     * @en Gets all components attached to this node.\n     * @zh 获取附加到此节点的所有组件。\n     */\n    get components (): ReadonlyArray<Component> {\n        return this._components;\n    }\n\n    /**\n     * @en If true, the node is an persist node which won't be destroyed during scene transition.\n     * If false, the node will be destroyed automatically when loading a new scene. Default is false.\n     * @zh 如果为true，则该节点是一个常驻节点，不会在场景转换期间被销毁。\n     * 如果为false，节点将在加载新场景时自动销毁。默认为 false。\n     * @default false\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @property\n    get _persistNode (): boolean {\n        return (this._objFlags & DontDestroy) > 0;\n    }\n    set _persistNode (value) {\n        if (value) {\n            this._objFlags |= DontDestroy;\n        } else {\n            this._objFlags &= ~DontDestroy;\n        }\n    }\n\n    // API\n\n    /**\n     * @en Name of node.\n     * @zh 该节点名称。\n     */\n    @editable\n    get name (): string {\n        return this._name;\n    }\n    set name (value) {\n        if (DEV && value.indexOf('/') !== -1) {\n            errorID(1632);\n            return;\n        }\n        this._name = value;\n    }\n\n    /**\n     * @en The uuid for editor, will be stripped after building project.\n     * @zh 主要用于编辑器的 uuid，在编辑器下可用于持久化存储，在项目构建之后将变成自增的 id。\n     * @readOnly\n     */\n    get uuid () {\n        return this._id;\n    }\n\n    /**\n     * @en All children nodes.\n     * @zh 节点的所有子节点。\n     * @readOnly\n     */\n    @editable\n    get children (): ReadonlyArray<Node> {\n        // @ts-expect-error force cast\n        return this._children as ReadonlyArray<Node>;\n    }\n\n    /**\n     * @en\n     * The local active state of this node.\n     * Note that a Node may be inactive because a parent is not active, even if this returns true.\n     * Use [[activeInHierarchy]]\n     * if you want to check if the Node is actually treated as active in the scene.\n     * @zh\n     * 当前节点的自身激活状态。\n     * 值得注意的是，一个节点的父节点如果不被激活，那么即使它自身设为激活，它仍然无法激活。\n     * 如果你想检查节点在场景中实际的激活状态可以使用 [[activeInHierarchy]]\n     * @default true\n     */\n    @editable\n    get active () {\n        return this._active;\n    }\n    set active (isActive: boolean) {\n        isActive = !!isActive;\n\n        if (this._active !== isActive) {\n            this._active = isActive;\n            const parent = this._parent;\n            if (parent) {\n                const couldActiveInScene = parent._activeInHierarchy;\n                if (couldActiveInScene) {\n                    legacyCC.director._nodeActivator.activateNode(this, isActive);\n                }\n            }\n        }\n    }\n\n    /**\n     * @en Indicates whether this node is active in the scene.\n     * @zh 表示此节点是否在场景中激活。\n     */\n    @editable\n    get activeInHierarchy () {\n        return this._activeInHierarchy;\n    }\n\n    /**\n     * @en The parent node\n     * @zh 父节点\n     */\n    @editable\n    get parent () {\n        return this._parent;\n    }\n    set parent (value) {\n        this.setParent(value);\n    }\n\n    /**\n     * @en Which scene this node belongs to.\n     * @zh 此节点属于哪个场景。\n     * @readonly\n     */\n    get scene () {\n        return this._scene;\n    }\n\n    /**\n     * @en The event processor of the current node, it provides EventTarget ability.\n     * @zh 当前节点的事件处理器，提供 EventTarget 能力。\n     * @readonly\n     *\n     * @deprecated since v3.4.0\n     */\n    get eventProcessor () {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return this._eventProcessor;\n    }\n\n    /**\n     * @internal\n     */\n    protected static idGenerator = idGenerator;\n\n    /**\n     * for walk\n     * @internal\n     */\n    protected static _stacks: Array<Array<(BaseNode | null)>> = [[]];\n    /**\n     * @internal\n     */\n    protected static _stackId = 0;\n\n    /**\n     * Call `_updateScene` of specified node.\n     * @internal\n     * @param node The node.\n     */\n    protected static _setScene (node: BaseNode) {\n        node._updateScene();\n    }\n\n    protected static _findComponent<T extends Component> (node: BaseNode, constructor: Constructor<T> | AbstractedConstructor<T>): T | null {\n        const cls = constructor;\n        const comps = node._components;\n        // @ts-expect-error internal rtti property\n        if (cls._sealed) {\n            for (let i = 0; i < comps.length; ++i) {\n                const comp = comps[i];\n                if (comp.constructor === constructor) {\n                    return comp as T;\n                }\n            }\n        } else {\n            for (let i = 0; i < comps.length; ++i) {\n                const comp = comps[i];\n                if (comp instanceof constructor) {\n                    return comp;\n                }\n            }\n        }\n        return null;\n    }\n\n    protected static _findComponents<T extends Component> (node: BaseNode, constructor: Constructor<T> | AbstractedConstructor<T>, components: Component[]) {\n        const cls = constructor;\n        const comps = node._components;\n        // @ts-expect-error internal rtti property\n        if (cls._sealed) {\n            for (let i = 0; i < comps.length; ++i) {\n                const comp = comps[i];\n                if (comp.constructor === constructor) {\n                    components.push(comp);\n                }\n            }\n        } else {\n            for (let i = 0; i < comps.length; ++i) {\n                const comp = comps[i];\n                if (comp instanceof constructor) {\n                    components.push(comp);\n                }\n            }\n        }\n    }\n\n    protected static _findChildComponent<T extends Component> (children: BaseNode[], constructor: Constructor<T> | AbstractedConstructor<T>): T | null {\n        for (let i = 0; i < children.length; ++i) {\n            const node = children[i];\n            let comp = BaseNode._findComponent(node, constructor);\n            if (comp) {\n                return comp;\n            }\n\n            if (node._children.length > 0) {\n                comp = BaseNode._findChildComponent(node._children, constructor);\n                if (comp) {\n                    return comp;\n                }\n            }\n        }\n        return null;\n    }\n\n    protected static _findChildComponents (children: BaseNode[], constructor, components) {\n        for (let i = 0; i < children.length; ++i) {\n            const node = children[i];\n            BaseNode._findComponents(node, constructor, components);\n            if (node._children.length > 0) {\n                BaseNode._findChildComponents(node._children, constructor, components);\n            }\n        }\n    }\n\n    @serializable\n    protected _parent: this | null = null;\n\n    @serializable\n    protected _children: this[] = [];\n\n    @serializable\n    protected _active = true;\n\n    @serializable\n    protected _components: Component[] = [];\n\n    // The PrefabInfo object\n    @serializable\n    protected _prefab: PrefabInfo|null = null;\n\n    protected _scene: Scene = null!;\n\n    protected _activeInHierarchy = false;\n\n    protected _id: string = idGenerator.getNewId();\n\n    protected _name: string;\n\n    protected _eventProcessor: any = new legacyCC.NodeEventProcessor(this);\n    protected _eventMask = 0;\n\n    protected _siblingIndex = 0;\n\n    /**\n     * @en\n     * record scene's id when set this node as persist node\n     * @zh\n     * 当设置节点为常驻节点时记录场景的 id\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _originalSceneId = '';\n\n    /**\n     * Set `_scene` field of this node.\n     * The derived `Scene` overrides this method to behavior differently.\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    protected _updateScene () {\n        if (this._parent == null) {\n            error('Node %s(%s) has not attached to a scene.', this.name, this.uuid);\n        } else {\n            this._scene = this._parent._scene;\n        }\n    }\n\n    constructor (name?: string) {\n        super(name);\n        this._name = name !== undefined ? name : 'New Node';\n    }\n\n    /**\n     * @en\n     * Properties configuration function.\n     * All properties in attrs will be set to the node,\n     * when the setter of the node is available,\n     * the property will be set via setter function.\n     * @zh 属性配置函数。在 attrs 的所有属性将被设置为节点属性。\n     * @param attrs - Properties to be set to node\n     * @example\n     * ```\n     * var attrs = { name: 'New Name', active: false };\n     * node.attr(attrs);\n     * ```\n     */\n    public attr (attrs: unknown) {\n        js.mixin(this, attrs);\n    }\n\n    // HIERARCHY METHODS\n\n    /**\n     * @en Get parent of the node.\n     * @zh 获取该节点的父节点。\n     */\n    public getParent () {\n        return this._parent;\n    }\n\n    /**\n     * @en Set parent of the node.\n     * @zh 设置该节点的父节点。\n     */\n    public setParent (value: this | Scene | null, keepWorldTransform = false) {\n        if (this._parent === value) {\n            return;\n        }\n        const oldParent = this._parent;\n        const newParent = value as this;\n        if (DEBUG && oldParent\n            // Change parent when old parent deactivating or activating\n            && (oldParent._objFlags & Deactivating)) {\n            errorID(3821);\n        }\n\n        this._parent = newParent;\n        // Reset sibling index\n        this._siblingIndex = 0;\n\n        this._onSetParent(oldParent, keepWorldTransform);\n\n        if (this.emit) {\n            this.emit(NodeEventType.PARENT_CHANGED, oldParent);\n        }\n\n        if (oldParent) {\n            if (!(oldParent._objFlags & Destroying)) {\n                const removeAt = oldParent._children.indexOf(this);\n                if (DEV && removeAt < 0) {\n                    errorID(1633);\n                    return;\n                }\n                oldParent._children.splice(removeAt, 1);\n                oldParent._updateSiblingIndex();\n                if (oldParent.emit) {\n                    oldParent.emit(NodeEventType.CHILD_REMOVED, this);\n                }\n            }\n        }\n\n        if (newParent) {\n            if (DEBUG && (newParent._objFlags & Deactivating)) {\n                errorID(3821);\n            }\n            newParent._children.push(this);\n            this._siblingIndex = newParent._children.length - 1;\n            if (newParent.emit) {\n                newParent.emit(NodeEventType.CHILD_ADDED, this);\n            }\n        }\n\n        this._onHierarchyChanged(oldParent);\n    }\n\n    /**\n     * @en Returns a child with the same uuid.\n     * @zh 通过 uuid 获取节点的子节点。\n     * @param uuid - The uuid to find the child node.\n     * @return a Node whose uuid equals to the input parameter\n     */\n    public getChildByUuid (uuid: string): Node | null {\n        if (!uuid) {\n            log('Invalid uuid');\n            return null;\n        }\n\n        const locChildren = this._children;\n        for (let i = 0, len = locChildren.length; i < len; i++) {\n            if (locChildren[i]._id === uuid) {\n                // @ts-expect-error force cast\n                return locChildren[i] as Node;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * @en Returns a child with the same name.\n     * @zh 通过名称获取节点的子节点。\n     * @param name - A name to find the child node.\n     * @return a CCNode object whose name equals to the input parameter\n     * @example\n     * ```\n     * var child = node.getChildByName(\"Test Node\");\n     * ```\n     */\n    public getChildByName (name: string): Node | null {\n        if (!name) {\n            log('Invalid name');\n            return null;\n        }\n\n        const locChildren = this._children;\n        for (let i = 0, len = locChildren.length; i < len; i++) {\n            if (locChildren[i]._name === name) {\n                // @ts-expect-error force cast\n                return locChildren[i] as Node;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * @en Returns a child with the given path.\n     * @zh 通过路径获取节点的子节点。\n     * @param path - A path to find the child node.\n     * @return a Node object whose path equals to the input parameter\n     * @example\n     * ```\n     * var child = node.getChildByPath(\"subNode/Test Node\");\n     * ```\n     */\n    public getChildByPath (path: string): Node | null {\n        const segments = path.split('/');\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let lastNode: BaseNode = this;\n        for (let i = 0; i < segments.length; ++i) {\n            const segment = segments[i];\n            if (segment.length === 0) {\n                continue;\n            }\n            const next = lastNode.children.find((childNode) => childNode.name === segment);\n            if (!next) {\n                return null;\n            }\n            lastNode = next;\n        }\n        return lastNode as Node;\n    }\n\n    /**\n     * @en Add a child to the current node.\n     * @zh 添加一个子节点。\n     * @param child - the child node to be added\n     */\n    public addChild (child: Node): void {\n        (child as BaseNode).setParent(this);\n    }\n\n    /**\n     * @en Inserts a child to the node at a specified index.\n     * @zh 插入子节点到指定位置\n     * @param child - the child node to be inserted\n     * @param siblingIndex - the sibling index to place the child in\n     * @example\n     * ```\n     * node.insertChild(child, 2);\n     * ```\n     */\n    public insertChild (child: Node, siblingIndex: number) {\n        (child as BaseNode).setParent(this);\n        child.setSiblingIndex(siblingIndex);\n    }\n\n    /**\n     * @en Get the sibling index of the current node in its parent's children array.\n     * @zh 获取当前节点在父节点的 children 数组中的位置。\n     */\n    public getSiblingIndex () {\n        return this._siblingIndex;\n    }\n\n    /**\n     * @en Set the sibling index of the current node in its parent's children array.\n     * @zh 设置当前节点在父节点的 children 数组中的位置。\n     */\n    public setSiblingIndex (index: number) {\n        if (!this._parent) {\n            return;\n        }\n        if (this._parent._objFlags & Deactivating) {\n            errorID(3821);\n            return;\n        }\n        const siblings = this._parent._children;\n        index = index !== -1 ? index : siblings.length - 1;\n        const oldIndex = siblings.indexOf(this);\n        if (index !== oldIndex) {\n            siblings.splice(oldIndex, 1);\n            if (index < siblings.length) {\n                siblings.splice(index, 0, this);\n            } else {\n                siblings.push(this);\n            }\n            this._parent._updateSiblingIndex();\n            if (this._onSiblingIndexChanged) {\n                this._onSiblingIndexChanged(index);\n            }\n        }\n    }\n\n    /**\n     * @en Walk though the sub children tree of the current node.\n     * Each node, including the current node, in the sub tree will be visited two times,\n     * before all children and after all children.\n     * This function call is not recursive, it's based on stack.\n     * Please don't walk any other node inside the walk process.\n     * @zh 遍历该节点的子树里的所有节点并按规则执行回调函数。\n     * 对子树中的所有节点，包含当前节点，会执行两次回调，preFunc 会在访问它的子节点之前调用，postFunc 会在访问所有子节点之后调用。\n     * 这个函数的实现不是基于递归的，而是基于栈展开递归的方式。\n     * 请不要在 walk 过程中对任何其他的节点嵌套执行 walk。\n     * @param preFunc The callback to process node when reach the node for the first time\n     * @param postFunc The callback to process node when re-visit the node after walked all children in its sub tree\n     * @example\n     * ```\n     * node.walk(function (target) {\n     *     console.log('Walked through node ' + target.name + ' for the first time');\n     * }, function (target) {\n     *     console.log('Walked through node ' + target.name + ' after walked all children in its sub tree');\n     * });\n     * ```\n     */\n    public walk (preFunc: (target: this) => void, postFunc?: (target: this) => void) {\n        // const BaseNode = cc._BaseNode;\n        let index = 1;\n        let children: this[] | null = null;\n        let curr: this | null = null;\n        let i = 0;\n        let stack = BaseNode._stacks[BaseNode._stackId];\n        if (!stack) {\n            stack = [];\n            BaseNode._stacks.push(stack);\n        }\n        BaseNode._stackId++;\n\n        stack.length = 0;\n        stack[0] = this;\n        let parent: this | null = null;\n        let afterChildren = false;\n        while (index) {\n            index--;\n            curr = stack[index] as (this | null);\n            if (!curr) {\n                continue;\n            }\n            if (!afterChildren && preFunc) {\n                // pre call\n                preFunc(curr);\n            } else if (afterChildren && postFunc) {\n                // post call\n                postFunc(curr);\n            }\n\n            // Avoid memory leak\n            stack[index] = null;\n            // Do not repeatedly visit child tree, just do post call and continue walk\n            if (afterChildren) {\n                if (parent === this._parent) break;\n                afterChildren = false;\n            } else {\n                // Children not proceeded and has children, proceed to child tree\n                if (curr._children.length > 0) {\n                    parent = curr;\n                    children = curr._children;\n                    i = 0;\n                    stack[index] = children[i];\n                    index++;\n                } else {\n                    stack[index] = curr;\n                    index++;\n                    afterChildren = true;\n                }\n                continue;\n            }\n            // curr has no sub tree, so look into the siblings in parent children\n            if (children) {\n                i++;\n                // Proceed to next sibling in parent children\n                if (children[i]) {\n                    stack[index] = children[i];\n                    index++;\n                } else if (parent) {\n                    stack[index] = parent;\n                    index++;\n                    // Setup parent walk env\n                    afterChildren = true;\n                    if (parent._parent) {\n                        children = parent._parent._children;\n                        i = children.indexOf(parent);\n                        parent = parent._parent;\n                    } else {\n                        // At root\n                        parent = null;\n                        children = null;\n                    }\n\n                    // ERROR\n                    if (i < 0) {\n                        break;\n                    }\n                }\n            }\n        }\n        stack.length = 0;\n        BaseNode._stackId--;\n    }\n\n    /**\n     * @en\n     * Remove itself from its parent node.\n     * If the node have no parent, then nothing happens.\n     * @zh\n     * 从父节点中删除该节点。\n     * 如果这个节点是一个孤立节点，那么什么都不会发生。\n     */\n    public removeFromParent () {\n        if (this._parent) {\n            this._parent.removeChild(this);\n        }\n    }\n\n    /**\n     * @en Removes a child from the container.\n     * @zh 移除节点中指定的子节点。\n     * @param child - The child node which will be removed.\n     */\n    public removeChild (child: this | Node) {\n        if (this._children.indexOf(child as this) > -1) {\n            // invoke the parent setter\n            child.parent = null;\n        }\n    }\n\n    /**\n     * @en Removes all children from the container.\n     * @zh 移除节点所有的子节点。\n     */\n    public removeAllChildren () {\n        // not using detachChild improves speed here\n        const children = this._children;\n        for (let i = children.length - 1; i >= 0; i--) {\n            const node = children[i];\n            if (node) {\n                node.parent = null;\n            }\n        }\n        this._children.length = 0;\n    }\n\n    /**\n     * @en Is this node a child of the given node?\n     * @zh 是否是指定节点的子节点？\n     * @return True if this node is a child, deep child or identical to the given node.\n     */\n    public isChildOf (parent: this | Scene | null): boolean {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let child: BaseNode | null = this;\n        do {\n            if (child === parent) {\n                return true;\n            }\n            child = child._parent;\n        }\n        while (child);\n        return false;\n    }\n\n    // COMPONENT\n\n    /**\n     * @en\n     * Returns the component of supplied type if the node has one attached, null if it doesn't.\n     * You can also get component in the node by passing in the name of the script.\n     * @zh\n     * 获取节点上指定类型的组件，如果节点有附加指定类型的组件，则返回，如果没有则为空。\n     * 传入参数也可以是脚本的名称。\n     * @param classConstructor The class of the target component\n     * @example\n     * ```\n     * // get sprite component.\n     * var sprite = node.getComponent(Sprite);\n     * ```\n     */\n    public getComponent<T extends Component> (classConstructor: Constructor<T> | AbstractedConstructor<T>): T | null;\n\n    /**\n     * @en\n     * Returns the component of supplied type if the node has one attached, null if it doesn't.\n     * You can also get component in the node by passing in the name of the script.\n     * @zh\n     * 获取节点上指定类型的组件，如果节点有附加指定类型的组件，则返回，如果没有则为空。\n     * 传入参数也可以是脚本的名称。\n     * @param className The class name of the target component\n     * @example\n     * ```\n     * // get custom test class.\n     * var test = node.getComponent(\"Test\");\n     * ```\n     */\n    public getComponent (className: string): Component | null;\n\n    public getComponent<T extends Component> (typeOrClassName: string | Constructor<T> | AbstractedConstructor<T>) {\n        const constructor = getConstructor(typeOrClassName);\n        if (constructor) {\n            return BaseNode._findComponent(this, constructor);\n        }\n        return null;\n    }\n\n    /**\n     * @en Returns all components of given type in the node.\n     * @zh 返回节点上指定类型的所有组件。\n     * @param classConstructor The class of the target component\n     */\n    public getComponents<T extends Component> (classConstructor: Constructor<T> | AbstractedConstructor<T>): T[];\n\n    /**\n     * @en Returns all components of given type in the node.\n     * @zh 返回节点上指定类型的所有组件。\n     * @param className The class name of the target component\n     */\n    public getComponents (className: string): Component[];\n\n    public getComponents<T extends Component> (typeOrClassName: string | Constructor<T> | AbstractedConstructor<T>) {\n        const constructor = getConstructor(typeOrClassName);\n        const components: Component[] = [];\n        if (constructor) {\n            BaseNode._findComponents(this, constructor, components);\n        }\n        return components;\n    }\n\n    /**\n     * @en Returns the component of given type in any of its children using depth first search.\n     * @zh 递归查找所有子节点中第一个匹配指定类型的组件。\n     * @param classConstructor The class of the target component\n     * @example\n     * ```\n     * var sprite = node.getComponentInChildren(Sprite);\n     * ```\n     */\n    public getComponentInChildren<T extends Component> (classConstructor: Constructor<T> | AbstractedConstructor<T>): T | null;\n\n    /**\n     * @en Returns the component of given type in any of its children using depth first search.\n     * @zh 递归查找所有子节点中第一个匹配指定类型的组件。\n     * @param className The class name of the target component\n     * @example\n     * ```\n     * var Test = node.getComponentInChildren(\"Test\");\n     * ```\n     */\n    public getComponentInChildren (className: string): Component | null;\n\n    public getComponentInChildren<T extends Component> (typeOrClassName: string | Constructor<T> | AbstractedConstructor<T>) {\n        const constructor = getConstructor(typeOrClassName);\n        if (constructor) {\n            return BaseNode._findChildComponent(this._children, constructor);\n        }\n        return null;\n    }\n\n    /**\n     * @en Returns all components of given type in self or any of its children.\n     * @zh 递归查找自身或所有子节点中指定类型的组件\n     * @param classConstructor The class of the target component\n     * @example\n     * ```\n     * var sprites = node.getComponentsInChildren(Sprite);\n     * ```\n     */\n    public getComponentsInChildren<T extends Component> (classConstructor: Constructor<T> | AbstractedConstructor<T>): T[];\n\n    /**\n     * @en Returns all components of given type in self or any of its children.\n     * @zh 递归查找自身或所有子节点中指定类型的组件\n     * @param className The class name of the target component\n     * @example\n     * ```\n     * var tests = node.getComponentsInChildren(\"Test\");\n     * ```\n     */\n    public getComponentsInChildren (className: string): Component[];\n\n    public getComponentsInChildren<T extends Component> (typeOrClassName: string | Constructor<T> | AbstractedConstructor<T>) {\n        const constructor = getConstructor(typeOrClassName);\n        const components: Component[] = [];\n        if (constructor) {\n            BaseNode._findComponents(this, constructor, components);\n            BaseNode._findChildComponents(this._children, constructor, components);\n        }\n        return components;\n    }\n\n    /**\n     * @en Adds a component class to the node. You can also add component to node by passing in the name of the script.\n     * @zh 向节点添加一个指定类型的组件类，你还可以通过传入脚本的名称来添加组件。\n     * @param classConstructor The class of the component to add\n     * @throws `TypeError` if the `classConstructor` does not specify a cc-class constructor extending the `Component`.\n     * @example\n     * ```\n     * var sprite = node.addComponent(Sprite);\n     * ```\n     */\n    public addComponent<T extends Component> (classConstructor: Constructor<T>): T;\n\n    /**\n     * @en Adds a component class to the node. You can also add component to node by passing in the name of the script.\n     * @zh 向节点添加一个指定类型的组件类，你还可以通过传入脚本的名称来添加组件。\n     * @param className The class name of the component to add\n     * @throws `TypeError` if the `className` does not specify a cc-class constructor extending the `Component`.\n     * @example\n     * ```\n     * var test = node.addComponent(\"Test\");\n     * ```\n     */\n    public addComponent (className: string): Component;\n\n    public addComponent<T extends Component> (typeOrClassName: string | Constructor<T>) {\n        if (EDITOR && (this._objFlags & Destroying)) {\n            throw Error('isDestroying');\n        }\n\n        // get component\n\n        let constructor: Constructor<T> | null | undefined;\n        if (typeof typeOrClassName === 'string') {\n            constructor = js.getClassByName(typeOrClassName) as Constructor<T> | undefined;\n            if (!constructor) {\n                if (legacyCC._RF.peek()) {\n                    errorID(3808, typeOrClassName);\n                }\n                throw TypeError(getError(3807, typeOrClassName));\n            }\n        } else {\n            if (!typeOrClassName) {\n                throw TypeError(getError(3804));\n            }\n            constructor = typeOrClassName;\n        }\n\n        // check component\n\n        if (typeof constructor !== 'function') {\n            throw TypeError(getError(3809));\n        }\n        if (!js.isChildClassOf(constructor, legacyCC.Component)) {\n            throw TypeError(getError(3810));\n        }\n\n        if (EDITOR && (constructor as typeof constructor & { _disallowMultiple?: unknown })._disallowMultiple) {\n            this._checkMultipleComp!(constructor);\n        }\n\n        // check requirement\n\n        const reqComps = (constructor as typeof constructor & { _requireComponent?: typeof Component })._requireComponent;\n        if (reqComps) {\n            if (Array.isArray(reqComps)) {\n                for (let i = 0; i < reqComps.length; i++) {\n                    const reqComp = reqComps[i];\n                    if (!this.getComponent(reqComp)) {\n                        this.addComponent(reqComp);\n                    }\n                }\n            } else {\n                const reqComp = reqComps;\n                if (!this.getComponent(reqComp)) {\n                    this.addComponent(reqComp);\n                }\n            }\n        }\n\n        /// / check conflict\n        //\n        // if (EDITOR && !_Scene.DetectConflict.beforeAddComponent(this, constructor)) {\n        //    return null;\n        // }\n\n        //\n\n        const component = new constructor();\n        component.node = (this as unknown as Node); // TODO: HACK here\n        this._components.push(component);\n        if (EDITOR && EditorExtends.Node && EditorExtends.Component) {\n            const node = EditorExtends.Node.getNode(this._id);\n            if (node) {\n                EditorExtends.Component.add(component._id, component);\n            }\n        }\n        this.emit(NodeEventType.COMPONENT_ADDED, component);\n        if (this._activeInHierarchy) {\n            legacyCC.director._nodeActivator.activateComp(component);\n        }\n\n        return component;\n    }\n\n    /**\n     * @en\n     * Removes a component identified by the given name or removes the component object given.\n     * You can also use component.destroy() if you already have the reference.\n     * @zh\n     * 删除节点上的指定组件，传入参数可以是一个组件构造函数或组件名，也可以是已经获得的组件引用。\n     * 如果你已经获得组件引用，你也可以直接调用 component.destroy()\n     * @param classConstructor The class of the component to remove\n     * @deprecated please destroy the component to remove it.\n     * @example\n     * ```\n     * node.removeComponent(Sprite);\n     * ```\n     */\n    public removeComponent<T extends Component> (classConstructor: Constructor<T> | AbstractedConstructor<T>): void;\n\n    /**\n     * @en\n     * Removes a component identified by the given name or removes the component object given.\n     * You can also use component.destroy() if you already have the reference.\n     * @zh\n     * 删除节点上的指定组件，传入参数可以是一个组件构造函数或组件名，也可以是已经获得的组件引用。\n     * 如果你已经获得组件引用，你也可以直接调用 component.destroy()\n     * @param classNameOrInstance The class name of the component to remove or the component instance to be removed\n     * @deprecated please destroy the component to remove it.\n     * @example\n     * ```\n     * import { Sprite } from 'cc';\n     * const sprite = node.getComponent(Sprite);\n     * if (sprite) {\n     *     node.removeComponent(sprite);\n     * }\n     * node.removeComponent('Sprite');\n     * ```\n     */\n    public removeComponent (classNameOrInstance: string | Component): void;\n\n    public removeComponent (component: any) {\n        if (!component) {\n            errorID(3813);\n            return;\n        }\n        let componentInstance: Component | null = null;\n        if (component instanceof Component) {\n            componentInstance = component;\n        } else {\n            componentInstance = this.getComponent(component);\n        }\n        if (componentInstance) {\n            componentInstance.destroy();\n        }\n    }\n\n    // EVENT PROCESSING\n\n    /**\n     * @en\n     * Register a callback of a specific event type on Node.\n     * Use this method to register touch or mouse event permit propagation based on scene graph,\n     * These kinds of event are triggered with dispatchEvent, the dispatch process has three steps:\n     * 1. Capturing phase: dispatch in capture targets, e.g. parents in node tree, from root to the real target\n     * 2. At target phase: dispatch to the listeners of the real target\n     * 3. Bubbling phase: dispatch in bubble targets, e.g. parents in node tree, from the real target to root\n     * In any moment of the dispatching process, it can be stopped via `event.stopPropagation()` or `event.stopPropagationImmediate()`.\n     * You can also register custom event and use `emit` to trigger custom event on Node.\n     * For such events, there won't be capturing and bubbling phase, your event will be dispatched directly to its listeners registered on the same node.\n     * You can also pass event callback parameters with `emit` by passing parameters after `type`.\n     * @zh\n     * 在节点上注册指定类型的回调函数，也可以设置 target 用于绑定响应函数的 this 对象。\n     * 鼠标或触摸事件会被系统调用 dispatchEvent 方法触发，触发的过程包含三个阶段：\n     * 1. 捕获阶段：派发事件给捕获目标，比如，节点树中注册了捕获阶段的父节点，从根节点开始派发直到目标节点。\n     * 2. 目标阶段：派发给目标节点的监听器。\n     * 3. 冒泡阶段：派发事件给冒泡目标，比如，节点树中注册了冒泡阶段的父节点，从目标节点开始派发直到根节点。\n     * 同时您可以将事件派发到父节点或者通过调用 stopPropagation 拦截它。\n     * 你也可以注册自定义事件到节点上，并通过 emit 方法触发此类事件，对于这类事件，不会发生捕获冒泡阶段，只会直接派发给注册在该节点上的监听器\n     * 你可以通过在 emit 方法调用时在 type 之后传递额外的参数作为事件回调的参数列表\n     * @param type - A string representing the event type to listen for.<br>See [[Node.EventType.POSITION_CHANGED]] for all builtin events.\n     * @param callback - The callback that will be invoked when the event is dispatched. The callback is ignored if it is a duplicate (the callbacks are unique).\n     * @param target - The target (this object) to invoke the callback, can be null\n     * @param useCapture - When set to true, the listener will be triggered at capturing phase which is ahead of the final target emit, otherwise it will be triggered during bubbling phase.\n     * @return - Just returns the incoming callback so you can save the anonymous function easier.\n     * @example\n     * ```ts\n     * this.node.on(NodeEventType.TOUCH_START, this.memberFunction, this);  // if \"this\" is component and the \"memberFunction\" declared in CCClass.\n     * node.on(NodeEventType.TOUCH_START, callback, this);\n     * node.on(NodeEventType.TOUCH_MOVE, callback, this);\n     * node.on(NodeEventType.TOUCH_END, callback, this);\n     * ```\n     */\n    public on (type: string | NodeEventType, callback: AnyFunction, target?: unknown, useCapture: any = false) {\n        switch (type) {\n        case NodeEventType.TRANSFORM_CHANGED:\n            this._eventMask |= TRANSFORM_ON;\n            break;\n        default:\n            break;\n        }\n        this._eventProcessor.on(type, callback, target, useCapture);\n    }\n\n    /**\n     * @en\n     * Removes the callback previously registered with the same type, callback, target and or useCapture.\n     * This method is merely an alias to removeEventListener.\n     * @zh 删除之前与同类型，回调，目标或 useCapture 注册的回调。\n     * @param type - A string representing the event type being removed.\n     * @param callback - The callback to remove.\n     * @param target - The target (this object) to invoke the callback, if it's not given, only callback without target will be removed\n     * @param useCapture - When set to true, the listener will be triggered at capturing phase which is ahead of the final target emit, otherwise it will be triggered during bubbling phase.\n     * @example\n     * ```ts\n     * this.node.off(NodeEventType.TOUCH_START, this.memberFunction, this);\n     * node.off(NodeEventType.TOUCH_START, callback, this.node);\n     * ```\n     */\n    public off (type: string, callback?: AnyFunction, target?: unknown, useCapture: any = false) {\n        this._eventProcessor.off(type, callback, target, useCapture);\n\n        const hasListeners = this._eventProcessor.hasEventListener(type);\n        // All listener removed\n        if (!hasListeners) {\n            switch (type) {\n            case NodeEventType.TRANSFORM_CHANGED:\n                this._eventMask &= ~TRANSFORM_ON;\n                break;\n            default:\n                break;\n            }\n        }\n    }\n\n    /**\n     * @en\n     * Register an callback of a specific event type on the Node,\n     * the callback will remove itself after the first time it is triggered.\n     * @zh\n     * 注册节点的特定事件类型回调，回调会在第一时间被触发后删除自身。\n     *\n     * @param type - A string representing the event type to listen for.\n     * @param callback - The callback that will be invoked when the event is dispatched.\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\n     * @param target - The target (this object) to invoke the callback, can be null\n     */\n    public once (type: string, callback: AnyFunction, target?: unknown, useCapture?: any) {\n        this._eventProcessor.once(type, callback, target, useCapture);\n    }\n\n    /**\n     * @en\n     * Trigger an event directly with the event name and necessary arguments.\n     * @zh\n     * 通过事件名发送自定义事件\n     * @param type - event type\n     * @param arg1 - First argument in callback\n     * @param arg2 - Second argument in callback\n     * @param arg3 - Third argument in callback\n     * @param arg4 - Fourth argument in callback\n     * @param arg5 - Fifth argument in callback\n     * @example\n     * ```ts\n     * eventTarget.emit('fire', event);\n     * eventTarget.emit('fire', message, emitter);\n     * ```\n     */\n    public emit (type: string, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) {\n        this._eventProcessor.emit(type, arg0, arg1, arg2, arg3, arg4);\n    }\n\n    /**\n     * @en\n     * Dispatches an event into the event flow.\n     * The event target is the EventTarget object upon which the dispatchEvent() method is called.\n     * @zh 分发事件到事件流中。\n     * @param event - The Event object that is dispatched into the event flow\n     */\n    public dispatchEvent (event: Event) {\n        this._eventProcessor.dispatchEvent(event);\n    }\n\n    /**\n     * @en Checks whether the EventTarget object has any callback registered for a specific type of event.\n     * @zh 检查事件目标对象是否有为特定类型的事件注册的回调。\n     * @param type - The type of event.\n     * @param callback - The callback function of the event listener, if absent all event listeners for the given type will be removed\n     * @param target - The callback callee of the event listener\n     * @return True if a callback of the specified type is registered; false otherwise.\n     */\n    public hasEventListener (type: string, callback?: AnyFunction, target?: unknown) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return this._eventProcessor.hasEventListener(type, callback, target);\n    }\n\n    /**\n     * @en Removes all callbacks previously registered with the same target.\n     * @zh 移除目标上的所有注册事件。\n     * @param target - The target to be searched for all related callbacks\n     */\n    public targetOff (target: string | unknown) {\n        this._eventProcessor.targetOff(target);\n        // Check for event mask reset\n        if ((this._eventMask & TRANSFORM_ON) && !this._eventProcessor.hasEventListener(NodeEventType.TRANSFORM_CHANGED)) {\n            this._eventMask &= ~TRANSFORM_ON;\n        }\n    }\n\n    public destroy () {\n        if (super.destroy()) {\n            this.active = false;\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * @en\n     * Destroy all children from the node, and release all their own references to other objects.\n     * Actual destruct operation will delayed until before rendering.\n     * @zh\n     * 销毁所有子节点，并释放所有它们对其它对象的引用。\n     * 实际销毁操作会延迟到当前帧渲染前执行。\n     */\n    public destroyAllChildren () {\n        const children = this._children;\n        for (let i = 0; i < children.length; ++i) {\n            children[i].destroy();\n        }\n    }\n\n    /**\n     * Do remove component, only used internally.\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _removeComponent (component: Component) {\n        if (!component) {\n            errorID(3814);\n            return;\n        }\n\n        if (!(this._objFlags & Destroying)) {\n            const i = this._components.indexOf(component);\n            if (i !== -1) {\n                this._components.splice(i, 1);\n                if (EDITOR && EditorExtends.Component) {\n                    EditorExtends.Component.remove(component._id);\n                }\n                this.emit(NodeEventType.COMPONENT_REMOVED, component);\n            } else if (component.node !== (this as unknown as BaseNode)) {\n                errorID(3815);\n            }\n        }\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _updateSiblingIndex () {\n        for (let i = 0; i < this._children.length; ++i) {\n            this._children[i]._siblingIndex = i;\n        }\n\n        this.emit(NodeEventType.SIBLING_ORDER_CHANGED);\n    }\n\n    protected _onSetParent (oldParent: this | null, keepWorldTransform = false) {\n        if (this._parent) {\n            if ((oldParent == null || oldParent._scene !== this._parent._scene) && this._parent._scene != null) {\n                this.walk(BaseNode._setScene);\n            }\n        }\n    }\n\n    // PRIVATE\n\n    protected _onPostActivated (active: boolean) {\n\n    }\n\n    protected _onBatchCreated (dontSyncChildPrefab: boolean) {\n        if (this._parent) {\n            this._siblingIndex = this._parent._children.indexOf(this);\n        }\n    }\n\n    protected _onPreDestroy () {\n        this._onPreDestroyBase();\n    }\n\n    protected _onHierarchyChanged (oldParent: this | null) {\n        return this._onHierarchyChangedBase(oldParent);\n    }\n\n    protected _instantiate (cloned, isSyncedNode) {\n        if (!cloned) {\n            cloned = legacyCC.instantiate._clone(this, this);\n        }\n\n        const newPrefabInfo = cloned._prefab;\n        if (EDITOR && newPrefabInfo) {\n            // EditorExtends.PrefabUtils.addPrefabInstance?.(cloned);\n            if (cloned === newPrefabInfo.root) {\n                // newPrefabInfo.fileId = '';\n            } else {\n                // var PrefabUtils = Editor.require('scene://utils/prefab');\n                // PrefabUtils.unlinkPrefab(cloned);\n            }\n        }\n\n        // reset and init\n        cloned._parent = null;\n        cloned._onBatchCreated(isSyncedNode);\n\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return cloned;\n    }\n\n    protected _onHierarchyChangedBase (oldParent: this | null) {\n        const newParent = this._parent;\n        if (this._persistNode && !(newParent instanceof legacyCC.Scene)) {\n            legacyCC.game.removePersistRootNode(this);\n            if (EDITOR) {\n                warnID(1623);\n            }\n        }\n\n        if (EDITOR) {\n            const scene = legacyCC.director.getScene() as this | null;\n            const inCurrentSceneBefore = oldParent && oldParent.isChildOf(scene);\n            const inCurrentSceneNow = newParent && newParent.isChildOf(scene);\n            if (!inCurrentSceneBefore && inCurrentSceneNow) {\n                // attached\n                // @ts-expect-error Polyfilled functions in base-node-dev.ts\n                this._registerIfAttached!(true);\n            } else if (inCurrentSceneBefore && !inCurrentSceneNow) {\n                // detached\n                // @ts-expect-error Polyfilled functions in base-node-dev.ts\n                this._registerIfAttached!(false);\n            }\n\n            // conflict detection\n            // _Scene.DetectConflict.afterAddChild(this);\n        }\n\n        const shouldActiveNow = this._active && !!(newParent && newParent._activeInHierarchy);\n        if (this._activeInHierarchy !== shouldActiveNow) {\n            legacyCC.director._nodeActivator.activateNode(this, shouldActiveNow);\n        }\n    }\n\n    protected _onPreDestroyBase () {\n        // marked as destroying\n        this._objFlags |= Destroying;\n\n        // detach self and children from editor\n        const parent = this._parent;\n        const destroyByParent: boolean = (!!parent) && ((parent._objFlags & Destroying) !== 0);\n        if (!destroyByParent && EDITOR) {\n            // @ts-expect-error Polyfilled functions in base-node-dev.ts\n            this._registerIfAttached!(false);\n        }\n\n        // remove from persist\n        if (this._persistNode) {\n            legacyCC.game.removePersistRootNode(this);\n        }\n\n        if (!destroyByParent) {\n            // remove from parent\n            if (parent) {\n                this.emit(NodeEventType.PARENT_CHANGED, this);\n                // During destroy process, sibling index is not reliable\n                const childIndex = parent._children.indexOf(this);\n                parent._children.splice(childIndex, 1);\n                this._siblingIndex = 0;\n                parent._updateSiblingIndex();\n                if (parent.emit) {\n                    parent.emit(NodeEventType.CHILD_REMOVED, this);\n                }\n            }\n        }\n\n        // emit node destroy event (this should before event processor destroy)\n        this.emit(NodeEventType.NODE_DESTROYED, this);\n\n        // Destroy node event processor\n        this._eventProcessor.destroy();\n\n        // destroy children\n        const children = this._children;\n        for (let i = 0; i < children.length; ++i) {\n            // destroy immediate so its _onPreDestroy can be called\n            children[i]._destroyImmediate();\n        }\n\n        // destroy self components\n        const comps = this._components;\n        for (let i = 0; i < comps.length; ++i) {\n            // destroy immediate so its _onPreDestroy can be called\n            // TO DO\n            comps[i]._destroyImmediate();\n        }\n\n        return destroyByParent;\n    }\n\n    protected _onSiblingIndexChanged? (siblingIndex: number): void;\n\n    /**\n     * @en\n     * Ensures that this node has already had the specified component(s). If not, this method throws.\n     * @zh\n     * 检查节点已经包含对应的组件，如果没有，则抛出异常\n     * @param constructor Constructor of the component.\n     * @throws If one or more component of same type have been existed in this node.\n     */\n    protected _checkMultipleComp?<T extends Component> (constructor: Constructor<T>): void;\n}\n\nbaseNodePolyfill(BaseNode);\n\nlegacyCC._BaseNode = BaseNode;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Node's coordinate space\n * @zh 节点的坐标空间\n */\nexport enum NodeSpace {\n    LOCAL,\n    WORLD,\n}\n\n/**\n * @en Bit masks for node's transformation\n * @zh 节点的空间变换位标记\n */\nexport enum TransformBit {\n    /**\n     * @en No change\n     * @zh 无改变\n     */\n    NONE = 0,\n    /**\n     * @en Translation changed\n     * @zh 节点位置改变\n     */\n    POSITION = (1 << 0),\n    /**\n     * @en Rotation changed\n     * @zh 节点旋转\n     */\n    ROTATION = (1 << 1),\n    /**\n     * @en Scale changed\n     * @zh 节点缩放\n     */\n    SCALE = (1 << 2),\n    /**\n     * @en Rotation or scale changed\n     * @zh 节点旋转及缩放\n     */\n    RS = TransformBit.ROTATION | TransformBit.SCALE,\n    /**\n     * @en Translation, rotation or scale changed\n     * @zh 节点平移，旋转及缩放\n     */\n    TRS = TransformBit.POSITION | TransformBit.ROTATION | TransformBit.SCALE,\n    /**\n     * @en Invert mask of [[TRS]]\n     * @zh [[TRS]] 的反向掩码\n     */\n    TRS_MASK = ~TransformBit.TRS,\n}\n\nlegacyCC.internal.TransformBit = TransformBit;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport {\n    ccclass, editable, serializable, type,\n} from 'cc.decorator';\nimport { EDITOR } from 'internal:constants';\nimport { Layers } from './layers';\nimport { NodeUIProperties } from './node-ui-properties';\nimport { legacyCC } from '../global-exports';\nimport { BaseNode, TRANSFORM_ON } from './base-node';\nimport { approx, EPSILON, Mat3, Mat4, Quat, Vec3 } from '../math';\nimport { NodeSpace, TransformBit } from './node-enum';\nimport { NodeEventType } from './node-event';\nimport { CustomSerializable, editorExtrasTag, SerializationContext, SerializationOutput, serializeTag } from '../data';\nimport { warnID } from '../platform/debug';\n\nconst v3_a = new Vec3();\nconst q_a = new Quat();\nconst q_b = new Quat();\nconst qt_1 = new Quat();\nconst m3_1 = new Mat3();\nconst m3_scaling = new Mat3();\nconst m4_1 = new Mat4();\nconst dirtyNodes: any[] = [];\n\nconst reserveContentsForAllSyncablePrefabTag = Symbol('ReserveContentsForAllSyncablePrefab');\nlet globalFlagChangeVersion = 0;\n\n/**\n * @zh\n * 场景树中的基本节点，基本特性有：\n * * 具有层级关系\n * * 持有各类组件\n * * 维护空间变换（坐标、旋转、缩放）信息\n */\n\n/**\n * @en\n * Class of all entities in Cocos Creator scenes.\n * Basic functionalities include:\n * * Hierarchy management with parent and children\n * * Components management\n * * Coordinate system with position, scale, rotation in 3d space\n * @zh\n * Cocos Creator 场景中的所有节点类。\n * 基本特性有：\n * * 具有层级关系\n * * 持有各类组件\n * * 维护 3D 空间左边变换（坐标、旋转、缩放）信息\n */\n@ccclass('cc.Node')\nexport class Node extends BaseNode implements CustomSerializable {\n    /**\n     * @en Event types emitted by Node\n     * @zh 节点可能发出的事件类型\n     */\n    public static EventType = NodeEventType;\n\n    /**\n     * @en Coordinates space\n     * @zh 空间变换操作的坐标系\n     */\n    public static NodeSpace = NodeSpace;\n\n    /**\n     * @en Bit masks for Node transformation parts\n     * @zh 节点变换更新的具体部分\n     * @deprecated please use [[Node.TransformBit]]\n     */\n    public static TransformDirtyBit = TransformBit;\n\n    /**\n     * @en Bit masks for Node transformation parts, can be used to determine which part changed in [[NodeEventType.TRANSFORM_CHANGED]] event\n     * @zh 节点变换更新的具体部分，可用于判断 [[NodeEventType.TRANSFORM_CHANGED]] 事件的具体类型\n     */\n    public static TransformBit = TransformBit;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public static reserveContentsForAllSyncablePrefabTag = reserveContentsForAllSyncablePrefabTag;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _uiProps = new NodeUIProperties(this);\n\n    /**\n     * @en Counter to clear node array\n     * @zh 清除节点数组计时器\n     */\n    private static ClearFrame = 0;\n    private static ClearRound = 1000;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _static = false;\n\n    // world transform, don't access this directly\n    protected declare _pos: Vec3;\n\n    protected declare _rot: Quat;\n\n    protected declare _scale: Vec3;\n\n    protected declare _mat: Mat4;\n\n    // local transform\n    @serializable\n    protected _lpos = new Vec3();\n\n    @serializable\n    protected _lrot = new Quat();\n\n    @serializable\n    protected _lscale = new Vec3(1, 1, 1);\n\n    @serializable\n    protected _layer = Layers.Enum.DEFAULT; // the layer this node belongs to\n\n    // local rotation in euler angles, maintained here so that rotation angles could be greater than 360 degree.\n    @serializable\n    protected _euler = new Vec3();\n\n    private _dirtyFlags = TransformBit.NONE; // does the world transform need to update?\n    protected _eulerDirty = false;\n\n    protected _flagChangeVersion = 0;\n    protected _hasChangedFlags = 0;\n\n    constructor (name?: string) {\n        super(name);\n        this._pos = new Vec3();\n        this._rot = new Quat();\n        this._scale = new Vec3(1, 1, 1);\n        this._mat = new Mat4();\n    }\n\n    /**\n     * @en Determine whether the given object is a normal Node. Will return false if [[Scene]] given.\n     * @zh 指定对象是否是普通的节点？如果传入 [[Scene]] 会返回 false。\n     */\n    public static isNode (obj: unknown): obj is Node {\n        return obj instanceof Node && (obj.constructor === Node || !(obj instanceof legacyCC.Scene));\n    }\n\n    protected _onPreDestroy () {\n        return this._onPreDestroyBase();\n    }\n\n    /**\n     * @en Position in local coordinate system\n     * @zh 本地坐标系下的坐标\n     */\n    // @constget\n    public get position (): Readonly<Vec3> {\n        return this._lpos;\n    }\n\n    public set position (val: Readonly<Vec3>) {\n        this.setPosition(val as Vec3);\n    }\n\n    /**\n     * @en Position in world coordinate system\n     * @zh 世界坐标系下的坐标\n     */\n    // @constget\n    public get worldPosition (): Readonly<Vec3> {\n        this.updateWorldTransform();\n        return this._pos;\n    }\n\n    public set worldPosition (val: Readonly<Vec3>) {\n        this.setWorldPosition(val as Vec3);\n    }\n\n    /**\n     * @en Rotation in local coordinate system, represented by a quaternion\n     * @zh 本地坐标系下的旋转，用四元数表示\n     */\n    // @constget\n    public get rotation (): Readonly<Quat> {\n        return this._lrot;\n    }\n\n    public set rotation (val: Readonly<Quat>) {\n        this.setRotation(val as Quat);\n    }\n\n    /**\n     * @en Rotation in local coordinate system, represented by euler angles\n     * @zh 本地坐标系下的旋转，用欧拉角表示\n     */\n    @type(Vec3)\n    set eulerAngles (val: Readonly<Vec3>) {\n        this.setRotationFromEuler(val.x, val.y, val.z);\n    }\n\n    get eulerAngles () {\n        if (this._eulerDirty) {\n            Quat.toEuler(this._euler, this._lrot);\n            this._eulerDirty = false;\n        }\n        return this._euler;\n    }\n\n    /**\n     * @en Rotation in local coordinate system, represented by euler angles, but limited on z axis\n     * @zh 本地坐标系下的旋转，用欧拉角表示，但是限定在 z 轴上。\n     */\n    @editable\n    get angle () {\n        return this._euler.z;\n    }\n\n    set angle (val: number) {\n        Vec3.set(this._euler, 0, 0, val);\n        Quat.fromAngleZ(this._lrot, val);\n        this._eulerDirty = false;\n\n        this.invalidateChildren(TransformBit.ROTATION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.ROTATION);\n        }\n    }\n\n    /**\n     * @en Rotation in world coordinate system, represented by a quaternion\n     * @zh 世界坐标系下的旋转，用四元数表示\n     */\n    // @constget\n    public get worldRotation (): Readonly<Quat> {\n        this.updateWorldTransform();\n        return this._rot;\n    }\n\n    public set worldRotation (val: Readonly<Quat>) {\n        this.setWorldRotation(val as Quat);\n    }\n\n    /**\n     * @en Scale in local coordinate system\n     * @zh 本地坐标系下的缩放\n     */\n    // @constget\n    public get scale (): Readonly<Vec3> {\n        return this._lscale;\n    }\n\n    public set scale (val: Readonly<Vec3>) {\n        this.setScale(val as Vec3);\n    }\n\n    /**\n     * @en Scale in world coordinate system\n     * @zh 世界坐标系下的缩放\n     */\n    // @constget\n    public get worldScale (): Readonly<Vec3> {\n        this.updateWorldTransform();\n        return this._scale;\n    }\n\n    public set worldScale (val: Readonly<Vec3>) {\n        this.setWorldScale(val as Vec3);\n    }\n\n    /**\n     * @en Local transformation matrix\n     * @zh 本地坐标系变换矩阵\n     */\n    public set matrix (val: Readonly<Mat4>) {\n        Mat4.toRTS(val, this._lrot, this._lpos, this._lscale);\n        this.invalidateChildren(TransformBit.TRS);\n        this._eulerDirty = true;\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.TRS);\n        }\n    }\n\n    /**\n     * @en World transformation matrix\n     * @zh 世界坐标系变换矩阵\n     */\n    // @constget\n    public get worldMatrix (): Readonly<Mat4> {\n        this.updateWorldTransform();\n        return this._mat;\n    }\n\n    /**\n     * @en The vector representing forward direction in local coordinate system, it's the minus z direction by default\n     * @zh 当前节点面向的前方方向，默认前方为 -z 方向\n     */\n    get forward (): Vec3 {\n        return Vec3.transformQuat(new Vec3(), Vec3.FORWARD, this.worldRotation);\n    }\n\n    set forward (dir: Vec3) {\n        const len = dir.length();\n        Vec3.multiplyScalar(v3_a, dir, -1 / len);\n        Quat.fromViewUp(q_a, v3_a);\n        this.setWorldRotation(q_a);\n    }\n\n    /**\n     * @en Return the up direction vertor of this node in world space.\n     * @zh 返回当前节点在世界空间中朝上的方向向量\n     */\n    get up (): Vec3 {\n        return Vec3.transformQuat(new Vec3(), Vec3.UP, this.worldRotation);\n    }\n\n    /**\n     * @en Return the right direction vector of this node in world space.\n     * @zh 返回当前节点在世界空间中朝右的方向向量\n     */\n    get right (): Vec3 {\n        return Vec3.transformQuat(new Vec3(), Vec3.RIGHT, this.worldRotation);\n    }\n\n    /**\n     * @en Layer of the current Node, it affects raycast, physics etc, refer to [[Layers]]\n     * @zh 节点所属层，主要影响射线检测、物理碰撞等，参考 [[Layers]]\n     */\n    @editable\n    set layer (l) {\n        this._layer = l;\n\n        if (this._uiProps && this._uiProps.uiComp) {\n            this._uiProps.uiComp.setNodeDirty();\n            this._uiProps.uiComp.markForUpdateRenderData();\n        }\n        this.emit(NodeEventType.LAYER_CHANGED, this._layer);\n    }\n\n    get layer () {\n        return this._layer;\n    }\n\n    /**\n     * @en Whether the node's transformation have changed during the current frame.\n     * @zh 这个节点的空间变换信息在当前帧内是否有变过？\n     */\n    get hasChangedFlags () {\n        return this._flagChangeVersion === globalFlagChangeVersion ? this._hasChangedFlags : 0;\n    }\n\n    set hasChangedFlags (val: number) {\n        this._flagChangeVersion = globalFlagChangeVersion;\n        this._hasChangedFlags = val;\n    }\n\n    /**\n     * @internal\n     */\n    public [serializeTag] (serializationOutput: SerializationOutput, context: SerializationContext) {\n        if (!EDITOR) {\n            serializationOutput.writeThis();\n            return;\n        }\n\n        // Detects if this node is mounted node of `PrefabInstance`\n        // TODO: optimize\n        const isMountedChild = () => !!(this[editorExtrasTag] as any)?.mountedRoot;\n\n        // Returns if this node is under `PrefabInstance`\n        // eslint-disable-next-line arrow-body-style\n        const isSyncPrefab = () => {\n            // 1. Under `PrefabInstance`, but not mounted\n            // 2. If the mounted node is a `PrefabInstance`, it's also a \"sync prefab\".\n            return this._prefab?.root?._prefab?.instance && (this?._prefab?.instance || !isMountedChild());\n        };\n\n        const canDiscardByPrefabRoot = () => !(context.customArguments[(reserveContentsForAllSyncablePrefabTag) as any]\n            || !isSyncPrefab() || context.root === this);\n\n        if (canDiscardByPrefabRoot()) {\n            // discard props disallow to synchronize\n            const isRoot = this._prefab?.root === this;\n            if (isRoot) {\n                serializationOutput.writeProperty('_objFlags', this._objFlags);\n                serializationOutput.writeProperty('_parent', this._parent);\n                serializationOutput.writeProperty('_prefab', this._prefab);\n                if (context.customArguments.keepNodeUuid) {\n                    serializationOutput.writeProperty('_id', this._id);\n                }\n                // TODO: editorExtrasTag may be a symbol in the future\n                serializationOutput.writeProperty(editorExtrasTag, this[editorExtrasTag]);\n            } else {\n                // should not serialize child node of synchronizable prefab\n            }\n        } else {\n            serializationOutput.writeThis();\n        }\n    }\n\n    // ===============================\n    // hierarchy\n    // ===============================\n\n    /**\n     * @en Set parent of the node.\n     * @zh 设置该节点的父节点。\n     * @param value Parent node\n     * @param keepWorldTransform Whether keep node's current world transform unchanged after this operation\n     */\n    public setParent (value: this | null, keepWorldTransform = false) {\n        if (keepWorldTransform) { this.updateWorldTransform(); }\n        super.setParent(value, keepWorldTransform);\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onSetParent (oldParent: this | null, keepWorldTransform: boolean) {\n        super._onSetParent(oldParent, keepWorldTransform);\n        if (keepWorldTransform) {\n            const parent = this._parent;\n            if (parent) {\n                parent.updateWorldTransform();\n                if (approx(Mat4.determinant(parent._mat), 0, EPSILON)) {\n                    warnID(14300);\n                    this._dirtyFlags |= TransformBit.TRS;\n                    this.updateWorldTransform();\n                } else {\n                    Mat4.multiply(m4_1, Mat4.invert(m4_1, parent._mat), this._mat);\n                    Mat4.toRTS(m4_1, this._lrot, this._lpos, this._lscale);\n                }\n            } else {\n                Vec3.copy(this._lpos, this._pos);\n                Quat.copy(this._lrot, this._rot);\n                Vec3.copy(this._lscale, this._scale);\n            }\n            this._eulerDirty = true;\n        }\n\n        this.invalidateChildren(TransformBit.TRS);\n    }\n\n    protected _onHierarchyChanged (oldParent: this | null) {\n        this.eventProcessor.reattach();\n        super._onHierarchyChangedBase(oldParent);\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onBatchCreated (dontSyncChildPrefab: boolean) {\n        this.hasChangedFlags = TransformBit.TRS;\n        this._dirtyFlags |= TransformBit.TRS;\n        const len = this._children.length;\n        for (let i = 0; i < len; ++i) {\n            this._children[i]._siblingIndex = i;\n            this._children[i]._onBatchCreated(dontSyncChildPrefab);\n        }\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onBeforeSerialize () {\n        // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n        this.eulerAngles; // make sure we save the correct eulerAngles\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onPostActivated (active: boolean) {\n        if (active) { // activated\n            this._eventProcessor.setEnabled(true);\n            // in case transform updated during deactivated period\n            this.invalidateChildren(TransformBit.TRS);\n            // ALL Node renderData dirty flag will set on here\n            if (this._uiProps && this._uiProps.uiComp) {\n                this._uiProps.uiComp.setNodeDirty();\n                this._uiProps.uiComp.setTextureDirty(); // for dynamic atlas\n                this._uiProps.uiComp.markForUpdateRenderData();\n            }\n        } else { // deactivated\n            this._eventProcessor.setEnabled(false);\n        }\n    }\n\n    // ===============================\n    // transform helper, convenient but not the most efficient\n    // ===============================\n\n    /**\n     * @en Perform a translation on the node\n     * @zh 移动节点\n     * @param trans The increment on position\n     * @param ns The operation coordinate space\n     */\n    public translate (trans: Vec3, ns?: NodeSpace): void {\n        const space = ns || NodeSpace.LOCAL;\n        if (space === NodeSpace.LOCAL) {\n            Vec3.transformQuat(v3_a, trans, this._lrot);\n            this._lpos.x += v3_a.x;\n            this._lpos.y += v3_a.y;\n            this._lpos.z += v3_a.z;\n        } else if (space === NodeSpace.WORLD) {\n            if (this._parent) {\n                Quat.invert(q_a, this._parent.worldRotation);\n                Vec3.transformQuat(v3_a, trans, q_a);\n                const scale = this.worldScale;\n                this._lpos.x += v3_a.x / scale.x;\n                this._lpos.y += v3_a.y / scale.y;\n                this._lpos.z += v3_a.z / scale.z;\n            } else {\n                this._lpos.x += trans.x;\n                this._lpos.y += trans.y;\n                this._lpos.z += trans.z;\n            }\n        }\n        this.invalidateChildren(TransformBit.POSITION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.POSITION);\n        }\n    }\n\n    /**\n     * @en Perform a rotation on the node\n     * @zh 旋转节点\n     * @param rot The increment on rotation\n     * @param ns The operation coordinate space\n     */\n    public rotate (rot: Quat, ns?: NodeSpace): void {\n        const space = ns || NodeSpace.LOCAL;\n        Quat.normalize(q_a, rot);\n\n        if (space === NodeSpace.LOCAL) {\n            Quat.multiply(this._lrot, this._lrot, q_a);\n        } else if (space === NodeSpace.WORLD) {\n            const worldRot = this.worldRotation;\n            Quat.multiply(q_b, q_a, worldRot);\n            Quat.invert(q_a, worldRot);\n            Quat.multiply(q_b, q_a, q_b);\n            Quat.multiply(this._lrot, this._lrot, q_b);\n        }\n        this._eulerDirty = true;\n        this.invalidateChildren(TransformBit.ROTATION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.ROTATION);\n        }\n    }\n\n    /**\n     * @en Set the orientation of the node to face the target position, the node is facing minus z direction by default\n     * @zh 设置当前节点旋转为面向目标位置，默认前方为 -z 方向\n     * @param pos Target position\n     * @param up Up direction\n     */\n    public lookAt (pos: Readonly<Vec3>, up?: Readonly<Vec3>): void {\n        this.getWorldPosition(v3_a);\n        Vec3.subtract(v3_a, v3_a, pos);\n        Vec3.normalize(v3_a, v3_a);\n        Quat.fromViewUp(q_a, v3_a, up);\n        this.setWorldRotation(q_a);\n    }\n\n    /**\n     * @en Invalidate the world transform information\n     * for this node and all its children recursively\n     * @zh 递归标记节点世界变换为 dirty\n     * @param dirtyBit The dirty bits to setup to children, can be composed with multiple dirty bits\n     */\n    public invalidateChildren (dirtyBit: TransformBit) {\n        let i = 0;\n        let j = 0;\n        let l = 0;\n        let cur: this;\n        let children:this[];\n        let hasChangedFlags = 0;\n        const childDirtyBit = dirtyBit | TransformBit.POSITION;\n\n        dirtyNodes[0] = this;\n\n        while (i >= 0) {\n            cur = dirtyNodes[i--];\n            hasChangedFlags = cur.hasChangedFlags;\n            if (cur.isValid && (cur._dirtyFlags & hasChangedFlags & dirtyBit) !== dirtyBit) {\n                cur._dirtyFlags |= dirtyBit;\n\n                cur.hasChangedFlags = hasChangedFlags | dirtyBit;\n\n                children = cur._children;\n                l = children.length;\n                for (j = 0; j < l; j++) {\n                    dirtyNodes[++i] = children[j];\n                }\n            }\n            dirtyBit = childDirtyBit;\n        }\n    }\n\n    /**\n     * @en Update the world transform information if outdated\n     * @zh 更新节点的世界变换信息\n     */\n    public updateWorldTransform () {\n        if (!this._dirtyFlags) { return; }\n        // we need to recursively iterate this\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let cur: this | null = this;\n        let i = 0;\n        while (cur && cur._dirtyFlags) {\n            // top level node\n            dirtyNodes[i++] = cur;\n            cur = cur._parent;\n        }\n        let child: this; let dirtyBits = 0;\n\n        while (i) {\n            child = dirtyNodes[--i];\n            dirtyBits |= child._dirtyFlags;\n            if (cur) {\n                if (dirtyBits & TransformBit.POSITION) {\n                    Vec3.transformMat4(child._pos, child._lpos, cur._mat);\n                    child._mat.m12 = child._pos.x;\n                    child._mat.m13 = child._pos.y;\n                    child._mat.m14 = child._pos.z;\n                }\n                if (dirtyBits & TransformBit.RS) {\n                    Mat4.fromRTS(child._mat, child._lrot, child._lpos, child._lscale);\n                    Mat4.multiply(child._mat, cur._mat, child._mat);\n                    if (dirtyBits & TransformBit.ROTATION) {\n                        Quat.multiply(child._rot, cur._rot, child._lrot);\n                    }\n                    Mat3.fromQuat(m3_1, Quat.conjugate(qt_1, child._rot));\n                    Mat3.multiplyMat4(m3_1, m3_1, child._mat);\n                    child._scale.x = m3_1.m00;\n                    child._scale.y = m3_1.m04;\n                    child._scale.z = m3_1.m08;\n                }\n            } else {\n                if (dirtyBits & TransformBit.POSITION) {\n                    Vec3.copy(child._pos, child._lpos);\n                    child._mat.m12 = child._pos.x;\n                    child._mat.m13 = child._pos.y;\n                    child._mat.m14 = child._pos.z;\n                }\n                if (dirtyBits & TransformBit.RS) {\n                    if (dirtyBits & TransformBit.ROTATION) {\n                        Quat.copy(child._rot, child._lrot);\n                    }\n                    if (dirtyBits & TransformBit.SCALE) {\n                        Vec3.copy(child._scale, child._lscale);\n                        Mat4.fromRTS(child._mat, child._rot, child._pos, child._scale);\n                    }\n                }\n            }\n\n            child._dirtyFlags = TransformBit.NONE;\n            cur = child;\n        }\n    }\n\n    // ===============================\n    // transform\n    // ===============================\n\n    /**\n     * @en Set position in local coordinate system\n     * @zh 设置本地坐标\n     * @param position Target position\n     */\n    public setPosition (position: Readonly<Vec3>): void;\n\n    /**\n     * @en Set position in local coordinate system\n     * @zh 设置本地坐标\n     * @param x X axis position\n     * @param y Y axis position\n     * @param z Z axis position\n     */\n    public setPosition (x: number, y: number, z?: number): void;\n\n    public setPosition (val: Readonly<Vec3> | number, y?: number, z?: number): void {\n        if (y === undefined && z === undefined) {\n            Vec3.copy(this._lpos, val as Vec3);\n        } else if (z === undefined) {\n            Vec3.set(this._lpos, val as number, y!, this._lpos.z);\n        } else {\n            Vec3.set(this._lpos, val as number, y!, z);\n        }\n\n        this.invalidateChildren(TransformBit.POSITION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.POSITION);\n        }\n    }\n\n    /**\n     * @en Get position in local coordinate system, please try to pass `out` vector and reuse it to avoid garbage.\n     * @zh 获取本地坐标，注意，尽可能传递复用的 [[Vec3]] 以避免产生垃圾。\n     * @param out Set the result to out vector\n     * @return If `out` given, the return value equals to `out`, otherwise a new vector will be generated and return\n     */\n    public getPosition (out?: Vec3): Vec3 {\n        if (out) {\n            return Vec3.set(out, this._lpos.x, this._lpos.y, this._lpos.z);\n        }\n        return Vec3.copy(new Vec3(), this._lpos);\n    }\n\n    /**\n     * @en Set rotation in local coordinate system with a quaternion representing the rotation.\n     * Please make sure the rotation is normalized.\n     * @zh 用四元数设置本地旋转, 请确保设置的四元数已归一化。\n     * @param rotation Rotation in quaternion\n     */\n    public setRotation (rotation: Readonly<Quat>): void;\n\n    /**\n     * @en Set rotation in local coordinate system with a quaternion representing the rotation.\n     * Please make sure the rotation is normalized.\n     * @zh 用四元数设置本地旋转, 请确保设置的四元数已归一化。\n     * @param x X value in quaternion\n     * @param y Y value in quaternion\n     * @param z Z value in quaternion\n     * @param w W value in quaternion\n     */\n    public setRotation (x: number, y: number, z: number, w: number): void;\n\n    public setRotation (val: Readonly<Quat> | number, y?: number, z?: number, w?: number) {\n        if (y === undefined || z === undefined || w === undefined) {\n            Quat.copy(this._lrot, val as Readonly<Quat>);\n        } else {\n            Quat.set(this._lrot, val as number, y, z, w);\n        }\n        this._eulerDirty = true;\n\n        this.invalidateChildren(TransformBit.ROTATION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.ROTATION);\n        }\n    }\n\n    /**\n     * @en Set rotation in local coordinate system with a vector representing euler angles\n     * @zh 用欧拉角设置本地旋转\n     * @param rotation Rotation in vector\n     */\n    public setRotationFromEuler (rotation: Vec3): void;\n\n    /**\n     * @en Set rotation in local coordinate system with euler angles\n     * @zh 用欧拉角设置本地旋转\n     * @param x X axis rotation\n     * @param y Y axis rotation\n     * @param z Z axis rotation\n     */\n    public setRotationFromEuler (x: number, y: number, zOpt?: number): void;\n\n    public setRotationFromEuler (val: Vec3 | number, y?: number, zOpt?: number): void {\n        const z = zOpt === undefined ? this._euler.z : zOpt;\n\n        if (y === undefined) {\n            Vec3.copy(this._euler, val as Vec3);\n            Quat.fromEuler(this._lrot, (val as Vec3).x, (val as Vec3).y, (val as Vec3).z);\n        } else {\n            Vec3.set(this._euler, val as number, y, z);\n            Quat.fromEuler(this._lrot, val as number, y, z);\n        }\n\n        this._eulerDirty = false;\n\n        this.invalidateChildren(TransformBit.ROTATION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.ROTATION);\n        }\n    }\n\n    /**\n     * @en Get rotation as quaternion in local coordinate system, please try to pass `out` quaternion and reuse it to avoid garbage.\n     * @zh 获取本地旋转，注意，尽可能传递复用的 [[Quat]] 以避免产生垃圾。\n     * @param out Set the result to out quaternion\n     * @return If `out` given, the return value equals to `out`, otherwise a new quaternion will be generated and return\n     */\n    public getRotation (out?: Quat): Quat {\n        if (out) {\n            return Quat.set(out, this._lrot.x, this._lrot.y, this._lrot.z, this._lrot.w);\n        }\n        return Quat.copy(new Quat(), this._lrot);\n    }\n\n    /**\n     * @en Set scale in local coordinate system\n     * @zh 设置本地缩放\n     * @param scale Target scale\n     */\n    public setScale (scale: Readonly<Vec3>): void;\n\n    /**\n     * @en Set scale in local coordinate system\n     * @zh 设置本地缩放\n     * @param x X axis scale\n     * @param y Y axis scale\n     * @param z Z axis scale\n     */\n    public setScale (x: number, y: number, z?: number): void;\n\n    public setScale (val: Readonly<Vec3> | number, y?: number, z?: number) {\n        if (y === undefined && z === undefined) {\n            Vec3.copy(this._lscale, val as Vec3);\n        } else if (z === undefined) {\n            Vec3.set(this._lscale, val as number, y!, this._lscale.z);\n        } else {\n            Vec3.set(this._lscale, val as number, y!, z);\n        }\n\n        this.invalidateChildren(TransformBit.SCALE);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.SCALE);\n        }\n    }\n\n    /**\n     * @en Get scale in local coordinate system, please try to pass `out` vector and reuse it to avoid garbage.\n     * @zh 获取本地缩放，注意，尽可能传递复用的 [[Vec3]] 以避免产生垃圾。\n     * @param out Set the result to out vector\n     * @return If `out` given, the return value equals to `out`, otherwise a new vector will be generated and return\n     */\n    public getScale (out?: Vec3): Vec3 {\n        if (out) {\n            return Vec3.set(out, this._lscale.x, this._lscale.y, this._lscale.z);\n        }\n        return Vec3.copy(new Vec3(), this._lscale);\n    }\n\n    /**\n     * @en Inversely transform a point from world coordinate system to local coordinate system.\n     * @zh 逆向变换一个空间点，一般用于将世界坐标转换到本地坐标系中。\n     * @param out The result point in local coordinate system will be stored in this vector\n     * @param p A position in world coordinate system\n     */\n    public inverseTransformPoint (out: Vec3, p: Vec3) {\n        Vec3.copy(out, p);\n        // we need to recursively iterate this\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let cur = this;\n        let i = 0;\n        while (cur._parent) {\n            dirtyNodes[i++] = cur;\n            cur = cur._parent;\n        }\n        while (i >= 0) {\n            Vec3.transformInverseRTS(out, out, cur._lrot, cur._lpos, cur._lscale);\n            cur = dirtyNodes[--i];\n        }\n        return out;\n    }\n\n    /**\n     * @en Set position in world coordinate system\n     * @zh 设置世界坐标\n     * @param position Target position\n     */\n    public setWorldPosition (position: Vec3): void;\n\n    /**\n     * @en Set position in world coordinate system\n     * @zh 设置世界坐标\n     * @param x X axis position\n     * @param y Y axis position\n     * @param z Z axis position\n     */\n    public setWorldPosition (x: number, y: number, z: number): void;\n\n    public setWorldPosition (val: Vec3 | number, y?: number, z?: number) {\n        if (y === undefined || z === undefined) {\n            Vec3.copy(this._pos, val as Vec3);\n        } else {\n            Vec3.set(this._pos, val as number, y, z);\n        }\n        const parent = this._parent;\n        const local = this._lpos;\n        if (parent) {\n            // TODO: benchmark these approaches\n            /* */\n            parent.updateWorldTransform();\n            Vec3.transformMat4(local, this._pos, Mat4.invert(m4_1, parent._mat));\n            /* *\n            parent.inverseTransformPoint(local, this._pos);\n            /* */\n        } else {\n            Vec3.copy(local, this._pos);\n        }\n\n        this.invalidateChildren(TransformBit.POSITION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.POSITION);\n        }\n    }\n\n    /**\n     * @en Get position in world coordinate system, please try to pass `out` vector and reuse it to avoid garbage.\n     * @zh 获取世界坐标，注意，尽可能传递复用的 [[Vec3]] 以避免产生垃圾。\n     * @param out Set the result to out vector\n     * @return If `out` given, the return value equals to `out`, otherwise a new vector will be generated and return\n     */\n    public getWorldPosition (out?: Vec3): Vec3 {\n        this.updateWorldTransform();\n        if (out) {\n            return Vec3.copy(out, this._pos);\n        }\n        return Vec3.copy(new Vec3(), this._pos);\n    }\n\n    /**\n     * @en Set rotation in world coordinate system with a quaternion representing the rotation\n     * @zh 用四元数设置世界坐标系下的旋转\n     * @param rotation Rotation in quaternion\n     */\n    public setWorldRotation (rotation: Quat): void;\n\n    /**\n     * @en Set rotation in world coordinate system with a quaternion representing the rotation\n     * @zh 用四元数设置世界坐标系下的旋转\n     * @param x X value in quaternion\n     * @param y Y value in quaternion\n     * @param z Z value in quaternion\n     * @param w W value in quaternion\n     */\n    public setWorldRotation (x: number, y: number, z: number, w: number): void;\n\n    public setWorldRotation (val: Quat | number, y?: number, z?: number, w?: number) {\n        if (y === undefined || z === undefined || w === undefined) {\n            Quat.copy(this._rot, val as Quat);\n        } else {\n            Quat.set(this._rot, val as number, y, z, w);\n        }\n        if (this._parent) {\n            this._parent.updateWorldTransform();\n            Quat.multiply(this._lrot, Quat.conjugate(this._lrot, this._parent._rot), this._rot);\n        } else {\n            Quat.copy(this._lrot, this._rot);\n        }\n        this._eulerDirty = true;\n\n        this.invalidateChildren(TransformBit.ROTATION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.ROTATION);\n        }\n    }\n\n    /**\n     * @en Set rotation in world coordinate system with euler angles\n     * @zh 用欧拉角设置世界坐标系下的旋转\n     * @param x X axis rotation\n     * @param y Y axis rotation\n     * @param z Z axis rotation\n     */\n    public setWorldRotationFromEuler (x: number, y: number, z: number): void {\n        Quat.fromEuler(this._rot, x, y, z);\n        if (this._parent) {\n            this._parent.updateWorldTransform();\n            Quat.multiply(this._lrot, Quat.conjugate(this._lrot, this._parent._rot), this._rot);\n        } else {\n            Quat.copy(this._lrot, this._rot);\n        }\n        this._eulerDirty = true;\n\n        this.invalidateChildren(TransformBit.ROTATION);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.ROTATION);\n        }\n    }\n\n    /**\n     * @en Get rotation as quaternion in world coordinate system, please try to pass `out` quaternion and reuse it to avoid garbage.\n     * @zh 获取世界坐标系下的旋转，注意，尽可能传递复用的 [[Quat]] 以避免产生垃圾。\n     * @param out Set the result to out quaternion\n     * @return If `out` given, the return value equals to `out`, otherwise a new quaternion will be generated and return\n     */\n    public getWorldRotation (out?: Quat): Quat {\n        this.updateWorldTransform();\n        if (out) {\n            return Quat.copy(out, this._rot);\n        }\n        return Quat.copy(new Quat(), this._rot);\n    }\n\n    /**\n     * @en Set scale in world coordinate system\n     * @zh 设置世界坐标系下的缩放\n     * @param scale Target scale\n     */\n    public setWorldScale (scale: Vec3): void;\n\n    /**\n     * @en Set scale in world coordinate system\n     * @zh 设置世界坐标系下的缩放\n     * @param x X axis scale\n     * @param y Y axis scale\n     * @param z Z axis scale\n     */\n    public setWorldScale (x: number, y: number, z: number): void;\n\n    public setWorldScale (val: Vec3 | number, y?: number, z?: number) {\n        if (y === undefined || z === undefined) {\n            Vec3.copy(this._scale, val as Vec3);\n        } else {\n            Vec3.set(this._scale, val as number, y, z);\n        }\n        const parent = this._parent;\n        if (parent) {\n            parent.updateWorldTransform();\n            Mat3.fromQuat(m3_1, Quat.conjugate(qt_1, parent._rot));\n            Mat3.multiplyMat4(m3_1, m3_1, parent._mat);\n            m3_scaling.m00 = this._scale.x;\n            m3_scaling.m04 = this._scale.y;\n            m3_scaling.m08 = this._scale.z;\n            Mat3.multiply(m3_1, m3_scaling, Mat3.invert(m3_1, m3_1));\n            this._lscale.x = Vec3.set(v3_a, m3_1.m00, m3_1.m01, m3_1.m02).length();\n            this._lscale.y = Vec3.set(v3_a, m3_1.m03, m3_1.m04, m3_1.m05).length();\n            this._lscale.z = Vec3.set(v3_a, m3_1.m06, m3_1.m07, m3_1.m08).length();\n        } else {\n            Vec3.copy(this._lscale, this._scale);\n        }\n\n        this.invalidateChildren(TransformBit.SCALE);\n        if (this._eventMask & TRANSFORM_ON) {\n            this.emit(NodeEventType.TRANSFORM_CHANGED, TransformBit.SCALE);\n        }\n    }\n\n    /**\n     * @en Get scale in world coordinate system, please try to pass `out` vector and reuse it to avoid garbage.\n     * @zh 获取世界缩放，注意，尽可能传递复用的 [[Vec3]] 以避免产生垃圾。\n     * @param out Set the result to out vector\n     * @return If `out` given, the return value equals to `out`, otherwise a new vector will be generated and return\n     */\n    public getWorldScale (out?: Vec3): Vec3 {\n        this.updateWorldTransform();\n        if (out) {\n            return Vec3.copy(out, this._scale);\n        }\n        return Vec3.copy(new Vec3(), this._scale);\n    }\n\n    /**\n     * @en Get a world transform matrix\n     * @zh 获取世界变换矩阵\n     * @param out Set the result to out matrix\n     * @return If `out` given, the return value equals to `out`, otherwise a new matrix will be generated and return\n     */\n    public getWorldMatrix (out?: Mat4): Mat4 {\n        this.updateWorldTransform();\n        const target = out || new Mat4();\n        return Mat4.copy(target, this._mat);\n    }\n\n    /**\n     * @en Get a world transform matrix with only rotation and scale\n     * @zh 获取只包含旋转和缩放的世界变换矩阵\n     * @param out Set the result to out matrix\n     * @return If `out` given, the return value equals to `out`, otherwise a new matrix will be generated and return\n     */\n    public getWorldRS (out?: Mat4): Mat4 {\n        this.updateWorldTransform();\n        const target = out || new Mat4();\n        Mat4.copy(target, this._mat);\n        target.m12 = 0; target.m13 = 0; target.m14 = 0;\n        return target;\n    }\n\n    /**\n     * @en Get a world transform matrix with only rotation and translation\n     * @zh 获取只包含旋转和位移的世界变换矩阵\n     * @param out Set the result to out matrix\n     * @return If `out` given, the return value equals to `out`, otherwise a new matrix will be generated and return\n     */\n    public getWorldRT (out?: Mat4): Mat4 {\n        this.updateWorldTransform();\n        const target = out || new Mat4();\n        return Mat4.fromRT(target, this._rot, this._pos);\n    }\n\n    /**\n     * @en Set local transformation with rotation, position and scale separately.\n     * @zh 一次性设置所有局部变换（平移、旋转、缩放）信息\n     * @param rot The rotation\n     * @param pos The position\n     * @param scale The scale\n     */\n    public setRTS (rot?: Quat | Vec3, pos?: Vec3, scale?: Vec3) {\n        let dirtyBit: TransformBit = 0;\n        if (rot) {\n            dirtyBit |= TransformBit.ROTATION;\n            if ((rot as Quat).w !== undefined) {\n                Quat.copy(this._lrot, rot as Quat);\n                this._eulerDirty = true;\n            } else {\n                Vec3.copy(this._euler, rot);\n                Quat.fromEuler(this._lrot, rot.x, rot.y, rot.z);\n                this._eulerDirty = false;\n            }\n        }\n        if (pos) {\n            Vec3.copy(this._lpos, pos);\n            dirtyBit |= TransformBit.POSITION;\n        }\n        if (scale) {\n            Vec3.copy(this._lscale, scale);\n            dirtyBit |= TransformBit.SCALE;\n        }\n        if (dirtyBit) {\n            this.invalidateChildren(dirtyBit);\n            if (this._eventMask & TRANSFORM_ON) {\n                this.emit(NodeEventType.TRANSFORM_CHANGED, dirtyBit);\n            }\n        }\n    }\n\n    /**\n     * @en\n     * Pause all system events which is dispatched by [[SystemEvent]].\n     * If recursive is set to true, then this API will pause the node system events for the node and all nodes in its sub node tree.\n     * @zh\n     * 暂停所有 [[SystemEvent]] 派发的系统事件。\n     * 如果传递 recursive 为 true，那么这个 API 将暂停本节点和它的子树上所有节点的节点系统事件。\n     *\n     * @param recursive Whether pause system events recursively for the child node tree\n     */\n    public pauseSystemEvents (recursive: boolean): void {\n        this._eventProcessor.setEnabled(false, recursive);\n    }\n\n    /**\n     * @en\n     * Resume all paused system events which is dispatched by [[SystemEvent]].\n     * If recursive is set to true, then this API will resume the node system events for the node and all nodes in its sub node tree.\n     *\n     * @zh\n     * 恢复所有 [[SystemEvent]] 派发的系统事件。\n     * 如果传递 recursive 为 true，那么这个 API 将恢复本节点和它的子树上所有节点的节点系统事件。\n     *\n     * @param recursive Whether resume system events recursively for the child node tree\n     */\n    public resumeSystemEvents (recursive: boolean): void {\n        this._eventProcessor.setEnabled(true, recursive);\n    }\n\n    /**\n     * @en\n     * clear all node dirty state.\n     * @zh\n     * 清除所有节点的脏标记。\n     */\n    public static resetHasChangedFlags () {\n        globalFlagChangeVersion += 1;\n    }\n\n    /**\n     * @en\n     * clear node array\n     * @zh\n     * 清除节点数组\n     */\n    public static clearNodeArray () {\n        if (Node.ClearFrame < Node.ClearRound && !EDITOR) {\n            Node.ClearFrame++;\n        } else {\n            Node.ClearFrame = 0;\n            dirtyNodes.length = 0;\n        }\n    }\n\n    /**\n     * @en\n     * Get the complete path of the current node in the hierarchy.\n     *\n     * @zh\n     * 获得当前节点在 hierarchy 中的完整路径。\n     */\n    public getPathInHierarchy (): string {\n        let result = this.name;\n        let curNode: BaseNode | null = this.parent;\n        while (curNode && curNode instanceof Node) {\n            result = `${curNode.name}/${result}`;\n            curNode = curNode.parent;\n        }\n\n        return result;\n    }\n}\n\nlegacyCC.Node = Node;\n","import { CCClass } from '../data';\nimport { Node } from '../scene-graph/node';\nimport { EventHandler } from './component-event-handler';\n\nCCClass.Attr.setClassAttr(EventHandler, 'target', 'type', 'Object');\nCCClass.Attr.setClassAttr(EventHandler, 'target', 'ctor', Node);\n","/*\n Copyright (c) 2019-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ISchedulable } from '../scheduler';\nimport { Enum } from '../value-types/enum';\n\n/**\n * @en Base class for all functional system managed by [[Director]].\n * @zh 功能系统的基类，由 [[Director]] 管理。\n */\nexport default class System implements ISchedulable {\n    static Priority = Enum({\n        LOW: 0,\n        MEDIUM: 100,\n        HIGH: 200,\n        SCHEDULER: (1 << 31) >>> 0,\n    });\n\n    protected _id = '';\n    protected _priority = 0;\n    protected _executeInEditMode = false;\n\n    set priority (value:number) {\n        this._priority = value;\n    }\n    get priority ():number {\n        return this._priority;\n    }\n\n    set id (id:string) {\n        this._id = id;\n    }\n    get id ():string {\n        return this._id;\n    }\n\n    /**\n     * @en Sorting between different systems.\n     * @zh 不同系统间排序。\n     * @param a System a\n     * @param b System b\n     */\n    public static sortByPriority (a:System, b:System) {\n        if (a._priority < b._priority) {\n            return 1;\n        } else if (a._priority > b.priority) {\n            return -1;\n        } else {\n            return 0;\n        }\n    }\n\n    /**\n     * @en Init the system, will be invoked by [[Director]] when registered, should be implemented if needed.\n     * @zh 系统初始化函数，会在注册时被 [[Director]] 调用，如果需要的话应该由子类实现\n     */\n    init () {}\n    /**\n     * @en Update function of the system, it will be invoked between all components update phase and late update phase.\n     * @zh 系统的帧更新函数，它会在所有组件的 update 和 lateUpdate 之间被调用\n     * @param dt Delta time after the last frame\n     */\n    update (dt: number) {}\n    /**\n     * @en Post update function of the system, it will be invoked after all components late update phase and before the rendering process.\n     * @zh 系统的帧后处理函数，它会在所有组件的 lateUpdate 之后以及渲染之前被调用\n     * @param dt Delta time after the last frame\n     */\n    postUpdate (dt: number) {}\n\n    destroy () {}\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass } from 'cc.decorator';\nimport { EDITOR, TEST } from 'internal:constants';\nimport { clamp } from '../math/utils';\nimport { Texture, ColorAttachment, DepthStencilAttachment, GeneralBarrierInfo, AccessFlagBit, RenderPassInfo, Format, deviceManager } from '../gfx';\nimport { legacyCC } from '../global-exports';\nimport { RenderWindow, IRenderWindowInfo } from '../renderer/core/render-window';\nimport { Root } from '../root';\nimport { TextureBase } from './texture-base';\nimport { BufferTextureCopy } from '../gfx/base/define';\nimport { errorID } from '../platform/debug';\n\nexport interface IRenderTextureCreateInfo {\n    name?: string;\n    width: number;\n    height: number;\n    passInfo?: RenderPassInfo;\n}\n\nconst _colorAttachment = new ColorAttachment();\n_colorAttachment.format = Format.RGBA8;\nconst _depthStencilAttachment = new DepthStencilAttachment();\n_depthStencilAttachment.format = Format.DEPTH_STENCIL;\nconst passInfo = new RenderPassInfo([_colorAttachment], _depthStencilAttachment);\n\nconst _windowInfo: IRenderWindowInfo = {\n    width: 1,\n    height: 1,\n    renderPassInfo: passInfo,\n};\n\n/**\n * @en Render texture is a render target for [[Camera]] or [[Canvas]] component,\n * the render pipeline will use its `RenderWindow` as the target of the rendering process.\n * @zh 渲染贴图是 [[Camera]] 或 [[Canvas]] 组件的渲染目标对象，渲染管线会使用它的 `RenderWindow` 作为渲染的目标窗口。\n */\n@ccclass('cc.RenderTexture')\nexport class RenderTexture extends TextureBase {\n    private _window: RenderWindow | null = null;\n\n    /**\n     * @en The render window for the render pipeline, it's created internally and cannot be modified.\n     * @zh 渲染管线所使用的渲染窗口，内部逻辑创建，无法被修改。\n     */\n    get window () {\n        return this._window;\n    }\n\n    /**\n     * @en Initialize the render texture. Using IRenderTextureCreateInfo.\n     * @zh 初始化渲染贴图。设置渲染贴图的名称、尺寸、渲染通道信息。\n     * @param info @en The create info of render texture @zh 渲染贴图的创建信息\n     */\n    public initialize (info: IRenderTextureCreateInfo) {\n        this._name = info.name || '';\n        this._width = info.width;\n        this._height = info.height;\n        this._initWindow(info);\n    }\n\n    /**\n     * @en Reset the render texture. User may change the name, size or render pass info of the render texture.\n     * @zh 重新初始化渲染贴图。用户可以更改渲染贴图的名称、尺寸、渲染通道信息。\n     * @param info @en The create info of render texture @zh 渲染贴图的创建信息\n     */\n    public reset (info: IRenderTextureCreateInfo) { // to be consistent with other assets\n        this.initialize(info);\n    }\n\n    /**\n     * @en Destroy the render texture.\n     * @zh 销毁渲染贴图。\n     */\n    public destroy () {\n        if (this._window) {\n            const root = legacyCC.director.root as Root;\n            root?.destroyWindow(this._window);\n            this._window = null;\n        }\n\n        return super.destroy();\n    }\n\n    /**\n     * @en Resize the render texture\n     * @zh 修改渲染贴图的尺寸\n     * @param width The pixel width, the range is from 1 to 2048\n     * @param height The pixel height, the range is from 1 to 2048\n     */\n    public resize (width: number, height: number) {\n        this._width = Math.floor(clamp(width, 1, 2048));\n        this._height = Math.floor(clamp(height, 1, 2048));\n        if (this._window) {\n            this._window.resize(this._width, this._height);\n        }\n        this.emit('resize', this._window);\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _serialize (ctxForExporting: any): any {\n        if (EDITOR || TEST) {\n            return { base: super._serialize(ctxForExporting), w: this._width, h: this._height, n: this._name };\n        }\n        return {};\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _deserialize (serializedData: any, handle: any) {\n        const data = serializedData;\n        this._width = data.w;\n        this._height = data.h;\n        this._name = data.n;\n        super._deserialize(data.base, handle);\n    }\n\n    // To be compatible with material property interface\n    /**\n     * @en Gets the related [[gfx.Texture]] resource, it's also the color attachment for the render window\n     * @zh 获取渲染贴图的 GFX 资源，同时也是渲染窗口所指向的颜色缓冲贴图资源\n     */\n    public getGFXTexture (): Texture | null {\n        return this._window && this._window.framebuffer.colorTextures[0];\n    }\n\n    /**\n     * @en Callback function after render texture is loaded in [[CCLoader]]. Initialize the render texture.\n     * @zh 通过 [[CCLoader]] 加载完成时的回调，初始化渲染贴图。\n     */\n    public onLoaded () {\n        this._initWindow();\n    }\n\n    /**\n     * @en Implementation of the render texture initialization.\n     * @zh 初始化渲染贴图的具体实现。\n     * @param info @en The create info of render texture @zh 渲染贴图的创建信息\n     */\n    protected _initWindow (info?: IRenderTextureCreateInfo) {\n        const root = legacyCC.director.root as Root;\n\n        _windowInfo.title = this._name;\n        _windowInfo.width = this._width;\n        _windowInfo.height = this._height;\n        _windowInfo.renderPassInfo = info && info.passInfo ? info.passInfo : passInfo;\n\n        _colorAttachment.barrier = deviceManager.gfxDevice.getGeneralBarrier(new GeneralBarrierInfo(\n            AccessFlagBit.FRAGMENT_SHADER_READ_TEXTURE,\n            AccessFlagBit.FRAGMENT_SHADER_READ_TEXTURE,\n        ));\n\n        if (this._window) {\n            this._window.destroy();\n            this._window.initialize(deviceManager.gfxDevice, _windowInfo);\n        } else {\n            this._window = root.createWindow(_windowInfo);\n        }\n    }\n\n    /**\n     * @en Initialize the render texture with uuid. The default size is 1x1.\n     * @zh 初始化渲染贴图。使用uuid进行初始化，贴图的尺寸为 1x1。\n     * @param uuid @en asset uuid @zh 资源 uuid\n     */\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        this._width = this._height = 1;\n        this._initWindow();\n    }\n\n    /**\n     * @en Validate the correctness of the render texture.\n     * @zh 验证渲染贴图的正确性。\n     */\n    public validate () {\n        return this.width >= 1 && this.width <= 2048 && this.height >= 1 && this.height <= 2048;\n    }\n\n    /**\n     * @en Read pixel buffer from render texture @zh 从 render texture 读取像素数据\n     * @param x @en The location on x axis @zh 起始位置X轴坐标\n     * @param y @en The location on y axis @zh 起始位置Y轴坐标\n     * @param width @en The pixel width @zh 像素宽度\n     * @param height @en The pixel height @zh 像素高度\n     * @param buffer @en The buffer to hold pixel data @zh 像素缓存\n     */\n    public readPixels (x = 0, y = 0, width?: number, height?: number, buffer?: Uint8Array) : Uint8Array | null {\n        width = width || this.width;\n        height = height || this.height;\n        const gfxTexture = this.getGFXTexture();\n        if (!gfxTexture) {\n            errorID(7606);\n            return null;\n        }\n        const needSize = 4 * width * height;\n        if (buffer === undefined) {\n            buffer = new Uint8Array(needSize);\n        } else if (buffer.length < needSize) {\n            errorID(7607, needSize);\n            return null;\n        }\n\n        const gfxDevice = this._getGFXDevice();\n\n        const bufferViews: ArrayBufferView[] = [];\n        const regions: BufferTextureCopy[] = [];\n\n        const region0 = new BufferTextureCopy();\n        region0.texOffset.x = x;\n        region0.texOffset.y = y;\n        region0.texExtent.width = width;\n        region0.texExtent.height = height;\n        regions.push(region0);\n\n        bufferViews.push(buffer);\n        gfxDevice?.copyTextureToBuffers(gfxTexture, bufferViews, regions);\n        return buffer;\n    }\n}\n\nlegacyCC.RenderTexture = RenderTexture;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { EDITOR } from 'internal:constants';\nimport { Frustum, Ray } from '../../geometry';\nimport { SurfaceTransform, ClearFlagBit, Device, Color, ClearFlags } from '../../gfx';\nimport { lerp, Mat4, Rect, toRadian, Vec3, IVec4Like } from '../../math';\nimport { CAMERA_DEFAULT_MASK } from '../../pipeline/define';\nimport { Node } from '../../scene-graph';\nimport { RenderScene } from '../core/render-scene';\nimport { legacyCC } from '../../global-exports';\nimport { RenderWindow } from '../core/render-window';\nimport { preTransforms } from '../../math/mat4';\nimport { warnID } from '../../platform/debug';\nimport { GeometryRenderer } from '../../pipeline/geometry-renderer';\n\nexport enum CameraFOVAxis {\n    VERTICAL,\n    HORIZONTAL,\n}\n\nexport enum CameraProjection {\n    ORTHO,\n    PERSPECTIVE,\n}\n\nexport enum CameraAperture {\n    F1_8,\n    F2_0,\n    F2_2,\n    F2_5,\n    F2_8,\n    F3_2,\n    F3_5,\n    F4_0,\n    F4_5,\n    F5_0,\n    F5_6,\n    F6_3,\n    F7_1,\n    F8_0,\n    F9_0,\n    F10_0,\n    F11_0,\n    F13_0,\n    F14_0,\n    F16_0,\n    F18_0,\n    F20_0,\n    F22_0,\n}\n\nexport enum CameraISO {\n    ISO100,\n    ISO200,\n    ISO400,\n    ISO800,\n}\n\nexport enum CameraShutter {\n    D1,\n    D2,\n    D4,\n    D8,\n    D15,\n    D30,\n    D60,\n    D125,\n    D250,\n    D500,\n    D1000,\n    D2000,\n    D4000,\n}\n\nexport enum CameraType {\n    DEFAULT = -1,\n    LEFT_EYE = 0,\n    RIGHT_EYE = 1,\n    MAIN = 2,\n}\n\nexport enum TrackingType {\n    NO_TRACKING = 0,\n    POSITION_AND_ROTATION = 1,\n    POSITION = 2,\n    ROTATION = 3,\n}\n\nconst FSTOPS: number[] = [1.8, 2.0, 2.2, 2.5, 2.8, 3.2, 3.5, 4.0, 4.5, 5.0, 5.6, 6.3, 7.1, 8.0, 9.0, 10.0, 11.0, 13.0, 14.0, 16.0, 18.0, 20.0, 22.0];\nconst SHUTTERS: number[] = [1.0, 1.0 / 2.0, 1.0 / 4.0, 1.0 / 8.0, 1.0 / 15.0, 1.0 / 30.0, 1.0 / 60.0, 1.0 / 125.0,\n    1.0 / 250.0, 1.0 / 500.0, 1.0 / 1000.0, 1.0 / 2000.0, 1.0 / 4000.0];\nconst ISOS: number[] = [100.0, 200.0, 400.0, 800.0];\n\nexport interface ICameraInfo {\n    name: string;\n    node: Node;\n    projection: number;\n    targetDisplay?: number;\n    window?: RenderWindow | null;\n    priority: number;\n    pipeline?: string;\n    cameraType?: CameraType;\n    trackingType?: TrackingType;\n}\n\nconst v_a = new Vec3();\nconst v_b = new Vec3();\nconst _tempMat1 = new Mat4();\n\nexport const SKYBOX_FLAG = ClearFlagBit.STENCIL << 1;\n\nconst correctionMatrices: Mat4[] = [];\n\n/**\n * @en The render camera representation in the render scene, it's managed by [[Camera]]\n * @zh 渲染场景中的相机对象，由项目层的 [[Camera]] 管理。\n */\nexport class Camera {\n    /**\n     * @en This exposure value corresponding to default standard camera exposure parameters.\n     * @zh 默认相机的曝光值。\n     */\n    public static get standardExposureValue () {\n        return 1.0 / 38400.0;\n    }\n\n    /**\n     * @en The luminance unit scale used by area lights.\n     * @zh 默认局部光源使用的亮度单位缩放。\n     */\n    public static get standardLightMeterScale () {\n        return 10000.0;\n    }\n\n    /**\n     * @en The name of the camera\n     * @zh 相机的名称\n     */\n    get name () {\n        return this._name;\n    }\n\n    /**\n     * @en The render scene to which the camera is attached\n     * @zh 相机所挂载的场景\n     */\n    get scene () {\n        return this._scene;\n    }\n\n    /**\n     * @en The node of the camera which determines its transform in world space.\n     * @zh 相机绑定的节点，决定了它在世界空间的变换矩阵\n     */\n    set node (val: Node) {\n        this._node = val;\n    }\n    get node () {\n        return this._node!;\n    }\n\n    /**\n     * @en The render window of the camera\n     * @zh 相机关联的渲染窗口\n     */\n    set window (val) {\n        this._window = val;\n    }\n    get window () {\n        return this._window!;\n    }\n\n    /**\n     * @en Whether the camera is enabled, a disabled camera won't be processed in the render pipeline.\n     * @zh 相机是否启用，未启用的相机不会被渲染\n     */\n    set enabled (val) {\n        this._enabled = val;\n    }\n    get enabled () {\n        return this._enabled;\n    }\n\n    /**\n     * @en Visibility mask of the camera, declaring a set of node layers that will be visible to this camera.\n     * @zh 相机的可见性掩码，声明在当前相机中可见的节点层级集合。\n     */\n    set visibility (vis: number) {\n        this._visibility = vis;\n    }\n    get visibility (): number {\n        return this._visibility;\n    }\n\n    /**\n     * @en Render priority of the camera. Cameras with higher depth are rendered after cameras with lower depth.\n     * @zh 相机的渲染优先级，值越小越优先渲染。\n     */\n    get priority (): number {\n        return this._priority;\n    }\n\n    set priority (val: number) {\n        this._priority = val;\n    }\n\n    /**\n     * @en The width of the camera's view size\n     * @zh 相机的视图宽度\n     */\n    get width () {\n        return this._width;\n    }\n\n    /**\n     * @en The height of the camera's view size\n     * @zh 相机的视图高度\n     */\n    get height () {\n        return this._height;\n    }\n\n    /**\n     * @en The world position of the camera\n     * @zh 相机的世界坐标\n     */\n    set position (val) {\n        this._position = val;\n    }\n    get position () {\n        return this._position;\n    }\n\n    /**\n     * @en The forward vector of the camera's look direction\n     * @zh 指向相机观察方向的向量\n     */\n    set forward (val) {\n        this._forward = val;\n    }\n    get forward () {\n        return this._forward;\n    }\n\n    /**\n     * @en Camera aperture, controls the exposure parameter.\n     * @zh 相机光圈，影响相机的曝光参数。\n     */\n    set aperture (val: CameraAperture) {\n        this._aperture = val;\n        this._apertureValue = FSTOPS[this._aperture];\n        this.updateExposure();\n    }\n    get aperture (): CameraAperture {\n        return this._aperture;\n    }\n\n    /**\n     * @en Camera aperture value.\n     * @zh 相机光圈值。\n     */\n    get apertureValue (): number {\n        return this._apertureValue;\n    }\n\n    /**\n     * @en Camera shutter, controls the exposure parameter.\n     * @zh 相机快门，影响相机的曝光参数。\n     */\n    set shutter (val: CameraShutter) {\n        this._shutter = val;\n        this._shutterValue = SHUTTERS[this._shutter];\n        this.updateExposure();\n    }\n    get shutter (): CameraShutter {\n        return this._shutter;\n    }\n\n    /**\n     * @en Camera shutter value.\n     * @zh 相机快门值。\n     */\n    get shutterValue (): number {\n        return this._shutterValue;\n    }\n\n    /**\n     * @en Camera ISO, controls the exposure parameter.\n     * @zh 相机感光度，影响相机的曝光参数。\n     */\n    set iso (val: CameraISO) {\n        this._iso = val;\n        this._isoValue = ISOS[this._iso];\n        this.updateExposure();\n    }\n    get iso (): CameraISO {\n        return this._iso;\n    }\n\n    /**\n     * @en Camera ISO value.\n     * @zh 相机感光度值。\n     */\n    get isoValue (): number {\n        return this._isoValue;\n    }\n\n    /**\n     * @en The calculated exposure of the camera\n     * @zh 相机的曝光参数\n     */\n    get exposure (): number {\n        return this._exposure;\n    }\n\n    /**\n     * @en Clearing flags of the camera, specifies which part of the framebuffer will be actually cleared every frame.\n     * @zh 相机的缓冲清除标志位，指定帧缓冲的哪部分要每帧清除。\n     */\n    get clearFlag () : ClearFlags {\n        return this._clearFlag;\n    }\n    set clearFlag (flag: ClearFlags) {\n        this._clearFlag = flag;\n    }\n\n    /**\n     * @en Clearing color of the camera.\n     * @zh 相机的颜色缓冲默认值。\n     */\n    set clearColor (val) {\n        this._clearColor.x = val.x;\n        this._clearColor.y = val.y;\n        this._clearColor.z = val.z;\n        this._clearColor.w = val.w;\n    }\n    get clearColor () {\n        return this._clearColor as IVec4Like;\n    }\n\n    /**\n     * @en Clearing depth of the camera.\n     * @zh 相机的深度缓冲默认值。\n     */\n    get clearDepth () : number {\n        return this._clearDepth;\n    }\n    set clearDepth (depth: number) {\n        this._clearDepth = depth;\n    }\n\n    /**\n     * @en Clearing stencil of the camera.\n     * @zh 相机的模板缓冲默认值。\n     */\n    get clearStencil () : number {\n        return this._clearStencil;\n    }\n    set clearStencil (stencil: number) {\n        this._clearStencil = stencil;\n    }\n\n    /**\n     * @en The projection type of the camera.\n     * @zh 相机的投影类型。\n     */\n    set projectionType (val) {\n        this._proj = val;\n        this._isProjDirty = true;\n    }\n    get projectionType () {\n        return this._proj;\n    }\n\n    /**\n     * @en The aspect ratio of the camera\n     * @zh 相机视图的长宽比\n     */\n    get aspect () {\n        return this._aspect;\n    }\n\n    /**\n     * @en The viewport height of the orthogonal type camera.\n     * @zh 正交相机的视角高度。\n     */\n    set orthoHeight (val) {\n        this._orthoHeight = val;\n        this._isProjDirty = true;\n    }\n    get orthoHeight () {\n        return this._orthoHeight;\n    }\n\n    /**\n     * @en The axis on which the FOV would be fixed regardless of screen aspect changes.\n     * @zh 指定视角的固定轴向，在此轴上不会跟随屏幕长宽比例变化。\n     */\n    set fovAxis (axis) {\n        this._fovAxis = axis;\n        this._isProjDirty = true;\n    }\n    get fovAxis () {\n        return this._fovAxis;\n    }\n\n    /**\n     * @en Field of view of the camera.\n     * @zh 相机的视角大小。\n     */\n    set fov (fov) {\n        this._fov = fov;\n        this._isProjDirty = true;\n    }\n    get fov () {\n        return this._fov;\n    }\n\n    /**\n     * @en Near clipping distance of the camera, should be as large as possible within acceptable range.\n     * @zh 相机的近裁剪距离，应在可接受范围内尽量取最大。\n     */\n    set nearClip (nearClip) {\n        this._nearClip = nearClip;\n        this._isProjDirty = true;\n    }\n    get nearClip () {\n        return this._nearClip;\n    }\n\n    /**\n     * @en Far clipping distance of the camera, should be as small as possible within acceptable range.\n     * @zh 相机的远裁剪距离，应在可接受范围内尽量取最小。\n     */\n    set farClip (farClip) {\n        this._farClip = farClip;\n        this._isProjDirty = true;\n    }\n    get farClip () {\n        return this._farClip;\n    }\n\n    /**\n     * @en The viewport rect of the camera, pre-rotated (i.e. always in identity/portrait mode) if possible.\n     * @zh 相机的视口矩形，如果设备允许的话，这个视口会永远保持竖屏状态，由渲染流程保障旋转的正确。\n     */\n    get viewport () {\n        return this._viewport;\n    }\n    set viewport (val) {\n        warnID(8302);\n        this.setViewportInOrientedSpace(val);\n    }\n\n    /**\n     * @en The view frustum of the camera\n     * @zh 相机的视锥体\n     */\n    set frustum (val) {\n        this._frustum = val;\n    }\n    get frustum () {\n        return this._frustum;\n    }\n\n    /**\n     * @en The view matrix of the camera\n     * @zh 相机的视图矩阵\n     */\n    get matView () {\n        return this._matView;\n    }\n\n    /**\n     * @en The projection matrix of the camera\n     * @zh 相机的投影矩阵\n     */\n    get matProj () {\n        return this._matProj;\n    }\n\n    /**\n     * @en The inverse of the projection matrix of the camera\n     * @zh 相机的逆投影矩阵\n     */\n    get matProjInv () {\n        return this._matProjInv;\n    }\n\n    /**\n     * @en The view projection matrix of the camera\n     * @zh 相机的视图投影矩阵\n     */\n    get matViewProj () {\n        return this._matViewProj;\n    }\n\n    /**\n     * @en The inverse of the view projection matrix of the camera\n     * @zh 相机的逆视图投影矩阵\n     */\n    get matViewProjInv () {\n        return this._matViewProjInv;\n    }\n\n    /**\n     * @en Whether the camera is fixed size or matching the window size.\n     * @zh 相机是固定尺寸还是跟随屏幕尺寸\n     */\n    public isWindowSize = true;\n\n    /**\n     * @en Scale of the internal buffer size,\n     * set to 1 to keep the same with the canvas size.\n     * @zh 相机内部缓冲尺寸的缩放值, 1 为与 canvas 尺寸相同。\n     */\n    public screenScale: number;\n\n    private _device: Device;\n    private _scene: RenderScene | null = null;\n    private _node: Node | null = null;\n    private _name: string | null = null;\n    private _enabled = false;\n    private _proj: CameraProjection = -1;\n    private _aspect: number;\n    private _orthoHeight = 10.0;\n    private _fovAxis = CameraFOVAxis.VERTICAL;\n    private _fov: number = toRadian(45);\n    private _nearClip = 1.0;\n    private _farClip = 1000.0;\n    private _clearColor = new Color(0.2, 0.2, 0.2, 1);\n    private _viewport: Rect = new Rect(0, 0, 1, 1);\n    private _orientedViewport: Rect = new Rect(0, 0, 1, 1);\n    private _curTransform = SurfaceTransform.IDENTITY;\n    private _isProjDirty = true;\n    private _matView: Mat4 = new Mat4();\n    private _matProj: Mat4 = new Mat4();\n    private _matProjInv: Mat4 = new Mat4();\n    private _matViewProj: Mat4 = new Mat4();\n    private _matViewProjInv: Mat4 = new Mat4();\n    private _frustum: Frustum = new Frustum();\n    private _forward: Vec3 = new Vec3();\n    private _position: Vec3 = new Vec3();\n    private _priority = 0;\n    private _aperture: CameraAperture = CameraAperture.F16_0;\n    private _apertureValue: number;\n    private _shutter: CameraShutter = CameraShutter.D125;\n    private _shutterValue = 0.0;\n    private _iso: CameraISO = CameraISO.ISO100;\n    private _isoValue = 0.0;\n    private _window: RenderWindow | null = null;\n    private _width = 1;\n    private _height = 1;\n    private _clearFlag = ClearFlagBit.NONE;\n    private _clearDepth = 1.0;\n    private _visibility = CAMERA_DEFAULT_MASK;\n    private _exposure = 0;\n    private _clearStencil = 0;\n    private _geometryRenderer: GeometryRenderer | null = null;\n    private _cameraType: CameraType = CameraType.DEFAULT;\n    private _trackingType: TrackingType = TrackingType.NO_TRACKING;\n\n    constructor (device: Device) {\n        this._device = device;\n        this._apertureValue = FSTOPS[this._aperture];\n        this._shutterValue = SHUTTERS[this._shutter];\n        this._isoValue = ISOS[this._iso];\n\n        this._aspect = this.screenScale = 1;\n        this._frustum.accurate = true;\n\n        if (!correctionMatrices.length) {\n            const ySign = device.capabilities.clipSpaceSignY;\n            correctionMatrices[SurfaceTransform.IDENTITY] = new Mat4(1, 0, 0, 0, 0, ySign);\n            correctionMatrices[SurfaceTransform.ROTATE_90] = new Mat4(0, 1, 0, 0, -ySign, 0);\n            correctionMatrices[SurfaceTransform.ROTATE_180] = new Mat4(-1, 0, 0, 0, 0, -ySign);\n            correctionMatrices[SurfaceTransform.ROTATE_270] = new Mat4(0, -1, 0, 0, ySign, 0);\n        }\n    }\n\n    private _updateAspect (oriented = true) {\n        this._aspect = (this.window.width * this._viewport.width) / (this.window.height * this._viewport.height);\n        // window size/viewport is pre-rotated, but aspect should be oriented to acquire the correct projection\n        if (oriented) {\n            const swapchain = this.window.swapchain;\n            const orientation = swapchain && swapchain.surfaceTransform || SurfaceTransform.IDENTITY;\n            if (orientation % 2) this._aspect = 1 / this._aspect;\n        }\n        this._isProjDirty = true;\n    }\n\n    /**\n     * @en Initialize the camera, normally you shouldn't invoke this function, it's managed automatically.\n     * @zh 初始化相机，开发者通常不应该使用这个方法，初始化流程是自动管理的。\n     */\n    public initialize (info: ICameraInfo) {\n        if (info.trackingType !== undefined) {\n            this._trackingType = info.trackingType;\n        }\n        if (info.cameraType !== undefined) {\n            this._cameraType = info.cameraType;\n        }\n        this.node = info.node;\n        this._width = 1;\n        this._height = 1;\n        this.clearFlag = ClearFlagBit.NONE;\n        this.clearDepth = 1.0;\n        this.visibility = CAMERA_DEFAULT_MASK;\n        this._name = info.name;\n        this._proj = info.projection;\n        this._priority = info.priority || 0;\n        this._aspect = this.screenScale = 1;\n        this.updateExposure();\n        this.changeTargetWindow(info.window);\n    }\n\n    /**\n     * @en Destroy the camera, you shouldn't invoke this function, it's managed by the render scene.\n     * @zh 销毁相机，开发者不应该使用这个方法，销毁流程是由 RenderScene 管理的。\n     */\n    public destroy () {\n        this._node = null;\n        this.detachFromScene();\n        if (this._window) {\n            this._window.detachCamera(this);\n            this.window = null!;\n        }\n        this._name = null;\n        this._geometryRenderer?.destroy();\n    }\n\n    /**\n     * @en Attach the camera to the given render scene so that it will be rendered in it.\n     * @zh 将相机添加到相关的渲染场景中，以便可以被渲染器渲染。\n     * @param scene @en The render scene @zh 渲染场景\n     */\n    public attachToScene (scene: RenderScene) {\n        this._enabled = true;\n        this._scene = scene;\n    }\n\n    /**\n     * @en Detach the camera from previously attached render scene. It will no longer be rendered.\n     * @zh 将相机从之前设置的渲染场景移除，之后将不会再被渲染。\n     */\n    public detachFromScene () {\n        this._enabled = false;\n        this._scene = null;\n    }\n\n    /**\n     * @en Resize the view size of the camera.\n     * @zh 重置相机视图尺寸\n     * @param width The width of the view size\n     * @param height The height of the view size\n     */\n    public resize (width: number, height: number): void {\n        if (!this._window) return;\n\n        this._width = width;\n        this._width = width;\n        this._height = height;\n        this._aspect = (width * this._viewport.width) / (height * this._viewport.height);\n        this._isProjDirty = true;\n    }\n\n    /**\n     * @en Set a fixed size for the camera view.\n     * @zh 设置固定相机视图尺寸\n     * @param width The width of the view size\n     * @param height The height of the view size\n     */\n    public setFixedSize (width: number, height: number) {\n        this._width = width;\n        this._height = height;\n        this._updateAspect();\n        this.isWindowSize = false;\n    }\n\n    /**\n     * Editor specific gizmo camera logic\n     * @internal\n     */\n    public syncCameraEditor (camera) {\n        if (EDITOR) {\n            this.position = camera.position;\n            this.forward = camera.forward;\n            this._matView = camera.matView;\n            this._matProj = camera.matProj;\n            this._matProjInv = camera.matProjInv;\n            this._matViewProj = camera.matViewProj;\n        }\n    }\n\n    /**\n     * @en Update the camera's builtin matrixes\n     * @zh 更新相机的视图、投影等矩阵\n     * @param forceUpdate If force update, then dirty flag will be ignored\n     */\n    public update (forceUpdate = false): void { // for lazy eval situations like the in-editor preview\n        if (!this._node) return;\n\n        let viewProjDirty = false;\n        // view matrix\n        if (this._node.hasChangedFlags || forceUpdate) {\n            Mat4.invert(this._matView, this._node.worldMatrix);\n            this._forward.x = -this._matView.m02;\n            this._forward.y = -this._matView.m06;\n            this._forward.z = -this._matView.m10;\n            // Remove scale\n            Mat4.multiply(this._matView, new Mat4().scale(this._node.worldScale), this._matView);\n            this._node.getWorldPosition(this._position);\n            viewProjDirty = true;\n        }\n\n        // projection matrix\n        const swapchain = this.window?.swapchain;\n        const orientation = swapchain && swapchain.surfaceTransform || SurfaceTransform.IDENTITY;\n        if (this._isProjDirty || this._curTransform !== orientation) {\n            this._curTransform = orientation;\n            const projectionSignY = this._device.capabilities.clipSpaceSignY;\n            // Only for rendertexture processing\n            if (this._proj === CameraProjection.PERSPECTIVE) {\n                Mat4.perspective(this._matProj, this._fov, this._aspect, this._nearClip, this._farClip,\n                    this._fovAxis === CameraFOVAxis.VERTICAL, this._device.capabilities.clipSpaceMinZ, projectionSignY, orientation);\n            } else {\n                const x = this._orthoHeight * this._aspect;\n                const y = this._orthoHeight;\n                Mat4.ortho(this._matProj, -x, x, -y, y, this._nearClip, this._farClip,\n                    this._device.capabilities.clipSpaceMinZ, projectionSignY, orientation);\n            }\n            Mat4.invert(this._matProjInv, this._matProj);\n            viewProjDirty = true;\n            this._isProjDirty = false;\n        }\n\n        // view-projection\n        if (viewProjDirty) {\n            Mat4.multiply(this._matViewProj, this._matProj, this._matView);\n            Mat4.invert(this._matViewProjInv, this._matViewProj);\n            this._frustum.update(this._matViewProj, this._matViewProjInv);\n        }\n    }\n\n    get surfaceTransform () {\n        return this._curTransform;\n    }\n\n    /**\n     * @en Set the viewport in oriented space (equal to the actual screen rotation)\n     * @zh 在目标朝向空间（实际屏幕朝向）内设置相机视口\n     */\n    public setViewportInOrientedSpace (val: Rect) {\n        const { x, width, height } = val;\n        const y = this._device.capabilities.screenSpaceSignY < 0 ? 1 - val.y - height : val.y;\n\n        const swapchain = this.window?.swapchain;\n        const orientation = swapchain && swapchain.surfaceTransform || SurfaceTransform.IDENTITY;\n\n        switch (orientation) {\n        case SurfaceTransform.ROTATE_90:\n            this._viewport.x = 1 - y - height;\n            this._viewport.y = x;\n            this._viewport.width = height;\n            this._viewport.height = width;\n            break;\n        case SurfaceTransform.ROTATE_180:\n            this._viewport.x = 1 - x - width;\n            this._viewport.y = 1 - y - height;\n            this._viewport.width = width;\n            this._viewport.height = height;\n            break;\n        case SurfaceTransform.ROTATE_270:\n            this._viewport.x = y;\n            this._viewport.y = 1 - x - width;\n            this._viewport.width = height;\n            this._viewport.height = width;\n            break;\n        case SurfaceTransform.IDENTITY:\n            this._viewport.x = x;\n            this._viewport.y = y;\n            this._viewport.width = width;\n            this._viewport.height = height;\n            break;\n        default:\n        }\n\n        this._orientedViewport.x = x;\n        this._orientedViewport.y = y;\n        this._orientedViewport.width = width;\n        this._orientedViewport.height = height;\n\n        this.resize(this.width, this.height);\n    }\n\n    /**\n     * @en create geometry renderer for this camera\n     * @zh 创建这个摄像机的几何体渲染器\n     */\n    public initGeometryRenderer () {\n        if (!this._geometryRenderer) {\n            this._geometryRenderer = legacyCC.internal.GeometryRenderer ? new legacyCC.internal.GeometryRenderer() : null;\n            this._geometryRenderer?.activate(this._device);\n        }\n    }\n\n    /**\n     * @en get geometry renderer of this camera\n     * @zh 获取这个摄像机的几何体渲染器\n     * @returns @en return the geometry renderer @zh 返回几何体渲染器\n     */\n    get geometryRenderer () {\n        return this._geometryRenderer;\n    }\n\n    get cameraType () : CameraType {\n        return this._cameraType;\n    }\n\n    set cameraType (type: CameraType) {\n        this._cameraType = type;\n    }\n\n    get trackingType () : TrackingType {\n        return this._trackingType;\n    }\n\n    set trackingType (type: TrackingType) {\n        this._trackingType = type;\n    }\n\n    /**\n     * @en Change the target render window to another one\n     * @zh 修改相机的目标渲染窗口\n     * @param window The target render window, could be null\n     */\n    public changeTargetWindow (window: RenderWindow | null = null) {\n        if (this._window) {\n            this._window.detachCamera(this);\n        }\n        const win = window || legacyCC.director.root.mainWindow;\n        if (win) {\n            win.attachCamera(this);\n            this.window = win;\n\n            // window size is pre-rotated\n            const swapchain = win.swapchain;\n            const orientation = swapchain && swapchain.surfaceTransform || SurfaceTransform.IDENTITY;\n            if (orientation % 2) this.resize(win.height, win.width);\n            else this.resize(win.width, win.height);\n        }\n    }\n\n    /**\n     * @en Detach camera from the render window\n     * @zh 将 camera 从渲染窗口移除\n     */\n    public detachCamera () {\n        if (this._window) {\n            this._window.detachCamera(this);\n        }\n    }\n\n    /**\n     * @en Transform a screen position (in oriented space) to a world space ray\n     * @zh 将一个屏幕空间（在实际朝向下）点转换到世界空间的射线\n     * @param out the resulting ray\n     * @param x the screen x of the position\n     * @param y the screen y of the position\n     * @returns the resulting ray\n     */\n    public screenPointToRay (out: Ray, x: number, y: number): Ray {\n        if (!this._node) return null!;\n\n        const width = this.width;\n        const height = this.height;\n        const cx = this._orientedViewport.x * width;\n        const cy = this._orientedViewport.y * height;\n        const cw = this._orientedViewport.width * width;\n        const ch = this._orientedViewport.height * height;\n        const isProj = this._proj === CameraProjection.PERSPECTIVE;\n        const ySign = this._device.capabilities.clipSpaceSignY;\n        const preTransform = preTransforms[this._curTransform];\n\n        Vec3.set(v_a, (x - cx) / cw * 2 - 1, (y - cy) / ch * 2 - 1, isProj ? 1 : -1);\n\n        const { x: ox, y: oy } = v_a;\n        v_a.x = ox * preTransform[0] + oy * preTransform[2] * ySign;\n        v_a.y = ox * preTransform[1] + oy * preTransform[3] * ySign;\n\n        Vec3.transformMat4(isProj ? v_a : out.o, v_a, this._matViewProjInv);\n\n        if (isProj) {\n            // camera origin\n            this._node.getWorldPosition(v_b);\n            Ray.fromPoints(out, v_b, v_a);\n        } else {\n            Vec3.transformQuat(out.d, Vec3.FORWARD, this._node.worldRotation);\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Transform a screen position (in oriented space) to world space\n     * @zh 将一个屏幕空间（在实际朝向下）位置转换到世界空间\n     * @param out the resulting vector\n     * @param screenPos the screen position to be transformed\n     * @returns the resulting vector\n     */\n    public screenToWorld (out: Vec3, screenPos: Vec3): Vec3 {\n        const width = this.width;\n        const height = this.height;\n        const cx = this._orientedViewport.x * width;\n        const cy = this._orientedViewport.y * height;\n        const cw = this._orientedViewport.width * width;\n        const ch = this._orientedViewport.height * height;\n        const ySign = this._device.capabilities.clipSpaceSignY;\n        const preTransform = preTransforms[this._curTransform];\n\n        if (this._proj === CameraProjection.PERSPECTIVE) {\n            // calculate screen pos in far clip plane\n            Vec3.set(out,\n                (screenPos.x - cx) / cw * 2 - 1,\n                (screenPos.y - cy) / ch * 2 - 1,\n                1.0);\n\n            // transform to world\n            const { x, y } = out;\n            out.x = x * preTransform[0] + y * preTransform[2] * ySign;\n            out.y = x * preTransform[1] + y * preTransform[3] * ySign;\n            Vec3.transformMat4(out, out, this._matViewProjInv);\n\n            // lerp to depth z\n            if (this._node) { this._node.getWorldPosition(v_a); }\n\n            Vec3.lerp(out, v_a, out, lerp(this._nearClip / this._farClip, 1, screenPos.z));\n        } else {\n            Vec3.set(out,\n                (screenPos.x - cx) / cw * 2 - 1,\n                (screenPos.y - cy) / ch * 2 - 1,\n                screenPos.z * 2 - 1);\n\n            // transform to world\n            const { x, y } = out;\n            out.x = x * preTransform[0] + y * preTransform[2] * ySign;\n            out.y = x * preTransform[1] + y * preTransform[3] * ySign;\n            Vec3.transformMat4(out, out, this._matViewProjInv);\n        }\n\n        return out;\n    }\n\n    /**\n     * @en Transform a world space position to screen space rendered by the camera\n     * @zh 将一个世界空间位置转换到相机渲染后的屏幕空间\n     * @param out the resulting vector\n     * @param worldPos the world position to be transformed\n     * @returns the resulting vector\n     */\n    public worldToScreen (out: Vec3, worldPos: Vec3 | Readonly<Vec3>): Vec3 {\n        const ySign = this._device.capabilities.clipSpaceSignY;\n        const preTransform = preTransforms[this._curTransform];\n\n        Vec3.transformMat4(out, worldPos, this._matViewProj);\n\n        const { x, y } = out;\n        out.x = x * preTransform[0] + y * preTransform[2] * ySign;\n        out.y = x * preTransform[1] + y * preTransform[3] * ySign;\n\n        const width = this.width;\n        const height = this.height;\n        const cx = this._orientedViewport.x * width;\n        const cy = this._orientedViewport.y * height;\n        const cw = this._orientedViewport.width * width;\n        const ch = this._orientedViewport.height * height;\n\n        out.x = cx + (out.x + 1) * 0.5 * cw;\n        out.y = cy + (out.y + 1) * 0.5 * ch;\n        out.z = out.z * 0.5 + 0.5;\n\n        return out;\n    }\n\n    /**\n     * @en Transform a world space matrix to screen space rendered by the camera\n     * @zh 将一个世界空间矩阵转换到相机渲染后的屏幕空间\n     * @param out the resulting matrix\n     * @param worldMatrix the world space matrix to be transformed\n     * @param width framebuffer width\n     * @param height framebuffer height\n     * @returns the resulting matrix\n     */\n    public worldMatrixToScreen (out: Mat4, worldMatrix: Mat4, width: number, height: number) {\n        Mat4.multiply(out, this._matViewProj, worldMatrix);\n        Mat4.multiply(out, correctionMatrices[this._curTransform], out);\n\n        const halfWidth = width / 2;\n        const halfHeight = height / 2;\n        Mat4.identity(_tempMat1);\n        Mat4.transform(_tempMat1, _tempMat1, Vec3.set(v_a, halfWidth, halfHeight, 0));\n        Mat4.scale(_tempMat1, _tempMat1, Vec3.set(v_a, halfWidth, halfHeight, 1));\n\n        Mat4.multiply(out, _tempMat1, out);\n\n        return out;\n    }\n\n    /**\n     * @en Set exposure with actual value.\n     * @zh 设置相机的曝光值\n     * @param ev100\n     */\n    protected setExposure (ev100) {\n        this._exposure = 0.833333 / (2.0 ** ev100);\n    }\n\n    private updateExposure () {\n        const ev100 = Math.log2((this._apertureValue * this._apertureValue) / this._shutterValue * 100.0 / this._isoValue);\n        this.setExposure(ev100);\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR } from 'internal:constants';\nimport { ccclass, help, executeInEditMode, menu, tooltip, displayOrder, type, serializable, visible } from 'cc.decorator';\nimport { RenderTexture } from '../assets/render-texture';\nimport { UITransform } from '../../2d/framework';\nimport { Component } from './component';\nimport { Ray } from '../geometry';\nimport { Color, Rect, toRadian, Vec3 } from '../math';\nimport { CAMERA_DEFAULT_MASK } from '../pipeline/define';\nimport { scene } from '../renderer';\nimport { SKYBOX_FLAG, CameraProjection, CameraFOVAxis, CameraAperture, CameraISO, CameraShutter,\n    CameraType, TrackingType } from '../renderer/scene/camera';\nimport { Root } from '../root';\nimport { Node } from '../scene-graph/node';\nimport { Layers } from '../scene-graph/layers';\nimport { ccenum, Enum } from '../value-types';\nimport { TransformBit } from '../scene-graph/node-enum';\nimport { legacyCC } from '../global-exports';\nimport { RenderWindow } from '../renderer/core/render-window';\nimport { ClearFlagBit } from '../gfx';\n\nconst _temp_vec3_1 = new Vec3();\n\n/**\n * @en The projection type.\n * @zh 投影类型。\n */\nconst ProjectionType = Enum(CameraProjection);\nconst FOVAxis = Enum(CameraFOVAxis);\nconst Aperture = Enum(CameraAperture);\nconst Shutter = Enum(CameraShutter);\nconst ISO = Enum(CameraISO);\n\nexport const ClearFlag = Enum({\n    SKYBOX: SKYBOX_FLAG | ClearFlagBit.DEPTH_STENCIL,\n    SOLID_COLOR: ClearFlagBit.ALL,\n    DEPTH_ONLY: ClearFlagBit.DEPTH_STENCIL,\n    DONT_CLEAR: ClearFlagBit.NONE,\n});\n\nexport declare namespace Camera {\n    export type ProjectionType = EnumAlias<typeof ProjectionType>;\n    export type FOVAxis = EnumAlias<typeof FOVAxis>;\n    export type ClearFlag = EnumAlias<typeof ClearFlag>;\n    export type Aperture = EnumAlias<typeof Aperture>;\n    export type Shutter = EnumAlias<typeof Shutter>;\n    export type ISO = EnumAlias<typeof ISO>;\n}\n\n/**\n * @en The Camera Component.\n * @zh 相机组件。\n */\n@ccclass('cc.Camera')\n@help('i18n:cc.Camera')\n@menu('Rendering/Camera')\n@executeInEditMode\nexport class Camera extends Component {\n    /**\n     * @en The projection type enumeration of the camera.\n     * @zh 相机的投影类型枚举。\n     */\n    public static ProjectionType = ProjectionType;\n    /**\n     * @en The axis type of the fov\n     * @zh FOV 的轴向枚举\n     */\n    public static FOVAxis = FOVAxis;\n    /**\n     * @en The clear flag enumeration of the camera.\n     * @zh 相机的清除标志位枚举。\n     */\n    public static ClearFlag = ClearFlag;\n    /**\n     * @en The aperture value's enumeration of the camera.\n     * @zh 相机的光圈值枚举。\n     */\n    public static Aperture = Aperture;\n    /**\n     * @en The shutter value's enumeration of the camera.\n     * @zh 相机的快门值枚举。\n     */\n    public static Shutter = Shutter;\n    /**\n     * @en The ISO value's enumeration of the camera.\n     * @zh 相机的感光度值枚举。\n     */\n    public static ISO = ISO;\n    /**\n     * @en The event for target texture changing.\n     * @zh 目标贴图修改的事件。\n     */\n    public static TARGET_TEXTURE_CHANGE = 'tex-change';\n\n    @serializable\n    protected _projection = ProjectionType.PERSPECTIVE;\n    @serializable\n    protected _priority = 0;\n    @serializable\n    protected _fov = 45;\n    @serializable\n    protected _fovAxis = FOVAxis.VERTICAL;\n    @serializable\n    protected _orthoHeight = 10;\n    @serializable\n    protected _near = 1;\n    @serializable\n    protected _far = 1000;\n    @serializable\n    protected _color = new Color('#333333');\n    @serializable\n    protected _depth = 1;\n    @serializable\n    protected _stencil = 0;\n    @serializable\n    protected _clearFlags = ClearFlag.SOLID_COLOR;\n    @serializable\n    protected _rect = new Rect(0, 0, 1, 1);\n    @serializable\n    protected _aperture = Aperture.F16_0;\n    @serializable\n    protected _shutter = Shutter.D125;\n    @serializable\n    protected _iso = ISO.ISO100;\n    @serializable\n    protected _screenScale = 1;\n    @serializable\n    protected _visibility = CAMERA_DEFAULT_MASK;\n    @serializable\n    protected _targetTexture: RenderTexture | null = null;\n\n    protected _camera: scene.Camera | null = null;\n    protected _inEditorMode = false;\n    protected _flows: string[] | undefined = undefined;\n    @serializable\n    protected _cameraType: CameraType = CameraType.DEFAULT;\n    @serializable\n    protected _trackingType: TrackingType = TrackingType.NO_TRACKING;\n\n    /**\n     * @en The render camera representation.\n     * @zh 渲染场景中的相机对象。\n     */\n    get camera () {\n        return this._camera!;\n    }\n\n    /**\n     * @en Render priority of the camera. Cameras with higher depth are rendered after cameras with lower depth.\n     * @zh 相机的渲染优先级，值越小越优先渲染。\n     */\n    @displayOrder(0)\n    @tooltip('i18n:camera.priority')\n    get priority () {\n        return this._priority;\n    }\n\n    set priority (val) {\n        this._priority = val;\n        if (this._camera) {\n            this._camera.priority = val;\n        }\n    }\n\n    /**\n     * @en Visibility mask, declaring a set of node layers that will be visible to this camera.\n     * @zh 可见性掩码，声明在当前相机中可见的节点层级集合。\n     */\n    @type(Layers.BitMask)\n    @displayOrder(1)\n    @tooltip('i18n:camera.visibility')\n    get visibility () {\n        return this._visibility;\n    }\n\n    set visibility (val) {\n        this._visibility = val;\n        if (this._camera) {\n            this._camera.visibility = val;\n        }\n    }\n\n    /**\n     * @en Clearing flags of the camera, specifies which part of the framebuffer will be actually cleared every frame.\n     * @zh 相机的缓冲清除标志位，指定帧缓冲的哪部分要每帧清除。\n     */\n    @type(ClearFlag)\n    @displayOrder(2)\n    @tooltip('i18n:camera.clear_flags')\n    get clearFlags () {\n        return this._clearFlags;\n    }\n\n    set clearFlags (val) {\n        this._clearFlags = val;\n        if (this._camera) { this._camera.clearFlag = val; }\n    }\n\n    /**\n     * @en Clearing color of the camera.\n     * @zh 相机的颜色缓冲默认值。\n     */\n    @displayOrder(3)\n    @tooltip('i18n:camera.color')\n    // @constget\n    get clearColor (): Readonly<Color> {\n        return this._color;\n    }\n\n    set clearColor (val) {\n        this._color.set(val);\n        if (this._camera) {\n            this._camera.clearColor = this._color;\n        }\n    }\n\n    /**\n     * @en Clearing depth of the camera.\n     * @zh 相机的深度缓冲默认值。\n     */\n    @displayOrder(4)\n    @tooltip('i18n:camera.depth')\n    get clearDepth () {\n        return this._depth;\n    }\n\n    set clearDepth (val) {\n        this._depth = val;\n        if (this._camera) { this._camera.clearDepth = val; }\n    }\n\n    /**\n     * @en Clearing stencil of the camera.\n     * @zh 相机的模板缓冲默认值。\n     */\n    @displayOrder(5)\n    @tooltip('i18n:camera.stencil')\n    get clearStencil () {\n        return this._stencil;\n    }\n\n    set clearStencil (val) {\n        this._stencil = val;\n        if (this._camera) { this._camera.clearStencil = val; }\n    }\n\n    /**\n     * @en Projection type of the camera.\n     * @zh 相机的投影类型。\n     */\n    @type(ProjectionType)\n    @displayOrder(6)\n    @tooltip('i18n:camera.projection')\n    get projection () {\n        return this._projection;\n    }\n\n    set projection (val) {\n        this._projection = val;\n        if (this._camera) { this._camera.projectionType = val; }\n    }\n\n    /**\n     * @en The axis on which the FOV would be fixed regardless of screen aspect changes.\n     * @zh 指定视角的固定轴向，在此轴上不会跟随屏幕长宽比例变化。\n     */\n    @type(FOVAxis)\n    @displayOrder(7)\n    @visible(function (this: Camera) {\n        return this._projection === ProjectionType.PERSPECTIVE;\n    })\n    @tooltip('i18n:camera.fov_axis')\n    get fovAxis () {\n        return this._fovAxis;\n    }\n\n    set fovAxis (val) {\n        if (val === this._fovAxis) { return; }\n        this._fovAxis = val;\n        if (this._camera) {\n            this._camera.fovAxis = val;\n            if (val === CameraFOVAxis.VERTICAL) { this.fov = this._fov * this._camera.aspect; } else { this.fov = this._fov / this._camera.aspect; }\n        }\n    }\n\n    /**\n     * @en Field of view of the camera.\n     * @zh 相机的视角大小。\n     */\n    @displayOrder(8)\n    @visible(function (this: Camera) {\n        return this._projection === ProjectionType.PERSPECTIVE;\n    })\n    @tooltip('i18n:camera.fov')\n    get fov () {\n        return this._fov;\n    }\n\n    set fov (val) {\n        this._fov = val;\n        if (this._camera) { this._camera.fov = toRadian(val); }\n    }\n\n    /**\n     * @en Viewport height in orthographic mode.\n     * @zh 正交模式下的相机视角高度。\n     */\n    @displayOrder(9)\n    @visible(function (this: Camera) {\n        return this._projection === ProjectionType.ORTHO;\n    })\n    @tooltip('i18n:camera.ortho_height')\n    get orthoHeight () {\n        return this._orthoHeight;\n    }\n\n    set orthoHeight (val) {\n        this._orthoHeight = val;\n        if (this._camera) { this._camera.orthoHeight = val; }\n    }\n\n    /**\n     * @en Near clipping distance of the camera, should be as large as possible within acceptable range.\n     * @zh 相机的近裁剪距离，应在可接受范围内尽量取最大。\n     */\n    @displayOrder(10)\n    @tooltip('i18n:camera.near')\n    get near () {\n        return this._near;\n    }\n\n    set near (val) {\n        this._near = val;\n        if (this._camera) { this._camera.nearClip = val; }\n    }\n\n    /**\n     * @en Far clipping distance of the camera, should be as small as possible within acceptable range.\n     * @zh 相机的远裁剪距离，应在可接受范围内尽量取最小。\n     */\n    @displayOrder(11)\n    @tooltip('i18n:camera.far')\n    get far () {\n        return this._far;\n    }\n\n    set far (val) {\n        this._far = val;\n        if (this._camera) { this._camera.farClip = val; }\n    }\n\n    /**\n     * @en Camera aperture, controls the exposure parameter.\n     * @zh 相机光圈，影响相机的曝光参数。\n     */\n    @type(Aperture)\n    @displayOrder(12)\n    @tooltip('i18n:camera.aperture')\n    get aperture () {\n        return this._aperture;\n    }\n\n    set aperture (val) {\n        this._aperture = val;\n        if (this._camera) { this._camera.aperture = val; }\n    }\n\n    /**\n     * @en Camera shutter, controls the exposure parameter.\n     * @zh 相机快门，影响相机的曝光参数。\n     */\n    @type(Shutter)\n    @displayOrder(13)\n    @tooltip('i18n:camera.shutter')\n    get shutter () {\n        return this._shutter;\n    }\n\n    set shutter (val) {\n        this._shutter = val;\n        if (this._camera) { this._camera.shutter = val; }\n    }\n\n    /**\n     * @en Camera ISO, controls the exposure parameter.\n     * @zh 相机感光度，影响相机的曝光参数。\n     */\n    @type(ISO)\n    @displayOrder(14)\n    @tooltip('i18n:camera.ISO')\n    get iso () {\n        return this._iso;\n    }\n\n    set iso (val) {\n        this._iso = val;\n        if (this._camera) { this._camera.iso = val; }\n    }\n\n    /**\n     * @en Screen viewport of the camera wrt. the sceen size.\n     * @zh 此相机最终渲染到屏幕上的视口位置和大小。\n     */\n    @displayOrder(15)\n    @tooltip('i18n:camera.rect')\n    get rect () {\n        return this._rect;\n    }\n\n    set rect (val) {\n        this._rect = val;\n        if (this._camera) { this._camera.setViewportInOrientedSpace(val); }\n    }\n\n    /**\n     * @en Output render texture of the camera. Default to null, which outputs directly to screen.\n     * @zh 指定此相机的渲染输出目标贴图，默认为空，直接渲染到屏幕。\n     */\n    @type(RenderTexture)\n    @displayOrder(16)\n    @tooltip('i18n:camera.target_texture')\n    get targetTexture () {\n        return this._targetTexture;\n    }\n\n    set targetTexture (value) {\n        if (this._targetTexture === value) {\n            return;\n        }\n\n        const old = this._targetTexture;\n        this._targetTexture = value;\n        this._checkTargetTextureEvent(old);\n        this._updateTargetTexture();\n\n        if (!value && this._camera) {\n            this._camera.changeTargetWindow(EDITOR ? legacyCC.director.root.tempWindow : null);\n            this._camera.isWindowSize = true;\n        }\n        this.node.emit(Camera.TARGET_TEXTURE_CHANGE, this);\n    }\n\n    /**\n     * @en Scale of the internal buffer size,\n     * set to 1 to keep the same with the canvas size.\n     * @zh 相机内部缓冲尺寸的缩放值, 1 为与 canvas 尺寸相同。\n     */\n    get screenScale () {\n        return this._screenScale;\n    }\n\n    set screenScale (val) {\n        this._screenScale = val;\n        if (this._camera) { this._camera.screenScale = val; }\n    }\n\n    /**\n     * @internal\n     */\n    get inEditorMode () {\n        return this._inEditorMode;\n    }\n\n    set inEditorMode (value) {\n        this._inEditorMode = value;\n        if (this._camera) {\n            this._camera.changeTargetWindow(value ? legacyCC.director.root && legacyCC.director.root.mainWindow\n                : legacyCC.director.root && legacyCC.director.root.tempWindow);\n        }\n    }\n\n    get cameraType () {\n        return this._cameraType;\n    }\n\n    set cameraType (val) {\n        if (this._cameraType === val) {\n            return;\n        }\n        this._cameraType = val;\n        if (this.camera) {\n            this.camera.cameraType = val;\n        }\n    }\n\n    get trackingType () {\n        return this._trackingType;\n    }\n\n    set trackingType (val) {\n        if (this._trackingType === val) {\n            return;\n        }\n        this._trackingType = val;\n        if (this.camera) {\n            this.camera.trackingType = val;\n        }\n    }\n\n    public onLoad () {\n         this._createCamera();\n    }\n\n    public onEnable () {\n        this.node.hasChangedFlags |= TransformBit.POSITION; // trigger camera matrix update\n        if (this._camera) {\n            this._attachToScene();\n        }\n    }\n\n    public onDisable () {\n        if (this._camera) {\n            this._detachFromScene();\n        }\n    }\n\n    public onDestroy () {\n        if (this._camera) {\n            this._camera.destroy();\n            this._camera = null;\n        }\n\n        if (this._targetTexture) {\n            this._targetTexture.off('resize');\n        }\n    }\n\n    /**\n     * @en Convert a screen space (left-top origin) point to a ray.\n     * @zh 将一个屏幕空间（左上角为原点）坐标转换为射线。\n     * @param x The x axis position on screen.\n     * @param y The y axis position on screen.\n     * @param out The output ray object.\n     * @returns Return the output ray object.\n     */\n    public screenPointToRay (x: number, y: number, out?: Ray) {\n        if (!out) { out = Ray.create(); }\n        if (this._camera) { this._camera.screenPointToRay(out, x, y); }\n        return out;\n    }\n\n    /**\n     * @en Convert a world position to a screen space (left-top origin) position.\n     * @zh 将一个世界空间坐标转换为屏幕空间（左上角为原点）坐标。\n     * @param worldPos The position in world space coordinates\n     * @param out The output position in screen space coordinates.\n     * @returns Return the output position object.\n     */\n    public worldToScreen (worldPos: Vec3 | Readonly<Vec3>, out?: Vec3) {\n        if (!out) { out = new Vec3(); }\n        if (this._camera) { this._camera.worldToScreen(out, worldPos); }\n        return out;\n    }\n\n    /**\n     * @en Convert a screen space (left-top origin) position to a world space position.\n     * @zh 将一个屏幕空间（左上角为原点）转换为世界空间坐标。\n     * @param screenPos The position in screen space coordinates\n     * @param out The output position in world space coordinates\n     * @returns Return the output position object.\n     */\n    public screenToWorld (screenPos: Vec3, out?: Vec3) {\n        if (!out) { out = this.node.getWorldPosition(); }\n        if (this._camera) { this._camera.screenToWorld(out, screenPos); }\n        return out;\n    }\n\n    /**\n     * @en Convert a 3D world position to the local coordinates system of the given UI node.\n     * The converted position will be related to the given UI node under local space.\n     * @zh 将一个 3D 空间世界坐标转换到指定的 UI 本地节点坐标系下。转换后的位置是指定 UI 节点坐标系下的局部偏移。\n     * @param wpos @en The world position to convert @zh 需要转换的世界坐标\n     * @param uiNode @en The UI node coordinates in which the world position will be convert to @zh 用于同步位置的 UI 节点\n     * @param out @en Return the corresponding position of the given world position in the UI node's local coordinates @zh 返回传入的世界坐标在 UI 节点本地坐标系下的局部坐标\n     *\n     * @example\n     * ```ts\n     * this.convertToUINode(target.worldPosition, uiNode.parent, out);\n     * uiNode.position = out;\n     * ```\n     */\n    public convertToUINode (wpos: Vec3 | Readonly<Vec3>, uiNode: Node, out?: Vec3) {\n        if (!out) {\n            out = new Vec3();\n        }\n        if (!this._camera) { return out; }\n\n        this.worldToScreen(wpos, _temp_vec3_1);\n        const cmp = uiNode.getComponent('cc.UITransform') as UITransform;\n        const designSize = legacyCC.view.getVisibleSize();\n        const xoffset = _temp_vec3_1.x - this._camera.width * 0.5;\n        const yoffset = _temp_vec3_1.y - this._camera.height * 0.5;\n        _temp_vec3_1.x = xoffset / legacyCC.view.getScaleX() + designSize.width * 0.5;\n        _temp_vec3_1.y = yoffset / legacyCC.view.getScaleY() + designSize.height * 0.5;\n\n        if (cmp) {\n            cmp.convertToNodeSpaceAR(_temp_vec3_1, out);\n        }\n\n        return out;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _createCamera () {\n        if (!this._camera) {\n            this._camera = (legacyCC.director.root as Root).createCamera();\n            this._camera.initialize({\n                name: this.node.name,\n                node: this.node,\n                projection: this._projection,\n                window: this._inEditorMode ? legacyCC.director.root && legacyCC.director.root.mainWindow\n                    : legacyCC.director.root && legacyCC.director.root.tempWindow,\n                priority: this._priority,\n                cameraType: this.cameraType,\n                trackingType: this.trackingType,\n            });\n\n            this._camera.setViewportInOrientedSpace(this._rect);\n            this._camera.fovAxis = this._fovAxis;\n            this._camera.fov = toRadian(this._fov);\n            this._camera.orthoHeight = this._orthoHeight;\n            this._camera.nearClip = this._near;\n            this._camera.farClip = this._far;\n            this._camera.clearColor = this._color;\n            this._camera.clearDepth = this._depth;\n            this._camera.clearStencil = this._stencil;\n            this._camera.clearFlag = this._clearFlags;\n            this._camera.visibility = this._visibility;\n            this._camera.aperture = this._aperture;\n            this._camera.shutter = this._shutter;\n            this._camera.iso = this._iso;\n        }\n\n        this._updateTargetTexture();\n    }\n\n    protected _attachToScene () {\n        if (!this.node.scene || !this._camera) {\n            return;\n        }\n        if (this._camera && this._camera.scene) {\n            this._camera.scene.removeCamera(this._camera);\n        }\n        const rs = this._getRenderScene();\n        rs.addCamera(this._camera);\n    }\n\n    protected _detachFromScene () {\n        if (this._camera && this._camera.scene) {\n            this._camera.scene.removeCamera(this._camera);\n        }\n    }\n\n    protected _checkTargetTextureEvent (old: RenderTexture | null) {\n        if (old) {\n            old.off('resize');\n        }\n\n        if (this._targetTexture) {\n            this._targetTexture.on('resize', (window: RenderWindow) => {\n                if (this._camera) {\n                    this._camera.setFixedSize(window.width, window.height);\n                }\n            }, this);\n        }\n    }\n\n    protected _updateTargetTexture () {\n        if (!this._camera) {\n            return;\n        }\n\n        if (this._targetTexture) {\n            const window = this._targetTexture.window;\n            this._camera.changeTargetWindow(window);\n            this._camera.setFixedSize(window!.width, window!.height);\n        }\n    }\n}\n\nlegacyCC.Camera = Camera;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EffectAsset } from '../../assets/effect-asset';\nimport { MaterialInstance } from './material-instance';\nimport { BatchingSchemes, Pass, PassOverrides } from './pass';\nimport { overrideMacros, MacroRecord } from './pass-utils';\n\n/**\n * @en A pass instance defines an variant version of the [[renderer.Pass]]\n * @zh 表示 [[renderer.Pass]] 的一种特殊实例\n */\nexport class PassInstance extends Pass {\n    /**\n     * @en The parent pass\n     * @zh 相关联的原始 Pass\n     */\n    get parent () { return this._parent; }\n\n    private _parent: Pass;\n\n    private _owner: MaterialInstance;\n\n    private _dontNotify = false;\n\n    constructor (parent: Pass, owner: MaterialInstance) {\n        super(parent.root);\n        this._parent = parent;\n        this._owner = owner;\n        this._doInit(this._parent, true); // defines may change now\n        for (let i = 0; i < this._shaderInfo.blocks.length; i++) {\n            const u = this._shaderInfo.blocks[i];\n            const block = this._blocks[u.binding];\n            const parentBlock = this._parent.blocks[u.binding];\n            block.set(parentBlock);\n        }\n        this._rootBufferDirty = true;\n        const paren = this._parent as PassInstance;\n        for (let i = 0; i < this._shaderInfo.samplerTextures.length; i++) {\n            const u = this._shaderInfo.samplerTextures[i];\n            for (let j = 0; j < u.count; j++) {\n                const sampler = paren._descriptorSet.getSampler(u.binding, j);\n                const texture = paren._descriptorSet.getTexture(u.binding, j);\n                this._descriptorSet.bindSampler(u.binding, sampler, j);\n                this._descriptorSet.bindTexture(u.binding, texture, j);\n            }\n        }\n        super.tryCompile();\n    }\n\n    /**\n     * @en Override pipeline states with the given pass override info.\n     * This won't affect the original pass\n     * @zh 重载当前 Pass 的管线状态。这不会影响原始 Pass\n     * @param original The original pass info\n     * @param value The override pipeline state info\n     */\n    public overridePipelineStates (original: EffectAsset.IPassInfo, overrides: PassOverrides): void {\n        this._bs.reset();\n        this._rs.reset();\n        this._dss.reset();\n\n        Pass.fillPipelineInfo(this, original);\n        Pass.fillPipelineInfo(this, overrides);\n        this._onStateChange();\n    }\n\n    public tryCompile (defineOverrides?: MacroRecord) {\n        if (defineOverrides) {\n            if (!overrideMacros(this._defines, defineOverrides)) {\n                return false;\n            }\n        }\n        const res = super.tryCompile();\n        this._onStateChange();\n        return res;\n    }\n\n    /**\n     * @en Prepare to change states of the pass and do not notify the material to rebuild the pipeline state object\n     * @zh 开始静默修改 Pass 相关状态，不会通知材质去重新构建管线状态对象。\n     */\n    public beginChangeStatesSilently () {\n        this._dontNotify = true;\n    }\n\n    /**\n     * @en End the silent states changing process, all state changes will be notified.\n     * @zh 结束静默状态修改，所有修改将会开始通知材质。\n     */\n    public endChangeStatesSilently () {\n        this._dontNotify = false;\n    }\n\n    protected _syncBatchingScheme () {\n        this._defines.USE_BATCHING = this._defines.USE_INSTANCING = false;\n        this._batchingScheme = BatchingSchemes.NONE;\n    }\n\n    protected _onStateChange () {\n        this._hash = Pass.getPassHash(this);\n        this._owner.onPassStateChange(this._dontNotify);\n    }\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Material } from '../../assets/material';\nimport { PassInstance } from './pass-instance';\nimport { MacroRecord } from './pass-utils';\nimport { PassOverrides } from './pass';\nimport { Renderer } from '../../components/renderer';\n\nexport interface IMaterialInstanceInfo {\n    parent: Material;\n    owner?: Renderer;\n    subModelIdx?: number;\n}\n\n/**\n * @zh\n * 材质实例，当有材质修改需求时，根据材质资源创建的，可任意定制的实例。\n */\nexport class MaterialInstance extends Material {\n    get parent () {\n        return this._parent;\n    }\n\n    get owner () {\n        return this._owner;\n    }\n\n    protected _passes: PassInstance[] = [];\n\n    private _parent: Material;\n    private _owner: Renderer | null;\n    private _subModelIdx = 0;\n\n    constructor (info: IMaterialInstanceInfo) {\n        super();\n        this._parent = info.parent;\n        this._owner = info.owner || null;\n        this._subModelIdx = info.subModelIdx || 0;\n        this.copy(this._parent);\n    }\n\n    public recompileShaders (overrides: MacroRecord, passIdx?: number): void {\n        if (!this._passes || !this.effectAsset) { return; }\n        if (passIdx === undefined) {\n            for (const pass of this._passes) {\n                pass.tryCompile(overrides);\n            }\n        } else {\n            this._passes[passIdx].tryCompile(overrides);\n        }\n    }\n\n    public overridePipelineStates (overrides: PassOverrides, passIdx?: number): void {\n        if (!this._passes || !this.effectAsset) { return; }\n        const passInfos = this.effectAsset.techniques[this.technique].passes;\n        if (passIdx === undefined) {\n            for (let i = 0; i < this._passes.length; i++) {\n                const pass = this._passes[i];\n                const state = this._states[i] || (this._states[i] = {});\n                for (const key in overrides) { state[key] = overrides[key]; }\n                pass.overridePipelineStates(passInfos[pass.passIndex], state);\n            }\n        } else {\n            const state = this._states[passIdx] || (this._states[passIdx] = {});\n            for (const key in overrides) { state[key] = overrides[key]; }\n            this._passes[passIdx].overridePipelineStates(passInfos[passIdx], state);\n        }\n    }\n\n    public destroy () {\n        this._doDestroy();\n        return true;\n    }\n\n    public onPassStateChange (dontNotify: boolean) {\n        this._hash = Material.getHash(this);\n        if (!dontNotify && this._owner) {\n            // @ts-expect-error calling protected method here\n            this._owner._onRebuildPSO(this._subModelIdx, this);\n        }\n    }\n\n    protected _createPasses () {\n        const passes: PassInstance[] = [];\n        const parentPasses = this._parent.passes;\n        if (!parentPasses) { return passes; }\n        for (let k = 0; k < parentPasses.length; ++k) {\n            passes.push(new PassInstance(parentPasses[k], this));\n        }\n        return passes;\n    }\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport {\n    ccclass, type, displayOrder, displayName, serializable, disallowMultiple,\n} from 'cc.decorator';\nimport { Material } from '../assets/material';\nimport { Component } from './component';\nimport { IMaterialInstanceInfo, MaterialInstance } from '../renderer/core/material-instance';\nimport { warnID } from '../platform/debug';\n\nconst _matInsInfo: IMaterialInstanceInfo = {\n    parent: null!,\n    owner: null!,\n    subModelIdx: 0,\n};\n\n/**\n * @en Base class for all components which can submit contents for the rendering process.\n * It manages a series of [[renderer.Model]]s and the visibility, the materials and the material instances of the models.\n * There are several different material properties that must be distinguished clearly and used with caution:\n * - [[sharedMaterials]] are shared for all component instances that are using the same material asset, modification will be applied universally.\n * - [[materials]] are instances created independently for the component instance, modification will only be applied for the component instance.\n * - Render Materials retrieved by [[getRenderMaterial]] are materials used for the actual rendering process, material instances are used if exist.\n * By default, shared materials are used for rendering.\n * Material instances are created only when user try to retrieve a material instance with [[material]], [[materials]] and [[getMaterialInstance]].\n * @zh 所有可以提交内容到渲染流程的可渲染类的基类，它管理着一组 [[renderer.Model]]，以及它们的可见性、材质和材质实例。\n * 下面是这个组件所管理的各种材质属性的解释，需要正确区分并小心使用：\n * - [[sharedMaterials]] 是共享材质，所有使用此材质资源的组件实例都默认使用材质的共享实例对象，所有修改都会影响所有使用它的组件实例。\n * - [[materials]] 是专为组件对象创建的独立材质实例，所有修改仅会影响当前组件对象。\n * - 使用 [[getRenderMaterial]] 获取的渲染材质是用于实际渲染流程的材质对象，当存在材质实例的时候，永远使用材质实例。\n * 默认情况下，渲染组件使用共享材质进行渲染，材质实例也不会被创建出来。仅在用户通过 [[material]]，[[materials]] 和 [[getMaterialInstance]] 接口获取材质时才会创建材质实例。\n */\n@ccclass('cc.Renderer')\n@disallowMultiple\nexport class Renderer extends Component {\n    /**\n     * @en Get the default shared material\n     * @zh 获取默认的共享材质\n     */\n    get sharedMaterial () {\n        return this.getMaterial(0);\n    }\n\n    /**\n     * @en All shared materials of model\n     * @zh 模型的所有共享材质\n     */\n    @type(Material)\n    @displayOrder(0)\n    @displayName('Materials')\n    get sharedMaterials () {\n        // if we don't create an array copy, the editor will modify the original array directly.\n        return (EDITOR && this._materials.slice()) || this._materials;\n    }\n\n    set sharedMaterials (val) {\n        for (let i = 0; i < val.length; i++) {\n            if (val[i] !== this._materials[i]) {\n                this.setMaterial(val[i], i);\n            }\n        }\n        if (val.length < this._materials.length) {\n            for (let i = val.length; i < this._materials.length; i++) {\n                this.setMaterial(null, i);\n            }\n            this._materials.splice(val.length);\n        }\n    }\n\n    /**\n     * @en The default material instance, it will create a new instance from the default shared material if not created yet.\n     * @zh 获取默认的材质实例，如果还没有创建，将会根据默认共享材质创建一个新的材质实例\n     */\n    get material (): MaterialInstance | null {\n        return this.getMaterialInstance(0);\n    }\n\n    set material (val: Material | MaterialInstance | null) {\n        if (this._materials.length === 1 && !this._materialInstances[0] && this._materials[0] === val) {\n            return;\n        }\n        this.setMaterialInstance(val, 0);\n    }\n\n    /**\n     * @en The materials of the model.\n     * @zh 所有模型材质。\n     */\n    get materials (): (MaterialInstance | null)[] {\n        for (let i = 0; i < this._materials.length; i++) {\n            this._materialInstances[i] = this.getMaterialInstance(i) as MaterialInstance;\n        }\n        return this._materialInstances;\n    }\n\n    set materials (val: (Material | MaterialInstance | null)[]) {\n        const newLength = val.length;\n        const oldLength = this._materials.length;\n        for (let i = newLength; i < oldLength; i++) {\n            this.setMaterialInstance(null, i);\n        }\n        this._materials.length = newLength;\n        this._materialInstances.length = newLength;\n        for (let i = 0; i < newLength; i++) {\n            // they could be either undefined or null\n            // eslint-disable-next-line eqeqeq\n            if (this._materialInstances[i] != val[i]) {\n                this.setMaterialInstance(val[i], i);\n            }\n        }\n    }\n\n    // _materials should be defined after sharedMaterials for Editor reset component reason\n    @type([Material])\n    protected _materials: (Material | null)[] = [];\n\n    protected _materialInstances: (MaterialInstance | null)[] = [];\n\n    /**\n     * @en Get the shared material asset of the specified sub-model.\n     * @zh 获取指定子模型的共享材质资源。\n     */\n    public getMaterial (idx: number): Material | null {\n        if (idx < 0 || idx >= this._materials.length) {\n            return null;\n        }\n        return this._materials[idx];\n    }\n\n    /**\n     * @en Set the shared material asset of the specified sub-model,\n     * new material instance will be created automatically if the sub-model is already using one.\n     * @zh 设置指定子模型的 sharedMaterial，如果对应位置有材质实例则会创建一个对应的材质实例。\n     */\n    public setMaterial (material: Material | null, index: number) {\n        if (material && material instanceof MaterialInstance) {\n            console.error('Can\\'t set a material instance to a sharedMaterial slot');\n        }\n        this._materials[index] = material;\n        const inst = this._materialInstances[index];\n        if (inst) {\n            inst.destroy();\n            this._materialInstances[index] = null;\n        }\n        this._onMaterialModified(index, this._materials[index]);\n    }\n\n    /**\n     * @en Get the material instance of the specified sub-model.\n     * It will create a new instance from the corresponding shared material if not created yet.\n     * @zh 获取指定子模型的材质实例。如果还没有创建，将会根据对应的共享材质创建一个新的材质实例\n     */\n    public getMaterialInstance (idx: number): MaterialInstance | null {\n        const mat = this._materials[idx];\n        if (!mat) {\n            return null;\n        }\n        if (!this._materialInstances[idx]) {\n            _matInsInfo.parent = this._materials[idx]!;\n            _matInsInfo.owner = this;\n            _matInsInfo.subModelIdx = idx;\n            const instantiated = new MaterialInstance(_matInsInfo);\n            _matInsInfo.parent = null!;\n            _matInsInfo.owner = null!;\n            _matInsInfo.subModelIdx = 0!;\n            this.setMaterialInstance(instantiated, idx);\n        }\n        return this._materialInstances[idx];\n    }\n\n    /**\n     * @en Set the material instance of the specified sub-model.\n     * @zh 获取指定子模型的材质实例。\n     */\n    public setMaterialInstance (matInst: Material | MaterialInstance | null, index: number) {\n        if (typeof matInst === 'number') {\n            warnID(12007);\n            const temp: any = matInst;\n            matInst = index as any;\n            index = temp;\n        }\n\n        const curInst = this._materialInstances[index];\n\n        // If the new material is an MaterialInstance\n        if (matInst && matInst.parent) {\n            if (matInst !== curInst) {\n                this._materialInstances[index] = matInst as MaterialInstance;\n                this._onMaterialModified(index, matInst);\n            }\n            return;\n        }\n\n        // Skip identity check if it's a Material property\n        // Or if there is a MaterialInstance already\n        if (matInst !== this._materials[index] || curInst) {\n            this.setMaterial(matInst as Material, index);\n        }\n    }\n\n    /**\n     * @en Get the actual rendering material of the specified sub-model.\n     * (material instance if there is one, or the shared material asset)\n     * @zh 获取指定位置可供渲染的材质，如果有材质实例则使用材质实例，如果没有则使用材质资源\n     */\n    public getRenderMaterial (index: number): Material | null {\n        return this._materialInstances[index] || this._materials[index];\n    }\n\n    protected _onMaterialModified (index: number, material: Material | null) {\n    }\n\n    protected _onRebuildPSO (index: number, material: Material | null) {\n    }\n\n    protected _clearMaterials () {\n    }\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport {\n    ccclass, serializable,\n} from 'cc.decorator';\nimport { scene } from '../renderer';\nimport { Layers } from '../scene-graph/layers';\nimport { Renderer } from './renderer';\n\n/**\n * @en Base class for all rendering components containing model.\n * @zh 所有包含 model 的渲染组件基类。\n */\n@ccclass('cc.ModelRenderer')\nexport class ModelRenderer extends Renderer {\n    /**\n     * @en The visibility which will be applied to the committed models.\n     * @zh 应用于所有提交渲染的 Model 的可见性\n     */\n    get visibility () {\n        return this._visFlags;\n    }\n\n    set visibility (val) {\n        this._visFlags = val;\n        this._onVisibilityChange(val);\n    }\n\n    /**\n     * @en The priority which will be applied to the committed models.(Valid only in transparent queues)\n     * @zh 应用于所有提交渲染的 Model 的排序优先级（只在半透明渲染队列中起效）\n     */\n    get priority () {\n        return this._priority;\n    }\n\n    set priority (val) {\n        if (val === this._priority) return;\n        this._priority = val;\n        this._updatePriority();\n    }\n\n    @serializable\n    protected _visFlags = Layers.Enum.NONE;\n    protected _models: scene.Model[] = [];\n    protected _priority = 0;\n\n    /**\n     * @zh 收集组件中的 models\n     * @en Collect the models in this component.\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _collectModels (): scene.Model[] {\n        return this._models;\n    }\n\n    protected onEnable () {\n        this._updatePriority();\n    }\n\n    protected _attachToScene () {\n    }\n\n    protected _detachFromScene () {\n    }\n\n    protected _onVisibilityChange (val) {\n    }\n\n    protected _updatePriority () {\n        if (this._models.length > 0) {\n            for (let i = 0; i < this._models.length; i++) {\n                this._models[i].priority = this._priority;\n            }\n        }\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/* eslint-disable @typescript-eslint/no-unsafe-return */\n\nimport { Camera } from './camera-component';\nimport { replaceProperty } from '../utils/x-deprecated';\nimport { legacyCC } from '../global-exports';\nimport { js } from '../utils/js';\nimport { ModelRenderer } from './model-renderer';\n\nreplaceProperty(Camera, 'Camera', [\n    {\n        name: 'CameraClearFlag',\n        newName: 'ClearFlag',\n    },\n]);\n\nreplaceProperty(Camera.prototype, 'Camera.prototype', [\n    {\n        name: 'color',\n        newName: 'clearColor',\n    },\n    {\n        name: 'depth',\n        newName: 'clearDepth',\n    },\n    {\n        name: 'stencil',\n        newName: 'clearStencil',\n    },\n]);\n\n/**\n * Alias of [[Camera]]\n * @deprecated Since v1.2\n */\nexport { Camera as CameraComponent };\nlegacyCC.CameraComponent = Camera;\njs.setClassAlias(Camera, 'cc.CameraComponent');\n\n/**\n * Alias of [[Renderer]]\n * @deprecated Since v3.6\n */\nexport { ModelRenderer as RenderableComponent };\nlegacyCC.RenderableComponent = ModelRenderer;\njs.setClassAlias(ModelRenderer, 'cc.RenderableComponent');\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { legacyCC } from '../../core/global-exports';\nimport { NodeEventType } from '../../core/scene-graph/node-event';\n\n/**\n * @en The event type supported by SystemEvent and Node events\n * @zh SystemEvent 支持的事件类型以及节点事件类型\n *\n * @deprecated since v3.3.0, please use Input.EventType instead\n */\nexport enum SystemEventType {\n    /**\n     * @en\n     * The event type for touch start event\n     *\n     * @zh\n     * 手指开始触摸事件。\n     */\n    TOUCH_START = 'touch-start',\n\n    /**\n     * @en\n     * The event type for touch move event\n     *\n     * @zh\n     * 当手指在屏幕上移动时。\n     */\n    TOUCH_MOVE = 'touch-move',\n\n    /**\n     * @en\n     * The event type for touch end event\n     *\n     * @zh\n     * 手指结束触摸事件。\n     */\n    TOUCH_END = 'touch-end',\n\n    /**\n     * @en\n     * The event type for touch end event\n     *\n     * @zh\n     * 当手指在目标节点区域外离开屏幕时。\n     */\n    TOUCH_CANCEL = 'touch-cancel',\n\n    /**\n     * @en\n     * The event type for mouse down events\n     *\n     * @zh\n     * 当鼠标按下时触发一次。\n     */\n    MOUSE_DOWN = 'mouse-down',\n\n    /**\n     * @en\n     * The event type for mouse move events\n     *\n     * @zh\n     * 当鼠标在目标节点在目标节点区域中移动时，不论是否按下。\n     */\n    MOUSE_MOVE = 'mouse-move',\n\n    /**\n     * @en\n     * The event type for mouse up events\n     *\n     * @zh\n     * 当鼠标从按下状态松开时触发一次。\n     */\n    MOUSE_UP = 'mouse-up',\n\n    /**\n     * @en\n     * The event type for mouse wheel events\n     *\n     * @zh 当滚动鼠标滚轮或操作其它类似输入设备时会触发滚轮事件。\n     */\n    MOUSE_WHEEL = 'mouse-wheel',\n\n    /**\n     * @en\n     * The event type for mouse leave target events\n     *\n     * @zh\n     * 当鼠标移入目标节点区域时，不论是否按下.\n     *\n     * @deprecated since v3.3, please use Node.EventType.MOUSE_ENTER instead.\n     */\n    MOUSE_ENTER = 'mouse-enter',\n\n    /**\n     * @en\n     * The event type for mouse leave target events\n     *\n     * @zh\n     * 当鼠标移出目标节点区域时，不论是否按下。\n     *\n     * @deprecated since v3.3, please use Node.EventType.MOUSE_LEAVE instead.\n     */\n    MOUSE_LEAVE = 'mouse-leave',\n\n    /**\n     * @en The event type for the key down event, the event will be continuously dispatched in the key pressed state\n     * @zh 当按下按键时触发的事件, 该事件在按下状态会持续派发\n     */\n    KEY_DOWN = 'keydown',\n\n    /**\n     * @en The event type for the key up event\n     * @zh 当松开按键时触发的事件\n     */\n    KEY_UP = 'keyup',\n\n    /**\n     * @en\n     * The event type for the devicemotion event\n     *\n     * @zh\n     * 重力感应\n     */\n    DEVICEMOTION = 'devicemotion',\n\n    /**\n     * @en\n     * The event type for position, rotation, scale changed.Use the type parameter as [[Node.TransformBit]] to check which part is changed\n     *\n     * @zh\n     * 节点改变位置、旋转或缩放事件。如果具体需要判断是哪一个事件，可通过判断回调的第一个参数类型是 [[Node.TransformBit]] 中的哪一个来获取\n     * @example\n     * ```\n     * this.node.on(Node.EventType.TRANSFORM_CHANGED, (type)=>{\n     *  if (type & Node.TransformBit.POSITION) {\n     *       //...\n     *   }\n     * }, this);\n     * ```\n     *\n     * @deprecated since v3.3, please use Node.EventType.TRANSFORM_CHANGED instead\n     */\n    TRANSFORM_CHANGED = 'transform-changed',\n\n    /**\n     * @en The event type for notifying the host scene has been changed for a persist node.\n     * @zh 当场景常驻节点的场景发生改变时触发的事件，一般在切换场景过程中触发。\n     *\n     * @deprecated since v3.3, please use Node.EventType.SCENE_CHANGED_FOR_PERSISTS instead\n     */\n    SCENE_CHANGED_FOR_PERSISTS = 'scene-changed-for-persists',\n\n    /**\n     * @en\n     * The event type for size change events.\n     * Performance note, this event will be triggered every time corresponding properties being changed,\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\n     *\n     * @zh\n     * 当节点尺寸改变时触发的事件。\n     * 性能警告：这个事件会在每次对应的属性被修改时触发，如果事件回调损耗较高，有可能对性能有很大的负面影响，请尽量避免这种情况。\n     *\n     * @deprecated since v3.3, please use Node.EventType.SIZE_CHANGED instead\n     */\n    SIZE_CHANGED = 'size-changed',\n\n    /**\n     * @en\n     * The event type for anchor point change events.\n     * Performance note, this event will be triggered every time corresponding properties being changed,\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\n     *\n     * @zh\n     * 当节点的 UITransform 锚点改变时触发的事件。\n     * 性能警告：这个事件会在每次对应的属性被修改时触发，如果事件回调损耗较高，有可能对性能有很大的负面影响，请尽量避免这种情况。\n     *\n     * @deprecated since v3.3, please use Node.EventType.ANCHOR_CHANGED instead\n     */\n    ANCHOR_CHANGED = 'anchor-changed',\n\n    /**\n     * @en\n     * The event type for color change events.\n     * Performance note, this event will be triggered every time corresponding properties being changed,\n     * if the event callback have heavy logic it may have great performance impact, try to avoid such scenario.\n     *\n     * @zh\n     * 当节点的 UI 渲染组件颜色属性改变时触发的事件。\n     * 性能警告：这个事件会在每次对应的属性被修改时触发，如果事件回调损耗较高，有可能对性能有很大的负面影响，请尽量避免这种情况。\n     *\n     * @deprecated since v3.3, please use Node.EventType.COLOR_CHANGED instead\n     */\n    COLOR_CHANGED = 'color-changed',\n\n    /**\n     * @en\n     * The event type for adding a new child node to the target node.\n     *\n     * @zh\n     * 给目标节点添加子节点时触发的事件。\n     *\n     * @deprecated since v3.3, please use Node.EventType.CHILD_ADDED instead\n     */\n    CHILD_ADDED = 'child-added',\n\n    /**\n     * @en\n     * The event type for removing a child node from the target node.\n     *\n     * @zh\n     * 给目标节点移除子节点时触发的事件。\n     *\n     * @deprecated since v3.3, please use Node.EventType.CHILD_REMOVED instead\n     */\n    CHILD_REMOVED = 'child-removed',\n\n    /**\n     * @en The event type for changing the parent of the target node\n     * @zh 目标节点的父节点改变时触发的事件。\n     *\n     * @deprecated since v3.3, please use Node.EventType.PARENT_CHANGED instead\n     */\n    PARENT_CHANGED = 'parent-changed',\n\n    /**\n     * @en The event type for destroying the target node\n     * @zh 目标节点被销毁时触发的事件。\n     *\n     * @deprecated since v3.3, please use Node.EventType.NODE_DESTROYED instead\n     */\n    NODE_DESTROYED = 'node-destroyed',\n\n    /**\n     * @en The event type for node layer change events.\n     * @zh 节点 layer 改变时触发的事件。\n     *\n     * @deprecated since v3.3, please use Node.EventType.LAYER_CHANGED instead\n     */\n    LAYER_CHANGED = 'layer-changed',\n\n    /**\n     * @en The event type for node's sibling order changed.\n     * @zh 当节点在兄弟节点中的顺序发生变化时触发的事件。\n     *\n     * @deprecated since v3.3, please use Node.EventType.SIBLING_ORDER_CHANGED instead\n     */\n    SIBLING_ORDER_CHANGED = 'sibling-order-changed',\n}\n\n/**\n * @en The input event type\n * @zh 输入事件类型\n */\nexport enum InputEventType {\n    /**\n     * @en\n     * The event type for touch start event\n     *\n     * @zh\n     * 手指开始触摸事件。\n     */\n    TOUCH_START = 'touch-start',\n\n    /**\n     * @en\n     * The event type for touch move event\n     *\n     * @zh\n     * 当手指在屏幕上移动时。\n     */\n    TOUCH_MOVE = 'touch-move',\n\n    /**\n     * @en\n     * The event type for touch end event\n     *\n     * @zh\n     * 手指结束触摸事件。\n     */\n    TOUCH_END = 'touch-end',\n\n    /**\n     * @en\n     * The event type for touch end event\n     *\n     * @zh\n     * 当手指在目标节点区域外离开屏幕时。\n     */\n    TOUCH_CANCEL = 'touch-cancel',\n\n    /**\n     * @en\n     * The event type for mouse down events\n     *\n     * @zh\n     * 当鼠标按下时触发一次。\n     */\n    MOUSE_DOWN = 'mouse-down',\n\n    /**\n     * @en\n     * The event type for mouse move events\n     *\n     * @zh\n     * 当鼠标在目标节点在目标节点区域中移动时，不论是否按下。\n     */\n    MOUSE_MOVE = 'mouse-move',\n\n    /**\n     * @en\n     * The event type for mouse up events\n     *\n     * @zh\n     * 当鼠标从按下状态松开时触发一次。\n     */\n    MOUSE_UP = 'mouse-up',\n\n    /**\n     * @en\n     * The event type for mouse wheel events\n     *\n     * @zh 手指开始触摸事件\n     */\n    MOUSE_WHEEL = 'mouse-wheel',\n\n    /**\n     * @en The event type for the key down event\n     * @zh 当按下按键时触发的事件\n     */\n    KEY_DOWN = 'keydown',\n\n    /**\n     * @en The event type for the key pressing event, the event will be continuously dispatched in the key pressed state\n     * @zh 当按着按键时触发的事件, 该事件在按下状态会持续派发\n     */\n    KEY_PRESSING = 'key-pressing',\n\n    /**\n     * @en The event type for the key up event\n     * @zh 当松开按键时触发的事件\n     */\n    KEY_UP = 'keyup',\n\n    /**\n     * @en\n     * The event type for the devicemotion event\n     *\n     * @zh\n     * 重力感应\n     */\n    DEVICEMOTION = 'devicemotion',\n\n    /**\n     * @en The event type for gamepad input\n     * @zh 手柄输入事件\n     */\n    GAMEPAD_INPUT = 'gamepad-input',\n    /**\n     * @en The event type for gamepad device change, including gamepad connecting and disconnecting\n     * @zh 手柄设备改变时触发的事件，包括手柄连接，手柄断开连接\n     */\n    GAMEPAD_CHANGE = 'gamepad-change',\n\n    /**\n     * @en The event type for 6DOF handle input\n     * @zh 6DOF手柄输入事件\n     */\n    HANDLE_INPUT = 'handle-input',\n\n    /**\n     * @en The event type for handle pose input\n     * @zh 手柄姿态输入事件\n     */\n    HANDLE_POSE_INPUT = 'handle-pose-input',\n\n    /**\n     * @en The event type for hmd pose input\n     * @zh 头戴显示器姿态输入事件\n     */\n    HMD_POSE_INPUT = 'hmd-pose-input'\n}\n\nexport type SystemEventTypeUnion = SystemEventType | NodeEventType | InputEventType | string;\n\nlegacyCC.SystemEventType = SystemEventType;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { legacyCC } from '../../../core/global-exports';\nimport { SystemEventTypeUnion } from '../event-enum';\n\n/**\n * @en\n * Base class of all kinds of events.\n *\n * @zh\n * 所有事件对象的基类，包含事件相关基本信息。\n */\nexport class Event {\n    // Event types\n\n    /**\n     * @en\n     * Code for event without type.\n     *\n     * @zh\n     * 没有类型的事件。\n     */\n    public static NO_TYPE = 'no_type';\n\n    /**\n     * @en\n     * The type code of Touch event.\n     *\n     * @zh\n     * 触摸事件类型。\n     *\n     * @deprecated since v3.3, please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead\n     */\n    public static TOUCH = 'touch';\n    /**\n     * @en\n     * The type code of Mouse event.\n     *\n     * @zh\n     * 鼠标事件类型。\n     *\n     * @deprecated since v3.3, please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead\n     */\n    public static MOUSE = 'mouse';\n    /**\n     * @en\n     * The type code of Keyboard event.\n     *\n     * @zh\n     * 键盘事件类型。\n     *\n     * @deprecated since v3.3, please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead\n     */\n    public static KEYBOARD = 'keyboard';\n    /**\n     * @en\n     * The type code of Acceleration event.\n     *\n     * @zh\n     * 加速器事件类型。\n     *\n     * @deprecated since v3.3, please use SystemEvent.EventType.DEVICEMOTION instead\n     */\n    public static ACCELERATION = 'acceleration';\n\n    // Event phases\n\n    /**\n     * @en\n     * Events not currently dispatched are in this phase.\n     *\n     * @zh\n     * 尚未派发事件阶段。\n     */\n    public static NONE = 0;\n\n    /**\n     * @en\n     * The capturing phase comprises the journey from the root to the last node before the event target's node\n     * [markdown](http://www.w3.org/TR/DOM-Level-3-Events/#event-flow)\n     *\n     * @zh\n     * 捕获阶段，包括事件目标节点之前从根节点到最后一个节点的过程。\n     */\n    public static CAPTURING_PHASE = 1;\n\n    /**\n     * @en\n     * The target phase comprises only the event target node\n     * [markdown] (http://www.w3.org/TR/DOM-Level-3-Events/#event-flow)\n     *\n     * @zh\n     * 目标阶段仅包括事件目标节点。\n     */\n    public static AT_TARGET = 2;\n\n    /**\n     * @en\n     * The bubbling phase comprises any subsequent nodes encountered on the return trip to the root of the hierarchy\n     * [markdown] (http://www.w3.org/TR/DOM-Level-3-Events/#event-flow)\n     *\n     * @zh\n     * 冒泡阶段， 包括回程遇到到层次根节点的任何后续节点。\n     */\n    public static BUBBLING_PHASE = 3;\n\n    /**\n     * @en\n     * The name of the event\n     *\n     * @zh\n     * 事件类型。\n     */\n    public type: SystemEventTypeUnion;\n\n    /**\n     * @en\n     * Indicate whether the event bubbles up through the hierarchy or not.\n     *\n     * @zh\n     * 表示该事件是否进行冒泡。\n     */\n    public bubbles: boolean;\n\n    /**\n     * @en\n     * A reference to the target to which the event was originally dispatched.\n     *\n     * @zh\n     * 最初事件触发的目标。\n     */\n    public target: any = null;\n\n    /**\n     * @en\n     * A reference to the currently registered target for the event.\n     *\n     * @zh\n     * 当前目标。\n     */\n    public currentTarget: any = null;\n\n    /**\n     * @en\n     * Indicates which phase of the event flow is currently being evaluated.\n     * Returns an integer value represented by 4 constants:\n     *  - Event.NONE = 0\n     *  - Event.CAPTURING_PHASE = 1\n     *  - Event.AT_TARGET = 2\n     *  - Event.BUBBLING_PHASE = 3\n     * The phases are explained in the [section 3.1, Event dispatch and DOM event flow]\n     * [markdown](http://www.w3.org/TR/DOM-Level-3-Events/#event-flow), of the DOM Level 3 Events specification.\n     *\n     * @zh\n     * 事件阶段。\n     */\n    public eventPhase = 0;\n\n    /**\n     * @en\n     * Stops propagation for current event.\n     *\n     * @zh\n     * 停止传递当前事件。\n     */\n    public propagationStopped = false;\n\n    /**\n     * @en\n     * Stops propagation for current event immediately,\n     * the event won't even be dispatched to the listeners attached in the current target.\n     *\n     * @zh\n     * 立即停止当前事件的传递，事件甚至不会被分派到所连接的当前目标。\n     */\n    public propagationImmediateStopped = false;\n\n    /**\n     * @param type - The name of the event (case-sensitive), e.g. \"click\", \"fire\", or \"submit\"\n     * @param bubbles - A boolean indicating whether the event bubbles up through the tree or not\n     */\n    constructor (type: SystemEventTypeUnion, bubbles?: boolean) {\n        this.type = type;\n        this.bubbles = !!bubbles;\n    }\n\n    /**\n     * @en\n     * Reset the event for being stored in the object pool.\n     *\n     * @zh\n     * 重置事件对象以便在对象池中存储。\n     */\n    public unuse () {\n        this.type = Event.NO_TYPE;\n        this.target = null;\n        this.currentTarget = null;\n        this.eventPhase = Event.NONE;\n        this.propagationStopped = false;\n        this.propagationImmediateStopped = false;\n    }\n\n    /**\n     * @en\n     * Reinitialize the event for being used again after retrieved from the object pool.\n     * @zh\n     * 重新初始化让对象池中取出的事件可再次使用。\n     * @param type - The name of the event (case-sensitive), e.g. \"click\", \"fire\", or \"submit\"\n     * @param bubbles - A boolean indicating whether the event bubbles up through the tree or not\n     */\n    public reuse (type: SystemEventTypeUnion, bubbles?: boolean) {\n        this.type = type;\n        this.bubbles = bubbles || false;\n    }\n\n    // /**\n    //  * @en Stops propagation for current event.\n    //  * @zh 停止传递当前事件。\n    //  */\n    // public stopPropagation () {\n    //     this.propagationStopped = true;\n    // }\n\n    // /**\n    //  * @en Stops propagation for current event immediately,\n    //  * the event won't even be dispatched to the listeners attached in the current target.\n    //  * @zh 立即停止当前事件的传递，事件甚至不会被分派到所连接的当前目标。\n    //  */\n    // public stopPropagationImmediate () {\n    //     this.propagationImmediateStopped = true;\n    // }\n\n    /**\n     * @en\n     * Checks whether the event has been stopped.\n     *\n     * @zh\n     * 检查该事件是否已经停止传递。\n     */\n    public isStopped () {\n        return this.propagationStopped || this.propagationImmediateStopped;\n    }\n\n    /**\n     * @en\n     * Gets current target of the event                                                            <br/>\n     * note: It only be available when the event listener is associated with node.                <br/>\n     * It returns 0 when the listener is associated with fixed priority.\n     * @zh\n     * 获取当前目标节点\n     * @returns - The target with which the event associates.\n     */\n    public getCurrentTarget () {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return this.currentTarget;\n    }\n\n    /**\n     * @en\n     * Gets the event type.\n     * @zh\n     * 获取事件类型。\n     */\n    public getType () {\n        return this.type;\n    }\n}\n\n/* tslint:disable:no-string-literal */\nlegacyCC.Event = Event;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Event } from './event';\nimport { Acceleration } from '../acceleration';\nimport { SystemEventType } from '../event-enum';\n\n/**\n * @en\n * The acceleration event.\n * @zh\n * 加速计事件。\n */\nexport class EventAcceleration extends Event {\n    /**\n     * @en The acceleration object\n     * @zh 加速度对象\n     */\n    public acc: Acceleration;\n\n    /**\n     * @param acc - The acceleration\n     * @param bubbles - Indicate whether the event bubbles up through the hierarchy or not.\n     */\n    constructor (acc: Acceleration, bubbles?: boolean) {\n        super(SystemEventType.DEVICEMOTION, bubbles);\n        this.acc = acc;\n    }\n}\n\n// @ts-expect-error TODO\nEvent.EventAcceleration = EventAcceleration;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Event } from './event';\nimport { SystemEventTypeUnion, SystemEventType } from '../event-enum';\nimport { KeyCode } from '../key-code';\n\n/**\n * @en\n * The keyboard event.\n * @zh\n * 键盘事件。\n */\nexport class EventKeyboard extends Event {\n    /**\n     * @en The KeyCode enum value of current keyboard event.\n     * @zh 当前键盘事件的 KeyCode 枚举值\n     */\n    public keyCode: KeyCode;\n\n    /**\n     * @en Raw DOM KeyboardEvent.\n     * @zh 原始 DOM KeyboardEvent 事件对象\n     *\n     * @deprecated since v3.3, can't access rawEvent anymore\n     */\n    public rawEvent?: KeyboardEvent;\n\n    private _isPressed: boolean;\n    /**\n     * @en Indicates whether the current key is being pressed\n     * @zh 表示当前按键是否正在被按下\n     */\n    public get isPressed () {\n        return this._isPressed;\n    }\n\n    /**\n     * @param keyCode - The key code of the current key or the DOM KeyboardEvent\n     * @param isPressed - Indicates whether the current key is being pressed, this is the DEPRECATED parameter.\n     * @param bubbles - Indicates whether the event bubbles up through the hierarchy or not.\n     */\n    constructor (keyCode: number | KeyboardEvent, isPressed: boolean, bubbles?: boolean);\n    /**\n     * @param keyCode - The key code of the current key or the DOM KeyboardEvent\n     * @param eventType - The type of the event\n     * @param bubbles - Indicates whether the event bubbles up through the hierarchy or not.\n     */\n    constructor (keyCode: KeyCode | KeyboardEvent, eventType: SystemEventTypeUnion, bubbles?: boolean);\n    constructor (keyCode: any, eventType: SystemEventTypeUnion | boolean, bubbles?: boolean) {\n        if (typeof eventType === 'boolean') {\n            const isPressed = eventType;\n            eventType = isPressed ? SystemEventType.KEY_DOWN : SystemEventType.KEY_UP;\n        }\n        super(eventType, bubbles);\n        this._isPressed = eventType !== SystemEventType.KEY_UP;\n\n        if (typeof keyCode === 'number') {\n            this.keyCode = keyCode;\n        } else {\n            this.keyCode = keyCode.keyCode;\n            this.rawEvent = keyCode;\n        }\n    }\n}\n\n// @ts-expect-error TODO\nEvent.EventKeyboard = EventKeyboard;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Event } from './event';\nimport { Vec2 } from '../../../core/math/vec2';\nimport { legacyCC } from '../../../core/global-exports';\nimport { SystemEventTypeUnion } from '../event-enum';\n\n/**\n * @en The mouse event\n * @zh 鼠标事件类型\n */\nexport class EventMouse extends Event {\n    /**\n     * @en The default tag when no button is pressed\n     * @zh 按键默认的缺省状态\n     */\n    public static BUTTON_MISSING = -1;\n\n    /**\n     * @en The tag of mouse's left button.\n     * @zh 鼠标左键的标签。\n     */\n    public static BUTTON_LEFT = 0;\n\n    /**\n     * @en The tag of mouse's right button  (The right button number is 2 on browser).\n     * @zh 鼠标右键的标签。\n     */\n    public static BUTTON_RIGHT = 2;\n\n    /**\n     * @en The tag of mouse's middle button.\n     * @zh 鼠标中键的标签。\n     */\n    public static BUTTON_MIDDLE = 1;\n\n    /**\n     * @en The tag of mouse's button 4.\n     * @zh 鼠标按键 4 的标签。\n     */\n    public static BUTTON_4 = 3;\n\n    /**\n     * @en The tag of mouse's button 5.\n     * @zh 鼠标按键 5 的标签。\n     */\n    public static BUTTON_5 = 4;\n\n    /**\n     * @en The tag of mouse's button 6.\n     * @zh 鼠标按键 6 的标签。\n     */\n    public static BUTTON_6 = 5;\n\n    /**\n     * @en The tag of mouse's button 7.\n     * @zh 鼠标按键 7 的标签。\n     */\n    public static BUTTON_7 = 6;\n\n    /**\n     * @en The tag of mouse's button 8.\n     * @zh 鼠标按键 8 的标签。\n     */\n    public static BUTTON_8 = 7;\n\n    /**\n     * @en Mouse movement on x axis of the UI coordinate system.\n     * @zh 鼠标在 UI 坐标系下 X 轴上的移动距离\n     */\n    public movementX = 0;\n\n    /**\n     * @en Mouse movement on y axis of the UI coordinate system.\n     * @zh 鼠标在 UI 坐标系下 Y 轴上的移动距离\n     */\n    public movementY = 0;\n\n    /**\n     * @en Set whether to prevent events from being swallowed by nodes, which is false by default.\n     * If set to true, the event is allowed to be dispatched to nodes at the bottom layer.\n     * NOTE: Setting to true will reduce the efficiency of event dispatching.\n     *\n     * @zh 设置是否阻止事件被节点吞噬, 默认为 false 。\n     * 如果设置为 true，则事件允许派发给渲染在下一层级的节点。\n     * 注意：设置为 true 会降低事件派发的效率。\n     *\n     * @experimental May be optimized in the future.\n     */\n    public preventSwallow = false;\n\n    private _eventType: SystemEventTypeUnion;\n    /**\n     * @en The type of the event\n     * @zh 鼠标事件类型\n     *\n     * @deprecated since v3.3, please use EventMouse.prototype.type instead.\n     */\n    public get eventType () {\n        return this._eventType;\n    }\n\n    private _button: number = EventMouse.BUTTON_MISSING;\n\n    private _x = 0;\n\n    private _y = 0;\n\n    private _prevX = 0;\n\n    private _prevY = 0;\n\n    private _scrollX = 0;\n\n    private _scrollY = 0;\n\n    /**\n     * @param eventType - The type of the event\n     * @param bubbles - Indicate whether the event bubbles up through the hierarchy or not.\n     */\n    constructor (eventType: SystemEventTypeUnion, bubbles?: boolean, prevLoc?: Vec2) {\n        super(eventType, bubbles);\n        this._eventType = eventType;\n        if (prevLoc) {\n            this._prevX = prevLoc.x;\n            this._prevY = prevLoc.y;\n        }\n    }\n\n    /**\n     * @en Sets scroll data of the mouse.\n     * @zh 设置鼠标滚轮的滚动数据。\n     * @param scrollX - The scroll value on x axis\n     * @param scrollY - The scroll value on y axis\n     */\n    public setScrollData (scrollX: number, scrollY: number) {\n        this._scrollX = scrollX;\n        this._scrollY = scrollY;\n    }\n\n    /**\n     * @en Returns the scroll value on x axis.\n     * @zh 获取鼠标滚动的 X 轴距离，只有滚动时才有效。\n     */\n    public getScrollX () {\n        return this._scrollX;\n    }\n\n    /**\n     * @en Returns the scroll value on y axis.\n     * @zh 获取滚轮滚动的 Y 轴距离，只有滚动时才有效。\n     */\n    public getScrollY () {\n        return this._scrollY;\n    }\n\n    /**\n     * @en Sets cursor location.\n     * @zh 设置当前鼠标位置。\n     * @param x - The location on x axis\n     * @param y - The location on y axis\n     */\n    public setLocation (x: number, y: number) {\n        this._x = x;\n        this._y = y;\n    }\n\n    /**\n     * @en Returns cursor location.\n     * @zh 获取鼠标相对于左下角位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, this._x, this._y);\n        return out;\n    }\n\n    /**\n     * @en Returns the current cursor location in game view coordinates.\n     * @zh 获取当前事件在游戏窗口内的坐标位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getLocationInView (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, this._x, legacyCC.view._designResolutionSize.height - this._y);\n        return out;\n    }\n\n    /**\n     * @en Returns the current cursor location in ui coordinates.\n     * @zh 获取当前事件在 UI 窗口内的坐标位置，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUILocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, this._x, this._y);\n        legacyCC.view._convertToUISpace(out);\n        return out;\n    }\n\n    /**\n     * @en Returns the previous touch location.\n     * @zh 获取鼠标点击在上一次事件时的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getPreviousLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, this._prevX, this._prevY);\n        return out;\n    }\n\n    /**\n     * @en Returns the previous touch location.\n     * @zh 获取鼠标点击在上一次事件时的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUIPreviousLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, this._prevX, this._prevY);\n        legacyCC.view._convertToUISpace(out);\n        return out;\n    }\n\n    /**\n     * @en Returns the delta distance from the previous location to current location.\n     * @zh 获取鼠标距离上一次事件移动的距离对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getDelta (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, this._x - this._prevX, this._y - this._prevY);\n        return out;\n    }\n\n    /**\n     * @en Returns the X axis delta distance from the previous location to current location.\n     * @zh 获取鼠标距离上一次事件移动的 X 轴距离。\n     */\n    public getDeltaX () {\n        return this._x - this._prevX;\n    }\n\n    /**\n     * @en Returns the Y axis delta distance from the previous location to current location.\n     * @zh 获取鼠标距离上一次事件移动的 Y 轴距离。\n     */\n    public getDeltaY () {\n        return this._y - this._prevY;\n    }\n\n    /**\n     * @en Returns the delta distance from the previous location to current location in the UI coordinates.\n     * @zh 获取鼠标距离上一次事件移动在 UI 坐标系下的距离对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUIDelta (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        Vec2.set(out, (this._x - this._prevX) / legacyCC.view.getScaleX(), (this._y - this._prevY) / legacyCC.view.getScaleY());\n        return out;\n    }\n\n    /**\n     * @en Returns the X axis delta distance from the previous location to current location in the UI coordinates.\n     * @zh 获取鼠标距离上一次事件移动在 UI 坐标系下的 X 轴距离。\n     */\n    public getUIDeltaX () {\n        return (this._x - this._prevX) / legacyCC.view.getScaleX();\n    }\n\n    /**\n     * @en Returns the Y axis delta distance from the previous location to current location in the UI coordinates.\n     * @zh 获取鼠标距离上一次事件移动在 UI 坐标系下的 Y 轴距离。\n     */\n    public getUIDeltaY () {\n        return (this._y - this._prevY) / legacyCC.view.getScaleY();\n    }\n\n    /**\n     * @en Sets mouse button code.\n     * @zh 设置鼠标按键。\n     * @param button - The button code\n     */\n    public setButton (button: number) {\n        this._button = button;\n    }\n\n    /**\n     * @en Returns mouse button code.\n     * @zh 获取鼠标按键。\n     */\n    public getButton () {\n        return this._button;\n    }\n\n    /**\n     * @en Returns location data on X axis.\n     * @zh 获取鼠标当前 X 轴位置。\n     */\n    public getLocationX () {\n        return this._x;\n    }\n\n    /**\n     * @en Returns location data on Y axis.\n     * @zh 获取鼠标当前 Y 轴位置。\n     */\n    public getLocationY () {\n        return this._y;\n    }\n\n    /**\n     * @en Returns location data on X axis.\n     * @zh 获取鼠标当前 X 轴位置。\n     */\n    public getUILocationX () {\n        const viewport = legacyCC.view.getViewportRect();\n        return (this._x - viewport.x) / legacyCC.view.getScaleX();\n    }\n\n    /**\n     * @en Returns location data on Y axis.\n     * @zh 获取鼠标当前 Y 轴位置。\n     */\n    public getUILocationY () {\n        const viewport = legacyCC.view.getViewportRect();\n        return (this._y - viewport.y) / legacyCC.view.getScaleY();\n    }\n}\n\n// @ts-expect-error TODO\nEvent.EventMouse = EventMouse;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Event } from './event';\nimport { Vec2 } from '../../../core/math/vec2';\nimport { Touch } from '../touch';\nimport { SystemEventTypeUnion } from '../event-enum';\n\nconst _vec2 = new Vec2();\n\n/**\n * @en\n * The touch event.\n *\n * @zh\n * 触摸事件。\n */\nexport class EventTouch extends Event {\n    /**\n     * @en The maximum touch point numbers simultaneously\n     * @zh 同时存在的最大触点数量。\n     */\n    public static MAX_TOUCHES = 5;\n\n    /**\n     * @en The current touch object\n     * @zh 当前触点对象\n     */\n    public touch: Touch | null = null;\n    /**\n     * @en Indicate whether the touch event is simulated or real\n     * @zh 表示触摸事件是真实触点触发的还是模拟的\n     */\n    public simulate = false;\n\n    /**\n     * @en Set whether to prevent events from being swallowed by nodes, which is false by default.\n     * If set to true, the event is allowed to be dispatched to nodes at the bottom layer.\n     * NOTE: Setting to true will reduce the efficiency of event dispatching.\n     *\n     * @zh 设置是否阻止事件被节点吞噬, 默认为 false 。\n     * 如果设置为 true，则事件允许派发给渲染在下一层级的节点。\n     * 注意：设置为 true 会降低事件派发的效率。\n     *\n     * @experimental May be optimized in the future.\n     */\n    public preventSwallow = false;\n\n    private _eventCode: SystemEventTypeUnion;  // deprecated since v3.3\n\n    private _touches: Touch[];\n\n    private _allTouches: Touch[];\n\n    /**\n     * @param touches - An array of current touches\n     * @param bubbles - Indicate whether the event bubbles up through the hierarchy or not.\n     * @param eventType - The type of the event\n     */\n    constructor (changedTouches: Touch[], bubbles: boolean, eventType: SystemEventTypeUnion, touches: Touch[] = []) {\n        super(eventType, bubbles);\n        this._eventCode = eventType;\n        this._touches = changedTouches || [];\n        this._allTouches = touches;\n    }\n\n    /**\n     * @en Returns event type code.\n     * @zh 获取触摸事件类型。\n     *\n     * @deprecated since v3.3, please use EventTouch.prototype.type instead.\n     */\n    public getEventCode () {\n        return this._eventCode;\n    }\n\n    /**\n     * @en Returns touches of event.\n     * @zh 获取有变动的触摸点的列表。\n     * 注意：第一根手指按下不动，接着按第二根手指，这时候触点信息就只有变动的这根手指（第二根手指）的信息。\n     * 如果需要获取全部手指的信息，请使用 `getAllTouches`。\n     */\n    public getTouches () {\n        return this._touches;\n    }\n\n    /**\n     * @en Returns touches of event.\n     * @zh 获取所有触摸点的列表。\n     * 注意：如果手指行为是 touch end，这个时候列表是没有该手指信息的。如需知道该手指信息，可通过 `getTouches` 获取识别。\n     */\n    public getAllTouches () {\n        return this._allTouches;\n    }\n\n    /**\n     * @en Sets touch location.\n     * @zh 设置当前触点位置\n     * @param x - The current touch location on the x axis\n     * @param y - The current touch location on the y axis\n     */\n    public setLocation (x: number, y: number) {\n        if (this.touch) {\n            this.touch.setTouchInfo(this.touch.getID(), x, y);\n        }\n    }\n\n    /**\n     * @en Returns the current touch location.\n     * @zh 获取触点位置。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getLocation (out?: Vec2) {\n        return this.touch ? this.touch.getLocation(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the current touch location in UI coordinates.\n     * @zh 获取 UI 坐标系下的触点位置。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUILocation (out?: Vec2) {\n        return this.touch ? this.touch.getUILocation(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the current touch location in game screen coordinates.\n     * @zh 获取当前触点在游戏窗口中的位置。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getLocationInView (out?: Vec2) {\n        return this.touch ? this.touch.getLocationInView(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the previous touch location.\n     * @zh 获取触点在上一次事件时的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getPreviousLocation (out?: Vec2) {\n        return this.touch ? this.touch.getPreviousLocation(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the start touch location.\n     * @zh 获取触点落下时的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getStartLocation (out?: Vec2) {\n        return this.touch ? this.touch.getStartLocation(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the start touch location in UI coordinates.\n     * @zh 获取触点落下时的 UI 世界下位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUIStartLocation (out?: Vec2) {\n        return this.touch ? this.touch.getUIStartLocation(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the id of the current touch point.\n     * @zh 获取触点的标识 ID，可以用来在多点触摸中跟踪触点。\n     */\n    public getID () {\n        return this.touch ? this.touch.getID() : null;\n    }\n\n    /**\n     * @en Returns the delta distance from the previous location to current location.\n     * @zh 获取触点距离上一次事件移动的距离对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getDelta (out?: Vec2) {\n        return this.touch ? this.touch.getDelta(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the delta distance from the previous location to current location.\n     * @zh 获取触点距离上一次事件 UI 世界下移动的距离对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n    */\n    public getUIDelta (out?: Vec2) {\n        return this.touch ? this.touch.getUIDelta(out) : new Vec2();\n    }\n\n    /**\n     * @en Returns the X axis delta distance from the previous location to current location.\n     * @zh 获取触点距离上一次事件移动的 x 轴距离。\n     */\n    public getDeltaX () {\n        return this.touch ? this.touch.getDelta(_vec2).x : 0;\n    }\n\n    /**\n     * @en Returns the Y axis delta distance from the previous location to current location.\n     * @zh 获取触点距离上一次事件移动的 y 轴距离。\n     */\n    public getDeltaY () {\n        return this.touch ? this.touch.getDelta(_vec2).y : 0;\n    }\n\n    /**\n     * @en Returns location X axis data.\n     * @zh 获取当前触点 X 轴位置。\n     */\n    public getLocationX () {\n        return this.touch ? this.touch.getLocationX() : 0;\n    }\n\n    /**\n     * @en Returns location Y axis data.\n     * @zh 获取当前触点 Y 轴位置。\n     */\n    public getLocationY () {\n        return this.touch ? this.touch.getLocationY() : 0;\n    }\n}\n\n// @ts-expect-error TODO\nEvent.EventTouch = EventTouch;\n","/**\n * @en Enum type of keyCode for key event\n * @zh 按键事件的按键码\n */\nexport enum KeyCode {\n    /**\n    * @en None\n    * @zh 没有分配\n    */\n    NONE = 0,\n\n    /**\n     * @en The back key on mobile phone\n     * @zh 移动端返回键\n     */\n    MOBILE_BACK = 6,\n\n    /**\n    * @en The backspace key\n    * @zh 退格键\n    */\n    BACKSPACE = 8,\n\n    /**\n    * @en The tab key\n    * @zh Tab 键\n    */\n    TAB = 9,\n\n    /**\n    * @en The enter key\n    * @zh 回车键\n    */\n    ENTER = 13,\n\n    /**\n    * @en The left shift key\n    * @zh 左 Shift 键\n    */\n    SHIFT_LEFT = 16,\n\n    /**\n    * @en The left ctrl key\n    * @zh 左 Ctrl 键\n    */\n    CTRL_LEFT = 17,\n\n    /**\n    * @en The left alt key\n    * @zh 左 Alt 键\n    */\n    ALT_LEFT = 18,\n\n    /**\n    * @en The pause key\n    * @zh 暂停键\n    */\n    PAUSE = 19,\n\n    /**\n    * @en The caps lock key\n    * @zh 大写锁定键\n    */\n    CAPS_LOCK = 20,\n\n    /**\n    * @en The esc key\n    * @zh ESC 键\n    */\n    ESCAPE = 27,\n\n    /**\n    * @en The space key\n    * @zh 空格键\n    */\n    SPACE = 32,\n\n    /**\n    * @en The page up key\n    * @zh 向上翻页键\n    */\n    PAGE_UP = 33,\n\n    /**\n    * @en The page down key\n    * @zh 向下翻页键\n    */\n    PAGE_DOWN = 34,\n\n    /**\n    * @en The end key\n    * @zh 结束键\n    */\n    END = 35,\n\n    /**\n    * @en The home key\n    * @zh 主菜单键\n    */\n    HOME = 36,\n\n    /**\n    * @en The left key\n    * @zh 向左箭头键\n    */\n    ARROW_LEFT = 37,\n\n    /**\n    * @en The up key\n    * @zh 向上箭头键\n    */\n    ARROW_UP = 38,\n\n    /**\n    * @en The right key\n    * @zh 向右箭头键\n    */\n    ARROW_RIGHT = 39,\n\n    /**\n    * @en The down key\n    * @zh 向下箭头键\n    */\n    ARROW_DOWN = 40,\n\n    /**\n    * @en The insert key\n    * @zh 插入键\n    */\n    INSERT = 45,\n\n    /**\n    * @en The Delete key\n    * @zh 删除键\n    */\n    DELETE = 46,\n\n    /**\n    * @en The '0' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 0 键\n    */\n    DIGIT_0 = 48,\n\n    /**\n    * @en The '1' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 1 键\n    */\n    DIGIT_1 = 49,\n\n    /**\n    * @en The '2' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 2 键\n    */\n    DIGIT_2 = 50,\n\n    /**\n    * @en The '3' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 3 键\n    */\n    DIGIT_3 = 51,\n\n    /**\n    * @en The '4' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 4 键\n    */\n    DIGIT_4 = 52,\n\n    /**\n    * @en The '5' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 5 键\n    */\n    DIGIT_5 = 53,\n\n    /**\n    * @en The '6' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 6 键\n    */\n    DIGIT_6 = 54,\n\n    /**\n    * @en The '7' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 7 键\n    */\n    DIGIT_7 = 55,\n\n    /**\n    * @en The '8' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 8 键\n    */\n    DIGIT_8 = 56,\n\n    /**\n    * @en The '9' key on the top of the alphanumeric keyboard.\n    * @zh 字母键盘上的 9 键\n    */\n    DIGIT_9 = 57,\n\n    /**\n    * @en The a key\n    * @zh A 键\n    */\n    KEY_A = 65,\n\n    /**\n    * @en The b key\n    * @zh B 键\n    */\n    KEY_B = 66,\n\n    /**\n    * @en The c key\n    * @zh C 键\n    */\n    KEY_C = 67,\n\n    /**\n    * @en The d key\n    * @zh D 键\n    */\n    KEY_D = 68,\n\n    /**\n    * @en The e key\n    * @zh E 键\n    */\n    KEY_E = 69,\n\n    /**\n    * @en The f key\n    * @zh F 键\n    */\n    KEY_F = 70,\n\n    /**\n    * @en The g key\n    * @zh G 键\n    */\n    KEY_G = 71,\n\n    /**\n    * @en The h key\n    * @zh H 键\n    */\n    KEY_H = 72,\n\n    /**\n    * @en The i key\n    * @zh I 键\n    */\n    KEY_I = 73,\n\n    /**\n    * @en The j key\n    * @zh J 键\n    */\n    KEY_J = 74,\n\n    /**\n    * @en The k key\n    * @zh K 键\n    */\n    KEY_K = 75,\n\n    /**\n    * @en The l key\n    * @zh L 键\n    */\n    KEY_L = 76,\n\n    /**\n    * @en The m key\n    * @zh M 键\n    */\n    KEY_M = 77,\n\n    /**\n    * @en The n key\n    * @zh N 键\n    */\n    KEY_N = 78,\n\n    /**\n    * @en The o key\n    * @zh O 键\n    */\n    KEY_O = 79,\n\n    /**\n    * @en The p key\n    * @zh P 键\n    */\n    KEY_P = 80,\n\n    /**\n    * @en The q key\n    * @zh Q 键\n    */\n    KEY_Q = 81,\n\n    /**\n    * @en The r key\n    * @zh R 键\n    */\n    KEY_R = 82,\n\n    /**\n    * @en The s key\n    * @zh S 键\n    */\n    KEY_S = 83,\n\n    /**\n    * @en The t key\n    * @zh T 键\n    */\n    KEY_T = 84,\n\n    /**\n    * @en The u key\n    * @zh U 键\n    */\n    KEY_U = 85,\n\n    /**\n    * @en The v key\n    * @zh V 键\n    */\n    KEY_V = 86,\n\n    /**\n    * @en The w key\n    * @zh W 键\n    */\n    KEY_W = 87,\n\n    /**\n    * @en The x key\n    * @zh X 键\n    */\n    KEY_X = 88,\n\n    /**\n    * @en The y key\n    * @zh Y 键\n    */\n    KEY_Y = 89,\n\n    /**\n    * @en The z key\n    * @zh Z 键\n    */\n    KEY_Z = 90,\n\n    /**\n    * @en The numeric keypad 0\n    * @zh 数字键盘 0\n    */\n    NUM_0 = 96,\n\n    /**\n    * @en The numeric keypad 1\n    * @zh 数字键盘 1\n    */\n    NUM_1 = 97,\n\n    /**\n    * @en The numeric keypad 2\n    * @zh 数字键盘 2\n    */\n    NUM_2 = 98,\n\n    /**\n    * @en The numeric keypad 3\n    * @zh 数字键盘 3\n    */\n    NUM_3 = 99,\n\n    /**\n    * @en The numeric keypad 4\n    * @zh 数字键盘 4\n    */\n    NUM_4 = 100,\n\n    /**\n    * @en The numeric keypad 5\n    * @zh 数字键盘 5\n    */\n    NUM_5 = 101,\n\n    /**\n    * @en The numeric keypad 6\n    * @zh 数字键盘 6\n    */\n    NUM_6 = 102,\n\n    /**\n    * @en The numeric keypad 7\n    * @zh 数字键盘 7\n    */\n    NUM_7 = 103,\n\n    /**\n    * @en The numeric keypad 8\n    * @zh 数字键盘 8\n    */\n    NUM_8 = 104,\n\n    /**\n    * @en The numeric keypad 9\n    * @zh 数字键盘 9\n    */\n    NUM_9 = 105,\n\n    /**\n    * @en The numeric keypad '*'\n    * @zh 数字键盘 *\n    */\n    NUM_MULTIPLY = 106,\n\n    /**\n    * @en The numeric keypad '+'\n    * @zh 数字键盘 +\n    */\n    NUM_PLUS = 107,\n\n    /**\n    * @en The numeric keypad '-'\n    * @zh 数字键盘 -\n    */\n    NUM_SUBTRACT = 109,\n\n    /**\n    * @en The numeric keypad '.'\n    * @zh 数字键盘小数点 '.'\n    */\n    NUM_DECIMAL = 110,\n\n    /**\n    * @en The numeric keypad '/'\n    * @zh 数字键盘 /\n    */\n    NUM_DIVIDE = 111,\n\n    /**\n    * @en The F1 function key\n    * @zh F1 功能键\n    */\n    F1 = 112,\n\n    /**\n    * @en The F2 function key\n    * @zh F2 功能键\n    */\n    F2 = 113,\n\n    /**\n    * @en The F3 function key\n    * @zh F3 功能键\n    */\n    F3 = 114,\n\n    /**\n    * @en The F4 function key\n    * @zh F4 功能键\n    */\n    F4 = 115,\n\n    /**\n    * @en The F5 function key\n    * @zh F5 功能键\n    */\n    F5 = 116,\n\n    /**\n    * @en The F6 function key\n    * @zh F6 功能键\n    */\n    F6 = 117,\n\n    /**\n    * @en The F7 function key\n    * @zh F7 功能键\n    */\n    F7 = 118,\n\n    /**\n    * @en The F8 function key\n    * @zh F8 功能键\n    */\n    F8 = 119,\n\n    /**\n    * @en The F9 function key\n    * @zh F9 功能键\n    */\n    F9 = 120,\n\n    /**\n    * @en The F10 function key\n    * @zh F10 功能键\n    */\n    F10 = 121,\n\n    /**\n    * @en The F11 function key\n    * @zh F11 功能键\n    */\n    F11 = 122,\n\n    /**\n    * @en The F12 function key\n    * @zh F12 功能键\n    */\n    F12 = 123,\n\n    /**\n    * @en The numlock key\n    * @zh 数字锁定键\n    */\n    NUM_LOCK = 144,\n\n    /**\n    * @en The scroll lock key\n    * @zh 滚动锁定键\n    */\n    SCROLL_LOCK = 145,\n\n    /**\n    * @en The ';' key.\n    * @zh 分号键\n    */\n    SEMICOLON = 186,\n\n    /**\n    * @en The '=' key.\n    * @zh 等于号键\n    */\n    EQUAL = 187,\n\n    /**\n    * @en The ',' key.\n    * @zh 逗号键\n    */\n    COMMA = 188,\n\n    /**\n    * @en The dash '-' key.\n    * @zh 中划线键\n    */\n    DASH = 189,\n\n    /**\n    * @en The '.' key\n    * @zh 句号键\n    */\n    PERIOD = 190,\n\n    /**\n    * @en The slash key '/'\n    * @zh 正斜杠键 '/'\n    */\n    SLASH = 191,\n\n    /**\n    * @en The back quote key `\n    * @zh 按键 `\n    */\n    BACK_QUOTE = 192,\n\n    /**\n    * @en The '[' key\n    * @zh 按键 [\n    */\n    BRACKET_LEFT = 219,\n\n    /**\n    * @en The back slash key '\\'\n    * @zh 反斜杠键 '\\'\n    */\n    BACKSLASH = 220,\n\n    /**\n    * @en The ']' key\n    * @zh 按键 ]\n    */\n    BRACKET_RIGHT = 221,\n\n    /**\n    * @en The quote key\n    * @zh 单引号键\n    */\n    QUOTE = 222,\n\n// #region The new allocated key enum since v3.3\n\n    /**\n    * @en The right shift key\n    * @zh 右 Shift 键\n    */\n    SHIFT_RIGHT = 2000,\n\n    /**\n    * @en The right ctrl key\n    * @zh 右 Ctrl 键\n    */\n    CTRL_RIGHT = 2001,\n\n    /**\n    * @en The right alt key\n    * @zh 右 Alt 键\n    */\n    ALT_RIGHT = 2002,\n\n    /**\n    * @en The numeric keypad enter\n    * @zh 数字键盘 enter\n    */\n    NUM_ENTER = 2003,\n\n// #endregion The new allocated key enum since v3.3\n}\n","/*\n Copyright (c) 2022 Chukong Technologies Inc.\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/**\n * @packageDocumentation\n * @module event\n */\n\nimport { GamepadInputDevice as Gamepad } from 'pal/input';\nimport { Event } from './event';\n\n/**\n  * @en\n  * The gamepad event.\n  * @zh\n  * 手柄事件。\n  */\nexport class EventGamepad extends Event {\n    /**\n     * @en The gamepad device which trigger the current gamepad event\n     * @zh 触发当前手柄事件的手柄设备\n     */\n    public gamepad: Gamepad;\n\n    constructor (type: string, gamepad: Gamepad) {\n        super(type, false);\n        this.gamepad = gamepad;\n    }\n}\n","/**\n * @en the device accelerometer reports values for each axis in units of g-force.\n * @zh 设备重力传感器传递的各个轴的数据。\n */\nexport class Acceleration {\n    public x: number;\n    public y: number;\n    public z: number;\n    public timestamp: number;\n    constructor (x = 0, y = 0, z = 0, timestamp = 0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.timestamp = timestamp;\n    }\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { HandleInputDevice } from 'pal/input';\nimport { Event } from './event';\nimport { SystemEventTypeUnion } from '../event-enum';\n\n/**\n * @en\n * The 6DOF handle event.\n *\n * @zh\n * 6DOF手柄事件。\n */\nexport class EventHandle extends Event {\n    /**\n     * @en The handle device which trigger the current handle event\n     * @zh 触发当前手柄事件的手柄设备\n     */\n     public handleInputDevice: HandleInputDevice;\n\n    /**\n     * @param eventType - The type of the event\n     * @param handleInputDevice - The handle device which trigger the current handle event\n     */\n    constructor (eventType: SystemEventTypeUnion, handleInputDevice: HandleInputDevice) {\n        super(eventType, false);\n        this.handleInputDevice = handleInputDevice;\n    }\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { HMDInputDevice } from 'pal/input';\nimport { Event } from './event';\nimport { SystemEventTypeUnion } from '../event-enum';\n\n/**\n * @en\n * The HMD event.\n *\n * @zh\n * 头戴显示器事件。\n */\nexport class EventHMD extends Event {\n    /**\n     * @en The hmd device which trigger the current hmd event\n     * @zh 触发当前头戴显示器事件的头戴显示器设备\n     */\n     public hmdInputDevice: HMDInputDevice;\n\n    /**\n     * @param eventType - The type of the event\n     * @param hmdInputDevice - The hmd device which trigger the current hmd event\n     */\n    constructor (eventType: SystemEventTypeUnion, hmdInputDevice: HMDInputDevice) {\n        super(eventType, false);\n        this.hmdInputDevice = hmdInputDevice;\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Vec2 } from '../../core/math';\nimport { legacyCC } from '../../core/global-exports';\n\nconst _vec2 = new Vec2();\n/**\n * @en The touch point class\n * @zh 封装了触点相关的信息。\n */\nexport class Touch {\n    private _point: Vec2 = new Vec2();\n    private _prevPoint: Vec2 = new Vec2();\n    private _lastModified = 0;\n    private _id = 0;\n    private _startPoint: Vec2 = new Vec2();\n    private _startPointCaptured = false;\n\n    get lastModified () {\n        return this._lastModified;\n    }\n\n    /**\n     * @param x - x position of the touch point\n     * @param y - y position of the touch point\n     * @param id - The id of the touch point\n     */\n    constructor (x: number, y: number, id = 0) {\n        this.setTouchInfo(id, x, y);\n    }\n\n    /**\n     * @en Returns the current touch location in OpenGL coordinates.、\n     * @zh 获取当前触点位置。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._point.x, this._point.y);\n        return out;\n    }\n\n    /**\n     * @en Returns X axis location value.\n     * @zh 获取当前触点 X 轴位置。\n     */\n    public getLocationX () {\n        return this._point.x;\n    }\n\n    /**\n     * @en Returns Y axis location value.\n     * @zh 获取当前触点 Y 轴位置。\n     */\n    public getLocationY () {\n        return this._point.y;\n    }\n\n    /**\n     * @en Returns the current touch location in UI coordinates.、\n     * @zh 获取当前触点在 UI 坐标系中的位置。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUILocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._point.x, this._point.y);\n        legacyCC.view._convertToUISpace(out);\n        return out;\n    }\n\n    /**\n     * @en Returns X axis location value in UI coordinates.\n     * @zh 获取当前触点在 UI 坐标系中 X 轴位置。\n     */\n    public getUILocationX () {\n        const viewport = legacyCC.view.getViewportRect();\n        return (this._point.x - viewport.x) / legacyCC.view.getScaleX();\n    }\n\n    /**\n     * @en Returns Y axis location value in UI coordinates.\n     * @zh 获取当前触点在 UI 坐标系中 Y 轴位置。\n     */\n    public getUILocationY () {\n        const viewport = legacyCC.view.getViewportRect();\n        return (this._point.y - viewport.y) / legacyCC.view.getScaleY();\n    }\n\n    /**\n     * @en Returns the previous touch location.\n     * @zh 获取触点在上一次事件时的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getPreviousLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._prevPoint.x, this._prevPoint.y);\n        return out;\n    }\n\n    /**\n     * @en Returns the previous touch location in UI coordinates.\n     * @zh 获取触点在上一次事件时在 UI 坐标系中的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUIPreviousLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._prevPoint.x, this._prevPoint.y);\n        legacyCC.view._convertToUISpace(out);\n        return out;\n    }\n\n    /**\n     * @en Returns the start touch location.\n     * @zh 获取触点落下时的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getStartLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._startPoint.x, this._startPoint.y);\n        return out;\n    }\n\n    /**\n     * @en Returns the start touch location in UI coordinates.\n     * @zh 获取触点落下时在 UI 坐标系中的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUIStartLocation (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._startPoint.x, this._startPoint.y);\n        legacyCC.view._convertToUISpace(out);\n        return out;\n    }\n\n    /**\n     * @en Returns the delta distance from the previous touche to the current one.\n     * @zh 获取触点距离上一次事件移动的距离对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getDelta (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._point);\n        out.subtract(this._prevPoint);\n        return out;\n    }\n\n    /**\n     * @en Returns the delta distance from the previous touche to the current one in UI coordinates.\n     * @zh 获取触点距离上一次事件移动在 UI 坐标系中的距离对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getUIDelta (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        _vec2.set(this._point);\n        _vec2.subtract(this._prevPoint);\n        out.set(legacyCC.view.getScaleX(), legacyCC.view.getScaleY());\n        Vec2.divide(out, _vec2, out);\n        return out;\n    }\n\n    /**\n     * @en Returns the current touch location in screen coordinates.\n     * @zh 获取当前事件在游戏窗口内的坐标位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getLocationInView (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._point.x, legacyCC.view._designResolutionSize.height - this._point.y);\n        return out;\n    }\n\n    /**\n     * @en Returns the previous touch location in screen coordinates.\n     * @zh 获取触点在上一次事件时在游戏窗口中的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getPreviousLocationInView (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._prevPoint.x, legacyCC.view._designResolutionSize.height - this._prevPoint.y);\n        return out;\n    }\n\n    /**\n     * @en Returns the start touch location in screen coordinates.\n     * @zh 获取触点落下时在游戏窗口中的位置对象，对象包含 x 和 y 属性。\n     * @param out - Pass the out object to avoid object creation, very good practice\n     */\n    public getStartLocationInView (out?: Vec2) {\n        if (!out) {\n            out = new Vec2();\n        }\n\n        out.set(this._startPoint.x, legacyCC.view._designResolutionSize.height - this._startPoint.y);\n        return out;\n    }\n\n    /**\n     * @en Returns the id of the touch point.\n     * @zh 触点的标识 ID，可以用来在多点触摸中跟踪触点。\n     */\n    public getID () {\n        return this._id;\n    }\n\n    /**\n     * @en Resets touch point information.\n     * @zh 重置触点相关的信息。\n     * @param id - The id of the touch point\n     * @param x - x position of the touch point\n     * @param y - y position of the touch point\n     */\n    public setTouchInfo (id = 0, x?: number, y?: number) {\n        this._prevPoint = this._point;\n        this._point = new Vec2(x || 0, y || 0);\n        this._id = id;\n        if (!this._startPointCaptured) {\n            this._startPoint = new Vec2(this._point);\n            // cc.view._convertToUISpace(this._startPoint);\n            this._startPointCaptured = true;\n        }\n    }\n\n    /**\n     * @en Sets touch point location.\n     * @zh 设置触点位置。\n     * @param point - The location\n     */\n    public setPoint (point: Vec2): void;\n\n    /**\n     * @en Sets touch point location.\n     * @zh 设置触点位置。\n     * @param x - x position\n     * @param y - y position\n     */\n    public setPoint (x: number, y: number): void;\n\n    public setPoint (x: number | Vec2, y?: number) {\n        if (typeof x === 'object') {\n            this._point.x = x.x;\n            this._point.y = x.y;\n        } else {\n            this._point.x = x || 0;\n            this._point.y = y || 0;\n        }\n        this._lastModified = legacyCC.game.frameStartTime;\n    }\n\n    /**\n     * @en Sets the location previously registered for the current touch.\n     * @zh 设置触点在前一次触发时收集的位置。\n     * @param point - The location\n     */\n    public setPrevPoint (point: Vec2): void;\n\n    /**\n     * @en Sets the location previously registered for the current touch.\n     * @zh 设置触点在前一次触发时收集的位置。\n     * @param x - x position\n     * @param y - y position\n     */\n    public setPrevPoint (x: number, y: number): void;\n\n    public setPrevPoint (x: number | Vec2, y?: number) {\n        if (typeof x === 'object') {\n            this._prevPoint = new Vec2(x.x, x.y);\n        } else {\n            this._prevPoint = new Vec2(x || 0, y || 0);\n        }\n        this._lastModified = legacyCC.game.frameStartTime;\n    }\n}\n\nlegacyCC.Touch = Touch;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { CallbacksInvoker } from '../event/callbacks-invoker';\nimport { Event, EventMouse, EventTouch, Touch } from '../../input/types';\nimport { Vec2 } from '../math/vec2';\nimport { BaseNode } from './base-node';\nimport { Node } from './node';\nimport { legacyCC } from '../global-exports';\nimport { Component } from '../components/component';\nimport { NodeEventType } from './node-event';\nimport { InputEventType, SystemEventTypeUnion } from '../../input/types/event-enum';\n\nconst _cachedArray = new Array<BaseNode>(16);\nlet _currentHovered: BaseNode | null = null;\nconst pos = new Vec2();\n\nconst _touchEvents = [\n    NodeEventType.TOUCH_START,\n    NodeEventType.TOUCH_MOVE,\n    NodeEventType.TOUCH_END,\n    NodeEventType.TOUCH_CANCEL,\n];\n\nconst _mouseEvents = [\n    NodeEventType.MOUSE_DOWN,\n    NodeEventType.MOUSE_ENTER,\n    NodeEventType.MOUSE_MOVE,\n    NodeEventType.MOUSE_LEAVE,\n    NodeEventType.MOUSE_UP,\n    NodeEventType.MOUSE_WHEEL,\n];\n\nexport interface IMask {\n    index: number;\n    comp: Component;\n}\n\nexport enum DispatcherEventType {\n    ADD_POINTER_EVENT_PROCESSOR,\n    REMOVE_POINTER_EVENT_PROCESSOR,\n    MARK_LIST_DIRTY,\n}\n\n/**\n * @en The event processor for Node\n * @zh 节点事件类。\n */\nexport class NodeEventProcessor {\n    /**\n     * @internal\n     */\n    public static _maskComp: Constructor<Component> | null = null;\n    /**\n     * @internal\n     */\n    public static callbacksInvoker = new CallbacksInvoker<DispatcherEventType>();\n\n    /**\n     * Whether the node event is enabled\n     */\n    public get isEnabled () {\n        return this._isEnabled;\n    }\n\n    /**\n     * The list of claimed touch ids\n     */\n    public claimedTouchIdList: number[] = [];\n\n    /**\n     * The masks in the parent chain of the node\n     */\n    public maskList: IMask[] | null = null;\n\n    /**\n     * To cache camera priority.\n     */\n    public cachedCameraPriority = 0;\n\n    /**\n     * To record whether the mouse move in at the previous mouse event.\n     */\n    public previousMouseIn = false;\n\n    /**\n     * The owner of node event processor.\n     */\n    public get node () {\n        return this._node;\n    }\n\n    /**\n     * Target in bubbling phase.\n     */\n    public bubblingTarget: CallbacksInvoker<SystemEventTypeUnion> | null = null;\n\n    /**\n     * Target in capturing phase.\n     */\n    public capturingTarget: CallbacksInvoker<SystemEventTypeUnion> | null = null;\n\n    /**\n     * Whether the node has registered the mouse event callback\n     */\n    public shouldHandleEventMouse = false;\n    /**\n     * Whether the node has registered the touch event callback\n     */\n    public shouldHandleEventTouch = false;\n\n    // Whether dispatch cancel event when node is destroyed.\n    private _dispatchingTouch: Touch | null = null;\n    private _isEnabled = false;\n    private _node: Node;\n\n    constructor (node: Node) {\n        this._node = node;\n    }\n\n    /**\n     * Set enable state of the node event processor\n     * @param value Enable state\n     * @param recursive Recursively set the state or not\n     * @returns void\n     */\n    public setEnabled (value: boolean, recursive = false) {\n        if (this._isEnabled === value) {\n            return;\n        }\n        this._isEnabled = value;\n        const node = this.node;\n        const children = node.children;\n        if (value) {\n            this._attachMask();\n        }\n        NodeEventProcessor.callbacksInvoker.emit(DispatcherEventType.MARK_LIST_DIRTY);\n        if (recursive && children.length > 0) {\n            for (let i = 0; i < children.length; ++i) {\n                const child = children[i];\n                // @ts-expect-error child._eventProcessor is a protected property.\n                child._eventProcessor.setEnabled(value, true);\n            }\n        }\n    }\n\n    public reattach (): void {\n        let currentMaskList: IMask[] | null;\n        this.node.walk((node) => {\n            if (!currentMaskList) {\n                currentMaskList = this._searchComponentsInParent(NodeEventProcessor._maskComp);\n            }\n            node.eventProcessor.maskList = currentMaskList;\n        });\n    }\n\n    public destroy (): void {\n        if (_currentHovered === this._node) {\n            _currentHovered = null;\n        }\n\n        if (this.capturingTarget) this.capturingTarget.clear();\n        if (this.bubblingTarget) this.bubblingTarget.clear();\n        NodeEventProcessor.callbacksInvoker.emit(DispatcherEventType.REMOVE_POINTER_EVENT_PROCESSOR, this);\n        if (this._dispatchingTouch) {\n            // Dispatch touch cancel event when node is destroyed.\n            const cancelEvent = new EventTouch([this._dispatchingTouch], true, InputEventType.TOUCH_CANCEL);\n            cancelEvent.touch = this._dispatchingTouch;\n            this.dispatchEvent(cancelEvent);\n            this._dispatchingTouch = null;\n        }\n    }\n\n    public on (type: NodeEventType, callback: AnyFunction, target?: unknown, useCapture?: boolean) {\n        this._tryEmittingAddEvent(type);\n        useCapture = !!useCapture;\n        let invoker: CallbacksInvoker<SystemEventTypeUnion>;\n        if (useCapture) {\n            invoker = this.capturingTarget ??= this._newCallbacksInvoker();\n        } else {\n            invoker = this.bubblingTarget ??= this._newCallbacksInvoker();\n        }\n        invoker.on(type, callback, target);\n        return callback;\n    }\n\n    public once (type: NodeEventType, callback: AnyFunction, target?: unknown, useCapture?: boolean) {\n        this._tryEmittingAddEvent(type);\n        useCapture = !!useCapture;\n        let invoker: CallbacksInvoker<SystemEventTypeUnion>;\n        if (useCapture) {\n            invoker = this.capturingTarget ??= this._newCallbacksInvoker();\n        } else {\n            invoker = this.bubblingTarget ??= this._newCallbacksInvoker();\n        }\n\n        invoker.on(type, callback, target, true);\n        return callback;\n    }\n\n    public off (type: NodeEventType, callback?: AnyFunction, target?: unknown, useCapture?: boolean) {\n        useCapture = !!useCapture;\n        let invoker: CallbacksInvoker<SystemEventTypeUnion> | null;\n        if (useCapture) {\n            invoker = this.capturingTarget;\n        } else {\n            invoker = this.bubblingTarget;\n        }\n        invoker?.off(type, callback, target);\n    }\n\n    public targetOff (target: unknown) {\n        this.capturingTarget?.removeAll(target);\n        this.bubblingTarget?.removeAll(target);\n\n        // emit event\n        if (this.shouldHandleEventTouch && !this._hasTouchListeners()) {\n            this.shouldHandleEventTouch = false;\n        }\n        if (this.shouldHandleEventMouse && !this._hasMouseListeners()) {\n            this.shouldHandleEventMouse = false;\n        }\n        if (!this._hasPointerListeners()) {\n            NodeEventProcessor.callbacksInvoker.emit(DispatcherEventType.REMOVE_POINTER_EVENT_PROCESSOR, this);\n        }\n    }\n\n    public emit (type: SystemEventTypeUnion, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) {\n        this.bubblingTarget?.emit(type, arg0, arg1, arg2, arg3, arg4);\n    }\n\n    public dispatchEvent (event: Event) {\n        const owner = this.node;\n        let target: BaseNode;\n        let i = 0;\n        event.target = owner;\n\n        // Event.CAPTURING_PHASE\n        _cachedArray.length = 0;\n        this.getCapturingTargets(event.type, _cachedArray);\n        // capturing\n        event.eventPhase = 1;\n        for (i = _cachedArray.length - 1; i >= 0; --i) {\n            target = _cachedArray[i];\n            if (target.eventProcessor.capturingTarget) {\n                event.currentTarget = target;\n                // fire event\n                target.eventProcessor.capturingTarget.emit(event.type, event, _cachedArray);\n                // check if propagation stopped\n                if (event.propagationStopped) {\n                    _cachedArray.length = 0;\n                    return;\n                }\n            }\n        }\n        _cachedArray.length = 0;\n\n        // Event.AT_TARGET\n        // checks if destroyed in capturing callbacks\n        event.eventPhase = 2;\n        event.currentTarget = owner;\n        if (this.capturingTarget) {\n            this.capturingTarget.emit(event.type, event);\n        }\n        if (!event.propagationImmediateStopped && this.bubblingTarget) {\n            this.bubblingTarget.emit(event.type, event);\n        }\n\n        if (!event.propagationStopped && event.bubbles) {\n            // Event.BUBBLING_PHASE\n            this.getBubblingTargets(event.type, _cachedArray);\n            // propagate\n            event.eventPhase = 3;\n            for (i = 0; i < _cachedArray.length; ++i) {\n                target = _cachedArray[i];\n                if (target.eventProcessor.bubblingTarget) {\n                    event.currentTarget = target;\n                    // fire event\n                    target.eventProcessor.bubblingTarget.emit(event.type, event);\n                    // check if propagation stopped\n                    if (event.propagationStopped) {\n                        _cachedArray.length = 0;\n                        return;\n                    }\n                }\n            }\n        }\n        _cachedArray.length = 0;\n    }\n\n    public hasEventListener (type: SystemEventTypeUnion, callback?: AnyFunction, target?: unknown) {\n        let has = false;\n        if (this.bubblingTarget) {\n            has = this.bubblingTarget.hasEventListener(type, callback, target);\n        }\n        if (!has && this.capturingTarget) {\n            has = this.capturingTarget.hasEventListener(type, callback, target);\n        }\n        return has;\n    }\n\n    /**\n     * @zh\n     * 获得所提供的事件类型在目标捕获阶段监听的所有目标。\n     * 捕获阶段包括从根节点到目标节点的过程。\n     * 结果保存在数组参数中，并且必须从子节点排序到父节点。\n     *\n     * @param type - 一个监听事件类型的字符串。\n     * @param array - 接收目标的数组。\n     */\n    public getCapturingTargets (type: string, targets: BaseNode[]) {\n        let parent = this._node.parent;\n        while (parent) {\n            if (parent.eventProcessor.capturingTarget?.hasEventListener(type)) {\n                targets.push(parent);\n            }\n            parent = parent.parent;\n        }\n    }\n\n    /**\n     * @zh\n     * 获得所提供的事件类型在目标冒泡阶段监听的所有目标。\n     * 冒泡阶段目标节点到根节点的过程。\n     * 结果保存在数组参数中，并且必须从子节点排序到父节点。\n     *\n     * @param type - 一个监听事件类型的字符串。\n     * @param array - 接收目标的数组。\n     */\n    public getBubblingTargets (type: string, targets: BaseNode[]) {\n        let parent = this._node.parent;\n        while (parent) {\n            if (parent.eventProcessor.bubblingTarget?.hasEventListener(type)) {\n                targets.push(parent);\n            }\n            parent = parent.parent;\n        }\n    }\n\n    private _searchComponentsInParent<T extends Component> (ctor: Constructor<T> | null) {\n        const node = this.node;\n        if (ctor) {\n            let index = 0;\n            let list: IMask[] = [];\n            for (let curr: Node | null = node; curr && Node.isNode(curr); curr = curr.parent, ++index) {\n                const comp = curr.getComponent(ctor);\n                if (comp) {\n                    const next = {\n                        index,\n                        comp,\n                    };\n\n                    if (list) {\n                        list.push(next);\n                    } else {\n                        list = [next];\n                    }\n                }\n            }\n\n            return list.length > 0 ? list : null;\n        }\n\n        return null;\n    }\n\n    private _attachMask () {\n        this.maskList = this._searchComponentsInParent(NodeEventProcessor._maskComp);\n    }\n\n    private _isTouchEvent (type: NodeEventType) {\n        const index = _touchEvents.indexOf(type);\n        return index !== -1;\n    }\n\n    private _isMouseEvent (type: NodeEventType) {\n        const index = _mouseEvents.indexOf(type);\n        return index !== -1;\n    }\n\n    private _hasTouchListeners () {\n        for (let i = 0; i < _touchEvents.length; ++i) {\n            const eventType = _touchEvents[i];\n            if (this.hasEventListener(eventType)) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private _hasMouseListeners () {\n        for (let i = 0; i < _mouseEvents.length; ++i) {\n            const eventType = _mouseEvents[i];\n            if (this.hasEventListener(eventType)) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private _hasPointerListeners () {\n        const has = this._hasTouchListeners();\n        if (has) {\n            return true;\n        }\n        return this._hasMouseListeners();\n    }\n\n    private _tryEmittingAddEvent (typeToAdd: NodeEventType) {\n        const isTouchEvent = this._isTouchEvent(typeToAdd);\n        const isMouseEvent = this._isMouseEvent(typeToAdd);\n        if (isTouchEvent) {\n            this.shouldHandleEventTouch = true;\n        } else if (isMouseEvent) {\n            this.shouldHandleEventMouse = true;\n        }\n        if ((isTouchEvent || isMouseEvent) && !this._hasPointerListeners()) {\n            NodeEventProcessor.callbacksInvoker.emit(DispatcherEventType.ADD_POINTER_EVENT_PROCESSOR, this);\n        }\n    }\n\n    /**\n     * Fix when reigster 'once' event callback, `this.off` method isn't be invoked after event is emitted.\n     * We need to inject some nodeEventProcessor's logic into the `callbacksInvoker.off` method.\n     * @returns {CallbacksInvoker<SystemEventTypeUnion>} decorated callbacks invoker\n     */\n    private _newCallbacksInvoker (): CallbacksInvoker<SystemEventTypeUnion> {\n        const callbacksInvoker = new CallbacksInvoker<SystemEventTypeUnion>();\n        // @ts-expect-error Property '_registerOffCallback' is private\n        callbacksInvoker._registerOffCallback(() => {\n            if (this.shouldHandleEventTouch && !this._hasTouchListeners()) {\n                this.shouldHandleEventTouch = false;\n            }\n            if (this.shouldHandleEventMouse && !this._hasMouseListeners()) {\n                this.shouldHandleEventMouse = false;\n            }\n            if (!this._hasPointerListeners()) {\n                NodeEventProcessor.callbacksInvoker.emit(DispatcherEventType.REMOVE_POINTER_EVENT_PROCESSOR, this);\n            }\n        });\n        return callbacksInvoker;\n    }\n\n    // #region handle mouse event\n\n    private _handleEventMouse (eventMouse: EventMouse): boolean {\n        switch (eventMouse.type) {\n        case InputEventType.MOUSE_DOWN:\n            return this._handleMouseDown(eventMouse);\n        case InputEventType.MOUSE_MOVE:\n            return this._handleMouseMove(eventMouse);\n        case InputEventType.MOUSE_UP:\n            return this._handleMouseUp(eventMouse);\n        case InputEventType.MOUSE_WHEEL:\n            return this._handleMouseWheel(eventMouse);\n        default:\n            return false;\n        }\n    }\n\n    private _handleMouseDown (event: EventMouse): boolean {\n        const node = this._node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return false;\n        }\n\n        event.getLocation(pos);\n\n        if (node._uiProps.uiTransformComp.hitTest(pos)) {\n            event.type = NodeEventType.MOUSE_DOWN;\n            event.bubbles = true;\n            node.dispatchEvent(event);\n            event.propagationStopped = true;\n            return true;\n        }\n        return false;\n    }\n\n    private _handleMouseMove (event: EventMouse): boolean {\n        const node = this._node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return false;\n        }\n\n        event.getLocation(pos);\n\n        const hit = node._uiProps.uiTransformComp.hitTest(pos);\n        if (hit) {\n            if (!this.previousMouseIn) {\n                // Fix issue when hover node switched, previous hovered node won't get MOUSE_LEAVE notification\n                if (_currentHovered && _currentHovered !== node) {\n                    event.type = NodeEventType.MOUSE_LEAVE;\n                    _currentHovered.dispatchEvent(event);\n                    _currentHovered.eventProcessor.previousMouseIn = false;\n                }\n                _currentHovered = node;\n                event.type = NodeEventType.MOUSE_ENTER;\n                node.dispatchEvent(event);\n                this.previousMouseIn = true;\n            }\n            event.type = NodeEventType.MOUSE_MOVE;\n            event.bubbles = true;\n            node.dispatchEvent(event);\n            event.propagationStopped = true;\n            return true;\n        } else if (this.previousMouseIn) {\n            event.type = NodeEventType.MOUSE_LEAVE;\n            node.dispatchEvent(event);\n            this.previousMouseIn = false;\n            _currentHovered = null;\n        }\n        return false;\n    }\n\n    private _handleMouseUp (event: EventMouse): boolean {\n        const node = this._node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return false;\n        }\n\n        event.getLocation(pos);\n\n        if (node._uiProps.uiTransformComp.hitTest(pos)) {\n            event.type = NodeEventType.MOUSE_UP;\n            event.bubbles = true;\n            node.dispatchEvent(event);\n            event.propagationStopped = true;\n            return true;\n        }\n        return false;\n    }\n\n    private _handleMouseWheel (event: EventMouse): boolean {\n        const node = this._node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return false;\n        }\n\n        event.getLocation(pos);\n\n        if (node._uiProps.uiTransformComp.hitTest(pos)) {\n            event.type = NodeEventType.MOUSE_WHEEL;\n            event.bubbles = true;\n            node.dispatchEvent(event);\n            // event.propagationStopped = true;\n            event.propagationStopped = true;\n            return true;\n        }\n        return false;\n    }\n    // #endregion handle mouse event\n\n    // #region handle touch event\n\n    private _handleEventTouch (eventTouch: EventTouch) {\n        switch (eventTouch.type) {\n        case InputEventType.TOUCH_START:\n            return this._handleTouchStart(eventTouch);\n        case InputEventType.TOUCH_MOVE:\n            return this._handleTouchMove(eventTouch);\n        case InputEventType.TOUCH_END:\n            return this._handleTouchEnd(eventTouch);\n        case InputEventType.TOUCH_CANCEL:\n            return this._handleTouchCancel(eventTouch);\n        default:\n            return false;\n        }\n    }\n\n    private _handleTouchStart (event: EventTouch) {\n        const node = this.node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return false;\n        }\n\n        event.getLocation(pos);\n\n        if (node._uiProps.uiTransformComp.hitTest(pos)) {\n            event.type = NodeEventType.TOUCH_START;\n            event.bubbles = true;\n            this._dispatchingTouch = event.touch;\n            node.dispatchEvent(event);\n            return true;\n        }\n\n        return false;\n    }\n\n    private _handleTouchMove (event: EventTouch) {\n        const node = this.node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return false;\n        }\n\n        event.type = NodeEventType.TOUCH_MOVE;\n        event.bubbles = true;\n        this._dispatchingTouch = event.touch;\n        node.dispatchEvent(event);\n        return true;\n    }\n\n    private _handleTouchEnd (event: EventTouch) {\n        const node = this.node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return;\n        }\n\n        event.getLocation(pos);\n\n        if (node._uiProps.uiTransformComp.hitTest(pos)) {\n            event.type = NodeEventType.TOUCH_END;\n        } else {\n            event.type = NodeEventType.TOUCH_CANCEL;\n        }\n        event.bubbles = true;\n        node.dispatchEvent(event);\n        this._dispatchingTouch = null;\n    }\n\n    private _handleTouchCancel (event: EventTouch) {\n        const node = this.node;\n        if (!node || !node._uiProps.uiTransformComp) {\n            return;\n        }\n\n        event.type = NodeEventType.TOUCH_CANCEL;\n        event.bubbles = true;\n        node.dispatchEvent(event);\n    }\n\n    // #endregion handle touch event\n}\n\nlegacyCC.NodeEventProcessor = NodeEventProcessor;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec4 } from '../../math';\nimport { legacyCC } from '../../global-exports';\nimport { AmbientInfo } from '../../scene-graph/scene-globals';\n\n/**\n * @en Ambient lighting representation in the render scene.\n * The initial data is setup in [[SceneGlobals.ambient]].\n * @zh 渲染场景中的环境光照设置。\n * 初始值是由 [[SceneGlobals.ambient]] 设置的。\n */\nexport class Ambient {\n    /**\n     * @en Default sun illuminance\n     * @zh 默认太阳亮度\n     */\n    public static SUN_ILLUM = 65000.0;\n    /**\n     * @en Default sky illuminance\n     * @zh 默认天空亮度\n     */\n    public static SKY_ILLUM = 20000.0;\n\n    /**\n     * @en Enable ambient\n     * @zh 是否开启环境光\n     */\n    set enabled (val: boolean) {\n        this._enabled = val;\n    }\n    get enabled (): boolean {\n        return this._enabled;\n    }\n    /**\n     * @en Sky color\n     * @zh 天空颜色\n     */\n    get skyColor (): Vec4 {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._skyColorHDR;\n        } else {\n            return this._skyColorLDR;\n        }\n    }\n    set skyColor (color: Vec4) {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this._skyColorHDR.set(color);\n        } else {\n            this._skyColorLDR.set(color);\n        }\n    }\n\n    /**\n     * @en Sky illuminance\n     * @zh 天空亮度\n     */\n    get skyIllum (): number {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._skyIllumHDR;\n        } else {\n            return this._skyIllumLDR;\n        }\n    }\n    set skyIllum (illum: number) {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this._skyIllumHDR = illum;\n        } else {\n            this._skyIllumLDR = illum;\n        }\n    }\n    /**\n     * @en Ground color\n     * @zh 地面颜色\n     */\n    get groundAlbedo (): Vec4 {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._groundAlbedoHDR;\n        } else {\n            return this._groundAlbedoLDR;\n        }\n    }\n    set groundAlbedo (color: Vec4) {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this._groundAlbedoHDR.set(color);\n        } else {\n            this._groundAlbedoLDR.set(color);\n        }\n    }\n\n    protected _groundAlbedoHDR = new Vec4(0.2, 0.2, 0.2, 1.0);\n    protected _skyColorHDR = new Vec4(0.2, 0.5, 0.8, 1.0);\n    protected _skyIllumHDR = 0;\n\n    protected _groundAlbedoLDR = new Vec4(0.2, 0.2, 0.2, 1.0);\n    protected _skyColorLDR = new Vec4(0.2, 0.5, 0.8, 1.0);\n    protected _skyIllumLDR = 0;\n\n    protected _mipmapCount = 1;\n\n    protected _enabled = false;\n\n    public initialize (ambientInfo: AmbientInfo) {\n        // Init HDR/LDR from serialized data on load\n        this._skyColorHDR = ambientInfo.skyColorHDR;\n        this._groundAlbedoHDR.set(ambientInfo.groundAlbedoHDR);\n        this._skyIllumHDR = ambientInfo.skyIllumHDR;\n\n        this._skyColorLDR = ambientInfo.skyColorLDR;\n        this._groundAlbedoLDR.set(ambientInfo.groundAlbedoLDR);\n        this._skyIllumLDR = ambientInfo.skyIllumLDR;\n    }\n}\n\nlegacyCC.Ambient = Ambient;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEBUG } from 'internal:constants';\nimport { Material } from '../../assets/material';\nimport { Sphere } from '../../geometry';\nimport { Color, Mat4, Vec3, Vec2 } from '../../math';\nimport { legacyCC } from '../../global-exports';\nimport { Enum } from '../../value-types';\nimport type { ShadowsInfo } from '../../scene-graph/scene-globals';\nimport { IMacroPatch } from '../core/pass';\nimport { Shader } from '../../gfx';\nimport { assert } from '../../platform/debug';\n\n/**\n * @zh 阴影贴图分辨率。\n * @en The shadow map size.\n * @static\n * @enum Shadows.ShadowSize\n */\nexport const ShadowSize = Enum({\n    /**\n     * @zh 分辨率 256 * 256。\n     * @en shadow resolution 256 * 256.\n     * @readonly\n     */\n    Low_256x256: 256,\n\n    /**\n     * @zh 分辨率 512 * 512。\n     * @en shadow resolution 512 * 512.\n     * @readonly\n     */\n    Medium_512x512: 512,\n\n    /**\n     * @zh 分辨率 1024 * 1024。\n     * @en shadow resolution 1024 * 1024.\n     * @readonly\n     */\n    High_1024x1024: 1024,\n\n    /**\n     * @zh 分辨率 2048 * 2048。\n     * @en shadow resolution 2048 * 2048.\n     * @readonly\n     */\n    Ultra_2048x2048: 2048,\n});\n\n/**\n * @zh 阴影类型。\n * @en The shadow type\n * @enum Shadows.ShadowType\n */\nexport const ShadowType = Enum({\n    /**\n     * @zh 平面阴影。\n     * @en Planar shadow\n     * @property Planar\n     * @readonly\n     */\n    Planar: 0,\n\n    /**\n     * @zh 阴影贴图。\n     * @en Shadow type\n     * @property ShadowMap\n     * @readonly\n     */\n    ShadowMap: 1,\n});\n\n/**\n * @zh pcf阴影等级。\n * @en The pcf type\n * @static\n * @enum Shadows.PCFType\n */\nexport const PCFType = Enum({\n    /**\n     * @zh x1 次采样\n     * @en x1 times\n     * @readonly\n     */\n    HARD: 0,\n\n    /**\n     * @zh x4 次采样\n     * @en x4 times\n     * @readonly\n     */\n    SOFT: 1,\n\n    /**\n     * @zh x9 次采样\n     * @en x9 times\n     * @readonly\n     */\n    SOFT_2X: 2,\n\n    /**\n     * @zh x16 次采样\n     * @en x16 times\n     * @readonly\n     */\n    SOFT_4X: 3,\n});\n\n/**\n * @zh 级联阴影贴图层级。\n * @en The CSM shadow level\n * @enum Shadows.CSMLevel\n */\nexport const CSMLevel = Enum({\n    /**\n     * @zh 1 个层级\n     * @en level 1\n     * @readonly\n     */\n    LEVEL_1: 1,\n\n    /**\n     * @zh 2 个层级\n     * @en level 2\n     * @readonly\n     */\n    LEVEL_2: 2,\n\n    /**\n     * @zh 3 个层级\n     * @en level 3\n     * @readonly\n     */\n    LEVEL_3: 3,\n\n    /**\n     * @zh 4 个层级\n     * @en level 4\n     * @readonly\n     */\n    LEVEL_4: 4,\n});\n\n/**\n * @zh 级联阴影性能优化模式。\n * @en The CSM performance optimization mode\n * @enum Shadows.CSMOptimizationMode\n */\nexport const CSMOptimizationMode = Enum({\n    /**\n     * @zh 没有性能优化\n     * @en has no performance optimization\n     * @readonly\n     */\n    NONE: 1,\n\n    /**\n     * @zh 剔除层与层之间重复物体\n     * @en Eliminate duplicate objects between layers\n     * @readonly\n     */\n    RemoveDuplicates: 2,\n\n    /**\n      * @zh 取消稳抖\n      * @en Disable rotation fix\n      * @readonly\n      */\n    DisableRotationFix: 3,\n});\n\nconst SHADOW_TYPE_NONE = ShadowType.ShadowMap + 1;\n\n/**\n * @en The global shadow's configuration of the render scene\n * @zh 渲染场景的全局阴影配置\n */\nexport class Shadows {\n    /**\n     * @en MAX_FAR. This is shadow camera max far.\n     * @zh 阴影相机的最远视距。\n     */\n    public static readonly MAX_FAR: number = 2000.0;\n\n    /**\n     * @en EXPANSION_RATIO. This is shadow boundingBox Coefficient of expansion.\n     * @zh 阴影包围盒扩大系数。\n     */\n    public static readonly COEFFICIENT_OF_EXPANSION: number = 2.0 * Math.sqrt(3.0);\n\n    /**\n     * @en Whether activate planar shadow.\n     * @zh 是否启用平面阴影？\n     */\n    get enabled (): boolean {\n        return this._enabled;\n    }\n\n    set enabled (val: boolean) {\n        this._enabled = val;\n        this.activate();\n    }\n\n    /**\n     * @en Shadow type.\n     * @zh 阴影类型。\n     */\n    get type (): number {\n        return this._type;\n    }\n    set type (val: number) {\n        this._type = this.enabled ? val : SHADOW_TYPE_NONE;\n        this.activate();\n    }\n\n    /**\n     * @en The normal of the plane which receives shadow.\n     * @zh 阴影接收平面的法线。\n     */\n    get normal (): Vec3 {\n        return this._normal;\n    }\n\n    set normal (val: Vec3) {\n        Vec3.copy(this._normal, val);\n    }\n\n    /**\n     * @en The distance from coordinate origin to the receiving plane.\n     * @zh 阴影接收平面与原点的距离。\n     */\n    get distance (): number {\n        return this._distance;\n    }\n\n    set distance (val: number) {\n        this._distance = val;\n    }\n\n    /**\n     * @en Shadow color.\n     * @zh 阴影颜色。\n     */\n    get shadowColor (): Color {\n        return this._shadowColor;\n    }\n\n    set shadowColor (color: Color) {\n        this._shadowColor = color;\n    }\n\n    /**\n     * @en get or set shadow camera orthoSize.\n     * @zh 获取或者设置阴影纹理大小。\n     */\n    public get size (): Vec2 {\n        return this._size;\n    }\n    public set size (val: Vec2) {\n        this._size.set(val);\n    }\n\n    /**\n     * @en shadow Map size has been modified.\n     * @zh 阴影贴图大小是否被修改。\n     */\n    public get shadowMapDirty (): boolean {\n        return this._shadowMapDirty;\n    }\n    public set shadowMapDirty (val: boolean) {\n        this._shadowMapDirty = val;\n    }\n\n    /**\n     * @en The transform matrix of the light source\n     * @zh 光源的变换矩阵\n     */\n    public get matLight () {\n        return this._matLight;\n    }\n\n    public get material (): Material {\n        return this._material!;\n    }\n\n    public get instancingMaterial (): Material {\n        return this._instancingMaterial!;\n    }\n\n    /**\n     * @en The bounding sphere of the shadow map.\n     * @zh 用于计算固定区域阴影 Shadow map 的场景包围球.\n     */\n    public fixedSphere: Sphere = new Sphere(0.0, 0.0, 0.0, 0.01);\n\n    /**\n     * @en get or set shadow max received.\n     * @zh 阴影接收的最大灯光数量。\n     */\n    public maxReceived = 4;\n\n    // local set\n    protected _matLight = new Mat4();\n    protected _material: Material | null = null;\n    protected _instancingMaterial: Material | null = null;\n\n    // public properties of shadow\n    protected _enabled = false;\n    protected _type = SHADOW_TYPE_NONE;\n    protected _distance = 0;\n    protected _normal = new Vec3(0, 1, 0);\n    protected _shadowColor = new Color(0, 0, 0, 76);\n    protected _size: Vec2 = new Vec2(1024, 1024);\n    protected _shadowMapDirty = false;\n\n    /**\n     * @en Get the shader for the planar shadow with macro patches\n     * @zh 通过指定宏获取平面阴影的 Shader 对象\n     * @param patches The macro patches for the shader\n     * @returns The shader for the planar shadow\n     */\n    public getPlanarShader (patches: IMacroPatch[] | null): Shader | null {\n        if (!this._material) {\n            this._material = new Material();\n            this._material.initialize({ effectName: 'pipeline/planar-shadow' });\n        }\n\n        const passes = this._material.passes;\n        if (DEBUG) {\n            assert(passes.length > 0, 'passes should not be empty!');\n        }\n        return passes.length > 0 ? passes[0].getShaderVariant(patches) : null;\n    }\n\n    /**\n     * @en Get the shader which support instancing draw for the planar shadow with macro patches\n     * @zh 通过指定宏获取支持实例化渲染的平面阴影的 Shader 对象\n     * @param patches The macro patches for the shader\n     * @returns The shader for the planar shadow\n     */\n    public getPlanarInstanceShader (patches: IMacroPatch[] | null): Shader | null {\n        if (!this._instancingMaterial) {\n            this._instancingMaterial = new Material();\n            this._instancingMaterial.initialize({ effectName: 'pipeline/planar-shadow', defines: { USE_INSTANCING: true } });\n        }\n\n        const passes = this._instancingMaterial.passes;\n        if (DEBUG) {\n            assert(passes.length > 0, 'passes should not be empty!');\n        }\n        return passes.length > 0 ? passes[0].getShaderVariant(patches) : null;\n    }\n\n    public initialize (shadowsInfo: ShadowsInfo) {\n        this._enabled = shadowsInfo.enabled;\n        this._type = this.enabled ? shadowsInfo.type : SHADOW_TYPE_NONE;\n\n        this.normal = shadowsInfo.planeDirection;\n        this.distance = shadowsInfo.planeHeight;\n        this.shadowColor = shadowsInfo.shadowColor;\n        this.maxReceived = shadowsInfo.maxReceived;\n        if (shadowsInfo.shadowMapSize !== this._size.x) {\n            this.size.set(shadowsInfo.shadowMapSize, shadowsInfo.shadowMapSize);\n            this._shadowMapDirty = true;\n        }\n    }\n\n    public activate () {\n        if (this._enabled) {\n            if (this.type === ShadowType.Planar) {\n                this._updatePlanarInfo();\n            } else {\n                const root = legacyCC.director.root;\n                const pipeline = root.pipeline;\n                pipeline.macros.CC_SHADOW_TYPE = 2;\n                root.onGlobalPipelineStateChanged();\n            }\n        } else {\n            const root = legacyCC.director.root;\n            const pipeline = root.pipeline;\n            pipeline.macros.CC_SHADOW_TYPE = 0;\n            root.onGlobalPipelineStateChanged();\n        }\n    }\n\n    protected _updatePlanarInfo () {\n        if (!this._material) {\n            this._material = new Material();\n            this._material.initialize({ effectName: 'pipeline/planar-shadow' });\n        }\n        if (!this._instancingMaterial) {\n            this._instancingMaterial = new Material();\n            this._instancingMaterial.initialize({ effectName: 'pipeline/planar-shadow', defines: { USE_INSTANCING: true } });\n        }\n        const root = legacyCC.director.root;\n        const pipeline = root.pipeline;\n        pipeline.macros.CC_SHADOW_TYPE = 1;\n        root.onGlobalPipelineStateChanged();\n    }\n\n    public destroy () {\n        if (this._material) {\n            this._material.destroy();\n        }\n\n        if (this._instancingMaterial) {\n            this._instancingMaterial.destroy();\n        }\n        this.fixedSphere.destroy();\n    }\n}\n\nlegacyCC.Shadows = Shadows;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { builtinResMgr } from '../../builtin';\nimport { Material } from '../../assets/material';\nimport { Mesh } from '../../../3d/assets/mesh';\nimport { TextureCube } from '../../assets/texture-cube';\nimport { UNIFORM_ENVIRONMENT_BINDING, UNIFORM_DIFFUSEMAP_BINDING } from '../../pipeline/define';\nimport { MaterialInstance } from '../core/material-instance';\nimport { Model } from './model';\nimport { legacyCC } from '../../global-exports';\nimport type { SkyboxInfo } from '../../scene-graph/scene-globals';\nimport { Root } from '../../root';\nimport { GlobalDSManager } from '../../pipeline/global-descriptor-set-manager';\nimport { Device, deviceManager } from '../../gfx';\nimport { Enum } from '../../value-types';\n\nlet skybox_mesh: Mesh | null = null;\nlet skybox_material: Material | null = null;\n\nexport const EnvironmentLightingType = Enum({\n    /**\n     * @zh\n     * 半球漫反射\n     * @en\n     * hemisphere diffuse\n     * @readonly\n     */\n    HEMISPHERE_DIFFUSE: 0,\n    /**\n     * @zh\n     * 半球漫反射和环境反射\n     * @en\n     * hemisphere diffuse and Environment reflection\n     * @readonly\n     */\n    AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION: 1,\n    /**\n     * @zh\n     * 漫反射卷积图和环境反射\n     * @en\n     * diffuse convolution map and environment reflection\n     * @readonly\n     */\n    DIFFUSEMAP_WITH_REFLECTION: 2,\n});\n\n/**\n * @en The skybox configuration of the render scene,\n * currently some rendering options like hdr and ibl lighting configuration is also here.\n * @zh 渲染场景的天空盒配置，目前一些渲染配置，比如 HDR 模式和环境光照配置也在 Skybox 中。\n */\nexport class Skybox {\n    /**\n     * @en The Model object of the skybox\n     * @zh 天空盒的 Model 对象\n     */\n    get model (): Model | null {\n        return this._model;\n    }\n\n    /**\n     * @en Whether activate skybox in the scene\n     * @zh 是否启用天空盒？\n     */\n    get enabled (): boolean {\n        return this._enabled;\n    }\n\n    set enabled (val: boolean) {\n        this._enabled = val;\n        if (val) this.activate(); else this._updatePipeline();\n    }\n\n    /**\n     * @en Whether HDR mode is enabled\n     * @zh 是否启用HDR？\n     */\n    get useHDR (): boolean {\n        return this._useHDR;\n    }\n\n    set useHDR (val: boolean) {\n        this._useHDR = val;\n        this.setEnvMaps(this._envmapHDR, this._envmapLDR);\n    }\n\n    /**\n     * @en Whether use image based lighting for PBR materials\n     * @zh 是否启用IBL？\n     */\n    get useIBL (): boolean {\n        return this._useIBL;\n    }\n\n    set useIBL (val: boolean) {\n        this._useIBL = val;\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Whether use diffuse convolution map lighting\n     * @zh 是否为IBL启用漫反射卷积图？\n     */\n    get useDiffuseMap (): boolean {\n        return this._useDiffuseMap;\n    }\n\n    set useDiffuseMap (val: boolean) {\n        this._useDiffuseMap = val;\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Whether enable RGBE data support in skybox shader\n     * @zh 是否需要开启 shader 内的 RGBE 数据支持？\n     */\n    get isRGBE (): boolean {\n        if (this.envmap) {\n            return this.envmap.isRGBE;\n        } else {\n            return false;\n        }\n    }\n\n    /**\n     * @en Whether to use offline baked convolutional maps\n     * @zh 是否使用离线烘焙的卷积图？\n     */\n    get useConvolutionMap (): boolean {\n        if (this.reflectionMap) {\n            return this.reflectionMap.isUsingOfflineMipmaps();\n        }\n        if (this.envmap) {\n            return this.envmap.isUsingOfflineMipmaps();\n        }\n        return false;\n    }\n\n    /**\n     * @en The texture cube used for the skybox\n     * @zh 使用的立方体贴图\n     */\n    get envmap (): TextureCube | null {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._envmapHDR;\n        } else {\n            return this._envmapLDR;\n        }\n    }\n    set envmap (val: TextureCube | null) {\n        const root = legacyCC.director.root as Root;\n        const isHDR = root.pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this.setEnvMaps(val, this._envmapLDR);\n        } else {\n            this.setEnvMaps(this._envmapHDR, val);\n        }\n    }\n\n    /**\n     * @en The texture cube used diffuse convolution map\n     * @zh 使用的漫反射卷积图\n     */\n    get diffuseMap (): TextureCube | null {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._diffuseMapHDR;\n        } else {\n            return this._diffuseMapLDR;\n        }\n    }\n    set diffuseMap (val: TextureCube | null) {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this.setDiffuseMaps(val, this._diffuseMapLDR);\n        } else {\n            this.setDiffuseMaps(this._diffuseMapHDR, val);\n        }\n    }\n\n    get reflectionMap (): TextureCube | null {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._reflectionHDR;\n        } else {\n            return this._reflectionLDR;\n        }\n    }\n\n    protected _envmapLDR: TextureCube | null = null;\n    protected _envmapHDR: TextureCube | null = null;\n    protected _diffuseMapLDR: TextureCube | null = null;\n    protected _diffuseMapHDR: TextureCube | null = null;\n    protected _globalDSManager: GlobalDSManager | null = null;\n    protected _model: Model | null = null;\n    protected _default: TextureCube | null = null;\n    protected _enabled = false;\n    protected _useIBL = false;\n    protected _useHDR = true;\n    protected _useDiffuseMap = false;\n    protected _editableMaterial: MaterialInstance | null = null;\n    protected _activated = false;\n    protected _reflectionHDR: TextureCube | null = null;\n    protected _reflectionLDR: TextureCube | null = null;\n    protected _rotationAngle = 0;\n\n    public initialize (skyboxInfo: SkyboxInfo) {\n        this._activated = false;\n        this._enabled = skyboxInfo.enabled;\n        this._useIBL = skyboxInfo.useIBL;\n        this._useDiffuseMap = skyboxInfo.applyDiffuseMap;\n        this._useHDR = skyboxInfo.useHDR;\n    }\n\n    /**\n     * @en Set the environment maps for HDR and LDR mode\n     * @zh 为 HDR 和 LDR 模式设置环境贴图\n     * @param envmapHDR @en Environment map for HDR mode @zh HDR 模式下的环境贴图\n     * @param envmapLDR @en Environment map for LDR mode @zh LDR 模式下的环境贴图\n     */\n    public setEnvMaps (envmapHDR: TextureCube | null, envmapLDR: TextureCube | null) {\n        this._envmapHDR = envmapHDR;\n        this._envmapLDR = envmapLDR;\n\n        this._updateGlobalBinding();\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Set the diffuse maps\n     * @zh 设置环境光漫反射贴图\n     * @param diffuseMapHDR @en Diffuse map for HDR mode @zh HDR 模式下的漫反射贴图\n     * @param diffuseMapLDR  @en Diffuse map for LDR mode @zh LDR 模式下的漫反射贴图\n     */\n    public setDiffuseMaps (diffuseMapHDR: TextureCube | null, diffuseMapLDR: TextureCube | null) {\n        this._diffuseMapHDR = diffuseMapHDR;\n        this._diffuseMapLDR = diffuseMapLDR;\n        this._updateGlobalBinding();\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Set custom skybox material\n     * @zh 设置自定义的天空盒材质\n     * @param skyboxMat  @en Skybox material @zh 天空盒材质\n     */\n    public setSkyboxMaterial (skyboxMat: Material | null) {\n        if (skyboxMat) {\n            this._editableMaterial = new MaterialInstance({ parent: skyboxMat });\n            this._editableMaterial.recompileShaders({ USE_RGBE_CUBEMAP: this.isRGBE });\n        } else {\n            this._editableMaterial = null;\n        }\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Set the environment reflection convolution map\n     * @zh 设置环境反射卷积图\n     * @param reflectionHDR  @en Reflection convolution map for HDR mode @zh HDR 模式下的反射卷积图\n     * @param reflectionLDR  @en Reflection convolution map for LDR mode @zh LDR 模式下的反射卷积图\n     */\n    public setReflectionMaps (reflectionHDR: TextureCube | null, reflectionLDR: TextureCube | null) {\n        this._reflectionHDR = reflectionHDR;\n        this._reflectionLDR = reflectionLDR;\n        this._updateGlobalBinding();\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Set skybox rotation angle\n     * @zh 设置天空盒旋转角度\n     * @param angle  @en rotation angle @zh 旋转角度\n     */\n    public setRotationAngle (angle: number) {\n        this._rotationAngle = angle;\n    }\n\n    public getRotationAngle () {\n        return this._rotationAngle;\n    }\n\n    public updateMaterialRenderInfo () {\n        this._updateGlobalBinding();\n        this._updatePipeline();\n    }\n\n    public activate () {\n        const pipeline = legacyCC.director.root.pipeline;\n        this._globalDSManager = pipeline.globalDSManager;\n        this._default = builtinResMgr.get<TextureCube>('default-cube-texture');\n\n        if (!this._model) {\n            this._model = legacyCC.director.root.createModel(legacyCC.renderer.scene.Model) as Model;\n            //The skybox material has added properties of 'environmentMap' that need local ubo\n            //this._model._initLocalDescriptors = () => {};\n            //this._model._initWorldBoundDescriptors = () => {};\n        }\n        let isRGBE = this._default.isRGBE;\n        let isUseConvolutionMap = this._default.isUsingOfflineMipmaps();\n        if (this.envmap) {\n            isRGBE = this.envmap.isRGBE;\n            isUseConvolutionMap = this.envmap.isUsingOfflineMipmaps();\n        }\n\n        if (!skybox_material) {\n            const mat = new Material();\n            mat.initialize({ effectName: 'pipeline/skybox', defines: { USE_RGBE_CUBEMAP: isRGBE } });\n            skybox_material = new MaterialInstance({ parent: mat });\n        }\n\n        if (this.enabled) {\n            if (!skybox_mesh) {\n                skybox_mesh = legacyCC.utils.createMesh(legacyCC.primitives.box({ width: 2, height: 2, length: 2 })) as Mesh;\n            }\n            if (this._editableMaterial) {\n                this._model.initSubModel(0, skybox_mesh.renderingSubMeshes[0], this._editableMaterial);\n            } else {\n                this._model.initSubModel(0, skybox_mesh.renderingSubMeshes[0], skybox_material);\n            }\n        }\n\n        if (!this.envmap) {\n            this.envmap = this._default;\n        }\n\n        if (!this.diffuseMap) {\n            this.diffuseMap = this._default;\n        }\n\n        this._updateGlobalBinding();\n        this._updatePipeline();\n\n        this._activated = true;\n    }\n\n    protected _updatePipeline () {\n        const root = legacyCC.director.root as Root;\n        const pipeline = root.pipeline;\n\n        const useIBLValue = this.useIBL ? (this.isRGBE ? 2 : 1) : 0;\n        const useDiffuseMapValue = (this.useIBL && this.useDiffuseMap && this.diffuseMap) ? (this.isRGBE ? 2 : 1) : 0;\n        const useHDRValue = this.useHDR;\n        const useConvMapValue = this.useConvolutionMap;\n\n        if (pipeline.macros.CC_USE_IBL !== useIBLValue\n            || pipeline.macros.CC_USE_DIFFUSEMAP !== useDiffuseMapValue\n            || pipeline.macros.CC_USE_HDR !== useHDRValue\n            || pipeline.macros.CC_IBL_CONVOLUTED !== useConvMapValue) {\n            pipeline.macros.CC_USE_IBL = useIBLValue;\n            pipeline.macros.CC_USE_DIFFUSEMAP = useDiffuseMapValue;\n            pipeline.macros.CC_USE_HDR = useHDRValue;\n            pipeline.macros.CC_IBL_CONVOLUTED = useConvMapValue;\n\n            if (this._activated) {\n                root.onGlobalPipelineStateChanged();\n            }\n        }\n\n        if (this.enabled) {\n            const envmap = this.envmap ? this.envmap : this._default;\n            const skyboxMat = this._editableMaterial ? this._editableMaterial : skybox_material;\n            if (skyboxMat) {\n                skyboxMat.setProperty('environmentMap', envmap);\n                skyboxMat.recompileShaders({ USE_RGBE_CUBEMAP: this.isRGBE });\n            }\n            if (this._model) {\n                this._model.setSubModelMaterial(0, skyboxMat!);\n                this._updateSubModes();\n            }\n        }\n    }\n\n    protected _updateGlobalBinding () {\n        if (this._globalDSManager) {\n            const device = deviceManager.gfxDevice;\n            if (this.reflectionMap) {\n                const texture = this.reflectionMap.getGFXTexture()!;\n                const sampler = device.getSampler(this.reflectionMap.getSamplerInfo());\n                this._globalDSManager.bindSampler(UNIFORM_ENVIRONMENT_BINDING, sampler);\n                this._globalDSManager.bindTexture(UNIFORM_ENVIRONMENT_BINDING, texture);\n            } else {\n                const envmap = this.envmap ? this.envmap : this._default;\n                if (envmap) {\n                    const texture = envmap.getGFXTexture()!;\n                    const sampler = device.getSampler(envmap.getSamplerInfo());\n                    this._globalDSManager.bindSampler(UNIFORM_ENVIRONMENT_BINDING, sampler);\n                    this._globalDSManager.bindTexture(UNIFORM_ENVIRONMENT_BINDING, texture);\n                }\n            }\n\n            const diffuseMap = this.diffuseMap ? this.diffuseMap : this._default;\n            if (diffuseMap) {\n                const texture = diffuseMap.getGFXTexture()!;\n                const sampler = device.getSampler(diffuseMap.getSamplerInfo());\n                this._globalDSManager.bindSampler(UNIFORM_DIFFUSEMAP_BINDING, sampler);\n                this._globalDSManager.bindTexture(UNIFORM_DIFFUSEMAP_BINDING, texture);\n            }\n\n            this._globalDSManager.update();\n        }\n    }\n\n    protected _updateSubModes () {\n        if (this._model) {\n            const subModels = this._model.subModels;\n            for (let i = 0; i < subModels.length; i++) {\n                subModels[i].update();\n            }\n        }\n    }\n}\n\nlegacyCC.Skybox = Skybox;\n","/*\r\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n */\r\n\r\nimport { Enum } from '../../value-types';\r\nimport { Color, Vec4 } from '../../math';\r\nimport { legacyCC } from '../../global-exports';\r\nimport { FogInfo } from '../../scene-graph/scene-globals';\r\nimport { SRGBToLinear } from '../../pipeline/pipeline-funcs';\r\n\r\nconst _v4 = new Vec4();\r\n\r\n/**\r\n * @zh\r\n * 全局雾类型。\r\n * @en\r\n * The global fog type\r\n * @static\r\n * @enum FogInfo.FogType\r\n */\r\nexport const FogType = Enum({\r\n    /**\r\n     * @zh\r\n     * 线性雾。\r\n     * @en\r\n     * Linear fog\r\n     * @readonly\r\n     */\r\n    LINEAR: 0,\r\n    /**\r\n     * @zh\r\n     * 指数雾。\r\n     * @en\r\n     * Exponential fog\r\n     * @readonly\r\n     */\r\n    EXP: 1,\r\n    /**\r\n     * @zh\r\n     * 指数平方雾。\r\n     * @en\r\n     * Exponential square fog\r\n     * @readonly\r\n     */\r\n    EXP_SQUARED: 2,\r\n    /**\r\n     * @zh\r\n     * 层叠雾。\r\n     * @en\r\n     * Layered fog\r\n     * @readonly\r\n     */\r\n    LAYERED: 3,\r\n});\r\n\r\nconst FOG_TYPE_NONE = FogType.LAYERED + 1;\r\n\r\n/**\r\n * @en The fog representation in the render scene.\r\n * @zh 渲染场景中的全局雾效配置\r\n */\r\nexport class Fog {\r\n    /**\r\n     * @zh 是否启用全局雾效\r\n     * @en Enable global fog\r\n     */\r\n    set enabled (val: boolean) {\r\n        this._enabled = val;\r\n        if (!val) {\r\n            this._type = FOG_TYPE_NONE;\r\n            this._updatePipeline();\r\n        } else {\r\n            this.activate();\r\n        }\r\n    }\r\n\r\n    get enabled (): boolean {\r\n        return this._enabled;\r\n    }\r\n\r\n    /**\r\n     * @zh 是否启用精确雾效(像素雾)计算\r\n     * @en Enable accurate fog (pixel fog)\r\n     */\r\n    set accurate (val: boolean) {\r\n        this._accurate = val;\r\n        this._updatePipeline();\r\n    }\r\n\r\n    get accurate (): boolean {\r\n        return this._accurate;\r\n    }\r\n\r\n    /**\r\n     * @zh 全局雾颜色\r\n     * @en Global fog color\r\n     */\r\n    set fogColor (val: Color) {\r\n        this._fogColor.set(val);\r\n\r\n        _v4.set(val.x, val.y, val.z, val.w);\r\n        SRGBToLinear(this._colorArray, _v4);\r\n    }\r\n\r\n    get fogColor () {\r\n        return this._fogColor;\r\n    }\r\n\r\n    /**\r\n     * @zh 当前雾化类型。\r\n     * @en The current global fog type.\r\n     * @returns {FogType}\r\n     * Returns the current global fog type\r\n     * - -1:Disable global Fog\r\n     * - 0:Linear fog\r\n     * - 1:Exponential fog\r\n     * - 2:Exponential square fog\r\n     * - 3:Layered fog\r\n     */\r\n    get type (): number {\r\n        return this._type;\r\n    }\r\n    set type (val: number) {\r\n        this._type = this.enabled ? val : FOG_TYPE_NONE;\r\n        if (this.enabled) this._updatePipeline();\r\n    }\r\n\r\n    /**\r\n     * @zh 全局雾浓度\r\n     * @en Global fog density\r\n     */\r\n    get fogDensity (): number {\r\n        return this._fogDensity;\r\n    }\r\n\r\n    set fogDensity (val: number) {\r\n        this._fogDensity = val;\r\n    }\r\n    /**\r\n     * @zh 雾效起始位置，只适用于线性雾\r\n     * @en Global fog start position, only for linear fog\r\n     */\r\n    get fogStart (): number {\r\n        return this._fogStart;\r\n    }\r\n\r\n    set fogStart (val: number) {\r\n        this._fogStart = val;\r\n    }\r\n\r\n    /**\r\n     * @zh 雾效结束位置，只适用于线性雾\r\n     * @en Global fog end position, only for linear fog\r\n     */\r\n    get fogEnd (): number {\r\n        return this._fogEnd;\r\n    }\r\n\r\n    set fogEnd (val: number) {\r\n        this._fogEnd = val;\r\n    }\r\n\r\n    /**\r\n     * @zh 雾效衰减\r\n     * @en Global fog attenuation\r\n     */\r\n    get fogAtten (): number {\r\n        return this._fogAtten;\r\n    }\r\n\r\n    set fogAtten (val: number) {\r\n        this._fogAtten = val;\r\n    }\r\n\r\n    /**\r\n     * @zh 雾效顶部范围，只适用于层级雾\r\n     * @en Global fog top range, only for layered fog\r\n     */\r\n    get fogTop (): number {\r\n        return this._fogTop;\r\n    }\r\n\r\n    set fogTop (val: number) {\r\n        this._fogTop = val;\r\n    }\r\n\r\n    /**\r\n     * @zh 雾效范围，只适用于层级雾\r\n     * @en Global fog range, only for layered fog\r\n     */\r\n    get fogRange (): number {\r\n        return this._fogRange;\r\n    }\r\n\r\n    set fogRange (val: number) {\r\n        this._fogRange = val;\r\n    }\r\n    get colorArray (): Readonly<Vec4> {\r\n        return this._colorArray;\r\n    }\r\n    protected _fogColor = new Color('#C8C8C8');\r\n    protected _colorArray: Vec4 = new Vec4(0.2, 0.2, 0.2, 1.0);\r\n    protected _enabled = false;\r\n    protected _accurate = false;\r\n    protected _type = 0;\r\n    protected _fogDensity = 0.3;\r\n    protected _fogStart = 0.5;\r\n    protected _fogEnd = 300;\r\n    protected _fogAtten = 5;\r\n    protected _fogTop = 1.5;\r\n    protected _fogRange = 1.2;\r\n    protected _activated = false;\r\n\r\n    public initialize (fogInfo : FogInfo) {\r\n        this._activated = false;\r\n        this.fogColor = fogInfo.fogColor;\r\n        this._enabled = fogInfo.enabled;\r\n        this._type = this.enabled ? fogInfo.type : FOG_TYPE_NONE;\r\n        this._accurate = fogInfo.accurate;\r\n        this.fogDensity = fogInfo.fogDensity;\r\n        this.fogStart = fogInfo.fogStart;\r\n        this.fogEnd = fogInfo.fogEnd;\r\n        this.fogAtten = fogInfo.fogAtten;\r\n        this.fogTop = fogInfo.fogTop;\r\n        this.fogRange = fogInfo.fogRange;\r\n    }\r\n\r\n    public activate () {\r\n        this._updatePipeline();\r\n        this._activated = true;\r\n    }\r\n\r\n    protected _updatePipeline () {\r\n        const root = legacyCC.director.root;\r\n        const value = this.enabled ? this.type : FOG_TYPE_NONE;\r\n        const accurateValue = this.accurate ? 1 : 0;\r\n        const pipeline = root.pipeline;\r\n        if (pipeline.macros.CC_USE_FOG === value && pipeline.macros.CC_USE_ACCURATE_FOG === accurateValue) {\r\n            return;\r\n        }\r\n        pipeline.macros.CC_USE_FOG = value;\r\n        pipeline.macros.CC_USE_ACCURATE_FOG = accurateValue;\r\n        if (this._activated) {\r\n            root.onGlobalPipelineStateChanged();\r\n        }\r\n    }\r\n}\r\n\r\nlegacyCC.Fog = Fog;\r\n","/* eslint-disable func-names */\n/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n http://www.cocos.com\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, visible, type, displayOrder, readOnly, slide, range, rangeStep,\n    editable, serializable, rangeMin, tooltip, formerlySerializedAs, displayName } from 'cc.decorator';\nimport { BAIDU } from 'internal:constants';\nimport { TextureCube } from '../assets/texture-cube';\nimport { CCFloat, CCInteger } from '../data/utils/attribute';\nimport { Color, Quat, Vec3, Vec2, Vec4 } from '../math';\nimport { Ambient } from '../renderer/scene/ambient';\nimport { Shadows, ShadowType, ShadowSize } from '../renderer/scene/shadows';\nimport { Skybox, EnvironmentLightingType } from '../renderer/scene/skybox';\nimport { Octree } from '../renderer/scene/octree';\nimport { Fog, FogType } from '../renderer/scene/fog';\nimport { Node } from './node';\nimport { legacyCC } from '../global-exports';\nimport { Root } from '../root';\nimport { warnID } from '../platform/debug';\nimport { Material } from '../assets/material';\n\nconst _up = new Vec3(0, 1, 0);\nconst _v3 = new Vec3();\nconst _v4 = new Vec4();\nconst _col = new Color();\nconst _qt = new Quat();\n\n// Normalize HDR color\nconst normalizeHDRColor = (color : Vec4) => {\n    const intensity = 1.0 / Math.max(Math.max(Math.max(color.x, color.y), color.z), 0.0001);\n    if (intensity < 1.0) {\n        color.x *= intensity;\n        color.y *= intensity;\n        color.z *= intensity;\n    }\n};\n/**\n * @en Environment lighting configuration in the Scene\n * @zh 场景的环境光照相关配置\n */\n@ccclass('cc.AmbientInfo')\nexport class AmbientInfo {\n    /**\n     * @en The sky color in HDR mode\n     * @zh HDR 模式下的天空光照色\n     */\n    get skyColorHDR () : Readonly<Vec4> {\n        return this._skyColorHDR;\n    }\n\n    /**\n     * @en The ground color in HDR mode\n     * @zh HDR 模式下的地面光照色\n     */\n    get groundAlbedoHDR () : Readonly<Vec4> {\n        return this._groundAlbedoHDR;\n    }\n\n    /**\n     * @en Sky illuminance in HDR mode\n     * @zh HDR 模式下的天空亮度\n     */\n    get skyIllumHDR () {\n        return this._skyIllumHDR;\n    }\n\n    /**\n     * @en The sky color in LDR mode\n     * @zh LDR 模式下的天空光照色\n     */\n    get skyColorLDR () : Readonly<Vec4> {\n        return this._skyColorLDR;\n    }\n\n    /**\n     * @en The ground color in LDR mode\n     * @zh LDR 模式下的地面光照色\n     */\n    get groundAlbedoLDR () : Readonly<Vec4> {\n        return this._groundAlbedoLDR;\n    }\n\n    /**\n     * @en Sky illuminance in LDR mode\n     * @zh LDR 模式下的天空亮度\n     */\n    get skyIllumLDR () {\n        return this._skyIllumLDR;\n    }\n\n    /**\n     * @en Sky lighting color configurable in editor with color picker\n     * @zh 编辑器中可配置的天空光照颜色（通过颜色拾取器）\n     */\n    @visible(() => {\n        const scene = legacyCC.director.getScene();\n        const skybox = scene.globals.skybox;\n        if (skybox.useIBL && skybox.applyDiffuseMap) {\n            return false;\n        } else {\n            return true;\n        }\n    })\n    @editable\n    @tooltip('i18n:ambient.skyLightingColor')\n    set skyLightingColor (val: Color) {\n        _v4.set(val.x, val.y, val.z, val.w);\n        if ((legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR) {\n            this._skyColorHDR.set(_v4);\n        } else {\n            this._skyColorLDR.set(_v4);\n        }\n        if (this._resource) { this._resource.skyColor.set(_v4); }\n    }\n    get skyLightingColor () {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        _v4.set(isHDR ? this._skyColorHDR : this._skyColorLDR);\n        normalizeHDRColor(_v4);\n        return _col.set(_v4.x * 255, _v4.y * 255, _v4.z * 255, 255);\n    }\n\n    /**\n     * @internal\n     */\n    set skyColor (val: Vec4) {\n        if ((legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR) {\n            this._skyColorHDR.set(val);\n        } else {\n            this._skyColorLDR.set(val);\n        }\n        if (this._resource) { this._resource.skyColor.set(val); }\n    }\n\n    /**\n     * @en Sky illuminance\n     * @zh 天空亮度\n     */\n    @editable\n    @type(CCFloat)\n    @tooltip('i18n:ambient.skyIllum')\n    set skyIllum (val: number) {\n        if ((legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR) {\n            this._skyIllumHDR = val;\n        } else {\n            this._skyIllumLDR = val;\n        }\n\n        if (this._resource) { this._resource.skyIllum = val; }\n    }\n    get skyIllum () {\n        if ((legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR) {\n            return this._skyIllumHDR;\n        } else {\n            return this._skyIllumLDR;\n        }\n    }\n\n    /**\n     * @en Ground lighting color configurable in editor with color picker\n     * @zh 编辑器中可配置的地面光照颜色（通过颜色拾取器）\n     */\n    @visible(() => {\n        const scene = legacyCC.director.getScene();\n        const skybox = scene.globals.skybox;\n        if (skybox.useIBL && skybox.applyDiffuseMap) {\n            return false;\n        } else {\n            return true;\n        }\n    })\n    @editable\n    @tooltip('i18n:ambient.groundLightingColor')\n    set groundLightingColor (val: Color) {\n        _v4.set(val.x, val.y, val.z, val.w);\n        if ((legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR) {\n            this._groundAlbedoHDR.set(_v4);\n        } else {\n            this._groundAlbedoLDR.set(_v4);\n        }\n        if (this._resource) { this._resource.groundAlbedo.set(_v4); }\n    }\n    get groundLightingColor () {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        _v4.set(isHDR ? this._groundAlbedoHDR : this._groundAlbedoLDR);\n        normalizeHDRColor(_v4);\n        return _col.set(_v4.x * 255, _v4.y * 255, _v4.z * 255, 255);\n    }\n\n    /**\n     * @internal\n     */\n    set groundAlbedo (val: Vec4) {\n        if ((legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR) {\n            this._groundAlbedoHDR.set(val);\n        } else {\n            this._groundAlbedoLDR.set(val);\n        }\n        if (this._resource) { this._resource.groundAlbedo.set(val); }\n    }\n\n    @serializable\n    @formerlySerializedAs('_skyColor')\n    protected _skyColorHDR = new Vec4(0.2, 0.5, 0.8, 1.0);\n    @serializable\n    @formerlySerializedAs('_skyIllum')\n    protected _skyIllumHDR = Ambient.SKY_ILLUM;\n    @serializable\n    @formerlySerializedAs('_groundAlbedo')\n    protected _groundAlbedoHDR = new Vec4(0.2, 0.2, 0.2, 1.0);\n\n    @serializable\n    protected _skyColorLDR = new Vec4(0.2, 0.5, 0.8, 1.0);\n    @serializable\n    protected _skyIllumLDR = Ambient.SKY_ILLUM;\n    @serializable\n    protected _groundAlbedoLDR = new Vec4(0.2, 0.2, 0.2, 1.0);\n\n    protected _resource: Ambient | null = null;\n\n    /**\n     * @en Activate the ambient lighting configuration in the render scene, no need to invoke manually.\n     * @zh 在渲染场景中启用环境光照设置，不需要手动调用\n     * @param resource The ambient configuration object in the render scene\n     */\n    public activate (resource: Ambient) {\n        this._resource = resource;\n        this._resource.initialize(this);\n    }\n}\nlegacyCC.AmbientInfo = AmbientInfo;\n\n/**\n * @en Skybox related configuration\n * @zh 天空盒相关配置\n */\n@ccclass('cc.SkyboxInfo')\nexport class SkyboxInfo {\n    /**\n     * @en Whether to use diffuse convolution map. Enabled -> Will use map specified. Disabled -> Will revert to hemispheric lighting\n     * @zh 是否为IBL启用漫反射卷积图？不启用的话将使用默认的半球光照\n     */\n    set applyDiffuseMap (val) {\n        if (this._resource) {\n            this._resource.useDiffuseMap = val;\n        }\n    }\n    get applyDiffuseMap () {\n        if (EnvironmentLightingType.DIFFUSEMAP_WITH_REFLECTION === this._envLightingType) {\n            return true;\n        }\n        return false;\n    }\n    /**\n     * @en Whether activate skybox in the scene\n     * @zh 是否启用天空盒？\n     */\n    @editable\n    @tooltip('i18n:skybox.enabled')\n    set enabled (val) {\n        if (this._enabled === val) return;\n        this._enabled = val;\n\n        if (this._resource) {\n            this._resource.enabled = this._enabled;\n        }\n    }\n    get enabled () {\n        return this._enabled;\n    }\n\n    /**\n     * @zh 环境反射类型\n     * @en environment reflection type\n     */\n    @editable\n    @type(EnvironmentLightingType)\n    @tooltip('i18n:skybox.EnvironmentLightingType')\n    set envLightingType (val) {\n        if (!this.envmap && EnvironmentLightingType.HEMISPHERE_DIFFUSE !== val) {\n            this.useIBL = false;\n            this.applyDiffuseMap = false;\n            this._envLightingType = EnvironmentLightingType.HEMISPHERE_DIFFUSE;\n            warnID(15001);\n        } else {\n            if (EnvironmentLightingType.HEMISPHERE_DIFFUSE === val) {\n                this.useIBL = false;\n                this.applyDiffuseMap = false;\n            } else if (EnvironmentLightingType.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION === val) {\n                this.useIBL = true;\n                this.applyDiffuseMap = false;\n            } else if (EnvironmentLightingType.DIFFUSEMAP_WITH_REFLECTION === val) {\n                this.useIBL = true;\n                this.applyDiffuseMap = true;\n            }\n            this._envLightingType = val;\n        }\n    }\n    get envLightingType () {\n        return this._envLightingType;\n    }\n    /**\n     * @en Whether use environment lighting\n     * @zh 是否启用环境光照？\n     */\n    set useIBL (val) {\n        if (this._resource) {\n            this._resource.useIBL = val;\n        }\n    }\n    get useIBL () {\n        if (EnvironmentLightingType.HEMISPHERE_DIFFUSE !== this._envLightingType) {\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * @en Toggle HDR (TODO: This SHOULD be moved into it's own subgroup away from skybox)\n     * @zh 是否启用HDR？\n     */\n    @editable\n    @tooltip('i18n:skybox.useHDR')\n    set useHDR (val) {\n        (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR = val;\n        this._useHDR = val;\n\n        // Switch UI to and from LDR/HDR textures depends on HDR state\n        if (this._resource) {\n            if (this.envLightingType === EnvironmentLightingType.DIFFUSEMAP_WITH_REFLECTION) {\n                if (this.diffuseMap === null) {\n                    this.envLightingType = EnvironmentLightingType.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION;\n                    warnID(15000);\n                } else if (this.diffuseMap.isDefault) {\n                    warnID(15002);\n                }\n            }\n        }\n\n        if (this._resource) {\n            this._resource.useHDR = this._useHDR;\n            this._resource.updateMaterialRenderInfo();\n        }\n    }\n    get useHDR () {\n        (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR = this._useHDR;\n        return this._useHDR;\n    }\n\n    /**\n     * @en The texture cube used for the skybox\n     * @zh 使用的立方体贴图\n     */\n    @editable\n    @type(TextureCube)\n    @tooltip('i18n:skybox.envmap')\n    set envmap (val) {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this._envmapHDR = val;\n            this._reflectionHDR = null;\n        } else {\n            this._envmapLDR = val;\n            this._reflectionLDR = null;\n        }\n        if (!val) {\n            if (isHDR) {\n                this._diffuseMapHDR = null;\n            } else {\n                this._diffuseMapLDR = null;\n            }\n            this.applyDiffuseMap = false;\n            this.useIBL = false;\n            this.envLightingType = EnvironmentLightingType.HEMISPHERE_DIFFUSE;\n            warnID(15001);\n        }\n\n        if (this._resource) {\n            this._resource.setEnvMaps(this._envmapHDR, this._envmapLDR);\n            this._resource.setDiffuseMaps(this._diffuseMapHDR, this._diffuseMapLDR);\n            this._resource.setReflectionMaps(this._reflectionHDR, this._reflectionLDR);\n            this._resource.useDiffuseMap = this.applyDiffuseMap;\n            this._resource.envmap = val;\n        }\n    }\n    get envmap () {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._envmapHDR;\n        } else {\n            return this._envmapLDR;\n        }\n    }\n\n    /**\n     * @en Rotate the skybox\n     * @zh 旋转天空盒\n     */\n    @type(CCFloat)\n    @range([0, 360])\n    @rangeStep(1)\n    @slide\n    @tooltip('i18n:skybox.rotationAngle')\n    set rotationAngle (val: number) {\n        this._rotationAngle = val;\n        if (this._resource) { this._resource.setRotationAngle(this._rotationAngle); }\n    }\n    get rotationAngle () {\n        return this._rotationAngle;\n    }\n\n    /**\n     * @en The optional diffusion convolution map used in tandem with IBL\n     * @zh 使用的漫反射卷积图\n     */\n    @visible(function (this : SkyboxInfo) {\n        if (this.useIBL && this.applyDiffuseMap) {\n            return true;\n        }\n        return false;\n    })\n    @editable\n    @readOnly\n    @type(TextureCube)\n    @displayOrder(100)\n    set diffuseMap (val : TextureCube | null) {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this._diffuseMapHDR = val;\n        } else {\n            this._diffuseMapLDR = val;\n        }\n\n        if (this._resource) {\n            this._resource.setDiffuseMaps(this._diffuseMapHDR, this._diffuseMapLDR);\n        }\n    }\n    get diffuseMap () {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._diffuseMapHDR;\n        } else {\n            return this._diffuseMapLDR;\n        }\n    }\n\n    /**\n     * @en Convolutional map using environmental reflections\n     * @zh 使用环境反射卷积图\n     */\n    @visible(function (this : SkyboxInfo) {\n        if (this._resource?.reflectionMap) {\n            return true;\n        }\n        return false;\n    })\n    @editable\n    @readOnly\n    @type(TextureCube)\n    @displayOrder(100)\n    set reflectionMap (val: TextureCube | null) {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this._reflectionHDR = val;\n        } else {\n            this._reflectionLDR = val;\n        }\n        if (this._resource) {\n            this._resource.setReflectionMaps(this._reflectionHDR, this._reflectionLDR);\n        }\n    }\n    get reflectionMap () {\n        const isHDR = (legacyCC.director.root as Root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._reflectionHDR;\n        } else {\n            return this._reflectionLDR;\n        }\n    }\n\n    /**\n     * @en Use custom skybox material\n     * @zh 使用自定义的天空盒材质\n     */\n    @editable\n    @type(Material)\n    @tooltip('i18n:skybox.material')\n    set skyboxMaterial (val: Material | null) {\n        this._editableMaterial = val;\n        if (this._resource) {\n            this._resource.setSkyboxMaterial(this._editableMaterial);\n        }\n    }\n    get skyboxMaterial () {\n        return this._editableMaterial;\n    }\n\n    @serializable\n    protected _envLightingType = EnvironmentLightingType.HEMISPHERE_DIFFUSE;\n    @serializable\n    @type(TextureCube)\n    @formerlySerializedAs('_envmap')\n    protected _envmapHDR: TextureCube | null = null;\n    @serializable\n    @type(TextureCube)\n    protected _envmapLDR: TextureCube | null = null;\n    @serializable\n    @type(TextureCube)\n    protected _diffuseMapHDR: TextureCube | null = null;\n    @serializable\n    @type(TextureCube)\n    protected _diffuseMapLDR: TextureCube | null = null;\n    @serializable\n    protected _enabled = false;\n    @serializable\n    protected _useHDR = true;\n    @serializable\n    @type(Material)\n    protected _editableMaterial: Material | null = null;\n    @serializable\n    @type(TextureCube)\n    protected _reflectionHDR: TextureCube | null = null;\n    @serializable\n    @type(TextureCube)\n    protected _reflectionLDR: TextureCube | null = null;\n    @serializable\n    protected _rotationAngle = 0;\n\n    protected _resource: Skybox | null = null;\n\n    /**\n     * @en Activate the skybox configuration in the render scene, no need to invoke manually.\n     * @zh 在渲染场景中启用天空盒设置，不需要手动调用\n     * @param resource The skybox configuration object in the render scene\n     */\n    public activate (resource: Skybox) {\n        this.envLightingType = this._envLightingType;\n        this._resource = resource;\n        this._resource.initialize(this);\n        this._resource.setEnvMaps(this._envmapHDR, this._envmapLDR);\n        this._resource.setDiffuseMaps(this._diffuseMapHDR, this._diffuseMapLDR);\n        this._resource.setSkyboxMaterial(this._editableMaterial);\n        this._resource.setReflectionMaps(this._reflectionHDR, this._reflectionLDR);\n        this._resource.setRotationAngle(this._rotationAngle);\n        this._resource.activate(); // update global DS first\n    }\n}\nlegacyCC.SkyboxInfo = SkyboxInfo;\n\n/**\n * @zh 全局雾相关配置\n * @en Global fog configuration\n */\n@ccclass('cc.FogInfo')\nexport class FogInfo {\n    public static FogType = FogType;\n\n    /**\n     * @zh 是否启用全局雾效\n     * @en Enable global fog\n     */\n    @editable\n    @tooltip('i18n:fog.enabled')\n    @displayOrder(0)\n    set enabled (val: boolean) {\n        if (this._enabled === val) return;\n        this._enabled = val;\n        if (this._resource) {\n            this._resource.enabled = val;\n            if (val) {\n                this._resource.type = this._type;\n            }\n        }\n    }\n\n    get enabled () {\n        return this._enabled;\n    }\n\n    /**\n     * @zh 是否启用精确雾效(像素雾)计算\n     * @en Enable accurate fog (pixel fog)\n     */\n    @editable\n    @tooltip('i18n:fog.accurate')\n    @displayOrder(0)\n    set accurate (val: boolean) {\n        if (this._accurate === val) return;\n        this._accurate = val;\n        if (this._resource) {\n            this._resource.accurate = val;\n            if (val) {\n                this._resource.type = this._type;\n            }\n        }\n    }\n\n    get accurate () {\n        return this._accurate;\n    }\n\n    /**\n     * @zh 全局雾颜色\n     * @en Global fog color\n     */\n    @editable\n    @tooltip('i18n:fog.fogColor')\n    set fogColor (val: Color) {\n        this._fogColor.set(val);\n        if (this._resource) { this._resource.fogColor = this._fogColor; }\n    }\n\n    get fogColor () : Readonly<Color> {\n        return this._fogColor;\n    }\n\n    /**\n     * @zh 全局雾类型\n     * @en Global fog type\n     */\n    @editable\n    @type(FogType)\n    @displayOrder(1)\n    @tooltip('i18n:fog.type')\n    get type () {\n        return this._type;\n    }\n\n    set type (val) {\n        this._type = val;\n        if (this._resource) { this._resource.type = val; }\n    }\n\n    /**\n     * @zh 全局雾浓度\n     * @en Global fog density\n     */\n    @visible(function (this: FogInfo) {\n        return this._type !== FogType.LAYERED && this._type !== FogType.LINEAR;\n    })\n    @type(CCFloat)\n    @range([0, 1])\n    @rangeStep(0.01)\n    @slide\n    @tooltip('i18n:fog.fogDensity')\n    get fogDensity () {\n        return this._fogDensity;\n    }\n\n    set fogDensity (val) {\n        this._fogDensity = val;\n        if (this._resource) { this._resource.fogDensity = val; }\n    }\n\n    /**\n     * @zh 雾效起始位置\n     * @en Global fog start position\n     */\n    @visible(function (this: FogInfo) { return this._type !== FogType.LAYERED; })\n    @type(CCFloat)\n    @rangeStep(0.01)\n    @tooltip('i18n:fog.fogStart')\n    get fogStart () {\n        return this._fogStart;\n    }\n\n    set fogStart (val) {\n        this._fogStart = val;\n        if (this._resource) { this._resource.fogStart = val; }\n    }\n\n    /**\n     * @zh 雾效结束位置，只适用于线性雾\n     * @en Global fog end position, only for linear fog\n     */\n    @visible(function (this: FogInfo) { return this._type === FogType.LINEAR; })\n    @type(CCFloat)\n    @rangeStep(0.01)\n    @tooltip('i18n:fog.fogEnd')\n    get fogEnd () {\n        return this._fogEnd;\n    }\n\n    set fogEnd (val) {\n        this._fogEnd = val;\n        if (this._resource) { this._resource.fogEnd = val; }\n    }\n\n    /**\n     * @zh 雾效衰减\n     * @en Global fog attenuation\n     */\n    @visible(function (this: FogInfo) { return this._type !== FogType.LINEAR; })\n    @type(CCFloat)\n    @rangeMin(0.01)\n    @rangeStep(0.01)\n    @tooltip('i18n:fog.fogAtten')\n    get fogAtten () {\n        return this._fogAtten;\n    }\n\n    set fogAtten (val) {\n        this._fogAtten = val;\n        if (this._resource) { this._resource.fogAtten = val; }\n    }\n\n    /**\n     * @zh 雾效顶部范围，只适用于层级雾\n     * @en Global fog top range, only for layered fog\n     */\n    @visible(function (this: FogInfo) { return this._type === FogType.LAYERED; })\n    @type(CCFloat)\n    @rangeStep(0.01)\n    @tooltip('i18n:fog.fogTop')\n    get fogTop () {\n        return this._fogTop;\n    }\n\n    set fogTop (val) {\n        this._fogTop = val;\n        if (this._resource) { this._resource.fogTop = val; }\n    }\n\n    /**\n     * @zh 雾效范围，只适用于层级雾\n     * @en Global fog range, only for layered fog\n     */\n    @visible(function (this: FogInfo) { return this._type === FogType.LAYERED; })\n    @type(CCFloat)\n    @rangeStep(0.01)\n    @tooltip('i18n:fog.fogRange')\n    get fogRange () {\n        return this._fogRange;\n    }\n\n    set fogRange (val) {\n        this._fogRange = val;\n        if (this._resource) { this._resource.fogRange = val; }\n    }\n\n    @serializable\n    protected _type = FogType.LINEAR;\n    @serializable\n    protected _fogColor = new Color('#C8C8C8');\n    @serializable\n    protected _enabled = false;\n    @serializable\n    protected _fogDensity = 0.3;\n    @serializable\n    protected _fogStart = 0.5;\n    @serializable\n    protected _fogEnd = 300;\n    @serializable\n    protected _fogAtten = 5;\n    @serializable\n    protected _fogTop = 1.5;\n    @serializable\n    protected _fogRange = 1.2;\n    @serializable\n    protected _accurate = false;\n    protected _resource: Fog | null = null;\n\n    /**\n     * @en Activate the fog configuration in the render scene, no need to invoke manually.\n     * @zh 在渲染场景中启用雾效设置，不需要手动调用\n     * @param resource The fog configuration object in the render scene\n     */\n    public activate (resource: Fog) {\n        this._resource = resource;\n        this._resource.initialize(this);\n        this._resource.activate();\n    }\n}\n\n/**\n * @en Scene level shadow related configuration\n * @zh 场景级别阴影相关的配置\n */\n@ccclass('cc.ShadowsInfo')\nexport class ShadowsInfo {\n    /**\n     * @en Whether activate planar shadow\n     * @zh 是否启用平面阴影？\n     */\n    @editable\n    @tooltip('i18n:shadow.enabled')\n    set enabled (val: boolean) {\n        if (this._enabled === val) return;\n        this._enabled = val;\n        if (this._resource) {\n            this._resource.enabled = val;\n            if (val) {\n                this._resource.type = this._type;\n            }\n        }\n    }\n    get enabled () {\n        if (BAIDU) {\n            if (this._type !== ShadowType.Planar) {\n                this._enabled = false;\n            }\n        }\n        return this._enabled;\n    }\n\n    /**\n     * @en The type of the shadow\n     * @zh 阴影渲染的类型\n     */\n    @tooltip('i18n:shadow.type')\n    @editable\n    @type(ShadowType)\n    set type (val) {\n        this._type = val;\n        if (this._resource) { this._resource.type = val; }\n    }\n    get type () {\n        return this._type;\n    }\n\n    /**\n     * @en Shadow color\n     * @zh 阴影颜色\n     */\n    @tooltip('i18n:shadow.shadowColor')\n    @visible(function (this: ShadowsInfo) { return this._type === ShadowType.Planar; })\n    set shadowColor (val: Color) {\n        this._shadowColor.set(val);\n        if (this._resource) { this._resource.shadowColor = val; }\n    }\n    get shadowColor () : Readonly<Color> {\n        return this._shadowColor;\n    }\n\n    /**\n     * @en The normal of the plane which receives shadow\n     * @zh 阴影接收平面的法线\n     */\n    @tooltip('i18n:shadow.planeDirection')\n    @visible(function (this: ShadowsInfo) { return this._type === ShadowType.Planar; })\n    set planeDirection (val: Vec3) {\n        Vec3.copy(this._normal, val);\n        if (this._resource) { this._resource.normal = val; }\n    }\n    get planeDirection () : Readonly<Vec3> {\n        return this._normal;\n    }\n\n    /**\n     * @en The distance from coordinate origin to the receiving plane.\n     * @zh 阴影接收平面与原点的距离\n     */\n    @tooltip('i18n:shadow.planeHeight')\n    @editable\n    @type(CCFloat)\n    @visible(function (this: ShadowsInfo) { return this._type === ShadowType.Planar; })\n    set planeHeight (val: number) {\n        this._distance = val;\n        if (this._resource) { this._resource.distance = val; }\n    }\n    get planeHeight () {\n        return this._distance;\n    }\n\n    /**\n     * @en get or set shadow max received\n     * @zh 获取或者设置阴影接收的最大光源数量\n     */\n    @tooltip('i18n:shadow.maxReceived')\n    @type(CCInteger)\n    @visible(function (this: ShadowsInfo) { return this._type === ShadowType.ShadowMap; })\n    set maxReceived (val: number) {\n        this._maxReceived = val;\n        if (this._resource) { this._resource.maxReceived = val; }\n    }\n    get maxReceived () {\n        return this._maxReceived;\n    }\n\n    /**\n     * @en get or set shadow map size\n     * @zh 获取或者设置阴影纹理大小\n     */\n    @tooltip('i18n:shadow.shadowMapSize')\n    @type(ShadowSize)\n    @visible(function (this: ShadowsInfo) { return this._type === ShadowType.ShadowMap; })\n    set shadowMapSize (value: number) {\n        this._size.set(value, value);\n        if (this._resource) {\n            this._resource.size.set(value, value);\n            this._resource.shadowMapDirty = true;\n        }\n    }\n    get shadowMapSize () {\n        return this._size.x;\n    }\n\n    @serializable\n    protected _enabled = false;\n    @serializable\n    protected _type = ShadowType.Planar;\n    @serializable\n    protected _normal = new Vec3(0, 1, 0);\n    @serializable\n    protected _distance = 0;\n    @serializable\n    protected _shadowColor = new Color(0, 0, 0, 76);\n    @serializable\n    protected _maxReceived = 4;\n    @serializable\n    protected _size = new Vec2(1024, 1024);\n\n    protected _resource: Shadows | null = null;\n\n    /**\n     * @en Set plane which receives shadow with the given node's world transformation\n     * @zh 根据指定节点的世界变换设置阴影接收平面的信息\n     * @param node The node for setting up the plane\n     */\n    public setPlaneFromNode (node: Node) {\n        node.getWorldRotation(_qt);\n        this.planeDirection = Vec3.transformQuat(_v3, _up, _qt);\n        node.getWorldPosition(_v3);\n        this.planeHeight = Vec3.dot(this._normal, _v3);\n    }\n\n    /**\n     * @en Activate the shadow configuration in the render scene, no need to invoke manually.\n     * @zh 在渲染场景中启用阴影设置，不需要手动调用\n     * @param resource The shadow configuration object in the render scene\n     */\n    public activate (resource: Shadows) {\n        this._resource = resource;\n        this._resource.initialize(this);\n        this._resource.activate();\n    }\n}\nlegacyCC.ShadowsInfo = ShadowsInfo;\n\nexport const DEFAULT_WORLD_MIN_POS = new Vec3(-1024.0, -1024.0, -1024.0);\nexport const DEFAULT_WORLD_MAX_POS = new Vec3(1024.0, 1024.0, 1024.0);\nexport const DEFAULT_OCTREE_DEPTH = 8;\n\n/**\n * @en Scene management and culling configuration based on octree\n * @zh 基于八叉树的场景剔除配置\n */\n@ccclass('cc.OctreeInfo')\nexport class OctreeInfo {\n    /**\n     * @en Whether activate scene culling based on octree\n     * @zh 是否启用八叉树加速剔除？\n     */\n    @editable\n    @tooltip('i18n:octree_culling.enabled')\n    set enabled (val: boolean) {\n        if (this._enabled === val) return;\n        this._enabled = val;\n        if (this._resource) {\n            this._resource.enabled = val;\n        }\n    }\n    get enabled () {\n        return this._enabled;\n    }\n\n    /**\n     * @en The minimal position of the scene bounding box.\n     * Objects entirely outside the bounding box will be culled, other objects will be managed dynamically.\n     * @zh 场景包围盒的最小位置，完全超出包围盒的物体会被剔除，其他物体根据情况被动态剔除。\n     */\n    @editable\n    @tooltip('i18n:octree_culling.minPos')\n    @displayName('World MinPos')\n    set minPos (val: Vec3) {\n        this._minPos = val;\n        if (this._resource) { this._resource.minPos = val; }\n    }\n    get minPos () {\n        return this._minPos;\n    }\n\n    /**\n     * @en The maximum position of the scene bounding box.\n     * Objects entirely outside the bounding box will be culled, other objects will be managed dynamically.\n     * @zh 场景包围盒的最大位置，完全超出包围盒的物体会被剔除，其他物体根据情况被动态剔除。\n     */\n    @editable\n    @tooltip('i18n:octree_culling.maxPos')\n    @displayName('World MaxPos')\n    set maxPos (val: Vec3) {\n        this._maxPos = val;\n        if (this._resource) { this._resource.maxPos = val; }\n    }\n    get maxPos () {\n        return this._maxPos;\n    }\n\n    /**\n     * @en The depth of the octree.\n     * @zh 八叉树的深度。\n     */\n    @editable\n    @range([4, 12, 1])\n    @slide\n    @type(CCInteger)\n    @tooltip('i18n:octree_culling.depth')\n    set depth (val: number) {\n        this._depth = val;\n        if (this._resource) { this._resource.depth = val; }\n    }\n    get depth () {\n        return this._depth;\n    }\n\n    @serializable\n    protected _enabled = false;\n    @serializable\n    protected _minPos = new Vec3(DEFAULT_WORLD_MIN_POS);\n    @serializable\n    protected _maxPos = new Vec3(DEFAULT_WORLD_MAX_POS);\n    @serializable\n    protected _depth = DEFAULT_OCTREE_DEPTH;\n\n    protected _resource: Octree | null = null;\n\n    /**\n     * @en Activate the octree configuration in the render scene, no need to invoke manually.\n     * @zh 在渲染场景中启用八叉树设置，不需要手动调用\n     * @param resource The octree configuration object in the render scene\n     */\n    public activate (resource: Octree) {\n        this._resource = resource;\n        this._resource.initialize(this);\n    }\n}\n\n/**\n * @en All scene related global parameters, it affects all content in the corresponding scene\n * @zh 各类场景级别的渲染参数，将影响全场景的所有物体\n */\n@ccclass('cc.SceneGlobals')\nexport class SceneGlobals {\n    /**\n     * @en The environment lighting configuration\n     * @zh 场景的环境光照相关配置\n     */\n    @serializable\n    @editable\n    public ambient = new AmbientInfo();\n    /**\n     * @en Scene level shadow related configuration\n     * @zh 平面阴影相关配置\n     */\n    @serializable\n    @editable\n    public shadows = new ShadowsInfo();\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    public _skybox = new SkyboxInfo();\n    /**\n     * @en Global fog configuration\n     * @zh 全局雾相关配置\n     */\n    @editable\n    @serializable\n    public fog = new FogInfo();\n\n    /**\n     * @en Skybox related configuration\n     * @zh 天空盒相关配置\n     */\n    @editable\n    @type(SkyboxInfo)\n    get skybox () {\n        return this._skybox;\n    }\n    set skybox (value) {\n        this._skybox = value;\n    }\n\n    /**\n     * @en Octree related configuration\n     * @zh 八叉树相关配置\n     */\n    @editable\n    @serializable\n    public octree = new OctreeInfo();\n\n    /**\n     * @en Activate and initialize the global configurations of the scene, no need to invoke manually.\n     * @zh 启用和初始化场景全局配置，不需要手动调用\n     */\n    public activate () {\n        const sceneData = (legacyCC.director.root as Root).pipeline.pipelineSceneData;\n        this.skybox.activate(sceneData.skybox);\n        this.ambient.activate(sceneData.ambient);\n\n        this.shadows.activate(sceneData.shadows);\n        this.fog.activate(sceneData.fog);\n        this.octree.activate(sceneData.octree);\n\n        const root = legacyCC.director.root as Root;\n        root.onGlobalPipelineStateChanged();\n    }\n}\nlegacyCC.SceneGlobals = SceneGlobals;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { deprecateModuleExportedName } from '../core/utils/x-deprecated';\n\ndeprecateModuleExportedName({\n    SystemEventType: {\n        newName: 'Input.EventType',\n        since: '3.3.0',\n        removed: false,\n    },\n});\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { deprecateModuleExportedName } from '../core/utils/x-deprecated';\n\ndeprecateModuleExportedName({\n    SystemEvent: {\n        newName: 'Input',\n        since: '3.4.0',\n        removed: false,\n    },\n    systemEvent: {\n        newName: 'input',\n        since: '3.4.0',\n        removed: false,\n    },\n});\n","import { AccelerometerCallback } from 'pal/input';\nimport { systemInfo } from 'pal/system-info';\nimport { screenAdapter } from 'pal/screen-adapter';\nimport { EventTarget } from '../../../cocos/core/event/event-target';\nimport { BrowserType, OS } from '../../system-info/enum-type';\nimport { EventAcceleration, Acceleration } from '../../../cocos/input/types';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\n\nexport class AccelerometerInputSource {\n    private _intervalInMileSeconds = 200;\n    private _accelTimer = 0;\n    private _eventTarget: EventTarget = new  EventTarget();\n    private _deviceEventName: 'devicemotion' |'deviceorientation';\n    private _globalEventClass: typeof window.DeviceMotionEvent | typeof window.DeviceOrientationEvent;\n    private _didAccelerateFunc: (event: DeviceMotionEvent | DeviceOrientationEvent) => void;\n\n    constructor () {\n        // init event name\n        this._globalEventClass = window.DeviceMotionEvent || window.DeviceOrientationEvent;\n        // TODO fix DeviceMotionEvent bug on QQ Browser version 4.1 and below.\n        if (systemInfo.browserType === BrowserType.MOBILE_QQ) {\n            this._globalEventClass = window.DeviceOrientationEvent;\n        }\n        this._deviceEventName = this._globalEventClass === window.DeviceMotionEvent ? 'devicemotion' : 'deviceorientation';\n        this._didAccelerateFunc  = this._didAccelerate.bind(this);\n    }\n\n    private _registerEvent () {\n        this._accelTimer = performance.now();\n        window.addEventListener(this._deviceEventName, this._didAccelerateFunc, false);\n    }\n\n    private _unregisterEvent () {\n        this._accelTimer = 0;\n        window.removeEventListener(this._deviceEventName, this._didAccelerateFunc, false);\n    }\n\n    private _didAccelerate (event: DeviceMotionEvent | DeviceOrientationEvent) {\n        const now = performance.now();\n        if (now - this._accelTimer < this._intervalInMileSeconds) {\n            return;\n        }\n        this._accelTimer = now;\n\n        let x = 0;\n        let y = 0;\n        let z = 0;\n        if (this._globalEventClass === window.DeviceMotionEvent) {\n            const deviceMotionEvent = event as DeviceMotionEvent;\n            const eventAcceleration = deviceMotionEvent.accelerationIncludingGravity;\n            x = (eventAcceleration?.x || 0) * 0.1;\n            y = (eventAcceleration?.y || 0) * 0.1;\n            z = (eventAcceleration?.z || 0) * 0.1;\n        } else {\n            const deviceOrientationEvent = event as DeviceOrientationEvent;\n            x = ((deviceOrientationEvent.gamma || 0) / 90) * 0.981;\n            y = -((deviceOrientationEvent.beta || 0) / 90) * 0.981;\n            z = ((deviceOrientationEvent.alpha || 0) / 90) * 0.981;\n        }\n\n        if (screenAdapter.isFrameRotated) {\n            const tmp = x;\n            x = -y;\n            y = tmp;\n        }\n\n        // TODO: window.orientation is deprecated: https://developer.mozilla.org/en-US/docs/Web/API/Window/orientation\n        // try to use experimental screen.orientation: https://developer.mozilla.org/en-US/docs/Web/API/Screen/orientation\n        const PORTRAIT = 0;\n        const LANDSCAPE_LEFT = -90;\n        const PORTRAIT_UPSIDE_DOWN = 180;\n        const LANDSCAPE_RIGHT = 90;\n        const tmpX = x;\n        if (window.orientation === LANDSCAPE_RIGHT) {\n            x = -y;\n            y = tmpX;\n        } else if (window.orientation === LANDSCAPE_LEFT) {\n            x = y;\n            y = -tmpX;\n        } else if (window.orientation === PORTRAIT_UPSIDE_DOWN) {\n            x = -x;\n            y = -y;\n        }\n\n        // fix android acc values are opposite\n        if (systemInfo.os === OS.ANDROID\n            && systemInfo.browserType !== BrowserType.MOBILE_QQ) {\n            x = -x;\n            y = -y;\n        }\n        const timestamp = performance.now();\n        const acceleration = new Acceleration(x, y, z, timestamp);\n        const eventAcceleration = new EventAcceleration(acceleration);\n        this._eventTarget.emit(InputEventType.DEVICEMOTION, eventAcceleration);\n    }\n\n    public start () {\n        // for iOS 13+, safari\n        if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {\n            DeviceMotionEvent.requestPermission().then((response) => {\n                if (response === 'granted') {\n                    this._registerEvent();\n                }\n            }).catch((e) => {});\n        } else {\n            this._registerEvent();\n        }\n    }\n    public stop () {\n        this._unregisterEvent();\n    }\n    public setInterval (intervalInMileSeconds: number) {\n        this._intervalInMileSeconds = intervalInMileSeconds;\n    }\n    public on (eventType: InputEventType, callback: AccelerometerCallback, target?: any) {\n        this._eventTarget.on(eventType, callback, target);\n    }\n}\n","/*\n Copyright (c) 2022 Chukong Technologies Inc.\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Vec2, Vec3, Quat } from '../../cocos/core/math';\n\n/**\n * @en The abstract class for input source, which is used to control the input signal of a mono input source\n * @zh InputSource 抽象类，该类用于控制单一输入源的输入信号\n */\nexport abstract class InputSource<T> {\n    /**\n     * @en Get the signal value of the input source\n     * @zh 获取输入源的信号值\n     */\n    abstract getValue (): T;\n}\n\n/**\n * @en The class for input source of 1D Axis, which is used to control the input signal of a mono input source\n * @zh 1D 轴的 InputSource 类，该类用于控制单一输入源的输入信号\n */\nexport class InputSourceAxis1D extends InputSource<number> {\n    /**\n     * @en Get the signal value of the input source, ranged from -1 to 1\n     * @zh 获取输入源的信号值，取值范围从 -1 到 1\n     */\n    getValue (): number {\n        throw new Error('Method not implemented.');\n    }\n}\n\n/**\n * @en The class for input source of 2D Axis, which is used to control the input signal of a mono input source\n * @zh 2D 轴的 InputSource 类，该类用于控制单一输入源的输入信号\n */\nexport class InputSourceAxis2D extends InputSource<Vec2> {\n    /**\n     * @en Get the signal value of the input source, which returns a Vec2 object.\n     * @zh 获取输入源的信号值，该方法返回一个 Vec2 对象\n     */\n    getValue (): Vec2 {\n        throw new Error('Method not implemented.');\n    }\n}\n\n/**\n * @en The class for input source of 3D Axis, which is used to control the input signal of a mono input source\n * @zh 3D 轴的 InputSource 类，该类用于控制单一输入源的输入信号\n */\nexport class InputSourceAxis3D extends InputSource<Vec3> {\n    /**\n     * @en Get the signal value of the input source, which returns a Vec3 object.\n     * @zh 获取输入源的信号值，该方法返回一个 Vec3 对象\n     */\n    getValue (): Vec3 {\n        throw new Error('Method not implemented.');\n    }\n}\n\n/**\n * @en The class for input source of Quaternion, which is used to control the input signal of a mono input source\n * @zh 四元数的 InputSource 类，该类用于控制单一输入源的输入信号\n */\n export class InputSourceQuat extends InputSource<Quat> {\n    /**\n     * @en Get the signal value of the input source, which returns a Quat object.\n     * @zh 获取输入源的信号值，该方法返回一个 Quat 对象\n     */\n    getValue (): Quat {\n        throw new Error('Method not implemented.');\n    }\n}\n\n/**\n * @en The class for input source of 1D Axis, which is used to control the input signal of a composite of multi input source\n * @zh 1D 轴的 InputSource 类，该类用于控制多个输入源组合的输入信号\n */\nexport class CompositeInputSourceAxis1D extends InputSourceAxis1D {\n    /**\n     * @en The input source object of positive 1D axis\n     * @zh 1D 轴的正向的输入源对象\n     */\n    public positive: InputSourceButton;\n    /**\n     * @en The input source object of negative 1D axis\n     * @zh 1D 轴的负向的输入源对象\n     */\n    public negative: InputSourceButton;\n    constructor (options: {positive: InputSourceButton, negative: InputSourceButton}) {\n        super();\n        this.positive = options.positive;\n        this.negative = options.negative;\n    }\n    /**\n     * @en Get the signal value of the input source, ranged from -1 to 1.\n     * @zh 获取输入源的信号值，取值范围从 -1 到 1\n     */\n    public getValue (): number {\n        const positiveValue = this.positive.getValue();\n        const negativeValue = this.negative.getValue();\n        if (Math.abs(positiveValue) > Math.abs(negativeValue)) {\n            return positiveValue;\n        }\n        return -negativeValue;\n    }\n}\n\n/**\n * @en The class for input source of 2D Axis, which is used to control the input signal of a composite of multi input source\n * @zh 2D 轴的 InputSource 类，该类用于控制多个输入源组合的输入信号\n */\nexport class CompositeInputSourceAxis2D extends InputSourceAxis2D {\n    /**\n     * @en The input source object of up direction of 2D axis\n     * @zh 2D 轴的向上的输入源对象\n     */\n    public up: InputSourceButton;\n    /**\n     * @en The input source object of down direction of 2D axis\n     * @zh 2D 轴的向下的输入源对象\n     */\n    public down: InputSourceButton;\n    /**\n     * @en The input source object of left direction of 2D axis\n     * @zh 2D 轴的向左的输入源对象\n     */\n    public left: InputSourceButton;\n    /**\n     * @en The input source object of right direction of 2D axis\n     * @zh 2D 轴的向右的输入源对象\n     */\n    public right: InputSourceButton;\n\n    /**\n     * @en The composite input source object on the x axis of 2D axis\n     * @zh 2D 轴在 x 轴上的组合输入源对象\n     */\n    public xAxis: CompositeInputSourceAxis1D;\n    /**\n     * @en The composite input source object on the y axis of 2D axis\n     * @zh 2D 轴在 y 轴上的组合输入源对象\n     */\n    public yAxis: CompositeInputSourceAxis1D;\n    constructor (options: {up: InputSourceButton, down: InputSourceButton, left: InputSourceButton, right: InputSourceButton}) {\n        super();\n        this.up = options.up;\n        this.down = options.down;\n        this.left = options.left;\n        this.right = options.right;\n        this.xAxis = new CompositeInputSourceAxis1D({ positive: this.right, negative: this.left });\n        this.yAxis = new CompositeInputSourceAxis1D({ positive: this.up, negative: this.down });\n    }\n    /**\n     * @en Get the signal value of the input source, which returns a Vec2 object.\n     * @zh 获取输入源的信号值，该方法返回一个 Vec2 对象\n     */\n    getValue (): Vec2 {\n        return new Vec2(this.xAxis.getValue(), this.yAxis.getValue());\n    }\n}\n\n/**\n * @en The class for input source of 3D Axis, which is used to control the input signal of a composite of multi input source\n * @zh 3D 轴的 InputSource 类，该类用于控制多个输入源组合的输入信号\n */\nexport class CompositeInputSourceAxis3D extends InputSourceAxis3D {\n    /**\n     * @en The input source object of up direction of 3D axis\n     * @zh 3D 轴的向上的输入源对象\n     */\n    public up: InputSourceButton;\n    /**\n     * @en The input source object of down direction of 3D axis\n     * @zh 3D 轴的向下的输入源对象\n     */\n    public down: InputSourceButton;\n    /**\n     * @en The input source object of left direction of 3D axis\n     * @zh 3D 轴的向左的输入源对象\n     */\n    public left: InputSourceButton;\n    /**\n     * @en The input source object of right direction of 3D axis\n     * @zh 3D 轴的向右的输入源对象\n     */\n    public right: InputSourceButton;\n    /**\n     * @en The input source object of forward direction of 3D axis\n     * @zh 3D 轴的向前的输入源对象\n     */\n    public forward: InputSourceButton;\n    /**\n     * @en The input source object of backward direction of 3D axis\n     * @zh 3D 轴的向后的输入源对象\n     */\n    public backward: InputSourceButton;\n\n    /**\n     * @en The composite input source object on the x axis of 3D axis\n     * @zh 3D 轴在 x 轴上的组合输入源对象\n     */\n    public xAxis: CompositeInputSourceAxis1D;\n    /**\n     * @en The composite input source object on the y axis of 3D axis\n     * @zh 3D 轴在 y 轴上的组合输入源对象\n     */\n    public yAxis: CompositeInputSourceAxis1D;\n    /**\n     * @en The composite input source object on the z axis of 3D axis\n     * @zh 3D 轴在 z 轴上的组合输入源对象\n     */\n    public zAxis: CompositeInputSourceAxis1D;\n    constructor (options: {up: InputSourceButton, down: InputSourceButton, left: InputSourceButton,\n        right: InputSourceButton, forward: InputSourceButton, backward: InputSourceButton}) {\n        super();\n        this.up = options.up;\n        this.down = options.down;\n        this.left = options.left;\n        this.right = options.right;\n        this.forward = options.forward;\n        this.backward = options.backward;\n\n        this.xAxis = new CompositeInputSourceAxis1D({ positive: this.right, negative: this.left });\n        this.yAxis = new CompositeInputSourceAxis1D({ positive: this.up, negative: this.down });\n        this.zAxis = new CompositeInputSourceAxis1D({ positive: this.forward, negative: this.backward });\n    }\n\n    /**\n     * @en Get the signal value of the input source, which returns a Vec3 object.\n     * @zh 获取输入源的信号值，该方法返回一个 Vec3 对象\n     */\n    getValue (): Vec3 {\n        return new Vec3(this.xAxis.getValue(), this.yAxis.getValue(), this.zAxis.getValue());\n    }\n}\n\n/**\n * @en The class for input source of mono button, whose input signal value is ranged from 0 to 1\n * @zh 单一按键输入源类, 输入信号源的取值范围是 0 到 1\n */\nexport class InputSourceButton extends InputSourceAxis1D {\n    /**\n     * @en Get the signal value of the input source, ranged from 0 to 1\n     * @zh 获取输入源的信号值，取值范围从 0 到 1\n     */\n    getValue (): number {\n        return super.getValue();\n    }\n}\n\n/**\n * @en The class for input source of dpad, whose input signal value a Vec2 object\n * @zh 手柄方向键输入源类, 输入信号源的取值是一个 Vec2 对象\n */\nexport class InputSourceDpad extends CompositeInputSourceAxis2D {\n}\n\n/**\n * @en The class for input source of stick, whose input signal value a Vec2 object\n * @zh 摇杆输入源类, 输入信号源的取值是一个 Vec2 对象\n */\nexport class InputSourceStick extends CompositeInputSourceAxis2D {\n}\n\n/**\n * @en The class for input source of orientation, whose input signal value a Quat object\n * @zh 方向输入源类, 输入信号源的取值是一个 Quat 对象\n */\n export class InputSourceOrientation extends InputSourceQuat {\n    /**\n     * @en Get the signal value of the input source, which returns a Quat object.\n     * @zh 获取输入源的信号值，该方法返回一个 Quat 对象\n     */\n     getValue (): Quat {\n        return super.getValue();\n    }\n}\n\n/**\n * @en The class for input source of position, whose input signal value a Vec3 object\n * @zh 坐标输入源类, 输入信号源的取值是一个 Vec3 对象\n */\n export class InputSourcePosition extends InputSourceAxis3D {\n    /**\n     * @en Get the signal value of the input source, which returns a Vec3 object.\n     * @zh 获取输入源的信号值，该方法返回一个 Vec3 对象\n     */\n     getValue (): Vec3 {\n        return super.getValue();\n    }\n}\n","import { GamepadCallback } from 'pal/input';\nimport { systemInfo } from 'pal/system-info';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\nimport { EventTarget } from '../../../cocos/core/event/event-target';\nimport legacyCC from '../../../predefine';\nimport { Feature } from '../../system-info/enum-type';\nimport { InputSourceButton, InputSourceDpad, InputSourceStick } from '../input-source';\nimport { fastRemoveAt } from '../../../cocos/core/utils/array';\nimport { EventGamepad } from '../../../cocos/input/types';\n\n//#region button index alias\nconst BUTTON_SOUTH = 0;\nconst BUTTON_EAST = 1;\nconst BUTTON_WEST = 2;\nconst BUTTON_NORTH = 3;\nconst BUTTON_L1 = 4;\nconst BUTTON_R1 = 5;\nconst BUTTON_L2 = 6;\nconst BUTTON_R2 = 7;\nconst BUTTON_SHARE = 8;\nconst BUTTON_OPTIONS = 9;\nconst BUTTON_L3 = 10;\nconst BUTTON_R3 = 11;\nconst BUTTON_DPAD_UP = 12;\nconst BUTTON_DPAD_DOWN = 13;\nconst BUTTON_DPAD_LEFT = 14;\nconst BUTTON_DPAD_RIGHT = 15;\nconst BUTTON_HOME = 16;\nconst BUTTON_TOUCH_PAD = 17;\nconst AXIS_LEFT_STICK_X = 0;\nconst AXIS_LEFT_STICK_Y = 1;\nconst AXIS_RIGHT_STICK_X = 2;\nconst AXIS_RIGHT_STICK_Y = 3;\n//#endregion  button index alias\n\nconst EPSILON = 0.01;\ntype WebGamepad = Gamepad;\n\ninterface IAxisValue {\n    negative: number;\n    positive: number;\n}\nexport class GamepadInputDevice {\n    public static all: GamepadInputDevice[] = [];\n\n    public get buttonNorth () { return this._buttonNorth; }\n    public get buttonEast () { return this._buttonEast; }\n    public get buttonWest () { return this._buttonWest; }\n    public get buttonSouth () { return this._buttonSouth; }\n    public get buttonL1 () { return this._buttonL1; }\n    public get buttonL2 () { return this._buttonL2; }\n    public get buttonL3 () { return this._buttonL3; }\n    public get buttonR1 () { return this._buttonR1; }\n    public get buttonR2 () { return this._buttonR2; }\n    public get buttonR3 () { return this._buttonR3; }\n    // public get buttonTouchPad () { return this._buttonTouchPad; }\n    // public get buttonHome () { return this._buttonHome; }\n    public get buttonShare () { return this._buttonShare; }\n    public get buttonOptions () { return this._buttonOptions; }\n    public get dpad () { return this._dpad; }\n    public get leftStick () { return this._leftStick; }\n    public get rightStick () { return this._rightStick; }\n    public get buttonStart () { return this._buttonStart; }\n\n    public get deviceId () {\n        return this._deviceId;\n    }\n    public get connected () {\n        return this._connected;\n    }\n\n    private static _eventTarget: EventTarget = new EventTarget();\n    private static _cachedWebGamepads: (WebGamepad | null)[] = [];\n    private static _intervalId = -1;\n\n    private _buttonNorth!: InputSourceButton;\n    private _buttonEast!: InputSourceButton;\n    private _buttonWest!: InputSourceButton;\n    private _buttonSouth!: InputSourceButton;\n    private _buttonL1!: InputSourceButton;\n    private _buttonL2!: InputSourceButton;\n    private _buttonL3!: InputSourceButton;\n    private _buttonR1!: InputSourceButton;\n    private _buttonR2!: InputSourceButton;\n    private _buttonR3!: InputSourceButton;\n    // private buttonTouchPad!: InputSourceButton;\n    // private buttonHome!: InputSourceButton;\n    private _buttonShare!: InputSourceButton;\n    private _buttonOptions!: InputSourceButton;\n    private _dpad!: InputSourceDpad;\n    private _leftStick!: InputSourceStick;\n    private _rightStick!: InputSourceStick;\n    private _buttonStart!: InputSourceButton;\n\n    private _deviceId = -1;\n    private _connected = false;\n\n    constructor (deviceId: number) {\n        this._deviceId = deviceId;\n        this._initInputSource();\n    }\n\n    /**\n     * @engineInternal\n     */\n    public static _init () {\n        if (!systemInfo.hasFeature(Feature.EVENT_GAMEPAD)) {\n            return;\n        }\n        GamepadInputDevice._registerEvent();\n    }\n\n    /**\n     * @engineInternal\n     */\n    public static _on (eventType: InputEventType, cb: GamepadCallback, target?: any) {\n        GamepadInputDevice._eventTarget.on(eventType, cb, target);\n    }\n\n    private static _removeInputDevice (id: number) {\n        const removeIndex = GamepadInputDevice.all.findIndex((device) => device.deviceId === id);\n        if (removeIndex === -1) {\n            return;\n        }\n        fastRemoveAt(GamepadInputDevice.all, removeIndex);\n    }\n    private static _getOrCreateInputDevice (id: number, connected: boolean): GamepadInputDevice {\n        let device =  GamepadInputDevice.all.find((device) => device.deviceId === id);\n        if (!device) {\n            device = new GamepadInputDevice(id);\n            GamepadInputDevice.all.push(device);\n        }\n        device._connected = connected;\n        return device;\n    }\n\n    private static _ensureDirectorDefined () {\n        return new Promise<void>((resolve) => {\n            GamepadInputDevice._intervalId = setInterval(() => {\n                if (legacyCC.director && legacyCC.Director) {\n                    clearInterval(GamepadInputDevice._intervalId);\n                    GamepadInputDevice._intervalId = -1;\n                    resolve();\n                }\n            }, 50);\n        });\n    }\n\n    private static _registerEvent () {\n        GamepadInputDevice._ensureDirectorDefined().then(() => {\n            legacyCC.director.on(legacyCC.Director.EVENT_BEGIN_FRAME, GamepadInputDevice._scanGamepads);\n        }).catch((e) => {});\n        window.addEventListener('gamepadconnected', (e) => {\n            GamepadInputDevice._cachedWebGamepads[e.gamepad.index] = e.gamepad;\n            const device = GamepadInputDevice._getOrCreateInputDevice(e.gamepad.index, true);\n            GamepadInputDevice._eventTarget.emit(InputEventType.GAMEPAD_CHANGE, new EventGamepad(InputEventType.GAMEPAD_CHANGE, device));\n        });\n        window.addEventListener('gamepaddisconnected', (e) => {\n            GamepadInputDevice._cachedWebGamepads[e.gamepad.index] = null;\n            const device = GamepadInputDevice._getOrCreateInputDevice(e.gamepad.index, false);\n            GamepadInputDevice._removeInputDevice(e.gamepad.index);\n            GamepadInputDevice._eventTarget.emit(InputEventType.GAMEPAD_CHANGE, new EventGamepad(InputEventType.GAMEPAD_CHANGE, device));\n        });\n    }\n\n    private static _scanGamepads () {\n        const webGamepads = GamepadInputDevice._getWebGamePads();\n        if (!webGamepads) {\n            return;\n        }\n        const devices: GamepadInputDevice[] = [];\n        for (let i = 0; i < webGamepads.length; ++i) {\n            const webGamepad = webGamepads?.[i];\n            if (!webGamepad) {\n                continue;\n            }\n            const cachedWebGamepad = GamepadInputDevice._cachedWebGamepads[webGamepad.index];\n            // TODO: what if cachedWebGamepad is null\n            if (cachedWebGamepad) {\n                let device: GamepadInputDevice | undefined;\n                const cachedButtons = cachedWebGamepad.buttons;\n                for (let j = 0; j < cachedButtons.length; ++j) {\n                    const cachedButton = cachedButtons[j];\n                    const button = webGamepad.buttons[j];\n                    if (Math.abs(cachedButton.value - button.value) > EPSILON) {\n                        device = GamepadInputDevice._getOrCreateInputDevice(webGamepad.index, true);\n                        break;\n                    }\n                }\n                if (device) {\n                    devices.push(device);\n                    continue;\n                }\n\n                const cachedAxes = cachedWebGamepad.axes;\n                for (let j = 0; j < cachedAxes.length; ++j) {\n                    const cachedAxisValue = cachedAxes[j];\n                    const axisValue = webGamepad.axes[j];\n                    if (Math.abs(cachedAxisValue - axisValue) > EPSILON) {\n                        device = GamepadInputDevice._getOrCreateInputDevice(webGamepad.index, true);\n                        break;\n                    }\n                }\n                if (device) {\n                    devices.push(device);\n                    continue;\n                }\n            }\n        }\n        // update cache\n        GamepadInputDevice._cachedWebGamepads = webGamepads;\n        // emit event\n        for (let i = 0; i < devices.length; ++i) {\n            const device = devices[i];\n            GamepadInputDevice._eventTarget.emit(InputEventType.GAMEPAD_INPUT, new EventGamepad(InputEventType.GAMEPAD_INPUT, device));\n        }\n    }\n\n    private static _getWebGamePads (): (WebGamepad | null)[] {\n        if (typeof navigator.getGamepads === 'function') {\n            return navigator.getGamepads();\n            // @ts-expect-error Property 'webkitGetGamepads' does not exist on type 'Navigator'\n        } else if (typeof navigator.webkitGetGamepads === 'function') {\n            // @ts-expect-error Property 'webkitGetGamepads' does not exist on type 'Navigator'\n            return navigator.webkitGetGamepads() as (Gamepad | null)[];\n        }\n        return [];\n    }\n\n    private static _getWebGamepad (deviceId: number): WebGamepad | undefined {\n        const webGamepads = GamepadInputDevice._getWebGamePads();\n        for (let i = 0; i < webGamepads.length; ++i) {\n            const webGamepad = webGamepads[i];\n            if (webGamepad && webGamepad.index === deviceId) {\n                return webGamepad;\n            }\n        }\n        return undefined;\n    }\n\n    private _axisToButtons (axisValue: number): IAxisValue {\n        const value = Math.abs(axisValue);\n        if (axisValue > 0) {\n            return { negative: 0, positive: value };\n        } else if (axisValue < 0) {\n            return { negative: value, positive: 0 };\n        } else {\n            return { negative: 0, positive: 0 };\n        }\n    }\n\n    private _initInputSource () {\n        this._buttonNorth = new InputSourceButton();\n        this._buttonNorth.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_NORTH].value; }\n            return 0;\n        };\n        this._buttonEast = new InputSourceButton();\n        this._buttonEast.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_EAST].value; }\n            return 0;\n        };\n        this._buttonWest = new InputSourceButton();\n        this._buttonWest.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_WEST].value; }\n            return 0;\n        };\n        this._buttonSouth = new InputSourceButton();\n        this._buttonSouth.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_SOUTH].value; }\n            return 0;\n        };\n\n        this._buttonL1 = new InputSourceButton();\n        this._buttonL1.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_L1].value; }\n            return 0;\n        };\n        this._buttonL2 = new InputSourceButton();\n        this._buttonL2.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_L2].value; }\n            return 0;\n        };\n        this._buttonL3 = new InputSourceButton();\n        this._buttonL3.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_L3].value; }\n            return 0;\n        };\n        this._buttonR1 = new InputSourceButton();\n        this._buttonR1.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_R1].value; }\n            return 0;\n        };\n        this._buttonR2 = new InputSourceButton();\n        this._buttonR2.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_R2].value; }\n            return 0;\n        };\n        this._buttonR3 = new InputSourceButton();\n        this._buttonR3.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_R3].value; }\n            return 0;\n        };\n\n        // this._buttonTouchPad = new InputSourceButton();\n        // this._buttonTouchPad.getValue = () => {\n        //     const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n        //     if (webGamepad) { return webGamepad.buttons[BUTTON_TOUCH_PAD].value; }\n        //     return 0;\n        // };\n        // this._buttonHome = new InputSourceButton();\n        // this._buttonHome.getValue = () => {\n        //     const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n        //     if (webGamepad) { return webGamepad.buttons[BUTTON_HOME].value; }\n        //     return 0;\n        // };\n        this._buttonShare = new InputSourceButton();\n        this._buttonShare.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_SHARE].value; }\n            return 0;\n        };\n        this._buttonOptions = new InputSourceButton();\n        this._buttonOptions.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_OPTIONS].value; }\n            return 0;\n        };\n\n        const dpadUp = new InputSourceButton();\n        dpadUp.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_DPAD_UP].value; }\n            return 0;\n        };\n        const dpadDown = new InputSourceButton();\n        dpadDown.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_DPAD_DOWN].value; }\n            return 0;\n        };\n        const dpadLeft = new InputSourceButton();\n        dpadLeft.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_DPAD_LEFT].value; }\n            return 0;\n        };\n        const dpadRight = new InputSourceButton();\n        dpadRight.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) { return webGamepad.buttons[BUTTON_DPAD_RIGHT].value; }\n            return 0;\n        };\n        this._dpad = new InputSourceDpad({ up: dpadUp, down: dpadDown, left: dpadLeft, right: dpadRight });\n\n        const leftStickUp = new InputSourceButton();\n        leftStickUp.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_LEFT_STICK_Y]).negative;\n            }\n            return 0;\n        };\n        const leftStickDown = new InputSourceButton();\n        leftStickDown.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_LEFT_STICK_Y]).positive;\n            }\n            return 0;\n        };\n        const leftStickLeft = new InputSourceButton();\n        leftStickLeft.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_LEFT_STICK_X]).negative;\n            }\n            return 0;\n        };\n        const leftStickRight = new InputSourceButton();\n        leftStickRight.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_LEFT_STICK_X]).positive;\n            }\n            return 0;\n        };\n        this._leftStick = new InputSourceStick({ up: leftStickUp, down: leftStickDown, left: leftStickLeft, right: leftStickRight });\n\n        const rightStickUp = new InputSourceButton();\n        rightStickUp.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_RIGHT_STICK_Y]).negative;\n            }\n            return 0;\n        };\n        const rightStickDown = new InputSourceButton();\n        rightStickDown.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_RIGHT_STICK_Y]).positive;\n            }\n            return 0;\n        };\n        const rightStickLeft = new InputSourceButton();\n        rightStickLeft.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_RIGHT_STICK_X]).negative;\n            }\n            return 0;\n        };\n        const rightStickRight = new InputSourceButton();\n        rightStickRight.getValue = () => {\n            const webGamepad = GamepadInputDevice._getWebGamepad(this.deviceId);\n            if (webGamepad) {\n                return this._axisToButtons(webGamepad.axes[AXIS_RIGHT_STICK_X]).positive;\n            }\n            return 0;\n        };\n        this._rightStick = new InputSourceStick({ up: rightStickUp, down: rightStickDown, left: rightStickLeft, right: rightStickRight });\n\n        this._buttonStart = new InputSourceButton();\n        this._buttonStart.getValue = () => 0;\n    }\n}\n","/*\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, NATIVE } from 'internal:constants';\nimport { TouchInputSource, MouseInputSource, KeyboardInputSource, AccelerometerInputSource, GamepadInputDevice, HandleInputDevice, HMDInputDevice } from 'pal/input';\nimport { touchManager } from '../../pal/input/touch-manager';\nimport { sys } from '../core/platform/sys';\nimport { EventTarget } from '../core/event/event-target';\nimport { Event, EventAcceleration, EventGamepad, EventHandle, EventHMD, EventKeyboard, EventMouse, EventTouch, Touch } from './types';\nimport { InputEventType } from './types/event-enum';\nimport { legacyCC } from '../core/global-exports';\n\nexport enum EventDispatcherPriority {\n    GLOBAL = 0,\n    UI = 1,\n}\n\nexport interface IEventDispatcher {\n    /**\n     * Priority to emit event to dispatcher\n     */\n    readonly priority: EventDispatcherPriority;\n    /**\n     * @param event\n     * @returns Whether dispatch to next event dispatcher\n     */\n    dispatchEvent (event: Event): boolean;\n}\n\nclass InputEventDispatcher implements IEventDispatcher {\n    public priority: EventDispatcherPriority = EventDispatcherPriority.GLOBAL;\n    private _inputEventTarget: EventTarget;\n\n    constructor (inputEventTarget: EventTarget) {\n        this._inputEventTarget = inputEventTarget;\n    }\n\n    public dispatchEvent (event: Event): boolean {\n        this._inputEventTarget.emit(event.type, event);\n        return true;\n    }\n}\n\nconst pointerEventTypeMap = {\n    [InputEventType.MOUSE_DOWN]: InputEventType.TOUCH_START,\n    [InputEventType.MOUSE_MOVE]: InputEventType.TOUCH_MOVE,\n    [InputEventType.MOUSE_UP]: InputEventType.TOUCH_END,\n};\n\nexport declare namespace Input {\n    export type EventType = EnumAlias<typeof InputEventType>;\n}\n\ninterface InputEventMap {\n    [Input.EventType.MOUSE_DOWN]: (event: EventMouse) => void,\n    [Input.EventType.MOUSE_MOVE]: (event: EventMouse) => void,\n    [Input.EventType.MOUSE_UP]: (event: EventMouse) => void,\n    [Input.EventType.MOUSE_WHEEL]: (event: EventMouse) => void,\n    [Input.EventType.TOUCH_START]: (event: EventTouch) => void,\n    [Input.EventType.TOUCH_MOVE]: (event: EventTouch) => void,\n    [Input.EventType.TOUCH_END]: (event: EventTouch) => void,\n    [Input.EventType.TOUCH_CANCEL]: (event: EventTouch) => void,\n    [Input.EventType.KEY_DOWN]: (event: EventKeyboard) => void,\n    [Input.EventType.KEY_PRESSING]: (event: EventKeyboard) => void,\n    [Input.EventType.KEY_UP]: (event: EventKeyboard) => void,\n    [Input.EventType.DEVICEMOTION]: (event: EventAcceleration) => void,\n    [Input.EventType.GAMEPAD_CHANGE]: (event: EventGamepad) => void,\n    [Input.EventType.GAMEPAD_INPUT]: (event: EventGamepad) => void,\n    [Input.EventType.HANDLE_INPUT]: (event: EventHandle) => void,\n    [Input.EventType.HANDLE_POSE_INPUT]: (event: EventHandle) => void,\n    [Input.EventType.HMD_POSE_INPUT]: (event: EventHMD) => void,\n}\n\n/**\n * @en\n * This Input class manages all events of input. include: touch, mouse, accelerometer, gamepad, handle, hmd and keyboard.\n * You can get the `Input` instance with `input`.\n *\n * @zh\n * 该输入类管理所有的输入事件，包括：触摸、鼠标、加速计、游戏手柄、6DOF手柄、头戴显示器 和 键盘。\n * 你可以通过 `input` 获取到 `Input` 的实例。\n *\n * @example\n * ```\n * input.on(Input.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n * input.off(Input.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n * ```\n */\nexport class Input {\n    /**\n     * @en The input event type\n     * @zh 输入事件类型\n     */\n    public static EventType = InputEventType;\n\n    /**\n     * @en Dispatch input event immediately.\n     * The input events are collocted to be dispatched in each main loop by default.\n     * If you need to recieve the input event immediately, please set this to true.\n     * NOTE: if set this to true, the input events are dispatched between each tick, the input event can't be optimized by engine.\n     *\n     * @zh 立即派发输入事件。\n     * 输入事件默认会被收集到每一帧主循环里派发，如果你需要立即接收到输入事件，请把该属性设为 true。\n     * 注意：如果设置为 true，则输入事件可能会在帧间触发，这样的输入事件是没办法被引擎优化的。\n     */\n    private _dispatchImmediately = !NATIVE;\n\n    private _eventTarget: EventTarget = new EventTarget();\n    private _touchInput = new TouchInputSource();\n    private _mouseInput = new MouseInputSource();\n    private _keyboardInput = new KeyboardInputSource();\n    private _accelerometerInput = new AccelerometerInputSource();\n    private _handleInput = new HandleInputDevice();\n    private _hmdInput = new HMDInputDevice();\n\n    private _eventTouchList: EventTouch[] = [];\n    private _eventMouseList: EventMouse[] = [];\n    private _eventKeyboardList: EventKeyboard[] = [];\n    private _eventAccelerationList: EventAcceleration[] = [];\n    private _eventGamepadList: EventGamepad[] = [];\n    private _eventHandleList: EventHandle[] = [];\n    private _eventHMDList: EventHMD[] = [];\n\n    private _needSimulateTouchMoveEvent = false;\n\n    private _inputEventDispatcher: InputEventDispatcher;\n    private _eventDispatcherList: IEventDispatcher[] = [];\n\n    constructor () {\n        this._registerEvent();\n        this._inputEventDispatcher = new InputEventDispatcher(this._eventTarget);\n        this._registerEventDispatcher(this._inputEventDispatcher);\n        GamepadInputDevice._init();\n    }\n\n    /**\n     * This should be a private method, but it's exposed for Editor Only.\n     */\n    private _dispatchMouseDownEvent (nativeMouseEvent: any) { this._mouseInput.dispatchMouseDownEvent?.(nativeMouseEvent); }\n    /**\n     * This should be a private method, but it's exposed for Editor Only.\n     */\n    private _dispatchMouseMoveEvent (nativeMouseEvent: any) { this._mouseInput.dispatchMouseMoveEvent?.(nativeMouseEvent); }\n    /**\n     * This should be a private method, but it's exposed for Editor Only.\n     */\n    private _dispatchMouseUpEvent (nativeMouseEvent: any) { this._mouseInput.dispatchMouseUpEvent?.(nativeMouseEvent); }\n    /**\n     * This should be a private method, but it's exposed for Editor Only.\n     */\n    private _dispatchMouseScrollEvent (nativeMouseEvent: any) { this._mouseInput.dispatchScrollEvent?.(nativeMouseEvent); }\n\n    /**\n     * This should be a private method, but it's exposed for Editor Only.\n     */\n    private _dispatchKeyboardDownEvent (nativeKeyboardEvent: any) { this._keyboardInput.dispatchKeyboardDownEvent?.(nativeKeyboardEvent); }\n    /**\n     * This should be a private method, but it's exposed for Editor Only.\n     */\n    private _dispatchKeyboardUpEvent (nativeKeyboardEvent: any) { this._keyboardInput.dispatchKeyboardUpEvent?.(nativeKeyboardEvent); }\n\n    /**\n     * @en\n     * Register a callback of a specific input event type.\n     * @zh\n     * 注册特定的输入事件回调。\n     *\n     * @param eventType - The event type\n     * @param callback - The event listener's callback\n     * @param target - The event listener's target and callee\n     */\n    public on<K extends keyof InputEventMap> (eventType: K, callback: InputEventMap[K], target?: any) {\n        this._eventTarget.on(eventType, callback, target);\n        return callback;\n    }\n\n    /**\n     * @en\n     * Register a callback of a specific input event type once.\n     * @zh\n     * 注册单次的输入事件回调。\n     *\n     * @param eventType - The event type\n     * @param callback - The event listener's callback\n     * @param target - The event listener's target and callee\n     */\n    public once<K extends keyof InputEventMap> (eventType: K, callback: InputEventMap[K], target?: any) {\n        this._eventTarget.once(eventType, callback, target);\n        return callback;\n    }\n\n    /**\n     * @en\n     * Unregister a callback of a specific input event type.\n     * @zh\n     * 取消注册特定的输入事件回调。\n     *\n     * @param eventType - The event type\n     * @param callback - The event listener's callback\n     * @param target - The event listener's target and callee\n     */\n    public off<K extends keyof InputEventMap> (eventType: K, callback?: InputEventMap[K], target?: any) {\n        if (EDITOR && !legacyCC.GAME_VIEW) {\n            return;\n        }\n        this._eventTarget.off(eventType, callback, target);\n    }\n    /**\n     * @en\n     * Sets whether to enable the accelerometer event listener or not.\n     *\n     * @zh\n     * 是否启用加速度计事件。\n     */\n    public setAccelerometerEnabled (isEnable: boolean) {\n        if (EDITOR && !legacyCC.GAME_VIEW) {\n            return;\n        }\n        if (isEnable) {\n            this._accelerometerInput.start();\n        } else {\n            this._accelerometerInput.stop();\n        }\n    }\n\n    /**\n     * @en\n     * Sets the accelerometer interval value.\n     *\n     * @zh\n     * 设置加速度计间隔值。\n     */\n    public setAccelerometerInterval (intervalInMileSeconds: number): void {\n        if (EDITOR && !legacyCC.GAME_VIEW) {\n            return;\n        }\n        this._accelerometerInput.setInterval(intervalInMileSeconds);\n    }\n\n    private _simulateEventTouch (eventMouse: EventMouse) {\n        const eventType = pointerEventTypeMap[eventMouse.type];\n        const touchID = 0;\n        const touch = touchManager.getTouch(touchID, eventMouse.getLocationX(), eventMouse.getLocationY());\n        if (!touch) {\n            return;\n        }\n        const changedTouches = [touch];\n        const eventTouch = new EventTouch(changedTouches, false, eventType, (eventType === InputEventType.TOUCH_END ? [] : changedTouches));\n        if (eventType === InputEventType.TOUCH_END) {\n            touchManager.releaseTouch(touchID);\n        }\n        this._dispatchOrPushEventTouch(eventTouch, this._eventTouchList);\n    }\n\n    // TODO: public in engine\n    private _registerEventDispatcher (eventDispatcher: IEventDispatcher) {\n        this._eventDispatcherList.push(eventDispatcher);\n        this._eventDispatcherList.sort((a, b) => b.priority - a.priority);\n    }\n\n    private _emitEvent (event: Event) {\n        const length = this._eventDispatcherList.length;\n        for (let i = 0; i < length; ++i) {\n            const dispatcher = this._eventDispatcherList[i];\n            if (!dispatcher.dispatchEvent(event)) {\n                break;\n            }\n        }\n    }\n\n    private _registerEvent () {\n        if (sys.hasFeature(sys.Feature.INPUT_TOUCH)) {\n            const eventTouchList = this._eventTouchList;\n            this._touchInput.on(InputEventType.TOUCH_START, (event) => { this._dispatchOrPushEventTouch(event, eventTouchList); });\n            this._touchInput.on(InputEventType.TOUCH_MOVE, (event) => { this._dispatchOrPushEventTouch(event, eventTouchList); });\n            this._touchInput.on(InputEventType.TOUCH_END, (event) => { this._dispatchOrPushEventTouch(event, eventTouchList); });\n            this._touchInput.on(InputEventType.TOUCH_CANCEL, (event) => { this._dispatchOrPushEventTouch(event, eventTouchList); });\n        }\n\n        if (sys.hasFeature(sys.Feature.EVENT_MOUSE)) {\n            const eventMouseList = this._eventMouseList;\n            this._mouseInput.on(InputEventType.MOUSE_DOWN, (event) => {\n                this._needSimulateTouchMoveEvent = true;\n                this._simulateEventTouch(event);\n                this._dispatchOrPushEvent(event, eventMouseList);\n            });\n            this._mouseInput.on(InputEventType.MOUSE_MOVE, (event) => {\n                if (this._needSimulateTouchMoveEvent) {\n                    this._simulateEventTouch(event);\n                }\n                this._dispatchOrPushEvent(event, eventMouseList);\n            });\n            this._mouseInput.on(InputEventType.MOUSE_UP, (event) => {\n                this._needSimulateTouchMoveEvent = false;\n                this._simulateEventTouch(event);\n                this._dispatchOrPushEvent(event, eventMouseList);\n            });\n            this._mouseInput.on(InputEventType.MOUSE_WHEEL, (event) => { this._dispatchOrPushEvent(event, eventMouseList); });\n        }\n\n        if (sys.hasFeature(sys.Feature.EVENT_KEYBOARD)) {\n            const eventKeyboardList = this._eventKeyboardList;\n            this._keyboardInput.on(InputEventType.KEY_DOWN, (event) => { this._dispatchOrPushEvent(event, eventKeyboardList); });\n            this._keyboardInput.on(InputEventType.KEY_PRESSING, (event) => { this._dispatchOrPushEvent(event, eventKeyboardList); });\n            this._keyboardInput.on(InputEventType.KEY_UP, (event) => { this._dispatchOrPushEvent(event, eventKeyboardList); });\n        }\n\n        if (sys.hasFeature(sys.Feature.EVENT_ACCELEROMETER)) {\n            const eventAccelerationList = this._eventAccelerationList;\n            this._accelerometerInput.on(InputEventType.DEVICEMOTION, (event) => { this._dispatchOrPushEvent(event, eventAccelerationList); });\n        }\n\n        if (sys.hasFeature(sys.Feature.EVENT_GAMEPAD)) {\n            const eventGamepadList = this._eventGamepadList;\n            GamepadInputDevice._on(InputEventType.GAMEPAD_CHANGE, (event) => { this._dispatchOrPushEvent(event, eventGamepadList); });\n            GamepadInputDevice._on(InputEventType.GAMEPAD_INPUT, (event) => { this._dispatchOrPushEvent(event, eventGamepadList); });\n        }\n\n        if (sys.hasFeature(sys.Feature.EVENT_HANDLE)) {\n            const eventHandleList = this._eventHandleList;\n            this._handleInput._on(InputEventType.HANDLE_INPUT, (event) => { this._dispatchOrPushEvent(event, eventHandleList); });\n            this._handleInput._on(InputEventType.HANDLE_POSE_INPUT, (event) => { this._dispatchOrPushEvent(event, eventHandleList); });\n        }\n\n        if (sys.hasFeature(sys.Feature.EVENT_HMD)) {\n            const eventHMDList = this._eventHMDList;\n            this._hmdInput._on(InputEventType.HMD_POSE_INPUT, (event) => { this._dispatchOrPushEvent(event, eventHMDList); });\n        }\n    }\n\n    private _clearEvents () {\n        this._eventMouseList.length = 0;\n        this._eventTouchList.length = 0;\n        this._eventKeyboardList.length = 0;\n        this._eventAccelerationList.length = 0;\n        this._eventGamepadList.length = 0;\n        this._eventHandleList.length = 0;\n        this._eventHMDList.length = 0;\n    }\n\n    private _dispatchOrPushEvent (event: Event, eventList: Event[]) {\n        if (this._dispatchImmediately) {\n            this._emitEvent(event);\n        } else {\n            eventList.push(event);\n        }\n    }\n\n    private _dispatchOrPushEventTouch (eventTouch: EventTouch, touchEventList: EventTouch[]) {\n        if (this._dispatchImmediately) {\n            const touches = eventTouch.getTouches();\n            const touchesLength = touches.length;\n            for (let i = 0; i < touchesLength; ++i) {\n                eventTouch.touch = touches[i];\n                eventTouch.propagationStopped = eventTouch.propagationImmediateStopped = false;\n                this._emitEvent(eventTouch);\n            }\n        } else {\n            touchEventList.push(eventTouch);\n        }\n    }\n\n    private _frameDispatchEvents () {\n        const eventMouseList = this._eventMouseList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventMouseList.length; i < length; ++i) {\n            const eventMouse = eventMouseList[i];\n            this._emitEvent(eventMouse);\n        }\n\n        const eventTouchList = this._eventTouchList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventTouchList.length; i < length; ++i) {\n            const eventTouch = eventTouchList[i];\n            const touches = eventTouch.getTouches();\n            const touchesLength = touches.length;\n            for (let j = 0; j < touchesLength; ++j) {\n                eventTouch.touch = touches[j];\n                eventTouch.propagationStopped = eventTouch.propagationImmediateStopped = false;\n                this._emitEvent(eventTouch);\n            }\n        }\n\n        const eventKeyboardList = this._eventKeyboardList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventKeyboardList.length; i < length; ++i) {\n            const eventKeyboard = eventKeyboardList[i];\n            this._emitEvent(eventKeyboard);\n        }\n\n        const eventAccelerationList = this._eventAccelerationList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventAccelerationList.length; i < length; ++i) {\n            const eventAcceleration = eventAccelerationList[i];\n            this._emitEvent(eventAcceleration);\n        }\n\n        const eventGamepadList = this._eventGamepadList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventGamepadList.length; i < length; ++i) {\n            const eventGamepad = eventGamepadList[i];\n            this._emitEvent(eventGamepad);\n        }\n\n        const eventHandleList = this._eventHandleList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventHandleList.length; i < length; ++i) {\n            const eventHandle = eventHandleList[i];\n            this._emitEvent(eventHandle);\n        }\n\n        const eventHMDList = this._eventHMDList;\n        // TODO: culling event queue\n        for (let i = 0, length = eventHMDList.length; i < length; ++i) {\n            const eventHMD = eventHMDList[i];\n            this._emitEvent(eventHMD);\n        }\n\n        this._clearEvents();\n    }\n}\n\n/**\n * @en\n * The singleton of the Input class, this singleton manages all events of input. include: touch, mouse, accelerometer, gamepad, handle, hmd and keyboard.\n *\n * @zh\n * 输入类单例，该单例管理所有的输入事件，包括：触摸、鼠标、加速计、游戏手柄、6DOF手柄、头戴显示器 和 键盘。\n *\n * @example\n * ```\n * input.on(Input.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n * input.off(Input.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n * ```\n */\nexport const input = new Input();\n","import { HandleCallback } from 'pal/input';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\nimport { EventTarget } from '../../../cocos/core/event';\nimport { InputSourceButton, InputSourceStick, InputSourcePosition, InputSourceOrientation } from '../input-source';\nimport { Vec3, Quat } from '../../../cocos/core/math';\n\nexport class HandleInputDevice {\n    public get buttonNorth () { return this._buttonNorth; }\n    public get buttonEast () { return this._buttonEast; }\n    public get buttonWest () { return this._buttonWest; }\n    public get buttonSouth () { return this._buttonSouth; }\n    public get buttonTriggerLeft () { return this._buttonTriggerLeft; }\n    public get buttonTriggerRight () { return this._buttonTriggerRight; }\n    public get triggerLeft () { return this._triggerLeft; }\n    public get triggerRight () { return this._triggerRight; }\n    public get gripLeft () { return this._gripLeft; }\n    public get gripRight () { return this._gripRight; }\n    public get leftStick () { return this._leftStick; }\n    public get rightStick () { return this._rightStick; }\n    public get buttonLeftStick () { return this._buttonLeftStick; }\n    public get buttonRightStick () { return this._buttonRightStick; }\n    public get handLeftPosition () { return this._handLeftPosition; }\n    public get handLeftOrientation () { return this._handLeftOrientation; }\n    public get handRightPosition () { return this._handRightPosition; }\n    public get handRightOrientation () { return this._handRightOrientation; }\n    public get aimLeftPosition () { return this._aimLeftPosition; }\n    public get aimLeftOrientation () { return this._aimLeftOrientation; }\n    public get aimRightPosition () { return this._aimRightPosition; }\n    public get aimRightOrientation () { return this._aimRightOrientation; }\n\n    private _eventTarget: EventTarget = new EventTarget();\n\n    private _buttonNorth!: InputSourceButton;\n    private _buttonEast!: InputSourceButton;\n    private _buttonWest!: InputSourceButton;\n    private _buttonSouth!: InputSourceButton;\n    private _buttonTriggerLeft!: InputSourceButton;\n    private _buttonTriggerRight!: InputSourceButton;\n    private _triggerLeft!: InputSourceButton;\n    private _triggerRight!: InputSourceButton;\n    private _gripLeft!: InputSourceButton;\n    private _gripRight!: InputSourceButton;\n    private _leftStick!: InputSourceStick;\n    private _rightStick!: InputSourceStick;\n    private _buttonLeftStick!: InputSourceButton;\n    private _buttonRightStick!: InputSourceButton;\n    private _handLeftPosition!: InputSourcePosition;\n    private _handLeftOrientation!: InputSourceOrientation;\n    private _handRightPosition!: InputSourcePosition;\n    private _handRightOrientation!: InputSourceOrientation;\n    private _aimLeftPosition!: InputSourcePosition;\n    private _aimLeftOrientation!: InputSourceOrientation;\n    private _aimRightPosition!: InputSourcePosition;\n    private _aimRightOrientation!: InputSourceOrientation;\n\n    constructor () {\n        this._initInputSource();\n    }\n\n    /**\n     * @engineInternal\n     */\n    public _on (eventType: InputEventType, callback: HandleCallback, target?: any) {\n        this._eventTarget.on(eventType, callback, target);\n    }\n\n    private _initInputSource () {\n        this._buttonNorth = new InputSourceButton();\n        this._buttonNorth.getValue = () => 0;\n        this._buttonEast = new InputSourceButton();\n        this._buttonEast.getValue = () => 0;\n        this._buttonWest = new InputSourceButton();\n        this._buttonWest.getValue = () => 0;\n        this._buttonSouth = new InputSourceButton();\n        this._buttonSouth.getValue = () => 0;\n\n        this._buttonTriggerLeft = new InputSourceButton();\n        this._buttonTriggerLeft.getValue = () => 0;\n        this._buttonTriggerRight = new InputSourceButton();\n        this._buttonTriggerRight.getValue = () => 0;\n        this._triggerLeft = new InputSourceButton();\n        this._triggerLeft.getValue = () => 0;\n        this._triggerRight = new InputSourceButton();\n        this._triggerRight.getValue = () => 0;\n        this._gripLeft = new InputSourceButton();\n        this._gripLeft.getValue = () => 0;\n        this._gripRight = new InputSourceButton();\n        this._gripRight.getValue = () => 0;\n\n        this._buttonLeftStick = new InputSourceButton();\n        this._buttonLeftStick.getValue = () => 0;\n        const leftStickUp = new InputSourceButton();\n        leftStickUp.getValue = () => 0;\n        const leftStickDown = new InputSourceButton();\n        leftStickDown.getValue = () => 0;\n        const leftStickLeft = new InputSourceButton();\n        leftStickLeft.getValue = () => 0;\n        const leftStickRight = new InputSourceButton();\n        leftStickRight.getValue = () => 0;\n        this._leftStick = new InputSourceStick({ up: leftStickUp, down: leftStickDown, left: leftStickLeft, right: leftStickRight });\n\n        this._buttonRightStick = new InputSourceButton();\n        this._buttonRightStick.getValue = () => 0;\n        const rightStickUp = new InputSourceButton();\n        rightStickUp.getValue = () => 0;\n        const rightStickDown = new InputSourceButton();\n        rightStickDown.getValue = () => 0;\n        const rightStickLeft = new InputSourceButton();\n        rightStickLeft.getValue = () => 0;\n        const rightStickRight = new InputSourceButton();\n        rightStickRight.getValue = () => 0;\n        this._rightStick = new InputSourceStick({ up: rightStickUp, down: rightStickDown, left: rightStickLeft, right: rightStickRight });\n\n        this._handLeftPosition = new InputSourcePosition();\n        this._handLeftPosition.getValue = () => Vec3.ZERO;\n        this._handLeftOrientation = new InputSourceOrientation();\n        this._handLeftOrientation.getValue = () => Quat.IDENTITY;\n\n        this._handRightPosition = new InputSourcePosition();\n        this._handRightPosition.getValue = () => Vec3.ZERO;\n        this._handRightOrientation = new InputSourceOrientation();\n        this._handRightOrientation.getValue = () => Quat.IDENTITY;\n\n        this._aimLeftPosition = new InputSourcePosition();\n        this._aimLeftPosition.getValue = () => Vec3.ZERO;\n        this._aimLeftOrientation = new InputSourceOrientation();\n        this._aimLeftOrientation.getValue = () => Quat.IDENTITY;\n\n        this._aimRightPosition = new InputSourcePosition();\n        this._aimRightPosition.getValue = () => Vec3.ZERO;\n        this._aimRightOrientation = new InputSourceOrientation();\n        this._aimRightOrientation.getValue = () => Quat.IDENTITY;\n    }\n}\n","import { HMDCallback } from 'pal/input';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\nimport { EventTarget } from '../../../cocos/core/event/event-target';\nimport { InputSourcePosition, InputSourceOrientation } from '../input-source';\nimport { Vec3, Quat } from '../../../cocos/core/math';\n\nexport class HMDInputDevice {\n    public get viewLeftPosition () { return this._viewLeftPosition; }\n    public get viewLeftOrientation () { return this._viewLeftOrientation; }\n    public get viewRightPosition () { return this._viewRightPosition; }\n    public get viewRightOrientation () { return this._viewRightOrientation; }\n    public get headMiddlePosition () { return this._headMiddlePosition; }\n    public get headMiddleOrientation () { return this._headMiddleOrientation; }\n\n    private _eventTarget: EventTarget = new EventTarget();\n\n    private _viewLeftPosition!: InputSourcePosition;\n    private _viewLeftOrientation!: InputSourceOrientation;\n    private _viewRightPosition!: InputSourcePosition;\n    private _viewRightOrientation!: InputSourceOrientation;\n    private _headMiddlePosition!: InputSourcePosition;\n    private _headMiddleOrientation!: InputSourceOrientation;\n\n    constructor () {\n        this._initInputSource();\n    }\n\n    /**\n     * @engineInternal\n     */\n    public _on (eventType: InputEventType, callback: HMDCallback, target?: any) {\n        this._eventTarget.on(eventType, callback, target);\n    }\n\n    private _initInputSource () {\n        this._viewLeftPosition = new InputSourcePosition();\n        this._viewLeftPosition.getValue = () => Vec3.ZERO;\n        this._viewLeftOrientation = new InputSourceOrientation();\n        this._viewLeftOrientation.getValue = () =>  Quat.IDENTITY;\n\n        this._viewRightPosition = new InputSourcePosition();\n        this._viewRightPosition.getValue = () => Vec3.ZERO;\n        this._viewRightOrientation = new InputSourceOrientation();\n        this._viewRightOrientation.getValue = () =>  Quat.IDENTITY;\n\n        this._headMiddlePosition = new InputSourcePosition();\n        this._headMiddlePosition.getValue = () => Vec3.ZERO;\n        this._headMiddleOrientation = new InputSourceOrientation();\n        this._headMiddleOrientation.getValue = () =>  Quat.IDENTITY;\n    }\n}\n","import { KeyboardCallback } from 'pal/input';\nimport { KeyCode, EventKeyboard } from '../../../cocos/input/types';\nimport { EventTarget } from '../../../cocos/core/event';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\n\nconst code2KeyCode: Record<string, KeyCode> = {\n    Backspace: KeyCode.BACKSPACE,\n    Tab: KeyCode.TAB,\n    Enter: KeyCode.ENTER,\n    ShiftLeft: KeyCode.SHIFT_LEFT,\n    ControlLeft: KeyCode.CTRL_LEFT,\n    AltLeft: KeyCode.ALT_LEFT,\n    ShiftRight: KeyCode.SHIFT_RIGHT,\n    ControlRight: KeyCode.CTRL_RIGHT,\n    AltRight: KeyCode.ALT_RIGHT,\n    Pause: KeyCode.PAUSE,\n    CapsLock: KeyCode.CAPS_LOCK,\n    Escape: KeyCode.ESCAPE,\n    Space: KeyCode.SPACE,\n    PageUp: KeyCode.PAGE_UP,\n    PageDown: KeyCode.PAGE_DOWN,\n    End: KeyCode.END,\n    Home: KeyCode.HOME,\n    ArrowLeft: KeyCode.ARROW_LEFT,\n    ArrowUp: KeyCode.ARROW_UP,\n    ArrowRight: KeyCode.ARROW_RIGHT,\n    ArrowDown: KeyCode.ARROW_DOWN,\n    Insert: KeyCode.INSERT,\n    Delete: KeyCode.DELETE,\n    Digit0: KeyCode.DIGIT_0,\n    Digit1: KeyCode.DIGIT_1,\n    Digit2: KeyCode.DIGIT_2,\n    Digit3: KeyCode.DIGIT_3,\n    Digit4: KeyCode.DIGIT_4,\n    Digit5: KeyCode.DIGIT_5,\n    Digit6: KeyCode.DIGIT_6,\n    Digit7: KeyCode.DIGIT_7,\n    Digit8: KeyCode.DIGIT_8,\n    Digit9: KeyCode.DIGIT_9,\n    KeyA: KeyCode.KEY_A,\n    KeyB: KeyCode.KEY_B,\n    KeyC: KeyCode.KEY_C,\n    KeyD: KeyCode.KEY_D,\n    KeyE: KeyCode.KEY_E,\n    KeyF: KeyCode.KEY_F,\n    KeyG: KeyCode.KEY_G,\n    KeyH: KeyCode.KEY_H,\n    KeyI: KeyCode.KEY_I,\n    KeyJ: KeyCode.KEY_J,\n    KeyK: KeyCode.KEY_K,\n    KeyL: KeyCode.KEY_L,\n    KeyM: KeyCode.KEY_M,\n    KeyN: KeyCode.KEY_N,\n    KeyO: KeyCode.KEY_O,\n    KeyP: KeyCode.KEY_P,\n    KeyQ: KeyCode.KEY_Q,\n    KeyR: KeyCode.KEY_R,\n    KeyS: KeyCode.KEY_S,\n    KeyT: KeyCode.KEY_T,\n    KeyU: KeyCode.KEY_U,\n    KeyV: KeyCode.KEY_V,\n    KeyW: KeyCode.KEY_W,\n    KeyX: KeyCode.KEY_X,\n    KeyY: KeyCode.KEY_Y,\n    KeyZ: KeyCode.KEY_Z,\n    Numpad0: KeyCode.NUM_0,\n    Numpad1: KeyCode.NUM_1,\n    Numpad2: KeyCode.NUM_2,\n    Numpad3: KeyCode.NUM_3,\n    Numpad4: KeyCode.NUM_4,\n    Numpad5: KeyCode.NUM_5,\n    Numpad6: KeyCode.NUM_6,\n    Numpad7: KeyCode.NUM_7,\n    Numpad8: KeyCode.NUM_8,\n    Numpad9: KeyCode.NUM_9,\n    NumpadMultiply: KeyCode.NUM_MULTIPLY,\n    NumpadAdd: KeyCode.NUM_PLUS,\n    NumpadSubtract: KeyCode.NUM_SUBTRACT,\n    NumpadDecimal: KeyCode.NUM_DECIMAL,\n    NumpadDivide: KeyCode.NUM_DIVIDE,\n    NumpadEnter: KeyCode.NUM_ENTER,\n    F1: KeyCode.F1,\n    F2: KeyCode.F2,\n    F3: KeyCode.F3,\n    F4: KeyCode.F4,\n    F5: KeyCode.F5,\n    F6: KeyCode.F6,\n    F7: KeyCode.F7,\n    F8: KeyCode.F8,\n    F9: KeyCode.F9,\n    F10: KeyCode.F10,\n    F11: KeyCode.F11,\n    F12: KeyCode.F12,\n    NumLock: KeyCode.NUM_LOCK,\n    ScrollLock: KeyCode.SCROLL_LOCK,\n    Semicolon: KeyCode.SEMICOLON,\n    Equal: KeyCode.EQUAL,\n    Comma: KeyCode.COMMA,\n    Minus: KeyCode.DASH,\n    Period: KeyCode.PERIOD,\n    Slash: KeyCode.SLASH,\n    Backquote: KeyCode.BACK_QUOTE,\n    BracketLeft: KeyCode.BRACKET_LEFT,\n    Backslash: KeyCode.BACKSLASH,\n    BracketRight: KeyCode.BRACKET_RIGHT,\n    Quote: KeyCode.QUOTE,\n};\n\nfunction getKeyCode (code: string): KeyCode {\n    return code2KeyCode[code] || KeyCode.NONE;\n}\n\nexport class KeyboardInputSource {\n    private _eventTarget: EventTarget = new EventTarget();\n\n    constructor () {\n        this._registerEvent();\n    }\n\n    public dispatchKeyboardDownEvent (nativeKeyboardEvent: KeyboardEvent) { this._handleKeyboardDown(nativeKeyboardEvent); }\n    public dispatchKeyboardUpEvent (nativeKeyboardEvent: KeyboardEvent) { this._handleKeyboardUp(nativeKeyboardEvent); }\n\n    public on (eventType: InputEventType, callback: KeyboardCallback, target?: any) {\n        this._eventTarget.on(eventType, callback,  target);\n    }\n\n    private _registerEvent () {\n        const canvas = document.getElementById('GameCanvas') as HTMLCanvasElement;\n        canvas?.addEventListener('keydown', this._handleKeyboardDown.bind(this));\n        canvas?.addEventListener('keyup', this._handleKeyboardUp.bind(this));\n    }\n\n    private _getInputEvent (event: any, eventType: InputEventType) {\n        const keyCode = getKeyCode(event.code);\n        const eventKeyboard = new EventKeyboard(keyCode, eventType);\n        return eventKeyboard;\n    }\n\n    private _handleKeyboardDown (event: KeyboardEvent) {\n        event.stopPropagation();\n        event.preventDefault();\n        if (!event.repeat) {\n            const keyDownInputEvent = this._getInputEvent(event, InputEventType.KEY_DOWN);\n            this._eventTarget.emit(InputEventType.KEY_DOWN, keyDownInputEvent);\n        } else {\n            const keyPressingInputEvent = this._getInputEvent(event, InputEventType.KEY_PRESSING);\n            this._eventTarget.emit(InputEventType.KEY_PRESSING, keyPressingInputEvent);\n        }\n    }\n\n    private _handleKeyboardUp (event: KeyboardEvent) {\n        const inputEvent = this._getInputEvent(event, InputEventType.KEY_UP);\n        event.stopPropagation();\n        event.preventDefault();\n        this._eventTarget.emit(InputEventType.KEY_UP, inputEvent);\n    }\n}\n","import { EDITOR, TEST } from 'internal:constants';\nimport { MouseCallback } from 'pal/input';\nimport { systemInfo } from 'pal/system-info';\nimport { screenAdapter } from 'pal/screen-adapter';\nimport { EventMouse } from '../../../cocos/input/types';\nimport { EventTarget } from '../../../cocos/core/event';\nimport { Rect, Vec2 } from '../../../cocos/core/math';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\nimport { Feature } from '../../system-info/enum-type';\n\nexport class MouseInputSource {\n    private _canvas?: HTMLCanvasElement;\n    private _eventTarget: EventTarget = new EventTarget();\n    private _pointLocked = false;\n    private _isPressed = false;\n    private _preMousePos: Vec2 = new Vec2();\n\n    // @ts-expect-error maybe not initialized\n    private _handleMouseDown: (event: MouseEvent) => void;\n    // @ts-expect-error maybe not initialized\n    private _handleMouseMove: (event: MouseEvent) => void;\n    // @ts-expect-error maybe not initialized\n    private _handleMouseUp: (event: MouseEvent) => void;\n\n    constructor () {\n        if (systemInfo.hasFeature(Feature.EVENT_MOUSE)) {\n            this._canvas = document.getElementById('GameCanvas') as HTMLCanvasElement;\n            if (!this._canvas && !TEST && !EDITOR) {\n                console.warn('failed to access canvas');\n            }\n\n            this._handleMouseDown = this._createCallback(InputEventType.MOUSE_DOWN);\n            this._handleMouseMove = this._createCallback(InputEventType.MOUSE_MOVE);\n            this._handleMouseUp = this._createCallback(InputEventType.MOUSE_UP);\n            // In Editor, we receive mouse event from manually event dispatching.\n            if (!EDITOR) {\n                this._registerEvent();\n            }\n        }\n    }\n\n    public dispatchMouseDownEvent (nativeMouseEvent: any) { this._handleMouseDown(nativeMouseEvent); }\n    public dispatchMouseMoveEvent (nativeMouseEvent: any) { this._handleMouseMove(nativeMouseEvent); }\n    public dispatchMouseUpEvent (nativeMouseEvent: any) { this._handleMouseUp(nativeMouseEvent); }\n    public dispatchScrollEvent (nativeMouseEvent: WheelEvent) { this._handleMouseWheel(nativeMouseEvent); }\n\n    public on (eventType: InputEventType, callback: MouseCallback, target?: any) {\n        this._eventTarget.on(eventType, callback, target);\n    }\n\n    private _getCanvasRect (): Rect {\n        const canvas = this._canvas;\n        const box = canvas?.getBoundingClientRect();\n        if (box) {\n            return new Rect(box.x, box.y, box.width, box.height);\n        }\n        return new Rect(0, 0, 0, 0);\n    }\n\n    private _getLocation (mouseEvent: MouseEvent): Vec2 {\n        const canvasRect = this._getCanvasRect();\n        const dpr = screenAdapter.devicePixelRatio;\n        let x = this._pointLocked ? (this._preMousePos.x / dpr + mouseEvent.movementX) : (mouseEvent.clientX - canvasRect.x);\n        let y = this._pointLocked ? (this._preMousePos.y / dpr - mouseEvent.movementY) : (canvasRect.y + canvasRect.height - mouseEvent.clientY);\n        x *= dpr;\n        y *= dpr;\n        return new Vec2(x, y);\n    }\n\n    private _registerEvent () {\n        // register mouse down event\n        window.addEventListener('mousedown', () => {\n            this._isPressed = true;\n        });\n        this._canvas?.addEventListener('mousedown', this._handleMouseDown);\n\n        // register mouse move event\n        this._canvas?.addEventListener('mousemove', this._handleMouseMove);\n\n        // register mouse up event\n        window.addEventListener('mouseup', this._handleMouseUp);\n        this._canvas?.addEventListener('mouseup', this._handleMouseUp);\n\n        // register wheel event\n        this._canvas?.addEventListener('wheel', this._handleMouseWheel.bind(this));\n        this._registerPointerLockEvent();\n    }\n\n    // To be removed in the future.\n    private _registerPointerLockEvent () {\n        const lockChangeAlert = () => {\n            const canvas = this._canvas;\n            // @ts-expect-error undefined mozPointerLockElement\n            if (document.pointerLockElement === canvas || document.mozPointerLockElement === canvas) {\n                this._pointLocked = true;\n            } else {\n                this._pointLocked = false;\n            }\n        };\n        if ('onpointerlockchange' in document) {\n            document.addEventListener('pointerlockchange', lockChangeAlert, false);\n        } else if ('onmozpointerlockchange' in document) {\n            document.addEventListener('mozpointerlockchange', lockChangeAlert, false);\n        }\n    }\n\n    private _createCallback (eventType: InputEventType) {\n        return (mouseEvent: MouseEvent) => {\n            const location = this._getLocation(mouseEvent);\n            const { button, buttons } = mouseEvent;\n            let targetButton = button;\n            switch (eventType) {\n            case InputEventType.MOUSE_DOWN:\n                this._canvas?.focus();\n                this._isPressed = true;\n                break;\n            case InputEventType.MOUSE_UP:\n                this._isPressed = false;\n                break;\n            case InputEventType.MOUSE_MOVE:\n                // mouseEvent.button doesn't work well in mouse move event\n                // now we don't support multiple buttons in one mouse event\n                if (1 & buttons) {\n                    targetButton = EventMouse.BUTTON_LEFT;\n                } else if (2 & buttons) {\n                    targetButton = EventMouse.BUTTON_RIGHT;\n                } else if (4 & buttons) {\n                    targetButton = EventMouse.BUTTON_MIDDLE;\n                } else {\n                    targetButton = EventMouse.BUTTON_MISSING;\n                }\n                break;\n            default:\n                break;\n            }\n\n            const eventMouse = new EventMouse(eventType, false, this._preMousePos);\n            eventMouse.setLocation(location.x, location.y);\n            eventMouse.setButton(targetButton);\n            eventMouse.movementX = mouseEvent.movementX;\n            eventMouse.movementY = mouseEvent.movementY;\n\n            // update previous mouse position.\n            this._preMousePos.set(location.x, location.y);\n            mouseEvent.stopPropagation();\n            if (mouseEvent.target === this._canvas) {\n                mouseEvent.preventDefault();\n            }\n            this._eventTarget.emit(eventType, eventMouse);\n        };\n    }\n\n    private _handleMouseWheel (mouseEvent: WheelEvent) {\n        const eventType = InputEventType.MOUSE_WHEEL;\n        const location = this._getLocation(mouseEvent);\n        const button = mouseEvent.button;\n\n        const eventMouse = new EventMouse(eventType, false, this._preMousePos);\n        eventMouse.setLocation(location.x, location.y);\n        eventMouse.setButton(button);\n        eventMouse.movementX = mouseEvent.movementX;\n        eventMouse.movementY = mouseEvent.movementY;\n\n        const wheelSensitivityFactor = 5;\n        eventMouse.setScrollData(mouseEvent.deltaX * wheelSensitivityFactor, -mouseEvent.deltaY * wheelSensitivityFactor);\n        // update previous mouse position.\n        this._preMousePos.set(location.x, location.y);\n        mouseEvent.stopPropagation();\n        if (mouseEvent.target === this._canvas) {\n            mouseEvent.preventDefault();\n        }\n        this._eventTarget.emit(eventType, eventMouse);\n    }\n}\n","import { macro } from '../../cocos/core/platform/macro';\nimport { Touch } from '../../cocos/input/types';\nimport { Vec2 } from '../../cocos/core/math/vec2';\n\nconst tempVec2 = new Vec2();\n\nclass TouchManager {\n    /**\n     * A map from touch ID to touch object.\n     */\n    private _touchMap: Map<number, Touch>;\n    private readonly _maxTouches = 8;\n\n    constructor () {\n        this._touchMap = new Map();\n    }\n\n    /**\n     * The original touch object can't be modified, so we need to return the cloned touch object.\n     * @param touch\n     * @returns\n     */\n    private _cloneTouch (touch: Touch): Touch {\n        const touchID = touch.getID();\n        touch.getStartLocation(tempVec2);\n        const clonedTouch = new Touch(tempVec2.x, tempVec2.y, touchID);\n        touch.getLocation(tempVec2);\n        clonedTouch.setPoint(tempVec2.x, tempVec2.y);\n        touch.getPreviousLocation(tempVec2);\n        clonedTouch.setPrevPoint(tempVec2);\n        return clonedTouch;\n    }\n\n    /**\n     * Create the touch object at the touch start event callback.\n     * we have some policy to create the touch object:\n     * - If the number of touches doesn't exceed the max count, we create a touch object.\n     * - If the number of touches exceeds the max count, we discard the timeout touch to create a new one.\n     * - If the number of touches exceeds the max count and there is no timeout touch, we can't create any touch object.\n     * @param touchID\n     * @param x\n     * @param y\n     * @returns\n     */\n    private _createTouch (touchID: number, x: number, y: number): Touch | undefined {\n        if (this._touchMap.has(touchID)) {\n            console.log('Cannot create the same touch object.');\n            return undefined;\n        }\n        const checkResult = this._checkTouchMapSizeMoreThanMax(touchID);\n        if (checkResult) {\n            console.log('The touches is more than MAX_TOUCHES.');  // TODO: logID 2300\n            return undefined;\n        }\n        const touch = new Touch(x, y, touchID);\n        this._touchMap.set(touchID, touch);\n        this._updateTouch(touch, x, y);\n        return this._cloneTouch(touch);\n    }\n\n    /**\n     * Release the touch object at the touch end or touch cancel event callback.\n     * @param touchID\n     * @returns\n     */\n    public releaseTouch (touchID: number) {\n        if (!this._touchMap.has(touchID)) {\n            return;\n        }\n        this._touchMap.delete(touchID);\n    }\n\n    /**\n     * Get touch object by touch ID.\n     * @param touchID\n     * @returns\n     */\n    public getTouch (touchID: number, x: number, y: number): Touch | undefined {\n        let touch = this._touchMap.get(touchID);\n        if (!touch) {\n            touch = this._createTouch(touchID, x, y);\n        } else {\n            this._updateTouch(touch, x, y);\n        }\n        return touch ? this._cloneTouch(touch) : undefined;\n    }\n\n    /**\n     * Get all the current touches objects.\n     * @returns\n     */\n    public getAllTouches (): Touch[] {\n        const touches: Touch[] = [];\n        this._touchMap.forEach((touch) => {\n            if (touch) {\n                const clonedTouch = this._cloneTouch(touch);\n                touches.push(clonedTouch);\n            }\n        });\n        return touches;\n    }\n\n    /**\n     * Update the location and previous location of current touch ID.\n     * @param touchID\n     * @param x The current location X\n     * @param y The current location Y\n     */\n    private _updateTouch (touch: Touch, x: number, y: number) {\n        touch.getLocation(tempVec2);\n        touch.setPrevPoint(tempVec2);\n        touch.setPoint(x, y);\n    }\n\n    private _checkTouchMapSizeMoreThanMax (touchID: number) {\n        if (this._touchMap.has(touchID)) {\n            return false;\n        }\n        const maxSize = macro.ENABLE_MULTI_TOUCH ? this._maxTouches : 1;\n        if (this._touchMap.size < maxSize) {\n            return false;\n        }\n        // Handle when exceed the max number of touches\n        const now = performance.now();\n        this._touchMap.forEach((touch) => {\n            if (now - touch.lastModified > macro.TOUCH_TIMEOUT) {\n                console.log(`The touches is more than MAX_TOUCHES, release touch id ${touch.getID()}.`);\n                // TODO: need to handle touch cancel event when exceed the max number of touches ?\n                this.releaseTouch(touch.getID());\n            }\n        });\n        return maxSize >= this._touchMap.size;\n    }\n}\n\nexport const touchManager = new TouchManager();\n","import { TouchCallback } from 'pal/input';\nimport { EDITOR, TEST } from 'internal:constants';\nimport { systemInfo } from 'pal/system-info';\nimport { screenAdapter } from 'pal/screen-adapter';\nimport { Rect, Vec2 } from '../../../cocos/core/math';\nimport { EventTarget } from '../../../cocos/core/event';\nimport { Touch, EventTouch } from '../../../cocos/input/types';\nimport { touchManager } from '../touch-manager';\nimport { macro } from '../../../cocos/core/platform/macro';\nimport { InputEventType } from '../../../cocos/input/types/event-enum';\nimport { Feature } from '../../system-info/enum-type';\n\nexport class TouchInputSource {\n    private _canvas?: HTMLCanvasElement;\n    private _eventTarget: EventTarget = new EventTarget();\n\n    constructor () {\n        if (systemInfo.hasFeature(Feature.INPUT_TOUCH)) {\n            this._canvas = document.getElementById('GameCanvas') as HTMLCanvasElement;\n            if (!this._canvas && !TEST && !EDITOR) {\n                console.warn('failed to access canvas');\n            }\n            // In Editor, we don't receive touch event but maybe receive simulated touch event.\n            if (!EDITOR) {\n                this._registerEvent();\n            }\n        }\n    }\n\n    private _registerEvent () {\n        // IDEA: need to register on window ?\n        this._canvas?.addEventListener('touchstart', this._createCallback(InputEventType.TOUCH_START));\n        this._canvas?.addEventListener('touchmove', this._createCallback(InputEventType.TOUCH_MOVE));\n        this._canvas?.addEventListener('touchend', this._createCallback(InputEventType.TOUCH_END));\n        this._canvas?.addEventListener('touchcancel', this._createCallback(InputEventType.TOUCH_CANCEL));\n    }\n\n    private _createCallback (eventType: InputEventType) {\n        return (event: TouchEvent) => {\n            const canvasRect = this._getCanvasRect();\n            const handleTouches: Touch[] = [];\n            const length = event.changedTouches.length;\n            for (let i = 0; i < length; ++i) {\n                const changedTouch = event.changedTouches[i];\n                const touchID = changedTouch.identifier;\n                if (touchID === null) {\n                    continue;\n                }\n                const location = this._getLocation(changedTouch, canvasRect);\n                const touch = touchManager.getTouch(touchID, location.x, location.y);\n                if (!touch) {\n                    continue;\n                }\n                if (eventType === InputEventType.TOUCH_END || eventType === InputEventType.TOUCH_CANCEL) {\n                    touchManager.releaseTouch(touchID);\n                }\n                handleTouches.push(touch);\n            }\n            event.stopPropagation();\n            if (event.target === this._canvas) {\n                event.preventDefault();\n            }\n            if (eventType === InputEventType.TOUCH_START) {\n                this._canvas?.focus();\n            }\n            if (handleTouches.length > 0) {\n                const eventTouch = new EventTouch(handleTouches, false, eventType,\n                    macro.ENABLE_MULTI_TOUCH ? touchManager.getAllTouches() : handleTouches);\n                this._eventTarget.emit(eventType, eventTouch);\n            }\n        };\n    }\n\n    private _getCanvasRect (): Rect {\n        const canvas = this._canvas;\n        const box = canvas?.getBoundingClientRect();\n        if (box) {\n            return new Rect(box.x, box.y, box.width, box.height);\n        }\n        return new Rect(0, 0, 0, 0);\n    }\n\n    private _getLocation (touch: globalThis.Touch, canvasRect: Rect): Vec2 {\n        let x = touch.clientX - canvasRect.x;\n        let y = canvasRect.y + canvasRect.height - touch.clientY;\n        if (screenAdapter.isFrameRotated) {\n            const tmp = x;\n            x = canvasRect.height - y;\n            y = tmp;\n        }\n        const dpr = screenAdapter.devicePixelRatio;\n        x *= dpr;\n        y *= dpr;\n        return new Vec2(x, y);\n    }\n\n    public on (eventType: InputEventType, callback: TouchCallback, target?: any) {\n        this._eventTarget.on(eventType, callback, target);\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EventTarget } from '../core/event';\nimport { EventAcceleration, EventKeyboard, EventMouse, EventTouch, SystemEventType, Touch } from './types';\nimport { input, Input } from './input';\nimport { legacyCC } from '../core/global-exports';\nimport { InputEventType } from './types/event-enum';\n\nexport declare namespace SystemEvent {\n    /**\n     * @en The event type supported by SystemEvent and Node events\n     * @zh SystemEvent 支持的事件类型以及节点事件类型\n     */\n    export type EventType = EnumAlias<typeof SystemEventType>;\n}\n\ninterface SystemEventMap {\n    [SystemEvent.EventType.MOUSE_DOWN]: (event: EventMouse) => void,\n    [SystemEvent.EventType.MOUSE_MOVE]: (event: EventMouse) => void,\n    [SystemEvent.EventType.MOUSE_UP]: (event: EventMouse) => void,\n    [SystemEvent.EventType.MOUSE_WHEEL]: (event: EventMouse) => void,\n    [SystemEvent.EventType.TOUCH_START]: (touch: Touch, event: EventTouch) => void,\n    [SystemEvent.EventType.TOUCH_MOVE]: (touch: Touch, event: EventTouch) => void,\n    [SystemEvent.EventType.TOUCH_END]: (touch: Touch, event: EventTouch) => void,\n    [SystemEvent.EventType.TOUCH_CANCEL]: (touch: Touch, event: EventTouch) => void,\n    [SystemEvent.EventType.KEY_DOWN]: (event: EventKeyboard) => void,\n    [SystemEvent.EventType.KEY_UP]: (event: EventKeyboard) => void,\n    [SystemEvent.EventType.DEVICEMOTION]: (event: EventAcceleration) => void,\n}\n\n/**\n * @en\n * The System event, it currently supports keyboard events and accelerometer events.<br/>\n * You can get the `SystemEvent` instance with `systemEvent`.<br/>\n * @zh\n * 系统事件，它目前支持按键事件和重力感应事件。<br/>\n * 你可以通过 `systemEvent` 获取到 `SystemEvent` 的实例。<br/>\n *\n * @deprecated since v3.4.0, please use Input class instead.\n *\n * @example\n * ```\n * import { systemEvent, SystemEvent } from 'cc';\n * systemEvent.on(SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n * systemEvent.off(SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\n * ```\n */\n\nexport class SystemEvent extends EventTarget {\n    public static EventType = SystemEventType;\n\n    constructor () {\n        super();\n\n        input.on(InputEventType.MOUSE_DOWN, (e) => { this.emit(SystemEventType.MOUSE_DOWN, e);  });\n        input.on(InputEventType.MOUSE_MOVE, (e) => { this.emit(SystemEventType.MOUSE_MOVE, e);  });\n        input.on(InputEventType.MOUSE_UP, (e) => { this.emit(SystemEventType.MOUSE_UP, e);  });\n        input.on(InputEventType.MOUSE_WHEEL, (e) => { this.emit(SystemEventType.MOUSE_WHEEL, e);  });\n\n        input.on(InputEventType.TOUCH_START, (e) => { this.emit(SystemEventType.TOUCH_START, e.touch, e);  });\n        input.on(InputEventType.TOUCH_MOVE, (e) => { this.emit(SystemEventType.TOUCH_MOVE, e.touch, e);  });\n        input.on(InputEventType.TOUCH_END, (e) => { this.emit(SystemEventType.TOUCH_END, e.touch, e);  });\n        input.on(InputEventType.TOUCH_CANCEL, (e) => { this.emit(SystemEventType.TOUCH_CANCEL, e.touch, e);  });\n\n        input.on(InputEventType.KEY_DOWN, (e) => { this.emit(SystemEventType.KEY_DOWN, e);  });\n        input.on(InputEventType.KEY_PRESSING, (e) => { this.emit(SystemEventType.KEY_DOWN, e);  });\n        input.on(InputEventType.KEY_UP, (e) => { this.emit(SystemEventType.KEY_UP, e);  });\n\n        input.on(InputEventType.DEVICEMOTION, (e) => { this.emit(SystemEventType.DEVICEMOTION, e);  });\n    }\n    /**\n     * @en\n     * Sets whether to enable the accelerometer event listener or not.\n     *\n     * @zh\n     * 是否启用加速度计事件。\n     */\n    public setAccelerometerEnabled (isEnabled: boolean) {\n        input.setAccelerometerEnabled(isEnabled);\n    }\n\n    /**\n     * @en\n     * Sets the accelerometer interval value.\n     *\n     * @zh\n     * 设置加速度计间隔值。\n     */\n    public setAccelerometerInterval (interval: number) {\n        input.setAccelerometerInterval(interval);\n    }\n\n    /**\n     * @en\n     * Register an callback of a specific system event type.\n     * @zh\n     * 注册特定事件类型回调。\n     *\n     * @param type - The event type\n     * @param callback - The event listener's callback\n     * @param target - The event listener's target and callee\n     * @param once - Register the event listener once\n     */\n    // @ts-expect-error Property 'on' in type 'SystemEvent' is not assignable to the same property in base type\n    public on<K extends keyof SystemEventMap> (type: K, callback: SystemEventMap[K], target?: any, once?: boolean) {\n        super.on(type, callback, target, once);\n        return callback;\n    }\n\n    /**\n     * @en\n     * Removes the listeners previously registered with the same type, callback, target and or useCapture,\n     * if only type is passed as parameter, all listeners registered with that type will be removed.\n     * @zh\n     * 删除之前用同类型，回调，目标或 useCapture 注册的事件监听器，如果只传递 type，将会删除 type 类型的所有事件监听器。\n     *\n     * @param type - A string representing the event type being removed.\n     * @param callback - The callback to remove.\n     * @param target - The target (this object) to invoke the callback, if it's not given, only callback without target will be removed\n     */\n    public off<K extends keyof SystemEventMap> (type: K, callback?: SystemEventMap[K], target?: any) {\n        super.off(type, callback, target);\n    }\n}\n\nlegacyCC.SystemEvent = SystemEvent;\n/**\n * @module cc\n */\n\n/**\n * @en The singleton of the SystemEvent, there should only be one instance to be used globally\n * @zh 系统事件单例，方便全局使用。\n *\n * @deprecated since v3.4.0, please use input instead.\n */\nexport const systemEvent = new SystemEvent();\nlegacyCC.systemEvent = systemEvent;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport './deprecated-3.3.0';\nimport './deprecated-3.4.0';\nimport { markAsWarning, replaceProperty } from '../core/utils/x-deprecated';\nimport { Event, EventKeyboard, EventMouse, EventTouch, SystemEventType } from './types';\nimport { SystemEvent } from './system-event';\nimport { macro } from '../core/platform/macro';\n\nreplaceProperty(SystemEventType, 'Node.EventType', [\n    {\n        name: 'POSITION_PART',\n        newName: 'TRANSFORM_CHANGED',\n    },\n    {\n        name: 'ROTATION_PART',\n        newName: 'TRANSFORM_CHANGED',\n    },\n    {\n        name: 'SCALE_PART',\n        newName: 'TRANSFORM_CHANGED',\n    },\n]);\n\n// deprecate Event property\nreplaceProperty(Event, 'Event', [\n    {\n        name: 'ACCELERATION',\n        newName: 'DEVICEMOTION',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\n\nmarkAsWarning(Event, 'Event', [\n    {\n        name: 'TOUCH',\n        suggest: 'please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead',\n    },\n    {\n        name: 'MOUSE',\n        suggest: 'please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead',\n    },\n    {\n        name: 'KEYBOARD',\n        suggest: 'please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead',\n    },\n]);\n\n// depracate EventMouse property\nreplaceProperty(EventMouse, 'EventMouse',\n    ['DOWN', 'UP', 'MOVE'].map((item) => ({\n        name: item,\n        newName: `MOUSE_${item}`,\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    })));\nreplaceProperty(EventMouse, 'EventMouse', [\n    {\n        name: 'SCROLL',\n        newName: 'MOUSE_WHEEL',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\nmarkAsWarning(EventMouse.prototype, 'EventMouse.prototype', [\n    {\n        name: 'eventType',\n        suggest: 'please use EventMouse.prototype.type instead',\n    },\n]);\n\n// depracate EventTouch property\nreplaceProperty(EventTouch, 'EventTouch', [\n    {\n        name: 'BEGAN',\n        newName: 'TOUCH_START',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\nreplaceProperty(EventTouch, 'EventTouch', [\n    {\n        name: 'MOVED',\n        newName: 'TOUCH_MOVE',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\nreplaceProperty(EventTouch, 'EventTouch', [\n    {\n        name: 'ENDED',\n        newName: 'TOUCH_END',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\nreplaceProperty(EventTouch, 'EventTouch', [\n    {\n        name: 'CANCELLED',\n        newName: 'TOUCH_CANCEL',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\nmarkAsWarning(EventTouch.prototype, 'EventTouch.prototype', [\n    {\n        name: 'getEventCode',\n        suggest: 'please use EventTouch.prototype.type instead',\n    },\n]);\nreplaceProperty(EventTouch.prototype, 'EventTouch.prototype', [\n    {\n        name: 'getUILocationInView',\n        newName: 'getLocationInView',\n        target: EventTouch,\n        targetName: 'EventTouch',\n    },\n]);\n\nmarkAsWarning(macro.KEY, 'macro.KEY',\n    [\n        'back',\n        'menu',\n        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0',\n        '*', '+', '-', '/', ';', '=', ',', '.', '[', ']',\n        'dpadLeft', 'dpadRight', 'dpadUp', 'dpadDown', 'dpadCenter',\n    ].map((item) => ({\n        name: item,\n    })));\n\nmarkAsWarning(macro.KEY, 'macro.KEY', [\n    {\n        name: 'shift',\n        suggest: 'please use KeyCode.SHIFT_LEFT instead',\n    },\n]);\n\nmarkAsWarning(macro.KEY, 'macro.KEY', [\n    {\n        name: 'ctrl',\n        suggest: 'please use KeyCode.CTRL_LEFT instead',\n    },\n]);\n\nmarkAsWarning(macro.KEY, 'macro.KEY', [\n    {\n        name: 'alt',\n        suggest: 'please use KeyCode.ALT_LEFT instead',\n    },\n]);\n\nmarkAsWarning(macro, 'macro', [\n    {\n        name: 'KEY',\n        suggest: 'please use KeyCode instead',\n    },\n]);\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, JSB } from 'internal:constants';\nimport { ccclass } from 'cc.decorator';\nimport { BaseNode } from './base-node';\nimport { replaceProperty, removeProperty } from '../utils/x-deprecated';\nimport { Layers } from './layers';\nimport { Node } from './node';\nimport { Vec2 } from '../math/vec2';\nimport { Size } from '../math/size';\nimport { legacyCC } from '../global-exports';\nimport { CCObject } from '../data/object';\nimport { warnID } from '../platform/debug';\nimport { SceneGlobals } from './scene-globals';\nimport { SystemEventType } from '../../input/types';\nimport { SystemEvent } from '../../input';\nimport { NodeUIProperties } from './node-ui-properties';\n\nif (JSB) {\n    replaceProperty(Node.prototype, 'Node', [\n        {\n            name: 'childrenCount',\n            newName: 'children.length',\n            customGetter (this: Node) {\n                return this.children.length;\n            },\n        },\n    ]);\n} else {\n    replaceProperty(BaseNode.prototype, 'BaseNode', [\n        {\n            name: 'childrenCount',\n            newName: 'children.length',\n            customGetter (this: BaseNode) {\n                return this.children.length;\n            },\n        },\n    ]);\n}\n\nreplaceProperty(Node.prototype, 'Node', [\n    {\n        name: 'width',\n        targetName: 'node.getComponent(UITransform)',\n        customGetter (this: Node) {\n            return this._uiProps.uiTransformComp!.width;\n        },\n        customSetter (this: Node, value: number) {\n            this._uiProps.uiTransformComp!.width = value;\n        },\n    },\n    {\n        name: 'height',\n        targetName: 'node.getComponent(UITransform)',\n        customGetter (this: Node) {\n            return this._uiProps.uiTransformComp!.height;\n        },\n        customSetter (this: Node, value: number) {\n            this._uiProps.uiTransformComp!.height = value;\n        },\n    },\n    {\n        name: 'anchorX',\n        targetName: 'node.getComponent(UITransform)',\n        customGetter (this: Node) {\n            return this._uiProps.uiTransformComp!.anchorX;\n        },\n        customSetter (this: Node, value: number) {\n            this._uiProps.uiTransformComp!.anchorX = value;\n        },\n    },\n    {\n        name: 'anchorY',\n        targetName: 'node.getComponent(UITransform)',\n        customGetter (this: Node) {\n            return this._uiProps.uiTransformComp!.anchorY;\n        },\n        customSetter (this: Node, value: number) {\n            this._uiProps.uiTransformComp!.anchorY = value;\n        },\n    },\n    {\n        name: 'getAnchorPoint',\n        targetName: 'node.getComponent(UITransform)',\n        customFunction (this: Node, out?: Vec2) {\n            if (!out) {\n                out = new Vec2();\n            }\n            out.set(this._uiProps.uiTransformComp!.anchorPoint);\n            return out;\n        },\n    },\n    {\n        name: 'setAnchorPoint',\n        targetName: 'node.getComponent(UITransform)',\n        customFunction (this: Node, point: Vec2 | number, y?: number) {\n            this._uiProps.uiTransformComp!.setAnchorPoint(point, y);\n        },\n    },\n    {\n        name: 'getContentSize',\n        targetName: 'node.getComponent(UITransform)',\n        customFunction (this: Node, out?: Size): Size {\n            if (!out) {\n                out = new Size();\n            }\n\n            out.set(this._uiProps.uiTransformComp!.contentSize);\n            return out;\n        },\n    },\n    {\n        name: 'setContentSize',\n        targetName: 'node.getComponent(UITransform)',\n        customFunction (this: Node, size: Size | number, height?: number) {\n            if (typeof size === 'number') {\n                this._uiProps.uiTransformComp!.setContentSize(size, height!);\n            } else {\n                this._uiProps.uiTransformComp!.setContentSize(size);\n            }\n        },\n    },\n]);\n\nremoveProperty(SceneGlobals.prototype, 'SceneGlobals.prototype', [\n    {\n        name: 'aspect',\n    },\n    {\n        name: 'selfShadow',\n    },\n    {\n        name: 'linear',\n    },\n    {\n        name: 'packing',\n    },\n    {\n        name: 'autoAdapt',\n    },\n    {\n        name: 'fixedArea',\n    },\n    {\n        name: 'pcf',\n    },\n    {\n        name: 'bias',\n    },\n    {\n        name: 'normalBias',\n    },\n    {\n        name: 'near',\n    },\n    {\n        name: 'far',\n    },\n    {\n        name: 'shadowDistance',\n    },\n    {\n        name: 'invisibleOcclusionRange',\n    },\n    {\n        name: 'orthoSize',\n    },\n    {\n        name: 'saturation',\n    },\n]);\n\nreplaceProperty(SceneGlobals.prototype, 'SceneGlobals.prototype', [\n    {\n        name: 'distance',\n        newName: 'planeHeight',\n    },\n    {\n        name: 'normal',\n        newName: 'planeDirection',\n    },\n    {\n        name: 'size',\n        newName: 'shadowMapSize',\n    },\n]);\n\nremoveProperty(Node.prototype, 'Node.prototype', [\n    {\n        name: 'addLayer',\n    },\n    {\n        name: 'removeLayer',\n    },\n]);\n\nreplaceProperty(NodeUIProperties.prototype, 'NodeUIProperties', [\n    {\n        name: 'opacityDirty',\n        newName: 'colorDirty',\n    },\n]);\n\nremoveProperty(Layers, 'Layers', [\n    {\n        name: 'All',\n    },\n    {\n        name: 'RaycastMask',\n    },\n    {\n        name: 'check',\n    },\n]);\n\nreplaceProperty(Layers, 'Layers', [\n    {\n        name: 'Default',\n        newName: 'DEFAULT',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'Always',\n        newName: 'ALWAYS',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'IgnoreRaycast',\n        newName: 'IGNORE_RAYCAST',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'Gizmos',\n        newName: 'GIZMOS',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'Editor',\n        newName: 'EDITOR',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'UI',\n        newName: 'UI_3D',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'UI2D',\n        newName: 'UI_2D',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'SceneGizmo',\n        newName: 'SCENE_GIZMO',\n        target: Layers.Enum,\n        targetName: 'Layers.Enum',\n    },\n    {\n        name: 'makeInclusiveMask',\n        newName: 'makeMaskInclude',\n        target: Layers,\n        targetName: 'Layers',\n    },\n    {\n        name: 'makeExclusiveMask',\n        newName: 'makeMaskExclude',\n        target: Layers,\n        targetName: 'Layers',\n    },\n]);\n\nremoveProperty(Layers.Enum, 'Layers.Enum', [\n    {\n        name: 'ALWAYS',\n    },\n]);\n\nremoveProperty(Layers.BitMask, 'Layers.BitMask', [\n    {\n        name: 'ALWAYS',\n    },\n]);\n\nconst HideInHierarchy = CCObject.Flags.HideInHierarchy;\nconst DontSave = CCObject.Flags.DontSave;\n\n/**\n * @internal\n * @deprecated since v3.5\n */\n@ccclass('cc.PrivateNode')\nexport class PrivateNode extends Node {\n    constructor (name?: string) {\n        super(name);\n        warnID(12003, this.name);\n\n        this.hideFlags |= DontSave | HideInHierarchy;\n    }\n}\n\nif (EDITOR) {\n    // check components to avoid missing node reference serialied in previous version\n    PrivateNode.prototype._onBatchCreated = function onBatchCreated (dontSyncChildPrefab: boolean) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error\n        for (const comp of this._components) {\n            comp.node = this;\n        }\n\n        Node.prototype._onBatchCreated.call(this, dontSyncChildPrefab);\n    };\n}\n\nreplaceProperty(SystemEventType, 'SystemEventType', [\n    'MOUSE_ENTER',\n    'MOUSE_LEAVE',\n    'TRANSFORM_CHANGED',\n    'SCENE_CHANGED_FOR_PERSISTS',\n    'SIZE_CHANGED',\n    'ANCHOR_CHANGED',\n    'COLOR_CHANGED',\n    'CHILD_ADDED',\n    'CHILD_REMOVED',\n    'PARENT_CHANGED',\n    'NODE_DESTROYED',\n    'LAYER_CHANGED',\n    'SIBLING_ORDER_CHANGED',\n].map((name: string) => ({\n    name,\n    target: Node.EventType,\n    targetName: 'Node.EventType',\n})));\n\nreplaceProperty(Node.EventType, 'Node.EventType', [\n    {\n        name: 'DEVICEMOTION',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n    {\n        name: 'KEY_DOWN',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n    {\n        name: 'KEY_UP',\n        target: SystemEvent.EventType,\n        targetName: 'SystemEvent.EventType',\n    },\n]);\n\nlegacyCC.PrivateNode = PrivateNode;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, SUPPORT_JIT } from 'internal:constants';\nimport { legacyCC } from '../../global-exports';\nimport type { Node } from '../../scene-graph/node';\nimport { errorID, warn } from '../../platform/debug';\nimport { Component } from '../../components';\nimport type { BaseNode } from '../../scene-graph/base-node';\nimport { MountedChildrenInfo, PropertyOverrideInfo } from './prefab-info';\nimport { MountedComponentsInfo, TargetInfo } from '.';\nimport { editorExtrasTag } from '../../data';\nimport { ValueType } from '../../value-types';\n\nexport function createNodeWithPrefab (node: Node) {\n    // @ts-expect-error: private member access\n    const prefabInfo = node._prefab;\n    if (!prefabInfo) {\n        return;\n    }\n\n    const prefabInstance = prefabInfo.instance;\n\n    if (!prefabInstance) {\n        return;\n    }\n\n    if (!prefabInfo.asset) {\n        if (EDITOR) {\n            // TODO show message in editor\n        } else {\n            errorID(3701, node.name);\n        }\n\n        prefabInfo.instance = undefined;\n        return;\n    }\n\n    // save root's preserved props to avoid overwritten by prefab\n    const _objFlags = node._objFlags;\n    // @ts-expect-error: private member access\n    const _parent = node._parent;\n    // @ts-expect-error: private member access\n    const _id = node._id;\n    // @ts-expect-error: private member access\n    const _prefab = node._prefab;\n    const editorExtras = node[editorExtrasTag];\n\n    // instantiate prefab\n    legacyCC.game._isCloning = true;\n    if (SUPPORT_JIT) {\n        // @ts-expect-error: private member access\n        prefabInfo.asset._doInstantiate(node);\n    } else {\n        // root in prefab asset is always synced\n        const prefabRoot = prefabInfo.asset.data;\n\n        // use node as the instantiated prefabRoot to make references to prefabRoot in prefab redirect to node\n        prefabRoot._iN$t = node;\n\n        // instantiate prefab and apply to node\n        legacyCC.instantiate._clone(prefabRoot, prefabRoot);\n    }\n    legacyCC.game._isCloning = false;\n\n    // restore preserved props\n    node._objFlags = _objFlags;\n    // @ts-expect-error: private member access\n    node._parent = _parent;\n    // @ts-expect-error: private member access\n    node._id = _id;\n    if (EDITOR) {\n        node[editorExtrasTag] = editorExtras;\n    }\n\n    // @ts-expect-error: private member access\n    if (node._prefab) {\n        // just keep the instance\n        // @ts-expect-error: private member access\n        node._prefab.instance = _prefab?.instance;\n    }\n}\n\n// TODO: more efficient id->Node/Component map\nexport function generateTargetMap (node: Node, targetMap: any, isRoot: boolean) {\n    if (!targetMap) {\n        return;\n    }\n\n    if (!node) {\n        return;\n    }\n\n    let curTargetMap = targetMap;\n\n    // @ts-expect-error: private member access\n    const prefabInstance = node._prefab?.instance;\n    if (!isRoot && prefabInstance) {\n        targetMap[prefabInstance.fileId] = {};\n        curTargetMap = targetMap[prefabInstance.fileId];\n    }\n\n    // @ts-expect-error: private member access\n    const prefabInfo = node._prefab;\n    if (prefabInfo) {\n        curTargetMap[prefabInfo.fileId] = node;\n    }\n\n    const components = node.components;\n    for (let i = 0; i < components.length; i++) {\n        const comp = components[i];\n        if (comp.__prefab) {\n            curTargetMap[comp.__prefab.fileId] = comp;\n        }\n    }\n\n    for (let i = 0; i < node.children.length; i++) {\n        const childNode = node.children[i];\n        generateTargetMap(childNode, curTargetMap, false);\n    }\n}\n\nexport function getTarget (localID: string[], targetMap: any) {\n    if (!localID) {\n        return null;\n    }\n\n    let target: Component | Node | null = null;\n    let targetIter: any = targetMap;\n    for (let i = 0; i < localID.length; i++) {\n        if (!targetIter) {\n            return null;\n        }\n        targetIter = targetIter[localID[i]];\n    }\n\n    target = targetIter;\n\n    return target;\n}\n\nexport function applyMountedChildren (node: Node, mountedChildren: MountedChildrenInfo[], targetMap: Record<string, any | Node | Component>) {\n    if (!mountedChildren) {\n        return;\n    }\n\n    for (let i = 0; i < mountedChildren.length; i++) {\n        const childInfo = mountedChildren[i];\n        if (childInfo && childInfo.targetInfo) {\n            const target = getTarget(childInfo.targetInfo.localID, targetMap) as Node;\n            if (!target) {\n                continue;\n            }\n\n            let curTargetMap = targetMap;\n            const localID = childInfo.targetInfo.localID;\n            if (localID.length > 0) {\n                for (let i = 0; i < localID.length - 1; i++) {\n                    curTargetMap = curTargetMap[localID[i]];\n                }\n            }\n            if (childInfo.nodes) {\n                for (let i = 0; i < childInfo.nodes.length; i++) {\n                    const childNode = childInfo.nodes[i];\n\n                    // @ts-expect-error private member access\n                    if (!childNode || target._children.includes(childNode)) {\n                        continue;\n                    }\n\n                    // @ts-expect-error private member access\n                    target._children.push(childNode);\n                    // @ts-expect-error private member access\n                    childNode._parent = target;\n                    if (EDITOR) {\n                        if (!childNode[editorExtrasTag]) {\n                            childNode[editorExtrasTag] = {};\n                        }\n                        // @ts-expect-error editor polyfill\n                        childNode[editorExtrasTag].mountedRoot = node;\n                    }\n                    // mounted node need to add to the target map\n                    generateTargetMap(childNode, curTargetMap, false);\n                    // siblingIndex update is in _onBatchCreated function, and it needs a parent.\n                    // @ts-expect-error private member access\n                    childNode._siblingIndex = target._children.length - 1;\n                    expandPrefabInstanceNode(childNode, true);\n                }\n            }\n        }\n    }\n}\n\nexport function applyMountedComponents (node: Node, mountedComponents: MountedComponentsInfo[], targetMap: Record<string, any | Node | Component>) {\n    if (!mountedComponents) {\n        return;\n    }\n\n    for (let i = 0; i < mountedComponents.length; i++) {\n        const componentsInfo = mountedComponents[i];\n        if (componentsInfo && componentsInfo.targetInfo) {\n            const target = getTarget(componentsInfo.targetInfo.localID, targetMap) as Node;\n            if (!target) {\n                continue;\n            }\n\n            if (componentsInfo.components) {\n                for (let i = 0; i < componentsInfo.components.length; i++) {\n                    const comp = componentsInfo.components[i];\n                    if (!comp) {\n                        continue;\n                    }\n\n                    comp.node = target;\n                    if (EDITOR) {\n                        if (!comp[editorExtrasTag]) {\n                            comp[editorExtrasTag] = {};\n                        }\n                        // @ts-expect-error editor polyfill\n                        comp[editorExtrasTag].mountedRoot = node;\n                    }\n                    // @ts-expect-error private member access\n                    target._components.push(comp);\n                }\n            }\n        }\n    }\n}\n\nexport function applyRemovedComponents (node: Node, removedComponents: TargetInfo[], targetMap: Record<string, any | Node | Component>) {\n    if (!removedComponents) {\n        return;\n    }\n\n    for (let i = 0; i < removedComponents.length; i++) {\n        const targetInfo = removedComponents[i];\n        if (targetInfo) {\n            const target = getTarget(targetInfo.localID, targetMap) as Component;\n            if (!target || !target.node) {\n                continue;\n            }\n\n            const index = target.node.components.indexOf(target);\n            if (index >= 0) {\n                // @ts-expect-error private member access\n                target.node._components.splice(index, 1);\n            }\n        }\n    }\n}\n\nexport function applyPropertyOverrides (node: Node, propertyOverrides: PropertyOverrideInfo[], targetMap: Record<string, any | Node | Component>) {\n    if (propertyOverrides.length <= 0) {\n        return;\n    }\n\n    let target: any = null;\n    for (let i = 0; i < propertyOverrides.length; i++) {\n        const propOverride = propertyOverrides[i];\n        if (propOverride && propOverride.targetInfo) {\n            const targetInfo = propOverride.targetInfo;\n            target = getTarget(targetInfo.localID, targetMap);\n            if (!target) {\n                // Can't find target\n                continue;\n            }\n\n            let targetPropOwner: any = target;\n            const propertyPath = propOverride.propertyPath.slice();\n            if (propertyPath.length > 0) {\n                const targetPropName = propertyPath.pop();\n                if (!targetPropName) {\n                    continue;\n                }\n\n                for (let i = 0; i < propertyPath.length; i++) {\n                    const propName = propertyPath[i];\n                    targetPropOwner = targetPropOwner[propName];\n                    if (!targetPropOwner) {\n                        break;\n                    }\n                }\n\n                if (!targetPropOwner) {\n                    continue;\n                }\n\n                if (Array.isArray(targetPropOwner)) {\n                    // if set element of a array, the length of a array must has been defined.\n                    if (targetPropName === 'length') {\n                        targetPropOwner[targetPropName] = propOverride.value;\n                    } else {\n                        const index = Number.parseInt(targetPropName);\n                        if (Number.isInteger(index) && index < targetPropOwner.length) {\n                            targetPropOwner[targetPropName] = propOverride.value;\n                        }\n                    }\n                } else if (targetPropOwner[targetPropName] instanceof ValueType) {\n                    targetPropOwner[targetPropName].set(propOverride.value);\n                } else {\n                    targetPropOwner[targetPropName] = propOverride.value;\n                }\n            } else if (EDITOR) {\n                warn('property path is empty');\n            }\n        }\n    }\n}\n\nexport function applyTargetOverrides (node: BaseNode) {\n    // @ts-expect-error private member access\n    const targetOverrides = node._prefab?.targetOverrides;\n    if (targetOverrides) {\n        for (let i = 0; i < targetOverrides.length; i++) {\n            const targetOverride = targetOverrides[i];\n\n            let source: Node | Component | null = targetOverride.source;\n            const sourceInfo = targetOverride.sourceInfo;\n            if (sourceInfo) {\n                // @ts-expect-error private member access\n                const sourceInstance = targetOverride.source?._prefab?.instance;\n                if (sourceInstance && sourceInstance.targetMap) {\n                    source = getTarget(sourceInfo.localID, sourceInstance.targetMap);\n                }\n            }\n\n            if (!source) {\n                // Can't find source\n                continue;\n            }\n\n            let target: Node | Component | null = null;\n            const targetInfo = targetOverride.targetInfo;\n            if (!targetInfo) {\n                continue;\n            }\n\n            // @ts-expect-error private member access\n            const targetInstance = targetOverride.target?._prefab?.instance;\n            if (!targetInstance || !targetInstance.targetMap) {\n                continue;\n            }\n            target = getTarget(targetInfo.localID, targetInstance.targetMap);\n            if (!target) {\n                // Can't find target\n                continue;\n            }\n\n            const propertyPath = targetOverride.propertyPath.slice();\n            let targetPropOwner: any = source;\n            if (propertyPath.length > 0) {\n                const targetPropName = propertyPath.pop();\n                if (!targetPropName) {\n                    return;\n                }\n\n                for (let i = 0; i < propertyPath.length; i++) {\n                    const propName = propertyPath[i];\n                    targetPropOwner = targetPropOwner[propName];\n                    if (!targetPropOwner) {\n                        break;\n                    }\n                }\n\n                if (!targetPropOwner) {\n                    continue;\n                }\n\n                targetPropOwner[targetPropName] = target;\n            }\n        }\n    }\n}\n\nexport function expandPrefabInstanceNode (node: Node, recursively = false) {\n    // @ts-expect-error private member access\n    const prefabInfo = node._prefab;\n    const prefabInstance = prefabInfo?.instance;\n    if (prefabInstance && !prefabInstance.expanded) {\n        createNodeWithPrefab(node);\n        // nested prefab should expand before parent(property override order)\n        if (recursively) {\n            if (node && node.children) {\n                node.children.forEach((child) => {\n                    expandPrefabInstanceNode(child, true);\n                });\n            }\n        }\n        // nested prefab children's id will be the same: 3dtask#12511\n        // applyNodeAndComponentId(node, node.uuid);\n\n        const targetMap: Record<string, any | Node | Component> = {};\n        prefabInstance.targetMap = targetMap;\n        generateTargetMap(node, targetMap, true);\n        applyMountedChildren(node, prefabInstance.mountedChildren, targetMap);\n        applyRemovedComponents(node, prefabInstance.removedComponents, targetMap);\n        applyMountedComponents(node, prefabInstance.mountedComponents, targetMap);\n        applyPropertyOverrides(node, prefabInstance.propertyOverrides, targetMap);\n        prefabInstance.expanded = true;\n    } else if (recursively) {\n        if (node && node.children) {\n            node.children.forEach((child) => {\n                expandPrefabInstanceNode(child, true);\n            });\n        }\n    }\n}\n\nexport function expandNestedPrefabInstanceNode (node: BaseNode) {\n    // @ts-expect-error private member access\n    const prefabInfo = node._prefab;\n\n    if (prefabInfo && prefabInfo.nestedPrefabInstanceRoots) {\n        prefabInfo.nestedPrefabInstanceRoots.forEach((instanceNode: Node) => {\n            expandPrefabInstanceNode(instanceNode);\n        });\n    }\n}\n\nexport function applyNodeAndComponentId (node: Node, rootId: string) {\n    const { components, children } = node;\n    for (let i = 0; i < components.length; i++) {\n        const comp = components[i];\n        comp._id = `${rootId}${comp.__prefab?.fileId}`;\n    }\n    for (let i = 0; i < children.length; i++) {\n        const child = children[i];\n        // @ts-expect-error private member access\n        child._id = `${rootId}${child._prefab?.fileId}`;\n        applyNodeAndComponentId(child, rootId);\n    }\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable, editable } from 'cc.decorator';\nimport { EDITOR, TEST } from 'internal:constants';\nimport { CCObject } from '../data/object';\nimport { Mat4, Quat, Vec3 } from '../math';\nimport { assert, getError } from '../platform/debug';\nimport { RenderScene } from '../renderer/core/render-scene';\nimport { BaseNode } from './base-node';\nimport { legacyCC } from '../global-exports';\nimport { Component } from '../components/component';\nimport { SceneGlobals } from './scene-globals';\nimport { applyTargetOverrides, expandNestedPrefabInstanceNode } from '../utils/prefab/utils';\n\n/**\n * @en\n * Scene is a subclass of [[BaseNode]], composed by nodes, representing the root of a runnable environment in the game.\n * It's managed by [[Director]] and user can switch from a scene to another using [[Director.loadScene]]\n * @zh\n * Scene 是 [[BaseNode]] 的子类，由节点所构成，代表着游戏中可运行的某一个整体环境。\n * 它由 [[Director]] 管理，用户可以使用 [[Director.loadScene]] 来切换场景\n */\n@ccclass('cc.Scene')\nexport class Scene extends BaseNode {\n    /**\n     * @en The renderer scene, normally user don't need to use it\n     * @zh 渲染层场景，一般情况下用户不需要关心它\n     */\n    get renderScene () {\n        return this._renderScene;\n    }\n\n    @editable\n    get globals () {\n        return this._globals;\n    }\n\n    /**\n     * @en Indicates whether all (directly or indirectly) static referenced assets of this scene are releasable by default after scene unloading.\n     * @zh 指示该场景中直接或间接静态引用到的所有资源是否默认在场景切换后自动释放。\n     */\n    @serializable\n    @editable\n    public autoReleaseAssets = false;\n\n    /**\n     * @en Per-scene level rendering info\n     * @zh 场景级别的渲染信息\n     *\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    @serializable\n    public _globals = new SceneGlobals();\n\n    public dependAssets = null; // cache all depend assets for auto release\n\n    protected _renderScene: RenderScene | null = null;\n\n    protected _inited: boolean;\n\n    protected _prefabSyncedInLiveReload = false;\n\n    // support Node access parent data from Scene\n    protected _pos = Vec3.ZERO;\n\n    protected _rot = Quat.IDENTITY;\n\n    protected _scale = Vec3.ONE;\n\n    protected _mat = Mat4.IDENTITY;\n\n    protected _dirtyFlags = 0;\n\n    protected _lpos = Vec3.ZERO;\n\n    protected _lrot = Quat.IDENTITY;\n\n    protected _lscale = Vec3.ONE;\n\n    protected _updateScene () {\n        this._scene = this;\n    }\n\n    constructor (name: string) {\n        super(name);\n        this._activeInHierarchy = false;\n        if (legacyCC.director && legacyCC.director.root) {\n            this._renderScene = legacyCC.director.root.createScene({});\n        }\n        this._inited = legacyCC.game ? !legacyCC.game._isCloning : true;\n    }\n\n    /**\n     * @en Destroy the current scene and all its nodes, this action won't destroy related assets\n     * @zh 销毁当前场景中的所有节点，这个操作不会销毁资源\n     */\n    public destroy () {\n        const success = CCObject.prototype.destroy.call(this);\n        if (success) {\n            const children = this._children;\n            for (let i = 0; i < children.length; ++i) {\n                children[i].active = false;\n            }\n        }\n        if (this._renderScene) legacyCC.director.root.destroyScene(this._renderScene);\n        this._active = false;\n        this._activeInHierarchy = false;\n        return success;\n    }\n\n    /**\n     * @en Only for compatibility purpose, user should not add any component to the scene\n     * @zh 仅为兼容性保留，用户不应该在场景上直接添加任何组件\n     */\n    public addComponent(...args: any[]): Component;\n\n    /**\n     * @en Only for compatibility purpose, user should not add any component to the scene\n     * @zh 仅为兼容性保留，用户不应该在场景上直接添加任何组件\n     */\n    public addComponent (): Component {\n        throw new Error(getError(3822));\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onHierarchyChanged () { }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onBatchCreated (dontSyncChildPrefab: boolean) {\n        super._onBatchCreated(dontSyncChildPrefab);\n        const len = this._children.length;\n        for (let i = 0; i < len; ++i) {\n            this._children[i]._siblingIndex = i;\n            this._children[i]._onBatchCreated(dontSyncChildPrefab);\n        }\n    }\n\n    // transform helpers\n\n    /**\n     * @en\n     * Refer to [[Node.getPosition]]\n     * @zh\n     * 参考 [[Node.getPosition]]\n     */\n    public getPosition (out?: Vec3): Vec3 { return Vec3.copy(out || new Vec3(), Vec3.ZERO); }\n\n    /**\n     * @en\n     * Refer to [[Node.getRotation]]\n     * @zh\n     * 参考 [[Node.getRotation]]\n     */\n    public getRotation (out?: Quat): Quat { return Quat.copy(out || new Quat(), Quat.IDENTITY); }\n\n    /**\n     * @en\n     * Refer to [[Node.getScale]]\n     * @zh\n     * 参考 [[Node.getScale]]\n     */\n    public getScale (out?: Vec3): Vec3 { return Vec3.copy(out || new Vec3(), Vec3.ONE); }\n\n    /**\n     * @en\n     * Refer to [[Node.getWorldPosition]]\n     * @zh\n     * 参考 [[Node.getWorldPosition]]\n     */\n    public getWorldPosition (out?: Vec3) { return Vec3.copy(out || new Vec3(), Vec3.ZERO); }\n\n    /**\n     * @en\n     * Refer to [[Node.getWorldRotation]]\n     * @zh\n     * 参考 [[Node.getWorldRotation]]\n     */\n    public getWorldRotation (out?: Quat) { return Quat.copy(out || new Quat(), Quat.IDENTITY); }\n\n    /**\n     * @en\n     * Refer to [[Node.getWorldScale]]\n     * @zh\n     * 参考 [[Node.getWorldScale]]\n     */\n    public getWorldScale (out?: Vec3) { return Vec3.copy(out || new Vec3(), Vec3.ONE); }\n\n    /**\n     * @en\n     * Refer to [[Node.getWorldMatrix]]\n     * @zh\n     * 参考 [[Node.getWorldMatrix]]\n     */\n    public getWorldMatrix (out?: Mat4): Mat4 { return Mat4.copy(out || new Mat4(), Mat4.IDENTITY); }\n\n    /**\n     * @en\n     * Refer to [[Node.getWorldRS]]\n     * @zh\n     * 参考 [[Node.getWorldRS]]\n     */\n    public getWorldRS (out?: Mat4): Mat4 { return Mat4.copy(out || new Mat4(), Mat4.IDENTITY); }\n\n    /**\n     * @en\n     * Refer to [[Node.getWorldRT]]\n     * @zh\n     * 参考 [[Node.getWorldRT]]\n     */\n    public getWorldRT (out?: Mat4): Mat4 { return Mat4.copy(out || new Mat4(), Mat4.IDENTITY); }\n\n    /**\n     * @en\n     * Refer to [[Node.position]]\n     * @zh\n     * 参考 [[Node.position]]\n     */\n    public get position (): Readonly<Vec3> { return Vec3.ZERO; }\n\n    /**\n     * @en\n     * Refer to [[Node.worldPosition]]\n     * @zh\n     * 参考 [[Node.worldPosition]]\n     */\n    public get worldPosition (): Readonly<Vec3> { return Vec3.ZERO; }\n\n    /**\n     * @en\n     * Refer to [[Node.rotation]]\n     * @zh\n     * 参考 [[Node.rotation]]\n     */\n    public get rotation (): Readonly<Quat> { return Quat.IDENTITY; }\n\n    /**\n     * @en\n     * Refer to [[Node.worldRotation]]\n     * @zh\n     * 参考 [[Node.worldRotation]]\n     */\n    public get worldRotation (): Readonly<Quat> { return Quat.IDENTITY; }\n\n    /**\n     * @en\n     * Refer to [[Node.scale]]\n     * @zh\n     * 参考 [[Node.scale]]\n     */\n    public get scale (): Readonly<Vec3> { return Vec3.ONE; }\n\n    /**\n     * @en\n     * Refer to [[Node.worldScale]]\n     * @zh\n     * 参考 [[Node.worldScale]]\n     */\n    public get worldScale (): Readonly<Vec3> { return Vec3.ONE; }\n\n    /**\n     * @en\n     * Refer to [[Node.eulerAngles]]\n     * @zh\n     * 参考 [[Node.eulerAngles]]\n     */\n    public get eulerAngles (): Readonly<Vec3> { return Vec3.ZERO; }\n\n    /**\n     * @en\n     * Refer to [[Node.worldMatrix]]\n     * @zh\n     * 参考 [[Node.worldMatrix]]\n     */\n    public get worldMatrix (): Readonly<Mat4> { return Mat4.IDENTITY; }\n\n    /**\n     * @en\n     * Refer to [[Node.updateWorldTransform]]\n     * @zh\n     * 参考 [[Node.updateWorldTransform]]\n     */\n    public updateWorldTransform () {}\n\n    // life-cycle call backs\n\n    protected _instantiate () { }\n\n    protected _load () {\n        if (!this._inited) {\n            if (TEST) {\n                assert(!this._activeInHierarchy, 'Should deactivate ActionManager by default');\n            }\n\n            expandNestedPrefabInstanceNode(this);\n            applyTargetOverrides(this);\n            this._onBatchCreated(EDITOR && this._prefabSyncedInLiveReload);\n            this._inited = true;\n        }\n        // static method can't use this as parameter type\n        this.walk(BaseNode._setScene);\n    }\n\n    protected _activate (active: boolean) {\n        active = (active !== false);\n        if (EDITOR) {\n            // register all nodes to editor\n            // @ts-expect-error Polyfilled functions in base-node-dev.ts\n            this._registerIfAttached!(active);\n        }\n        legacyCC.director._nodeActivator.activateNode(this, active);\n        // The test environment does not currently support the renderer\n        if (!TEST) {\n            this._globals.activate();\n        }\n    }\n}\n\nlegacyCC.Scene = Scene;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { DEV } from 'internal:constants';\nimport { warnID } from '../platform/debug';\nimport { Node } from './node';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Finds a node by hierarchy path, the path is case-sensitive.\n * It will traverse the hierarchy by splitting the path using '/' character.\n * This function will still returns the node even if it is inactive.\n * It is recommended to not use this function every frame instead cache the result at startup.\n * @zh 通过路径从节点树中查找节点的方法，路径是大小写敏感的，并且通过 `/` 来分隔节点层级。\n * 即使节点的状态是未启用的也可以找到，建议将结果缓存，而不是每次需要都去查找。\n * @param path The path of the target node\n * @param referenceNode If given, the search will be limited in the sub node tree of the reference node\n */\nexport function find (path: string, referenceNode?: Node): Node | null {\n    if (!referenceNode) {\n        const scene = legacyCC.director.getScene();\n        if (!scene) {\n            if (DEV) {\n                warnID(5601);\n            }\n            return null;\n        } else if (DEV && !scene.isValid) {\n            warnID(5602);\n            return null;\n        }\n        referenceNode = scene;\n    } else if (DEV && !referenceNode.isValid) {\n        warnID(5603);\n        return null;\n    }\n    return referenceNode!.getChildByPath(path);\n}\n\nlegacyCC.find = find;\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, SUPPORT_JIT, DEV, TEST } from 'internal:constants';\nimport { CCObject } from '../data/object';\nimport { MutableForwardIterator } from '../utils/array';\nimport { array } from '../utils/js';\nimport { tryCatchFunctor_EDITOR } from '../utils/misc';\nimport { legacyCC } from '../global-exports';\nimport { error, assert } from '../platform/debug';\n\nconst fastRemoveAt = array.fastRemoveAt;\n\nconst IsStartCalled = CCObject.Flags.IsStartCalled;\nconst IsOnEnableCalled = CCObject.Flags.IsOnEnableCalled;\nconst IsEditorOnEnableCalled = CCObject.Flags.IsEditorOnEnableCalled;\n\nconst callerFunctor: any = EDITOR && tryCatchFunctor_EDITOR;\nconst callOnEnableInTryCatch = EDITOR && callerFunctor('onEnable');\nconst callOnDisableInTryCatch = EDITOR && callerFunctor('onDisable');\n\nfunction sortedIndex (array, comp) {\n    const order = comp.constructor._executionOrder;\n    const id = comp._id;\n    let l = 0;\n    for (let h = array.length - 1, m = h >>> 1;\n        l <= h;\n        m = (l + h) >>> 1\n    ) {\n        const test = array[m];\n        const testOrder = test.constructor._executionOrder;\n        if (testOrder > order) {\n            h = m - 1;\n        } else if (testOrder < order) {\n            l = m + 1;\n        } else {\n            const testId = test._id;\n            if (testId > id) {\n                h = m - 1;\n            } else if (testId < id) {\n                l = m + 1;\n            } else {\n                return m;\n            }\n        }\n    }\n    return ~l;\n}\n\n// remove disabled and not invoked component from array\nfunction stableRemoveInactive (iterator, flagToClear) {\n    const array = iterator.array;\n    let next = iterator.i + 1;\n    while (next < array.length) {\n        const comp = array[next];\n        if (comp.node._activeInHierarchy) {\n            ++next;\n        } else {\n            iterator.removeAt(next);\n            if (flagToClear) {\n                comp._objFlags &= ~flagToClear;\n            }\n        }\n    }\n}\n\n// This class contains some queues used to invoke life-cycle methods by script execution order\nexport class LifeCycleInvoker {\n    public static stableRemoveInactive = stableRemoveInactive;\n\n    protected _zero: MutableForwardIterator<any>;\n    protected _neg: MutableForwardIterator<any>;\n    protected _pos: MutableForwardIterator<any>;\n    protected _invoke: any;\n    constructor (invokeFunc) {\n        const Iterator = MutableForwardIterator;\n        // components which priority === 0 (default)\n        this._zero = new Iterator([]);\n        // components which priority < 0\n        this._neg = new Iterator([]);\n        // components which priority > 0\n        this._pos = new Iterator([]);\n\n        if (TEST) {\n            assert(typeof invokeFunc === 'function', 'invokeFunc must be type function');\n        }\n        this._invoke = invokeFunc;\n    }\n}\n\nfunction compareOrder (a, b) {\n    return a.constructor._executionOrder - b.constructor._executionOrder;\n}\n\n// for onLoad: sort once all components registered, invoke once\nexport class OneOffInvoker extends LifeCycleInvoker {\n    public add (comp) {\n        const order = comp.constructor._executionOrder;\n        (order === 0 ? this._zero : (order < 0 ? this._neg : this._pos)).array.push(comp);\n    }\n\n    public remove (comp) {\n        const order = comp.constructor._executionOrder;\n        (order === 0 ? this._zero : (order < 0 ? this._neg : this._pos)).fastRemove(comp);\n    }\n\n    public cancelInactive (flagToClear) {\n        stableRemoveInactive(this._zero, flagToClear);\n        stableRemoveInactive(this._neg, flagToClear);\n        stableRemoveInactive(this._pos, flagToClear);\n    }\n\n    public invoke () {\n        const compsNeg = this._neg;\n        if (compsNeg.array.length > 0) {\n            compsNeg.array.sort(compareOrder);\n            this._invoke(compsNeg);\n            compsNeg.array.length = 0;\n        }\n\n        this._invoke(this._zero);\n        this._zero.array.length = 0;\n\n        const compsPos = this._pos;\n        if (compsPos.array.length > 0) {\n            compsPos.array.sort(compareOrder);\n            this._invoke(compsPos);\n            compsPos.array.length = 0;\n        }\n    }\n}\n\n// for update: sort every time new component registered, invoke many times\nclass ReusableInvoker extends LifeCycleInvoker {\n    public add (comp) {\n        const order = comp.constructor._executionOrder;\n        if (order === 0) {\n            this._zero.array.push(comp);\n        } else {\n            const array = order < 0 ? this._neg.array : this._pos.array;\n            const i = sortedIndex(array, comp);\n            if (i < 0) {\n                array.splice(~i, 0, comp);\n            } else if (DEV) {\n                error('component already added');\n            }\n        }\n    }\n\n    public remove (comp) {\n        const order = comp.constructor._executionOrder;\n        if (order === 0) {\n            this._zero.fastRemove(comp);\n        } else {\n            const iterator = order < 0 ? this._neg : this._pos;\n            const i = sortedIndex(iterator.array, comp);\n            if (i >= 0) {\n                iterator.removeAt(i);\n            }\n        }\n    }\n\n    public invoke (dt) {\n        if (this._neg.array.length > 0) {\n            this._invoke(this._neg, dt);\n        }\n\n        this._invoke(this._zero, dt);\n\n        if (this._pos.array.length > 0) {\n            this._invoke(this._pos, dt);\n        }\n    }\n}\n\nfunction enableInEditor (comp) {\n    if (!(comp._objFlags & IsEditorOnEnableCalled)) {\n        legacyCC.engine.emit('component-enabled', comp.uuid);\n        if (!legacyCC.GAME_VIEW) {\n            comp._objFlags |= IsEditorOnEnableCalled;\n        }\n    }\n}\n\n// return function to simply call each component with try catch protection\nexport function createInvokeImplJit (code: string, useDt?, ensureFlag?) {\n    // function (it) {\n    //     let a = it.array;\n    //     for (it.i = 0; it.i < a.length; ++it.i) {\n    //         let c = a[it.i];\n    //         // ...\n    //     }\n    // }\n    const body = `${'var a=it.array;'\n                + 'for(it.i=0;it.i<a.length;++it.i){'\n                + 'var c=a[it.i];'}${\n        code\n    }}`;\n    const fastPath = useDt ? Function('it', 'dt', body) : Function('it', body);\n    const singleInvoke = Function('c', 'dt', code);\n    return createInvokeImpl(singleInvoke, fastPath, ensureFlag);\n}\nexport function createInvokeImpl (singleInvoke, fastPath, ensureFlag?) {\n    return (iterator, dt) => {\n        try {\n            fastPath(iterator, dt);\n        } catch (e) {\n            // slow path\n            legacyCC._throw(e);\n            const array = iterator.array;\n            if (ensureFlag) {\n                array[iterator.i]._objFlags |= ensureFlag;\n            }\n            ++iterator.i;   // invoke next callback\n            for (; iterator.i < array.length; ++iterator.i) {\n                try {\n                    singleInvoke(array[iterator.i], dt);\n                } catch (e) {\n                    legacyCC._throw(e);\n                    if (ensureFlag) {\n                        array[iterator.i]._objFlags |= ensureFlag;\n                    }\n                }\n            }\n        }\n    };\n}\n\nconst invokeStart = SUPPORT_JIT ? createInvokeImplJit(`c.start();c._objFlags|=${IsStartCalled}`, false, IsStartCalled)\n    : createInvokeImpl(\n        (c) => {\n            c.start();\n            c._objFlags |= IsStartCalled;\n        },\n        (iterator) => {\n            const array = iterator.array;\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n                const comp = array[iterator.i];\n                comp.start();\n                comp._objFlags |= IsStartCalled;\n            }\n        },\n        IsStartCalled,\n    );\n\nconst invokeUpdate = SUPPORT_JIT ? createInvokeImplJit('c.update(dt)', true)\n    : createInvokeImpl(\n        (c, dt) => {\n            c.update(dt);\n        },\n        (iterator, dt) => {\n            const array = iterator.array;\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n                array[iterator.i].update(dt);\n            }\n        },\n    );\n\nconst invokeLateUpdate = SUPPORT_JIT ? createInvokeImplJit('c.lateUpdate(dt)', true)\n    : createInvokeImpl(\n        (c, dt) => {\n            c.lateUpdate(dt);\n        },\n        (iterator, dt) => {\n            const array = iterator.array;\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n                array[iterator.i].lateUpdate(dt);\n            }\n        },\n    );\n\nexport const invokeOnEnable = EDITOR ? (iterator) => {\n    const compScheduler = legacyCC.director._compScheduler;\n    const array = iterator.array;\n    for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n        const comp = array[iterator.i];\n        if (comp._enabled) {\n            callOnEnableInTryCatch(comp);\n            const deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\n            if (!deactivatedDuringOnEnable) {\n                compScheduler._onEnabled(comp);\n            }\n        }\n    }\n} : (iterator) => {\n    const compScheduler = legacyCC.director._compScheduler;\n    const array = iterator.array;\n    for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n        const comp = array[iterator.i];\n        if (comp._enabled) {\n            comp.onEnable();\n            const deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\n            if (!deactivatedDuringOnEnable) {\n                compScheduler._onEnabled(comp);\n            }\n        }\n    }\n};\n\n/**\n * @en The Manager for Component's life-cycle methods.\n * It collaborates with [[NodeActivator]] to schedule and invoke life cycle methods for components\n * @zh 组件生命周期函数的调度器。\n * 它和 [[NodeActivator]] 一起调度并执行组件的生命周期函数。\n */\nexport class ComponentScheduler {\n    /**\n     * @en The invoker of `start` callback\n     * @zh `start` 回调的调度器\n     */\n    public startInvoker!: OneOffInvoker;\n    /**\n     * @en The invoker of `update` callback\n     * @zh `update` 回调的调度器\n     */\n    public updateInvoker!: ReusableInvoker;\n    /**\n     * @en The invoker of `lateUpdate` callback\n     * @zh `lateUpdate` 回调的调度器\n     */\n    public lateUpdateInvoker!: ReusableInvoker;\n    // components deferred to schedule\n    private _deferredComps: any[] = [];\n    private _updating!: boolean;\n\n    constructor () {\n        this.unscheduleAll();\n    }\n\n    /**\n     * @en Cancel all future callbacks, including `start`, `update` and `lateUpdate`\n     * @zh 取消所有未来的函数调度，包括 `start`，`update` 和 `lateUpdate`\n     */\n    public unscheduleAll () {\n        // invokers\n        this.startInvoker = new OneOffInvoker(invokeStart);\n        this.updateInvoker = new ReusableInvoker(invokeUpdate);\n        this.lateUpdateInvoker = new ReusableInvoker(invokeLateUpdate);\n\n        // during a loop\n        this._updating = false;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onEnabled (comp) {\n        legacyCC.director.getScheduler().resumeTarget(comp);\n        comp._objFlags |= IsOnEnableCalled;\n\n        // schedule\n        if (this._updating) {\n            this._deferredComps.push(comp);\n        } else {\n            this._scheduleImmediate(comp);\n        }\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _onDisabled (comp) {\n        legacyCC.director.getScheduler().pauseTarget(comp);\n        comp._objFlags &= ~IsOnEnableCalled;\n\n        // cancel schedule task\n        const index = this._deferredComps.indexOf(comp);\n        if (index >= 0) {\n            fastRemoveAt(this._deferredComps, index);\n            return;\n        }\n\n        // unschedule\n        if (comp.start && !(comp._objFlags & IsStartCalled)) {\n            this.startInvoker.remove(comp);\n        }\n        if (comp.update) {\n            this.updateInvoker.remove(comp);\n        }\n        if (comp.lateUpdate) {\n            this.lateUpdateInvoker.remove(comp);\n        }\n    }\n\n    /**\n     * @en Enable a component\n     * @zh 启用一个组件\n     * @param comp The component to be enabled\n     * @param invoker The invoker which is responsible to schedule the `onEnable` call\n     */\n    public enableComp (comp, invoker?) {\n        if (!(comp._objFlags & IsOnEnableCalled)) {\n            if (comp.onEnable) {\n                if (invoker) {\n                    invoker.add(comp);\n                    return;\n                } else {\n                    comp.onEnable();\n\n                    const deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\n                    if (deactivatedDuringOnEnable) {\n                        return;\n                    }\n                }\n            }\n            this._onEnabled(comp);\n        }\n    }\n\n    /**\n     * @en Disable a component\n     * @zh 禁用一个组件\n     * @param comp The component to be disabled\n     */\n    public disableComp (comp) {\n        if (comp._objFlags & IsOnEnableCalled) {\n            if (comp.onDisable) {\n                comp.onDisable();\n            }\n            this._onDisabled(comp);\n        }\n    }\n\n    /**\n     * @en Process start phase for registered components\n     * @zh 为当前注册的组件执行 start 阶段任务\n     */\n    public startPhase () {\n        // Start of this frame\n        this._updating = true;\n\n        // call start\n        this.startInvoker.invoke();\n        // Start components of new activated nodes during start\n        this._startForNewComps();\n        // if (PREVIEW) {\n        //     try {\n        //         this.startInvoker.invoke();\n        //     }\n        //     catch (e) {\n        //         // prevent start from getting into infinite loop\n        //         this.startInvoker._neg.array.length = 0;\n        //         this.startInvoker._zero.array.length = 0;\n        //         this.startInvoker._pos.array.length = 0;\n        //         throw e;\n        //     }\n        // }\n        // else {\n        //     this.startInvoker.invoke();\n        // }\n    }\n\n    /**\n     * @en Process update phase for registered components\n     * @zh 为当前注册的组件执行 update 阶段任务\n     * @param dt @en Time passed after the last frame in seconds @zh 距离上一帧的时间，以秒计算\n     */\n    public updatePhase (dt:number) {\n        this.updateInvoker.invoke(dt);\n    }\n\n    /**\n     * @en Process late update phase for registered components\n     * @zh 为当前注册的组件执行 late update 阶段任务\n     * @param dt @en Time passed after the last frame in seconds @zh 距离上一帧的时间，以秒计算\n     */\n    public lateUpdatePhase (dt:number) {\n        this.lateUpdateInvoker.invoke(dt);\n\n        // End of this frame\n        this._updating = false;\n\n        // Start components of new activated nodes during update and lateUpdate\n        // They will be running in the next frame\n        this._startForNewComps();\n    }\n\n    // Call new registered start schedule immediately since last time start phase calling in this frame\n    // See cocos-creator/2d-tasks/issues/256\n    private _startForNewComps () {\n        if (this._deferredComps.length > 0) {\n            this._deferredSchedule();\n            this.startInvoker.invoke();\n        }\n    }\n\n    private _scheduleImmediate (comp) {\n        if (typeof comp.start === 'function' && !(comp._objFlags & IsStartCalled)) {\n            this.startInvoker.add(comp);\n        }\n        if (typeof comp.update === 'function') {\n            this.updateInvoker.add(comp);\n        }\n        if (typeof comp.lateUpdate === 'function') {\n            this.lateUpdateInvoker.add(comp);\n        }\n    }\n\n    private _deferredSchedule () {\n        const comps = this._deferredComps;\n        for (let i = 0, len = comps.length; i < len; i++) {\n            this._scheduleImmediate(comps[i]);\n        }\n        comps.length = 0;\n    }\n}\n\nif (EDITOR) {\n    ComponentScheduler.prototype.enableComp = function (comp, invoker) {\n        if (legacyCC.GAME_VIEW || comp.constructor._executeInEditMode) {\n            if (!(comp._objFlags & IsOnEnableCalled)) {\n                if (comp.onEnable) {\n                    if (invoker) {\n                        invoker.add(comp);\n                        enableInEditor(comp);\n                        return;\n                    } else {\n                        callOnEnableInTryCatch(comp);\n\n                        const deactivatedDuringOnEnable = !comp.node._activeInHierarchy;\n                        if (deactivatedDuringOnEnable) {\n                            return;\n                        }\n                    }\n                }\n                this._onEnabled(comp);\n            }\n        }\n        enableInEditor(comp);\n    };\n\n    ComponentScheduler.prototype.disableComp = function (comp) {\n        if (legacyCC.GAME_VIEW || comp.constructor._executeInEditMode) {\n            if (comp._objFlags & IsOnEnableCalled) {\n                if (comp.onDisable) {\n                    callOnDisableInTryCatch(comp);\n                }\n                this._onDisabled(comp);\n            }\n        }\n        if (comp._objFlags & IsEditorOnEnableCalled) {\n            legacyCC.engine.emit('component-disabled', comp.uuid);\n            comp._objFlags &= ~IsEditorOnEnableCalled;\n        }\n    };\n}\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { EDITOR, DEV, TEST, SUPPORT_JIT, DEBUG } from 'internal:constants';\nimport { CCObject, isValid } from '../data/object';\nimport { array, Pool } from '../utils/js';\nimport { tryCatchFunctor_EDITOR } from '../utils/misc';\nimport { invokeOnEnable, createInvokeImpl, createInvokeImplJit, OneOffInvoker, LifeCycleInvoker } from './component-scheduler';\nimport { legacyCC } from '../global-exports';\nimport { assert, errorID, getError } from '../platform/debug';\nimport { NodeEventType } from './node-event';\nimport { assertIsTrue } from '../data/utils/asserts';\n\nconst MAX_POOL_SIZE = 4;\n\nconst IsPreloadStarted = CCObject.Flags.IsPreloadStarted;\nconst IsOnLoadStarted = CCObject.Flags.IsOnLoadStarted;\nconst IsOnLoadCalled = CCObject.Flags.IsOnLoadCalled;\nconst Deactivating = CCObject.Flags.Deactivating;\n\nconst callPreloadInTryCatch = EDITOR && tryCatchFunctor_EDITOR('__preload');\nconst callOnLoadInTryCatch = EDITOR && function (c) {\n    try {\n        c.onLoad();\n    } catch (e) {\n        legacyCC._throw(e);\n    }\n    c._objFlags |= IsOnLoadCalled;\n    _onLoadInEditor(c);\n};\nconst callOnDestroyInTryCatch = EDITOR && tryCatchFunctor_EDITOR('onDestroy');\nconst callOnFocusInTryCatch = EDITOR && tryCatchFunctor_EDITOR('onFocusInEditor');\nconst callOnLostFocusInTryCatch = EDITOR && tryCatchFunctor_EDITOR('onLostFocusInEditor');\n\n// for __preload: used internally, no sort\nclass UnsortedInvoker extends LifeCycleInvoker {\n    public add (comp) {\n        this._zero.array.push(comp);\n    }\n    public remove (comp) {\n        this._zero.fastRemove(comp);\n    }\n    public cancelInactive (flagToClear) {\n        LifeCycleInvoker.stableRemoveInactive(this._zero, flagToClear);\n    }\n    public invoke () {\n        this._invoke(this._zero);\n        this._zero.array.length = 0;\n    }\n}\n\nconst invokePreload = SUPPORT_JIT ? createInvokeImplJit('c.__preload();')\n    : createInvokeImpl(\n        (c) => { c.__preload(); },\n        (iterator) => {\n            const array = iterator.array;\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n                array[iterator.i].__preload();\n            }\n        },\n    );\nconst invokeOnLoad = SUPPORT_JIT ? createInvokeImplJit(`c.onLoad();c._objFlags|=${IsOnLoadCalled}`, false, IsOnLoadCalled)\n    : createInvokeImpl(\n        (c) => {\n            c.onLoad();\n            c._objFlags |= IsOnLoadCalled;\n        },\n        (iterator) => {\n            const array = iterator.array;\n            for (iterator.i = 0; iterator.i < array.length; ++iterator.i) {\n                const comp = array[iterator.i];\n                comp.onLoad();\n                comp._objFlags |= IsOnLoadCalled;\n            }\n        },\n        IsOnLoadCalled,\n    );\n\nconst activateTasksPool = new Pool(MAX_POOL_SIZE);\nactivateTasksPool.get = function getActivateTask () {\n    const task: any = this._get() || {\n        preload: new UnsortedInvoker(invokePreload),\n        onLoad: new OneOffInvoker(invokeOnLoad),\n        onEnable: new OneOffInvoker(invokeOnEnable),\n    };\n\n    // reset index to -1 so we can skip invoked component in cancelInactive\n    task.preload._zero.i = -1;\n    let invoker = task.onLoad;\n    invoker._zero.i = -1;\n    invoker._neg.i = -1;\n    invoker._pos.i = -1;\n    invoker = task.onEnable;\n    invoker._zero.i = -1;\n    invoker._neg.i = -1;\n    invoker._pos.i = -1;\n\n    return task;\n};\n\nfunction _componentCorrupted (node, comp, index) {\n    errorID(3817, node.name, index);\n    console.log('Corrupted component value:', comp);\n    if (comp) {\n        node._removeComponent(comp);\n    } else {\n        array.removeAt(node._components, index);\n    }\n}\n\nfunction _onLoadInEditor (comp) {\n    if (comp.onLoad && !legacyCC.GAME_VIEW) {\n        // @ts-expect-error Editor API usage\n        const focused = Editor.Selection.getLastSelected('node') === comp.node.uuid;\n        if (focused) {\n            if (comp.onFocusInEditor && callOnFocusInTryCatch) {\n                callOnFocusInTryCatch(comp);\n            }\n        } else if (comp.onLostFocusInEditor && callOnLostFocusInTryCatch) {\n            callOnLostFocusInTryCatch(comp);\n        }\n    }\n}\n\n/**\n * @en The class used to perform activating and deactivating operations of node and component.\n * @zh 用于执行节点和组件的激活和停用操作的管理器。\n */\nexport default class NodeActivator {\n    public resetComp: any;\n    protected _activatingStack!: any[];\n\n    constructor () {\n        this.reset();\n    }\n\n    /**\n     * @en Reset all activation or des-activation tasks\n     * @zh 重置所有激活或非激活任务\n     */\n    public reset () {\n        // a stack of node's activating tasks\n        this._activatingStack = [];\n    }\n\n    /**\n     * @en Activate or des-activate a node\n     * @zh 激活或者停用某个节点\n     * @param node Target node\n     * @param active Which state to set the node to\n     */\n    public activateNode (node, active) {\n        if (active) {\n            const task: any = activateTasksPool.get();\n            this._activatingStack.push(task);\n\n            this._activateNodeRecursively(node, task.preload, task.onLoad, task.onEnable);\n            task.preload.invoke();\n            task.onLoad.invoke();\n            task.onEnable.invoke();\n\n            this._activatingStack.pop();\n            activateTasksPool.put(task);\n        } else {\n            this._deactivateNodeRecursively(node);\n\n            // remove children of this node from previous activating tasks to debounce\n            // (this is an inefficient operation but it ensures general case could be implemented in a efficient way)\n            const stack = this._activatingStack;\n            for (const lastTask of stack) {\n                lastTask.preload.cancelInactive(IsPreloadStarted);\n                lastTask.onLoad.cancelInactive(IsOnLoadStarted);\n                lastTask.onEnable.cancelInactive();\n            }\n        }\n        node.emit(NodeEventType.ACTIVE_IN_HIERARCHY_CHANGED, node);\n    }\n\n    /**\n     * @en Activate or des-activate a component\n     * @zh 激活或者停用某个组件\n     * @param comp Target component\n     * @param preloadInvoker The invoker for `_preload` method, normally from [[ComponentScheduler]]\n     * @param onLoadInvoker The invoker for `onLoad` method, normally from [[ComponentScheduler]]\n     * @param onEnableInvoker The invoker for `onEnable` method, normally from [[ComponentScheduler]]\n     */\n    public activateComp (comp, preloadInvoker?, onLoadInvoker?, onEnableInvoker?) {\n        if (!isValid(comp, true)) {\n            // destroyed before activating\n            return;\n        }\n        if (!(comp._objFlags & IsPreloadStarted)) {\n            comp._objFlags |= IsPreloadStarted;\n            if (comp.__preload) {\n                if (preloadInvoker) {\n                    preloadInvoker.add(comp);\n                } else {\n                    comp.__preload();\n                }\n            }\n        }\n        if (!(comp._objFlags & IsOnLoadStarted)) {\n            comp._objFlags |= IsOnLoadStarted;\n            if (comp.onLoad) {\n                if (onLoadInvoker) {\n                    onLoadInvoker.add(comp);\n                } else {\n                    comp.onLoad();\n                    comp._objFlags |= IsOnLoadCalled;\n                }\n            } else {\n                comp._objFlags |= IsOnLoadCalled;\n            }\n        }\n        if (comp._enabled) {\n            if (DEBUG) {\n                assertIsTrue(comp.node, getError(3823, comp.uuid, comp.name));\n            }\n            const deactivatedOnLoading = !comp.node._activeInHierarchy;\n            if (deactivatedOnLoading) {\n                return;\n            }\n            legacyCC.director._compScheduler.enableComp(comp, onEnableInvoker);\n        }\n    }\n\n    /**\n     * @en Destroy a component\n     * @zh 销毁一个组件\n     * @param comp Target component\n     */\n    public destroyComp (comp) {\n        // ensure onDisable called\n        legacyCC.director._compScheduler.disableComp(comp);\n\n        if (comp.onDestroy && (comp._objFlags & IsOnLoadCalled)) {\n            comp.onDestroy();\n        }\n    }\n\n    protected _activateNodeRecursively (node, preloadInvoker, onLoadInvoker, onEnableInvoker) {\n        if (node._objFlags & Deactivating) {\n            // en:\n            // Forbid reactive the same node during its deactivating procedure\n            // to avoid endless loop and simplify the implementation.\n            // zh:\n            // 对相同节点而言，无法撤销反激活，防止反激活 - 激活 - 反激活的死循环发生。\n            // 这样设计简化了一些引擎的实现，而且对调用者来说能保证反激活操作都能成功。\n            errorID(3816, node.name);\n            return;\n        }\n\n        node._activeInHierarchy = true;\n\n        // component maybe added during onEnable, and the onEnable of new component is already called\n        // so we should record the origin length\n        let originCount = node._components.length;\n        // activate components\n        for (let i = 0; i < originCount; ++i) {\n            const component = node._components[i];\n            if (component instanceof legacyCC.Component) {\n                this.activateComp(component, preloadInvoker, onLoadInvoker, onEnableInvoker);\n            } else {\n                _componentCorrupted(node, component, i);\n                --i;\n                --originCount;\n            }\n        }\n\n        // activate children recursively\n        for (let i = 0, len = node._children.length; i < len; ++i) {\n            const child = node._children[i];\n            if (child._active) {\n                this._activateNodeRecursively(child, preloadInvoker, onLoadInvoker, onEnableInvoker);\n            }\n        }\n        node._onPostActivated(true);\n    }\n\n    protected _deactivateNodeRecursively (node) {\n        if (DEV) {\n            assert(!(node._objFlags & Deactivating), 'node should not deactivating');\n            // ensures _activeInHierarchy is always changing when Deactivating flagged\n            assert(node._activeInHierarchy, 'node should not deactivated');\n        }\n        node._objFlags |= Deactivating;\n        node._activeInHierarchy = false;\n\n        // component maybe added during onEnable, and the onEnable of new component is already called\n        // so we should record the origin length\n        const originCount = node._components.length;\n        for (let c = 0; c < originCount; ++c) {\n            const component = node._components[c];\n            if (component._enabled) {\n                legacyCC.director._compScheduler.disableComp(component);\n\n                if (node._activeInHierarchy) {\n                    // reactivated from root\n                    node._objFlags &= ~Deactivating;\n                    return;\n                }\n            }\n        }\n        for (let i = 0, len = node._children.length; i < len; ++i) {\n            const child = node._children[i];\n            if (child._activeInHierarchy) {\n                this._deactivateNodeRecursively(child);\n\n                if (node._activeInHierarchy) {\n                    // reactivated from root\n                    node._objFlags &= ~Deactivating;\n                    return;\n                }\n            }\n        }\n\n        node._onPostActivated(false);\n        node._objFlags &= ~Deactivating;\n    }\n}\n\nif (EDITOR) {\n    NodeActivator.prototype.activateComp = (comp, preloadInvoker, onLoadInvoker, onEnableInvoker) => {\n        if (!isValid(comp, true)) {\n            // destroyed before activating\n            return;\n        }\n        if (legacyCC.GAME_VIEW || comp.constructor._executeInEditMode) {\n            if (!(comp._objFlags & IsPreloadStarted)) {\n                comp._objFlags |= IsPreloadStarted;\n                if (comp.__preload) {\n                    if (preloadInvoker) {\n                        preloadInvoker.add(comp);\n                    } else if (callPreloadInTryCatch) {\n                        callPreloadInTryCatch(comp);\n                    }\n                }\n            }\n            if (!(comp._objFlags & IsOnLoadStarted)) {\n                comp._objFlags |= IsOnLoadStarted;\n                if (comp.onLoad) {\n                    if (onLoadInvoker) {\n                        onLoadInvoker.add(comp);\n                    } else if (callOnLoadInTryCatch) {\n                        callOnLoadInTryCatch(comp);\n                    }\n                } else {\n                    comp._objFlags |= IsOnLoadCalled;\n                    _onLoadInEditor(comp);\n                }\n            }\n        }\n        if (comp._enabled) {\n            if (DEBUG) {\n                assertIsTrue(comp.node, getError(3823, comp.uuid, comp.name));\n            }\n            const deactivatedOnLoading = !comp.node._activeInHierarchy;\n            if (deactivatedOnLoading) {\n                return;\n            }\n            legacyCC.director._compScheduler.enableComp(comp, onEnableInvoker);\n        }\n    };\n\n    NodeActivator.prototype.destroyComp = (comp) => {\n        // ensure onDisable called\n        legacyCC.director._compScheduler.disableComp(comp);\n\n        if (comp.onDestroy && (comp._objFlags & IsOnLoadCalled)) {\n            if (legacyCC.GAME_VIEW || comp.constructor._executeInEditMode) {\n                callOnDestroyInTryCatch && callOnDestroyInTryCatch(comp);\n            }\n        }\n    };\n\n    NodeActivator.prototype.resetComp = (comp, didResetToDefault: boolean) => {\n        if (comp.resetInEditor) {\n            try {\n                comp.resetInEditor(didResetToDefault);\n            } catch (e) {\n                legacyCC._throw(e);\n            }\n        }\n    };\n}\n","import { ccclass, serializable, editable, type } from 'cc.decorator';\nimport { EDITOR } from 'internal:constants';\nimport { legacyCC } from '../../global-exports';\nimport { Prefab } from '../../assets';\nimport { CCObject } from '../../data';\nimport { Component } from '../../components';\nimport { Node } from '../../scene-graph';\n\nfunction compareStringArray(array1: string[] | undefined, array2: string[] | undefined) {\n    if (!array1 || !array2) {\n        return false;\n    }\n\n    if (array1.length !== array2.length) {\n        return false;\n    }\n\n    return array1.every((value, index) => value === array2[index]);\n}\n\n@ccclass('cc.TargetInfo')\nexport class TargetInfo {\n    // 用于标识目标在prefab 资源中的ID，区别于UUID\n    @serializable\n    public localID: string[] = [];\n}\n@ccclass('cc.TargetOverrideInfo')\nexport class TargetOverrideInfo {\n    @serializable\n    @type(CCObject)\n    public source: Component | Node | null = null;\n    // if owner is in a prefab, use TargetInfo to index it\n    @serializable\n    @type(TargetInfo)\n    public sourceInfo: TargetInfo | null = null;\n    @serializable\n    public propertyPath: string[] = [];\n    @serializable\n    @type(Node)\n    public target: Node | null = null;\n    // if target is in a prefab, use TargetInfo to index it\n    @serializable\n    @type(TargetInfo)\n    public targetInfo: TargetInfo | null = null;\n}\n\n@ccclass('cc.CompPrefabInfo')\nexport class CompPrefabInfo {\n    // To identify current component in a prefab asset, so only needs to be unique.\n    @serializable\n    @editable\n    public fileId = '';\n}\n\n@ccclass('CCPropertyOverrideInfo')\nexport class PropertyOverrideInfo {\n    @serializable\n    @type(TargetInfo)\n    public targetInfo: TargetInfo | null = null;\n    @serializable\n    public propertyPath: string[] = [];\n    @serializable\n    public value: any;\n\n    // eslint-disable-next-line consistent-return\n    public isTarget(localID: string[], propPath: string[]) {\n        if (EDITOR) {\n            return compareStringArray(this.targetInfo?.localID, localID)\n                && compareStringArray(this.propertyPath, propPath);\n        }\n    }\n}\n\n@ccclass('cc.MountedChildrenInfo')\nexport class MountedChildrenInfo {\n    @serializable\n    @type(TargetInfo)\n    public targetInfo: TargetInfo | null = null;\n    @serializable\n    @type([Node])\n    public nodes: Node[] = [];\n\n    // eslint-disable-next-line consistent-return\n    public isTarget(localID: string[]) {\n        if (EDITOR) {\n            return compareStringArray(this.targetInfo?.localID, localID);\n        }\n    }\n}\n\n@ccclass('cc.MountedComponentsInfo')\nexport class MountedComponentsInfo {\n    @serializable\n    @type(TargetInfo)\n    public targetInfo: TargetInfo | null = null;\n    @serializable\n    @type([Component])\n    public components: Component[] = [];\n\n    // eslint-disable-next-line consistent-return\n    public isTarget(localID: string[]) {\n        if (EDITOR) {\n            return compareStringArray(this.targetInfo?.localID, localID);\n        }\n    }\n}\n\n/**\n * Prefab实例类\n * @internal\n */\n@ccclass('cc.PrefabInstance')\nexport class PrefabInstance {\n    // Identify current prefabInstance;\n    @serializable\n    public fileId = '';\n\n    // 记录PrefabInstance所属的Prefab的Root节点信息\n    @serializable\n    @type(Node)\n    public prefabRootNode?: Node;\n\n    // 实例化的Prefab中额外增加的子节点数据\n    @serializable\n    @type([MountedChildrenInfo])\n    public mountedChildren: MountedChildrenInfo[] = [];\n\n    // 实例化的Prefab中额外增加的Component数据\n    @serializable\n    @type([MountedComponentsInfo])\n    public mountedComponents: MountedComponentsInfo[] = [];\n\n    // 属性的覆盖数据\n    @serializable\n    @type([PropertyOverrideInfo])\n    public propertyOverrides: PropertyOverrideInfo[] = [];\n\n    @serializable\n    @type([TargetInfo])\n    public removedComponents: TargetInfo[] = [];\n\n    public targetMap: Record<string, any | Node | Component> = {};\n\n    /**\n     * make sure prefab instance expand only once\n     * @internal\n     */\n    public expanded = false;\n\n    // eslint-disable-next-line consistent-return\n    public findPropertyOverride(localID: string[], propPath: string[]) {\n        if (EDITOR) {\n            for (let i = 0; i < this.propertyOverrides.length; i++) {\n                const propertyOverride = this.propertyOverrides[i];\n                if (propertyOverride.isTarget(localID, propPath)) {\n                    return propertyOverride;\n                }\n            }\n            return null;\n        }\n    }\n\n    public removePropertyOverride(localID: string[], propPath: string[]) {\n        if (EDITOR) {\n            for (let i = 0; i < this.propertyOverrides.length; i++) {\n                const propertyOverride = this.propertyOverrides[i];\n                if (propertyOverride.isTarget(localID, propPath)) {\n                    this.propertyOverrides.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    }\n}\n\n@ccclass('cc.PrefabInfo')\nexport class PrefabInfo {\n    // the most top node of this prefab in the scene\n    @serializable\n    @type(Node)\n    public root?: Node;\n\n    // 所属的 prefab 资源对象 (cc.Prefab)\n    // In Editor, only asset._uuid is usable because asset will be changed.\n    @serializable\n    public asset?: Prefab;\n\n    // 用来标识别该节点在 prefab 资源中的位置，因此这个 ID 只需要保证在 Assets 里不重复就行\n    @serializable\n    @editable\n    public fileId = '';\n\n    // Instance of a prefabAsset\n    @serializable\n    @type(PrefabInstance)\n    public instance?: PrefabInstance;\n\n    @serializable\n    @type([TargetOverrideInfo])\n    public targetOverrides?: TargetOverrideInfo[];\n\n    // record outMost prefabInstance nodes in descendants\n    // collected when saving sceneAsset or prefabAsset\n    @serializable\n    public nestedPrefabInstanceRoots?: Node[];\n}\n\nlegacyCC._PrefabInfo = PrefabInfo;\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, serializable, editable } from 'cc.decorator';\nimport { SUPPORT_JIT, ALIPAY, RUNTIME_BASED } from 'internal:constants';\nimport { compile } from '../data/instantiate-jit';\nimport { js, obsolete } from '../utils/js';\nimport { Enum } from '../value-types';\nimport { Asset } from './asset';\nimport { Node } from '../scene-graph/node';\nimport { legacyCC } from '../global-exports';\nimport { warnID } from '../platform/debug';\nimport * as utils from '../utils/prefab';\n\n/**\n * @en An enumeration used with the [[Prefab.optimizationPolicy]] to specify how to optimize the instantiate operation.\n * @zh Prefab 创建实例所用的优化策略，配合 [[Prefab.optimizationPolicy]] 使用。\n */\nconst OptimizationPolicy = Enum({\n    /**\n     * @en The optimization policy is automatically chosen based on the number of instantiations.\n     * When you first create an instance, the behavior is the same as SINGLE_INSTANCE.\n     * MULTI_INSTANCE will be automatically used after multiple creation.\n     * @zh 根据创建次数自动调整优化策略。初次创建实例时，行为等同 SINGLE_INSTANCE，多次创建后将自动采用 MULTI_INSTANCE。\n     */\n    AUTO: 0,\n    /**\n     * @en Optimize for single instance creation.<br>\n     * This option skips code generation for this prefab.\n     * When this prefab will usually create only one instances, please select this option.\n     * @zh 优化单次创建性能。<br>\n     * 该选项会跳过针对这个 prefab 的代码生成优化操作。当该 prefab 加载后，一般只会创建一个实例时，请选择此项。\n     */\n    SINGLE_INSTANCE: 1,\n    /**\n     * @en Optimize for creating instances multiple times.<br>\n     * This option enables code generation for this prefab.\n     * When this prefab will usually create multiple instances, please select this option.\n     * It is also recommended to select this option if the prefab instance in the scene\n     * has Auto Sync enabled and there are multiple instances in the scene.\n     * @zh 优化多次创建性能。<br>\n     * 该选项会启用针对这个 prefab 的代码生成优化操作。当该 prefab 加载后，一般会创建多个实例时，请选择此项。如果该 prefab 在场景中的节点启用了自动关联，并且在场景中有多份实例，也建议选择此项。\n     */\n    MULTI_INSTANCE: 2,\n});\n\n/**\n * @en Class for prefab handling.\n * @zh 预制资源类。\n */\n@ccclass('cc.Prefab')\nexport class Prefab extends Asset {\n    /**\n     * @en Enumeration for optimization policy\n     * @zh Prefab 创建实例所用的优化策略枚举类型\n     */\n    public static OptimizationPolicy = OptimizationPolicy;\n\n    public static OptimizationPolicyThreshold = 3;\n\n    /**\n     * @en The main [[Node]] in the prefab\n     * @zh Prefab 中的根节点，[[Node]] 类型\n     */\n    @serializable\n    @editable\n    public data: any = null;\n\n    /**\n     * @zh\n     * 设置实例化这个 prefab 时所用的优化策略。根据使用情况设置为合适的值，能优化该 prefab 实例化所用的时间。推荐在编辑器的资源中设置。\n     * @en\n     * Indicates the optimization policy for instantiating this prefab.\n     * Set to a suitable value based on usage, can optimize the time it takes to instantiate this prefab.\n     * Suggest to set this policy in the editor's asset inspector.\n     * @default Prefab.OptimizationPolicy.AUTO\n     * @example\n     * ```ts\n     * import { Prefab } from 'cc';\n     * prefab.optimizationPolicy = Prefab.OptimizationPolicy.MULTI_INSTANCE;\n     * ```\n     */\n    @serializable\n    @editable\n    public optimizationPolicy = OptimizationPolicy.AUTO;\n\n    @serializable\n    @editable\n    public persistent = false;\n\n    // Cache function to optimize instance creation.\n    private _createFunction: ((...arg: any[]) => Node) | null;\n    private _instantiatedTimes: number;\n    constructor () {\n        super();\n        this._createFunction = null;\n\n        this._instantiatedTimes = 0;\n    }\n\n    public createNode (cb: (err: Error | null, node: Node) => void): void {\n        const node = legacyCC.instantiate(this);\n        node.name = this.name;\n        cb(null, node);\n    }\n\n    /**\n     * @en\n     * Dynamically translation prefab data into minimized code.<br/>\n     * This method will be called automatically before the first time the prefab being instantiated,<br/>\n     * but you can re-call to refresh the create function once you modified the original prefab data in script.\n     * @zh\n     * 将预制数据动态转换为最小化代码。<br/>\n     * 此方法将在第一次实例化预制件之前自动调用，<br/>\n     * 但是您可以在脚本中修改原始预制数据后重新调用以刷新创建功能。\n     */\n    public compileCreateFunction (): void {\n        this._createFunction = compile(this.data);\n    }\n\n    // just instantiate, will not initialize the Node, this will be called during Node's initialization.\n    // @param {Node} [rootToRedirect] - specify an instantiated prefabRoot that all references to prefabRoot in prefab\n    //                                  will redirect to\n    private _doInstantiate (rootToRedirect?: any) {\n        if (!this.data._prefab) {\n            // temp guard code\n            warnID(3700);\n        }\n        if (!this._createFunction) {\n            this.compileCreateFunction();\n        }\n        return this._createFunction!(rootToRedirect);  // this.data._instantiate();\n    }\n\n    private _instantiate (): Node {\n        let node: Node;\n        let useJit = false;\n        if (SUPPORT_JIT) {\n            if (this.optimizationPolicy === OptimizationPolicy.SINGLE_INSTANCE) {\n                useJit = false;\n            } else if (this.optimizationPolicy === OptimizationPolicy.MULTI_INSTANCE) {\n                useJit = true;\n            } else {\n                // auto\n                useJit = (this._instantiatedTimes + 1) >= Prefab.OptimizationPolicyThreshold;\n            }\n        }\n        if (useJit) {\n            // instantiate node\n            node = this._doInstantiate();\n            // initialize node\n            this.data._instantiate(node);\n        } else {\n            // instantiate node\n            node = this.data._instantiate();\n        }\n        ++this._instantiatedTimes;\n\n        return node;\n    }\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        this.data = new Node();\n        this.data.name = '(Missing Node)';\n        const prefabInfo = new legacyCC._PrefabInfo();\n        prefabInfo.asset = this;\n        prefabInfo.root = this.data;\n        this.data._prefab = prefabInfo;\n    }\n\n    public validate () {\n        return !!this.data;\n    }\n\n    public onLoaded () {\n        const rootNode = this.data as Node;\n        utils.expandNestedPrefabInstanceNode(rootNode);\n        utils.applyTargetOverrides(rootNode);\n    }\n}\n\nexport declare namespace Prefab {\n    export { utils as _utils };\n}\n\njs.value(Prefab, '_utils', utils);\n\nlegacyCC.Prefab = Prefab;\nif (ALIPAY || RUNTIME_BASED) {\n    legacyCC._Prefab = Prefab;\n} else {\n    obsolete(legacyCC, 'cc._Prefab', 'Prefab');\n}\n","import { ccclass, serializable, type, visible } from '../data/decorators';\nimport { Component } from '../components/component';\nimport { Prefab } from '../assets/prefab';\n\n/**\n * @en\n * Since the new Prefab system is not yet complete, the prefab that has a large difference with prefab asset cannot be automatically migrated.\n * This component is used to save the relationship between the node with the referenced prefab asset in the old Prefab system.\n * When the new Prefab system is complete, it will be automatically migrated to the new Prefab system.\n *\n * @zh\n * PrefabLink\n * 由于新的 Prefab 系统还不完善，所以旧的 Prefab 系统中和 Prefab 资源差异过大的 Prefab 无法实现自动迁移。\n * 此组件用于保存在旧 Prefab 系统中这个节点关联的 Prefab 资源，等新的 Prefab 系统完善，会自动迁移到新的 Prefab 系统上。\n */\n@ccclass('cc.PrefabLink')\nexport class PrefabLink extends Component {\n    @type(Prefab)\n    @serializable\n    @visible(true)\n    public prefab: Prefab | null = null;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Camera } from '../components/camera-component';\nimport { Vec3 } from '../math';\nimport { Node } from '../scene-graph';\nimport { replaceProperty } from './x-deprecated';\nimport { legacyCC } from '../global-exports';\n\nconst _vec3 = new Vec3();\n\n/**\n * @en\n * Conversion of non-UI nodes to UI Node (Local) Space coordinate system.\n * @zh\n * 非 UI 节点转换到 UI 节点(局部) 空间坐标系。\n * @deprecated since Cocos Creator 3D v1.2, please use [[Camera.convertToUINode]]\n * @param mainCamera @en The main camera @zh 主相机\n * @param wpos @en The world space location. @zh 世界空间位置。\n * @param uiNode @en The UI node. @zh UI 节点。\n * @param out @en The output local position in UI @zh 返回 UI 节点局部坐标。\n */\nexport function WorldNode3DToLocalNodeUI (mainCamera: Camera, wpos: Vec3, uiNode: Node, out?: Vec3) {\n    if (!out) {\n        out = new Vec3();\n    }\n\n    mainCamera.convertToUINode(wpos, uiNode, out);\n    const pos = uiNode.position;\n    out.add(pos);\n    return out;\n}\n\n/**\n * @en\n * Conversion of non-UI nodes to UI Node (World) Space coordinate system.\n * @zh\n * 非 UI 节点转换到 UI 节点(世界)空间坐标系。\n * @deprecated since Cocos Creator 3D v1.2, please use [[Camera.convertToUINode]]\n * @param mainCamera @en The main camera @zh 主相机\n * @param wpos @en The world space location. @zh 世界空间位置。\n * @param out @en The output world position in UI @zh 返回 UI 空间世界坐标。\n */\nexport function WorldNode3DToWorldNodeUI (mainCamera: Camera, wpos: Vec3, out?: Vec3) {\n    if (!out) {\n        out = new Vec3();\n    }\n\n    mainCamera.worldToScreen(wpos, out);\n    out.x /= legacyCC.view.getScaleX();\n    out.y /= legacyCC.view.getScaleY();\n    return out;\n}\n\n/**\n * @en It will be removed in v1.2. Please use [[Camera.convertToUINode]]。\n * @zh 将在 v1.2 移除，请使用 Camera 的 `convertToUINode`。\n * @deprecated since Cocos Creator 3D v1.2\n */\nconst convertUtils = {\n    WorldNode3DToLocalNodeUI,\n    WorldNode3DToWorldNodeUI,\n};\n\nexport { convertUtils };\nlegacyCC.pipelineUtils = convertUtils;\n\nreplaceProperty(legacyCC.pipelineUtils, 'cc.pipelineUtils', [\n    {\n        name: 'WorldNode3DToLocalNodeUI',\n        newName: 'convertToUINode',\n        targetName: 'cc.Camera.prototype',\n        customFunction (...args: any[]) {\n            const camera = args[0] as Camera;\n            const out = args[3] || _vec3;\n            camera.convertToUINode(args[1], args[2], out);\n            out.add(args[2].position);\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n            return args[3] || out.clone();\n        },\n    },\n]);\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR } from 'internal:constants';\nimport { intersect, Sphere } from '../geometry';\nimport { Model } from '../renderer/scene/model';\nimport { Camera, SKYBOX_FLAG } from '../renderer/scene/camera';\nimport { Vec3 } from '../math';\nimport { RenderPipeline } from './render-pipeline';\nimport { Pool } from '../memop';\nimport { IRenderObject, UBOShadow } from './define';\nimport { ShadowType, CSMOptimizationMode } from '../renderer/scene/shadows';\nimport { PipelineSceneData } from './pipeline-scene-data';\nimport { ShadowLayerVolume } from './shadow/csm-layers';\nimport { legacyCC } from '../global-exports';\n\nconst _tempVec3 = new Vec3();\nconst _sphere = Sphere.create(0, 0, 0, 1);\n\nconst roPool = new Pool<IRenderObject>(() => ({ model: null!, depth: 0 }), 128);\n\nfunction getRenderObject (model: Model, camera: Camera) {\n    let depth = 0;\n    if (model.node) {\n        Vec3.subtract(_tempVec3, model.node.worldPosition, camera.position);\n        depth = Vec3.dot(_tempVec3, camera.forward);\n    }\n    const ro = roPool.alloc();\n    ro.model = model;\n    ro.depth = depth;\n    return ro;\n}\n\nexport function validPunctualLightsCulling (pipeline: RenderPipeline, camera: Camera) {\n    const sceneData = pipeline.pipelineSceneData;\n    const validPunctualLights = sceneData.validPunctualLights;\n    validPunctualLights.length = 0;\n\n    const { spotLights } = camera.scene!;\n    for (let i = 0; i < spotLights.length; i++) {\n        const light = spotLights[i];\n        if (light.baked) {\n            continue;\n        }\n\n        Sphere.set(_sphere, light.position.x, light.position.y, light.position.z, light.range);\n        if (intersect.sphereFrustum(_sphere, camera.frustum)) {\n            validPunctualLights.push(light);\n        }\n    }\n\n    const { sphereLights } = camera.scene!;\n    for (let i = 0; i < sphereLights.length; i++) {\n        const light = sphereLights[i];\n        if (light.baked) {\n            continue;\n        }\n        Sphere.set(_sphere, light.position.x, light.position.y, light.position.z, light.range);\n        if (intersect.sphereFrustum(_sphere, camera.frustum)) {\n            validPunctualLights.push(light);\n        }\n    }\n}\nexport function shadowCulling (camera: Camera, sceneData: PipelineSceneData, layer: ShadowLayerVolume) {\n    const scene = camera.scene!;\n    const mainLight = scene.mainLight!;\n    const csmLayers = sceneData.csmLayers;\n    const csmLayerObjects = csmLayers.layerObjects;\n    const dirLightFrustum = layer.validFrustum;\n    const dirShadowObjects = layer.shadowObjects;\n    dirShadowObjects.length = 0;\n    const visibility = camera.visibility;\n\n    for (let i = csmLayerObjects.length - 1; i >= 0; i--) {\n        const csmLayerObject = csmLayerObjects.array[i];\n        if (csmLayerObject) {\n            const model = csmLayerObject.model;\n            // filter model by view visibility\n            if (model.enabled) {\n                if (model.node && ((visibility & model.node.layer) === model.node.layer)) {\n                    // shadow render Object\n                    if (dirShadowObjects != null && model.castShadow && model.worldBounds) {\n                        // frustum culling\n                        // eslint-disable-next-line no-lonely-if\n                        const accurate = intersect.aabbFrustum(model.worldBounds, dirLightFrustum);\n                        if (accurate) {\n                            dirShadowObjects.push(csmLayerObject);\n                            if (layer.level < mainLight.csmLevel) {\n                                if (mainLight.csmOptimizationMode === CSMOptimizationMode.RemoveDuplicates\n                                    && intersect.aabbFrustumCompletelyInside(model.worldBounds, dirLightFrustum)) {\n                                    csmLayerObjects.fastRemove(i);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function sceneCulling (pipeline: RenderPipeline, camera: Camera) {\n    const scene = camera.scene!;\n    const mainLight = scene.mainLight;\n    const sceneData = pipeline.pipelineSceneData;\n    const shadows = sceneData.shadows;\n    const skybox = sceneData.skybox;\n    const csmLayers = sceneData.csmLayers;\n\n    const renderObjects = sceneData.renderObjects;\n    roPool.freeArray(renderObjects); renderObjects.length = 0;\n\n    const castShadowObjects = csmLayers.castShadowObjects;\n    castShadowObjects.length = 0;\n    const csmLayerObjects = csmLayers.layerObjects;\n    csmLayerObjects.clear();\n\n    if (shadows.enabled) {\n        pipeline.pipelineUBO.updateShadowUBORange(UBOShadow.SHADOW_COLOR_OFFSET, shadows.shadowColor);\n        if (shadows.type === ShadowType.ShadowMap) {\n            // update CSM layers\n            if (mainLight && mainLight.node) {\n                csmLayers.update(sceneData, camera);\n            }\n        }\n    }\n\n    if ((camera.clearFlag & SKYBOX_FLAG)) {\n        if (skybox.enabled && skybox.model) {\n            renderObjects.push(getRenderObject(skybox.model, camera));\n        } else if (camera.clearFlag === SKYBOX_FLAG && !EDITOR) {\n            legacyCC.warnID(15100, camera.name);\n        }\n    }\n\n    const models = scene.models;\n    const visibility = camera.visibility;\n\n    for (let i = 0; i < models.length; i++) {\n        const model = models[i];\n\n        // filter model by view visibility\n        if (model.enabled) {\n            if (model.castShadow) {\n                castShadowObjects.push(getRenderObject(model, camera));\n                csmLayerObjects.push(getRenderObject(model, camera));\n            }\n\n            if (model.node && ((visibility & model.node.layer) === model.node.layer)\n                 || (visibility & model.visFlags)) {\n                // frustum culling\n                if (model.worldBounds && !intersect.aabbFrustum(model.worldBounds, camera.frustum)) {\n                    continue;\n                }\n\n                renderObjects.push(getRenderObject(model, camera));\n            }\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Device, BufferUsageBit, MemoryUsageBit, BufferInfo, Filter, Address, Sampler, DescriptorSet,\n    DescriptorSetInfo, Buffer, Texture, DescriptorSetLayoutInfo, DescriptorSetLayout, SamplerInfo } from '../gfx';\nimport { Light } from '../renderer/scene';\nimport { UBOShadow, globalDescriptorSetLayout, PipelineGlobalBindings } from './define';\n\nconst _samplerLinearInfo = new SamplerInfo(\n    Filter.LINEAR,\n    Filter.LINEAR,\n    Filter.NONE,\n    Address.CLAMP,\n    Address.CLAMP,\n    Address.CLAMP,\n);\n\nconst _samplerPointInfo = new SamplerInfo(\n    Filter.POINT,\n    Filter.POINT,\n    Filter.NONE,\n    Address.CLAMP,\n    Address.CLAMP,\n    Address.CLAMP,\n);\n\nexport class GlobalDSManager {\n    private _device: Device;\n    private _descriptorSetMap: Map<Light, DescriptorSet> = new Map();\n    private _globalDescriptorSet: DescriptorSet;\n    private _descriptorSetLayout: DescriptorSetLayout;\n    private _linearSampler: Sampler;\n    private _pointSampler: Sampler;\n\n    get descriptorSetMap () {\n        return this._descriptorSetMap;\n    }\n\n    // TODO: Future extensions of PCSS require search depth to compute the penumbra, which requires linear sampling\n    get linearSampler () {\n        return this._linearSampler;\n    }\n\n    // TODO: For the use of hard and soft, point sampling is required\n    get pointSampler () {\n        return this._pointSampler;\n    }\n\n    get descriptorSetLayout () {\n        return this._descriptorSetLayout;\n    }\n\n    get globalDescriptorSet () {\n        return this._globalDescriptorSet;\n    }\n\n    constructor (device: Device) {\n        this._device = device;\n\n        this._linearSampler = this._device.getSampler(_samplerLinearInfo);\n        this._pointSampler = this._device.getSampler(_samplerPointInfo);\n\n        const layoutInfo = new DescriptorSetLayoutInfo(globalDescriptorSetLayout.bindings);\n        this._descriptorSetLayout = this._device.createDescriptorSetLayout(layoutInfo);\n\n        this._globalDescriptorSet = this._device.createDescriptorSet(new DescriptorSetInfo(this._descriptorSetLayout));\n    }\n\n    regenLayout () {\n        const layoutInfo = new DescriptorSetLayoutInfo(globalDescriptorSetLayout.bindings);\n        this._descriptorSetLayout = this._device.createDescriptorSetLayout(layoutInfo);\n\n        this._globalDescriptorSet = this._device.createDescriptorSet(new DescriptorSetInfo(this._descriptorSetLayout));\n    }\n\n    /**\n     * @en Bind buffer for all descriptorSets, so that all created descriptorSet buffer are consistent\n     * @zh 为所有的 descriptorSet 绑定 buffer，使得所有已创建的 descriptorSet buffer 保持一致\n     * @param binding The target binding.\n     * @param buffer The buffer to be bound.\n     */\n    public bindBuffer (binding: number, buffer: Buffer) {\n        this._globalDescriptorSet.bindBuffer(binding, buffer);\n        const it = this._descriptorSetMap.values();\n        let res = it.next();\n        while (!res.done) {\n            const descriptorSet = res.value;\n            descriptorSet.bindBuffer(binding, buffer);\n            res = it.next();\n        }\n    }\n\n    /**\n     * @en Bind sampler for all descriptorSets, so that all created descriptorSet sampler are consistent\n     * @zh 为所有的 descriptorSet 绑定 sampler，使得所有已创建的 descriptorSet sampler 保持一致\n     * @param binding The target binding.\n     * @param sampler The sampler to be bound.\n     */\n    public bindSampler (binding: number, sampler: Sampler) {\n        this._globalDescriptorSet.bindSampler(binding, sampler);\n        const it = this._descriptorSetMap.values();\n        let res = it.next();\n        while (!res.done) {\n            const descriptorSet = res.value;\n            descriptorSet.bindSampler(binding, sampler);\n            res = it.next();\n        }\n    }\n\n    /**\n     * @en Bind texture for all descriptorSets, so that all created descriptorSet texture are consistent\n     * @zh 为所有的 descriptorSet 绑定 texture，使得所有已创建的 descriptorSet texture 保持一致\n     * @param binding The target binding.\n     * @param texture The texture to be bound.\n     */\n    public bindTexture (binding: number, texture: Texture) {\n        this._globalDescriptorSet.bindTexture(binding, texture);\n        const it = this._descriptorSetMap.values();\n        let res = it.next();\n        while (!res.done) {\n            const descriptorSet = res.value;\n            descriptorSet.bindTexture(binding, texture);\n            res = it.next();\n        }\n    }\n\n    /**\n     * @en Update all descriptorSet\n     * @zh 更新所有的 descriptorSet\n     */\n    public update () {\n        this._globalDescriptorSet.update();\n        const it = this._descriptorSetMap.values();\n        let res = it.next();\n        while (!res.done) {\n            const descriptorSet = res.value;\n            descriptorSet.update();\n            res = it.next();\n        }\n    }\n\n    /**\n     * @en The layout of all created descriptorSets in buffer, sampler, and texture (except shadow) is consistent with the globalDescriptorSet\n     * @zh 所有创建出来的 descriptorSet 在 buffer、 sampler、 texture（shadow 除外）的布局与 globalDescriptorSet 保持一致\n     * @param idx Specify index creation\n     * @return descriptorSet\n     */\n    public getOrCreateDescriptorSet (light: Light) {\n        const device = this._device;\n\n        // The global descriptorSet is managed by the pipeline and binds the buffer\n        if (!this._descriptorSetMap.has(light)) {\n            const globalDescriptorSet = this._globalDescriptorSet;\n            const descriptorSet = device.createDescriptorSet(new DescriptorSetInfo(this._descriptorSetLayout));\n            this._descriptorSetMap.set(light, descriptorSet);\n\n            // Create & Sync ALL UBO Buffer, Texture, Sampler\n            for (let i = PipelineGlobalBindings.UBO_GLOBAL; i < PipelineGlobalBindings.COUNT; i++) {\n                descriptorSet.bindBuffer(i, globalDescriptorSet.getBuffer(i));\n                descriptorSet.bindSampler(i, globalDescriptorSet.getSampler(i));\n                descriptorSet.bindTexture(i, globalDescriptorSet.getTexture(i));\n            }\n\n            const shadowUBO = device.createBuffer(new BufferInfo(\n                BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n                MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n                UBOShadow.SIZE,\n                UBOShadow.SIZE,\n            ));\n            descriptorSet.bindBuffer(UBOShadow.BINDING, shadowUBO);\n\n            descriptorSet.update();\n        }\n\n        return this._descriptorSetMap.get(light);\n    }\n\n    public destroy () {\n        this._descriptorSetLayout.destroy();\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3 } from '../../math';\nimport { TransformBit } from '../../scene-graph/node-enum';\nimport { RenderScene } from '../core/render-scene';\nimport { Node } from '../../scene-graph';\n\n// Color temperature (in Kelvin) to RGB\nexport function ColorTemperatureToRGB (rgb: Vec3, kelvin: number) {\n    if (kelvin < 1000.0) {\n        kelvin = 1000.0;\n    } else if (kelvin > 15000.0) {\n        kelvin = 15000.0;\n    }\n\n    // Approximate Planckian locus in CIE 1960 UCS\n    const kSqr = kelvin * kelvin;\n    const u = (0.860117757 + 1.54118254e-4 * kelvin + 1.28641212e-7 * kSqr) / (1.0 + 8.42420235e-4 * kelvin + 7.08145163e-7 * kSqr);\n    const v = (0.317398726 + 4.22806245e-5 * kelvin + 4.20481691e-8 * kSqr) / (1.0 - 2.89741816e-5 * kelvin + 1.61456053e-7 * kSqr);\n\n    const d = (2.0 * u - 8.0 * v + 4.0);\n    const x = (3.0 * u) / d;\n    const y = (2.0 * v) / d;\n    const z = (1.0 - x) - y;\n\n    const X = (1.0 / y) * x;\n    const Z = (1.0 / y) * z;\n\n    // XYZ to RGB with BT.709 primaries\n    rgb.x =  3.2404542 * X + -1.5371385 + -0.4985314 * Z;\n    rgb.y = -0.9692660 * X +  1.8760108 +  0.0415560 * Z;\n    rgb.z =  0.0556434 * X + -0.2040259 +  1.0572252 * Z;\n}\n\n/**\n * @en The light type enumeration.\n * @zh 光源类型枚举。\n */\nexport enum LightType {\n    DIRECTIONAL,\n    SPHERE,\n    SPOT,\n    UNKNOWN,\n}\n\nexport const nt2lm = (size: number) => 4 * Math.PI * Math.PI * size * size;\n\n/**\n * @en The abstract light class of the render scene\n * @zh 渲染场景中的光源基类\n */\nexport class Light {\n    /**\n     * @en Whether it's a baked light source, baked light will be ignored in real time lighting pass\n     * @zh 是否是烘焙光源，烘焙光源会在实时光照计算中被忽略\n     */\n    get baked () {\n        return this._baked;\n    }\n\n    set baked (val) {\n        this._baked = val;\n    }\n\n    /**\n     * @en The color of the light\n     * @zh 光源的颜色\n     */\n    set color (color: Vec3) {\n        this._color.set(color);\n    }\n\n    get color (): Vec3 {\n        return this._color;\n    }\n\n    /**\n     * @en Whether to use color temperature\n     * @zh 是否使用光源的色温\n     */\n    set useColorTemperature (enable: boolean) {\n        this._useColorTemperature = enable;\n    }\n\n    get useColorTemperature (): boolean {\n        return this._useColorTemperature;\n    }\n\n    /**\n     * @en The color temperature of the light\n     * @zh 光源的色温\n     */\n    set colorTemperature (val: number) {\n        this._colorTemp = val;\n        ColorTemperatureToRGB(this._colorTempRGB, this._colorTemp);\n    }\n\n    get colorTemperature (): number {\n        return this._colorTemp;\n    }\n\n    /**\n     * @en The float RGB value of the color temperature, each channel is from 0 to 1\n     * @zh 色温的浮点数颜色值，每个通道都是从 0 到 1\n     */\n    get colorTemperatureRGB (): Vec3 {\n        return this._colorTempRGB;\n    }\n\n    set node (n) {\n        this._node = n;\n        if (this._node) {\n            this._node.hasChangedFlags |= TransformBit.ROTATION;\n        }\n    }\n\n    /**\n     * @en The node which owns the light source\n     * @zh 光源归属的节点\n     */\n    get node () {\n        return this._node;\n    }\n\n    /**\n     * @en The type of the light source, e.g. directional light, spot light, etc\n     * @zh 光源的类型，比如方向光、聚光灯等\n     */\n    get type () : LightType {\n        return this._type;\n    }\n\n    /**\n     * @en The name of the light source\n     * @zh 光源的名字\n     */\n    get name () {\n        return this._name;\n    }\n\n    set name (n) {\n        this._name = n;\n    }\n\n    /**\n     * @en The render scene which owns the current light\n     * @zh 光源所属的渲染场景\n     */\n    get scene () {\n        return this._scene;\n    }\n\n    protected _baked = false;\n\n    protected _color: Vec3 = new Vec3(1, 1, 1);\n\n    protected _colorTemp = 6550.0;\n\n    protected _colorTempRGB: Vec3 = new Vec3(1, 1, 1);\n\n    protected _scene: RenderScene | null = null;\n\n    protected _node: Node | null = null;\n\n    protected _name: string | null = null;\n\n    protected _useColorTemperature = false;\n\n    protected _type: LightType = LightType.UNKNOWN;\n\n    public initialize () {\n        this.color = new Vec3(1, 1, 1);\n        this.colorTemperature = 6550.0;\n    }\n\n    /**\n     * @en Attach the light to a render scene\n     * @zh 将光源挂载到渲染场景上\n     * @param scene @en The render scene @zh 渲染场景\n     */\n    public attachToScene (scene: RenderScene) {\n        this._scene = scene;\n    }\n\n    /**\n     * @en Detach the light from the render scene\n     * @zh 将光源从渲染场景上移除\n     */\n    public detachFromScene () {\n        this._scene = null;\n    }\n\n    public destroy () {\n        this._name = null;\n        this._node = null;\n    }\n\n    public update () {}\n}\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { JSB } from 'internal:constants';\nimport { legacyCC } from '../global-exports';\nimport { Root } from '../root';\nimport { Enum } from '../value-types';\nimport { director } from '..';\n\nconst enum RenderingDebugViewType {\n    NONE,\n    SINGLE,\n    COMPOSITE_AND_MISC,\n}\n\n/**\n * @zh\n * 渲染单项调试模式\n * @en\n * Rendering single debug mode\n * @readonly\n */\nexport const enum DebugViewSingleType {\n    NONE,\n    VERTEX_COLOR,\n    VERTEX_NORMAL,\n    VERTEX_TANGENT,\n    WORLD_POS,\n    VERTEX_MIRROR,\n    FACE_SIDE,\n    UV0,\n    UV1,\n    UV_LIGHTMAP,\n    PROJ_DEPTH,\n    LINEAR_DEPTH,\n\n    FRAGMENT_NORMAL,\n    FRAGMENT_TANGENT,\n    FRAGMENT_BINORMAL,\n    BASE_COLOR,\n    DIFFUSE_COLOR,\n    SPECULAR_COLOR,\n    TRANSPARENCY,\n    METALLIC,\n    ROUGHNESS,\n    SPECULAR_INTENSITY,\n\n    DIRECT_DIFFUSE,\n    DIRECT_SPECULAR,\n    DIRECT_ALL,\n    ENV_DIFFUSE,\n    ENV_SPECULAR,\n    ENV_ALL,\n    EMISSIVE,\n    LIGHT_MAP,\n    SHADOW,\n    AO,\n\n    FOG,\n}\n\n/**\n * @zh\n * 渲染组合调试模式\n * @en\n * Rendering composite debug mode\n * @readonly\n */\nexport const enum DebugViewCompositeType {\n    DIRECT_DIFFUSE = 0,\n    DIRECT_SPECULAR,\n    ENV_DIFFUSE,\n    ENV_SPECULAR,\n    EMISSIVE,\n    LIGHT_MAP,\n    SHADOW,\n    AO,\n\n    NORMAL_MAP,\n    FOG,\n\n    TONE_MAPPING,\n    GAMMA_CORRECTION,\n    MAX_BIT_COUNT\n}\n\n/**\n * @en Rendering debug view control class\n * @zh 渲染调试控制类\n */\nexport class DebugView {\n    /**\n     * @en Toggle rendering single debug mode.\n     * @zh 设置渲染单项调试模式。\n     */\n    public get singleMode () : DebugViewSingleType {\n        return this._singleMode;\n    }\n    public set singleMode (val : DebugViewSingleType) {\n        this._singleMode = val;\n        this._updatePipeline();\n\n        if (JSB && this._nativeConfig) {\n            this._nativeConfig.singleMode = this._singleMode;\n        }\n    }\n\n    /**\n     * @en Toggle normal / pure lighting mode.\n     * @zh 切换正常光照和仅光照模式。\n     */\n    public get lightingWithAlbedo () : boolean {\n        return this._lightingWithAlbedo;\n    }\n    public set lightingWithAlbedo (val : boolean) {\n        this._lightingWithAlbedo = val;\n        this._updatePipeline();\n\n        if (JSB && this._nativeConfig) {\n            this._nativeConfig.lightingWithAlbedo = this._lightingWithAlbedo;\n        }\n    }\n\n    /**\n     * @en Toggle CSM layer coloration mode.\n     * @zh 切换级联阴影染色调试模式。\n     */\n    public get csmLayerColoration () : boolean {\n        return this._csmLayerColoration;\n    }\n    public set csmLayerColoration (val : boolean) {\n        this._csmLayerColoration = val;\n        this._updatePipeline();\n\n        if (JSB && this._nativeConfig) {\n            this._nativeConfig.csmLayerColoration = this._csmLayerColoration;\n        }\n    }\n\n    protected _singleMode = DebugViewSingleType.NONE;\n    protected _compositeModeValue = 0;\n    protected _lightingWithAlbedo = true;\n    protected _csmLayerColoration = false;\n    protected _nativeConfig: any = null;\n\n    constructor () {\n        this._activate();\n        if (JSB && this._nativeConfig === null) {\n            // @ts-expect-error jsb object access\n            this._nativeConfig = new jsb.DebugViewConfig();\n            this._nativeConfig.compositeModeBitCount = DebugViewCompositeType.MAX_BIT_COUNT;\n        }\n    }\n\n    /**\n     * @en Whether enabled with specified rendering composite debug mode.\n     * @zh 获取指定的渲染组合调试模式是否开启。\n     * @param Specified composite type.\n     */\n    public isCompositeModeEnabled (val : number) : boolean {\n        const mode = this._compositeModeValue & (1 << val);\n        return mode !== 0;\n    }\n    /**\n     * @en Toggle specified rendering composite debug mode.\n     * @zh 开关指定的渲染组合调试模式。\n     * @param Specified composite type, enable or disable.\n     */\n    public enableCompositeMode (val: DebugViewCompositeType, enable: boolean) {\n        this._enableCompositeMode(val, enable);\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Toggle all rendering composite debug mode.\n     * @zh 开关所有的渲染组合调试模式。\n     */\n    public enableAllCompositeMode (enable: boolean) {\n        this._enableAllCompositeMode(enable);\n        this._updatePipeline();\n    }\n\n    /**\n     * @en Get rendering debug view on / off state.\n     * @zh 查询当前是否开启了渲染调试模式。\n     */\n    public isEnabled () {\n        return this._getType() !== RenderingDebugViewType.NONE;\n    }\n\n    /**\n     * @en Disable all debug view modes, reset to standard rendering mode.\n     * @zh 关闭所有的渲染调试模式，恢复到正常渲染。\n     */\n    public reset () {\n        this._activate();\n        this._updatePipeline();\n    }\n\n    /**\n     * @internal\n     */\n    protected _activate () {\n        this._singleMode = DebugViewSingleType.NONE;\n        this._enableAllCompositeMode(true);\n        this._lightingWithAlbedo = true;\n        this._csmLayerColoration = false;\n\n        if (JSB && this._nativeConfig) {\n            this._nativeConfig.singleMode = this._singleMode;\n            this._nativeConfig.compositeModeValue = this._compositeModeValue;\n            this._nativeConfig.lightingWithAlbedo = this._lightingWithAlbedo;\n            this._nativeConfig.csmLayerColoration = this._csmLayerColoration;\n        }\n    }\n\n    protected _updatePipeline () {\n        const root = legacyCC.director.root as Root;\n        const pipeline = root.pipeline;\n\n        const useDebugView = this._getType();\n\n        if (pipeline.macros.CC_USE_DEBUG_VIEW !== useDebugView) {\n            pipeline.macros.CC_USE_DEBUG_VIEW = useDebugView;\n            root.onGlobalPipelineStateChanged();\n        }\n    }\n\n    private _enableCompositeMode (val: DebugViewCompositeType, enable: boolean) {\n        if (enable) {\n            this._compositeModeValue |= (1 << val);\n        } else {\n            this._compositeModeValue &= (~(1 << val));\n        }\n\n        if (JSB && this._nativeConfig) {\n            this._nativeConfig.compositeModeValue = this._compositeModeValue;\n        }\n    }\n\n    private _enableAllCompositeMode (enable: boolean) {\n        for (let i = 0; i < DebugViewCompositeType.MAX_BIT_COUNT; i++) {\n            if (enable) {\n                this._compositeModeValue |= (1 << i);\n            } else {\n                this._compositeModeValue &= (~(1 << i));\n            }\n\n            if (JSB && this._nativeConfig) {\n                this._nativeConfig.compositeModeValue = this._compositeModeValue;\n            }\n        }\n    }\n\n    private _getType () : RenderingDebugViewType {\n        if (this._singleMode !== DebugViewSingleType.NONE) {\n            return RenderingDebugViewType.SINGLE;\n        } else if (this._lightingWithAlbedo !== true || this._csmLayerColoration !== false) {\n            return RenderingDebugViewType.COMPOSITE_AND_MISC;\n        } else {\n            for (let i = 0; i < DebugViewCompositeType.MAX_BIT_COUNT; i++) {\n                if (!this.isCompositeModeEnabled(i)) {\n                    return RenderingDebugViewType.COMPOSITE_AND_MISC;\n                }\n            }\n        }\n        return RenderingDebugViewType.NONE;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { UBOGlobal, UBOShadow, UBOCamera, UNIFORM_SHADOWMAP_BINDING,\n    supportsR32FloatTexture, UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, UBOCSM } from './define';\nimport { Device, BufferInfo, BufferUsageBit, MemoryUsageBit, DescriptorSet } from '../gfx';\nimport { Camera } from '../renderer/scene/camera';\nimport { Mat4, Vec3, Vec4, Color, toRadian } from '../math';\nimport { PipelineRuntime } from './custom/pipeline';\nimport { legacyCC } from '../global-exports';\nimport { CSMLevel, PCFType, Shadows, ShadowType } from '../renderer/scene/shadows';\nimport { Light, LightType } from '../renderer/scene/light';\nimport { DirectionalLight, SpotLight } from '../renderer/scene';\nimport { RenderWindow } from '../renderer/core/render-window';\nimport { builtinResMgr } from '../builtin/builtin-res-mgr';\nimport { Texture2D } from '../assets';\nimport { DebugViewCompositeType } from './debug-view';\n\nconst _matShadowView = new Mat4();\nconst _matShadowProj = new Mat4();\nconst _matShadowViewProj = new Mat4();\nconst _vec4ShadowInfo = new Vec4();\nconst _lightDir = new Vec4(0.0, 0.0, 1.0, 0.0);\nconst _tempVec3 = new Vec3();\n\nexport class PipelineUBO {\n    public static updateGlobalUBOView (window: RenderWindow, bufferView: Float32Array) {\n        const director = legacyCC.director;\n        const root = director.root;\n        const fv = bufferView;\n\n        const shadingWidth = Math.floor(window.width);\n        const shadingHeight = Math.floor(window.height);\n\n        // update UBOGlobal\n        fv[UBOGlobal.TIME_OFFSET] = root.cumulativeTime;\n        fv[UBOGlobal.TIME_OFFSET + 1] = root.frameTime;\n        fv[UBOGlobal.TIME_OFFSET + 2] = director.getTotalFrames();\n\n        fv[UBOGlobal.SCREEN_SIZE_OFFSET] = shadingWidth;\n        fv[UBOGlobal.SCREEN_SIZE_OFFSET + 1] = shadingHeight;\n        fv[UBOGlobal.SCREEN_SIZE_OFFSET + 2] = 1.0 / shadingWidth;\n        fv[UBOGlobal.SCREEN_SIZE_OFFSET + 3] = 1.0 / shadingHeight;\n\n        fv[UBOGlobal.NATIVE_SIZE_OFFSET] = shadingWidth;\n        fv[UBOGlobal.NATIVE_SIZE_OFFSET + 1] = shadingHeight;\n        fv[UBOGlobal.NATIVE_SIZE_OFFSET + 2] = 1.0 / fv[UBOGlobal.NATIVE_SIZE_OFFSET];\n        fv[UBOGlobal.NATIVE_SIZE_OFFSET + 3] = 1.0 / fv[UBOGlobal.NATIVE_SIZE_OFFSET + 1];\n\n        const debugView = root.debugView;\n        if (debugView) {\n            fv[UBOGlobal.DEBUG_VIEW_MODE_OFFSET] = debugView.singleMode as number;\n            fv[UBOGlobal.DEBUG_VIEW_MODE_OFFSET + 1] = debugView.lightingWithAlbedo ? 1.0 : 0.0;\n            fv[UBOGlobal.DEBUG_VIEW_MODE_OFFSET + 2] = debugView.csmLayerColoration ? 1.0 : 0.0;\n            for (let i = DebugViewCompositeType.DIRECT_DIFFUSE as number; i < DebugViewCompositeType.MAX_BIT_COUNT; i++) {\n                fv[UBOGlobal.DEBUG_VIEW_COMPOSITE_PACK_1_OFFSET + i] = debugView.isCompositeModeEnabled(i) ? 1.0 : 0.0;\n            }\n        } else {\n            fv[UBOGlobal.DEBUG_VIEW_MODE_OFFSET] = 0.0;\n            fv[UBOGlobal.DEBUG_VIEW_MODE_OFFSET + 1] = 1.0;\n            fv[UBOGlobal.DEBUG_VIEW_MODE_OFFSET + 2] = 0.0;\n            for (let i = DebugViewCompositeType.DIRECT_DIFFUSE as number; i < DebugViewCompositeType.MAX_BIT_COUNT; i++) {\n                fv[UBOGlobal.DEBUG_VIEW_COMPOSITE_PACK_1_OFFSET + i] = 1.0;\n            }\n        }\n    }\n\n    public static updateCameraUBOView (pipeline: PipelineRuntime, bufferView: Float32Array,\n        camera: Camera) {\n        const scene = camera.scene ? camera.scene : legacyCC.director.getScene().renderScene;\n        const mainLight = scene.mainLight;\n        const sceneData = pipeline.pipelineSceneData;\n        const ambient = sceneData.ambient;\n        const skybox = sceneData.skybox;\n        const fog = sceneData.fog;\n        const shadowInfo = sceneData.shadows;\n        const cv = bufferView;\n        const exposure = camera.exposure;\n        const isHDR = sceneData.isHDR;\n\n        // update camera ubo\n        cv[UBOCamera.SCREEN_SCALE_OFFSET] = sceneData.shadingScale;\n        cv[UBOCamera.SCREEN_SCALE_OFFSET + 1] = sceneData.shadingScale;\n        cv[UBOCamera.SCREEN_SCALE_OFFSET + 2] = 1.0 / cv[UBOCamera.SCREEN_SCALE_OFFSET];\n        cv[UBOCamera.SCREEN_SCALE_OFFSET + 3] = 1.0 / cv[UBOCamera.SCREEN_SCALE_OFFSET + 1];\n\n        cv[UBOCamera.EXPOSURE_OFFSET] = exposure;\n        cv[UBOCamera.EXPOSURE_OFFSET + 1] = 1.0 / exposure;\n        cv[UBOCamera.EXPOSURE_OFFSET + 2] = isHDR ? 1.0 : 0.0;\n        cv[UBOCamera.EXPOSURE_OFFSET + 3] = 1.0 / Camera.standardExposureValue;\n\n        if (mainLight) {\n            const shadowEnable = (mainLight.shadowEnabled && shadowInfo.type === ShadowType.ShadowMap) ? 1.0 : 0.0;\n            const mainLightDir = mainLight.direction;\n            _lightDir.set(mainLightDir.x, mainLightDir.y, mainLightDir.z, shadowEnable);\n            Vec4.toArray(cv, _lightDir, UBOCamera.MAIN_LIT_DIR_OFFSET);\n            Vec3.toArray(cv, mainLight.color, UBOCamera.MAIN_LIT_COLOR_OFFSET);\n            if (mainLight.useColorTemperature) {\n                const colorTempRGB = mainLight.colorTemperatureRGB;\n                cv[UBOCamera.MAIN_LIT_COLOR_OFFSET] *= colorTempRGB.x;\n                cv[UBOCamera.MAIN_LIT_COLOR_OFFSET + 1] *= colorTempRGB.y;\n                cv[UBOCamera.MAIN_LIT_COLOR_OFFSET + 2] *= colorTempRGB.z;\n            }\n\n            if (isHDR) {\n                cv[UBOCamera.MAIN_LIT_COLOR_OFFSET + 3] = mainLight.illuminance * exposure;\n            } else {\n                cv[UBOCamera.MAIN_LIT_COLOR_OFFSET + 3] = mainLight.illuminance;\n            }\n        } else {\n            _lightDir.set(0, 0, 1, 0);\n            Vec4.toArray(cv, _lightDir, UBOCamera.MAIN_LIT_DIR_OFFSET);\n            Vec4.toArray(cv, Vec4.ZERO, UBOCamera.MAIN_LIT_COLOR_OFFSET);\n        }\n\n        const skyColor = ambient.skyColor;\n        if (isHDR) {\n            skyColor.w = ambient.skyIllum * exposure;\n        } else {\n            skyColor.w = ambient.skyIllum;\n        }\n        cv[UBOCamera.AMBIENT_SKY_OFFSET + 0] = skyColor.x;\n        cv[UBOCamera.AMBIENT_SKY_OFFSET + 1] = skyColor.y;\n        cv[UBOCamera.AMBIENT_SKY_OFFSET + 2] = skyColor.z;\n        cv[UBOCamera.AMBIENT_SKY_OFFSET + 3] = skyColor.w;\n        cv[UBOCamera.AMBIENT_GROUND_OFFSET + 0] = ambient.groundAlbedo.x;\n        cv[UBOCamera.AMBIENT_GROUND_OFFSET + 1] = ambient.groundAlbedo.y;\n        cv[UBOCamera.AMBIENT_GROUND_OFFSET + 2] = ambient.groundAlbedo.z;\n        cv[UBOCamera.AMBIENT_GROUND_OFFSET + 3] = skybox.envmap ? skybox.envmap?.mipmapLevel : 1.0;\n\n        Mat4.toArray(cv, camera.matView, UBOCamera.MAT_VIEW_OFFSET);\n        Mat4.toArray(cv, camera.node.worldMatrix, UBOCamera.MAT_VIEW_INV_OFFSET);\n        Vec3.toArray(cv, camera.position, UBOCamera.CAMERA_POS_OFFSET);\n\n        Mat4.toArray(cv, camera.matProj, UBOCamera.MAT_PROJ_OFFSET);\n        Mat4.toArray(cv, camera.matProjInv, UBOCamera.MAT_PROJ_INV_OFFSET);\n        Mat4.toArray(cv, camera.matViewProj, UBOCamera.MAT_VIEW_PROJ_OFFSET);\n        Mat4.toArray(cv, camera.matViewProjInv, UBOCamera.MAT_VIEW_PROJ_INV_OFFSET);\n        cv[UBOCamera.CAMERA_POS_OFFSET + 3] = this.getCombineSignY();\n\n        cv[UBOCamera.SURFACE_TRANSFORM_OFFSET] = camera.surfaceTransform;\n        cv[UBOCamera.SURFACE_TRANSFORM_OFFSET + 2] = Math.cos(toRadian(sceneData.skybox.getRotationAngle()));\n        cv[UBOCamera.SURFACE_TRANSFORM_OFFSET + 3] = Math.sin(toRadian(sceneData.skybox.getRotationAngle()));\n\n        const colorTempRGB = fog.colorArray;\n        cv[UBOCamera.GLOBAL_FOG_COLOR_OFFSET] = colorTempRGB.x;\n        cv[UBOCamera.GLOBAL_FOG_COLOR_OFFSET + 1] = colorTempRGB.y;\n        cv[UBOCamera.GLOBAL_FOG_COLOR_OFFSET + 2] = colorTempRGB.z;\n        cv[UBOCamera.GLOBAL_FOG_COLOR_OFFSET + 3] = colorTempRGB.z;\n\n        cv[UBOCamera.GLOBAL_FOG_BASE_OFFSET] = fog.fogStart;\n        cv[UBOCamera.GLOBAL_FOG_BASE_OFFSET + 1] = fog.fogEnd;\n        cv[UBOCamera.GLOBAL_FOG_BASE_OFFSET + 2] = fog.fogDensity;\n\n        cv[UBOCamera.GLOBAL_FOG_ADD_OFFSET] = fog.fogTop;\n        cv[UBOCamera.GLOBAL_FOG_ADD_OFFSET + 1] = fog.fogRange;\n        cv[UBOCamera.GLOBAL_FOG_ADD_OFFSET + 2] = fog.fogAtten;\n\n        cv[UBOCamera.NEAR_FAR_OFFSET] = camera.nearClip;\n        cv[UBOCamera.NEAR_FAR_OFFSET + 1] = camera.farClip;\n\n        cv[UBOCamera.VIEW_PORT_OFFSET] = sceneData.shadingScale * camera.window.width * camera.viewport.x;\n        cv[UBOCamera.VIEW_PORT_OFFSET + 1] = sceneData.shadingScale * camera.window.height * camera.viewport.y;\n        cv[UBOCamera.VIEW_PORT_OFFSET + 2] = sceneData.shadingScale * camera.window.width * camera.viewport.z;\n        cv[UBOCamera.VIEW_PORT_OFFSET + 3] = sceneData.shadingScale * camera.window.height * camera.viewport.w;\n    }\n\n    public static getPCFRadius (shadowInfo: Shadows, mainLight: DirectionalLight): number {\n        const shadowMapSize = shadowInfo.size.x;\n        switch (mainLight.shadowPcf) {\n        case PCFType.HARD:\n            return 0.0;\n        case PCFType.SOFT:\n            return 1.0  / (shadowMapSize * 0.5);\n        case PCFType.SOFT_2X:\n            return 2.0  / (shadowMapSize * 0.5);\n        case PCFType.SOFT_4X:\n            return 3.0  / (shadowMapSize * 0.5);\n        default:\n        }\n        return 0.0;\n    }\n\n    public static updatePlanarNormalAndDistance (shadowInfo: Shadows, shadowUBO: Float32Array) {\n        Vec3.normalize(_tempVec3, shadowInfo.normal);\n        shadowUBO[UBOShadow.PLANAR_NORMAL_DISTANCE_INFO_OFFSET + 0] = _tempVec3.x;\n        shadowUBO[UBOShadow.PLANAR_NORMAL_DISTANCE_INFO_OFFSET + 1] = _tempVec3.y;\n        shadowUBO[UBOShadow.PLANAR_NORMAL_DISTANCE_INFO_OFFSET + 2] = _tempVec3.z;\n        shadowUBO[UBOShadow.PLANAR_NORMAL_DISTANCE_INFO_OFFSET + 3] = -shadowInfo.distance;\n    }\n\n    public static updateShadowUBOView (pipeline: PipelineRuntime, shadowBufferView: Float32Array,\n        csmBufferView: Float32Array, camera: Camera) {\n        const device = pipeline.device;\n        const mainLight = camera.scene!.mainLight;\n        const sceneData = pipeline.pipelineSceneData;\n        const shadowInfo = sceneData.shadows;\n        const csmLayers = sceneData.csmLayers;\n        const sv = shadowBufferView;\n        const cv = csmBufferView;\n        const csmSupported = sceneData.csmSupported;\n        const packing = supportsR32FloatTexture(device) ? 0.0 : 1.0;\n\n        if (mainLight && shadowInfo.enabled) {\n            if (shadowInfo.type === ShadowType.ShadowMap) {\n                if (mainLight.shadowEnabled) {\n                    if (mainLight.shadowFixedArea || mainLight.csmLevel === CSMLevel.LEVEL_1 || !csmSupported) {\n                        const matShadowView = csmLayers.specialLayer.matShadowView;\n                        const matShadowProj = csmLayers.specialLayer.matShadowProj;\n                        const matShadowViewProj = csmLayers.specialLayer.matShadowViewProj;\n                        const near = mainLight.shadowNear;\n                        const far = mainLight.shadowFar;\n\n                        Mat4.toArray(sv, matShadowView, UBOShadow.MAT_LIGHT_VIEW_OFFSET);\n\n                        sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 0] = matShadowProj.m10;\n                        sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 1] = matShadowProj.m14;\n                        sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 2] = matShadowProj.m11;\n                        sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 3] = matShadowProj.m15;\n\n                        sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 0] = matShadowProj.m00;\n                        sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 1] = matShadowProj.m05;\n                        sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 2] = 1.0 / matShadowProj.m00;\n                        sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 3] = 1.0 / matShadowProj.m05;\n\n                        Mat4.toArray(sv, matShadowViewProj, UBOShadow.MAT_LIGHT_VIEW_PROJ_OFFSET);\n\n                        _vec4ShadowInfo.set(near, far, 0, 1.0 - mainLight.shadowSaturation);\n                        Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET);\n\n                        _vec4ShadowInfo.set(0, packing, mainLight.shadowNormalBias, 0);\n                        Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);\n                    } else {\n                        const layerThreshold = this.getPCFRadius(shadowInfo, mainLight);\n                        for (let i = 0; i < mainLight.csmLevel; i++) {\n                            const matShadowView = csmLayers.layers[i].matShadowView;\n                            _vec4ShadowInfo.set(matShadowView.m00, matShadowView.m04, matShadowView.m08, layerThreshold);\n                            Vec4.toArray(cv, _vec4ShadowInfo, UBOCSM.CSM_VIEW_DIR_0_OFFSET + 4 * i);\n                            _vec4ShadowInfo.set(matShadowView.m01, matShadowView.m05, matShadowView.m09, 0.0);\n                            Vec4.toArray(cv, _vec4ShadowInfo, UBOCSM.CSM_VIEW_DIR_1_OFFSET + 4 * i);\n                            _vec4ShadowInfo.set(matShadowView.m02, matShadowView.m06, matShadowView.m10, 0.0);\n                            Vec4.toArray(cv, _vec4ShadowInfo, UBOCSM.CSM_VIEW_DIR_2_OFFSET + 4 * i);\n\n                            const csmAtlas = csmLayers.layers[i].csmAtlas;\n                            Vec4.toArray(cv, csmAtlas, UBOCSM.CSM_ATLAS_OFFSET + 4 * i);\n\n                            cv[UBOCSM.CSM_SPLITS_INFO_OFFSET + i] = csmLayers.layers[i].splitCameraFar / mainLight.shadowDistance;\n\n                            const matShadowViewProj = csmLayers.layers[i].matShadowViewProj;\n                            Mat4.toArray(cv, matShadowViewProj, UBOCSM.MAT_CSM_VIEW_PROJ_OFFSET + 16 * i);\n\n                            const matShadowProj = csmLayers.layers[i].matShadowProj;\n                            cv[UBOCSM.CSM_PROJ_DEPTH_INFO_OFFSET + 0 + 4 * i] = matShadowProj.m10;\n                            cv[UBOCSM.CSM_PROJ_DEPTH_INFO_OFFSET + 1 + 4 * i] = matShadowProj.m14;\n                            cv[UBOCSM.CSM_PROJ_DEPTH_INFO_OFFSET + 2 + 4 * i] = matShadowProj.m11;\n                            cv[UBOCSM.CSM_PROJ_DEPTH_INFO_OFFSET + 3 + 4 * i] = matShadowProj.m15;\n\n                            cv[UBOCSM.CSM_PROJ_INFO_OFFSET + 0 + 4 * i] = matShadowProj.m00;\n                            cv[UBOCSM.CSM_PROJ_INFO_OFFSET + 1 + 4 * i] = matShadowProj.m05;\n                            cv[UBOCSM.CSM_PROJ_INFO_OFFSET + 2 + 4 * i] = 1.0 / matShadowProj.m00;\n                            cv[UBOCSM.CSM_PROJ_INFO_OFFSET + 3 + 4 * i] = 1.0 / matShadowProj.m05;\n                        }\n\n                        _vec4ShadowInfo.set(0, 0, 0, 1.0 - mainLight.shadowSaturation);\n                        Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET);\n\n                        _vec4ShadowInfo.set(0.0, packing, mainLight.shadowNormalBias, mainLight.csmLevel);\n                        Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);\n                    }\n                    _vec4ShadowInfo.set(shadowInfo.size.x, shadowInfo.size.y, mainLight.shadowPcf, mainLight.shadowBias);\n                    Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET);\n                }\n            } else {\n                PipelineUBO.updatePlanarNormalAndDistance(shadowInfo, sv);\n            }\n\n            Color.toArray(sv, shadowInfo.shadowColor, UBOShadow.SHADOW_COLOR_OFFSET);\n        }\n    }\n\n    public static updateShadowUBOLightView (pipeline: PipelineRuntime, shadowBufferView: Float32Array, light: Light, level: number) {\n        const device = pipeline.device;\n        const sceneData = pipeline.pipelineSceneData;\n        const shadowInfo = sceneData.shadows;\n        const csmLayers = sceneData.csmLayers;\n        const sv = shadowBufferView;\n        const packing = supportsR32FloatTexture(device) ? 0.0 : 1.0;\n        const cap = pipeline.device.capabilities;\n        const csmSupported = sceneData.csmSupported;\n\n        switch (light.type) {\n        case LightType.DIRECTIONAL: {\n            const mainLight = light as DirectionalLight;\n            if (shadowInfo.enabled && mainLight && mainLight.shadowEnabled) {\n                if (shadowInfo.type === ShadowType.ShadowMap) {\n                    let near = 0.1;\n                    let far = 0;\n                    let matShadowView;\n                    let matShadowProj;\n                    let matShadowViewProj;\n                    let levelCount = 0;\n                    if (mainLight.shadowFixedArea || mainLight.csmLevel === CSMLevel.LEVEL_1 || !csmSupported) {\n                        matShadowView = csmLayers.specialLayer.matShadowView;\n                        matShadowProj = csmLayers.specialLayer.matShadowProj;\n                        matShadowViewProj = csmLayers.specialLayer.matShadowViewProj;\n                        if (mainLight.shadowFixedArea) {\n                            near = mainLight.shadowNear;\n                            far = mainLight.shadowFar;\n                            levelCount = 0;\n                        } else {\n                            near = 0.1;\n                            far = csmLayers.specialLayer.shadowCameraFar;\n                            levelCount = 1;\n                        }\n                        _vec4ShadowInfo.set(0.0, packing, mainLight.shadowNormalBias, 0);\n                        Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);\n                    } else {\n                        const layer = csmLayers.layers[level];\n                        matShadowView = layer.matShadowView;\n                        matShadowProj = layer.matShadowProj;\n                        matShadowViewProj = layer.matShadowViewProj;\n\n                        near = layer.splitCameraNear;\n                        far = layer.splitCameraFar;\n                        levelCount = mainLight.csmLevel;\n                    }\n\n                    Mat4.toArray(sv, matShadowView, UBOShadow.MAT_LIGHT_VIEW_OFFSET);\n\n                    sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 0] = matShadowProj.m10;\n                    sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 1] = matShadowProj.m14;\n                    sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 2] = matShadowProj.m11;\n                    sv[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 3] = matShadowProj.m15;\n\n                    sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 0] = matShadowProj.m00;\n                    sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 1] = matShadowProj.m05;\n                    sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 2] = 1.0 / matShadowProj.m00;\n                    sv[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 3] = 1.0 / matShadowProj.m05;\n\n                    Mat4.toArray(sv, matShadowViewProj, UBOShadow.MAT_LIGHT_VIEW_PROJ_OFFSET);\n\n                    _vec4ShadowInfo.set(near, far, 0, 1.0 - mainLight.shadowSaturation);\n                    Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET);\n\n                    _vec4ShadowInfo.set(0.0, packing, mainLight.shadowNormalBias, levelCount);\n                    Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);\n\n                    _vec4ShadowInfo.set(shadowInfo.size.x, shadowInfo.size.y, mainLight.shadowPcf, mainLight.shadowBias);\n                    Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET);\n                }\n            }\n            break;\n        }\n        case LightType.SPOT: {\n            const spotLight = light as SpotLight;\n            if (shadowInfo.enabled && spotLight && spotLight.shadowEnabled) {\n                Mat4.invert(_matShadowView, (light as any).node.getWorldMatrix());\n                Mat4.toArray(sv, _matShadowView, UBOShadow.MAT_LIGHT_VIEW_OFFSET);\n\n                Mat4.perspective(_matShadowProj, (light as any).angle, 1.0, 0.001, (light as any).range,\n                    true, cap.clipSpaceMinZ, cap.clipSpaceSignY, 0);\n\n                Mat4.multiply(_matShadowViewProj, _matShadowProj, _matShadowView);\n                Mat4.toArray(sv, _matShadowViewProj, UBOShadow.MAT_LIGHT_VIEW_PROJ_OFFSET);\n\n                _vec4ShadowInfo.set(0.01, (light as SpotLight).range, 0.0, 0.0);\n                Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET);\n\n                _vec4ShadowInfo.set(shadowInfo.size.x, shadowInfo.size.y, spotLight.shadowPcf, spotLight.shadowBias);\n                Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET);\n\n                _vec4ShadowInfo.set(1.0, packing, spotLight.shadowNormalBias, 0.0);\n                Vec4.toArray(sv, _vec4ShadowInfo, UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);\n            }\n            break;\n        }\n        default:\n        }\n\n        Color.toArray(sv, shadowInfo.shadowColor, UBOShadow.SHADOW_COLOR_OFFSET);\n    }\n\n    protected _globalUBO = new Float32Array(UBOGlobal.COUNT);\n    protected _cameraUBO = new Float32Array(UBOCamera.COUNT);\n    protected _shadowUBO = new Float32Array(UBOShadow.COUNT);\n    protected _csmUBO = new Float32Array(UBOCSM.COUNT);\n    static _combineSignY = 0;\n    protected declare _device: Device;\n    protected declare _pipeline: PipelineRuntime;\n\n    /**\n     *|combinedSignY|clipSpaceSignY|screenSpaceSignY| Backends |\n     *|    :--:     |    :--:      |      :--:      |   :--:   |\n     *|      0      |      -1      |      -1        |  Vulkan  |\n     *|      1      |       1      |      -1        |  Metal   |\n     *|      2      |      -1      |       1        |          |\n     *|      3      |       1      |       1        |  GL-like |\n     */\n    public static getCombineSignY () {\n        return PipelineUBO._combineSignY;\n    }\n\n    private _initCombineSignY () {\n        const device = this._device;\n        PipelineUBO._combineSignY = (device.capabilities.screenSpaceSignY * 0.5 + 0.5) << 1 | (device.capabilities.clipSpaceSignY * 0.5 + 0.5);\n    }\n\n    public activate (device: Device, pipeline: PipelineRuntime) {\n        this._device = device;\n        this._pipeline = pipeline;\n        const ds = this._pipeline.descriptorSet;\n        this._initCombineSignY();\n\n        const globalUBO = device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            UBOGlobal.SIZE,\n            UBOGlobal.SIZE,\n        ));\n        ds.bindBuffer(UBOGlobal.BINDING, globalUBO);\n\n        const cameraUBO = device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            UBOCamera.SIZE,\n            UBOCamera.SIZE,\n        ));\n        ds.bindBuffer(UBOCamera.BINDING, cameraUBO);\n        const shadowUBO = device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            UBOShadow.SIZE,\n            UBOShadow.SIZE,\n        ));\n        ds.bindBuffer(UBOShadow.BINDING, shadowUBO);\n        const csmUBO = device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            UBOCSM.SIZE,\n            UBOCSM.SIZE,\n        ));\n        ds.bindBuffer(UBOCSM.BINDING, csmUBO);\n    }\n\n    /**\n     * @en Update all UBOs\n     * @zh 更新全部 UBO。\n     */\n    public updateGlobalUBO (window: RenderWindow) {\n        const globalDSManager = this._pipeline.globalDSManager;\n        const ds = this._pipeline.descriptorSet;\n        const cmdBuffer = this._pipeline.commandBuffers;\n        ds.update();\n        PipelineUBO.updateGlobalUBOView(window, this._globalUBO);\n        cmdBuffer[0].updateBuffer(ds.getBuffer(UBOGlobal.BINDING), this._globalUBO);\n\n        globalDSManager.bindBuffer(UBOGlobal.BINDING, ds.getBuffer(UBOGlobal.BINDING));\n        globalDSManager.update();\n    }\n\n    public updateCameraUBO (camera: Camera) {\n        const globalDSManager = this._pipeline.globalDSManager;\n        const ds = this._pipeline.descriptorSet;\n        const cmdBuffer = this._pipeline.commandBuffers;\n        PipelineUBO.updateCameraUBOView(this._pipeline, this._cameraUBO, camera);\n        cmdBuffer[0].updateBuffer(ds.getBuffer(UBOCamera.BINDING), this._cameraUBO);\n\n        globalDSManager.bindBuffer(UBOCamera.BINDING, ds.getBuffer(UBOCamera.BINDING));\n        globalDSManager.update();\n    }\n\n    public updateShadowUBO (camera: Camera) {\n        const sceneData = this._pipeline.pipelineSceneData;\n        const shadowInfo = sceneData.shadows;\n        if (!shadowInfo.enabled) return;\n\n        const ds = this._pipeline.descriptorSet;\n        const cmdBuffer = this._pipeline.commandBuffers;\n        const shadowFrameBufferMap = sceneData.shadowFrameBufferMap;\n        const mainLight = camera.scene!.mainLight;\n        if (mainLight && shadowFrameBufferMap.has(mainLight)) {\n            ds.bindTexture(UNIFORM_SHADOWMAP_BINDING, shadowFrameBufferMap.get(mainLight)!.colorTextures[0]!);\n        }\n        PipelineUBO.updateShadowUBOView(this._pipeline, this._shadowUBO, this._csmUBO, camera);\n        ds.update();\n        cmdBuffer[0].updateBuffer(ds.getBuffer(UBOShadow.BINDING), this._shadowUBO);\n        cmdBuffer[0].updateBuffer(ds.getBuffer(UBOCSM.BINDING), this._csmUBO);\n    }\n\n    public updateShadowUBOLight (globalDS: DescriptorSet, light: Light, level = 0) {\n        PipelineUBO.updateShadowUBOLightView(this._pipeline, this._shadowUBO, light, level);\n        globalDS.bindTexture(UNIFORM_SHADOWMAP_BINDING, builtinResMgr.get<Texture2D>('default-texture').getGFXTexture()!);\n        globalDS.bindTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, builtinResMgr.get<Texture2D>('default-texture').getGFXTexture()!);\n        globalDS.update();\n        this._pipeline.commandBuffers[0].updateBuffer(globalDS.getBuffer(UBOShadow.BINDING), this._shadowUBO);\n    }\n\n    public updateShadowUBORange (offset: number, data: Mat4 | Color) {\n        if (data instanceof Mat4) {\n            Mat4.toArray(this._shadowUBO, data, offset);\n        } else if (data instanceof Color) {\n            Color.toArray(this._shadowUBO, data, offset);\n        }\n    }\n\n    public destroy () {\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, displayOrder, serializable } from 'cc.decorator';\nimport { legacyCC } from '../global-exports';\nimport { RenderPipeline } from './render-pipeline';\nimport { RenderFlow } from './render-flow';\nimport { RenderQueueDesc } from './pipeline-serialization';\nimport { Camera } from '../renderer/scene';\n\n/**\n * @en The render stage information descriptor\n * @zh 渲染阶段描述信息。\n */\nexport interface IRenderStageInfo {\n    name: string;\n    priority: number;\n    tag?: number;\n    renderQueues?: RenderQueueDesc[];\n}\n\n/**\n * @en The render stage actually renders render objects to the output window or other GFX [[gfx.Framebuffer]].\n * Typically, a render stage collects render objects it's responsible for, clear the camera,\n * record and execute command buffer, and at last present the render result.\n * @zh 渲染阶段是实质上的渲染执行者，它负责收集渲染数据并执行渲染将渲染结果输出到屏幕或其他 GFX [[gfx.Framebuffer]] 中。\n * 典型的渲染阶段会收集它所管理的渲染对象，按照 [[Camera]] 的清除标记进行清屏，记录并执行渲染指令缓存，并最终呈现渲染结果。\n */\n@ccclass('RenderStage')\nexport abstract class RenderStage {\n    /**\n     * @en Name of the current stage\n     * @zh 当前渲染阶段的名字。\n     */\n    public get name (): string {\n        return this._name;\n    }\n\n    /**\n     * @en Priority of the current stage\n     * @zh 当前渲染阶段的优先级。\n     */\n    public get priority (): number {\n        return this._priority;\n    }\n\n    /**\n     * @en Tag of the current stage\n     * @zh 当前渲染阶段的标签。\n     */\n    public get tag (): number {\n        return this._tag;\n    }\n\n    /**\n     * @en Name\n     * @zh 名称。\n     */\n    @displayOrder(0)\n    @serializable\n    protected _name = '';\n\n    /**\n     * @en Priority\n     * @zh 优先级。\n     */\n    @displayOrder(1)\n    @serializable\n    protected _priority = 0;\n\n    /**\n     * @en Whether to enable\n     * @zh 是否启用。\n     */\n    protected _enabled = true;\n    public set enabled (val: boolean) {\n        this._enabled = val;\n    }\n    public get enabled () {\n        return this._enabled;\n    }\n\n    /**\n     * @en Type\n     * @zh 类型。\n     */\n    @displayOrder(2)\n    @serializable\n    protected _tag = 0;\n    protected _pipeline!: RenderPipeline;\n    protected _flow!: RenderFlow;\n\n    /**\n     * @en The initialization process, user shouldn't use it in most case, only useful when need to generate render pipeline programmatically.\n     * @zh 初始化函数，正常情况下不会用到，仅用于程序化生成渲染管线的情况。\n     * @param info The render stage information\n     */\n    public initialize (info: IRenderStageInfo): boolean {\n        this._name = info.name;\n        this._priority = info.priority;\n        if (info.tag) { this._tag = info.tag; }\n        return true;\n    }\n\n    /**\n     * @en Activate the current render stage in the given render flow\n     * @zh 为指定的渲染流程开启当前渲染阶段\n     * @param flow The render flow to activate this render stage\n     */\n    public activate (pipeline: RenderPipeline, flow: RenderFlow) {\n        this._pipeline = pipeline;\n        this._flow = flow;\n    }\n\n    /**\n     * @en Destroy function\n     * @zh 销毁函数。\n     */\n    public abstract destroy ();\n\n    /**\n     * @en Render function\n     * @zh 渲染函数。\n     * @param view The render view\n     */\n    public abstract render (camera: Camera);\n}\n\nlegacyCC.RenderStage = RenderStage;\n","import { EventTarget } from '../event/event-target';\n\nexport enum PipelineEventType {\n    /**\n     * @en\n     * The event type for render frame begin event\n     *\n     * @zh\n     * 帧渲染开始事件。\n     */\n    RENDER_FRAME_BEGIN = 'render-frame-begin',\n\n    /**\n      * @en\n      * The event type for render frame end event\n      *\n      * @zh\n      * 帧渲染结束事件。\n      */\n    RENDER_FRAME_END = 'render-frame-end',\n\n    /**\n     * @en\n     * The event type for render camera begin event\n     *\n     * @zh\n     * 相机渲染开始事件。\n     */\n    RENDER_CAMERA_BEGIN = 'render-camera-begin',\n\n    /**\n     * @en\n     * The event type for render camera end event\n     *\n     * @zh\n     * 相机渲染结束事件。\n     */\n    RENDER_CAMERA_END = 'render-camera-end',\n\n    /**\n      * @en\n      * FBO attachment texture zoom event\n      *\n      * @zh\n      * FBO附件纹理缩放事件。\n      */\n    ATTACHMENT_SCALE_CAHNGED = 'attachment-scale-changed'\n}\n\nexport class PipelineEventProcessor extends EventTarget {\n    public eventTargetOn = super.on;\n    public eventTargetOnce = super.once;\n\n    public on (type: PipelineEventType, callback: any, target?: any, once?: boolean): typeof callback {\n        return this.eventTargetOn(type, callback, target, once);\n    }\n\n    public once (type: PipelineEventType, callback: any, target?: any): typeof callback {\n        return this.eventTargetOnce(type, callback, target);\n    }\n}\n\nexport interface IPipelineEvent {\n    on (type: PipelineEventType, callback: any, target?: any, once?: boolean): typeof callback;\n    once (type: PipelineEventType, callback: any, target?: any): typeof callback;\n    off (type: PipelineEventType, callback?: any, target?: any);\n    emit (type: PipelineEventType, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any);\n    targetOff (typeOrTarget: any): void;\n    removeAll (typeOrTarget: any): void;\n    hasEventListener (type: PipelineEventType, callback?: any, target?: any): boolean;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, displayOrder, serializable, type } from 'cc.decorator';\nimport { RenderStage } from './render-stage';\nimport { RenderPipeline } from './render-pipeline';\nimport { legacyCC } from '../global-exports';\nimport { Camera } from '../renderer/scene';\n\n/**\n * @en Render flow information descriptor\n * @zh 渲染流程描述信息。\n */\nexport interface IRenderFlowInfo {\n    name: string;\n    priority: number;\n    stages: RenderStage[];\n    tag?: number;\n}\n\n/**\n * @en Render flow is a sub process of the [[RenderPipeline]], it dispatch the render task to all the [[RenderStage]]s.\n * @zh 渲染流程是渲染管线（[[RenderPipeline]]）的一个子过程，它将渲染任务派发到它的所有渲染阶段（[[RenderStage]]）中执行。\n */\n@ccclass('RenderFlow')\nexport abstract class RenderFlow {\n    /**\n     * @en The name of the render flow\n     * @zh 渲染流程的名字\n     */\n    public get name (): string {\n        return this._name;\n    }\n\n    /**\n     * @en Priority of the current flow\n     * @zh 当前渲染流程的优先级。\n     */\n    public get priority (): number {\n        return this._priority;\n    }\n\n    /**\n     * @en Tag of the current flow\n     * @zh 当前渲染流程的标签。\n     */\n    public get tag (): number {\n        return this._tag;\n    }\n\n    /**\n     * @en The stages of flow.\n     * @zh 渲染流程 stage 列表。\n     * @readonly\n     */\n    public get stages (): RenderStage[] {\n        return this._stages;\n    }\n\n    @displayOrder(0)\n    @serializable\n    protected _name = '';\n\n    @displayOrder(1)\n    @serializable\n    protected _priority = 0;\n\n    @displayOrder(2)\n    @serializable\n    protected _tag = 0;\n\n    @displayOrder(3)\n    @type([RenderStage])\n    @serializable\n    protected _stages: RenderStage[] = [];\n    protected _pipeline!: RenderPipeline;\n\n    /**\n     * @en Get pipeline\n     * @zh 获取pipeline\n     */\n    public get pipeline (): RenderPipeline {\n        return this._pipeline;\n    }\n\n    /**\n     * @en The initialization process, user shouldn't use it in most case, only useful when need to generate render pipeline programmatically.\n     * @zh 初始化函数，正常情况下不会用到，仅用于程序化生成渲染管线的情况。\n     * @param info The render flow information\n     */\n    public initialize (info: IRenderFlowInfo): boolean {\n        this._name = info.name;\n        this._priority = info.priority;\n        this._stages = info.stages;\n        if (info.tag) { this._tag = info.tag; }\n        return true;\n    }\n\n    /**\n     * @en Activate the current render flow in the given pipeline\n     * @zh 为指定的渲染管线开启当前渲染流程\n     * @param pipeline The render pipeline to activate this render flow\n     */\n    public activate (pipeline: RenderPipeline) {\n        this._pipeline = pipeline;\n        this._stages.sort((a, b) => a.priority - b.priority);\n\n        for (let i = 0, len = this._stages.length; i < len; i++) {\n            this._stages[i].activate(pipeline, this);\n        }\n    }\n\n    /**\n     * @en Render function, it basically run all render stages in sequence for the given view.\n     * @zh 渲染函数，对指定的渲染视图按顺序执行所有渲染阶段。\n     * @param view Render view。\n     */\n    public render (camera: Camera) {\n        for (let i = 0, len = this._stages.length; i < len; i++) {\n            if (this._stages[i].enabled) this._stages[i].render(camera);\n        }\n    }\n\n    /**\n     * @en Destroy function.\n     * @zh 销毁函数。\n     */\n    public destroy () {\n        for (let i = 0, len = this._stages.length; i < len; i++) {\n            this._stages[i].destroy();\n        }\n\n        this._stages.length = 0;\n    }\n}\n\nlegacyCC.RenderFlow = RenderFlow;\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nexport enum CommonStagePriority {\n    BLOOM = 18,\n    POST_PROCESS = 19,\n    UI = 20\n}\n\n/**\n * @zh 前向阶段优先级。\n * @en The priority of stage in forward rendering\n */\nexport enum ForwardStagePriority {\n    FORWARD = 10,\n}\n\n/**\n * @zh 前向渲染流程优先级。\n * @en The priority of flows in forward rendering\n */\nexport enum ForwardFlowPriority {\n    SHADOW = 0,\n    FORWARD = 1,\n    UI = 10,\n}\n\n/**\n * @zh 延迟阶段优先级。\n * @en The priority of stage in forward rendering\n */\nexport enum DeferredStagePriority {\n    GBUFFER = 10,\n    LIGHTING = 15,\n    TRANSPARENT = 18\n}\n\n/**\n * @zh 延迟渲染流程优先级。\n * @en The priority of flows in forward rendering\n */\nexport enum DeferredFlowPriority {\n    SHADOW = 0,\n    MAIN = 1,\n    UI = 10,\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, type, serializable, editable } from 'cc.decorator';\nimport { CCString } from '../data/utils/attribute';\nimport { AccessFlagBit, Format, LoadOp, StoreOp, TextureType, TextureUsageBit } from '../gfx';\nimport { ccenum } from '../value-types/enum';\nimport { RenderTexture } from '../assets/render-texture';\nimport { Material } from '../assets/material';\n\nccenum(TextureType);\nccenum(TextureUsageBit);\nccenum(StoreOp);\nccenum(LoadOp);\nccenum(AccessFlagBit);\nccenum(Format);\n\n/**\n * @en The tag of the render flow, including SCENE, POSTPROCESS and UI.\n * @zh 渲染流程的标签，包含：常规场景（SCENE），后处理（POSTPROCESS），UI 界面（UI）\n */\nexport enum RenderFlowTag {\n    SCENE,\n    POSTPROCESS,\n    UI,\n}\n\nccenum(RenderFlowTag);\n\n@ccclass('RenderTextureDesc')\nexport class RenderTextureDesc {\n    @serializable\n    @editable\n    public name = '';\n    @type(TextureType)\n    public type: TextureType = TextureType.TEX2D;\n    @type(TextureUsageBit)\n    public usage: TextureUsageBit = TextureUsageBit.COLOR_ATTACHMENT;\n    @type(Format)\n    public format: Format = Format.UNKNOWN;\n    @serializable\n    @editable\n    public width = -1;\n    @serializable\n    @editable\n    public height = -1;\n}\n\n@ccclass('RenderTextureConfig')\nexport class RenderTextureConfig {\n    @serializable\n    @editable\n    public name = '';\n    @type(RenderTexture)\n    public texture: RenderTexture | null = null;\n}\n\n@ccclass('MaterialConfig')\nexport class MaterialConfig {\n    @serializable\n    @editable\n    public name = '';\n    @type(Material)\n    public material: Material | null = null;\n}\n\n@ccclass('FrameBufferDesc')\nexport class FrameBufferDesc {\n    @serializable\n    @editable\n    public name = '';\n    @serializable\n    @editable\n    public renderPass = 0;\n    @type([CCString])\n    public colorTextures: string[] = [];\n    @serializable\n    @editable\n    public depthStencilTexture = '';\n    @type(RenderTexture)\n    public texture: RenderTexture | null = null;\n}\n\n@ccclass('ColorDesc')\nexport class ColorDesc {\n    @type(Format)\n    public format: Format = Format.UNKNOWN;\n    @type(LoadOp)\n    public loadOp: LoadOp = LoadOp.CLEAR;\n    @type(StoreOp)\n    public storeOp: StoreOp = StoreOp.STORE;\n    @serializable\n    @editable\n    public sampleCount = 1;\n    @type([AccessFlagBit])\n    public beginAccesses: AccessFlagBit = AccessFlagBit.NONE;\n    @type([AccessFlagBit])\n    public endAccesses: AccessFlagBit = AccessFlagBit.COLOR_ATTACHMENT_WRITE;\n}\n\n@ccclass('DepthStencilDesc')\nexport class DepthStencilDesc {\n    @type(Format)\n    public format: Format = Format.UNKNOWN;\n    @type(LoadOp)\n    public depthLoadOp: LoadOp = LoadOp.CLEAR;\n    @type(StoreOp)\n    public depthStoreOp: StoreOp = StoreOp.STORE;\n    @type(LoadOp)\n    public stencilLoadOp: LoadOp = LoadOp.CLEAR;\n    @type(StoreOp)\n    public stencilStoreOp: StoreOp = StoreOp.STORE;\n    @serializable\n    @editable\n    public sampleCount = 1;\n    @type(AccessFlagBit)\n    public beginAccesses: AccessFlagBit = AccessFlagBit.NONE;\n    @type(AccessFlagBit)\n    public endAccesses: AccessFlagBit = AccessFlagBit.DEPTH_STENCIL_ATTACHMENT_WRITE;\n}\n\n@ccclass('RenderPassDesc')\nexport class RenderPassDesc {\n    @serializable\n    @editable\n    public index = -1;\n    @type([ColorDesc])\n    public colorAttachments = [];\n    @type(DepthStencilDesc)\n    public depthStencilAttachment: DepthStencilDesc = new DepthStencilDesc();\n}\n\nexport enum RenderQueueSortMode {\n    FRONT_TO_BACK,\n    BACK_TO_FRONT,\n}\n\nccenum(RenderQueueSortMode);\n\n/**\n * @en The render queue descriptor\n * @zh 渲染队列描述信息\n */\n@ccclass('RenderQueueDesc')\nexport class RenderQueueDesc {\n    /**\n     * @en Whether the render queue is a transparent queue\n     * @zh 当前队列是否是半透明队列\n     */\n    @serializable\n    @editable\n    public isTransparent = false;\n\n    /**\n     * @en The sort mode of the render queue\n     * @zh 渲染队列的排序模式\n     */\n    @type(RenderQueueSortMode)\n    public sortMode: RenderQueueSortMode = RenderQueueSortMode.FRONT_TO_BACK;\n\n    /**\n     * @en The stages using this queue\n     * @zh 使用当前渲染队列的阶段列表\n     */\n    @type([CCString])\n    public stages: string[] = [];\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, displayOrder, serializable, type } from 'cc.decorator';\nimport { systemInfo } from 'pal/system-info';\nimport { sceneCulling, validPunctualLightsCulling } from './scene-culling';\nimport { Asset } from '../assets/asset';\nimport { AccessFlagBit, Attribute, Buffer, BufferInfo, BufferUsageBit, ClearFlagBit, ClearFlags, ColorAttachment, CommandBuffer,\n    DepthStencilAttachment, DescriptorSet, Device, Feature, Format, FormatFeatureBit, Framebuffer, FramebufferInfo, InputAssembler,\n    InputAssemblerInfo, LoadOp, MemoryUsageBit, Rect, RenderPass, RenderPassInfo, Sampler, StoreOp, SurfaceTransform, Swapchain,\n    Texture, TextureInfo, TextureType, TextureUsageBit, Viewport, GeneralBarrierInfo, deviceManager,\n} from '../gfx';\nimport { legacyCC } from '../global-exports';\nimport { MacroRecord } from '../renderer/core/pass-utils';\nimport { RenderWindow } from '../renderer/core/render-window';\nimport { Camera, SKYBOX_FLAG } from '../renderer/scene/camera';\nimport { Model } from '../renderer/scene/model';\nimport { GlobalDSManager } from './global-descriptor-set-manager';\nimport { GeometryRenderer } from './geometry-renderer';\nimport { PipelineSceneData } from './pipeline-scene-data';\nimport { PipelineUBO } from './pipeline-ubo';\nimport { RenderFlow } from './render-flow';\nimport { IPipelineEvent, PipelineEventProcessor, PipelineEventType } from './pipeline-event';\nimport { decideProfilerCamera } from './pipeline-funcs';\nimport { OS } from '../../../pal/system-info/enum-type';\nimport { macro } from '../platform/macro';\nimport { UBOSkinning } from './define';\nimport { PipelineRuntime } from './custom/pipeline';\nimport { murmurhash2_32_gc } from '../utils';\n\n/**\n * @en Render pipeline information descriptor\n * @zh 渲染管线描述信息。\n */\nexport interface IRenderPipelineInfo {\n    flows: RenderFlow[];\n    tag?: number;\n}\n\nexport const MAX_BLOOM_FILTER_PASS_NUM = 6;\n\nconst tmpRect = new Rect();\nconst tmpViewport = new Viewport();\n\nexport class BloomRenderData {\n    renderPass: RenderPass = null!;\n\n    sampler: Sampler = null!;\n\n    prefiterTex: Texture = null!;\n    downsampleTexs: Texture[] = [];\n    upsampleTexs: Texture[] = [];\n    combineTex: Texture = null!;\n\n    prefilterFramebuffer: Framebuffer = null!;\n    downsampleFramebuffers: Framebuffer[] = [];\n    upsampleFramebuffers: Framebuffer[] = [];\n    combineFramebuffer: Framebuffer = null!;\n}\n\nexport class PipelineRenderData {\n    outputFrameBuffer: Framebuffer = null!;\n    outputRenderTargets: Texture[] = [];\n    outputDepth: Texture = null!;\n    sampler: Sampler = null!;\n\n    bloom: BloomRenderData | null = null;\n}\n\nexport class PipelineInputAssemblerData {\n    quadIB: Buffer|null = null;\n    quadVB: Buffer|null = null;\n    quadIA: InputAssembler|null = null;\n}\n\nfunction hashFrameBuffer (fbo: Framebuffer) {\n    let hash = 666;\n    for (const color of fbo.colorTextures) {\n        const info = color?.info;\n        const hashStr = `${info!.type}_${info!.usage}_${info!.format}_${info!.width}_${info!.height}_${info!.flags}_\n            ${info!.layerCount}_${info!.levelCount}_${info!.samples}_${info!.depth}_${info!.externalRes}`;\n        hash = murmurhash2_32_gc(hashStr, hash);\n    }\n\n    if (fbo.depthStencilTexture) {\n        const info = fbo.depthStencilTexture.info;\n        const hashStr = `${info.type}_${info.usage}_${info.format}_${info.width}_${info.height}_${info.flags}_\n            ${info.layerCount}_${info.levelCount}_${info.samples}_${info.depth}_${info.externalRes}`;\n        hash = murmurhash2_32_gc(hashStr, hash);\n    }\n\n    return hash;\n}\n\n/**\n * @en Render pipeline describes how we handle the rendering process for all render objects in the related render scene root.\n * It contains some general pipeline configurations, necessary rendering resources and some [[RenderFlow]]s.\n * The rendering process function [[render]] is invoked by [[Root]] for all [[Camera]]s.\n * @zh 渲染管线对象决定了引擎对相关渲染场景下的所有渲染对象实施的完整渲染流程。\n * 这个类主要包含一些通用的管线配置，必要的渲染资源和一些 [[RenderFlow]]。\n * 渲染流程函数 [[render]] 会由 [[Root]] 发起调用并对所有 [[Camera]] 执行预设的渲染流程。\n */\n@ccclass('cc.RenderPipeline')\nexport abstract class RenderPipeline extends Asset implements IPipelineEvent, PipelineRuntime {\n    /**\n     * @en The tag of pipeline.\n     * @zh 管线的标签。\n     * @readonly\n     */\n    get tag (): number {\n        return this._tag;\n    }\n\n    /**\n     * @en The flows of pipeline.\n     * @zh 管线的渲染流程列表。\n     * @readonly\n     */\n    get flows (): RenderFlow[] {\n        return this._flows;\n    }\n\n    /**\n     * @en Tag\n     * @zh 标签\n     * @readonly\n     */\n    @displayOrder(0)\n    @serializable\n    protected _tag = 0;\n\n    /**\n     * @en Flows\n     * @zh 渲染流程列表\n     * @readonly\n     */\n    @displayOrder(1)\n    @type([RenderFlow])\n    @serializable\n    protected _flows: RenderFlow[] = [];\n\n    protected _quadIB: Buffer | null = null;\n    protected _quadVBOnscreen: Buffer | null = null;\n    protected _quadVBOffscreen: Buffer | null = null;\n    protected _quadIAOnscreen: InputAssembler | null = null;\n    protected _quadIAOffscreen: InputAssembler | null = null;\n    protected _eventProcessor: PipelineEventProcessor = new PipelineEventProcessor();\n\n    /**\n     * @zh\n     * 四边形输入汇集器。\n     */\n    public get quadIAOnscreen (): InputAssembler {\n        return this._quadIAOnscreen!;\n    }\n\n    public get quadIAOffscreen (): InputAssembler {\n        return this._quadIAOffscreen!;\n    }\n\n    public getPipelineRenderData (): PipelineRenderData {\n        return this._pipelineRenderData!;\n    }\n\n    /**\n     * @en\n     * Constant macro string, static throughout the whole runtime.\n     * Used to pass device-specific parameters to shader.\n     * @zh 常量宏定义字符串，运行时全程不会改变，用于给 shader 传一些只和平台相关的参数。\n     * @readonly\n     */\n    get constantMacros () {\n        return this._constantMacros;\n    }\n\n    /**\n     * @en\n     * The current global-scoped shader macros.\n     * Used to control effects like IBL, fog, etc.\n     * @zh 当前的全局宏定义，用于控制如 IBL、雾效等模块。\n     * @readonly\n     */\n    get macros () {\n        return this._macros;\n    }\n\n    get device () {\n        return this._device;\n    }\n\n    get globalDSManager () {\n        return this._globalDSManager;\n    }\n\n    get descriptorSetLayout () {\n        return this._globalDSManager.descriptorSetLayout;\n    }\n\n    get descriptorSet () {\n        return this._descriptorSet;\n    }\n\n    get commandBuffers () {\n        return this._commandBuffers;\n    }\n\n    get pipelineUBO () {\n        return this._pipelineUBO;\n    }\n\n    get pipelineSceneData () {\n        return this._pipelineSceneData;\n    }\n\n    set profiler (value) {\n        this._profiler = value;\n    }\n\n    get profiler () {\n        return this._profiler;\n    }\n\n    /**\n     * @deprecated since v3.6, please use camera.geometryRenderer instead.\n     */\n    get geometryRenderer () {\n        return this._geometryRenderer;\n    }\n\n    set clusterEnabled (value) {\n        this._clusterEnabled = value;\n    }\n\n    get clusterEnabled () {\n        return this._clusterEnabled;\n    }\n\n    set bloomEnabled (value) {\n        this._bloomEnabled = value;\n    }\n\n    get bloomEnabled () {\n        return this._bloomEnabled;\n    }\n\n    protected _device!: Device;\n    protected _globalDSManager!: GlobalDSManager;\n    protected _descriptorSet!: DescriptorSet;\n    protected _commandBuffers: CommandBuffer[] = [];\n    protected _pipelineUBO = new PipelineUBO();\n    protected _macros: MacroRecord = {};\n    protected _constantMacros = '';\n    protected _profiler: Model | null = null;\n    protected _geometryRenderer: GeometryRenderer | null = null;\n    protected declare _pipelineSceneData: PipelineSceneData;\n    protected _pipelineRenderData: PipelineRenderData | null = null;\n    protected _renderPasses = new Map<number, RenderPass>();\n    protected _width = 0;\n    protected _height = 0;\n    protected _lastUsedRenderArea: Rect = new Rect();\n    protected _clusterEnabled = false;\n    protected _bloomEnabled = false;\n\n    /**\n     * @en The initialization process, user shouldn't use it in most case, only useful when need to generate render pipeline programmatically.\n     * @zh 初始化函数，正常情况下不会用到，仅用于程序化生成渲染管线的情况。\n     * @param info The render pipeline information\n     */\n    public initialize (info: IRenderPipelineInfo): boolean {\n        this._flows = info.flows;\n        if (info.tag) { this._tag = info.tag; }\n        return true;\n    }\n\n    public createRenderPass (clearFlags: ClearFlags, colorFmt: Format, depthFmt: Format): RenderPass {\n        const device = this._device;\n        const colorAttachment = new ColorAttachment();\n        const depthStencilAttachment = new DepthStencilAttachment();\n        colorAttachment.format = colorFmt;\n        depthStencilAttachment.format = depthFmt;\n        depthStencilAttachment.stencilStoreOp = StoreOp.DISCARD;\n        depthStencilAttachment.depthStoreOp = StoreOp.DISCARD;\n\n        if (!(clearFlags & ClearFlagBit.COLOR)) {\n            if (clearFlags & SKYBOX_FLAG) {\n                colorAttachment.loadOp = LoadOp.CLEAR;\n            } else {\n                colorAttachment.loadOp = LoadOp.LOAD;\n                colorAttachment.barrier = device.getGeneralBarrier(new GeneralBarrierInfo(\n                    AccessFlagBit.COLOR_ATTACHMENT_WRITE,\n                    AccessFlagBit.COLOR_ATTACHMENT_WRITE,\n                ));\n            }\n        }\n\n        if ((clearFlags & ClearFlagBit.DEPTH_STENCIL) !== ClearFlagBit.DEPTH_STENCIL) {\n            if (!(clearFlags & ClearFlagBit.DEPTH)) depthStencilAttachment.depthLoadOp = LoadOp.LOAD;\n            if (!(clearFlags & ClearFlagBit.STENCIL)) depthStencilAttachment.stencilLoadOp = LoadOp.LOAD;\n        }\n        depthStencilAttachment.barrier = device.getGeneralBarrier(new GeneralBarrierInfo(\n            AccessFlagBit.DEPTH_STENCIL_ATTACHMENT_WRITE,\n            AccessFlagBit.DEPTH_STENCIL_ATTACHMENT_WRITE,\n        ));\n\n        const renderPassInfo = new RenderPassInfo([colorAttachment], depthStencilAttachment);\n\n        return device.createRenderPass(renderPassInfo);\n    }\n\n    public getRenderPass (clearFlags: ClearFlags, fbo: Framebuffer): RenderPass {\n        const fbHash = hashFrameBuffer(fbo);\n        const hash = murmurhash2_32_gc(`${fbHash}_${clearFlags}`, 666);\n        let renderPass = this._renderPasses.get(hash);\n        if (renderPass) { return renderPass; }\n        renderPass = this.createRenderPass(clearFlags, fbo.colorTextures[0]!.format, fbo.depthStencilTexture!.format);\n        this._renderPasses.set(hash, renderPass);\n        return renderPass;\n    }\n\n    public newFramebufferByRatio (dyingFramebuffer: Framebuffer) {\n        const sceneData = this.pipelineSceneData;\n        const width = this._width * sceneData.shadingScale;\n        const height = this._height * sceneData.shadingScale;\n        const colorTexArr: any = dyingFramebuffer.colorTextures;\n        for (let i = 0; i < colorTexArr.length; i++) {\n            colorTexArr[i]!.resize(width, height);\n        }\n        if (dyingFramebuffer.depthStencilTexture) {\n            dyingFramebuffer.depthStencilTexture.resize(width, height);\n        }\n        // move\n        const newFramebuffer = this._device.createFramebuffer(new FramebufferInfo(\n            dyingFramebuffer.renderPass,\n            colorTexArr,\n            dyingFramebuffer.depthStencilTexture,\n        ));\n        dyingFramebuffer.destroy();\n        return newFramebuffer;\n    }\n\n    /**\n     * @en generate renderArea by camera\n     * @zh 生成renderArea\n     * @param camera the camera\n     * @returns\n     */\n    public generateRenderArea (camera: Camera, out: Rect) {\n        const vp = camera.viewport;\n        const w = camera.window.width;\n        const h = camera.window.height;\n        out.x = vp.x * w;\n        out.y = vp.y * h;\n        out.width = vp.width * w;\n        out.height = vp.height * h;\n    }\n\n    public generateViewport (camera: Camera, out?: Viewport): Viewport {\n        this.generateRenderArea(camera, tmpRect);\n        if (!out) out = tmpViewport;\n        const shadingScale = this.pipelineSceneData.shadingScale;\n        out.left = tmpRect.x * shadingScale;\n        out.top = tmpRect.y * shadingScale;\n        out.width = tmpRect.width * shadingScale;\n        out.height = tmpRect.height * shadingScale;\n        return out;\n    }\n\n    public generateScissor (camera: Camera, out?: Rect): Rect {\n        if (!out) out = tmpRect;\n        this.generateRenderArea(camera, out);\n        const shadingScale = this.pipelineSceneData.shadingScale;\n        out.x *= shadingScale;\n        out.y *= shadingScale;\n        out.width *= shadingScale;\n        out.height *= shadingScale;\n        return out;\n    }\n\n    public get shadingScale () {\n        return this._pipelineSceneData.shadingScale;\n    }\n\n    public set shadingScale (val: number) {\n        if (this._pipelineSceneData.shadingScale !== val) {\n            this._pipelineSceneData.shadingScale = val;\n            this.emit(PipelineEventType.ATTACHMENT_SCALE_CAHNGED, val);\n        }\n    }\n\n    public getMacroString (name: string): string {\n        const str = this._macros[name];\n        if (str === undefined) {\n            return '';\n        }\n        return str as string;\n    }\n\n    public getMacroInt (name: string): number {\n        const value = this._macros[name];\n        if (value === undefined) {\n            return 0;\n        }\n        return value as number;\n    }\n\n    public getMacroBool (name: string): boolean {\n        const value = this._macros[name];\n        if (value === undefined) {\n            return false;\n        }\n        return value as boolean;\n    }\n\n    public setMacroString (name: string, value: string): void {\n        this._macros[name] = value;\n    }\n\n    public setMacroInt (name: string, value: number): void {\n        this._macros[name] = value;\n    }\n\n    public setMacroBool (name: string, value: boolean): void {\n        this._macros[name] = value;\n    }\n\n    /**\n     * @en Activate the render pipeline after loaded, it mainly activate the flows\n     * @zh 当渲染管线资源加载完成后，启用管线，主要是启用管线内的 flow\n     * TODO: remove swapchain dependency at this stage\n     * after deferred pipeline can handle multiple swapchains\n     */\n    public activate (swapchain: Swapchain): boolean {\n        this._device = deviceManager.gfxDevice;\n        this._generateConstantMacros();\n        this._globalDSManager = new GlobalDSManager(this._device);\n        this._descriptorSet = this._globalDSManager.globalDescriptorSet;\n        this._pipelineUBO.activate(this._device, this);\n        // update global defines in advance here for deferred pipeline may tryCompile shaders.\n        this._macros.CC_USE_HDR = this._pipelineSceneData.isHDR;\n        this._macros.CC_USE_DEBUG_VIEW = 0;\n        this._generateConstantMacros();\n        this._pipelineSceneData.activate(this._device);\n\n        for (let i = 0; i < this._flows.length; i++) {\n            this._flows[i].activate(this);\n        }\n\n        return true;\n    }\n\n    protected _ensureEnoughSize (cameras: Camera[]) {}\n\n    /**\n     * @en Render function, it basically run the render process of all flows in sequence for the given view.\n     * @zh 渲染函数，对指定的渲染视图按顺序执行所有渲染流程。\n     * @param view Render view。\n     */\n    public render (cameras: Camera[]) {\n        if (cameras.length === 0) {\n            return;\n        }\n        this.updateGeometryRenderer(cameras); // for capability\n        this._commandBuffers[0].begin();\n        this.emit(PipelineEventType.RENDER_FRAME_BEGIN, cameras);\n        this._ensureEnoughSize(cameras);\n        decideProfilerCamera(cameras);\n\n        for (let i = 0; i < cameras.length; i++) {\n            const camera = cameras[i];\n            if (camera.scene) {\n                this.emit(PipelineEventType.RENDER_CAMERA_BEGIN, camera);\n                validPunctualLightsCulling(this, camera);\n                sceneCulling(this, camera);\n                this._pipelineUBO.updateGlobalUBO(camera.window);\n                this._pipelineUBO.updateCameraUBO(camera);\n                for (let j = 0; j < this._flows.length; j++) {\n                    this._flows[j].render(camera);\n                }\n                this.emit(PipelineEventType.RENDER_CAMERA_END, camera);\n            }\n        }\n        this.emit(PipelineEventType.RENDER_FRAME_END, cameras);\n        this._commandBuffers[0].end();\n        this._device.queue.submit(this._commandBuffers);\n    }\n\n    /**\n     * @zh\n     * 销毁四边形输入汇集器。\n     */\n    protected _destroyQuadInputAssembler () {\n        if (this._quadIB) {\n            this._quadIB.destroy();\n            this._quadIB = null;\n        }\n\n        if (this._quadVBOnscreen) {\n            this._quadVBOnscreen.destroy();\n            this._quadVBOnscreen = null;\n        }\n\n        if (this._quadVBOffscreen) {\n            this._quadVBOffscreen.destroy();\n            this._quadVBOffscreen = null;\n        }\n\n        if (this._quadIAOnscreen) {\n            this._quadIAOnscreen.destroy();\n            this._quadIAOnscreen = null;\n        }\n\n        if (this._quadIAOffscreen) {\n            this._quadIAOffscreen.destroy();\n            this._quadIAOffscreen = null;\n        }\n    }\n\n    protected _destroyBloomData () {\n        const bloom = this._pipelineRenderData!.bloom;\n        if (bloom === null) return;\n\n        if (bloom.prefiterTex) bloom.prefiterTex.destroy();\n        if (bloom.prefilterFramebuffer) bloom.prefilterFramebuffer.destroy();\n\n        for (let i = 0; i < bloom.downsampleTexs.length; ++i) {\n            bloom.downsampleTexs[i].destroy();\n            bloom.downsampleFramebuffers[i].destroy();\n        }\n        bloom.downsampleTexs.length = 0;\n        bloom.downsampleFramebuffers.length = 0;\n\n        for (let i = 0; i < bloom.upsampleTexs.length; ++i) {\n            bloom.upsampleTexs[i].destroy();\n            bloom.upsampleFramebuffers[i].destroy();\n        }\n        bloom.upsampleTexs.length = 0;\n        bloom.upsampleFramebuffers.length = 0;\n\n        if (bloom.combineTex) bloom.combineTex.destroy();\n        if (bloom.combineFramebuffer) bloom.combineFramebuffer.destroy();\n\n        bloom.renderPass?.destroy();\n\n        this._pipelineRenderData!.bloom = null;\n    }\n\n    private _genQuadVertexData (surfaceTransform: SurfaceTransform, renderArea: Rect) : Float32Array {\n        const vbData = new Float32Array(4 * 4);\n\n        const minX = renderArea.x / this._width;\n        const maxX = (renderArea.x + renderArea.width) / this._width;\n        let minY = renderArea.y / this._height;\n        let maxY = (renderArea.y + renderArea.height) / this._height;\n        if (this.device.capabilities.screenSpaceSignY > 0) {\n            const temp = maxY;\n            maxY       = minY;\n            minY       = temp;\n        }\n        let n = 0;\n        switch (surfaceTransform) {\n        case (SurfaceTransform.IDENTITY):\n            n = 0;\n            vbData[n++] = -1.0; vbData[n++] = -1.0; vbData[n++] = minX; vbData[n++] = maxY;\n            vbData[n++] = 1.0; vbData[n++] = -1.0; vbData[n++] = maxX; vbData[n++] = maxY;\n            vbData[n++] = -1.0; vbData[n++] = 1.0; vbData[n++] = minX; vbData[n++] = minY;\n            vbData[n++] = 1.0; vbData[n++] = 1.0; vbData[n++] = maxX; vbData[n++] = minY;\n            break;\n        case (SurfaceTransform.ROTATE_90):\n            n = 0;\n            vbData[n++] = -1.0; vbData[n++] = -1.0; vbData[n++] = maxX; vbData[n++] = maxY;\n            vbData[n++] = 1.0; vbData[n++] = -1.0; vbData[n++] = maxX; vbData[n++] = minY;\n            vbData[n++] = -1.0; vbData[n++] = 1.0; vbData[n++] = minX; vbData[n++] = maxY;\n            vbData[n++] = 1.0; vbData[n++] = 1.0; vbData[n++] = minX; vbData[n++] = minY;\n            break;\n        case (SurfaceTransform.ROTATE_180):\n            n = 0;\n            vbData[n++] = -1.0; vbData[n++] = -1.0; vbData[n++] = minX; vbData[n++] = minY;\n            vbData[n++] = 1.0; vbData[n++] = -1.0; vbData[n++] = maxX; vbData[n++] = minY;\n            vbData[n++] = -1.0; vbData[n++] = 1.0; vbData[n++] = minX; vbData[n++] = maxY;\n            vbData[n++] = 1.0; vbData[n++] = 1.0; vbData[n++] = maxX; vbData[n++] = maxY;\n            break;\n        case (SurfaceTransform.ROTATE_270):\n            n = 0;\n            vbData[n++] = -1.0; vbData[n++] = -1.0; vbData[n++] = minX; vbData[n++] = minY;\n            vbData[n++] = 1.0; vbData[n++] = -1.0; vbData[n++] = minX; vbData[n++] = maxY;\n            vbData[n++] = -1.0; vbData[n++] = 1.0; vbData[n++] = maxX; vbData[n++] = minY;\n            vbData[n++] = 1.0; vbData[n++] = 1.0; vbData[n++] = maxX; vbData[n++] = maxY;\n            break;\n        default:\n            break;\n        }\n\n        return vbData;\n    }\n\n    /**\n     * @zh\n     * 创建四边形输入汇集器。\n     */\n    protected _createQuadInputAssembler (): PipelineInputAssemblerData {\n        // create vertex buffer\n        const inputAssemblerData = new PipelineInputAssemblerData();\n\n        const vbStride = Float32Array.BYTES_PER_ELEMENT * 4;\n        const vbSize = vbStride * 4;\n\n        const quadVB = this._device.createBuffer(new BufferInfo(\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE | MemoryUsageBit.HOST,\n            vbSize,\n            vbStride,\n        ));\n\n        if (!quadVB) {\n            return inputAssemblerData;\n        }\n\n        // create index buffer\n        const ibStride = Uint8Array.BYTES_PER_ELEMENT;\n        const ibSize = ibStride * 6;\n\n        const quadIB = this._device.createBuffer(new BufferInfo(\n            BufferUsageBit.INDEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE,\n            ibSize,\n            ibStride,\n        ));\n\n        if (!quadIB) {\n            return inputAssemblerData;\n        }\n\n        const indices = new Uint8Array(6);\n        indices[0] = 0; indices[1] = 1; indices[2] = 2;\n        indices[3] = 1; indices[4] = 3; indices[5] = 2;\n\n        quadIB.update(indices);\n\n        // create input assembler\n\n        const attributes = new Array<Attribute>(2);\n        attributes[0] = new Attribute('a_position', Format.RG32F);\n        attributes[1] = new Attribute('a_texCoord', Format.RG32F);\n\n        const quadIA = this._device.createInputAssembler(new InputAssemblerInfo(\n            attributes,\n            [quadVB],\n            quadIB,\n        ));\n\n        inputAssemblerData.quadIB = quadIB;\n        inputAssemblerData.quadVB = quadVB;\n        inputAssemblerData.quadIA = quadIA;\n        return inputAssemblerData;\n    }\n\n    public updateQuadVertexData (renderArea: Rect, window: RenderWindow) {\n        const cachedArea = this._lastUsedRenderArea;\n        if (cachedArea.x === renderArea.x\n            && cachedArea.y === renderArea.y\n            && cachedArea.width === renderArea.width\n            && cachedArea.height === renderArea.height) {\n            return;\n        }\n\n        const offData = this._genQuadVertexData(SurfaceTransform.IDENTITY, renderArea);\n        this._quadVBOffscreen!.update(offData);\n        const onData = this._genQuadVertexData(window.swapchain && window.swapchain.surfaceTransform || SurfaceTransform.IDENTITY, renderArea);\n        this._quadVBOnscreen!.update(onData);\n\n        cachedArea.copy(renderArea);\n    }\n\n    /**\n     * @en Internal destroy function\n     * @zh 内部销毁函数。\n     */\n    public destroy (): boolean {\n        for (let i = 0; i < this._flows.length; i++) {\n            this._flows[i].destroy();\n        }\n        this._flows.length = 0;\n\n        if (this._descriptorSet) {\n            this._descriptorSet.destroy();\n        }\n\n        this._globalDSManager?.destroy();\n\n        for (let i = 0; i < this._commandBuffers.length; i++) {\n            this._commandBuffers[i].destroy();\n        }\n        this._commandBuffers.length = 0;\n        this._pipelineUBO.destroy();\n        this._pipelineSceneData?.destroy();\n\n        return super.destroy();\n    }\n\n    public onGlobalPipelineStateChanged () {\n        // do nothing\n    }\n\n    protected _generateConstantMacros () {\n        let str = '';\n        str += `#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE ${this.device.getFormatFeatures(Format.RGBA32F)\n            & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE) ? 1 : 0}\\n`;\n        str += `#define CC_ENABLE_CLUSTERED_LIGHT_CULLING ${this._clusterEnabled ? 1 : 0}\\n`;\n        str += `#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS ${this.device.capabilities.maxVertexUniformVectors}\\n`;\n        str += `#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS ${this.device.capabilities.maxFragmentUniformVectors}\\n`;\n        str += `#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT ${this.device.hasFeature(Feature.INPUT_ATTACHMENT_BENEFIT) ? 1 : 0}\\n`;\n        str += `#define CC_PLATFORM_ANDROID_AND_WEBGL ${systemInfo.os === OS.ANDROID && systemInfo.isBrowser ? 1 : 0}\\n`;\n        str += `#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES ${macro.ENABLE_WEBGL_HIGHP_STRUCT_VALUES ? 1 : 0}\\n`;\n\n        const jointUniformCapacity = UBOSkinning.JOINT_UNIFORM_CAPACITY;\n        str += `#define CC_JOINT_UNIFORM_CAPACITY ${jointUniformCapacity}\\n`;\n\n        this._constantMacros = str;\n    }\n\n    protected updateGeometryRenderer (cameras: Camera[]) {\n        if (this._geometryRenderer) {\n            return;\n        }\n\n        // Query the first camera rendering to swapchain.\n        for (let i = 0; i < cameras.length; i++) {\n            const camera = cameras[i];\n            if (camera && camera.window && camera.window.swapchain) {\n                camera.initGeometryRenderer();\n                this._geometryRenderer = camera.geometryRenderer;\n                return;\n            }\n        }\n    }\n\n    public generateBloomRenderData () {\n        if (this._pipelineRenderData!.bloom != null) return;\n\n        const bloom = this._pipelineRenderData!.bloom = new BloomRenderData();\n        const device = this.device;\n\n        // create renderPass\n        const colorAttachment = new ColorAttachment();\n        colorAttachment.format = Format.RGBA8;\n        colorAttachment.loadOp = LoadOp.CLEAR;\n        colorAttachment.storeOp = StoreOp.STORE;\n        colorAttachment.barrier = device.getGeneralBarrier(new GeneralBarrierInfo(\n            AccessFlagBit.NONE,\n            AccessFlagBit.COLOR_ATTACHMENT_WRITE,\n        ));\n        bloom.renderPass = device.createRenderPass(new RenderPassInfo([colorAttachment]));\n\n        let curWidth = this._width;\n        let curHeight = this._height;\n\n        // prefilter\n        bloom.prefiterTex = device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n            Format.RGBA8,\n            curWidth >> 1,\n            curHeight >> 1,\n        ));\n        bloom.prefilterFramebuffer = device.createFramebuffer(new FramebufferInfo(\n            bloom.renderPass,\n            [bloom.prefiterTex],\n        ));\n\n        // downsample & upsample\n        curWidth >>= 1;\n        curHeight >>= 1;\n        for (let i = 0; i < MAX_BLOOM_FILTER_PASS_NUM; ++i) {\n            bloom.downsampleTexs.push(device.createTexture(new TextureInfo(\n                TextureType.TEX2D,\n                TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n                Format.RGBA8,\n                curWidth >> 1,\n                curHeight >> 1,\n            )));\n            bloom.downsampleFramebuffers[i] = device.createFramebuffer(new FramebufferInfo(\n                bloom.renderPass,\n                [bloom.downsampleTexs[i]],\n            ));\n\n            bloom.upsampleTexs.push(device.createTexture(new TextureInfo(\n                TextureType.TEX2D,\n                TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n                Format.RGBA8,\n                curWidth,\n                curHeight,\n            )));\n            bloom.upsampleFramebuffers[i] = device.createFramebuffer(new FramebufferInfo(\n                bloom.renderPass,\n                [bloom.upsampleTexs[i]],\n            ));\n\n            curWidth >>= 1;\n            curHeight >>= 1;\n        }\n\n        // combine\n        bloom.combineTex = device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n            Format.RGBA8,\n            this._width,\n            this._height,\n        ));\n        bloom.combineFramebuffer = device.createFramebuffer(new FramebufferInfo(\n            bloom.renderPass,\n            [bloom.combineTex],\n        ));\n\n        // sampler\n        bloom.sampler = this.globalDSManager.linearSampler;\n    }\n\n    /**\n     * @en\n     * Register an callback of the pipeline event type on the RenderPipeline.\n     * @zh\n     * 在渲染管线中注册管线事件类型的回调。\n     */\n    public on (type: PipelineEventType, callback: any, target?: any, once?: boolean): typeof callback {\n        return this._eventProcessor.on(type, callback, target, once);\n    }\n\n    /**\n     * @en\n     * Register an callback of the pipeline event type on the RenderPipeline,\n     * the callback will remove itself after the first time it is triggered.\n     * @zh\n     * 在渲染管线中注册管线事件类型的回调, 回调后会在第一时间删除自身。\n     */\n    public once (type: PipelineEventType, callback: any, target?: any): typeof callback {\n        return this._eventProcessor.once(type, callback, target);\n    }\n\n    /**\n     * @en\n     * Removes the listeners previously registered with the same type, callback, target and or useCapture,\n     * if only type is passed as parameter, all listeners registered with that type will be removed.\n     * @zh\n     * 删除之前用同类型、回调、目标或 useCapture 注册的事件监听器，如果只传递 type，将会删除 type 类型的所有事件监听器。\n     */\n    public off (type: PipelineEventType, callback?: any, target?: any) {\n        this._eventProcessor.off(type, callback, target);\n    }\n\n    /**\n     * @zh 派发一个指定事件，并传递需要的参数\n     * @en Trigger an event directly with the event name and necessary arguments.\n     * @param type - event type\n     * @param args - Arguments when the event triggered\n     */\n    public emit (type: PipelineEventType, arg0?: any, arg1?: any, arg2?: any, arg3?: any, arg4?: any) {\n        this._eventProcessor.emit(type, arg0, arg1, arg2, arg3, arg4);\n    }\n\n    /**\n     * @en Removes all callbacks previously registered with the same target (passed as parameter).\n     * This is not for removing all listeners in the current event target,\n     * and this is not for removing all listeners the target parameter have registered.\n     * It's only for removing all listeners (callback and target couple) registered on the current event target by the target parameter.\n     * @zh 在当前 EventTarget 上删除指定目标（target 参数）注册的所有事件监听器。\n     * 这个函数无法删除当前 EventTarget 的所有事件监听器，也无法删除 target 参数所注册的所有事件监听器。\n     * 这个函数只能删除 target 参数在当前 EventTarget 上注册的所有事件监听器。\n     * @param typeOrTarget - The target to be searched for all related listeners\n     */\n    public targetOff (typeOrTarget: any) {\n        this._eventProcessor.targetOff(typeOrTarget);\n    }\n\n    /**\n     * @zh 移除在特定事件类型中注册的所有回调或在某个目标中注册的所有回调。\n     * @en Removes all callbacks registered in a certain event type or all callbacks registered with a certain target\n     * @param typeOrTarget - The event type or target with which the listeners will be removed\n     */\n    public removeAll (typeOrTarget: any) {\n        this._eventProcessor.removeAll(typeOrTarget);\n    }\n\n    /**\n     * @zh 检查指定事件是否已注册回调。\n     * @en Checks whether there is correspond event listener registered on the given event.\n     * @param type - Event type.\n     * @param callback - Callback function when event triggered.\n     * @param target - Callback callee.\n     */\n    public hasEventListener (type: PipelineEventType, callback?: any, target?: any): boolean {\n        return this._eventProcessor.hasEventListener(type, callback, target);\n    }\n}\n\n// Do not delete, for the class detection of editor\nlegacyCC.RenderPipeline = RenderPipeline;\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { markAsWarning } from '../utils';\nimport { RenderPipeline } from './render-pipeline';\n\n// deprecate RenderPipeline API\nmarkAsWarning(RenderPipeline.prototype, 'RenderPipeline.prototype', [\n    {\n        name: 'geometryRenderer',\n        suggest: 'please use camera.geometryRenderer instead.',\n    },\n]);\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { RecyclePool } from '../memop';\nimport { CachedArray } from '../memop/cached-array';\nimport { IRenderObject, IRenderPass, IRenderQueueDesc, SetIndex } from './define';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { RenderPass, Device, CommandBuffer } from '../gfx';\nimport { RenderQueueDesc, RenderQueueSortMode } from './pipeline-serialization';\nimport { getPhaseID } from './pass-phase';\n\n/**\n * @en Comparison sorting function. Opaque objects are sorted by priority -> depth front to back -> shader ID.\n * @zh 比较排序函数。不透明对象按优先级 -> 深度由前向后 -> Shader ID 顺序排序。\n */\nexport function opaqueCompareFn (a: IRenderPass, b: IRenderPass) {\n    return (a.hash - b.hash) || (a.depth - b.depth) || (a.shaderId - b.shaderId);\n}\n\n/**\n * @en Comparison sorting function. Transparent objects are sorted by priority -> depth back to front -> shader ID.\n * @zh 比较排序函数。半透明对象按优先级 -> 深度由后向前 -> Shader ID 顺序排序。\n */\nexport function transparentCompareFn (a: IRenderPass, b: IRenderPass) {\n    return (a.priority - b.priority) || (a.hash - b.hash) || (b.depth - a.depth) || (a.shaderId - b.shaderId);\n}\n\n/**\n * @en The render queue. It manages a GFX [[RenderPass]] queue which will be executed by the [[RenderStage]].\n * @zh 渲染队列。它管理一个 GFX [[RenderPass]] 队列，队列中的渲染过程会被 [[RenderStage]] 所执行。\n */\nexport class RenderQueue {\n    /**\n     * @en A cached array of render passes\n     * @zh 基于缓存数组的渲染过程队列。\n     */\n    public queue: CachedArray<IRenderPass>;\n\n    private _passDesc: IRenderQueueDesc;\n    private _passPool: RecyclePool<IRenderPass>;\n\n    /**\n     * @en Construct a RenderQueue with render queue descriptor\n     * @zh 利用渲染队列描述来构造一个 RenderQueue。\n     * @param desc Render queue descriptor\n     */\n    constructor (desc: IRenderQueueDesc) {\n        this._passDesc = desc;\n        this._passPool = new RecyclePool<IRenderPass>(() => ({\n            priority: 0,\n            hash: 0,\n            depth: 0,\n            shaderId: 0,\n            subModel: null!,\n            passIdx: 0,\n        }), 64);\n        this.queue = new CachedArray(64, this._passDesc.sortFunc);\n    }\n\n    /**\n     * @en Clear the render queue\n     * @zh 清空渲染队列。\n     */\n    public clear () {\n        this.queue.clear();\n        this._passPool.reset();\n    }\n\n    /**\n     * @en Insert a render pass into the queue\n     * @zh 插入渲染过程。\n     * @param renderObj The render object of the pass\n     * @param modelIdx The model id\n     * @param passIdx The pass id\n     * @returns Whether the new render pass is successfully added\n     */\n    public insertRenderPass (renderObj: IRenderObject, subModelIdx: number, passIdx: number): boolean {\n        const subModel = renderObj.model.subModels[subModelIdx];\n        const pass = subModel.passes[passIdx];\n        const shader = subModel.shaders[passIdx];\n        const isTransparent = pass.blendState.targets[0].blend;\n        if (isTransparent !== this._passDesc.isTransparent || !(pass.phase & this._passDesc.phases)) {\n            return false;\n        }\n        const hash = (0 << 30) | pass.priority << 16 | subModel.priority << 8 | passIdx;\n        const rp = this._passPool.add();\n        rp.priority = renderObj.model.priority;\n        rp.hash = hash;\n        rp.depth = renderObj.depth || 0;\n        rp.shaderId = shader.typedID;\n        rp.subModel = subModel;\n        rp.passIdx = passIdx;\n        this.queue.push(rp);\n        return true;\n    }\n\n    /**\n     * @en Sort the current queue\n     * @zh 排序渲染队列。\n     */\n    public sort () {\n        this.queue.sort();\n    }\n\n    public recordCommandBuffer (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer) {\n        for (let i = 0; i < this.queue.length; ++i) {\n            const { subModel, passIdx } = this.queue.array[i];\n            const { inputAssembler } = subModel;\n            const pass = subModel.passes[passIdx];\n            const shader = subModel.shaders[passIdx];\n            const pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader, renderPass, inputAssembler);\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n            cmdBuff.bindDescriptorSet(SetIndex.LOCAL, subModel.descriptorSet);\n            cmdBuff.bindInputAssembler(inputAssembler);\n            cmdBuff.draw(inputAssembler);\n        }\n    }\n}\n\nexport function convertRenderQueue (desc: RenderQueueDesc) {\n    let phase = 0;\n    for (let j = 0; j < desc.stages.length; j++) {\n        phase |= getPhaseID(desc.stages[j]);\n    }\n    let sortFunc: (a: IRenderPass, b: IRenderPass) => number = opaqueCompareFn;\n    switch (desc.sortMode) {\n    case RenderQueueSortMode.BACK_TO_FRONT:\n        sortFunc = transparentCompareFn;\n        break;\n    case RenderQueueSortMode.FRONT_TO_BACK:\n        sortFunc = opaqueCompareFn;\n        break;\n    default:\n        break;\n    }\n\n    return new RenderQueue({\n        isTransparent: desc.isTransparent,\n        phases: phase,\n        sortFunc,\n    });\n}\n\n/**\n * @en Clear the given render queue\n * @zh 清空指定的渲染队列\n * @param rq The render queue\n */\nexport function renderQueueClearFunc (rq: RenderQueue) {\n    rq.clear();\n}\n\n/**\n * @en Sort the given render queue\n * @zh 对指定的渲染队列执行排序\n * @param rq The render queue\n */\nexport function renderQueueSortFunc (rq: RenderQueue) {\n    rq.sort();\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n// Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\nimport { builtinResMgr } from '../../builtin/builtin-res-mgr';\nimport { Material } from '../../assets/material';\nimport { RenderingSubMesh } from '../../assets/rendering-sub-mesh';\nimport { AABB } from '../../geometry/aabb';\nimport { Node } from '../../scene-graph';\nimport { Layers } from '../../scene-graph/layers';\nimport { RenderScene } from '../core/render-scene';\nimport { Texture2D } from '../../assets/texture-2d';\nimport { SubModel } from './submodel';\nimport { IMacroPatch, BatchingSchemes } from '../core/pass';\nimport { Mat4, Vec3, Vec4 } from '../../math';\nimport { Attribute, DescriptorSet, Device, Buffer, BufferInfo, getTypedArrayConstructor,\n    BufferUsageBit, FormatInfos, MemoryUsageBit, Filter, Address, Feature, SamplerInfo, deviceManager } from '../../gfx';\nimport { INST_MAT_WORLD, UBOLocal, UBOWorldBound, UNIFORM_LIGHTMAP_TEXTURE_BINDING } from '../../pipeline/define';\n\nconst m4_1 = new Mat4();\n\nconst shadowMapPatches: IMacroPatch[] = [\n    { name: 'CC_RECEIVE_SHADOW', value: true },\n];\n\nconst lightMapPatches: IMacroPatch[] = [\n    { name: 'CC_USE_LIGHTMAP', value: true },\n];\n\nexport enum ModelType {\n    DEFAULT,\n    SKINNING,\n    BAKED_SKINNING,\n    BATCH_2D,\n    PARTICLE_BATCH,\n    LINE,\n}\n\nconst lightmapSamplerHash = new SamplerInfo(\n    Filter.LINEAR,\n    Filter.LINEAR,\n    Filter.NONE,\n    Address.CLAMP,\n    Address.CLAMP,\n    Address.CLAMP,\n);\n\nconst lightmapSamplerWithMipHash = new SamplerInfo(\n    Filter.LINEAR,\n    Filter.LINEAR,\n    Filter.LINEAR,\n    Address.CLAMP,\n    Address.CLAMP,\n    Address.CLAMP,\n);\n\n/**\n * @en A representation of a model instance\n * The base model class, which is the core component of [[MeshRenderer]],\n * adds its own Model to the rendered scene for rendering submissions when [[MeshRenderer]] is enabled.\n * This type of object represents a rendering instance in a scene, and it can contain multiple sub models,\n * each of which corresponds to a material. These sub models share the same location and form a complete object.\n * Each sub model references a sub mesh resource, which provides vertex and index buffers for rendering.\n * @zh 代表一个模型实例\n * 基础模型类，它是 [[MeshRenderer]] 的核心组成部分，在 [[MeshRenderer]] 启用时会将自己的 Model 添加到渲染场景中用于提交渲染。\n * 此类型对象代表一个场景中的渲染实例，它可以包含多个子模型，每个子模型对应一个材质。这些子模型共享同样的位置，组成一个完整的物体。\n * 每个子模型引用一个子网格资源，后者提供渲染所用的顶点与索引缓冲。\n */\nexport class Model {\n    /**\n     * @en Sub models of the current model\n     * @zh 获取所有子模型\n     */\n    get subModels () {\n        return this._subModels;\n    }\n\n    /**\n     * @en Whether the model is initialized\n     * @zh 是否初始化\n     */\n    get inited (): boolean {\n        return this._inited;\n    }\n\n    /**\n     * @en The axis-aligned bounding box of the model in the world space\n     * @zh 获取世界空间包围盒\n     */\n    get worldBounds () {\n        return this._worldBounds!;\n    }\n\n    /**\n     * @en The axis-aligned bounding box of the model in the model space\n     * @zh 获取模型空间包围盒\n     */\n    get modelBounds () {\n        return this._modelBounds;\n    }\n\n    /**\n     * @en The ubo buffer of the model\n     * @zh 获取模型的 ubo 缓冲\n     */\n    get localBuffer () {\n        return this._localBuffer;\n    }\n\n    /**\n     * @en The world bound ubo buffer\n     * @zh 获取世界包围盒 ubo 缓冲\n     */\n    get worldBoundBuffer () {\n        return this._worldBoundBuffer;\n    }\n\n    /**\n     * @en The time stamp of last update\n     * @zh 获取上次更新时间戳\n     */\n    get updateStamp () {\n        return this._updateStamp;\n    }\n\n    /**\n     * @en Model level shadow bias\n     * @zh 阴影偏移值\n     */\n    get shadowBias () {\n        return this._shadowBias;\n    }\n\n    set shadowBias (val) {\n        this._shadowBias = val;\n    }\n\n    /**\n     * @en Model level shadow normal bias\n     * @zh 阴影法线偏移值\n     */\n    get shadowNormalBias () {\n        return this._shadowNormalBias;\n    }\n\n    set shadowNormalBias (val) {\n        this._shadowNormalBias = val;\n    }\n\n    /**\n     * @en Whether the model should receive shadow\n     * @zh 是否接收阴影\n     */\n    get receiveShadow () {\n        return this._receiveShadow;\n    }\n\n    set receiveShadow (val) {\n        this._receiveShadow = val;\n        this.onMacroPatchesStateChanged();\n    }\n\n    /**\n     * @en Whether the model should cast shadow\n     * @zh 是否投射阴影\n     */\n    get castShadow () {\n        return this._castShadow;\n    }\n\n    set castShadow (val) {\n        this._castShadow = val;\n    }\n\n    /**\n     * @en The node to which the model belongs\n     * @zh 模型所在的节点\n     */\n    get node () : Node {\n        return this._node;\n    }\n\n    set node (n: Node) {\n        this._node = n;\n    }\n\n    /**\n     * @en Model's transform\n     * @zh 模型的变换\n     */\n    get transform () : Node {\n        return this._transform;\n    }\n\n    set transform (n: Node) {\n        this._transform = n;\n    }\n\n    /**\n     * @en Model's visibility tag\n     * Model's visibility flags, it's different from [[Node.layer]],\n     * but it will also be compared with [[Camera.visibility]] during culling process.\n     * @zh 模型的可见性标志\n     * 模型的可见性标志与 [[Node.layer]] 不同，它会在剔除阶段与 [[Camera.visibility]] 进行比较\n     */\n    get visFlags () : number {\n        return this._visFlags;\n    }\n\n    set visFlags (val: number) {\n        this._visFlags = val;\n    }\n\n    /**\n     * @en Whether the model is enabled in the render scene so that it will be rendered\n     * @zh 模型是否在渲染场景中启用并被渲染\n     */\n    get enabled () : boolean {\n        return this._enabled;\n    }\n\n    set enabled (val: boolean) {\n        this._enabled = val;\n    }\n\n    /**\n     * @en Rendering priority in the transparent queue of model.\n     * @zh Model 在透明队列中的渲染排序优先级\n     */\n    get priority () : number {\n        return this._priority;\n    }\n\n    set priority (val: number) {\n        this._priority = val;\n    }\n\n    /**\n     * @en The type of the model\n     * @zh 模型类型\n     */\n    public type = ModelType.DEFAULT;\n\n    /**\n     * @en The render scene to which the model belongs\n     * @zh 模型所在的场景\n     */\n    public scene: RenderScene | null = null;\n\n    /**\n     * @en Whether dynamic batching is enabled for model\n     * @zh 是否动态合批\n     */\n    public isDynamicBatching = false;\n\n    /**\n     * @en The world axis-aligned bounding box\n     * @zh 世界空间包围盒\n     */\n    protected _worldBounds: AABB | null = null;\n\n    /**\n     * @en The model axis-aligned bounding box\n     * @zh 模型空间包围盒\n     */\n    protected _modelBounds: AABB | null = null;\n\n    /**\n     * @en Sub models\n     * @zh 子模型\n     */\n    protected _subModels: SubModel[] = [];\n\n    /**\n     * @en The node to which the model belongs\n     * @zh 模型所在的节点\n     */\n    protected _node: Node = null!;\n\n    /**\n     * @en Model's transform\n     * @zh 子模型的变换\n     */\n    protected _transform: Node = null!;\n\n    /**\n     * @en Current gfx device\n     * @zh 当前 GFX 设备\n     */\n    protected _device: Device;\n\n    /**\n     * @en Whether the model is initialized\n     * @zh 是否初始化过\n     */\n    protected _inited = false;\n\n    /**\n     * @en Descriptor set count\n     * @zh 描述符集合个数\n     */\n    protected _descriptorSetCount = 1;\n\n    /**\n     * @en Time stamp for last update\n     * @zh 更新时间戳\n     */\n    protected _updateStamp = -1;\n\n    /**\n     * @en Local ubo data dirty flag\n     * @zh 本地 ubo 数据是否修改过\n     */\n    protected _localDataUpdated = true;\n\n    /**\n     * @en Local ubo data\n     * @zh 本地 ubo 数据\n     */\n    protected _localData = new Float32Array(UBOLocal.COUNT);\n\n    /**\n     * @en Local ubo buffer\n     * @zh 本地 ubo 缓冲\n     */\n    protected _localBuffer: Buffer | null = null;\n\n    private _lightmap: Texture2D | null = null;\n    private _lightmapUVParam: Vec4 = new Vec4();\n\n    /**\n     * @en World AABB buffer\n     * @zh 世界空间包围盒缓冲\n     */\n    protected _worldBoundBuffer: Buffer | null = null;\n\n    /**\n     * @en Whether the model should receive shadow\n     * @zh 是否接收阴影\n     */\n    protected _receiveShadow = false;\n\n    /**\n     * @en Whether the model should cast shadow\n     * @zh 是否投射阴影\n     */\n    protected _castShadow = false;\n\n    /**\n     * @en Shadow bias\n     * @zh 阴影偏移\n     */\n    protected _shadowBias = 0;\n\n    /**\n     * @en Shadow normal bias\n     * @zh 阴影法线偏移\n     */\n    protected _shadowNormalBias = 0;\n\n    /**\n     * @en Whether the model is enabled in the render scene so that it will be rendered\n     * @zh 模型是否在渲染场景中启用并被渲染\n     */\n    protected _enabled = true;\n\n    /**\n     * @en The visibility flags\n     * @zh 可见性标志位\n     */\n    protected _visFlags = Layers.Enum.NONE;\n\n    protected _priority = 0;\n\n    /**\n     * @internal\n     * @en native object\n     * @zh 原生对象\n     */\n\n    /**\n     * @internal\n     * @en return native object\n     * @zh 返回原生对象\n     */\n    /**\n     * @en Constructor to create an empty model\n     * @zh 创建一个空模型\n     */\n    constructor () {\n        this._device = deviceManager.gfxDevice;\n    }\n\n    /**\n     * @en Initialize the model\n     * @zh 初始化模型\n     */\n    public initialize () {\n        if (this._inited) {\n            return;\n        }\n        this._receiveShadow = true;\n        this.castShadow = false;\n        this.enabled = true;\n        this.visFlags = Layers.Enum.NONE;\n        this._inited = true;\n    }\n\n    /**\n     * @en Destroy the model\n     * @zh 销毁模型\n     */\n    public destroy () {\n        const subModels = this._subModels;\n        for (let i = 0; i < subModels.length; i++) {\n            this._subModels[i].destroy();\n        }\n        if (this._localBuffer) {\n            this._localBuffer.destroy();\n            this._localBuffer = null;\n        }\n        if (this._worldBoundBuffer) {\n            this._worldBoundBuffer.destroy();\n            this._worldBoundBuffer = null;\n        }\n        this._worldBounds = null;\n        this._modelBounds = null;\n        this._subModels.length = 0;\n        this._inited = false;\n        this._localDataUpdated = true;\n        this._transform = null!;\n        this._node = null!;\n        this.isDynamicBatching = false;\n    }\n\n    /**\n     * @en Attach the model to a [[renderer.RenderScene]]\n     * @zh 添加模型到渲染场景 [[renderer.RenderScene]] 中\n     * @param scene destination scene\n     */\n    public attachToScene (scene: RenderScene) {\n        this.scene = scene;\n        this._localDataUpdated = true;\n    }\n\n    /**\n     * @en Detach the model from its render scene\n     * @zh 移除场景中的模型\n     */\n    public detachFromScene () {\n        this.scene = null;\n    }\n\n    /**\n     * @en Update the model's transform\n     * @zh 更新模型的变换\n     * @param stamp time stamp\n     */\n    public updateTransform (stamp: number) {\n        const node = this.transform;\n        // @ts-expect-error TS2445\n        if (node.hasChangedFlags || node._dirtyFlags) {\n            node.updateWorldTransform();\n            this._localDataUpdated = true;\n            const worldBounds = this._worldBounds;\n            if (this._modelBounds && worldBounds) {\n                // @ts-expect-error TS2445\n                this._modelBounds.transform(node._mat, node._pos, node._rot, node._scale, worldBounds);\n            }\n        }\n    }\n\n    /**\n     * @en Update the model's world AABB\n     * @zh 更新模型的世界空间包围盒\n     */\n    public updateWorldBound () {\n        const node = this.transform;\n        if (node !== null) {\n            node.updateWorldTransform();\n            this._localDataUpdated = true;\n            const worldBounds = this._worldBounds;\n            if (this._modelBounds && worldBounds) {\n                // @ts-expect-error TS2445\n                this._modelBounds.transform(node._mat, node._pos, node._rot, node._scale, worldBounds);\n            }\n        }\n    }\n\n    /**\n     * @en Update the model's ubo\n     * @zh 更新模型的 ubo\n     * @param stamp time stamp\n     */\n    public updateUBOs (stamp: number) {\n        const subModels = this._subModels;\n        for (let i = 0; i < subModels.length; i++) {\n            subModels[i].update();\n        }\n        this._updateStamp = stamp;\n\n        if (!this._localDataUpdated) { return; }\n        this._localDataUpdated = false;\n\n        // @ts-expect-error using private members here for efficiency\n        const worldMatrix = this.transform._mat;\n        let hasNonInstancingPass = false;\n        for (let i = 0; i < subModels.length; i++) {\n            const subModel = subModels[i];\n            const idx = subModel.instancedWorldMatrixIndex;\n            if (idx >= 0) {\n                subModel.updateInstancedWorldMatrix(worldMatrix, idx);\n            } else {\n                hasNonInstancingPass = true;\n            }\n        }\n        if (hasNonInstancingPass && this._localBuffer) {\n            Mat4.toArray(this._localData, worldMatrix, UBOLocal.MAT_WORLD_OFFSET);\n            Mat4.inverseTranspose(m4_1, worldMatrix);\n\n            Mat4.toArray(this._localData, m4_1, UBOLocal.MAT_WORLD_IT_OFFSET);\n            this._localBuffer.update(this._localData);\n        }\n    }\n\n    /**\n     * @en Create the model's AABB\n     * @zh 创建模型的包围盒\n     * @param minPos min position of the AABB\n     * @param maxPos max position of the AABB\n     */\n    public createBoundingShape (minPos?: Vec3, maxPos?: Vec3) {\n        if (!minPos || !maxPos) { return; }\n        this._modelBounds = AABB.fromPoints(AABB.create(), minPos, maxPos);\n        this._worldBounds = AABB.clone(this._modelBounds);\n    }\n\n    private _createSubModel () {\n        return new SubModel();\n    }\n\n    /**\n     * @en Initialize a sub model with the sub mesh data and the material.\n     * @zh 用子网格数据和材质初始化一个子模型。\n     * @param idx sub model's index\n     * @param subMeshData sub mesh\n     * @param mat sub material\n     */\n    public initSubModel (idx: number, subMeshData: RenderingSubMesh, mat: Material) {\n        this.initialize();\n\n        if (this._subModels[idx] == null) {\n            this._subModels[idx] = this._createSubModel();\n        } else {\n            this._subModels[idx].destroy();\n        }\n        this._subModels[idx].initialize(subMeshData, mat.passes, this.getMacroPatches(idx));\n\n        // This is a temporary solution\n        // It should not be written in a fixed way, or modified by the user\n        this._subModels[idx].initPlanarShadowShader();\n        this._subModels[idx].initPlanarShadowInstanceShader();\n\n        this._updateAttributesAndBinding(idx);\n    }\n\n    /**\n     * @en Set material for a given sub model\n     * @zh 为指定的子模型设置材质\n     * @param idx sub model's index\n     * @param subMesh sub mesh\n     */\n    public setSubModelMesh (idx: number, subMesh: RenderingSubMesh) {\n        if (!this._subModels[idx]) { return; }\n        this._subModels[idx].subMesh = subMesh;\n    }\n\n    /**\n     * @en Set a sub material\n     * @zh 设置一个子材质\n     * @param idx sub model's index\n     * @param mat sub material\n     */\n    public setSubModelMaterial (idx: number, mat: Material) {\n        if (!this._subModels[idx]) { return; }\n        this._subModels[idx].passes = mat.passes;\n        this._updateAttributesAndBinding(idx);\n    }\n\n    /**\n     * @en Pipeline changed callback\n     * @zh 管线更新回调\n     */\n    public onGlobalPipelineStateChanged () {\n        const subModels = this._subModels;\n        for (let i = 0; i < subModels.length; i++) {\n            subModels[i].onPipelineStateChanged();\n        }\n    }\n\n    /**\n     * @en Shader macro changed callback\n     * @zh Shader 宏更新回调\n     */\n    public onMacroPatchesStateChanged () {\n        const subModels = this._subModels;\n        for (let i = 0; i < subModels.length; i++) {\n            subModels[i].onMacroPatchesStateChanged(this.getMacroPatches(i));\n        }\n    }\n\n    public onGeometryChanged () {\n        const subModels = this._subModels;\n        for (let i = 0; i < subModels.length; i++) {\n            subModels[i].onGeometryChanged();\n        }\n    }\n\n    /**\n     * @internal\n     * If the model has lighting map\n     * initialize lighting map info before model initializing\n     * because the lighting map will influence the shader\n     */\n    public initLightingmap (texture: Texture2D | null, uvParam: Vec4) {\n        this._lightmap = texture;\n        this._lightmapUVParam = uvParam;\n    }\n\n    /**\n     * @en Update the light map info\n     * @zh 更新光照贴图信息\n     * @param texture light map\n     * @param uvParam uv coordinate\n     */\n    public updateLightingmap (texture: Texture2D | null, uvParam: Vec4) {\n        Vec4.toArray(this._localData, uvParam, UBOLocal.LIGHTINGMAP_UVPARAM);\n        this._localDataUpdated = true;\n        this._lightmap = texture;\n        this._lightmapUVParam = uvParam;\n\n        this.onMacroPatchesStateChanged();\n\n        if (!texture) {\n            texture = builtinResMgr.get<Texture2D>('empty-texture');\n        }\n\n        const gfxTexture = texture.getGFXTexture();\n        if (gfxTexture) {\n            const sampler = this._device.getSampler(texture.mipmaps.length > 1 ? lightmapSamplerWithMipHash : lightmapSamplerHash);\n            const subModels = this._subModels;\n            for (let i = 0; i < subModels.length; i++) {\n                const { descriptorSet } = subModels[i];\n                descriptorSet.bindTexture(UNIFORM_LIGHTMAP_TEXTURE_BINDING, gfxTexture);\n                descriptorSet.bindSampler(UNIFORM_LIGHTMAP_TEXTURE_BINDING, sampler);\n                descriptorSet.update();\n            }\n        }\n    }\n\n    /**\n     * @en Update the shadow bias\n     * @zh 更新阴影偏移\n     */\n    public updateLocalShadowBias () {\n        const sv = this._localData;\n        sv[UBOLocal.LOCAL_SHADOW_BIAS + 0] = this._shadowBias;\n        sv[UBOLocal.LOCAL_SHADOW_BIAS + 1] = this._shadowNormalBias;\n        sv[UBOLocal.LOCAL_SHADOW_BIAS + 2] = 0;\n        sv[UBOLocal.LOCAL_SHADOW_BIAS + 3] = 0;\n        this._localDataUpdated = true;\n    }\n\n    /**\n     * @en Return shader's macro patches\n     * @zh 获取 shader 宏\n     * @param subModelIndex sub model's index\n     */\n    public getMacroPatches (subModelIndex: number): IMacroPatch[] | null {\n        let patches = this.receiveShadow ? shadowMapPatches : null;\n        if (this._lightmap != null) {\n            patches = patches ? patches.concat(lightMapPatches) : lightMapPatches;\n        }\n        return patches;\n    }\n\n    protected _updateAttributesAndBinding (subModelIndex: number) {\n        const subModel = this._subModels[subModelIndex];\n        if (!subModel) { return; }\n\n        this._initLocalDescriptors(subModelIndex);\n        this._updateLocalDescriptors(subModelIndex, subModel.descriptorSet);\n\n        this._initWorldBoundDescriptors(subModelIndex);\n\n        if (subModel.worldBoundDescriptorSet) {\n            this._updateWorldBoundDescriptors(subModelIndex, subModel.worldBoundDescriptorSet);\n        }\n\n        const shader = subModel.passes[0].getShaderVariant(subModel.patches)!;\n        this._updateInstancedAttributes(shader.attributes, subModel);\n    }\n\n    // sub-classes can override the following functions if needed\n\n    // for now no subModel level instancing attributes\n    protected _updateInstancedAttributes (attributes: Attribute[], subModel: SubModel) {\n        subModel.UpdateInstancedAttributes(attributes);\n        this._localDataUpdated = true;\n    }\n\n    protected _initLocalDescriptors (subModelIndex: number) {\n        if (!this._localBuffer) {\n            this._localBuffer = this._device.createBuffer(new BufferInfo(\n                BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n                MemoryUsageBit.DEVICE,\n                UBOLocal.SIZE,\n                UBOLocal.SIZE,\n            ));\n        }\n    }\n\n    protected _initWorldBoundDescriptors (subModelIndex: number) {\n        if (!this._worldBoundBuffer) {\n            this._worldBoundBuffer = this._device.createBuffer(new BufferInfo(\n                BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n                MemoryUsageBit.DEVICE,\n                UBOWorldBound.SIZE,\n                UBOWorldBound.SIZE,\n            ));\n        }\n    }\n\n    protected _updateLocalDescriptors (subModelIndex: number, descriptorSet: DescriptorSet) {\n        if (this._localBuffer) descriptorSet.bindBuffer(UBOLocal.BINDING, this._localBuffer);\n    }\n\n    protected _updateWorldBoundDescriptors (subModelIndex: number, descriptorSet: DescriptorSet) {\n        if (this._worldBoundBuffer) descriptorSet.bindBuffer(UBOWorldBound.BINDING, this._worldBoundBuffer);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { BatchedBuffer } from './batched-buffer';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { RenderPass, Device, CommandBuffer, DescriptorSet } from '../gfx';\nimport { SetIndex } from './define';\n\n/**\n * @en The render queue for dynamic batching\n * @zh 渲染合批队列。\n */\nexport class RenderBatchedQueue {\n    /**\n     * @en A set of dynamic batched buffer\n     * @zh 动态合批缓存集合。\n     */\n    public queue = new Set<BatchedBuffer>();\n\n    /**\n     * @en Clear the render queue\n     * @zh 清空渲染队列。\n     */\n    public clear () {\n        const it = this.queue.values(); let res = it.next();\n        while (!res.done) {\n            res.value.clear();\n            res = it.next();\n        }\n        this.queue.clear();\n    }\n\n    public uploadBuffers (cmdBuff: CommandBuffer) {\n        const it = this.queue.values(); let res = it.next();\n        while (!res.done) {\n            for (let b = 0; b < res.value.batches.length; ++b) {\n                const batch = res.value.batches[b];\n                if (!batch.mergeCount) { continue; }\n                for (let v = 0; v < batch.vbs.length; ++v) {\n                    batch.vbs[v].update(batch.vbDatas[v]);\n                }\n                cmdBuff.updateBuffer(batch.vbIdx, batch.vbIdxData.buffer);\n                cmdBuff.updateBuffer(batch.ubo, batch.uboData);\n            }\n            res = it.next();\n        }\n    }\n\n    /**\n     * @en Record command buffer for the current queue\n     * @zh 记录命令缓冲。\n     * @param cmdBuff The command buffer to store the result\n     */\n    public recordCommandBuffer (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer,\n        descriptorSet: DescriptorSet | null = null, dynamicOffsets?: Readonly<number[]>) {\n        const it = this.queue.values(); let res = it.next();\n        while (!res.done) {\n            let boundPSO = false;\n            for (let b = 0; b < res.value.batches.length; ++b) {\n                const batch = res.value.batches[b];\n                if (!batch.mergeCount) { continue; }\n                if (!boundPSO) {\n                    const shader = batch.shader;\n                    const pso = PipelineStateManager.getOrCreatePipelineState(device, batch.pass, shader!, renderPass, batch.ia);\n                    cmdBuff.bindPipelineState(pso);\n                    cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, batch.pass.descriptorSet);\n                    boundPSO = true;\n                }\n                if (descriptorSet) cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, descriptorSet);\n                if (dynamicOffsets) {\n                    cmdBuff.bindDescriptorSet(SetIndex.LOCAL, batch.descriptorSet, dynamicOffsets);\n                } else {\n                    cmdBuff.bindDescriptorSet(SetIndex.LOCAL, batch.descriptorSet, res.value.dynamicOffsets);\n                }\n                cmdBuff.bindInputAssembler(batch.ia);\n                cmdBuff.draw(batch.ia);\n            }\n            res = it.next();\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { InstancedBuffer } from './instanced-buffer';\nimport { Device, RenderPass, PipelineState, CommandBuffer, DescriptorSet } from '../gfx';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { SetIndex } from './define';\n\n/**\n * @en Render queue for instanced batching\n * @zh 渲染合批队列。\n */\nexport class RenderInstancedQueue {\n    /**\n     * @en A set of instanced buffer\n     * @zh Instance 合批缓存集合。\n     */\n    public queue = new Set<InstancedBuffer>();\n\n    private _renderQueue : InstancedBuffer[] = [];\n\n    /**\n     * @en Clear the render queue\n     * @zh 清空渲染队列。\n     */\n    public clear () {\n        const it = this.queue.values(); let res = it.next();\n        while (!res.done) {\n            res.value.clear();\n            res = it.next();\n        }\n        this._renderQueue = [];\n        this.queue.clear();\n    }\n\n    public sort () {\n        let it = this.queue.values();\n        let res = it.next();\n        while (!res.done) {\n            if (!(res.value.pass.blendState.targets[0].blend)) {\n                this._renderQueue.push(res.value);\n            }\n            res = it.next();\n        }\n        it = this.queue.values();\n        res = it.next();\n        while (!res.done) {\n            if (res.value.pass.blendState.targets[0].blend) {\n                this._renderQueue.push(res.value);\n            }\n            res = it.next();\n        }\n    }\n\n    public uploadBuffers (cmdBuff: CommandBuffer) {\n        const it = this.queue.values(); let res = it.next();\n        while (!res.done) {\n            if (res.value.hasPendingModels) res.value.uploadBuffers(cmdBuff);\n            res = it.next();\n        }\n    }\n\n    /**\n     * @en Record command buffer for the current queue\n     * @zh 记录命令缓冲。\n     * @param cmdBuff The command buffer to store the result\n     */\n    public recordCommandBuffer (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer,\n        descriptorSet: DescriptorSet | null = null, dynamicOffsets?: Readonly<number[]>) {\n        const it = this._renderQueue.length === 0 ? this.queue.values() : this._renderQueue.values();\n        let res = it.next();\n\n        while (!res.done) {\n            const { instances, pass, hasPendingModels } = res.value;\n            if (hasPendingModels) {\n                cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n                let lastPSO: PipelineState | null = null;\n                for (let b = 0; b < instances.length; ++b) {\n                    const instance = instances[b];\n                    if (!instance.count) { continue; }\n                    const shader = instance.shader;\n                    const pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader!, renderPass, instance.ia);\n                    if (lastPSO !== pso) {\n                        cmdBuff.bindPipelineState(pso);\n                        lastPSO = pso;\n                    }\n                    if (descriptorSet) cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, descriptorSet);\n                    if (dynamicOffsets) {\n                        cmdBuff.bindDescriptorSet(SetIndex.LOCAL, instance.descriptorSet, dynamicOffsets);\n                    } else {\n                        cmdBuff.bindDescriptorSet(SetIndex.LOCAL, instance.descriptorSet, res.value.dynamicOffsets);\n                    }\n                    cmdBuff.bindInputAssembler(instance.ia);\n                    cmdBuff.draw(instance.ia);\n                }\n            }\n            res = it.next();\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { RenderingSubMesh } from '../../assets/rendering-sub-mesh';\nimport { RenderPriority, UNIFORM_REFLECTION_TEXTURE_BINDING, UNIFORM_REFLECTION_STORAGE_BINDING, INST_MAT_WORLD } from '../../pipeline/define';\nimport { BatchingSchemes, IMacroPatch, Pass } from '../core/pass';\nimport { DescriptorSet, DescriptorSetInfo, Device, InputAssembler, Texture, TextureType, TextureUsageBit, TextureInfo,\n    Format, Sampler, Filter, Address, Shader, SamplerInfo, deviceManager, Attribute, Feature, FormatInfos, getTypedArrayConstructor } from '../../gfx';\nimport { legacyCC } from '../../global-exports';\nimport { errorID } from '../../platform/debug';\nimport { getPhaseID } from '../../pipeline/pass-phase';\nimport { Root } from '../../root';\nimport { Mat4 } from '../..';\n\nconst _dsInfo = new DescriptorSetInfo(null!);\nconst MAX_PASS_COUNT = 8;\n\nexport interface IInstancedAttributeBlock {\n    buffer: Uint8Array;\n    views: TypedArray[];\n    attributes: Attribute[];\n}\n\n/**\n * @en A sub part of the model, it describes how to render a specific sub mesh.\n * It contains geometry information in [[RenderingSubMesh]] and all sort of rendering configuration like shaders, macro patches, passes etc.\n * @zh 组成模型对象的子模型，它用来描述如何渲染模型的一个子网格。\n * 它包含 [[RenderingSubMesh]] 代表的几何网格信息和所有渲染需要的数据，比如着色器程序，着色器宏定义，渲染 pass，等。\n */\nexport class SubModel {\n    protected _device: Device | null = null;\n    protected _passes: Pass[] | null = null;\n    protected _shaders: Shader[] | null = null;\n    protected _subMesh: RenderingSubMesh | null = null;\n    protected _patches: IMacroPatch[] | null = null;\n    protected _priority: RenderPriority = RenderPriority.DEFAULT;\n    protected _inputAssembler: InputAssembler | null = null;\n    protected _descriptorSet: DescriptorSet | null = null;\n    protected _worldBoundDescriptorSet: DescriptorSet | null = null;\n    protected _planarInstanceShader: Shader | null = null;\n    protected _planarShader: Shader | null = null;\n    protected _reflectionTex: Texture | null = null;\n    protected _reflectionSampler: Sampler | null = null;\n    protected _instancedAttributeBlock: IInstancedAttributeBlock = { buffer: null!, views: [], attributes: [] };\n    protected _instancedWorldMatrixIndex = -1;\n\n    /**\n     * @en\n     * sub model's passes\n     * @zh\n     * 子模型的 passes\n     * @param passes @en The passes @zh 设置的 passes\n     */\n    /**\n     * @en Render passes for the sub-model\n     * @zh 子模型的渲染 pass\n     */\n    set passes (passes) {\n        const passLengh = passes.length;\n        if (passLengh > MAX_PASS_COUNT) {\n            errorID(12004, MAX_PASS_COUNT);\n            return;\n        }\n        this._passes = passes;\n        this._flushPassInfo();\n        if (this._passes[0].batchingScheme === BatchingSchemes.VB_MERGING) {\n            this.subMesh.genFlatBuffers();\n        }\n\n        // DS layout might change too\n        if (this._descriptorSet) {\n            this._descriptorSet.destroy();\n            _dsInfo.layout = passes[0].localSetLayout;\n            this._descriptorSet = this._device!.createDescriptorSet(_dsInfo);\n        }\n    }\n\n    get passes (): Pass[] {\n        return this._passes!;\n    }\n\n    /**\n     * @en Shaders for the sub-model, each shader corresponds to one of the [[passes]]\n     * @zh 子模型的着色器程序列表，每个着色器程序对应其中一个渲染 [[passes]]\n     */\n    get shaders (): Shader[] {\n        return this._shaders!;\n    }\n\n    /**\n     * @en The rendering sub mesh for the sub-model, each sub-model can only have one sub mesh.\n     * @zh 用于渲染的子网格对象，每个子模型只能包含一个子网格。\n     */\n    set subMesh (subMesh) {\n        this._inputAssembler!.destroy();\n        this._inputAssembler = this._device!.createInputAssembler(subMesh.iaInfo);\n        if (this._passes![0].batchingScheme === BatchingSchemes.VB_MERGING) { this.subMesh.genFlatBuffers(); }\n        this._subMesh = subMesh;\n    }\n\n    get subMesh (): RenderingSubMesh {\n        return this._subMesh!;\n    }\n\n    /**\n     * @en The rendering priority of the sub-model\n     * @zh 子模型的渲染优先级\n     */\n    set priority (val) {\n        this._priority = val;\n    }\n\n    get priority (): RenderPriority {\n        return this._priority;\n    }\n\n    /**\n     * @en The low level input assembler which contains geometry data\n     * @zh 底层渲染用的输入汇集器，包含几何信息\n     */\n    get inputAssembler (): InputAssembler {\n        return this._inputAssembler!;\n    }\n\n    /**\n     * @en The descriptor set used for sub-model rendering\n     * @zh 底层渲染子模型用的描述符集组\n     */\n    get descriptorSet (): DescriptorSet {\n        return this._descriptorSet!;\n    }\n\n    /**\n     * @en The descriptor set for world bound\n     * @zh 用于存储世界包围盒的描述符集组\n     */\n    get worldBoundDescriptorSet (): DescriptorSet | null {\n        return this._worldBoundDescriptorSet;\n    }\n\n    /**\n     * @en The macro patches for the shaders\n     * @zh 着色器程序所用的宏定义组合\n     */\n    get patches (): IMacroPatch[] | null {\n        return this._patches;\n    }\n\n    /**\n     * @en The shader for rendering the planar shadow, instancing draw version.\n     * @zh 用于渲染平面阴影的着色器，适用于实例化渲染（instancing draw）\n     */\n    get planarInstanceShader (): Shader | null {\n        return this._planarInstanceShader;\n    }\n\n    /**\n     * @en The shader for rendering the planar shadow.\n     * @zh 用于渲染平面阴影的着色器。\n     */\n    get planarShader (): Shader | null {\n        return this._planarShader;\n    }\n\n    /**\n     * @en The instance attribute block, access by sub model\n     * @zh 硬件实例化属性，通过子模型访问\n     */\n    get instancedAttributeBlock () {\n        return this._instancedAttributeBlock;\n    }\n\n    /**\n     * @en Get or set instance matrix id, access by sub model\n     * @zh 获取或者设置硬件实例化中的矩阵索引，通过子模型访问\n     */\n    set instancedWorldMatrixIndex (val : number) {\n        this._instancedWorldMatrixIndex = val;\n    }\n    get instancedWorldMatrixIndex () {\n        return this._instancedWorldMatrixIndex;\n    }\n\n    /**\n     * @en\n     * init sub model\n     * @zh\n     * 子模型初始化\n     * @param subMesh @en The sub mesh @zh 子网格资源\n     * @param passes @en The passes @zh 渲染的 passes\n     * @param patches @en The shader's macro @zh 着色器的宏定义\n     */\n    public initialize (subMesh: RenderingSubMesh, passes: Pass[], patches: IMacroPatch[] | null = null): void {\n        const root = legacyCC.director.root as Root;\n        this._device = deviceManager.gfxDevice;\n        _dsInfo.layout = passes[0].localSetLayout;\n\n        this._inputAssembler = this._device.createInputAssembler(subMesh.iaInfo);\n        this._descriptorSet = this._device.createDescriptorSet(_dsInfo);\n\n        const pipeline = (legacyCC.director.root as Root).pipeline;\n        const occlusionPass = pipeline.pipelineSceneData.getOcclusionQueryPass();\n        if (occlusionPass) {\n            const occlusionDSInfo = new DescriptorSetInfo(null!);\n            occlusionDSInfo.layout = occlusionPass.localSetLayout;\n            this._worldBoundDescriptorSet = this._device.createDescriptorSet(occlusionDSInfo);\n        }\n\n        this._subMesh = subMesh;\n        this._patches = patches;\n        this._passes = passes;\n\n        this._flushPassInfo();\n        if (passes[0].batchingScheme === BatchingSchemes.VB_MERGING) {\n            this.subMesh.genFlatBuffers();\n        }\n\n        this.priority = RenderPriority.DEFAULT;\n\n        // initialize resources for reflection material\n        if (passes[0].phase === getPhaseID('reflection')) {\n            let texWidth = root.mainWindow!.width;\n            let texHeight = root.mainWindow!.height;\n            const minSize = 512;\n\n            if (texHeight < texWidth) {\n                texWidth = minSize * texWidth / texHeight;\n                texHeight = minSize;\n            } else {\n                texWidth = minSize;\n                texHeight = minSize * texHeight / texWidth;\n            }\n\n            this._reflectionTex = this._device.createTexture(new TextureInfo(\n                TextureType.TEX2D,\n                TextureUsageBit.STORAGE | TextureUsageBit.TRANSFER_SRC | TextureUsageBit.SAMPLED,\n                Format.RGBA8,\n                texWidth,\n                texHeight,\n            ));\n\n            this.descriptorSet.bindTexture(UNIFORM_REFLECTION_TEXTURE_BINDING, this._reflectionTex);\n\n            this._reflectionSampler = this._device.getSampler(new SamplerInfo(\n                Filter.LINEAR,\n                Filter.LINEAR,\n                Filter.NONE,\n                Address.CLAMP,\n                Address.CLAMP,\n                Address.CLAMP,\n            ));\n            this.descriptorSet.bindSampler(UNIFORM_REFLECTION_TEXTURE_BINDING, this._reflectionSampler);\n            this.descriptorSet.bindTexture(UNIFORM_REFLECTION_STORAGE_BINDING, this._reflectionTex);\n        }\n    }\n\n    /**\n     * @en\n     * init planar shadow's shader\n     * @zh\n     * 平面阴影着色器初始化\n     */\n    public initPlanarShadowShader () {\n        const pipeline = (legacyCC.director.root as Root).pipeline;\n        const shadowInfo = pipeline.pipelineSceneData.shadows;\n        this._planarShader = shadowInfo.getPlanarShader(this._patches);\n    }\n\n    /**\n     * @en\n     * init planar shadow's instance shader\n     * @zh\n     * 平面阴影实例着色器初始化\n     */\n    /**\n     * @internal\n     */\n    public initPlanarShadowInstanceShader () {\n        const pipeline = (legacyCC.director.root as Root).pipeline;\n        const shadowInfo = pipeline.pipelineSceneData.shadows;\n        this._planarInstanceShader = shadowInfo.getPlanarInstanceShader(this._patches);\n    }\n\n    /**\n     * @en\n     * destroy sub model\n     * @zh\n     * 销毁子模型\n     */\n    public destroy (): void {\n        this._descriptorSet!.destroy();\n        this._descriptorSet = null;\n\n        this._inputAssembler!.destroy();\n        this._inputAssembler = null;\n\n        this._worldBoundDescriptorSet?.destroy();\n        this._worldBoundDescriptorSet = null;\n\n        this.priority = RenderPriority.DEFAULT;\n\n        this._patches = null;\n        this._subMesh = null;\n\n        this._passes = null;\n        this._shaders = null;\n\n        if (this._reflectionTex) this._reflectionTex.destroy();\n        this._reflectionTex = null;\n        this._reflectionSampler = null;\n    }\n\n    /**\n     * @en\n     * update sub model\n     * @zh\n     * 更新子模型\n     */\n    public update (): void {\n        for (let i = 0; i < this._passes!.length; ++i) {\n            const pass = this._passes![i];\n            pass.update();\n        }\n        this._descriptorSet!.update();\n        this._worldBoundDescriptorSet?.update();\n    }\n\n    /**\n     * @en Pipeline changed callback\n     * @zh 管线更新回调\n     */\n    public onPipelineStateChanged (): void {\n        const passes = this._passes;\n        if (!passes) { return; }\n\n        for (let i = 0; i < passes.length; i++) {\n            const pass = passes[i];\n            pass.beginChangeStatesSilently();\n            pass.tryCompile(); // force update shaders\n            pass.endChangeStatesSilently();\n        }\n\n        this._flushPassInfo();\n    }\n\n    /**\n     * @en Shader macro changed callback\n     * @zh Shader 宏更新回调\n     */\n    public onMacroPatchesStateChanged (patches: IMacroPatch[] | null): void {\n        this._patches = patches;\n\n        const passes = this._passes;\n        if (!passes) { return; }\n\n        for (let i = 0; i < passes.length; i++) {\n            const pass = passes[i];\n            pass.beginChangeStatesSilently();\n            pass.tryCompile(); // force update shaders\n            pass.endChangeStatesSilently();\n        }\n\n        this._flushPassInfo();\n    }\n\n    /**\n     * @en\n     * geometry changed callback\n     * @zh\n     * 几何数据改变后的回调\n     */\n    public onGeometryChanged (): void {\n        if (!this._subMesh) {\n            return;\n        }\n\n        // update draw info\n        const drawInfo = this._subMesh.drawInfo;\n\n        // to invoke getter/setter function for wasm object\n        if (this._inputAssembler && drawInfo) {\n            const dirtyDrawInfo = this._inputAssembler.drawInfo;\n            Object.keys(drawInfo).forEach((key) => {\n                dirtyDrawInfo[key] = drawInfo[key];\n            });\n            this._inputAssembler.drawInfo = dirtyDrawInfo;\n        }\n    }\n\n    /**\n     * @en\n     * get instanced attribute index\n     * @zh\n     * 获取硬件实例化相关索引\n     */\n    /**\n     * @internal\n     */\n    public getInstancedAttributeIndex (name: string) {\n        const { attributes } = this.instancedAttributeBlock;\n        for (let i = 0; i < attributes.length; i++) {\n            if (attributes[i].name === name) { return i; }\n        }\n        return -1;\n    }\n\n    /**\n     * @en\n     * update instancing related data, invoked by model\n     * @zh\n     * 更新硬件实例化相关数据，一般由model调用\n     */\n    /**\n     * @internal\n     */\n    public updateInstancedWorldMatrix (mat: Mat4, idx: number) {\n        const attrs = this.instancedAttributeBlock.views;\n        const v1 = attrs[idx];\n        const v2 = attrs[idx + 1];\n        const v3 = attrs[idx + 2];\n        v1[0] = mat.m00; v1[1] = mat.m01; v1[2] = mat.m02; v1[3] = mat.m12;\n        v2[0] = mat.m04; v2[1] = mat.m05; v2[2] = mat.m06; v2[3] = mat.m13;\n        v3[0] = mat.m08; v3[1] = mat.m09; v3[2] = mat.m10; v3[3] = mat.m14;\n    }\n    /**\n     * @en\n     * update instancing related data, invoked by model\n     * @zh\n     * 更新硬件实例化相关数据，一般由model调用\n     */\n    /**\n     * @internal\n     */\n    public UpdateInstancedAttributes (attributes: Attribute[]) {\n        // initialize subModelWorldMatrixIndex\n        this.instancedWorldMatrixIndex = -1;\n\n        const pass = this.passes[0];\n        if (!pass.device.hasFeature(Feature.INSTANCED_ARRAYS)) { return; }\n        // free old data\n\n        let size = 0;\n        for (let j = 0; j < attributes.length; j++) {\n            const attribute = attributes[j];\n            if (!attribute.isInstanced) { continue; }\n            size += FormatInfos[attribute.format].size;\n        }\n\n        const attrs = this.instancedAttributeBlock;\n        attrs.buffer = new Uint8Array(size);\n        attrs.views.length = attrs.attributes.length = 0;\n        let offset = 0;\n        for (let j = 0; j < attributes.length; j++) {\n            const attribute = attributes[j];\n            if (!attribute.isInstanced) { continue; }\n            const attr = new Attribute();\n            attr.format = attribute.format;\n            attr.name = attribute.name;\n            attr.isNormalized = attribute.isNormalized;\n            attr.location = attribute.location;\n            attrs.attributes.push(attr);\n\n            const info = FormatInfos[attribute.format];\n\n            const typeViewArray = new (getTypedArrayConstructor(info))(attrs.buffer.buffer, offset, info.count);\n            attrs.views.push(typeViewArray);\n            offset += info.size;\n        }\n        if (pass.batchingScheme === BatchingSchemes.INSTANCING) { pass.getInstancedBuffer().destroy(); } // instancing IA changed\n        this.instancedWorldMatrixIndex = this.getInstancedAttributeIndex(INST_MAT_WORLD);\n    }\n\n    protected _flushPassInfo (): void {\n        const passes = this._passes;\n        if (!passes) { return; }\n        if (!this._shaders) { this._shaders = []; }\n\n        this._shaders.length = passes.length;\n        for (let i = 0, len = passes.length; i < len; i++) {\n            this._shaders[i] = passes[i].getShaderVariant(this.patches)!;\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Vec3 } from '../../math/vec3';\nimport { OctreeInfo } from '../../scene-graph/scene-globals';\n\n/**\n * @en The octree culling configuration of the render scene\n * @zh 渲染场景的八叉树剔除配置\n */\nexport class Octree {\n    /**\n     * @en Whether octree culling is enabled in the render scene\n     * @zh 是否开启八叉树加速剔除\n     */\n    set enabled (val: boolean) {\n        this._enabled = val;\n    }\n    get enabled (): boolean {\n        return this._enabled;\n    }\n\n    /**\n     * @en Minimum position of the scene's bounding box\n     * @zh 场景包围盒最小值\n     */\n    get minPos (): Vec3 {\n        return this._minPos;\n    }\n    set minPos (val: Vec3) {\n        this._minPos = val;\n    }\n\n    /**\n     * @en Maximum position of the scene's bounding box\n     * @zh 场景包围盒最大值\n     */\n    get maxPos (): Vec3 {\n        return this._maxPos;\n    }\n    set maxPos (val: Vec3) {\n        this._maxPos = val;\n    }\n\n    /**\n     * @en The depth of the octree\n     * @zh 八叉树深度\n     */\n    get depth (): number {\n        return this._depth;\n    }\n\n    set depth (val: number) {\n        this._depth = val;\n    }\n\n    protected _enabled = false;\n    protected _minPos = new Vec3(0, 0, 0);\n    protected _maxPos = new Vec3(0, 0, 0);\n    protected _depth = 0;\n\n    public initialize (octreeInfo: OctreeInfo) {\n        this._enabled = octreeInfo.enabled;\n        this._minPos = octreeInfo.minPos;\n        this._maxPos = octreeInfo.maxPos;\n        this._depth = octreeInfo.depth;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { legacyCC } from '../../global-exports';\nimport { Vec3 } from '../../math';\nimport { Ambient } from './ambient';\nimport { Light, LightType } from './light';\nimport { CSMLevel, CSMOptimizationMode, PCFType, Shadows, ShadowType } from './shadows';\n\nconst _forward = new Vec3(0, 0, -1);\nconst _v3 = new Vec3();\n\n/**\n * @en The directional light representation in the render scene, it acts as the main light source in a scene.\n * As main light, only one directional light can be created in a scene, it can generate realtime shadows with configuration.\n * @zh 渲染场景中的方向光抽象，这是场景中的主光源。作为主光源，每个场景只能有一个方向光，它也包含阴影配置，用来生成实时阴影。\n */\nexport class DirectionalLight extends Light {\n    protected _dir: Vec3 = new Vec3(1.0, -1.0, -1.0);\n    protected _illuminanceHDR: number = Ambient.SUN_ILLUM;\n    protected _illuminanceLDR = 1.0;\n\n    // Public properties of shadow\n    protected _shadowEnabled = false;\n\n    // Shadow map properties\n    protected _shadowPcf = PCFType.HARD;\n    protected _shadowBias = 0.00001;\n    protected _shadowNormalBias = 0.0;\n    protected _shadowSaturation = 1.0;\n    protected _shadowDistance = 50;\n    protected _shadowInvisibleOcclusionRange = 200;\n    protected _csmLevel = CSMLevel.LEVEL_4;\n    protected _csmNeedUpdate = false;\n    protected _csmLayerLambda = 0.75;\n    protected _csmOptimizationMode = CSMOptimizationMode.DisableRotationFix;\n\n    // fixed area properties\n    protected _shadowFixedArea = false;\n    protected _shadowNear = 0.1;\n    protected _shadowFar = 10.0;\n    protected _shadowOrthoSize = 5;\n\n    /**\n     * @en The direction vector of the light\n     * @zh 光源的方向\n     */\n    set direction (dir: Vec3) {\n        Vec3.normalize(this._dir, dir);\n    }\n\n    get direction (): Vec3 {\n        return this._dir;\n    }\n\n    /**\n     * @en The illuminance of the light in Lux(lx)\n     * @zh 光源的辐照度，单位是 Lux(lx)\n     */\n    get illuminance (): number {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._illuminanceHDR;\n        } else {\n            return this._illuminanceLDR;\n        }\n    }\n    set illuminance (value: number) {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this.illuminanceHDR = value;\n        } else {\n            this.illuminanceLDR = value;\n        }\n    }\n\n    /**\n     * @en The illuminance of the light in HDR mode\n     * @zh HDR 模式下光源的辐照度\n     */\n    get illuminanceHDR () {\n        return this._illuminanceHDR;\n    }\n    set illuminanceHDR (value: number) {\n        this._illuminanceHDR = value;\n    }\n\n    /**\n     * @en The illuminance of the light in LDR mode\n     * @zh LDR 模式下光源的辐照度\n     */\n    get illuminanceLDR () {\n        return this._illuminanceLDR;\n    }\n    set illuminanceLDR (value: number) {\n        this._illuminanceLDR = value;\n    }\n\n    /**\n     * @en Whether activate shadow\n     * @zh 是否启用阴影？\n     */\n    get shadowEnabled () {\n        return this._shadowEnabled;\n    }\n    set shadowEnabled (val) {\n        this._shadowEnabled = val;\n        this._activate();\n    }\n\n    /**\n     * @en get or set shadow pcf.\n     * @zh 获取或者设置阴影pcf等级。\n     */\n    get shadowPcf () {\n        return this._shadowPcf;\n    }\n    set shadowPcf (val) {\n        this._shadowPcf = val;\n        this._activate();\n    }\n\n    /**\n     * @en get or set shadow map sampler offset\n     * @zh 获取或者设置阴影纹理偏移值\n     */\n    get shadowBias () {\n        return this._shadowBias;\n    }\n    set shadowBias (val) {\n        this._shadowBias = val;\n    }\n\n    /**\n     * @en get or set normal bias.\n     * @zh 设置或者获取法线偏移。\n     */\n    get shadowNormalBias () {\n        return this._shadowNormalBias;\n    }\n    set shadowNormalBias (val: number) {\n        this._shadowNormalBias = val;\n    }\n\n    /**\n     * @en Shadow color saturation\n     * @zh 阴影颜色饱和度\n     */\n    get shadowSaturation () {\n        return this._shadowSaturation;\n    }\n    set shadowSaturation (val: number) {\n        this._shadowSaturation = val;\n    }\n\n    /**\n     * @en get or set shadow camera far\n     * @zh 获取或者设置潜在阴影产生的范围\n     */\n    get shadowDistance () {\n        return this._shadowDistance;\n    }\n    set shadowDistance (val) {\n        this._shadowDistance = Math.min(val, Shadows.MAX_FAR);\n    }\n\n    /**\n     * @en get or set shadow camera far\n     * @zh 获取或者设置潜在阴影产生的范围\n     */\n    get shadowInvisibleOcclusionRange () {\n        return this._shadowInvisibleOcclusionRange;\n    }\n    set shadowInvisibleOcclusionRange (val) {\n        this._shadowInvisibleOcclusionRange = Math.min(val, Shadows.MAX_FAR);\n    }\n\n    /**\n     * @en get or set shadow CSM level\n     * @zh 获取或者设置级联阴影层数\n     */\n    get csmLevel () {\n        return this._csmLevel;\n    }\n    set csmLevel (val) {\n        this._csmLevel = val;\n        this._activate();\n    }\n\n    /**\n     * @en is CSM need update\n     * @zh 获取或者设置级联阴影是否需要更新\n     */\n    get csmNeedUpdate () {\n        return this._csmNeedUpdate;\n    }\n    set csmNeedUpdate (val) {\n        this._csmNeedUpdate = val;\n    }\n\n    /**\n     * @en get or set shadow CSM level ratio\n     * @zh 获取或者设置级联阴影层数系数\n     */\n    get csmLayerLambda () {\n        return this._csmLayerLambda;\n    }\n    set csmLayerLambda (val) {\n        this._csmLayerLambda = val;\n    }\n\n    /**\n     * @en get or set shadow CSM performance optimization mode\n     * @zh 获取或者设置级联阴影性能优化模式\n     */\n    get csmOptimizationMode () {\n        return this._csmOptimizationMode;\n    }\n    set csmOptimizationMode (val) {\n        this._csmOptimizationMode = val;\n    }\n\n    /**\n     * @en get or set fixed area shadow\n     * @zh 是否是固定区域阴影\n     */\n    get shadowFixedArea () {\n        return this._shadowFixedArea;\n    }\n    set shadowFixedArea (val) {\n        this._shadowFixedArea = val;\n        this._activate();\n    }\n\n    /**\n     * @en The near clip plane of the shadow camera\n     * @zh 获取或者设置阴影相机近裁剪面\n     */\n    get shadowNear () {\n        return this._shadowNear;\n    }\n    set shadowNear (val) {\n        this._shadowNear = val;\n    }\n\n    /**\n     * @en The far clip plane of the shadow camera\n     * @zh 获取或者设置阴影相机远裁剪面\n     */\n    get shadowFar () {\n        return this._shadowFar;\n    }\n    set shadowFar (val) {\n        this._shadowFar = Math.min(val, Shadows.MAX_FAR);\n    }\n\n    /**\n     * @en get or set shadow camera orthoSize\n     * @zh 获取或者设置阴影相机正交大小\n     */\n    get shadowOrthoSize () {\n        return this._shadowOrthoSize;\n    }\n    set shadowOrthoSize (val) {\n        this._shadowOrthoSize = val;\n    }\n\n    constructor () {\n        super();\n        this._type = LightType.DIRECTIONAL;\n    }\n\n    public initialize () {\n        super.initialize();\n\n        this.illuminance = Ambient.SUN_ILLUM;\n        this.direction = new Vec3(1.0, -1.0, -1.0);\n    }\n\n    /**\n     * @en Update the direction\n     * @zh 更新方向\n     */\n    public update () {\n        if (this._node && this._node.hasChangedFlags) {\n            this.direction = Vec3.transformQuat(_v3, _forward, this._node.worldRotation);\n        }\n    }\n\n    private _activate () {\n        const root = legacyCC.director.root;\n        const pipeline = root.pipeline;\n        if (this._shadowEnabled) {\n            if (this._shadowFixedArea || !pipeline.pipelineSceneData.csmSupported) {\n                pipeline.macros.CC_DIR_LIGHT_SHADOW_TYPE = 1;\n            } else {\n                pipeline.macros.CC_DIR_LIGHT_SHADOW_TYPE = this.csmLevel > 1 ? 2 : 1;\n            }\n            pipeline.macros.CC_DIR_SHADOW_PCF_TYPE = this._shadowPcf;\n        } else {\n            pipeline.macros.CC_DIR_LIGHT_SHADOW_TYPE = 0;\n        }\n        root.onGlobalPipelineStateChanged();\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { AABB, Frustum } from '../../geometry';\nimport { legacyCC } from '../../global-exports';\nimport { Mat4, Quat, Vec3 } from '../../math';\nimport { Light, LightType, nt2lm } from './light';\nimport { PCFType } from './shadows';\n\nconst _forward = new Vec3(0, 0, -1);\nconst _qt = new Quat();\nconst _matView = new Mat4();\nconst _matProj = new Mat4();\nconst _matViewProj = new Mat4();\nconst _matViewProjInv = new Mat4();\n\n/**\n * @en The spot light representation in the render scene, it will light up a cone area in the direction of the light, it supports shadow generation.\n * @zh 渲染场景中的聚光灯抽象，可以照亮光源方向上的一个锥形区域，支持生成阴影。\n */\nexport class SpotLight extends Light {\n    protected _dir: Vec3 = new Vec3(1.0, -1.0, -1.0);\n\n    protected _range = 5.0;\n\n    protected _spotAngle: number = Math.cos(Math.PI / 6);\n\n    protected _pos: Vec3;\n\n    protected _aabb: AABB;\n\n    protected _frustum: Frustum;\n\n    /**\n     * @en User-specified full-angle radians.\n     * @zh 用户指定的全角弧度。\n     */\n    protected _angle = 0;\n\n    protected _needUpdate = false;\n\n    protected _size = 0.15;\n\n    protected _luminanceHDR = 0;\n\n    protected _luminanceLDR = 0;\n\n    // Shadow map properties\n    protected _shadowEnabled = false;\n    protected _shadowPcf = PCFType.HARD;\n    protected _shadowBias = 0.00001;\n    protected _shadowNormalBias = 0.0;\n\n    /**\n     * @en The world position of the light source\n     * @zh 光源的世界坐标\n     */\n    get position () {\n        return this._pos;\n    }\n\n    /**\n     * @en The size of the spot light source\n     * @zh 聚光灯的光源尺寸\n     */\n    set size (size: number) {\n        this._size = size;\n    }\n\n    get size (): number {\n        return this._size;\n    }\n\n    /**\n     * @en The lighting range of the spot light\n     * @zh 聚光灯的光照范围\n     */\n    set range (range: number) {\n        this._range = range;\n\n        this._needUpdate = true;\n    }\n\n    get range (): number {\n        return this._range;\n    }\n\n    /**\n     * @en The luminance of the light source\n     * @zh 光源的亮度\n     */\n    get luminance (): number {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._luminanceHDR;\n        } else {\n            return this._luminanceLDR;\n        }\n    }\n    set luminance (value: number) {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this.luminanceHDR = value;\n        } else {\n            this.luminanceLDR = value;\n        }\n    }\n\n    /**\n     * @en The luminance of the light source in HDR mode\n     * @zh HDR 模式下光源的亮度\n     */\n    get luminanceHDR () {\n        return this._luminanceHDR;\n    }\n    set luminanceHDR (value: number) {\n        this._luminanceHDR = value;\n    }\n\n    /**\n     * @en The luminance of the light source in LDR mode\n     * @zh LDR 模式下光源的亮度\n     */\n    get luminanceLDR () {\n        return this._luminanceLDR;\n    }\n    set luminanceLDR (value: number) {\n        this._luminanceLDR = value;\n    }\n\n    /**\n     * @en The direction of the spot light\n     * @zh 聚光灯的照明方向\n     */\n    get direction (): Vec3 {\n        return this._dir;\n    }\n\n    /**\n     * @en The setter will take the value as the cone angle,\n     * but the getter will give you the cosine value of the half cone angle: `cos(angle / 2)`.\n     * As the in-consistence is not acceptable for a property, please do not use it.\n     * @zh 赋值时这个属性会把输入值当做聚光灯光照区域的锥角，但是获取时返回的是 cos(angle / 2)。\n     * 由于这种不一致性，请不要使用这个属性。\n     * @internal\n     */\n    get spotAngle () {\n        return this._spotAngle;\n    }\n    set spotAngle (val: number) {\n        this._angle = val;\n        this._spotAngle = Math.cos(val * 0.5);\n\n        this._needUpdate = true;\n    }\n\n    /**\n     * @en The cone angle of the lighting area\n     * @zh 聚光灯锥角\n     */\n    get angle () {\n        return this._angle;\n    }\n\n    get aabb () {\n        return this._aabb;\n    }\n\n    /**\n     * @en The frustum of the lighting area\n     * @zh 受光源影响范围的截椎体\n     */\n    get frustum () {\n        return this._frustum;\n    }\n\n    /**\n     * @en Whether shadow casting is enabled\n     * @zh 是否启用阴影？\n     */\n    get shadowEnabled () {\n        return this._shadowEnabled;\n    }\n    set shadowEnabled (val) {\n        this._shadowEnabled = val;\n    }\n\n    /**\n     * @en The pcf level of the shadow generation.\n     * @zh 获取或者设置阴影 pcf 等级。\n     */\n    get shadowPcf () {\n        return this._shadowPcf;\n    }\n    set shadowPcf (val) {\n        this._shadowPcf = val;\n    }\n\n    /**\n     * @en The depth offset of shadow to avoid moire pattern artifacts\n     * @zh 阴影的深度偏移, 可以减弱跨像素导致的条纹状失真\n     */\n    get shadowBias () {\n        return this._shadowBias;\n    }\n    set shadowBias (val) {\n        this._shadowBias = val;\n    }\n\n    /**\n      * @en The normal bias of the shadow map.\n      * @zh 设置或者获取法线偏移。\n      */\n    get shadowNormalBias () {\n        return this._shadowNormalBias;\n    }\n    set shadowNormalBias (val: number) {\n        this._shadowNormalBias = val;\n    }\n\n    constructor () {\n        super();\n        this._aabb = AABB.create();\n        this._frustum = Frustum.create();\n        this._pos = new Vec3();\n        this._type = LightType.SPOT;\n    }\n\n    public initialize () {\n        super.initialize();\n\n        const size = 0.15;\n        this.size = size;\n        this.luminanceHDR = 1700 / nt2lm(size);\n        this.luminanceLDR = 1.0;\n        this.range = Math.cos(Math.PI / 6);\n        this._dir.set(new Vec3(1.0, -1.0, -1.0));\n    }\n\n    public update () {\n        if (this._node && (this._node.hasChangedFlags || this._needUpdate)) {\n            this._node.getWorldPosition(this._pos);\n            Vec3.transformQuat(this._dir, _forward, this._node.getWorldRotation(_qt));\n            Vec3.normalize(this._dir, this._dir);\n\n            AABB.set(this._aabb, this._pos.x, this._pos.y, this._pos.z, this._range, this._range, this._range);\n\n            // view matrix\n            this._node.getWorldRT(_matView);\n            Mat4.invert(_matView, _matView);\n\n            Mat4.perspective(_matProj, this._angle, 1.0, 0.001, this._range);\n\n            // view-projection\n            Mat4.multiply(_matViewProj, _matProj, _matView);\n            // Mat4.invert(_matViewProjInv, _matViewProj);\n\n            this._frustum.update(_matViewProj, _matViewProjInv);\n\n            this._needUpdate = false;\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { AABB } from '../../geometry';\nimport { legacyCC } from '../../global-exports';\nimport { Vec3 } from '../../math';\nimport { Light, LightType, nt2lm } from './light';\n\n/**\n * @en The sphere light representation in the render scene, it will light up a spherical area in the scene.\n * It doesn't support shadow generation currently.\n * @zh 渲染场景中的球面光抽象，可以照亮场景中的一个球形区域，目前还不支持生成阴影。\n */\nexport class SphereLight extends Light {\n    /**\n     * @en The world position of the light source\n     * @zh 光源中心点的世界坐标\n     */\n    get position () {\n        return this._pos;\n    }\n\n    /**\n     * @en The size of the light source\n     * @zh 球面光源的尺寸\n     */\n    set size (size: number) {\n        this._size = size;\n    }\n\n    get size (): number {\n        return this._size;\n    }\n\n    /**\n     * @en The lighting range of the light source\n     * @zh 球面光源的光照范围\n     */\n    set range (range: number) {\n        this._range = range;\n\n        this._needUpdate = true;\n    }\n\n    get range (): number {\n        return this._range;\n    }\n\n    /**\n     * @en The luminance of the light source\n     * @zh 光源的亮度\n     */\n    get luminance (): number {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            return this._luminanceHDR;\n        } else {\n            return this._luminanceLDR;\n        }\n    }\n    set luminance (value: number) {\n        const isHDR = (legacyCC.director.root).pipeline.pipelineSceneData.isHDR;\n        if (isHDR) {\n            this.luminanceHDR = value;\n        } else {\n            this.luminanceLDR = value;\n        }\n    }\n\n    /**\n     * @en The luminance of the light source in HDR mode\n     * @zh HDR 模式下光源的亮度\n     */\n    get luminanceHDR () {\n        return this._luminanceHDR;\n    }\n    set luminanceHDR (value: number) {\n        this._luminanceHDR = value;\n    }\n\n    /**\n     * @en The luminance of the light source in LDR mode\n     * @zh LDR 模式下光源的亮度\n     */\n    set luminanceLDR (value: number) {\n        this._luminanceLDR = value;\n    }\n\n    /**\n     * @en The AABB bounding box of the lighting area\n     * @zh 受光源影响范围的 AABB 包围盒\n     */\n    get aabb () {\n        return this._aabb;\n    }\n\n    protected _needUpdate = false;\n    protected _size = 0.15;\n    protected _range = 1.0;\n    protected _luminanceHDR = 0;\n    protected _luminanceLDR = 0;\n    protected _pos: Vec3;\n    protected _aabb: AABB;\n\n    constructor () {\n        super();\n        this._aabb = AABB.create();\n        this._pos = new Vec3();\n        this._type = LightType.SPHERE;\n    }\n\n    public initialize () {\n        super.initialize();\n\n        const size = 0.15;\n        this.size = size;\n        this.range = 1.0;\n        this.luminanceHDR = 1700 / nt2lm(size);\n        this.luminanceLDR = 1.0;\n    }\n\n    /**\n     * @en Update the lighting area\n     * @zh 更新光源影响范围\n     */\n    public update () {\n        if (this._node && (this._node.hasChangedFlags || this._needUpdate)) {\n            this._node.getWorldPosition(this._pos);\n            const range = this._range;\n            AABB.set(this._aabb, this._pos.x, this._pos.y, this._pos.z, range, range, range);\n            this._needUpdate = false;\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { BatchingSchemes, Pass } from '../renderer/core/pass';\nimport { Model } from '../renderer/scene/model';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { Vec3, nextPow2, Mat4, Color } from '../math';\nimport { intersect } from '../geometry';\nimport { Device, RenderPass, Buffer, BufferUsageBit, MemoryUsageBit,\n    BufferInfo, BufferViewInfo, CommandBuffer } from '../gfx';\nimport { Pool } from '../memop';\nimport { RenderBatchedQueue } from './render-batched-queue';\nimport { RenderInstancedQueue } from './render-instanced-queue';\nimport { SphereLight } from '../renderer/scene/sphere-light';\nimport { SpotLight } from '../renderer/scene/spot-light';\nimport { SubModel } from '../renderer/scene/submodel';\nimport { getPhaseID } from './pass-phase';\nimport { Light, LightType } from '../renderer/scene/light';\nimport { SetIndex, UBOForwardLight, UBOShadow, UNIFORM_SHADOWMAP_BINDING,\n    UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, supportsR32FloatTexture } from './define';\nimport { Camera, ShadowType } from '../renderer/scene';\nimport { GlobalDSManager } from './global-descriptor-set-manager';\nimport { PipelineUBO } from './pipeline-ubo';\nimport { PipelineRuntime } from './custom/pipeline';\n\ninterface IAdditiveLightPass {\n    subModel: SubModel;\n    passIdx: number;\n    dynamicOffsets: number[];\n    lights: Light[];\n}\n\nconst _lightPassPool = new Pool<IAdditiveLightPass>(() => ({ subModel: null!, passIdx: -1, dynamicOffsets: [], lights: [] }), 16);\n\nconst _vec4Array = new Float32Array(4);\nconst _dynamicOffsets: number[] = [];\nconst _lightIndices: number[] = [];\nconst _matShadowView = new Mat4();\nconst _matShadowViewProj = new Mat4();\n\nfunction cullSphereLight (light: SphereLight, model: Model) {\n    return !!(model.worldBounds && !intersect.aabbWithAABB(model.worldBounds, light.aabb));\n}\n\nfunction cullSpotLight (light: SpotLight, model: Model) {\n    return !!(model.worldBounds\n        && (!intersect.aabbWithAABB(model.worldBounds, light.aabb) || !intersect.aabbFrustum(model.worldBounds, light.frustum)));\n}\n\nconst _phaseID = getPhaseID('forward-add');\nconst _lightPassIndices: number[] = [];\nfunction getLightPassIndices (subModels: SubModel[], lightPassIndices: number[]) {\n    lightPassIndices.length = 0;\n    let hasValidLightPass = false;\n    for (let j = 0; j < subModels.length; j++) {\n        const { passes } = subModels[j];\n        let lightPassIndex = -1;\n        for (let k = 0; k < passes.length; k++) {\n            if (passes[k].phase === _phaseID) {\n                lightPassIndex = k;\n                hasValidLightPass = true;\n                break;\n            }\n        }\n        lightPassIndices.push(lightPassIndex);\n    }\n    return hasValidLightPass;\n}\n\nfunction isInstancedOrBatched (model: Model) {\n    const subModels = model.subModels;\n    for (let m = 0; m < subModels.length; ++m) {\n        const passes = subModels[m].passes;\n        for (let p = 0; p < passes.length; ++p) {\n            const pass = passes[p];\n            const batchingScheme = pass.batchingScheme;\n            if (batchingScheme === BatchingSchemes.INSTANCING) {\n                return true;\n            }\n            if (batchingScheme === BatchingSchemes.VB_MERGING) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n/**\n * @zh 叠加光照队列。\n */\nexport class RenderAdditiveLightQueue {\n    private _pipeline: PipelineRuntime;\n    private _device: Device;\n    private _lightPasses: IAdditiveLightPass[] = [];\n    private _instancedLightPassPool = _lightPassPool.alloc();\n    private _batchedLightPassPool = _lightPassPool.alloc();\n    private _shadowUBO = new Float32Array(UBOShadow.COUNT);\n    private _lightBufferCount = 16;\n    private _lightBufferStride: number;\n    private _lightBufferElementCount: number;\n    private _lightBuffer: Buffer;\n    private _firstLightBufferView: Buffer;\n    private _lightBufferData: Float32Array;\n    private _instancedQueue: RenderInstancedQueue;\n    private _batchedQueue: RenderBatchedQueue;\n    private _lightMeterScale = 10000.0;\n\n    constructor (pipeline: PipelineRuntime) {\n        this._pipeline = pipeline;\n        this._device = pipeline.device;\n        this._instancedQueue = new RenderInstancedQueue();\n        this._batchedQueue = new RenderBatchedQueue();\n\n        const alignment = this._device.capabilities.uboOffsetAlignment;\n        this._lightBufferStride = Math.ceil(UBOForwardLight.SIZE / alignment) * alignment;\n        this._lightBufferElementCount = this._lightBufferStride / Float32Array.BYTES_PER_ELEMENT;\n\n        this._lightBuffer = this._device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            this._lightBufferStride * this._lightBufferCount,\n            this._lightBufferStride,\n        ));\n\n        this._firstLightBufferView = this._device.createBuffer(new BufferViewInfo(this._lightBuffer, 0, UBOForwardLight.SIZE));\n\n        this._lightBufferData = new Float32Array(this._lightBufferElementCount * this._lightBufferCount);\n    }\n\n    public clear () {\n        this._instancedQueue.clear();\n        this._batchedQueue.clear();\n\n        for (let i = 0; i < this._lightPasses.length; i++) {\n            const lp = this._lightPasses[i];\n            lp.dynamicOffsets.length = 0;\n            lp.lights.length = 0;\n        }\n        _lightPassPool.freeArray(this._lightPasses);\n        this._lightPasses.length = 0;\n\n        this._instancedLightPassPool.dynamicOffsets.length = 0;\n        this._instancedLightPassPool.lights.length = 0;\n        this._batchedLightPassPool.dynamicOffsets.length = 0;\n        this._batchedLightPassPool.lights.length = 0;\n    }\n\n    public destroy () {\n        const descriptorSetMap = this._pipeline.globalDSManager.descriptorSetMap;\n        const keys = descriptorSetMap.keys;\n\n        for (let i = 0; i < keys.length; i++) {\n            const key = keys[i];\n            const descriptorSet = descriptorSetMap.get(key)!;\n            if (descriptorSet) {\n                descriptorSet.getBuffer(UBOShadow.BINDING).destroy();\n                descriptorSet.getTexture(UNIFORM_SHADOWMAP_BINDING).destroy();\n                descriptorSet.getTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING).destroy();\n                descriptorSet.destroy();\n            }\n            descriptorSetMap.delete(key);\n        }\n    }\n\n    public gatherLightPasses (camera: Camera, cmdBuff: CommandBuffer) {\n        this.clear();\n\n        const validPunctualLights = this._pipeline.pipelineSceneData.validPunctualLights;\n        if (!validPunctualLights.length) { return; }\n\n        this._updateUBOs(camera, cmdBuff);\n        this._updateLightDescriptorSet(camera, cmdBuff);\n        const renderObjects = this._pipeline.pipelineSceneData.renderObjects;\n        for (let i = 0; i < renderObjects.length; i++) {\n            const ro = renderObjects[i];\n            const { model } = ro;\n            const { subModels } = model;\n            if (!getLightPassIndices(subModels, _lightPassIndices)) { continue; }\n\n            _lightIndices.length = 0;\n\n            this._lightCulling(model, validPunctualLights);\n\n            if (!_lightIndices.length) { continue; }\n\n            for (let j = 0; j < subModels.length; j++) {\n                const lightPassIdx = _lightPassIndices[j];\n                if (lightPassIdx < 0) { continue; }\n                const subModel = subModels[j];\n                const pass = subModel.passes[lightPassIdx];\n                // object has translucent base pass, prohibiting forward-add pass for multi light sources lighting\n                const isTransparent = subModel.passes[0].blendState.targets[0].blend;\n                if (isTransparent) {\n                    continue;\n                }\n                subModel.descriptorSet.bindBuffer(UBOForwardLight.BINDING, this._firstLightBufferView);\n                subModel.descriptorSet.update();\n\n                this._addRenderQueue(pass, subModel, model, lightPassIdx);\n            }\n        }\n\n        // only for instanced and batched, no light culling applied\n        for (let l = 0; l < validPunctualLights.length; l++) {\n            const light = validPunctualLights[l];\n            this._instancedLightPassPool.lights.push(light);\n            this._instancedLightPassPool.dynamicOffsets.push(this._lightBufferStride * l);\n            this._batchedLightPassPool.lights.push(light);\n            this._batchedLightPassPool.dynamicOffsets.push(this._lightBufferStride * l);\n        }\n        this._instancedQueue.uploadBuffers(cmdBuff);\n        this._batchedQueue.uploadBuffers(cmdBuff);\n    }\n\n    public recordCommandBuffer (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer) {\n        const globalDSManager: GlobalDSManager = this._pipeline.globalDSManager;\n        for (let j = 0; j < this._instancedLightPassPool.lights.length; ++j) {\n            const light = this._instancedLightPassPool.lights[j];\n            _dynamicOffsets[0] = this._instancedLightPassPool.dynamicOffsets[j];\n            const descriptorSet = globalDSManager.getOrCreateDescriptorSet(light);\n            this._instancedQueue.recordCommandBuffer(device, renderPass, cmdBuff, descriptorSet, _dynamicOffsets);\n        }\n\n        for (let j = 0; j < this._batchedLightPassPool.lights.length; ++j) {\n            const light = this._batchedLightPassPool.lights[j];\n            _dynamicOffsets[0] = this._batchedLightPassPool.dynamicOffsets[j];\n            const descriptorSet = globalDSManager.getOrCreateDescriptorSet(light);\n            this._batchedQueue.recordCommandBuffer(device, renderPass, cmdBuff, descriptorSet, _dynamicOffsets);\n        }\n\n        for (let i = 0; i < this._lightPasses.length; i++) {\n            const { subModel, passIdx, dynamicOffsets, lights } = this._lightPasses[i];\n            const pass = subModel.passes[passIdx];\n            const shader = subModel.shaders[passIdx];\n            const ia = subModel.inputAssembler;\n            const pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader, renderPass, ia);\n            const matDS = pass.descriptorSet;\n            const localDS = subModel.descriptorSet;\n\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, matDS);\n            cmdBuff.bindInputAssembler(ia);\n\n            for (let j = 0; j < dynamicOffsets.length; ++j) {\n                const light = lights[j];\n                const descriptorSet = globalDSManager.getOrCreateDescriptorSet(light)!;\n                _dynamicOffsets[0] = dynamicOffsets[j];\n                cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, descriptorSet);\n                cmdBuff.bindDescriptorSet(SetIndex.LOCAL, localDS, _dynamicOffsets);\n                cmdBuff.draw(ia);\n            }\n        }\n    }\n\n    // light culling\n    protected _lightCulling (model:Model, validPunctualLights: Light[]) {\n        let isCulled = false;\n        const isNeedCulling = !isInstancedOrBatched(model);\n        for (let l = 0; l < validPunctualLights.length; l++) {\n            const light = validPunctualLights[l];\n            switch (light.type) {\n            case LightType.SPHERE:\n                if (isNeedCulling) { isCulled = cullSphereLight(light as SphereLight, model); }\n                break;\n            case LightType.SPOT:\n                if (isNeedCulling) { isCulled = cullSpotLight(light as SpotLight, model); }\n                break;\n            default:\n            }\n            if (!isCulled) {\n                _lightIndices.push(l);\n            }\n        }\n    }\n\n    // add renderQueue\n    protected _addRenderQueue (pass: Pass, subModel: SubModel, model: Model, lightPassIdx: number) {\n        const validPunctualLights = this._pipeline.pipelineSceneData.validPunctualLights;\n        const { batchingScheme } = pass;\n        if (batchingScheme === BatchingSchemes.INSTANCING) {            // instancing\n            const buffer = pass.getInstancedBuffer();\n            buffer.merge(subModel, lightPassIdx);\n            buffer.dynamicOffsets[0] = this._lightBufferStride;\n            this._instancedQueue.queue.add(buffer);\n        } else if (batchingScheme === BatchingSchemes.VB_MERGING) {     // vb-merging\n            const buffer = pass.getBatchedBuffer();\n            buffer.merge(subModel, lightPassIdx, model);\n            buffer.dynamicOffsets[0] = this._lightBufferStride;\n            this._batchedQueue.queue.add(buffer);\n        } else {                                                         // standard draw\n            const lp = _lightPassPool.alloc();\n            lp.subModel = subModel;\n            lp.passIdx = lightPassIdx;\n            for (let l = 0; l < _lightIndices.length; l++) {\n                const lightIdx = _lightIndices[l];\n                const light = validPunctualLights[lightIdx];\n                lp.lights.push(light);\n                lp.dynamicOffsets.push(this._lightBufferStride * lightIdx);\n            }\n            this._lightPasses.push(lp);\n        }\n    }\n\n    // update light DescriptorSet\n    protected _updateLightDescriptorSet (camera: Camera, cmdBuff: CommandBuffer) {\n        const device = this._pipeline.device;\n        const sceneData = this._pipeline.pipelineSceneData;\n        const shadowInfo = sceneData.shadows;\n        const shadowFrameBufferMap = sceneData.shadowFrameBufferMap;\n        const mainLight = camera.scene!.mainLight;\n        const packing = supportsR32FloatTexture(device) ? 0.0 : 1.0;\n        const globalDSManager: GlobalDSManager = this._pipeline.globalDSManager;\n        const validPunctualLights = sceneData.validPunctualLights;\n        const cap = this._pipeline.device.capabilities;\n\n        for (let i = 0; i < validPunctualLights.length; i++) {\n            const light = validPunctualLights[i];\n            const descriptorSet = globalDSManager.getOrCreateDescriptorSet(light);\n            if (!descriptorSet) { continue; }\n            let matShadowProj : Mat4;\n            let matShadowInvProj : Mat4;\n            switch (light.type) {\n            case LightType.SPHERE: {\n                // planar PROJ\n                if (mainLight) {\n                    PipelineUBO.updatePlanarNormalAndDistance(shadowInfo, this._shadowUBO);\n                }\n\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 0] = shadowInfo.size.x;\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 1] = shadowInfo.size.y;\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 2] = 1.0;\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 3] = 0.0;\n\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 0] = 2.0;\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 1] = packing;\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 2] = 0.0;\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 3] = 0.0;\n\n                // Reserve sphere light shadow interface\n                Color.toArray(this._shadowUBO, shadowInfo.shadowColor, UBOShadow.SHADOW_COLOR_OFFSET);\n                break;\n            }\n            case LightType.SPOT: {\n                const spotLight = light as SpotLight;\n\n                // planar PROJ\n                if (mainLight) {\n                    PipelineUBO.updatePlanarNormalAndDistance(shadowInfo, this._shadowUBO);\n                }\n\n                // light view\n                Mat4.invert(_matShadowView, (light as SpotLight).node!.getWorldMatrix());\n\n                // light proj\n                Mat4.perspective(_matShadowViewProj, (light as SpotLight).angle, 1.0, 0.001, (light as SpotLight).range,\n                    true, cap.clipSpaceMinZ, cap.clipSpaceSignY, 0);\n                matShadowProj = _matShadowViewProj.clone();\n                matShadowInvProj = _matShadowViewProj.clone().invert();\n\n                // light viewProj\n                Mat4.multiply(_matShadowViewProj, _matShadowViewProj, _matShadowView);\n\n                Mat4.toArray(this._shadowUBO, _matShadowView, UBOShadow.MAT_LIGHT_VIEW_OFFSET);\n                Mat4.toArray(this._shadowUBO, _matShadowViewProj, UBOShadow.MAT_LIGHT_VIEW_PROJ_OFFSET);\n\n                this._shadowUBO[UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET + 0] = 0.01;\n                this._shadowUBO[UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET + 1] = (light as SpotLight).range;\n                this._shadowUBO[UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET + 2] = 0.0;\n                this._shadowUBO[UBOShadow.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET + 3] = 0.0;\n\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 0] = shadowInfo.size.x;\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 1] = shadowInfo.size.y;\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 2] = spotLight.shadowPcf;\n                this._shadowUBO[UBOShadow.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET + 3] = spotLight.shadowBias;\n\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 0] = 1.0;\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 1] = packing;\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 2] = spotLight.shadowNormalBias;\n                this._shadowUBO[UBOShadow.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET + 3] = 0.0;\n\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 0] = matShadowProj.m10;\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 1] = matShadowProj.m14;\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 2] = matShadowProj.m11;\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_DEPTH_INFO_OFFSET + 3] = matShadowProj.m15;\n\n                this._shadowUBO[UBOShadow.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET + 0] = matShadowInvProj.m10;\n                this._shadowUBO[UBOShadow.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET + 1] = matShadowInvProj.m14;\n                this._shadowUBO[UBOShadow.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET + 2] = matShadowInvProj.m11;\n                this._shadowUBO[UBOShadow.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET + 3] = matShadowInvProj.m15;\n\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 0] = matShadowProj.m00;\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 1] = matShadowProj.m05;\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 2] = 1.0 / matShadowProj.m00;\n                this._shadowUBO[UBOShadow.SHADOW_PROJ_INFO_OFFSET + 3] = 1.0 / matShadowProj.m05;\n\n                Color.toArray(this._shadowUBO, shadowInfo.shadowColor, UBOShadow.SHADOW_COLOR_OFFSET);\n\n                // Spot light sampler binding\n                if (shadowFrameBufferMap.has(light)) {\n                    const texture = shadowFrameBufferMap.get(light)?.colorTextures[0];\n                    if (texture) {\n                        descriptorSet.bindTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, texture);\n                    }\n                }\n                break;\n            }\n            default:\n            }\n            descriptorSet.update();\n\n            cmdBuff.updateBuffer(descriptorSet.getBuffer(UBOShadow.BINDING)!, this._shadowUBO);\n        }\n    }\n\n    protected _updateUBOs (camera: Camera, cmdBuff: CommandBuffer) {\n        const { exposure } = camera;\n        const sceneData = this._pipeline.pipelineSceneData;\n        const isHDR = sceneData.isHDR;\n        const shadowInfo = sceneData.shadows;\n        const validPunctualLights = sceneData.validPunctualLights;\n\n        if (validPunctualLights.length > this._lightBufferCount) {\n            this._firstLightBufferView.destroy();\n\n            this._lightBufferCount = nextPow2(validPunctualLights.length);\n            this._lightBuffer.resize(this._lightBufferStride * this._lightBufferCount);\n            this._lightBufferData = new Float32Array(this._lightBufferElementCount * this._lightBufferCount);\n\n            this._firstLightBufferView.initialize(new BufferViewInfo(this._lightBuffer, 0, UBOForwardLight.SIZE));\n        }\n\n        for (let l = 0, offset = 0; l < validPunctualLights.length; l++, offset += this._lightBufferElementCount) {\n            const light = validPunctualLights[l];\n\n            switch (light.type) {\n            case LightType.SPHERE:\n                // UBOForwardLight\n                Vec3.toArray(_vec4Array, (light as SphereLight).position);\n                _vec4Array[3] = 0;\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_POS_OFFSET);\n\n                _vec4Array[0] = (light as SphereLight).size;\n                _vec4Array[1] = (light as SphereLight).range;\n                _vec4Array[2] = 0.0;\n                _vec4Array[3] = 0.0;\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_SIZE_RANGE_ANGLE_OFFSET);\n\n                Vec3.toArray(_vec4Array, light.color);\n                if (light.useColorTemperature) {\n                    const tempRGB = light.colorTemperatureRGB;\n                    _vec4Array[0] *= tempRGB.x;\n                    _vec4Array[1] *= tempRGB.y;\n                    _vec4Array[2] *= tempRGB.z;\n                }\n                if (isHDR) {\n                    _vec4Array[3] = (light as SphereLight).luminance * exposure * this._lightMeterScale;\n                } else {\n                    _vec4Array[3] = (light as SphereLight).luminance;\n                }\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_COLOR_OFFSET);\n                break;\n            case LightType.SPOT:\n                // UBOForwardLight\n                Vec3.toArray(_vec4Array, (light as SpotLight).position);\n                _vec4Array[3] = 1;\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_POS_OFFSET);\n\n                _vec4Array[0] = (light as SpotLight).size;\n                _vec4Array[1] = (light as SpotLight).range;\n                _vec4Array[2] = (light as SpotLight).spotAngle;\n                _vec4Array[3] = (shadowInfo.enabled && (light as SpotLight).shadowEnabled && shadowInfo.type === ShadowType.ShadowMap) ? 1 : 0;\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_SIZE_RANGE_ANGLE_OFFSET);\n\n                Vec3.toArray(_vec4Array, (light as SpotLight).direction);\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_DIR_OFFSET);\n\n                Vec3.toArray(_vec4Array, light.color);\n                if (light.useColorTemperature) {\n                    const tempRGB = light.colorTemperatureRGB;\n                    _vec4Array[0] *= tempRGB.x;\n                    _vec4Array[1] *= tempRGB.y;\n                    _vec4Array[2] *= tempRGB.z;\n                }\n                if (isHDR) {\n                    _vec4Array[3] = (light as SpotLight).luminance * exposure * this._lightMeterScale;\n                } else {\n                    _vec4Array[3] = (light as SpotLight).luminance;\n                }\n                this._lightBufferData.set(_vec4Array, offset + UBOForwardLight.LIGHT_COLOR_OFFSET);\n                break;\n            default:\n            }\n        }\n\n        cmdBuff.updateBuffer(this._lightBuffer, this._lightBufferData);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { AABB, intersect } from '../geometry';\nimport { SetIndex } from './define';\nimport { CommandBuffer, Device, RenderPass } from '../gfx';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { Model, Camera, SubModel } from '../renderer/scene';\nimport { RenderInstancedQueue } from './render-instanced-queue';\nimport { ShadowType } from '../renderer/scene/shadows';\nimport { Layers } from '../scene-graph/layers';\nimport { PipelineRuntime } from './custom/pipeline';\nimport { BatchingSchemes } from '../renderer/core/pass';\n\nconst _ab = new AABB();\n\nexport class PlanarShadowQueue {\n    private _pendingSubModels: SubModel[] = [];\n    private _castModels:Model[] = [];\n    private _instancedQueue = new RenderInstancedQueue();\n    private _pipeline: PipelineRuntime;\n\n    constructor (pipeline: PipelineRuntime) {\n        this._pipeline = pipeline;\n    }\n\n    public gatherShadowPasses (camera: Camera, cmdBuff: CommandBuffer) {\n        const pipelineSceneData = this._pipeline.pipelineSceneData;\n        const shadows = pipelineSceneData.shadows;\n        this._instancedQueue.clear();\n        this._pendingSubModels.length = 0;\n        this._castModels.length = 0;\n        if (!shadows.enabled || shadows.type !== ShadowType.Planar || shadows.normal.length() < 0.000001) { return; }\n\n        const scene = camera.scene!;\n        const frustum = camera.frustum;\n        const shadowVisible =  (camera.visibility & Layers.BitMask.DEFAULT) !== 0;\n        if (!scene.mainLight || !shadowVisible) { return; }\n\n        const models = scene.models;\n        for (let i = 0; i < models.length; i++) {\n            const model = models[i];\n            if (model.enabled && model.node && model.castShadow) { this._castModels.push(model); }\n        }\n        const instancedBuffer = shadows.instancingMaterial.passes[0].getInstancedBuffer();\n        this._instancedQueue.queue.add(instancedBuffer);\n\n        for (let i = 0; i < this._castModels.length; i++) {\n            const model = this._castModels[i];\n            if (model.worldBounds) {\n                AABB.transform(_ab, model.worldBounds, shadows.matLight);\n                if (!intersect.aabbFrustum(_ab, frustum)) { continue; }\n            }\n\n            const subModels = model.subModels;\n            for (let j = 0; j < subModels.length; j++) {\n                const subModel = subModels[j];\n                const passes = subModel.passes;\n                for (let k = 0; k < passes.length; k++) {\n                    const pass = passes[k];\n                    const batchingScheme = pass.batchingScheme;\n                    if (batchingScheme === BatchingSchemes.INSTANCING) {\n                        instancedBuffer.merge(subModel, k, subModel.planarShader);\n                        this._instancedQueue.queue.add(instancedBuffer);\n                    } else {\n                        this._pendingSubModels.push(subModel);\n                    }\n                }\n            }\n        }\n        this._instancedQueue.uploadBuffers(cmdBuff);\n    }\n\n    public recordCommandBuffer (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer) {\n        const shadows = this._pipeline.pipelineSceneData.shadows;\n\n        if (!shadows.enabled || shadows.type !== ShadowType.Planar) { return; }\n        this._instancedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n\n        if (!this._pendingSubModels.length) { return; }\n        const pass = shadows.material.passes[0];\n        const descriptorSet = pass.descriptorSet;\n        cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, descriptorSet);\n\n        const subModels = this._pendingSubModels;\n        for (let j = 0; j < subModels.length; j++) {\n            const subModel = subModels[j];\n            // This is a temporary solution\n            // It should not be written in a fixed way, or modified by the user\n            const shader = subModel.planarShader;\n            const ia = subModel.inputAssembler;\n            const pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader!, renderPass, ia);\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindDescriptorSet(SetIndex.LOCAL, subModel.descriptorSet);\n            cmdBuff.bindInputAssembler(ia);\n            cmdBuff.draw(ia);\n        }\n    }\n}\n","/*\n Copyright (c) 2018-2021 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { RenderPass } from '../gfx';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { SetIndex } from './define';\nimport { Camera } from '../renderer/scene/camera';\nimport { RenderPipeline } from './render-pipeline';\nimport { getPhaseID } from './pass-phase';\n\nexport class UIPhase {\n    private _phaseID = getPhaseID('default');\n    private declare _pipeline: RenderPipeline;\n\n    public activate (pipeline: RenderPipeline) {\n        this._pipeline = pipeline;\n    }\n\n    public render (camera: Camera, renderPass: RenderPass) {\n        const pipeline = this._pipeline;\n        const device = pipeline.device;\n        const cmdBuff = pipeline.commandBuffers[0];\n        const scene = camera.scene!;\n        const batches = scene.batches;\n        for (let i = 0; i < batches.length; i++) {\n            const batch = batches[i];\n            let visible = false;\n            if (camera.visibility & batch.visFlags) {\n                visible = true;\n            }\n\n            if (!visible) continue;\n            // shaders.length always equals actual used passes.length\n            const count = batch.shaders.length;\n            for (let j = 0; j < count; j++) {\n                const pass = batch.passes[j];\n                if (pass.phase !== this._phaseID) continue;\n                const shader = batch.shaders[j];\n                const inputAssembler = batch.inputAssembler!;\n                const pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader, renderPass, inputAssembler);\n                cmdBuff.bindPipelineState(pso);\n                cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n                const ds = batch.descriptorSet!;\n                cmdBuff.bindDescriptorSet(SetIndex.LOCAL, ds);\n                cmdBuff.bindInputAssembler(inputAssembler);\n                cmdBuff.draw(inputAssembler);\n            }\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, displayOrder, type, serializable } from 'cc.decorator';\nimport { SetIndex } from '../define';\nimport { getPhaseID } from '../pass-phase';\nimport { renderQueueClearFunc, RenderQueue, convertRenderQueue, renderQueueSortFunc } from '../render-queue';\nimport { ClearFlagBit, Color, Rect } from '../../gfx';\nimport { RenderBatchedQueue } from '../render-batched-queue';\nimport { RenderInstancedQueue } from '../render-instanced-queue';\nimport { IRenderStageInfo, RenderStage } from '../render-stage';\nimport { ForwardStagePriority } from '../enum';\nimport { RenderAdditiveLightQueue } from '../render-additive-light-queue';\nimport { BatchingSchemes } from '../../renderer/core/pass';\nimport { ForwardFlow } from './forward-flow';\nimport { ForwardPipeline } from './forward-pipeline';\nimport { RenderQueueDesc, RenderQueueSortMode } from '../pipeline-serialization';\nimport { PlanarShadowQueue } from '../planar-shadow-queue';\nimport { UIPhase } from '../ui-phase';\nimport { Camera } from '../../renderer/scene';\nimport { renderProfiler } from '../pipeline-funcs';\n\nconst colors: Color[] = [new Color(0, 0, 0, 1)];\n\n/**\n * @en The forward render stage\n * @zh 前向渲染阶段。\n */\n@ccclass('ForwardStage')\nexport class ForwardStage extends RenderStage {\n    public static initInfo: IRenderStageInfo = {\n        name: 'ForwardStage',\n        priority: ForwardStagePriority.FORWARD,\n        tag: 0,\n        renderQueues: [\n            {\n                isTransparent: false,\n                sortMode: RenderQueueSortMode.FRONT_TO_BACK,\n                stages: ['default'],\n            },\n            {\n                isTransparent: true,\n                sortMode: RenderQueueSortMode.BACK_TO_FRONT,\n                stages: ['default', 'planarShadow'],\n            },\n        ],\n    };\n\n    @type([RenderQueueDesc])\n    @serializable\n    @displayOrder(2)\n    protected renderQueues: RenderQueueDesc[] = [];\n    protected _renderQueues: RenderQueue[] = [];\n\n    private _renderArea = new Rect();\n    private _batchedQueue: RenderBatchedQueue;\n    private _instancedQueue: RenderInstancedQueue;\n    private _phaseID = getPhaseID('default');\n    private _clearFlag = 0xffffffff;\n    private declare _additiveLightQueue: RenderAdditiveLightQueue;\n    private declare _planarQueue: PlanarShadowQueue;\n    private declare _uiPhase: UIPhase;\n\n    additiveInstanceQueues: RenderInstancedQueue[] = [];\n\n    constructor () {\n        super();\n        this._batchedQueue = new RenderBatchedQueue();\n        this._instancedQueue = new RenderInstancedQueue();\n        this._uiPhase = new UIPhase();\n    }\n\n    public addRenderInstancedQueue (queue: RenderInstancedQueue) {\n        if (this.additiveInstanceQueues.includes(queue)) {\n            return;\n        }\n        this.additiveInstanceQueues.push(queue);\n    }\n\n    public removeRenderInstancedQueue (queue: RenderInstancedQueue) {\n        const index = this.additiveInstanceQueues.indexOf(queue);\n        if (index > -1) {\n            this.additiveInstanceQueues.splice(index, 1);\n        }\n    }\n\n    public initialize (info: IRenderStageInfo): boolean {\n        super.initialize(info);\n        if (info.renderQueues) {\n            this.renderQueues = info.renderQueues;\n        }\n        return true;\n    }\n\n    public activate (pipeline: ForwardPipeline, flow: ForwardFlow) {\n        super.activate(pipeline, flow);\n        for (let i = 0; i < this.renderQueues.length; i++) {\n            this._renderQueues[i] = convertRenderQueue(this.renderQueues[i]);\n        }\n\n        this._additiveLightQueue = new RenderAdditiveLightQueue(this._pipeline as ForwardPipeline);\n        this._planarQueue = new PlanarShadowQueue(this._pipeline);\n        this._uiPhase.activate(pipeline);\n    }\n\n    public destroy () {\n    }\n\n    public render (camera: Camera) {\n        this._instancedQueue.clear();\n        this._batchedQueue.clear();\n        const pipeline = this._pipeline as ForwardPipeline;\n        const device = pipeline.device;\n        this._renderQueues.forEach(renderQueueClearFunc);\n\n        const renderObjects = pipeline.pipelineSceneData.renderObjects;\n        let m = 0; let p = 0; let k = 0;\n        for (let i = 0; i < renderObjects.length; ++i) {\n            const ro = renderObjects[i];\n            const subModels = ro.model.subModels;\n            for (m = 0; m < subModels.length; ++m) {\n                const subModel = subModels[m];\n                const passes = subModel.passes;\n                for (p = 0; p < passes.length; ++p) {\n                    const pass = passes[p];\n                    if (pass.phase !== this._phaseID) continue;\n                    const batchingScheme = pass.batchingScheme;\n                    if (batchingScheme === BatchingSchemes.INSTANCING) {\n                        const instancedBuffer = pass.getInstancedBuffer();\n                        instancedBuffer.merge(subModel, p);\n                        this._instancedQueue.queue.add(instancedBuffer);\n                    } else if (batchingScheme === BatchingSchemes.VB_MERGING) {\n                        const batchedBuffer = pass.getBatchedBuffer();\n                        batchedBuffer.merge(subModel, p, ro.model);\n                        this._batchedQueue.queue.add(batchedBuffer);\n                    } else {\n                        for (k = 0; k < this._renderQueues.length; k++) {\n                            this._renderQueues[k].insertRenderPass(ro, m, p);\n                        }\n                    }\n                }\n            }\n        }\n\n        this._instancedQueue.sort();\n        this._renderQueues.forEach(renderQueueSortFunc);\n\n        const cmdBuff = pipeline.commandBuffers[0];\n        pipeline.pipelineUBO.updateShadowUBO(camera);\n\n        for (let i = 0; i < this.additiveInstanceQueues.length; i++) {\n            this.additiveInstanceQueues[i].uploadBuffers(cmdBuff);\n        }\n\n        this._instancedQueue.uploadBuffers(cmdBuff);\n        this._batchedQueue.uploadBuffers(cmdBuff);\n        this._additiveLightQueue.gatherLightPasses(camera, cmdBuff);\n        this._planarQueue.gatherShadowPasses(camera, cmdBuff);\n\n        if (camera.clearFlag & ClearFlagBit.COLOR) {\n            colors[0].x = camera.clearColor.x;\n            colors[0].y = camera.clearColor.y;\n            colors[0].z = camera.clearColor.z;\n            colors[0].w = camera.clearColor.w;\n        }\n        pipeline.generateRenderArea(camera, this._renderArea);\n\n        const framebuffer = camera.window.framebuffer;\n        const renderPass = pipeline.getRenderPass(camera.clearFlag & this._clearFlag, framebuffer);\n        cmdBuff.beginRenderPass(renderPass, framebuffer, this._renderArea,\n            colors, camera.clearDepth, camera.clearStencil);\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n        this._renderQueues[0].recordCommandBuffer(device, renderPass, cmdBuff);\n\n        for (let i = 0; i < this.additiveInstanceQueues.length; i++) {\n            this.additiveInstanceQueues[i].recordCommandBuffer(device, renderPass, cmdBuff);\n        }\n\n        this._instancedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n        this._batchedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n\n        this._additiveLightQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n        this._planarQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n        this._renderQueues[1].recordCommandBuffer(device, renderPass, cmdBuff);\n        camera.geometryRenderer?.render(renderPass, cmdBuff, pipeline.pipelineSceneData);\n        this._uiPhase.render(camera, renderPass);\n        renderProfiler(device, renderPass, cmdBuff, pipeline.profiler, camera);\n        cmdBuff.endRenderPass();\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass } from 'cc.decorator';\nimport { PIPELINE_FLOW_FORWARD } from '../define';\nimport { IRenderFlowInfo, RenderFlow } from '../render-flow';\nimport { ForwardFlowPriority } from '../enum';\nimport { ForwardStage } from './forward-stage';\nimport { RenderPipeline } from '../render-pipeline';\nimport { Camera } from '../../renderer/scene';\nimport { PostProcessStage } from '../deferred/postprocess-stage';\nimport { BloomStage } from '../deferred/bloom-stage';\n\n/**\n * @en The forward flow in forward render pipeline\n * @zh 前向渲染流程。\n */\n@ccclass('ForwardFlow')\nexport class ForwardFlow extends RenderFlow {\n    /**\n     * @en The shared initialization information of forward render flow\n     * @zh 共享的前向渲染流程初始化参数\n     */\n    public static initInfo: IRenderFlowInfo = {\n        name: PIPELINE_FLOW_FORWARD,\n        priority: ForwardFlowPriority.FORWARD,\n        stages: [],\n    };\n\n    public initialize (info: IRenderFlowInfo): boolean {\n        super.initialize(info);\n        if (this._stages.length === 0) {\n            const forwardStage = new ForwardStage();\n            forwardStage.initialize(ForwardStage.initInfo);\n            this._stages.push(forwardStage);\n        }\n        return true;\n    }\n\n    public activate (pipeline: RenderPipeline) {\n        super.activate(pipeline);\n    }\n\n    public render (camera: Camera) {\n        super.render(camera);\n    }\n\n    public destroy () {\n        super.destroy();\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { SubModel } from '../renderer/scene/submodel';\nimport { SetIndex } from './define';\nimport { Device, RenderPass, Shader, CommandBuffer } from '../gfx';\nimport { getPhaseID } from './pass-phase';\nimport { PipelineStateManager } from './pipeline-state-manager';\nimport { Pass, BatchingSchemes } from '../renderer/core/pass';\nimport { RenderInstancedQueue } from './render-instanced-queue';\nimport { RenderBatchedQueue } from './render-batched-queue';\nimport { ShadowType } from '../renderer/scene/shadows';\nimport { Light, LightType } from '../renderer/scene/light';\nimport { intersect } from '../geometry';\nimport { Model } from '../renderer/scene/model';\nimport { Camera, DirectionalLight, SpotLight } from '../renderer/scene';\nimport { shadowCulling } from './scene-culling';\nimport { PipelineRuntime } from './custom/pipeline';\n\nconst _phaseID = getPhaseID('shadow-caster');\nfunction getShadowPassIndex (subModel: SubModel) : number {\n    const passes = subModel.passes;\n    for (let k = 0; k < passes.length; k++) {\n        if (passes[k].phase === _phaseID) {\n            return k;\n        }\n    }\n    return -1;\n}\n\n/**\n * @zh\n * 阴影渲染队列\n */\nexport class RenderShadowMapBatchedQueue {\n    private _pipeline: PipelineRuntime;\n    private _subModelsArray: SubModel[] = [];\n    private _passArray: Pass[] = [];\n    private _shaderArray: Shader[] = [];\n    private _instancedQueue: RenderInstancedQueue;\n    private _batchedQueue: RenderBatchedQueue;\n\n    public constructor (pipeline: PipelineRuntime) {\n        this._pipeline = pipeline;\n        this._instancedQueue = new RenderInstancedQueue();\n        this._batchedQueue = new RenderBatchedQueue();\n    }\n\n    public gatherLightPasses (camera: Camera, light: Light, cmdBuff: CommandBuffer, level = 0) {\n        this.clear();\n\n        const sceneData = this._pipeline.pipelineSceneData;\n        const shadowInfo = sceneData.shadows;\n        if (light && shadowInfo.enabled && shadowInfo.type === ShadowType.ShadowMap) {\n            switch (light.type) {\n            case LightType.DIRECTIONAL:\n                // eslint-disable-next-line no-case-declarations\n                const dirLight = light as DirectionalLight;\n                if (dirLight.shadowEnabled) {\n                    const csmLayers = sceneData.csmLayers;\n                    let layer;\n                    if (dirLight.shadowFixedArea) {\n                        layer = csmLayers.specialLayer;\n                    } else {\n                        layer = csmLayers.layers[level];\n                    }\n                    shadowCulling(camera, sceneData, layer);\n                    const dirShadowObjects = layer.shadowObjects;\n                    for (let i = 0; i < dirShadowObjects.length; i++) {\n                        const ro = dirShadowObjects[i];\n                        const model = ro.model;\n                        this.add(model);\n                    }\n                }\n\n                break;\n            case LightType.SPOT:\n                // eslint-disable-next-line no-case-declarations\n                const spotLight = light as SpotLight;\n                if (spotLight.shadowEnabled) {\n                    const castShadowObjects = sceneData.csmLayers.castShadowObjects;\n                    for (let i = 0; i < castShadowObjects.length; i++) {\n                        const ro = castShadowObjects[i];\n                        const model = ro.model;\n                        if (model.worldBounds) {\n                            if (!intersect.aabbFrustum(model.worldBounds, spotLight.frustum)) { continue; }\n                        }\n\n                        this.add(model);\n                    }\n                }\n                break;\n            default:\n            }\n\n            this._instancedQueue.uploadBuffers(cmdBuff);\n            this._batchedQueue.uploadBuffers(cmdBuff);\n        }\n    }\n\n    /**\n     * @zh\n     * clear light-Batched-Queue\n     */\n    public clear () {\n        this._subModelsArray.length = 0;\n        this._shaderArray.length = 0;\n        this._passArray.length = 0;\n        this._instancedQueue.clear();\n        this._batchedQueue.clear();\n    }\n\n    public add (model: Model) {\n        const subModels = model.subModels;\n        for (let j = 0; j < subModels.length; j++) {\n            const subModel = subModels[j];\n            const shadowPassIdx = getShadowPassIndex(subModel);\n            if (shadowPassIdx < 0) { continue; }\n            const pass = subModel.passes[shadowPassIdx];\n            const batchingScheme = pass.batchingScheme;\n\n            if (batchingScheme === BatchingSchemes.INSTANCING) {            // instancing\n                const buffer = pass.getInstancedBuffer();\n                buffer.merge(subModel, shadowPassIdx);\n                this._instancedQueue.queue.add(buffer);\n            } else if (pass.batchingScheme === BatchingSchemes.VB_MERGING) { // vb-merging\n                const buffer = pass.getBatchedBuffer();\n                buffer.merge(subModel, shadowPassIdx, model);\n                this._batchedQueue.queue.add(buffer);\n            } else {\n                const shader = subModel.shaders[shadowPassIdx];\n                this._subModelsArray.push(subModel);\n                if (shader) this._shaderArray.push(shader);\n                this._passArray.push(pass);\n            }\n        }\n    }\n\n    /**\n     * @zh\n     * record CommandBuffer\n     */\n    public recordCommandBuffer (device: Device, renderPass: RenderPass, cmdBuff: CommandBuffer) {\n        this._instancedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n        this._batchedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n\n        for (let i = 0; i < this._subModelsArray.length; ++i) {\n            const subModel = this._subModelsArray[i];\n            const shader = this._shaderArray[i];\n            const pass = this._passArray[i];\n            const ia = subModel.inputAssembler;\n            const pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader, renderPass, ia);\n            const descriptorSet = pass.descriptorSet;\n\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, descriptorSet);\n            cmdBuff.bindDescriptorSet(SetIndex.LOCAL, subModel.descriptorSet);\n            cmdBuff.bindInputAssembler(ia);\n            cmdBuff.draw(ia);\n        }\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass } from 'cc.decorator';\nimport { Color, Rect, Framebuffer, DescriptorSet } from '../../gfx';\nimport { IRenderStageInfo, RenderStage } from '../render-stage';\nimport { ForwardStagePriority } from '../enum';\nimport { RenderShadowMapBatchedQueue } from '../render-shadow-map-batched-queue';\nimport { ForwardPipeline } from '../forward/forward-pipeline';\nimport { SetIndex } from '../define';\nimport { Light, LightType } from '../../renderer/scene/light';\nimport { ShadowFlow } from './shadow-flow';\nimport { Camera, CSMLevel, DirectionalLight } from '../../renderer/scene';\n\nconst colors: Color[] = [new Color(1, 1, 1, 1)];\n\n/**\n * @en Shadow map render stage\n * @zh 阴影渲染阶段。\n */\n@ccclass('ShadowStage')\nexport class ShadowStage extends RenderStage {\n    /**\n     * @en A common initialization info for shadow map render stage\n     * @zh 一个通用的 ShadowStage 的初始化信息对象\n     */\n    public static initInfo: IRenderStageInfo = {\n        name: 'ShadowStage',\n        priority: ForwardStagePriority.FORWARD,\n        tag: 0,\n    };\n\n    /**\n     * @en Sets the render shadow map info\n     * @zh 设置阴影渲染信息\n     * @param light\n     * @param shadowFrameBuffer\n     * @param level 层级\n     */\n    public setUsage (globalDS: DescriptorSet, light: Light, shadowFrameBuffer: Framebuffer, level = 0) {\n        this._globalDS = globalDS;\n        this._light = light;\n        this._shadowFrameBuffer = shadowFrameBuffer;\n        this._level = level;\n    }\n\n    private _additiveShadowQueue!: RenderShadowMapBatchedQueue;\n    private _shadowFrameBuffer: Framebuffer | null = null;\n    private _renderArea = new Rect();\n    private _light: Light | null = null;\n    private _globalDS: DescriptorSet | null = null;\n    private _level = 0;\n\n    public destroy () {\n        this._shadowFrameBuffer = null;\n        this._globalDS = null;\n        this._light = null;\n\n        this._additiveShadowQueue?.clear();\n    }\n\n    public clearFramebuffer (camera: Camera) {\n        if (!this._light || !this._shadowFrameBuffer) { return; }\n\n        colors[0].w = camera.clearColor.w;\n        const pipeline = this._pipeline as ForwardPipeline;\n        const pipelineSceneData = pipeline.pipelineSceneData;\n        const shadingScale = pipelineSceneData.shadingScale;\n        const shadowInfo = pipelineSceneData.shadows;\n        const vp = camera.viewport;\n        const shadowMapSize = shadowInfo.size;\n        this._renderArea.x = vp.x * shadowMapSize.x;\n        this._renderArea.y = vp.y * shadowMapSize.y;\n        this._renderArea.width =  vp.width * shadowMapSize.x * shadingScale;\n        this._renderArea.height = vp.height * shadowMapSize.y * shadingScale;\n        const cmdBuff = pipeline.commandBuffers[0];\n        const renderPass = this._shadowFrameBuffer.renderPass;\n\n        cmdBuff.beginRenderPass(renderPass, this._shadowFrameBuffer, this._renderArea,\n            colors, camera.clearDepth, camera.clearStencil);\n        cmdBuff.endRenderPass();\n    }\n\n    public render (camera: Camera) {\n        const pipeline = this._pipeline;\n        const pipelineSceneData = pipeline.pipelineSceneData;\n        const shadowInfo = pipelineSceneData.shadows;\n        const descriptorSet = this._globalDS!;\n        const cmdBuff = pipeline.commandBuffers[0];\n        const level = this._level;\n        const device = pipeline.device;\n\n        if (!this._light || !this._shadowFrameBuffer) { return; }\n        this._pipeline.pipelineUBO.updateShadowUBOLight(descriptorSet, this._light, level);\n        this._additiveShadowQueue.gatherLightPasses(camera, this._light, cmdBuff, level);\n\n        const shadowMapSize = shadowInfo.size;\n        switch (this._light.type) {\n        case LightType.DIRECTIONAL: {\n            const mainLight = this._light as DirectionalLight;\n            if (mainLight.shadowFixedArea || mainLight.csmLevel === CSMLevel.LEVEL_1 || !pipelineSceneData.csmSupported) {\n                this._renderArea.x = 0;\n                this._renderArea.y = 0;\n                this._renderArea.width = shadowMapSize.x;\n                this._renderArea.height = shadowMapSize.y;\n            } else {\n                const screenSpaceSignY = device.capabilities.screenSpaceSignY;\n                this._renderArea.x = level % 2 * 0.5 * shadowMapSize.x;\n                if (screenSpaceSignY > 0.0) {\n                    this._renderArea.y = (1 - Math.floor(level / 2)) * 0.5 * shadowMapSize.y;\n                } else {\n                    this._renderArea.y = Math.floor(level / 2) * 0.5 * shadowMapSize.y;\n                }\n                this._renderArea.width = 0.5 * shadowMapSize.x;\n                this._renderArea.height = 0.5 * shadowMapSize.y;\n            }\n            break;\n        }\n        case LightType.SPOT: {\n            this._renderArea.x = 0;\n            this._renderArea.y = 0;\n            this._renderArea.width = shadowMapSize.x;\n            this._renderArea.height = shadowMapSize.y;\n            break;\n        }\n        default:\n        }\n\n        const renderPass = this._shadowFrameBuffer.renderPass;\n\n        cmdBuff.beginRenderPass(renderPass, this._shadowFrameBuffer, this._renderArea,\n            colors, camera.clearDepth, camera.clearStencil);\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, descriptorSet);\n\n        this._additiveShadowQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n\n        cmdBuff.endRenderPass();\n    }\n\n    public activate (pipeline: ForwardPipeline, flow: ShadowFlow) {\n        super.activate(pipeline, flow);\n        this._additiveShadowQueue = new RenderShadowMapBatchedQueue(pipeline);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass } from 'cc.decorator';\nimport { PIPELINE_FLOW_SHADOW, supportsR32FloatTexture, UBOCamera, UBOCSM, UBOGlobal, UBOShadow } from '../define';\nimport { IRenderFlowInfo, RenderFlow } from '../render-flow';\nimport { ForwardFlowPriority } from '../enum';\nimport { ShadowStage } from './shadow-stage';\nimport { RenderPass, LoadOp, StoreOp,\n    Format, Texture, TextureType, TextureUsageBit, ColorAttachment,\n    DepthStencilAttachment, RenderPassInfo, TextureInfo, FramebufferInfo, Swapchain,\n    Framebuffer, DescriptorSet, API } from '../../gfx';\nimport { RenderFlowTag } from '../pipeline-serialization';\nimport { ForwardPipeline } from '../forward/forward-pipeline';\nimport { RenderPipeline } from '..';\nimport { PCFType, ShadowType } from '../../renderer/scene/shadows';\nimport { Light, LightType } from '../../renderer/scene/light';\nimport { Camera } from '../../renderer/scene';\nimport { SpotLight } from '../../renderer/scene/spot-light';\n\nconst _validLights: Light[] = [];\n\n/**\n * @en Shadow map render flow\n * @zh 阴影贴图绘制流程\n */\n@ccclass('ShadowFlow')\nexport class ShadowFlow extends RenderFlow {\n    /**\n     * @en A common initialization info for shadow map render flow\n     * @zh 一个通用的 ShadowFlow 的初始化信息对象\n     */\n    public static initInfo: IRenderFlowInfo = {\n        name: PIPELINE_FLOW_SHADOW,\n        priority: ForwardFlowPriority.SHADOW,\n        tag: RenderFlowTag.SCENE,\n        stages: [],\n    };\n\n    private _shadowRenderPass: RenderPass|null = null;\n\n    public initialize (info: IRenderFlowInfo): boolean {\n        super.initialize(info);\n        if (this._stages.length === 0) {\n            // add shadowMap-stages\n            const shadowMapStage = new ShadowStage();\n            shadowMapStage.initialize(ShadowStage.initInfo);\n            this._stages.push(shadowMapStage);\n        }\n        return true;\n    }\n\n    public activate (pipeline: RenderPipeline) {\n        super.activate(pipeline);\n\n        // 0: SHADOWMAP_FLOAT, 1: SHADOWMAP_RGBE.\n        const isRGBE = supportsR32FloatTexture(pipeline.device) ? 0 : 1;\n        pipeline.macros.CC_SHADOWMAP_FORMAT = isRGBE;\n\n        // 0: SHADOWMAP_LINER_DEPTH_OFF, 1: SHADOWMAP_LINER_DEPTH_ON.\n        const isLinear = pipeline.device.gfxAPI === API.WEBGL ? 1 : 0;\n        pipeline.macros.CC_SHADOWMAP_USE_LINEAR_DEPTH = isLinear;\n\n        // 0: UNIFORM_VECTORS_LESS_EQUAL_64, 1: UNIFORM_VECTORS_GREATER_EQUAL_125.\n        pipeline.pipelineSceneData.csmSupported = pipeline.device.capabilities.maxFragmentUniformVectors\n            >= (UBOGlobal.COUNT + UBOCamera.COUNT + UBOShadow.COUNT + UBOCSM.COUNT) / 4;\n        pipeline.macros.CC_SUPPORT_CASCADED_SHADOW_MAP = pipeline.pipelineSceneData.csmSupported;\n\n        // 0: CC_SHADOW_NONE, 1: CC_SHADOW_PLANAR, 2: CC_SHADOW_MAP\n        pipeline.macros.CC_SHADOW_TYPE = 0;\n\n        // 0: PCFType.HARD, 1: PCFType.SOFT, 2: PCFType.SOFT_2X, 3: PCFType.SOFT_4X\n        pipeline.macros.CC_DIR_SHADOW_PCF_TYPE = PCFType.HARD;\n\n        // 0: CC_DIR_LIGHT_SHADOW_NONE, 1: CC_DIR_LIGHT_SHADOW_UNIFORM, 2: CC_DIR_LIGHT_SHADOW_CASCADED, 3: CC_DIR_LIGHT_SHADOW_VARIANCE\n        pipeline.macros.CC_DIR_LIGHT_SHADOW_TYPE = 0;\n\n        pipeline.onGlobalPipelineStateChanged();\n    }\n\n    public render (camera: Camera) {\n        const pipeline = this._pipeline as ForwardPipeline;\n        const shadowInfo = pipeline.pipelineSceneData.shadows;\n        const csmLayers = pipeline.pipelineSceneData.csmLayers;\n        const shadowFrameBufferMap = pipeline.pipelineSceneData.shadowFrameBufferMap;\n        const castShadowObjects = csmLayers.castShadowObjects;\n        const validPunctualLights = this._pipeline.pipelineSceneData.validPunctualLights;\n        if (!shadowInfo.enabled || shadowInfo.type !== ShadowType.ShadowMap) { return; }\n\n        let n = 0;\n        let m = 0;\n        for (;n < shadowInfo.maxReceived && m < validPunctualLights.length;) {\n            const light = validPunctualLights[m];\n            if (light.type === LightType.SPOT) {\n                const spotLight = light as SpotLight;\n                if (spotLight.shadowEnabled) {\n                    _validLights.push(light);\n                    n++;\n                }\n            }\n            m++;\n        }\n\n        if (castShadowObjects.length === 0) {\n            this.clearShadowMap(_validLights, camera);\n            return;\n        }\n\n        if (shadowInfo.shadowMapDirty) { this.resizeShadowMap(); }\n\n        const { mainLight } = camera.scene!;\n        if (mainLight && mainLight.shadowEnabled) {\n            const globalDS = pipeline.descriptorSet;\n            if (!shadowFrameBufferMap.has(mainLight)) {\n                this._initShadowFrameBuffer(pipeline, mainLight, camera.window.swapchain);\n            }\n\n            const shadowFrameBuffer = shadowFrameBufferMap.get(mainLight);\n            if (mainLight.shadowFixedArea) {\n                this._renderStage(camera, mainLight, shadowFrameBuffer!, globalDS);\n            } else {\n                const csmLevel = pipeline.pipelineSceneData.csmSupported ? mainLight.csmLevel : 1;\n                for (let i = 0; i < csmLevel; i++) {\n                    this._renderStage(camera, mainLight, shadowFrameBuffer!, globalDS, i);\n                }\n            }\n        }\n\n        for (let l = 0; l < _validLights.length; l++) {\n            const light = _validLights[l];\n            const ds = pipeline.globalDSManager.getOrCreateDescriptorSet(light)!;\n\n            if (!shadowFrameBufferMap.has(light)) {\n                this._initShadowFrameBuffer(pipeline, light, camera.window.swapchain);\n            }\n\n            const shadowFrameBuffer = shadowFrameBufferMap.get(light);\n            this._renderStage(camera, light, shadowFrameBuffer!, ds);\n        }\n\n        _validLights.length = 0;\n    }\n\n    public destroy () {\n        super.destroy();\n        if (this._pipeline) {\n            const shadowFrameBufferMap = this._pipeline.pipelineSceneData.shadowFrameBufferMap;\n            const shadowFrameBuffers = Array.from(shadowFrameBufferMap.values());\n            for (let i = 0; i < shadowFrameBuffers.length; i++) {\n                const frameBuffer = shadowFrameBuffers[i];\n\n                if (!frameBuffer) { continue; }\n                const renderTargets = frameBuffer.colorTextures;\n                for (let j = 0; j < renderTargets.length; j++) {\n                    const renderTarget = renderTargets[j];\n                    if (renderTarget) { renderTarget.destroy(); }\n                }\n                renderTargets.length = 0;\n\n                const depth = frameBuffer.depthStencilTexture;\n                if (depth) { depth.destroy(); }\n\n                frameBuffer.destroy();\n            }\n\n            shadowFrameBufferMap.clear();\n        }\n\n        if (this._shadowRenderPass) { this._shadowRenderPass.destroy(); }\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _initShadowFrameBuffer  (pipeline: RenderPipeline, light: Light, swapchain: Swapchain) {\n        const { device } = pipeline;\n        const shadows = pipeline.pipelineSceneData.shadows;\n        const shadowMapSize = shadows.size;\n        const shadowFrameBufferMap = pipeline.pipelineSceneData.shadowFrameBufferMap;\n        const format = supportsR32FloatTexture(device) ? Format.R32F : Format.RGBA8;\n\n        if (!this._shadowRenderPass) {\n            const colorAttachment = new ColorAttachment();\n            colorAttachment.format = format;\n            colorAttachment.loadOp = LoadOp.CLEAR; // should clear color attachment\n            colorAttachment.storeOp = StoreOp.STORE;\n            colorAttachment.sampleCount = 1;\n\n            const depthStencilAttachment = new DepthStencilAttachment();\n            depthStencilAttachment.format = Format.DEPTH_STENCIL;\n            depthStencilAttachment.depthLoadOp = LoadOp.CLEAR;\n            depthStencilAttachment.depthStoreOp = StoreOp.DISCARD;\n            depthStencilAttachment.stencilLoadOp = LoadOp.CLEAR;\n            depthStencilAttachment.stencilStoreOp = StoreOp.DISCARD;\n            depthStencilAttachment.sampleCount = 1;\n\n            const renderPassInfo = new RenderPassInfo([colorAttachment], depthStencilAttachment);\n            this._shadowRenderPass = device.createRenderPass(renderPassInfo);\n        }\n\n        const shadowRenderTargets: Texture[] = [];\n        shadowRenderTargets.push(device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n            format,\n            shadowMapSize.x,\n            shadowMapSize.y,\n        )));\n\n        const depth = device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.DEPTH_STENCIL_ATTACHMENT,\n            Format.DEPTH_STENCIL,\n            shadowMapSize.x,\n            shadowMapSize.y,\n        ));\n\n        const shadowFrameBuffer = device.createFramebuffer(new FramebufferInfo(\n            this._shadowRenderPass,\n            shadowRenderTargets,\n            depth,\n        ));\n\n        // Cache frameBuffer\n        shadowFrameBufferMap.set(light, shadowFrameBuffer);\n    }\n\n    private _renderStage (camera: Camera, light: Light, shadowFrameBuffer: Framebuffer, globalDS: DescriptorSet, level = 0) {\n        for (let i = 0; i < this._stages.length; i++) {\n            const shadowStage = this._stages[i] as ShadowStage;\n            shadowStage.setUsage(globalDS, light, shadowFrameBuffer, level);\n            shadowStage.render(camera);\n        }\n    }\n\n    private clearShadowMap (validLights: Light[], camera: Camera) {\n        const pipeline = this._pipeline;\n        const scene = pipeline.pipelineSceneData;\n\n        const { mainLight } = camera.scene!;\n        if (mainLight) {\n            const globalDS = this._pipeline.descriptorSet;\n            if (!scene.shadowFrameBufferMap.has(mainLight)) {\n                this._initShadowFrameBuffer(this._pipeline, mainLight, camera.window.swapchain);\n            }\n\n            const shadowFrameBuffer = scene.shadowFrameBufferMap.get(mainLight);\n            for (let i = 0; i < this._stages.length; i++) {\n                const shadowStage = this._stages[i] as ShadowStage;\n                shadowStage.setUsage(globalDS, mainLight, shadowFrameBuffer!);\n                shadowStage.clearFramebuffer(camera);\n            }\n        }\n\n        for (let l = 0; l < validLights.length; l++) {\n            const light = validLights[l];\n            const ds = pipeline.globalDSManager.getOrCreateDescriptorSet(light)!;\n            if (!scene.shadowFrameBufferMap.has(light)) {\n                this._initShadowFrameBuffer(this._pipeline, light, camera.window.swapchain);\n            }\n\n            const shadowFrameBuffer = scene.shadowFrameBufferMap.get(light);\n            for (let i = 0; i < this._stages.length; i++) {\n                const shadowStage = this._stages[i] as ShadowStage;\n                shadowStage.setUsage(ds, light, shadowFrameBuffer!);\n                shadowStage.clearFramebuffer(camera);\n            }\n        }\n    }\n\n    private resizeShadowMap () {\n        const shadows = this._pipeline.pipelineSceneData.shadows;\n        const shadowMapSize = shadows.size;\n        const pipeline = this._pipeline;\n        const device = pipeline.device;\n        const shadowFrameBufferMap = pipeline.pipelineSceneData.shadowFrameBufferMap;\n        const format = supportsR32FloatTexture(device) ? Format.R32F : Format.RGBA8;\n\n        for (const key of shadowFrameBufferMap.keys()) {\n            const frameBuffer = shadowFrameBufferMap.get(key);\n            if (!frameBuffer) {\n                continue;\n            }\n\n            const renderTargets: Texture[] = [];\n            renderTargets.push(pipeline.device.createTexture(new TextureInfo(\n                TextureType.TEX2D,\n                TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n                format,\n                shadowMapSize.x,\n                shadowMapSize.y,\n            )));\n\n            const depth = frameBuffer.depthStencilTexture;\n            if (depth) { depth.resize(shadowMapSize.x, shadowMapSize.y); }\n\n            const shadowRenderPass = frameBuffer.renderPass;\n            frameBuffer.destroy();\n            const newFrameBuffer = device.createFramebuffer(new FramebufferInfo(\n                shadowRenderPass,\n                renderTargets,\n                depth,\n            ));\n            shadowFrameBufferMap.set(key, newFrameBuffer);\n        }\n\n        shadows.shadowMapDirty = false;\n    }\n}\n","/*\r\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n */\r\n\r\nimport { removeProperty, replaceProperty } from '../utils/x-deprecated';\r\nimport { TextureBase } from './texture-base';\r\nimport { RenderTexture } from './render-texture';\r\n\r\nremoveProperty(TextureBase.prototype, 'TextureBase.prototype', [\r\n    {\r\n        name: 'hasPremultipliedAlpha',\r\n    },\r\n    {\r\n        name: 'setPremultiplyAlpha',\r\n    },\r\n    {\r\n        name: 'setFlipY',\r\n    },\r\n]);\r\n\r\nreplaceProperty(RenderTexture.prototype, 'RenderTexture.prototype', [\r\n    {\r\n        name: 'getGFXWindow',\r\n        customFunction () {\r\n            // @ts-expect-error\r\n            return this._window;\r\n        },\r\n    },\r\n]);\r\n","/*\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { legacyCC } from '../global-exports';\nimport { mapBuffer } from '../../3d/misc/buffer';\nimport {\n    Attribute, Device, InputAssemblerInfo, Buffer, BufferInfo, AttributeName, BufferUsageBit,\n    Format, FormatInfos, MemoryUsageBit, PrimitiveMode, getTypedArrayConstructor, DrawInfo,\n} from '../gfx';\nimport { Vec3 } from '../math';\nimport { Mesh } from '../../3d/assets/mesh';\n\n/**\n * @en Array views for index buffer\n * @zh 允许存储索引的数组视图。\n */\nexport type IBArray = Uint8Array | Uint16Array | Uint32Array;\n\n/**\n * @en The interface of geometric information\n * @zh 几何信息。\n */\nexport interface IGeometricInfo {\n    /**\n     * @en Vertex positions\n     * @zh 顶点位置。\n     */\n    positions: Float32Array;\n\n    /**\n     * @en Indices data\n     * @zh 索引数据。\n     */\n    indices?: IBArray;\n\n    /**\n     * @en Whether the geometry is treated as double sided\n     * @zh 是否将图元按双面对待。\n     */\n    doubleSided?: boolean;\n\n    /**\n     * @en The bounding box\n     * @zh 此几何体的轴对齐包围盒。\n     */\n    boundingBox: { max: Vec3 | Readonly<Vec3>; min: Vec3 | Readonly<Vec3> };\n}\n\n/**\n * @en Flat vertex buffer\n * @zh 扁平化顶点缓冲区\n */\nexport interface IFlatBuffer {\n    stride: number;\n    count: number;\n    buffer: Uint8Array;\n}\n\n/**\n * @en Sub mesh for rendering which contains all geometry data, it can be used to create [[gfx.InputAssembler]].\n * @zh 包含所有顶点数据的渲染子网格，可以用来创建 [[gfx.InputAssembler]]。\n */\nexport class RenderingSubMesh {\n    /**\n     * @en\n     * mesh object where this sub mesh locates\n     * @zh\n     * 子网格所处的网格模型对象\n     */\n    public mesh?: Mesh;\n\n    /**\n     * @en\n     * sub mesh's index in mesh\n     * @zh\n     * 子网格在网格模型中的索引\n     */\n    public subMeshIdx?: number;\n\n    private _flatBuffers: IFlatBuffer[] = [];\n\n    private _jointMappedBuffers?: Buffer[];\n\n    private _jointMappedBufferIndices?: number[];\n\n    private _vertexIdChannel?: { stream: number; index: number };\n\n    private _geometricInfo?: IGeometricInfo;\n\n    private _vertexBuffers: Buffer[];\n\n    private _attributes: Attribute[];\n\n    private _indexBuffer: Buffer | null = null;\n\n    private _indirectBuffer: Buffer | null = null;\n\n    private _primitiveMode: PrimitiveMode;\n\n    private _iaInfo: InputAssemblerInfo;\n\n    private _isOwnerOfIndexBuffer = true;\n\n    private _drawInfo?: DrawInfo | null = null;\n\n    /**\n     * @en\n     * sub mesh's constructor\n     * @zh\n     * 子网格构造函数\n     * @param vertexBuffers @en vertex buffers @zh 顶点缓冲区数组\n     * @param attributes @en vertex attributes @zh 顶点属性数组\n     * @param primitiveMode @en primitive mode @zh 图元类型\n     * @param indexBuffer @en index buffer @zh 索引缓冲区\n     * @param indirectBuffer @en indirect buffer @zh 间接缓冲区\n     */\n    constructor (\n        vertexBuffers: Buffer[], attributes: Attribute[], primitiveMode: PrimitiveMode,\n        indexBuffer: Buffer | null = null, indirectBuffer: Buffer | null = null,\n        isOwnerOfIndexBuffer = true,\n    ) {\n        this._attributes = attributes;\n        this._vertexBuffers = vertexBuffers;\n        this._indexBuffer = indexBuffer;\n        this._indirectBuffer = indirectBuffer;\n        this._primitiveMode = primitiveMode;\n        this._iaInfo = new InputAssemblerInfo(attributes, vertexBuffers, indexBuffer, indirectBuffer);\n        this._isOwnerOfIndexBuffer = isOwnerOfIndexBuffer;\n    }\n\n    /**\n     * @en All vertex attributes used by the sub mesh\n     * @zh 所有顶点属性。\n     */\n    get attributes () { return this._attributes; }\n\n    /**\n     * @en All vertex buffers used by the sub mesh\n     * @zh 使用的所有顶点缓冲区。\n     */\n    get vertexBuffers () { return this._vertexBuffers; }\n\n    /**\n     * @en Index buffer used by the sub mesh\n     * @zh 使用的索引缓冲区，若未使用则无需指定。\n     */\n    get indexBuffer () { return this._indexBuffer; }\n\n    /**\n     * @en Indirect buffer used by the sub mesh\n     * @zh 间接绘制缓冲区。\n     */\n    get indirectBuffer () { return this._indirectBuffer; }\n\n    /**\n     * @en Primitive mode used by the sub mesh\n     * @zh 图元类型。\n     */\n    get primitiveMode () { return this._primitiveMode; }\n\n    /**\n     * @en The geometric info of the sub mesh, used for raycast.\n     * @zh （用于射线检测的）几何信息。\n     */\n    get geometricInfo (): IGeometricInfo {\n        if (this._geometricInfo) {\n            return this._geometricInfo;\n        }\n        if (this.mesh === undefined) {\n            return { positions: new Float32Array(), indices: new Uint8Array(), boundingBox: { min: Vec3.ZERO, max: Vec3.ZERO } };\n        }\n        if (this.subMeshIdx === undefined) {\n            return { positions: new Float32Array(), indices: new Uint8Array(), boundingBox: { min: Vec3.ZERO, max: Vec3.ZERO } };\n        }\n        const { mesh } = this; const index = this.subMeshIdx;\n        const positions = mesh.readAttribute(index, AttributeName.ATTR_POSITION) as unknown as Float32Array;\n        const indices = mesh.readIndices(index) as Uint16Array;\n        const max = new Vec3();\n        const min = new Vec3();\n        const pAttri = this.attributes.find((element) => element.name === AttributeName.ATTR_POSITION);\n        if (pAttri) {\n            const conut = FormatInfos[pAttri.format].count;\n            if (conut === 2) {\n                max.set(positions[0], positions[1], 0);\n                min.set(positions[0], positions[1], 0);\n            } else {\n                max.set(positions[0], positions[1], positions[2]);\n                min.set(positions[0], positions[1], positions[2]);\n            }\n            for (let i = 0; i < positions.length; i += conut) {\n                if (conut === 2) {\n                    max.x = positions[i] > max.x ? positions[i] : max.x;\n                    max.y = positions[i + 1] > max.y ? positions[i + 1] : max.y;\n                    min.x = positions[i] < min.x ? positions[i] : min.x;\n                    min.y = positions[i + 1] < min.y ? positions[i + 1] : min.y;\n                } else {\n                    max.x = positions[i] > max.x ? positions[i] : max.x;\n                    max.y = positions[i + 1] > max.y ? positions[i + 1] : max.y;\n                    max.z = positions[i + 2] > max.z ? positions[i + 2] : max.z;\n                    min.x = positions[i] < min.x ? positions[i] : min.x;\n                    min.y = positions[i + 1] < min.y ? positions[i + 1] : min.y;\n                    min.z = positions[i + 2] < min.z ? positions[i + 2] : min.z;\n                }\n            }\n        }\n        this._geometricInfo = { positions, indices, boundingBox: { max, min } };\n        return this._geometricInfo;\n    }\n\n    /**\n     * @en Invalidate the geometric info of the sub mesh after geometry changed.\n     * @zh 网格更新后，设置（用于射线检测的）几何信息为无效，需要重新计算。\n     */\n    public invalidateGeometricInfo () { this._geometricInfo = undefined; }\n\n    /**\n     * @en the draw range\n     * @zh 渲染范围\n     */\n    set drawInfo (info: DrawInfo | null | undefined) {\n        this._drawInfo = info;\n    }\n\n    get drawInfo (): DrawInfo | null | undefined {\n        return this._drawInfo;\n    }\n\n    /**\n     * @en Flatted vertex buffers\n     * @zh 扁平化的顶点缓冲区。\n     */\n    get flatBuffers () { return this._flatBuffers; }\n\n    /**\n     * @en generate flatted vertex buffers\n     * @zh 生成扁平化的顶点缓冲区。\n     */\n    public genFlatBuffers () {\n        if (this._flatBuffers.length || !this.mesh || this.subMeshIdx === undefined) { return; }\n\n        const { mesh } = this;\n        let idxCount = 0;\n        const prim = mesh.struct.primitives[this.subMeshIdx];\n        if (prim.indexView) { idxCount = prim.indexView.count; }\n        for (let i = 0; i < prim.vertexBundelIndices.length; i++) {\n            const bundleIdx = prim.vertexBundelIndices[i];\n            const vertexBundle = mesh.struct.vertexBundles[bundleIdx];\n            const vbCount = prim.indexView ? prim.indexView.count : vertexBundle.view.count;\n            const vbStride = vertexBundle.view.stride;\n            const vbSize = vbStride * vbCount;\n            const view = new Uint8Array(mesh.data.buffer, vertexBundle.view.offset, vertexBundle.view.length);\n            const sharedView = new Uint8Array(prim.indexView ? vbSize : vertexBundle.view.length);\n\n            if (!prim.indexView) {\n                sharedView.set(mesh.data.subarray(vertexBundle.view.offset, vertexBundle.view.offset + vertexBundle.view.length));\n                this._flatBuffers.push({ stride: vbStride, count: vbCount, buffer: sharedView });\n                continue;\n            }\n\n            const ibView = mesh.readIndices(this.subMeshIdx)!;\n            // transform to flat buffer\n            for (let n = 0; n < idxCount; ++n) {\n                const idx = ibView[n];\n                const offset = n * vbStride;\n                const srcOffset = idx * vbStride;\n                for (let m = 0; m < vbStride; ++m) {\n                    sharedView[offset + m] = view[srcOffset + m];\n                }\n            }\n            this._flatBuffers.push({ stride: vbStride, count: vbCount, buffer: sharedView });\n        }\n    }\n\n    /**\n     * @en The vertex buffer for joint after mapping\n     * @zh 骨骼索引按映射表处理后的顶点缓冲。\n     */\n    get jointMappedBuffers () {\n        if (this._jointMappedBuffers) { return this._jointMappedBuffers; }\n        const buffers: Buffer[] = this._jointMappedBuffers = [];\n        const indices: number[] = this._jointMappedBufferIndices = [];\n        if (!this.mesh || this.subMeshIdx === undefined) { return this._jointMappedBuffers = this.vertexBuffers; }\n        const { struct } = this.mesh;\n        const prim = struct.primitives[this.subMeshIdx];\n        if (!struct.jointMaps || prim.jointMapIndex === undefined || !struct.jointMaps[prim.jointMapIndex]) {\n            return this._jointMappedBuffers = this.vertexBuffers;\n        }\n        let jointFormat: Format;\n        let jointOffset: number;\n        const { device } = legacyCC.director.root;\n        for (let i = 0; i < prim.vertexBundelIndices.length; i++) {\n            const bundle = struct.vertexBundles[prim.vertexBundelIndices[i]];\n            jointOffset = 0;\n            jointFormat = Format.UNKNOWN;\n            for (let j = 0; j < bundle.attributes.length; j++) {\n                const attr = bundle.attributes[j];\n                if (attr.name === AttributeName.ATTR_JOINTS) {\n                    jointFormat = attr.format;\n                    break;\n                }\n                jointOffset += FormatInfos[attr.format].size;\n            }\n            if (jointFormat) {\n                const data = new Uint8Array(this.mesh.data.buffer, bundle.view.offset, bundle.view.length);\n                const dataView = new DataView(data.slice().buffer);\n                const idxMap = struct.jointMaps[prim.jointMapIndex];\n                mapBuffer(dataView, (cur) => idxMap.indexOf(cur), jointFormat, jointOffset,\n                    bundle.view.length, bundle.view.stride, dataView);\n                const buffer = device.createBuffer(new BufferInfo(\n                    BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n                    MemoryUsageBit.DEVICE,\n                    bundle.view.length,\n                    bundle.view.stride,\n                ));\n                buffer.update(dataView.buffer); buffers.push(buffer); indices.push(i);\n            } else {\n                buffers.push(this.vertexBuffers[prim.vertexBundelIndices[i]]);\n            }\n        }\n        if (this._vertexIdChannel) {\n            buffers.push(this._allocVertexIdBuffer(device));\n        }\n        return buffers;\n    }\n\n    /**\n     * @en The input assembler info\n     * @zh 输入汇集器信息\n     */\n    get iaInfo () { return this._iaInfo; }\n\n    /**\n     * @en destroy sub mesh\n     * @zh 销毁子网格\n     */\n    public destroy () {\n        for (let i = 0; i < this.vertexBuffers.length; i++) {\n            this.vertexBuffers[i].destroy();\n        }\n        this.vertexBuffers.length = 0;\n        if (this._indexBuffer) {\n            if (this._isOwnerOfIndexBuffer) {\n                this._indexBuffer.destroy();\n            }\n            this._indexBuffer = null;\n        }\n        if (this._jointMappedBuffers && this._jointMappedBufferIndices) {\n            for (let i = 0; i < this._jointMappedBufferIndices.length; i++) {\n                this._jointMappedBuffers[this._jointMappedBufferIndices[i]].destroy();\n            }\n            this._jointMappedBuffers = undefined;\n            this._jointMappedBufferIndices = undefined;\n        }\n        if (this._indirectBuffer) {\n            this._indirectBuffer.destroy();\n            this._indirectBuffer = null;\n        }\n    }\n\n    /**\n     * @en Adds a vertex attribute input called 'a_vertexId' into this sub-mesh.\n     * This is useful if you want to simulate `gl_VertexId` in WebGL context prior to 2.0.\n     * Once you call this function, the vertex attribute is permanently added.\n     * Subsequent calls to this function take no effect.\n     * @zh 添加一个 'a_vertexId' 顶点属性， 用于在 WebGL 2.0 之前的平台模拟 `gl_VertexId`，\n     * 一旦你调用此函数， 顶点属性永久被添加， 后续调用无效果。\n     * @param device @en Device used to create related rendering resources @zh 用于创建相关渲染资源的设备对象\n     */\n    public enableVertexIdChannel (device: Device) {\n        if (this._vertexIdChannel) {\n            return;\n        }\n\n        const streamIndex = this.vertexBuffers.length;\n        const attributeIndex = this.attributes.length;\n\n        const vertexIdBuffer = this._allocVertexIdBuffer(device);\n        this._vertexBuffers.push(vertexIdBuffer);\n        this._attributes.push(new Attribute('a_vertexId', Format.R32F, false, streamIndex));\n\n        this._iaInfo.attributes = this._attributes;\n        this._iaInfo.vertexBuffers = this._vertexBuffers;\n\n        this._vertexIdChannel = {\n            stream: streamIndex,\n            index: attributeIndex,\n        };\n    }\n\n    private _allocVertexIdBuffer (device: Device) {\n        const vertexCount = (this.vertexBuffers.length === 0 || this.vertexBuffers[0].stride === 0)\n            ? 0\n            // TODO: This depends on how stride of a vertex buffer is defined; Consider padding problem.\n            : this.vertexBuffers[0].size / this.vertexBuffers[0].stride;\n        const vertexIds = new Float32Array(vertexCount);\n        for (let iVertex = 0; iVertex < vertexCount; ++iVertex) {\n            // `+0.5` because on some platforms, the \"fetched integer\" may have small error.\n            // For example `26` may yield `25.99999`, which is convert to `25` instead of `26` using `int()`.\n            vertexIds[iVertex] = iVertex + 0.5;\n        }\n\n        const vertexIdBuffer = device.createBuffer(new BufferInfo(\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE,\n            vertexIds.byteLength,\n            vertexIds.BYTES_PER_ELEMENT,\n        ));\n        vertexIdBuffer.update(vertexIds);\n\n        return vertexIdBuffer;\n    }\n}\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { ccclass, editable, serializable } from 'cc.decorator';\nimport { Scene } from '../scene-graph/scene';\nimport { Asset } from './asset';\nimport { legacyCC } from '../global-exports';\n\n/**\n * @en Class for scene loading.\n * @zh 场景资源类。\n *\n */\n@ccclass('cc.SceneAsset')\nexport class SceneAsset extends Asset {\n    /**\n     * @en The scene node\n     * @zh 场景节点。\n     */\n    @editable\n    @serializable\n    public scene: Scene | null = null;\n\n    public initDefault (uuid?: string) {\n        super.initDefault(uuid);\n        this.scene = new Scene('New Scene');\n    }\n\n    public validate () {\n        return !!this.scene;\n    }\n}\n\nlegacyCC.SceneAsset = SceneAsset;\n","/*\n Copyright (c) 2022 Xiamen Yaji Software Co., Ltd.\n https://www.cocos.com/\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DirectionalLight, Camera, Shadows, CSMLevel, CSMOptimizationMode } from '../../renderer/scene';\nimport { Mat4, Vec3, Vec2, Vec4 } from '../../math';\nimport { Frustum, AABB } from '../../geometry';\nimport { IRenderObject } from '../define';\nimport { legacyCC } from '../../global-exports';\nimport { PipelineSceneData } from '../pipeline-scene-data';\nimport { CachedArray } from '../../memop/cached-array';\n\nconst _mat4Trans = new Mat4();\nconst _matShadowTrans = new Mat4();\nconst _matShadowView = new Mat4();\nconst _matShadowProj = new Mat4();\nconst _matShadowViewProj = new Mat4();\nconst _matShadowViewProjArbitaryPos = new Mat4();\nconst _matShadowViewProjArbitaryPosInv = new Mat4();\n\nconst _focus = new Vec3(0, 0, 0);\nconst _projPos = new Vec3();\nconst _texelSize = new Vec2();\nconst _projSnap = new Vec3();\nconst _snap = new Vec3();\nconst _maxVec3 = new Vec3(10000000, 10000000, 10000000);\nconst _minVec3 = new Vec3(-10000000, -10000000, -10000000);\nconst _shadowPos = new Vec3();\nlet _maxLayerPosz = 0.0;\nlet _maxLayerFarPlane = 0.0;\n\nexport class ShadowLayerVolume {\n    protected _shadowObjects: IRenderObject[] = [];\n\n    protected _shadowCameraFar = 0;\n    // Level is a vector, Indicates the location.range: [0 ~ 3]\n    protected _level: number;\n\n    protected _matShadowView: Mat4 = new Mat4();\n    protected _matShadowProj: Mat4 = new Mat4();\n    protected _matShadowViewProj: Mat4 = new Mat4();\n\n    protected _validFrustum: Frustum = new Frustum();\n\n    // geometry renderer value\n    protected _splitFrustum: Frustum = new Frustum();\n    protected _lightViewFrustum: Frustum = new Frustum();\n    protected _castLightViewBoundingBox: AABB = new AABB();\n\n    constructor (level: number) {\n        this._level = level;\n        this._validFrustum.accurate = true;\n        this._splitFrustum.accurate = true;\n        this._lightViewFrustum.accurate = true;\n    }\n\n    get level () { return this._level; }\n\n    get shadowObjects () {\n        return this._shadowObjects;\n    }\n\n    get shadowCameraFar () {\n        return this._shadowCameraFar;\n    }\n    set shadowCameraFar (val) {\n        this._shadowCameraFar = val;\n    }\n\n    get matShadowView () {\n        return this._matShadowView;\n    }\n    set matShadowView (val) {\n        this._matShadowView = val;\n    }\n\n    get matShadowProj () {\n        return this._matShadowProj;\n    }\n    set matShadowProj (val) {\n        this._matShadowProj = val;\n    }\n\n    get matShadowViewProj () {\n        return this._matShadowViewProj;\n    }\n    set matShadowViewProj (val) {\n        this._matShadowViewProj = val;\n    }\n\n    get validFrustum (): Readonly<Frustum> {\n        return this._validFrustum;\n    }\n\n    get splitFrustum (): Readonly<Frustum> {\n        return this._splitFrustum;\n    }\n\n    get lightViewFrustum (): Readonly<Frustum> {\n        return this._lightViewFrustum;\n    }\n\n    get castLightViewBoundingBox (): Readonly<AABB> {\n        return this._castLightViewBoundingBox;\n    }\n\n    public copyToValidFrustum (validFrustum: Readonly<Frustum>) {\n        Frustum.copy(this._validFrustum, validFrustum);\n    }\n\n    public calculateValidFrustumOrtho (width: number, height: number, near: number, far: number, transform: Mat4) {\n        Frustum.createOrtho(this._validFrustum, width, height, near,  far, transform);\n    }\n\n    public calculateSplitFrustum (camera: Camera, m: Mat4, start: number, end: number) {\n        Frustum.split(this._splitFrustum, camera, m, start, end);\n    }\n\n    public destroy () {\n        this._shadowObjects.length = 0;\n    }\n\n    public createMatrix (dirLight: DirectionalLight, shadowMapWidth: number, onlyForCulling: boolean) {\n        const device = legacyCC.director.root.device;\n        const invisibleOcclusionRange = dirLight.shadowInvisibleOcclusionRange;\n        Frustum.copy(this._lightViewFrustum, this._splitFrustum);\n\n        // view matrix with range back\n        Mat4.fromRT(_matShadowTrans, dirLight.node!.rotation, _focus);\n        Mat4.invert(_matShadowView, _matShadowTrans);\n        const shadowViewArbitaryPos = _matShadowView.clone();\n        this._lightViewFrustum.transform(_matShadowView);\n\n        // bounding box in light space\n        AABB.fromPoints(this._castLightViewBoundingBox, _maxVec3, _minVec3);\n        this._castLightViewBoundingBox.mergeFrustum(this._lightViewFrustum);\n        let orthoSizeWidth;\n        let orthoSizeHeight;\n        if (dirLight.csmOptimizationMode === CSMOptimizationMode.DisableRotationFix) {\n            orthoSizeWidth = this._castLightViewBoundingBox.halfExtents.x * 2.0;\n            orthoSizeHeight = this._castLightViewBoundingBox.halfExtents.y * 2.0;\n        } else {\n            orthoSizeWidth = orthoSizeHeight = Vec3.distance(this._lightViewFrustum.vertices[0], this._lightViewFrustum.vertices[6]);\n        }\n\n        const csmLevel = legacyCC.director.root.pipeline.pipelineSceneData.csmSupported ? dirLight.csmLevel : 1;\n        if (csmLevel > 1 && dirLight.csmOptimizationMode\n            === CSMOptimizationMode.RemoveDuplicates) {\n            if (this._level >= csmLevel - 1) {\n                _maxLayerFarPlane = this._castLightViewBoundingBox.halfExtents.z;\n                _maxLayerPosz = this._castLightViewBoundingBox.center.z;\n            } else {\n                const alignFarPlaneDist = Math.abs(this._castLightViewBoundingBox.center.z - _maxLayerPosz) + _maxLayerFarPlane;\n                this._castLightViewBoundingBox.halfExtents.z = Math.max(this._castLightViewBoundingBox.center.z, alignFarPlaneDist);\n            }\n        }\n\n        const r = this._castLightViewBoundingBox.halfExtents.z;\n        this._shadowCameraFar = r * 2 + invisibleOcclusionRange;\n        const center = this._castLightViewBoundingBox.center;\n        _shadowPos.set(center.x, center.y, center.z + r + invisibleOcclusionRange);\n        Vec3.transformMat4(_shadowPos, _shadowPos, _matShadowTrans);\n\n        Mat4.fromRT(_matShadowTrans, dirLight.node!.rotation, _shadowPos);\n        Mat4.invert(_matShadowView, _matShadowTrans);\n\n        if (!onlyForCulling) {\n            // snap to whole texels\n            const halfOrthoSizeWidth = orthoSizeWidth * 0.5;\n            const halfOrthoSizeHeight = orthoSizeHeight * 0.5;\n            Mat4.ortho(_matShadowProj, -halfOrthoSizeWidth, halfOrthoSizeWidth, -halfOrthoSizeHeight, halfOrthoSizeHeight,\n                0.1, this._shadowCameraFar, device.capabilities.clipSpaceMinZ, device.capabilities.clipSpaceSignY);\n\n            Mat4.multiply(_matShadowViewProjArbitaryPos, _matShadowProj, shadowViewArbitaryPos);\n            Vec3.transformMat4(_projPos, _shadowPos, _matShadowViewProjArbitaryPos);\n            const invActualSize = 2.0 / shadowMapWidth;\n            _texelSize.set(invActualSize, invActualSize);\n            const modX = _projPos.x % _texelSize.x;\n            const modY = _projPos.y % _texelSize.y;\n            _projSnap.set(_projPos.x - modX, _projPos.y - modY, _projPos.z);\n            Mat4.invert(_matShadowViewProjArbitaryPosInv, _matShadowViewProjArbitaryPos);\n            Vec3.transformMat4(_snap, _projSnap, _matShadowViewProjArbitaryPosInv);\n\n            Mat4.fromRT(_matShadowTrans, dirLight.node!.rotation, _snap);\n            Mat4.invert(_matShadowView, _matShadowTrans);\n\n            // fill data\n            Mat4.multiply(_matShadowViewProj, _matShadowProj, _matShadowView);\n            Mat4.copy(this._matShadowView, _matShadowView);\n            Mat4.copy(this._matShadowProj, _matShadowProj);\n            Mat4.copy(this._matShadowViewProj, _matShadowViewProj);\n        }\n\n        Frustum.createOrtho(this._validFrustum, orthoSizeWidth, orthoSizeHeight,\n            0.1,  this._shadowCameraFar, _matShadowTrans);\n    }\n}\nexport class CSMShadowLayer extends ShadowLayerVolume {\n    protected _splitCameraNear = 0;\n    protected _splitCameraFar = 0;\n\n    protected _csmAtlas: Vec4 = new Vec4();\n\n    constructor (level: number) {\n        super(level);\n        this._calculateAtlas(level);\n    }\n\n    get splitCameraNear () {\n        return this._splitCameraNear;\n    }\n    set splitCameraNear (val) {\n        this._splitCameraNear = val;\n    }\n\n    get splitCameraFar () {\n        return this._splitCameraFar;\n    }\n    set splitCameraFar (val) {\n        this._splitCameraFar = val;\n    }\n\n    get csmAtlas () {\n        return this._csmAtlas;\n    }\n    set csmAtlas (val) {\n        this._csmAtlas = val;\n    }\n\n    public destroy () {\n        super.destroy();\n    }\n\n    private _calculateAtlas (level: number) {\n        const clipSpaceSignY =  legacyCC.director.root.device.capabilities.clipSpaceSignY;\n        const x = level % 2 - 0.5;\n        const y = (0.5 - Math.floor(level / 2)) * clipSpaceSignY;\n        this._csmAtlas.set(0.5, 0.5, x, y);\n    }\n}\n\n/**\n * @en Shadow CSM layer manager\n * @zh CSM阴影图层管理\n */\nexport class CSMLayers {\n    protected _castShadowObjects: IRenderObject[] = [];\n    protected _layerObjects = new CachedArray<IRenderObject>(64);\n\n    protected _layers: CSMShadowLayer[] = [];\n    // LevelCount is a scalar, Indicates the number.\n    protected _levelCount = 0;\n    // The ShadowTransformInfo object for 'fixed area shadow' || 'maximum clipping info' || 'CSM layers = 1'.\n    protected _specialLayer: ShadowLayerVolume = new ShadowLayerVolume(1);\n    protected _shadowDistance = 0;\n\n    get castShadowObjects () {\n        return this._castShadowObjects;\n    }\n\n    get layerObjects () {\n        return this._layerObjects;\n    }\n\n    get layers () {\n        return this._layers;\n    }\n\n    get specialLayer () {\n        return this._specialLayer;\n    }\n\n    public constructor () {\n        for (let i = 0; i < CSMLevel.LEVEL_4; i++) {\n            this._layers[i] = new CSMShadowLayer(i);\n        }\n    }\n\n    public update (sceneData: PipelineSceneData, camera: Camera) {\n        const scene = camera.scene!;\n        const dirLight = scene.mainLight;\n        if (dirLight === null) { return; }\n\n        const shadowInfo = sceneData.shadows;\n        const levelCount = legacyCC.director.root.pipeline.pipelineSceneData.csmSupported ? dirLight.csmLevel : 1;\n        const shadowDistance = dirLight.shadowDistance;\n\n        if (!shadowInfo.enabled || !dirLight.shadowEnabled) { return; }\n\n        if (dirLight.shadowFixedArea) {\n            this._updateFixedArea(dirLight);\n        } else {\n            if (dirLight.csmNeedUpdate || this._levelCount !== levelCount\n                || this._shadowDistance !== shadowDistance) {\n                this._splitFrustumLevels(dirLight);\n                this._levelCount = levelCount;\n                this._shadowDistance = shadowDistance;\n            }\n\n            this._calculateCSM(camera, dirLight, shadowInfo);\n        }\n    }\n\n    public destroy () {\n        this._castShadowObjects.length = 0;\n        for (let i = 0; i < this._layers.length; i++) {\n            this._layers[i].destroy();\n        }\n        this._layers.length = 0;\n    }\n\n    private _updateFixedArea (dirLight: DirectionalLight) {\n        const device = legacyCC.director.root.device;\n        const x = dirLight.shadowOrthoSize;\n        const y = dirLight.shadowOrthoSize;\n        const near = dirLight.shadowNear;\n        const far = dirLight.shadowFar;\n        Mat4.fromRT(_matShadowTrans, dirLight.node!.getWorldRotation(), dirLight.node!.getWorldPosition());\n        Mat4.invert(_matShadowView, _matShadowTrans);\n        Mat4.ortho(_matShadowProj, -x, x, -y, y, near, far,\n            device.capabilities.clipSpaceMinZ, device.capabilities.clipSpaceSignY);\n        Mat4.multiply(_matShadowViewProj, _matShadowProj, _matShadowView);\n        this._specialLayer.matShadowView = _matShadowView;\n        this._specialLayer.matShadowProj = _matShadowProj;\n        this._specialLayer.matShadowViewProj = _matShadowViewProj;\n\n        this._specialLayer.calculateValidFrustumOrtho(x * 2.0, y * 2.0, near,  far, _matShadowTrans);\n    }\n\n    private _splitFrustumLevels (dirLight: DirectionalLight) {\n        const nd = 0.1;\n        const fd = dirLight.shadowDistance;\n        const ratio = fd / nd;\n        const level = legacyCC.director.root.pipeline.pipelineSceneData.csmSupported ? dirLight.csmLevel : 1;\n        const lambda = dirLight.csmLayerLambda;\n        this._layers[0].splitCameraNear = nd;\n        for (let i = 1; i < level; i++) {\n            // i ÷ numbers of level\n            const si = i / level;\n            // eslint-disable-next-line no-restricted-properties\n            const preNear = lambda * (nd * Math.pow(ratio, si)) + (1 - lambda) * (nd + (fd - nd) * si);\n            // Slightly increase the overlap to avoid fracture\n            const nextFar = preNear * 1.005;\n            this._layers[i].splitCameraNear = preNear;\n            this._layers[i - 1].splitCameraFar = nextFar;\n        }\n        // numbers of level - 1\n        this._layers[level - 1].splitCameraFar = fd;\n\n        dirLight.csmNeedUpdate = false;\n    }\n\n    private _calculateCSM (camera: Camera, dirLight: DirectionalLight, shadowInfo: Shadows) {\n        const level = legacyCC.director.root.pipeline.pipelineSceneData.csmSupported ? dirLight.csmLevel : 1;\n        const shadowMapWidth = level > 1 ? shadowInfo.size.x * 0.5 : shadowInfo.size.x;\n\n        if (shadowMapWidth < 0.0) { return; }\n\n        this._getCameraWorldMatrix(_mat4Trans, camera);\n        for (let i = level - 1; i >= 0; i--) {\n            const csmLayer = this._layers[i];\n            const near = csmLayer.splitCameraNear;\n            const far = csmLayer.splitCameraFar;\n            csmLayer.calculateSplitFrustum(camera, _mat4Trans, near, far);\n            csmLayer.createMatrix(dirLight, shadowMapWidth, false);\n        }\n\n        if (level === CSMLevel.LEVEL_1) {\n            this._specialLayer.shadowCameraFar = this._layers[0].shadowCameraFar;\n            Mat4.copy(this._specialLayer.matShadowView, this._layers[0].matShadowView);\n            Mat4.copy(this._specialLayer.matShadowProj, this._layers[0].matShadowProj);\n            Mat4.copy(this._specialLayer.matShadowViewProj, this._layers[0].matShadowViewProj);\n            this._specialLayer.copyToValidFrustum(this._layers[0].validFrustum);\n        } else {\n            this._specialLayer.calculateSplitFrustum(camera, _mat4Trans, 0.1, dirLight.shadowDistance);\n            this._specialLayer.createMatrix(dirLight, shadowMapWidth, true);\n        }\n    }\n\n    private _getCameraWorldMatrix (out: Mat4, camera: Camera) {\n        if (!camera.node) { return; }\n\n        const cameraNode = camera.node;\n        const position = cameraNode.getWorldPosition();\n        const rotation = cameraNode.getWorldRotation();\n\n        Mat4.fromRT(out, rotation, position);\n        out.m08 *= -1.0;\n        out.m09 *= -1.0;\n        out.m10 *= -1.0;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Device } from '../../gfx';\nimport { MAX_BLOOM_FILTER_PASS_NUM } from '../render-pipeline';\nimport { Material } from '../../assets';\nimport { PipelineSceneData } from '../pipeline-scene-data';\nimport { macro } from '../../platform/macro';\nimport { legacyCC } from '../../global-exports';\n\n// Anti-aliasing type, other types will be gradually added in the future\nexport enum AntiAliasing {\n    NONE,\n    FXAA,\n}\nexport const BLOOM_PREFILTERPASS_INDEX = 0;\nexport const BLOOM_DOWNSAMPLEPASS_INDEX = 1;\nexport const BLOOM_UPSAMPLEPASS_INDEX = BLOOM_DOWNSAMPLEPASS_INDEX + MAX_BLOOM_FILTER_PASS_NUM;\nexport const BLOOM_COMBINEPASS_INDEX = BLOOM_UPSAMPLEPASS_INDEX + MAX_BLOOM_FILTER_PASS_NUM;\nexport class DeferredPipelineSceneData extends PipelineSceneData {\n    protected _antiAliasing: AntiAliasing = AntiAliasing.NONE;\n    set antiAliasing (value: AntiAliasing) {\n        this._antiAliasing = value;\n        if (this._postprocessMaterial) {\n            const defines = this._postprocessMaterial.passes[0].defines;\n            Object.assign(defines, { ANTIALIAS_TYPE: value });\n            const renderMat = new Material();\n            renderMat.initialize({\n                effectAsset: this._postprocessMaterial.effectAsset,\n                defines,\n            });\n            for (let i = 0; i < renderMat.passes.length; ++i) {\n                renderMat.passes[i].tryCompile();\n            }\n            this._postprocessMaterial = renderMat;\n        }\n    }\n\n    get antiAliasing () {\n        return this._antiAliasing;\n    }\n\n    public get bloomMaterial () {\n        return this._bloomMaterial;\n    }\n\n    public set bloomMaterial (mat: Material) {\n        if (this._bloomMaterial === mat || !mat) return;\n        this._bloomMaterial = mat;\n        this.updatePipelinePassInfo();\n    }\n    protected declare _bloomMaterial: Material;\n\n    public get postprocessMaterial () {\n        return this._postprocessMaterial;\n    }\n\n    public set postprocessMaterial (mat: Material) {\n        if (this._postprocessMaterial === mat || !mat) return;\n        this._postprocessMaterial = mat;\n        this.updatePipelinePassInfo();\n    }\n    protected declare _postprocessMaterial: Material;\n\n    public updatePipelineSceneData () {\n        this.updatePipelinePassInfo();\n    }\n\n    private updateBloomPass () {\n        if (!this._bloomMaterial) return;\n\n        const prefilterPass = this._bloomMaterial.passes[BLOOM_PREFILTERPASS_INDEX];\n        prefilterPass.beginChangeStatesSilently();\n        prefilterPass.tryCompile();\n        prefilterPass.endChangeStatesSilently();\n\n        for (let i = 0; i < MAX_BLOOM_FILTER_PASS_NUM; ++i) {\n            const downsamplePass = this._bloomMaterial.passes[BLOOM_DOWNSAMPLEPASS_INDEX + i];\n            downsamplePass.beginChangeStatesSilently();\n            downsamplePass.tryCompile();\n            downsamplePass.endChangeStatesSilently();\n\n            const upsamplePass = this._bloomMaterial.passes[BLOOM_UPSAMPLEPASS_INDEX + i];\n            upsamplePass.beginChangeStatesSilently();\n            upsamplePass.tryCompile();\n            upsamplePass.endChangeStatesSilently();\n        }\n\n        const combinePass = this._bloomMaterial.passes[BLOOM_COMBINEPASS_INDEX];\n        combinePass.beginChangeStatesSilently();\n        combinePass.tryCompile();\n        combinePass.endChangeStatesSilently();\n    }\n\n    private updatePostProcessPass () {\n        if (!this.postprocessMaterial) return;\n\n        const passPost = this.postprocessMaterial.passes[0];\n        passPost.beginChangeStatesSilently();\n        passPost.tryCompile();\n        passPost.endChangeStatesSilently();\n    }\n\n    public initPipelinePassInfo () {\n        // builtin deferred material\n        const deferredMat = new Material();\n        deferredMat._uuid = 'builtin-deferred-material';\n        deferredMat.initialize({ effectName: 'pipeline/deferred-lighting' });\n        for (let i = 0; i < deferredMat.passes.length; ++i) {\n            deferredMat.passes[i].tryCompile();\n        }\n        this._deferredLightingMaterial = deferredMat;\n        const bloomMat = new Material();\n        bloomMat._uuid = 'builtin-bloom-material';\n        bloomMat.initialize({ effectName: 'pipeline/bloom' });\n        for (let i = 0; i < bloomMat.passes.length; ++i) {\n            bloomMat.passes[i].tryCompile();\n        }\n        this._bloomMaterial = bloomMat;\n\n        const postMat = new Material();\n        postMat._uuid = 'builtin-post-process-material';\n        if (macro.ENABLE_ANTIALIAS_FXAA) {\n            this._antiAliasing = AntiAliasing.FXAA;\n        }\n        postMat.initialize({\n            effectName: 'pipeline/post-process',\n            defines: {\n                // Anti-aliasing type, currently only fxaa, so 1 means fxaa\n                ANTIALIAS_TYPE: this._antiAliasing,\n            },\n        });\n        for (let i = 0; i < postMat.passes.length; ++i) {\n            postMat.passes[i].tryCompile();\n        }\n        this._postprocessMaterial = postMat;\n\n        this.updatePipelinePassInfo();\n    }\n\n    public get deferredLightingMaterial () {\n        return this._deferredLightingMaterial;\n    }\n\n    public set deferredLightingMaterial (mat: Material) {\n        if (this._deferredLightingMaterial === mat || !mat) return;\n        this._deferredLightingMaterial = mat;\n        this.updatePipelinePassInfo();\n    }\n\n    protected declare _deferredLightingMaterial: Material;\n    protected declare _deferredPostMaterial: Material;\n\n    protected updatePipelinePassInfo () {\n        this.updateBloomPass();\n        this.updatePostProcessPass();\n        this.updateDeferredPassInfo();\n    }\n\n    public activate (device: Device) {\n        super.activate(device);\n        this.initPipelinePassInfo();\n        return true;\n    }\n\n    private updateDeferredPassInfo () {\n        this.updateDeferredLightPass();\n    }\n\n    private updateDeferredLightPass () {\n        if (!this._deferredLightingMaterial) return;\n\n        // It's temporary solution for main light shadowmap\n        legacyCC.director.root.pipeline.macros.CC_RECEIVE_SHADOW = 1;\n\n        const passLit = this._deferredLightingMaterial.passes[0];\n        passLit.beginChangeStatesSilently();\n        passLit.tryCompile();\n        passLit.endChangeStatesSilently();\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n https://www.cocos.com/\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { Fog } from '../renderer/scene/fog';\nimport { Ambient } from '../renderer/scene/ambient';\nimport { Skybox } from '../renderer/scene/skybox';\nimport { Shadows } from '../renderer/scene/shadows';\nimport { Octree } from '../renderer/scene/octree';\nimport { IRenderObject } from './define';\nimport { Device, Framebuffer, InputAssembler, InputAssemblerInfo, Buffer, BufferInfo,\n    BufferUsageBit, MemoryUsageBit, Attribute, Format, Shader } from '../gfx';\nimport { Light } from '../renderer/scene/light';\nimport { Material } from '../assets';\nimport { Pass } from '../renderer/core/pass';\nimport { CSMLayers } from './shadow/csm-layers';\n\nconst GEOMETRY_RENDERER_TECHNIQUE_COUNT = 6;\n\nexport class PipelineSceneData {\n    /**\n      * @en Is open HDR.\n      * @zh 是否开启 HDR。\n      * @readonly\n      */\n    public get isHDR () {\n        return this._isHDR;\n    }\n\n    public set isHDR (val: boolean) {\n        this._isHDR = val;\n    }\n    public get shadingScale () {\n        return this._shadingScale;\n    }\n\n    public set shadingScale (val: number) {\n        this._shadingScale = val;\n    }\n\n    public get csmSupported () {\n        return this._csmSupported;\n    }\n    public set csmSupported (val: boolean) {\n        this._csmSupported = val;\n    }\n\n    public fog: Fog = new Fog();\n    public ambient: Ambient = new Ambient();\n    public skybox: Skybox = new Skybox();\n    public shadows: Shadows = new Shadows();\n    public csmLayers: CSMLayers = new CSMLayers();\n    public octree: Octree = new Octree();\n\n    /**\n      * @en The list for valid punctual Lights, only available after the scene culling of the current frame.\n      * @zh 场景中精确的有效光源，仅在当前帧的场景剔除完成后有效。\n      */\n    public validPunctualLights: Light[] = [];\n\n    /**\n      * @en The list for render objects, only available after the scene culling of the current frame.\n      * @zh 渲染对象数组，仅在当前帧的场景剔除完成后有效。\n      */\n    public renderObjects: IRenderObject[] = [];\n    public shadowFrameBufferMap: Map<Light, Framebuffer> = new Map();\n    protected declare _device: Device;\n    protected _geometryRendererMaterials: Material[] = [];\n    protected _geometryRendererPasses: Pass[] = [];\n    protected _geometryRendererShaders: Shader[] = [];\n    protected _occlusionQueryVertexBuffer: Buffer | null = null;\n    protected _occlusionQueryIndicesBuffer: Buffer | null = null;\n    protected _occlusionQueryInputAssembler: InputAssembler | null = null;\n    protected _occlusionQueryMaterial: Material | null = null;\n    protected _occlusionQueryShader: Shader | null = null;\n    protected _isHDR = true;\n    protected _shadingScale = 1.0;\n    protected _csmSupported = true;\n\n    constructor () {\n        this._shadingScale = 1.0;\n    }\n\n    public activate (device: Device) {\n        this._device = device;\n\n        this.initGeometryRendererMaterials();\n        this.initOcclusionQuery();\n\n        return true;\n    }\n\n    public initGeometryRendererMaterials () {\n        let offset = 0;\n        for (let tech = 0; tech < GEOMETRY_RENDERER_TECHNIQUE_COUNT; tech++) {\n            this._geometryRendererMaterials[tech] = new Material();\n            this._geometryRendererMaterials[tech]._uuid = `geometry-renderer-material-${tech}`;\n            this._geometryRendererMaterials[tech].initialize({ effectName: 'builtin-geometry-renderer', technique: tech });\n\n            for (let pass = 0; pass < this._geometryRendererMaterials[tech].passes.length; ++pass) {\n                this._geometryRendererPasses[offset] = this._geometryRendererMaterials[tech].passes[pass];\n                this._geometryRendererShaders[offset] = this._geometryRendererMaterials[tech].passes[pass].getShaderVariant()!;\n                offset++;\n            }\n        }\n    }\n\n    public get geometryRendererPasses () {\n        return this._geometryRendererPasses;\n    }\n\n    public get geometryRendererShaders () {\n        return this._geometryRendererShaders;\n    }\n\n    public initOcclusionQuery () {\n        if (!this._occlusionQueryInputAssembler) {\n            this._occlusionQueryInputAssembler = this._createOcclusionQueryIA();\n        }\n\n        if (!this._occlusionQueryMaterial) {\n            const mat = new Material();\n            mat._uuid = 'default-occlusion-query-material';\n            mat.initialize({ effectName: 'builtin-occlusion-query' });\n            this._occlusionQueryMaterial = mat;\n            if (mat.passes.length > 0) {\n                this._occlusionQueryShader = mat.passes[0].getShaderVariant();\n            }\n        }\n    }\n\n    public getOcclusionQueryPass (): Pass | null {\n        if (this._occlusionQueryMaterial && this._occlusionQueryMaterial.passes.length > 0) {\n            return this._occlusionQueryMaterial.passes[0];\n        }\n\n        return null;\n    }\n\n    public updatePipelineSceneData () {\n    }\n\n    public destroy () {\n        this.shadows.destroy();\n        this.csmLayers.destroy();\n        this.validPunctualLights.length = 0;\n        this._occlusionQueryInputAssembler?.destroy();\n        this._occlusionQueryInputAssembler = null;\n        this._occlusionQueryVertexBuffer?.destroy();\n        this._occlusionQueryVertexBuffer = null;\n        this._occlusionQueryIndicesBuffer?.destroy();\n        this._occlusionQueryIndicesBuffer = null;\n    }\n\n    private _createOcclusionQueryIA () {\n        // create vertex buffer\n        const device = this._device;\n        const vertices = new Float32Array([-1, -1, -1, 1, -1, -1, -1, 1, -1, 1, 1, -1, -1, -1, 1, 1, -1, 1, -1, 1, 1, 1, 1, 1]);\n        const vbStride = Float32Array.BYTES_PER_ELEMENT * 3;\n        const vbSize = vbStride * 8;\n        this._occlusionQueryVertexBuffer = device.createBuffer(new BufferInfo(\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE, vbSize, vbStride,\n        ));\n        this._occlusionQueryVertexBuffer.update(vertices);\n\n        // create index buffer\n        const indices = new Uint16Array([0, 2, 1, 1, 2, 3, 4, 5, 6, 5, 7, 6, 1, 3, 7, 1, 7, 5, 0, 4, 6, 0, 6, 2, 0, 1, 5, 0, 5, 4, 2, 6, 7, 2, 7, 3]);\n        const ibStride = Uint16Array.BYTES_PER_ELEMENT;\n        const ibSize = ibStride * 36;\n        this._occlusionQueryIndicesBuffer = device.createBuffer(new BufferInfo(\n            BufferUsageBit.INDEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE, ibSize, ibStride,\n        ));\n        this._occlusionQueryIndicesBuffer.update(indices);\n\n        const attributes: Attribute[] = [\n            new Attribute('a_position', Format.RGB32F),\n        ];\n\n        // create cube input assembler\n        const info = new InputAssemblerInfo(attributes, [this._occlusionQueryVertexBuffer], this._occlusionQueryIndicesBuffer);\n        const inputAssembler = device.createInputAssembler(info);\n\n        return inputAssembler;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { ccclass, displayOrder, type, serializable } from 'cc.decorator';\nimport { EDITOR } from 'internal:constants';\nimport { RenderPipeline, IRenderPipelineInfo } from '../render-pipeline';\nimport { ForwardFlow } from './forward-flow';\nimport { RenderTextureConfig } from '../pipeline-serialization';\nimport { ShadowFlow } from '../shadow/shadow-flow';\nimport { UBOGlobal, UBOShadow, UBOCamera, UNIFORM_SHADOWMAP_BINDING, UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING } from '../define';\nimport { Swapchain, RenderPass } from '../../gfx';\nimport { builtinResMgr } from '../../builtin';\nimport { Texture2D } from '../../assets/texture-2d';\nimport { Camera } from '../../renderer/scene';\nimport { errorID } from '../../platform/debug';\nimport { PipelineSceneData } from '../pipeline-scene-data';\n\nconst PIPELINE_TYPE = 0;\n\n/**\n * @en The forward render pipeline\n * @zh 前向渲染管线。\n */\n@ccclass('ForwardPipeline')\nexport class ForwardPipeline extends RenderPipeline {\n    @type([RenderTextureConfig])\n    @serializable\n    @displayOrder(2)\n    protected renderTextures: RenderTextureConfig[] = [];\n\n    protected _postRenderPass: RenderPass | null = null;\n\n    public get postRenderPass (): RenderPass | null {\n        return this._postRenderPass;\n    }\n\n    public initialize (info: IRenderPipelineInfo): boolean {\n        super.initialize(info);\n\n        if (this._flows.length === 0) {\n            const shadowFlow = new ShadowFlow();\n            shadowFlow.initialize(ShadowFlow.initInfo);\n            this._flows.push(shadowFlow);\n\n            const forwardFlow = new ForwardFlow();\n            forwardFlow.initialize(ForwardFlow.initInfo);\n            this._flows.push(forwardFlow);\n        }\n\n        return true;\n    }\n\n    public activate (swapchain: Swapchain): boolean {\n        if (EDITOR) { console.info('Forward render pipeline initialized.'); }\n\n        this._macros = { CC_PIPELINE_TYPE: PIPELINE_TYPE };\n        this._pipelineSceneData = new PipelineSceneData();\n\n        if (!super.activate(swapchain)) {\n            return false;\n        }\n\n        if (!this._activeRenderer(swapchain)) {\n            errorID(2402);\n            return false;\n        }\n\n        return true;\n    }\n\n    protected _ensureEnoughSize (cameras: Camera[]) {\n        let newWidth = this._width;\n        let newHeight = this._height;\n        for (let i = 0; i < cameras.length; ++i) {\n            const window = cameras[i].window;\n            newWidth = Math.max(window.width, newWidth);\n            newHeight = Math.max(window.height, newHeight);\n        }\n        if (newWidth !== this._width || newHeight !== this._height) {\n            this._width = newWidth;\n            this._height = newHeight;\n        }\n    }\n\n    public destroy () {\n        this._destroyUBOs();\n        this._destroyQuadInputAssembler();\n        const rpIter = this._renderPasses.values();\n        let rpRes = rpIter.next();\n        while (!rpRes.done) {\n            rpRes.value.destroy();\n            rpRes = rpIter.next();\n        }\n\n        this._commandBuffers.length = 0;\n\n        return super.destroy();\n    }\n\n    private _activeRenderer (swapchain: Swapchain) {\n        const device = this.device;\n\n        this._commandBuffers.push(device.commandBuffer);\n\n        const shadowMapSampler = this.globalDSManager.pointSampler;\n        this._descriptorSet.bindSampler(UNIFORM_SHADOWMAP_BINDING, shadowMapSampler);\n        this._descriptorSet.bindTexture(UNIFORM_SHADOWMAP_BINDING, builtinResMgr.get<Texture2D>('default-texture').getGFXTexture()!);\n        this._descriptorSet.bindSampler(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, shadowMapSampler);\n        this._descriptorSet.bindTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, builtinResMgr.get<Texture2D>('default-texture').getGFXTexture()!);\n        this._descriptorSet.update();\n\n        return true;\n    }\n\n    private _destroyUBOs () {\n        if (this._descriptorSet) {\n            this._descriptorSet.getBuffer(UBOGlobal.BINDING).destroy();\n            this._descriptorSet.getBuffer(UBOShadow.BINDING).destroy();\n            this._descriptorSet.getBuffer(UBOCamera.BINDING).destroy();\n            this._descriptorSet.getTexture(UNIFORM_SHADOWMAP_BINDING).destroy();\n            this._descriptorSet.getTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING).destroy();\n        }\n    }\n}\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @category pipeline\n */\n\nimport { ccclass, displayOrder, type, serializable } from 'cc.decorator';\nimport { Camera } from '../../renderer/scene';\nimport { SetIndex } from '../define';\nimport { getPhaseID } from '../pass-phase';\nimport { renderQueueClearFunc, RenderQueue, convertRenderQueue, renderQueueSortFunc } from '../render-queue';\nimport { ClearFlagBit, Color, Rect } from '../../gfx';\nimport { SRGBToLinear } from '../pipeline-funcs';\nimport { RenderBatchedQueue } from '../render-batched-queue';\nimport { RenderInstancedQueue } from '../render-instanced-queue';\nimport { IRenderStageInfo, RenderStage } from '../render-stage';\nimport { DeferredStagePriority } from '../enum';\nimport { InstancedBuffer } from '../instanced-buffer';\nimport { BatchedBuffer } from '../batched-buffer';\nimport { BatchingSchemes } from '../../renderer/core/pass';\nimport { DeferredPipeline } from './deferred-pipeline';\nimport { RenderQueueDesc, RenderQueueSortMode } from '../pipeline-serialization';\nimport { MainFlow } from './main-flow';\n\nconst colors: Color[] = [new Color(0, 0, 0, 0), new Color(0, 0, 0, 0), new Color(0, 0, 0, 0)];\n\n/**\n * @en The gbuffer render stage\n * @zh 前向渲染阶段。\n */\n@ccclass('GbufferStage')\nexport class GbufferStage extends RenderStage {\n    public static initInfo: IRenderStageInfo = {\n        name: 'GbufferStage',\n        priority: DeferredStagePriority.GBUFFER,\n        tag: 0,\n        renderQueues: [\n            {\n                isTransparent: false,\n                sortMode: RenderQueueSortMode.FRONT_TO_BACK,\n                stages: ['default'],\n            },\n            {\n                isTransparent: true,\n                sortMode: RenderQueueSortMode.BACK_TO_FRONT,\n                stages: ['default'],\n            },\n        ],\n    };\n\n    @type([RenderQueueDesc])\n    @serializable\n    @displayOrder(2)\n    protected renderQueues: RenderQueueDesc[] = [];\n    protected _renderQueues: RenderQueue[] = [];\n\n    private _renderArea = new Rect();\n    private _batchedQueue: RenderBatchedQueue;\n    private _instancedQueue: RenderInstancedQueue;\n    private _phaseID = getPhaseID('default');\n\n    constructor () {\n        super();\n        this._batchedQueue = new RenderBatchedQueue();\n        this._instancedQueue = new RenderInstancedQueue();\n    }\n\n    public initialize (info: IRenderStageInfo): boolean {\n        super.initialize(info);\n        if (info.renderQueues) {\n            this.renderQueues = info.renderQueues;\n        }\n        return true;\n    }\n\n    public activate (pipeline: DeferredPipeline, flow: MainFlow) {\n        super.activate(pipeline, flow);\n        for (let i = 0; i < this.renderQueues.length; i++) {\n            this._renderQueues[i] = convertRenderQueue(this.renderQueues[i]);\n        }\n    }\n\n    public destroy () {\n    }\n\n    public render (camera: Camera) {\n        this._instancedQueue.clear();\n        this._batchedQueue.clear();\n        const pipeline = this._pipeline as DeferredPipeline;\n        const device = pipeline.device;\n        this._renderQueues.forEach(renderQueueClearFunc);\n\n        pipeline.generateRenderArea(camera, this._renderArea);\n        pipeline.updateQuadVertexData(this._renderArea, camera.window);\n\n        const renderObjects = pipeline.pipelineSceneData.renderObjects;\n\n        let m = 0; let p = 0; let k = 0;\n        for (let i = 0; i < renderObjects.length; ++i) {\n            const ro = renderObjects[i];\n            const subModels = ro.model.subModels;\n            for (m = 0; m < subModels.length; ++m) {\n                const subModel = subModels[m];\n                const passes = subModel.passes;\n                for (p = 0; p < passes.length; ++p) {\n                    const pass = passes[p];\n                    if (pass.phase !== this._phaseID) continue;\n                    const batchingScheme = pass.batchingScheme;\n                    if (batchingScheme === BatchingSchemes.INSTANCING) {\n                        const instancedBuffer = pass.getInstancedBuffer();\n                        instancedBuffer.merge(subModel, p);\n                        this._instancedQueue.queue.add(instancedBuffer);\n                    } else if (batchingScheme === BatchingSchemes.VB_MERGING) {\n                        const batchedBuffer = pass.getBatchedBuffer();\n                        batchedBuffer.merge(subModel, p, ro.model);\n                        this._batchedQueue.queue.add(batchedBuffer);\n                    } else {\n                        for (k = 0; k < this._renderQueues.length; k++) {\n                            this._renderQueues[k].insertRenderPass(ro, m, p);\n                        }\n                    }\n                }\n            }\n        }\n        this._renderQueues.forEach(renderQueueSortFunc);\n\n        const cmdBuff = pipeline.commandBuffers[0];\n\n        this._instancedQueue.uploadBuffers(cmdBuff);\n        this._batchedQueue.uploadBuffers(cmdBuff);\n\n        if (camera.clearFlag & ClearFlagBit.COLOR) {\n            if (pipeline.pipelineSceneData.isHDR) {\n                SRGBToLinear(colors[0], camera.clearColor);\n            } else {\n                colors[0].x = camera.clearColor.x;\n                colors[0].y = camera.clearColor.y;\n                colors[0].z = camera.clearColor.z;\n            }\n        }\n\n        colors[0].w = camera.clearColor.w;\n\n        const deferredData = pipeline.getPipelineRenderData();\n        const framebuffer = deferredData.gbufferFrameBuffer;\n        const renderPass = framebuffer.renderPass;\n        cmdBuff.beginRenderPass(renderPass, framebuffer, this._renderArea,\n            colors, camera.clearDepth, camera.clearStencil);\n        cmdBuff.setScissor(pipeline.generateScissor(camera));\n        cmdBuff.setViewport(pipeline.generateViewport(camera));\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n\n        for (let i = 0; i < this.renderQueues.length; i++) {\n            this._renderQueues[i].recordCommandBuffer(device, renderPass, cmdBuff);\n        }\n        this._instancedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n        this._batchedQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n\n        cmdBuff.endRenderPass();\n    }\n}\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @category pipeline\n */\n\nimport { ccclass, displayOrder, type, serializable } from 'cc.decorator';\nimport { Camera } from '../../renderer/scene';\nimport { UBODeferredLight, SetIndex, UBOForwardLight, UBOLocal } from '../define';\nimport { getPhaseID } from '../pass-phase';\nimport { Color, Rect, Buffer, BufferUsageBit, MemoryUsageBit, BufferInfo, BufferViewInfo, DescriptorSet, DescriptorSetLayoutInfo,\n    DescriptorSetLayout, DescriptorSetInfo, PipelineState, ClearFlagBit } from '../../gfx';\nimport { IRenderStageInfo, RenderStage } from '../render-stage';\nimport { DeferredStagePriority } from '../enum';\nimport { MainFlow } from './main-flow';\nimport { DeferredPipeline } from './deferred-pipeline';\nimport { PlanarShadowQueue } from '../planar-shadow-queue';\nimport { Material } from '../../assets/material';\nimport { PipelineStateManager } from '../pipeline-state-manager';\nimport { intersect, Sphere } from '../../geometry';\nimport { Vec3, Vec4 } from '../../math';\nimport { DeferredPipelineSceneData } from './deferred-pipeline-scene-data';\nimport { renderQueueClearFunc, RenderQueue, convertRenderQueue, renderQueueSortFunc } from '../render-queue';\nimport { RenderQueueDesc } from '../pipeline-serialization';\nimport { UIPhase } from '../ui-phase';\nimport { Pass } from '../../renderer/core/pass';\n\nconst colors: Color[] = [new Color(0, 0, 0, 1)];\n\n/**\n * @en The lighting render stage\n * @zh 前向渲染阶段。\n */\n@ccclass('LightingStage')\nexport class LightingStage extends RenderStage {\n    private _deferredLitsBufs: Buffer = null!;\n    private _maxDeferredLights = UBODeferredLight.LIGHTS_PER_PASS;\n    private _lightBufferData!: Float32Array;\n    private _lightMeterScale = 10000.0;\n    private _descriptorSet: DescriptorSet = null!;\n    private _descriptorSetLayout!: DescriptorSetLayout;\n    private _renderArea = new Rect();\n    private declare _planarQueue: PlanarShadowQueue;\n    private _uiPhase: UIPhase;\n\n    @type(Material)\n    @serializable\n    @displayOrder(3)\n    private _deferredMaterial: Material | null = null;\n\n    @type([RenderQueueDesc])\n    @serializable\n    @displayOrder(2)\n    private renderQueues: RenderQueueDesc[] = [];\n    private _phaseID = getPhaseID('default');\n    private _renderQueues: RenderQueue[] = [];\n\n    public static initInfo: IRenderStageInfo = {\n        name: 'LightingStage',\n        priority: DeferredStagePriority.LIGHTING,\n        tag: 0,\n    };\n\n    constructor () {\n        super();\n        this._uiPhase = new UIPhase();\n    }\n\n    public initialize (info: IRenderStageInfo): boolean {\n        super.initialize(info);\n        return true;\n    }\n    public gatherLights (camera: Camera) {\n        const pipeline = this._pipeline as DeferredPipeline;\n        const cmdBuff = pipeline.commandBuffers[0];\n\n        const sphereLights = camera.scene!.sphereLights;\n        const spotLights = camera.scene!.spotLights;\n        const _sphere = Sphere.create(0, 0, 0, 1);\n        const _vec4Array = new Float32Array(4);\n        const exposure = camera.exposure;\n\n        let idx = 0;\n        const elementLen = Vec4.length; // sizeof(vec4) / sizeof(float32)\n        const fieldLen = elementLen * this._maxDeferredLights;\n\n        for (let i = 0; i < sphereLights.length && idx < this._maxDeferredLights; i++, ++idx) {\n            const light = sphereLights[i];\n            Sphere.set(_sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(_sphere, camera.frustum)) {\n                // cc_lightPos\n                Vec3.toArray(_vec4Array, light.position);\n                _vec4Array[3] = 0;\n                this._lightBufferData.set(_vec4Array, idx * elementLen);\n\n                // cc_lightColor\n                Vec3.toArray(_vec4Array, light.color);\n                if (light.useColorTemperature) {\n                    const tempRGB = light.colorTemperatureRGB;\n                    _vec4Array[0] *= tempRGB.x;\n                    _vec4Array[1] *= tempRGB.y;\n                    _vec4Array[2] *= tempRGB.z;\n                }\n\n                if (pipeline.pipelineSceneData.isHDR) {\n                    _vec4Array[3] = light.luminance * exposure * this._lightMeterScale;\n                } else {\n                    _vec4Array[3] = light.luminance;\n                }\n\n                this._lightBufferData.set(_vec4Array, idx * elementLen + fieldLen * 1);\n\n                // cc_lightSizeRangeAngle\n                _vec4Array[0] = light.size;\n                _vec4Array[1] = light.range;\n                _vec4Array[2] = 0.0;\n                this._lightBufferData.set(_vec4Array, idx * elementLen + fieldLen * 2);\n            }\n        }\n\n        for (let i = 0; i < spotLights.length && idx < this._maxDeferredLights; i++, ++idx) {\n            const light = spotLights[i];\n            Sphere.set(_sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(_sphere, camera.frustum)) {\n                // cc_lightPos\n                Vec3.toArray(_vec4Array, light.position);\n                _vec4Array[3] = 1;\n                this._lightBufferData.set(_vec4Array, idx * elementLen + fieldLen * 0);\n\n                // cc_lightColor\n                Vec3.toArray(_vec4Array, light.color);\n                if (light.useColorTemperature) {\n                    const tempRGB = light.colorTemperatureRGB;\n                    _vec4Array[0] *= tempRGB.x;\n                    _vec4Array[1] *= tempRGB.y;\n                    _vec4Array[2] *= tempRGB.z;\n                }\n                if (pipeline.pipelineSceneData.isHDR) {\n                    _vec4Array[3] = light.luminance * exposure * this._lightMeterScale;\n                } else {\n                    _vec4Array[3] = light.luminance;\n                }\n                this._lightBufferData.set(_vec4Array, idx * elementLen + fieldLen * 1);\n\n                // cc_lightSizeRangeAngle\n                _vec4Array[0] = light.size;\n                _vec4Array[1] = light.range;\n                _vec4Array[2] = light.spotAngle;\n                this._lightBufferData.set(_vec4Array, idx * elementLen + fieldLen * 2);\n\n                // cc_lightDir\n                Vec3.toArray(_vec4Array, light.direction);\n                this._lightBufferData.set(_vec4Array, idx * elementLen + fieldLen * 3);\n            }\n        }\n\n        // the count of lights is set to cc_lightDir[0].w\n        const offset = fieldLen * 3 + 3;\n        this._lightBufferData.set([idx], offset);\n\n        cmdBuff.updateBuffer(this._deferredLitsBufs, this._lightBufferData);\n    }\n\n    protected _createStageDescriptor (pass: Pass) {\n        const device = this._pipeline.device;\n        let totalSize = Float32Array.BYTES_PER_ELEMENT * 4 * 4 * this._maxDeferredLights;\n        totalSize = Math.ceil(totalSize / device.capabilities.uboOffsetAlignment) * device.capabilities.uboOffsetAlignment;\n\n        this._deferredLitsBufs = device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n            totalSize,\n            device.capabilities.uboOffsetAlignment,\n        ));\n\n        const deferredLitsBufView = device.createBuffer(new BufferViewInfo(this._deferredLitsBufs, 0, totalSize));\n        this._lightBufferData = new Float32Array(totalSize / Float32Array.BYTES_PER_ELEMENT);\n\n        this._descriptorSet = device.createDescriptorSet(new DescriptorSetInfo(pass.localSetLayout));\n        this._descriptorSet.bindBuffer(UBOForwardLight.BINDING, deferredLitsBufView);\n\n        const _localUBO = device.createBuffer(new BufferInfo(\n            BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE,\n            UBOLocal.SIZE,\n            UBOLocal.SIZE,\n        ));\n        this._descriptorSet.bindBuffer(UBOLocal.BINDING, _localUBO);\n    }\n\n    public activate (pipeline: DeferredPipeline, flow: MainFlow) {\n        super.activate(pipeline, flow);\n        this._uiPhase.activate(pipeline);\n\n        // activate queue\n        for (let i = 0; i < this.renderQueues.length; i++) {\n            this._renderQueues[i] = convertRenderQueue(this.renderQueues[i]);\n        }\n\n        this._planarQueue = new PlanarShadowQueue(this._pipeline as DeferredPipeline);\n\n        if (this._deferredMaterial) { (pipeline.pipelineSceneData as DeferredPipelineSceneData).deferredLightingMaterial = this._deferredMaterial; }\n    }\n\n    public destroy () {\n        this._deferredLitsBufs?.destroy();\n        this._deferredLitsBufs = null!;\n        this._descriptorSet = null!;\n    }\n    public render (camera: Camera) {\n        const pipeline = this._pipeline as DeferredPipeline;\n        const device = pipeline.device;\n\n        const cmdBuff = pipeline.commandBuffers[0];\n        const sceneData = pipeline.pipelineSceneData;\n        const renderObjects = sceneData.renderObjects;\n\n        this._planarQueue.gatherShadowPasses(camera, cmdBuff);\n\n        pipeline.generateRenderArea(camera, this._renderArea);\n        // Lighting\n        const deferredData = pipeline.getPipelineRenderData();\n        const lightingMat = (sceneData as DeferredPipelineSceneData).deferredLightingMaterial;\n        const pass = lightingMat.passes[0];\n        const shader = pass.getShaderVariant();\n\n        for (let i = 0; i < 3; ++i) {\n            pass.descriptorSet.bindTexture(i, deferredData.gbufferRenderTargets[i]);\n            pass.descriptorSet.bindSampler(i, deferredData.sampler);\n        }\n        pass.descriptorSet.bindTexture(3, deferredData.outputDepth);\n        pass.descriptorSet.bindSampler(3, deferredData.sampler);\n        pass.descriptorSet.update();\n        if (!this._descriptorSet) {\n            this._createStageDescriptor(pass);\n        }\n        // light信息\n        this.gatherLights(camera);\n\n        if (camera.clearFlag & ClearFlagBit.COLOR) {\n            colors[0].x = camera.clearColor.x;\n            colors[0].y = camera.clearColor.y;\n            colors[0].z = camera.clearColor.z;\n        }\n\n        colors[0].w = 0;\n\n        const framebuffer = deferredData.outputFrameBuffer;\n        const renderPass = framebuffer.renderPass;\n\n        pipeline.pipelineUBO.updateShadowUBO(camera);\n\n        cmdBuff.beginRenderPass(renderPass, framebuffer, this._renderArea,\n            colors, camera.clearDepth, camera.clearStencil);\n        cmdBuff.setScissor(pipeline.generateScissor(camera));\n        cmdBuff.setViewport(pipeline.generateViewport(camera));\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n\n        const inputAssembler = pipeline.quadIAOffscreen;\n        let pso:PipelineState|null = null;\n        if (pass != null && shader != null && inputAssembler != null) {\n            pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader, renderPass, inputAssembler);\n        }\n\n        if (pso != null) {\n            this._descriptorSet.update();\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n            cmdBuff.bindDescriptorSet(SetIndex.LOCAL, this._descriptorSet);\n            cmdBuff.bindInputAssembler(inputAssembler);\n            cmdBuff.draw(inputAssembler);\n        }\n\n        // Transparent\n        this._renderQueues.forEach(renderQueueClearFunc);\n\n        let m = 0; let p = 0; let k = 0;\n        for (let i = 0; i < renderObjects.length; ++i) {\n            const ro = renderObjects[i];\n            const subModels = ro.model.subModels;\n            for (m = 0; m < subModels.length; ++m) {\n                const subModel = subModels[m];\n                const passes = subModel.passes;\n                for (p = 0; p < passes.length; ++p) {\n                    const pass = passes[p];\n                    if (pass.phase !== this._phaseID) continue;\n                    for (k = 0; k < this._renderQueues.length; k++) {\n                        this._renderQueues[k].insertRenderPass(ro, m, p);\n                    }\n                }\n            }\n        }\n        if (renderObjects.length > 0) {\n            this._renderQueues.forEach(renderQueueSortFunc);\n            for (let i = 0; i < this._renderQueues.length; i++) {\n                this._renderQueues[i].recordCommandBuffer(device, renderPass, cmdBuff);\n            }\n\n            // planarQueue\n            this._planarQueue.recordCommandBuffer(device, renderPass, cmdBuff);\n        }\n        camera.geometryRenderer?.render(renderPass, cmdBuff, pipeline.pipelineSceneData);\n        this._uiPhase.render(camera, renderPass);\n        cmdBuff.endRenderPass();\n    }\n}\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @category pipeline\n */\nimport { ccclass, displayOrder, type, serializable } from 'cc.decorator';\nimport { Camera } from '../../renderer/scene';\nimport { SetIndex, UBOLocal } from '../define';\nimport { Color, Rect, PipelineState, ClearFlagBit, DescriptorSetInfo, BufferInfo, BufferUsageBit, MemoryUsageBit } from '../../gfx';\nimport { IRenderStageInfo, RenderStage } from '../render-stage';\nimport { CommonStagePriority } from '../enum';\nimport { Material } from '../../assets/material';\nimport { PipelineStateManager } from '../pipeline-state-manager';\nimport { RenderQueueDesc } from '../pipeline-serialization';\nimport { renderProfiler } from '../pipeline-funcs';\nimport { RenderFlow, RenderPipeline } from '..';\nimport { UIPhase } from '../ui-phase';\nimport { DeferredPipelineSceneData } from './deferred-pipeline-scene-data';\n\nconst colors: Color[] = [new Color(0, 0, 0, 1)];\n\n/**\n  * @en The postprocess render stage\n  * @zh 后处理渲染阶段。\n  */\n@ccclass('PostProcessStage')\nexport class PostProcessStage extends RenderStage {\n    public static initInfo: IRenderStageInfo = {\n        name: 'PostProcessStage',\n        priority: CommonStagePriority.POST_PROCESS,\n        tag: 0,\n    };\n\n    @type(Material)\n    @serializable\n    @displayOrder(3)\n    private _postProcessMaterial: Material | null = null;\n\n    @type([RenderQueueDesc])\n    @serializable\n    @displayOrder(2)\n    private renderQueues: RenderQueueDesc[] = [];\n\n    private _renderArea = new Rect();\n    private declare _uiPhase: UIPhase;\n    private _stageDesc;\n    private _localUBO;\n    constructor () {\n        super();\n        this._uiPhase = new UIPhase();\n    }\n\n    public initialize (info: IRenderStageInfo): boolean {\n        super.initialize(info);\n        return true;\n    }\n\n    public activate (pipeline: RenderPipeline, flow: RenderFlow) {\n        super.activate(pipeline, flow);\n        if (this._postProcessMaterial) { (pipeline.pipelineSceneData as DeferredPipelineSceneData).postprocessMaterial = this._postProcessMaterial; }\n        this._uiPhase.activate(pipeline);\n    }\n\n    public destroy () {\n    }\n    public render (camera: Camera) {\n        const pipeline = this._pipeline;\n        const device = pipeline.device;\n        const sceneData = pipeline.pipelineSceneData;\n        const cmdBuff = pipeline.commandBuffers[0];\n        pipeline.pipelineUBO.updateCameraUBO(camera);\n\n        const vp = camera.viewport;\n        this._renderArea.x = vp.x * camera.window.width;\n        this._renderArea.y = vp.y * camera.window.height;\n        this._renderArea.width = vp.width * camera.window.width;\n        this._renderArea.height = vp.height * camera.window.height;\n        const renderData = pipeline.getPipelineRenderData();\n        const framebuffer = camera.window.framebuffer;\n        const renderPass = pipeline.getRenderPass(camera.clearFlag, framebuffer);\n\n        if (camera.clearFlag & ClearFlagBit.COLOR) {\n            colors[0].x = camera.clearColor.x;\n            colors[0].y = camera.clearColor.y;\n            colors[0].z = camera.clearColor.z;\n        }\n\n        colors[0].w = camera.clearColor.w;\n\n        cmdBuff.beginRenderPass(renderPass, framebuffer, this._renderArea,\n            colors, camera.clearDepth, camera.clearStencil);\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n        // Postprocess\n        const builtinPostProcess = (sceneData as DeferredPipelineSceneData).postprocessMaterial;\n        const pass = builtinPostProcess.passes[0];\n        const shader = pass.getShaderVariant();\n\n        if (pipeline.bloomEnabled) {\n            pass.descriptorSet.bindTexture(0, renderData.bloom!.combineTex);\n        } else {\n            pass.descriptorSet.bindTexture(0, renderData.outputRenderTargets[0]);\n        }\n        pass.descriptorSet.bindSampler(0, renderData.sampler);\n        pass.descriptorSet.update();\n\n        const inputAssembler = camera.window.swapchain ? pipeline.quadIAOnscreen : pipeline.quadIAOffscreen;\n        let pso: PipelineState | null = null;\n        if (pass != null && shader != null && inputAssembler != null) {\n            pso = PipelineStateManager.getOrCreatePipelineState(device, pass, shader, renderPass, inputAssembler);\n        }\n\n        const renderObjects = pipeline.pipelineSceneData.renderObjects;\n        if (pso != null && renderObjects.length > 0) {\n            if (!this._stageDesc) {\n                this._stageDesc = device.createDescriptorSet(new DescriptorSetInfo(pass.localSetLayout));\n                this._localUBO = device.createBuffer(new BufferInfo(\n                    BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n                    MemoryUsageBit.DEVICE,\n                    UBOLocal.SIZE,\n                    UBOLocal.SIZE,\n                ));\n                this._stageDesc.bindBuffer(UBOLocal.BINDING, this._localUBO);\n            }\n            this._stageDesc.update();\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n            cmdBuff.bindDescriptorSet(SetIndex.LOCAL, this._stageDesc);\n            cmdBuff.bindInputAssembler(inputAssembler);\n            cmdBuff.draw(inputAssembler);\n        }\n        this._uiPhase.render(camera, renderPass);\n        renderProfiler(device, renderPass, cmdBuff, pipeline.profiler, camera);\n\n        cmdBuff.endRenderPass();\n    }\n}\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @category pipeline\n */\n\nimport { ccclass, displayOrder, serializable, type } from 'cc.decorator';\nimport { Camera } from '../../renderer/scene';\nimport { SetIndex } from '../define';\nimport { RenderFlow, RenderPipeline } from '..';\nimport { Material } from '../../assets/material';\nimport { BufferInfo, BufferUsageBit, ClearFlagBit, Color, MemoryUsageBit, PipelineState, Rect } from '../../gfx';\nimport { PipelineStateManager } from '../pipeline-state-manager';\nimport { IRenderStageInfo, RenderStage } from '../render-stage';\nimport { CommonStagePriority } from '../enum';\nimport { gfx } from '../..';\nimport { MAX_BLOOM_FILTER_PASS_NUM } from '../render-pipeline';\nimport { BLOOM_COMBINEPASS_INDEX, BLOOM_DOWNSAMPLEPASS_INDEX, BLOOM_PREFILTERPASS_INDEX,\n    BLOOM_UPSAMPLEPASS_INDEX,\n    DeferredPipelineSceneData } from './deferred-pipeline-scene-data';\n\nconst colors: Color[] = [new Color(0, 0, 0, 1)];\n\n/**\n * @en The uniform buffer object for bloom\n * @zh Bloom UBO。\n */\nclass UBOBloom {\n    public static readonly TEXTURE_SIZE_OFFSET = 0;\n    public static readonly COUNT = UBOBloom.TEXTURE_SIZE_OFFSET + 4;\n    public static readonly SIZE = UBOBloom.COUNT * 4;\n}\n\n/**\n * @en The bloom post-process stage\n * @zh Bloom 后处理阶段。\n */\n@ccclass('BloomStage')\nexport class BloomStage extends RenderStage {\n    public static initInfo: IRenderStageInfo = {\n        name: 'BloomStage',\n        priority: CommonStagePriority.BLOOM,\n        tag: 0,\n    };\n    public threshold = 1.0;\n    public intensity = 0.8;\n    public iterations = 2;\n\n    @type(Material)\n    @serializable\n    @displayOrder(3)\n    private _bloomMaterial: Material | null = null;\n\n    private _renderArea = new Rect();\n    private _bloomUBO: gfx.Buffer[] = [];\n\n    constructor () {\n        super();\n    }\n\n    public initialize (info: IRenderStageInfo): boolean {\n        super.initialize(info);\n        return true;\n    }\n\n    public activate (pipeline: RenderPipeline, flow: RenderFlow) {\n        super.activate(pipeline, flow);\n\n        if (this._bloomMaterial) { (pipeline.pipelineSceneData as DeferredPipelineSceneData).bloomMaterial = this._bloomMaterial; }\n    }\n\n    public destroy () {\n    }\n\n    public render (camera: Camera) {\n        const pipeline = this._pipeline;\n        pipeline.generateBloomRenderData();\n        if (!camera.window?.swapchain && !pipeline.macros.CC_PIPELINE_TYPE) {\n            return;\n        }\n        if (!pipeline.bloomEnabled || pipeline.pipelineSceneData.renderObjects.length === 0) return;\n\n        if (this._bloomUBO.length === 0) {\n            const passNumber = MAX_BLOOM_FILTER_PASS_NUM * 2 + 2;\n            for (let i = 0; i < passNumber; ++i) {\n                this._bloomUBO[i] = pipeline.device.createBuffer(new BufferInfo(\n                    BufferUsageBit.UNIFORM | BufferUsageBit.TRANSFER_DST,\n                    MemoryUsageBit.HOST | MemoryUsageBit.DEVICE,\n                    UBOBloom.SIZE,\n                    UBOBloom.SIZE,\n                ));\n            }\n        }\n\n        if (camera.clearFlag & ClearFlagBit.COLOR) {\n            colors[0].x = camera.clearColor.x;\n            colors[0].y = camera.clearColor.y;\n            colors[0].z = camera.clearColor.z;\n        }\n        colors[0].w = camera.clearColor.w;\n\n        this._prefilterPass(camera, pipeline);\n        this._downsamplePass(camera, pipeline);\n        this._upsamplePass(camera, pipeline);\n        this._combinePass(camera, pipeline);\n    }\n\n    private _prefilterPass (camera: Camera, pipeline: RenderPipeline) {\n        pipeline.generateRenderArea(camera, this._renderArea);\n        this._renderArea.width >>= 1;\n        this._renderArea.height >>= 1;\n        const cmdBuff = pipeline.commandBuffers[0];\n\n        const sceneData = pipeline.pipelineSceneData as DeferredPipelineSceneData;\n        const builtinBloomProcess = sceneData.bloomMaterial;\n        const pass = builtinBloomProcess.passes[BLOOM_PREFILTERPASS_INDEX];\n        const renderData = pipeline.getPipelineRenderData();\n        const bloomData = renderData.bloom!;\n        const textureSize = new Float32Array(UBOBloom.COUNT);\n        textureSize[UBOBloom.TEXTURE_SIZE_OFFSET + 2] = this.threshold;\n        cmdBuff.updateBuffer(this._bloomUBO[0], textureSize);\n\n        cmdBuff.beginRenderPass(bloomData.renderPass, bloomData.prefilterFramebuffer, this._renderArea, colors, 0, 0);\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n\n        pass.descriptorSet.bindBuffer(0, this._bloomUBO[0]);\n        pass.descriptorSet.bindTexture(1, renderData.outputRenderTargets[0]);\n        pass.descriptorSet.bindSampler(1, bloomData.sampler);\n        pass.descriptorSet.update();\n        cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n\n        const inputAssembler = camera.window.swapchain ? pipeline.quadIAOffscreen : pipeline.quadIAOnscreen;\n        let pso: PipelineState | null = null;\n\n        const shader = pass.getShaderVariant();\n        if (pass != null && shader != null && inputAssembler != null) {\n            pso = PipelineStateManager.getOrCreatePipelineState(pipeline.device, pass, shader, bloomData.renderPass, inputAssembler);\n        }\n\n        if (pso != null) {\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindInputAssembler(inputAssembler);\n            cmdBuff.draw(inputAssembler);\n        }\n\n        cmdBuff.endRenderPass();\n    }\n\n    private _downsamplePass (camera: Camera, pipeline: RenderPipeline) {\n        pipeline.generateRenderArea(camera, this._renderArea);\n        this._renderArea.width >>= 1;\n        this._renderArea.height >>= 1;\n        const cmdBuff = pipeline.commandBuffers[0];\n        const sceneData = pipeline.pipelineSceneData as DeferredPipelineSceneData;\n        const builtinBloomProcess = sceneData.bloomMaterial;\n        const bloomData = pipeline.getPipelineRenderData().bloom!;\n        const textureSize = new Float32Array(UBOBloom.COUNT);\n\n        for (let i = 0; i < this.iterations; ++i) {\n            textureSize[UBOBloom.TEXTURE_SIZE_OFFSET + 0] = this._renderArea.width;\n            textureSize[UBOBloom.TEXTURE_SIZE_OFFSET + 1] = this._renderArea.height;\n            cmdBuff.updateBuffer(this._bloomUBO[i + 1], textureSize);\n\n            this._renderArea.width >>= 1;\n            this._renderArea.height >>= 1;\n            cmdBuff.beginRenderPass(bloomData.renderPass, bloomData.downsampleFramebuffers[i]!, this._renderArea, colors, 0, 0);\n            const pass = builtinBloomProcess.passes[BLOOM_DOWNSAMPLEPASS_INDEX + i];\n            const shader = pass.getShaderVariant();\n            pass.descriptorSet.bindBuffer(0, this._bloomUBO[i + 1]);\n\n            if (i === 0) {\n                pass.descriptorSet.bindTexture(1, bloomData.prefiterTex);\n            } else {\n                pass.descriptorSet.bindTexture(1, bloomData.downsampleTexs[i - 1]);\n            }\n            pass.descriptorSet.bindSampler(1, bloomData.sampler);\n            pass.descriptorSet.update();\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n\n            const inputAssembler = camera.window.swapchain ? pipeline.quadIAOffscreen : pipeline.quadIAOnscreen;\n            let pso: PipelineState | null = null;\n\n            if (pass != null && shader != null && inputAssembler != null) {\n                pso = PipelineStateManager.getOrCreatePipelineState(pipeline.device, pass, shader, bloomData.renderPass, inputAssembler);\n            }\n\n            if (pso != null) {\n                cmdBuff.bindPipelineState(pso);\n                cmdBuff.bindInputAssembler(inputAssembler);\n                cmdBuff.draw(inputAssembler);\n            }\n\n            cmdBuff.endRenderPass();\n        }\n    }\n\n    private _upsamplePass (camera: Camera, pipeline: RenderPipeline) {\n        const bloomData = pipeline.getPipelineRenderData().bloom!;\n        pipeline.generateRenderArea(camera, this._renderArea);\n        this._renderArea.width >>= this.iterations + 1;\n        this._renderArea.height >>= this.iterations + 1;\n        const cmdBuff = pipeline.commandBuffers[0];\n        const sceneData = pipeline.pipelineSceneData  as DeferredPipelineSceneData;\n        const builtinBloomProcess = sceneData.bloomMaterial;\n        const textureSize = new Float32Array(UBOBloom.COUNT);\n\n        for (let i = 0; i < this.iterations; ++i) {\n            const index = i + MAX_BLOOM_FILTER_PASS_NUM + 1;\n            textureSize[UBOBloom.TEXTURE_SIZE_OFFSET + 0] = this._renderArea.width;\n            textureSize[UBOBloom.TEXTURE_SIZE_OFFSET + 1] = this._renderArea.height;\n            cmdBuff.updateBuffer(this._bloomUBO[index], textureSize);\n\n            this._renderArea.width <<= 1;\n            this._renderArea.height <<= 1;\n            cmdBuff.beginRenderPass(bloomData.renderPass, bloomData.upsampleFramebuffers[this.iterations - 1 - i], this._renderArea, colors, 0, 0);\n            const pass = builtinBloomProcess.passes[BLOOM_UPSAMPLEPASS_INDEX + i];\n            const shader = pass.getShaderVariant();\n            pass.descriptorSet.bindBuffer(0, this._bloomUBO[index]);\n\n            if (i === 0) {\n                pass.descriptorSet.bindTexture(1, bloomData.downsampleTexs[this.iterations - 1]);\n            } else {\n                pass.descriptorSet.bindTexture(1, bloomData.upsampleTexs[this.iterations - i]);\n            }\n            pass.descriptorSet.bindSampler(1, bloomData.sampler);\n            pass.descriptorSet.update();\n            cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n\n            const inputAssembler = camera.window.swapchain ? pipeline.quadIAOffscreen : pipeline.quadIAOnscreen;\n            let pso: PipelineState | null = null;\n\n            if (pass != null && shader != null && inputAssembler != null) {\n                pso = PipelineStateManager.getOrCreatePipelineState(pipeline.device, pass, shader, bloomData.renderPass, inputAssembler);\n            }\n\n            if (pso != null) {\n                cmdBuff.bindPipelineState(pso);\n                cmdBuff.bindInputAssembler(inputAssembler);\n                cmdBuff.draw(inputAssembler);\n            }\n\n            cmdBuff.endRenderPass();\n        }\n    }\n\n    private _combinePass (camera: Camera, pipeline: RenderPipeline) {\n        pipeline.generateRenderArea(camera, this._renderArea);\n\n        const cmdBuff = pipeline.commandBuffers[0];\n        const sceneData = pipeline.pipelineSceneData as DeferredPipelineSceneData;\n        const builtinBloomProcess = sceneData.bloomMaterial;\n        const deferredData = pipeline.getPipelineRenderData();\n        const bloomData = deferredData.bloom!;\n        const uboIndex = MAX_BLOOM_FILTER_PASS_NUM * 2 + 1;\n        const textureSize = new Float32Array(UBOBloom.COUNT);\n        textureSize[UBOBloom.TEXTURE_SIZE_OFFSET + 3] = this.intensity;\n        cmdBuff.updateBuffer(this._bloomUBO[uboIndex], textureSize);\n\n        cmdBuff.beginRenderPass(bloomData.renderPass, bloomData.combineFramebuffer, this._renderArea, colors, 0, 0);\n        cmdBuff.bindDescriptorSet(SetIndex.GLOBAL, pipeline.descriptorSet);\n        const pass = builtinBloomProcess.passes[BLOOM_COMBINEPASS_INDEX];\n        pass.descriptorSet.bindBuffer(0, this._bloomUBO[uboIndex]);\n        pass.descriptorSet.bindTexture(1, deferredData.outputRenderTargets[0]!);\n        pass.descriptorSet.bindTexture(2, bloomData.upsampleTexs[0]);\n        pass.descriptorSet.bindSampler(1, bloomData.sampler);\n        pass.descriptorSet.bindSampler(2, bloomData.sampler);\n        pass.descriptorSet.update();\n        cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, pass.descriptorSet);\n\n        const inputAssembler = camera.window.swapchain ? pipeline.quadIAOffscreen : pipeline.quadIAOnscreen;\n        let pso: PipelineState | null = null;\n\n        const shader = pass.getShaderVariant();\n        if (pass != null && shader != null && inputAssembler != null) {\n            pso = PipelineStateManager.getOrCreatePipelineState(pipeline.device, pass, shader, bloomData.renderPass, inputAssembler);\n        }\n\n        if (pso != null) {\n            cmdBuff.bindPipelineState(pso);\n            cmdBuff.bindInputAssembler(inputAssembler);\n            cmdBuff.draw(inputAssembler);\n        }\n\n        cmdBuff.endRenderPass();\n    }\n}\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @category pipeline.deferred\n */\n\nimport { ccclass } from 'cc.decorator';\nimport { Camera } from '../../renderer/scene';\nimport { PIPELINE_FLOW_MAIN } from '../define';\nimport { IRenderFlowInfo, RenderFlow } from '../render-flow';\nimport { DeferredFlowPriority } from '../enum';\nimport { GbufferStage } from './gbuffer-stage';\nimport { LightingStage } from './lighting-stage';\nimport { PostProcessStage } from './postprocess-stage';\nimport { RenderPipeline } from '../render-pipeline';\nimport { BloomStage } from './bloom-stage';\n\n/**\n * @en The main flow in deferred render pipeline\n * @zh 延迟渲染流程。\n */\n@ccclass('MainFlow')\nexport class MainFlow extends RenderFlow {\n    /**\n     * @en The shared initialization information of main render flow\n     * @zh 共享的延迟渲染流程初始化参数\n     */\n    public static initInfo: IRenderFlowInfo = {\n        name: PIPELINE_FLOW_MAIN,\n        priority: DeferredFlowPriority.MAIN,\n        stages: [],\n    };\n\n    public initialize (info: IRenderFlowInfo): boolean {\n        super.initialize(info);\n        if (this._stages.length === 0) {\n            const gbufferStage = new GbufferStage();\n            gbufferStage.initialize(GbufferStage.initInfo);\n            this._stages.push(gbufferStage);\n            const lightingStage = new LightingStage();\n            lightingStage.initialize(LightingStage.initInfo);\n            this._stages.push(lightingStage);\n            const bloomStage = new BloomStage();\n            bloomStage.initialize(BloomStage.initInfo);\n            this._stages.push(bloomStage);\n            const postProcessStage = new PostProcessStage();\n            postProcessStage.initialize(PostProcessStage.initInfo);\n            this._stages.push(postProcessStage);\n        }\n        return true;\n    }\n\n    public activate (pipeline: RenderPipeline) {\n        super.activate(pipeline);\n    }\n\n    public render (camera: Camera) {\n        super.render(camera);\n    }\n\n    public destroy () {\n        super.destroy();\n    }\n}\n","/*\n Copyright (c) Huawei Technologies Co., Ltd. 2020-2021.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n/**\n * @category pipeline\n */\n\nimport { ccclass, displayOrder, type, serializable } from 'cc.decorator';\nimport { EDITOR } from 'internal:constants';\nimport { builtinResMgr } from '../../builtin/builtin-res-mgr';\nimport { Texture2D } from '../../assets/texture-2d';\nimport { RenderPipeline, IRenderPipelineInfo, PipelineRenderData, PipelineInputAssemblerData } from '../render-pipeline';\nimport { MainFlow } from './main-flow';\nimport { RenderTextureConfig } from '../pipeline-serialization';\nimport { ShadowFlow } from '../shadow/shadow-flow';\nimport { Format, StoreOp,\n    ColorAttachment, DepthStencilAttachment, RenderPass, LoadOp,\n    RenderPassInfo, Texture, AccessFlagBit, Framebuffer,\n    TextureInfo, TextureType, TextureUsageBit, FramebufferInfo, Swapchain, GeneralBarrierInfo } from '../../gfx';\nimport { UBOGlobal, UBOCamera, UBOShadow, UNIFORM_SHADOWMAP_BINDING, UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING } from '../define';\nimport { Camera } from '../../renderer/scene';\nimport { errorID } from '../../platform/debug';\nimport { DeferredPipelineSceneData } from './deferred-pipeline-scene-data';\nimport { PipelineEventType } from '../pipeline-event';\n\nconst PIPELINE_TYPE = 1;\n\nexport class DeferredRenderData extends PipelineRenderData {\n    gbufferFrameBuffer: Framebuffer = null!;\n    gbufferRenderTargets: Texture[] = [];\n}\n\n/**\n * @en The deferred render pipeline\n * @zh 延迟渲染管线。\n */\n@ccclass('DeferredPipeline')\nexport class DeferredPipeline extends RenderPipeline {\n    private _gbufferRenderPass: RenderPass | null = null;\n    private _lightingRenderPass: RenderPass | null = null;\n\n    @type([RenderTextureConfig])\n    @serializable\n    @displayOrder(2)\n    protected renderTextures: RenderTextureConfig[] = [];\n\n    public initialize (info: IRenderPipelineInfo): boolean {\n        super.initialize(info);\n\n        if (this._flows.length === 0) {\n            const shadowFlow = new ShadowFlow();\n            shadowFlow.initialize(ShadowFlow.initInfo);\n            this._flows.push(shadowFlow);\n\n            const mainFlow = new MainFlow();\n            mainFlow.initialize(MainFlow.initInfo);\n            this._flows.push(mainFlow);\n        }\n\n        return true;\n    }\n\n    public activate (swapchain: Swapchain): boolean {\n        if (EDITOR) {\n            console.info('Deferred render pipeline initialized. '\n                + 'Note that non-transparent materials with no lighting will not be rendered, such as builtin-unlit.');\n        }\n\n        this._macros = { CC_PIPELINE_TYPE: PIPELINE_TYPE };\n        this._pipelineSceneData = new DeferredPipelineSceneData();\n\n        if (!super.activate(swapchain)) {\n            return false;\n        }\n\n        if (!this._activeRenderer(swapchain)) {\n            errorID(2402);\n            return false;\n        }\n\n        return true;\n    }\n\n    public destroy () {\n        this._destroyUBOs();\n        this._destroyQuadInputAssembler();\n        this._destroyDeferredData();\n\n        const rpIter = this._renderPasses.values();\n        let rpRes = rpIter.next();\n        while (!rpRes.done) {\n            rpRes.value.destroy();\n            rpRes = rpIter.next();\n        }\n\n        this._commandBuffers.length = 0;\n\n        return super.destroy();\n    }\n\n    public onGlobalPipelineStateChanged () {\n        (this.pipelineSceneData as DeferredPipelineSceneData).updatePipelineSceneData();\n    }\n\n    public getPipelineRenderData (): DeferredRenderData {\n        if (!this._pipelineRenderData) {\n            this._generateDeferredRenderData();\n        }\n\n        return this._pipelineRenderData as DeferredRenderData;\n    }\n\n    private _activeRenderer (swapchain: Swapchain) {\n        const device = this.device;\n\n        this._commandBuffers.push(device.commandBuffer);\n\n        const sampler = this.globalDSManager.pointSampler;\n        this._descriptorSet.bindSampler(UNIFORM_SHADOWMAP_BINDING, sampler);\n        this._descriptorSet.bindTexture(UNIFORM_SHADOWMAP_BINDING, builtinResMgr.get<Texture2D>('default-texture').getGFXTexture()!);\n        this._descriptorSet.bindSampler(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, sampler);\n        this._descriptorSet.bindTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING, builtinResMgr.get<Texture2D>('default-texture').getGFXTexture()!);\n        this._descriptorSet.update();\n\n        let inputAssemblerDataOffscreen = new PipelineInputAssemblerData();\n        inputAssemblerDataOffscreen = this._createQuadInputAssembler();\n        if (!inputAssemblerDataOffscreen.quadIB || !inputAssemblerDataOffscreen.quadVB || !inputAssemblerDataOffscreen.quadIA) {\n            return false;\n        }\n        this._quadIB = inputAssemblerDataOffscreen.quadIB;\n        this._quadVBOffscreen = inputAssemblerDataOffscreen.quadVB;\n        this._quadIAOffscreen = inputAssemblerDataOffscreen.quadIA;\n\n        const inputAssemblerDataOnscreen = this._createQuadInputAssembler();\n        if (!inputAssemblerDataOnscreen.quadIB || !inputAssemblerDataOnscreen.quadVB || !inputAssemblerDataOnscreen.quadIA) {\n            return false;\n        }\n        this._quadVBOnscreen = inputAssemblerDataOnscreen.quadVB;\n        this._quadIAOnscreen = inputAssemblerDataOnscreen.quadIA;\n\n        if (!this._gbufferRenderPass) {\n            const colorAttachment0 = new ColorAttachment();\n            colorAttachment0.format = Format.RGBA16F;\n            colorAttachment0.loadOp = LoadOp.CLEAR; // should clear color attachment\n            colorAttachment0.storeOp = StoreOp.STORE;\n\n            const colorAttachment1 = new ColorAttachment();\n            colorAttachment1.format = Format.RGBA16F;\n            colorAttachment1.loadOp = LoadOp.CLEAR; // should clear color attachment\n            colorAttachment1.storeOp = StoreOp.STORE;\n\n            const colorAttachment2 = new ColorAttachment();\n            colorAttachment2.format = Format.RGBA16F;\n            colorAttachment2.loadOp = LoadOp.CLEAR; // should clear color attachment\n            colorAttachment2.storeOp = StoreOp.STORE;\n\n            const depthStencilAttachment = new DepthStencilAttachment();\n            depthStencilAttachment.format = Format.DEPTH_STENCIL;\n            depthStencilAttachment.depthLoadOp = LoadOp.CLEAR;\n            depthStencilAttachment.depthStoreOp = StoreOp.STORE;\n            depthStencilAttachment.stencilLoadOp = LoadOp.CLEAR;\n            depthStencilAttachment.stencilStoreOp = StoreOp.STORE;\n            const renderPassInfo = new RenderPassInfo(\n                [colorAttachment0, colorAttachment1, colorAttachment2],\n                depthStencilAttachment,\n            );\n            this._gbufferRenderPass = device.createRenderPass(renderPassInfo);\n        }\n\n        if (!this._lightingRenderPass) {\n            const colorAttachment = new ColorAttachment();\n            colorAttachment.format = Format.RGBA8;\n            colorAttachment.loadOp = LoadOp.CLEAR; // should clear color attachment\n            colorAttachment.storeOp = StoreOp.STORE;\n            colorAttachment.barrier = device.getGeneralBarrier(new GeneralBarrierInfo(\n                AccessFlagBit.NONE,\n                AccessFlagBit.COLOR_ATTACHMENT_WRITE,\n            ));\n\n            const depthStencilAttachment = new DepthStencilAttachment();\n            depthStencilAttachment.format = Format.DEPTH_STENCIL;\n            depthStencilAttachment.depthLoadOp = LoadOp.LOAD;\n            depthStencilAttachment.depthStoreOp = StoreOp.DISCARD;\n            depthStencilAttachment.stencilLoadOp = LoadOp.LOAD;\n            depthStencilAttachment.stencilStoreOp = StoreOp.DISCARD;\n            colorAttachment.barrier = device.getGeneralBarrier(new GeneralBarrierInfo(\n                AccessFlagBit.DEPTH_STENCIL_ATTACHMENT_WRITE,\n                AccessFlagBit.DEPTH_STENCIL_ATTACHMENT_WRITE,\n            ));\n\n            const renderPassInfo = new RenderPassInfo([colorAttachment], depthStencilAttachment);\n            this._lightingRenderPass = device.createRenderPass(renderPassInfo);\n        }\n\n        this._width = swapchain.width;\n        this._height = swapchain.height;\n        this._generateDeferredRenderData();\n\n        return true;\n    }\n\n    private _destroyUBOs () {\n        if (this._descriptorSet) {\n            this._descriptorSet.getBuffer(UBOGlobal.BINDING).destroy();\n            this._descriptorSet.getBuffer(UBOShadow.BINDING).destroy();\n            this._descriptorSet.getBuffer(UBOCamera.BINDING).destroy();\n            this._descriptorSet.getTexture(UNIFORM_SHADOWMAP_BINDING).destroy();\n            this._descriptorSet.getTexture(UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING).destroy();\n        }\n    }\n\n    private _destroyDeferredData () {\n        const deferredData = this._pipelineRenderData as DeferredRenderData;\n        if (deferredData) {\n            if (deferredData.gbufferFrameBuffer) deferredData.gbufferFrameBuffer.destroy();\n            if (deferredData.outputFrameBuffer) deferredData.outputFrameBuffer.destroy();\n            if (deferredData.outputDepth) deferredData.outputDepth.destroy();\n\n            for (let i = 0; i < deferredData.gbufferRenderTargets.length; i++) {\n                deferredData.gbufferRenderTargets[i].destroy();\n            }\n            deferredData.gbufferRenderTargets.length = 0;\n\n            for (let i = 0; i < deferredData.outputRenderTargets.length; i++) {\n                deferredData.outputRenderTargets[i].destroy();\n            }\n            deferredData.outputRenderTargets.length = 0;\n\n            this._destroyBloomData();\n        }\n\n        this._pipelineRenderData = null;\n    }\n\n    protected _ensureEnoughSize (cameras: Camera[]) {\n        let newWidth = this._width;\n        let newHeight = this._height;\n        for (let i = 0; i < cameras.length; ++i) {\n            const window = cameras[i].window;\n            newWidth = Math.max(window.width, newWidth);\n            newHeight = Math.max(window.height, newHeight);\n        }\n        if (newWidth !== this._width || newHeight !== this._height) {\n            this._width = newWidth;\n            this._height = newHeight;\n            this._destroyDeferredData();\n            this._generateDeferredRenderData();\n        }\n    }\n\n    private _generateDeferredRenderData () {\n        const device = this.device;\n\n        const data: DeferredRenderData = this._pipelineRenderData = new DeferredRenderData();\n        const sceneData = this.pipelineSceneData;\n        for (let i = 0; i < 3; ++i) {\n            data.gbufferRenderTargets.push(device.createTexture(new TextureInfo(\n                TextureType.TEX2D,\n                TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n                Format.RGBA16F, // normals need more precision\n                this._width * sceneData.shadingScale,\n                this._height * sceneData.shadingScale,\n            )));\n        }\n        data.outputDepth = device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.DEPTH_STENCIL_ATTACHMENT | TextureUsageBit.SAMPLED,\n            Format.DEPTH_STENCIL,\n            this._width * sceneData.shadingScale,\n            this._height * sceneData.shadingScale,\n        ));\n\n        data.gbufferFrameBuffer = device.createFramebuffer(new FramebufferInfo(\n            this._gbufferRenderPass!,\n            data.gbufferRenderTargets,\n            data.outputDepth,\n        ));\n        data.outputRenderTargets.push(device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED,\n            Format.RGBA16F,\n            this._width * sceneData.shadingScale,\n            this._height * sceneData.shadingScale,\n        )));\n\n        data.outputFrameBuffer = device.createFramebuffer(new FramebufferInfo(\n            this._lightingRenderPass!,\n            data.outputRenderTargets,\n            null,\n        ));\n\n        data.sampler = this.globalDSManager.pointSampler;\n\n        // Listens when the attachment texture is scaled\n        this.on(PipelineEventType.ATTACHMENT_SCALE_CAHNGED, (val: number) => {\n            data.sampler = val < 1 ? this.globalDSManager.pointSampler : this.globalDSManager.linearSampler;\n            data.gbufferFrameBuffer = this.newFramebufferByRatio(data.gbufferFrameBuffer);\n            data.gbufferFrameBuffer = this.newFramebufferByRatio(data.outputFrameBuffer);\n        });\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport './deprecated';\nimport * as pipeline from './define';\nimport { ForwardPipeline } from './forward/forward-pipeline';\n\nexport { pipeline };\n\nexport * from './pass-phase';\n\nexport { RenderPipeline } from './render-pipeline';\nexport { RenderFlow } from './render-flow';\nexport { RenderStage } from './render-stage';\nexport { PipelineSceneData } from './pipeline-scene-data';\n\nexport { ForwardPipeline } from './forward/forward-pipeline';\nexport { ForwardFlow } from './forward/forward-flow';\nexport { ForwardStage } from './forward/forward-stage';\nexport { DeferredPipeline } from './deferred/deferred-pipeline';\nexport { MainFlow } from './deferred/main-flow';\nexport { GbufferStage } from './deferred/gbuffer-stage';\nexport { LightingStage } from './deferred/lighting-stage';\nexport { BloomStage } from './deferred/bloom-stage';\nexport { PostProcessStage } from './deferred/postprocess-stage';\nexport { ShadowFlow } from './shadow/shadow-flow';\nexport { ShadowStage } from './shadow/shadow-stage';\n\nexport { InstancedBuffer } from './instanced-buffer';\nexport { PipelineStateManager } from './pipeline-state-manager';\n\nexport { PipelineEventProcessor, PipelineEventType } from './pipeline-event';\nexport { DebugView } from './debug-view';\n\nexport function createDefaultPipeline () {\n    const rppl = new ForwardPipeline();\n    rppl.initialize({ flows: [] });\n    return rppl;\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { EDITOR, NATIVE, PREVIEW } from 'internal:constants';\nimport * as easing from './easing/easing';\nimport { Material } from './assets/material';\nimport { clamp01 } from './math/utils';\nimport {\n    Sampler, SamplerInfo, Shader, Texture, TextureInfo, Device, InputAssembler, InputAssemblerInfo, Attribute, Buffer,\n    BufferInfo, Rect, Color, BufferTextureCopy, Framebuffer, CommandBuffer, BufferUsageBit, Format,\n    MemoryUsageBit, TextureType, TextureUsageBit, Address, SurfaceTransform, Swapchain,\n} from './gfx';\nimport { PipelineStateManager } from './pipeline';\nimport { legacyCC } from './global-exports';\nimport { SetIndex } from './pipeline/define';\nimport { Mat4, Vec2 } from './math';\nimport { Settings, settings } from './settings';\nimport { sys } from './platform/sys';\n\nconst v2_0 = new Vec2();\ntype SplashEffectType = 'NONE' | 'FADE-INOUT';\ninterface ISplashSetting {\n    enabled: boolean;\n    totalTime: number;\n    base64src: string;\n    effect: SplashEffectType;\n    clearColor: Color;\n    displayRatio: number;\n    displayWatermark: boolean;\n}\n\ntype Writable<T> = { -readonly [K in keyof T]: T[K] };\n\nexport class SplashScreen {\n    private settings!: ISplashSetting;\n    private _curTime = 0;\n\n    private device!: Device;\n    private swapchain!: Swapchain;\n    private shader!: Shader;\n    private sampler!: Sampler;\n    private cmdBuff!: CommandBuffer;\n    private quadAssmebler!: InputAssembler;\n    private vertexBuffers!: Buffer;\n    private indicesBuffers!: Buffer;\n    private framebuffer!: Framebuffer;\n    private renderArea!: Rect;\n    private clearColors!: Color[];\n    private projection!: Mat4;\n\n    private logoMat!: Material;\n    private logoImage!: TexImageSource;\n    private logoTexture!: Texture;\n\n    private watermarkMat!: Material;\n    private watermarkTexture!: Texture;\n\n    public get isFinished () {\n        return this._curTime >= this.settings.totalTime;\n    }\n\n    set curTime (val) {\n        this._curTime = val;\n    }\n\n    get curTime () {\n        return this._curTime;\n    }\n\n    public init (): Promise<void> | undefined {\n        this.settings = {\n            enabled: settings.querySettings<boolean>(Settings.Category.SPLASH_SCREEN, 'enabled') ?? true,\n            totalTime: settings.querySettings<number>(Settings.Category.SPLASH_SCREEN, 'totalTime') ?? 3000,\n            base64src: settings.querySettings<string>(Settings.Category.SPLASH_SCREEN, 'base64src') ?? '',\n            effect: settings.querySettings<SplashEffectType>(Settings.Category.SPLASH_SCREEN, 'effect') ?? 'FADE-INOUT',\n            clearColor: settings.querySettings<Color>(Settings.Category.SPLASH_SCREEN, 'clearColor') ?? new Color(0.88, 0.88, 0.88, 1),\n            displayRatio: settings.querySettings<number>(Settings.Category.SPLASH_SCREEN, 'displayRatio') ?? 0.4,\n            displayWatermark: settings.querySettings<boolean>(Settings.Category.SPLASH_SCREEN, 'displayWatermark') ?? true,\n        };\n        this._curTime = 0;\n\n        if (EDITOR || PREVIEW || !this.settings.enabled || this.settings.base64src === '' || this.settings.totalTime <= 0) {\n            this.settings.totalTime = 0;\n        } else {\n            this.device = legacyCC.director.root!.device;\n            this.swapchain = legacyCC.director.root!.mainWindow!.swapchain;\n            this.framebuffer = legacyCC.director.root!.mainWindow!.framebuffer;\n\n            this.preInit();\n            if (this.settings.displayWatermark) this.initWarterMark();\n            return new Promise<void>((resolve, reject) => {\n                this.logoImage = new Image();\n                this.logoImage.onload = () => {\n                    this.initLogo();\n                    resolve();\n                };\n                this.logoImage.onerror = () => {\n                    reject();\n                };\n                this.logoImage.src = this.settings.base64src;\n            });\n        }\n        return Promise.resolve();\n    }\n\n    private preInit () {\n        // this.setting.clearColor may not an instance of Color, so should create\n        // Color manually, or will have problem on native.\n        const clearColor = this.settings.clearColor;\n        this.clearColors = [new Color(clearColor.x, clearColor.y, clearColor.z, clearColor.w)];\n        const { device, swapchain } = this;\n        this.renderArea = new Rect(0, 0, swapchain.width, swapchain.height);\n        this.cmdBuff = device.commandBuffer;\n\n        // create input assembler\n        // create vertex buffer\n        const verts = new Float32Array([0.5, 0.5, 1, 0, -0.5, 0.5, 0, 0, 0.5, -0.5, 1, 1, -0.5, -0.5, 0, 1]);\n        const vbStride = Float32Array.BYTES_PER_ELEMENT * 4;\n        const vbSize = vbStride * 4;\n        this.vertexBuffers = device.createBuffer(new BufferInfo(\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE, vbSize, vbStride,\n        ));\n        this.vertexBuffers.update(verts);\n\n        // create index buffer\n        const indices = new Uint16Array([0, 1, 2, 1, 3, 2]);\n        const ibStride = Uint16Array.BYTES_PER_ELEMENT;\n        const ibSize = ibStride * 6;\n        this.indicesBuffers = device.createBuffer(new BufferInfo(\n            BufferUsageBit.INDEX | BufferUsageBit.TRANSFER_DST,\n            MemoryUsageBit.DEVICE, ibSize, ibStride,\n        ));\n        this.indicesBuffers.update(indices);\n\n        const attributes: Attribute[] = [\n            new Attribute('a_position', Format.RG32F),\n            new Attribute('a_texCoord', Format.RG32F),\n        ];\n        const IAInfo = new InputAssemblerInfo(attributes, [this.vertexBuffers], this.indicesBuffers);\n        this.quadAssmebler = device.createInputAssembler(IAInfo);\n\n        this.projection = new Mat4();\n        Mat4.ortho(this.projection, -1, 1, -1, 1, -1, 1, device.capabilities.clipSpaceMinZ,\n            device.capabilities.clipSpaceSignY, swapchain.surfaceTransform);\n    }\n\n    public update (deltaTime: number) {\n        const settings = this.settings;\n        const { device, swapchain } = this;\n        Mat4.ortho(this.projection, -1, 1, -1, 1, -1, 1, device.capabilities.clipSpaceMinZ,\n            device.capabilities.clipSpaceSignY, swapchain.surfaceTransform);\n        const dw = swapchain.width; const dh = swapchain.height;\n        const refW = dw < dh ? dw : dh;\n        // update logo uniform\n        this._curTime += deltaTime * 1000;\n        const percent = clamp01(this._curTime / settings.totalTime);\n        let u_p = easing.cubicOut(percent);\n        if (settings.effect === 'NONE') u_p = 1.0;\n        const logoTW = this.logoTexture.width; const logoTH = this.logoTexture.height;\n        const logoW = refW * settings.displayRatio;\n        let scaleX = logoW * logoTW / logoTH;\n        let scaleY = logoW;\n        if (swapchain.surfaceTransform === SurfaceTransform.ROTATE_90\n            || swapchain.surfaceTransform === SurfaceTransform.ROTATE_270) {\n            scaleX = logoW * dw / dh;\n            scaleY = logoW * logoTH / logoTW * dh / dw;\n        }\n        this.logoMat.setProperty('resolution', v2_0.set(dw, dh), 0);\n        this.logoMat.setProperty('scale', v2_0.set(scaleX, scaleY), 0);\n        this.logoMat.setProperty('translate', v2_0.set(dw * 0.5, dh * 0.5), 0);\n        this.logoMat.setProperty('percent', u_p);\n        this.logoMat.setProperty('u_projection', this.projection);\n        this.logoMat.passes[0].update();\n\n        // update wartermark uniform\n        if (settings.displayWatermark && this.watermarkMat) {\n            const wartermarkW = refW * 0.5;\n            const wartermarkTW = this.watermarkTexture.width; const wartermarkTH = this.watermarkTexture.height;\n            let scaleX = wartermarkW;\n            let scaleY = wartermarkW * wartermarkTH / wartermarkTW;\n            if (swapchain.surfaceTransform === SurfaceTransform.ROTATE_90\n                || swapchain.surfaceTransform === SurfaceTransform.ROTATE_270) {\n                scaleX = wartermarkW * 0.5;\n                scaleY = wartermarkW * dw / dh * 0.5;\n            }\n            this.watermarkMat.setProperty('resolution', v2_0.set(dw, dh), 0);\n            this.watermarkMat.setProperty('scale', v2_0.set(scaleX, scaleY), 0);\n            this.watermarkMat.setProperty('translate', v2_0.set(dw * 0.5, dh * 0.1), 0);\n            this.watermarkMat.setProperty('percent', u_p);\n            this.watermarkMat.setProperty('u_projection', this.projection);\n            this.watermarkMat.passes[0].update();\n        }\n        this.frame();\n    }\n\n    private initLogo () {\n        const device = this.device;\n\n        this.logoMat = new Material();\n        this.logoMat.initialize({ effectName: 'util/splash-screen' });\n\n        const samplerInfo = new SamplerInfo();\n        samplerInfo.addressU = Address.CLAMP;\n        samplerInfo.addressV = Address.CLAMP;\n        samplerInfo.addressW = Address.CLAMP;\n        this.sampler = device.getSampler(samplerInfo);\n\n        this.logoTexture = device.createTexture(new TextureInfo(\n            TextureType.TEX2D,\n            TextureUsageBit.SAMPLED | TextureUsageBit.TRANSFER_DST,\n            Format.RGBA8,\n            this.logoImage.width,\n            this.logoImage.height,\n        ));\n\n        const pass = this.logoMat.passes[0];\n        const binding = pass.getBinding('mainTexture');\n        pass.bindTexture(binding, this.logoTexture);\n        this.shader = pass.getShaderVariant()!;\n        const descriptorSet = pass.descriptorSet;\n        descriptorSet.bindSampler(binding, this.sampler);\n        descriptorSet.update();\n\n        const region = new BufferTextureCopy();\n        region.texExtent.width = this.logoImage.width;\n        region.texExtent.height = this.logoImage.height;\n        region.texExtent.depth = 1;\n        device.copyTexImagesToTexture([this.logoImage], this.logoTexture, [region]);\n    }\n\n    private initWarterMark () {\n        // create texture from image\n        const wartemarkImg = document.createElement('canvas');\n        wartemarkImg.width = 330; wartemarkImg.height = 30;\n        wartemarkImg.style.width = `${wartemarkImg.width}`;\n        wartemarkImg.style.height = `${wartemarkImg.height}`;\n        const ctx = wartemarkImg.getContext('2d')!;\n        ctx.font = `${18}px Arial`; ctx.textBaseline = 'top'; ctx.textAlign = 'left'; ctx.fillStyle = '`#424242`';\n        const text = 'Powered by Cocos Creator';\n        const textMetrics = ctx.measureText(text);\n        ctx.fillText(text, (330 - textMetrics.width) / 2, 6);\n        const region = new BufferTextureCopy();\n        region.texExtent.width = wartemarkImg.width;\n        region.texExtent.height = wartemarkImg.height;\n        region.texExtent.depth = 1;\n        this.watermarkTexture = this.device.createTexture(new TextureInfo(\n            TextureType.TEX2D, TextureUsageBit.SAMPLED | TextureUsageBit.TRANSFER_DST,\n            Format.RGBA8, wartemarkImg.width, wartemarkImg.height,\n        ));\n        this.device.copyTexImagesToTexture([wartemarkImg], this.watermarkTexture, [region]);\n        // create material\n        this.watermarkMat = new Material();\n        this.watermarkMat.initialize({ effectName: 'util/splash-screen' });\n        const pass = this.watermarkMat.passes[0];\n        const binding = pass.getBinding('mainTexture');\n        pass.bindTexture(binding, this.watermarkTexture);\n        pass.descriptorSet.update();\n    }\n\n    private frame () {\n        const { device, swapchain } = this;\n\n        if (!sys.isXR || xr.entry.isRenderAllowable()) {\n            const renderSize = sys.isXR ? 2 : 1;\n            for (let xrEye = 0; xrEye < renderSize; xrEye++) {\n                if (sys.isXR) {\n                    xr.entry.renderLoopStart(xrEye);\n                }\n\n                device.acquire([swapchain]);\n                // record command\n                const cmdBuff = this.cmdBuff;\n                const framebuffer = this.framebuffer;\n                const renderArea = this.renderArea;\n\n                renderArea.width = swapchain.width;\n                renderArea.height = swapchain.height;\n\n                cmdBuff.begin();\n                cmdBuff.beginRenderPass(framebuffer.renderPass, framebuffer, renderArea, this.clearColors, 1.0, 0);\n\n                const logoPass = this.logoMat.passes[0];\n                const logoPso = PipelineStateManager.getOrCreatePipelineState(device, logoPass, this.shader, framebuffer.renderPass, this.quadAssmebler);\n\n                cmdBuff.bindPipelineState(logoPso);\n                cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, logoPass.descriptorSet);\n                cmdBuff.bindInputAssembler(this.quadAssmebler);\n                cmdBuff.draw(this.quadAssmebler);\n\n                if (this.settings.displayWatermark && this.watermarkMat) {\n                    const wartermarkPass = this.watermarkMat.passes[0];\n                    const watermarkPso = PipelineStateManager.getOrCreatePipelineState(device,\n                        wartermarkPass, this.shader, framebuffer.renderPass, this.quadAssmebler);\n                    cmdBuff.bindPipelineState(watermarkPso);\n                    cmdBuff.bindDescriptorSet(SetIndex.MATERIAL, wartermarkPass.descriptorSet);\n                    cmdBuff.bindInputAssembler(this.quadAssmebler);\n                    cmdBuff.draw(this.quadAssmebler);\n                }\n\n                cmdBuff.endRenderPass();\n                cmdBuff.end();\n                device.flushCommands([cmdBuff]);\n                device.queue.submit([cmdBuff]);\n                device.present();\n\n                if (sys.isXR) {\n                    xr.entry.renderLoopEnd(xrEye);\n                }\n            }\n        }\n    }\n\n    private destroy () {\n        this.device = null!;\n        this.swapchain = null!;\n        this.clearColors = null!;\n        if ((this.logoImage as any).destroy) (this.logoImage as any).destroy();\n        this.logoImage = null!;\n        this.framebuffer = null!;\n        this.renderArea = null!;\n        this.cmdBuff = null!;\n        this.shader = null!;\n        this.logoMat.destroy();\n        this.logoMat = null!;\n        this.logoTexture.destroy();\n        this.logoTexture = null!;\n        this.quadAssmebler.destroy();\n        this.quadAssmebler = null!;\n        this.vertexBuffers.destroy();\n        this.vertexBuffers = null!;\n        this.indicesBuffers.destroy();\n        this.indicesBuffers = null!;\n        this.sampler = null!;\n\n        /** text */\n        if (this.watermarkTexture) {\n            this.watermarkMat.destroy();\n            this.watermarkMat = null!;\n            this.watermarkTexture.destroy();\n            this.watermarkTexture = null!;\n        }\n\n        this.settings = null!;\n    }\n\n    private static _ins?: SplashScreen;\n\n    public static get instance () {\n        if (!SplashScreen._ins) {\n            SplashScreen._ins = new SplashScreen();\n        }\n        return SplashScreen._ins;\n    }\n\n    private constructor () { }\n}\n\nlegacyCC.internal.SplashScreen = SplashScreen;\n","/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n  not use Cocos Creator software for developing other software or tools that's\r\n  used for developing games. You are not granted to publish, distribute,\r\n  sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport IdGenerator from './utils/id-generator';\r\nimport { createMap } from './utils/js';\r\nimport System from './components/system';\r\nimport { legacyCC } from './global-exports';\r\nimport { errorID, warnID, logID, assertID } from './platform/debug';\r\n\r\nconst MAX_POOL_SIZE = 20;\r\n\r\nconst idGenerator = new IdGenerator('Scheduler');\r\n\r\nexport interface ISchedulable {\r\n    id?:string;\r\n    uuid?:string;\r\n}\r\n\r\n// data structures\r\n/**\r\n * @en A list double-linked list used for \"updates with priority\"\r\n * @zh 用于“优先更新”的列表\r\n * @class ListEntry\r\n * @param target not retained (retained by hashUpdateEntry)\r\n * @param priority\r\n * @param paused\r\n * @param markedForDeletion selector will no longer be called and entry will be removed at end of the next tick\r\n */\r\nclass ListEntry {\r\n    public static get = (target: ISchedulable, priority: number, paused: boolean, markedForDeletion: boolean) => {\r\n        let result = ListEntry._listEntries.pop();\r\n        if (result) {\r\n            result.target = target;\r\n            result.priority = priority;\r\n            result.paused = paused;\r\n            result.markedForDeletion = markedForDeletion;\r\n        } else {\r\n            result = new ListEntry(target, priority, paused, markedForDeletion);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public static put = (entry: ListEntry | any) => {\r\n        if (ListEntry._listEntries.length < MAX_POOL_SIZE) {\r\n            entry.target = null;\r\n            ListEntry._listEntries.push(entry);\r\n        }\r\n    }\r\n\r\n    private static _listEntries: ListEntry[] = [];\r\n\r\n    public target: ISchedulable;\r\n    public priority: number;\r\n    public paused: boolean;\r\n    public markedForDeletion: boolean;\r\n\r\n    constructor (target: ISchedulable, priority: number, paused: boolean, markedForDeletion: boolean) {\r\n        this.target = target;\r\n        this.priority = priority;\r\n        this.paused = paused;\r\n        this.markedForDeletion = markedForDeletion;\r\n    }\r\n}\r\n\r\n/**\r\n * @en A update entry list\r\n * @zh 更新条目列表\r\n * @class HashUpdateEntry\r\n * @param list Which list does it belong to ?\r\n * @param entry entry in the list\r\n * @param target hash key (retained)\r\n * @param callback\r\n */\r\nclass HashUpdateEntry {\r\n    public static get = (list: any, entry: ListEntry, target: ISchedulable, callback: any) => {\r\n        let result = HashUpdateEntry._hashUpdateEntries.pop();\r\n        if (result) {\r\n            result.list = list;\r\n            result.entry = entry;\r\n            result.target = target;\r\n            result.callback = callback;\r\n        } else {\r\n            result = new HashUpdateEntry(list, entry, target, callback);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public static put = (entry: HashUpdateEntry | any) => {\r\n        if (HashUpdateEntry._hashUpdateEntries.length < MAX_POOL_SIZE) {\r\n            entry.list = entry.entry = entry.target = entry.callback = null;\r\n            HashUpdateEntry._hashUpdateEntries.push(entry);\r\n        }\r\n    }\r\n\r\n    private static _hashUpdateEntries: HashUpdateEntry[] = [];\r\n\r\n    public list: any;\r\n    public entry: ListEntry;\r\n    public target: ISchedulable;\r\n    public callback: any;\r\n\r\n    constructor (list: any, entry: ListEntry, target: ISchedulable, callback: any) {\r\n        this.list = list;\r\n        this.entry = entry;\r\n        this.target = target;\r\n        this.callback = callback;\r\n    }\r\n}\r\n\r\n/**\r\n * @en Hash Element used for \"selectors with interval\"\r\n * @zh “用于间隔选择”的哈希元素\r\n * @param timers\r\n * @param target  hash key (retained)\r\n * @param timerIndex\r\n * @param currentTimer\r\n * @param currentTimerSalvaged\r\n * @param paused\r\n */\r\nclass HashTimerEntry {\r\n    public static get = (timers: any, target: ISchedulable, timerIndex: number, currentTimer: any, currentTimerSalvaged: any, paused: any) => {\r\n        let result = HashTimerEntry._hashTimerEntries.pop();\r\n        if (result) {\r\n            result.timers = timers;\r\n            result.target = target;\r\n            result.timerIndex = timerIndex;\r\n            result.currentTimer = currentTimer;\r\n            result.currentTimerSalvaged = currentTimerSalvaged;\r\n            result.paused = paused;\r\n        } else {\r\n            result = new HashTimerEntry(timers, target, timerIndex, currentTimer, currentTimerSalvaged, paused);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public static put = (entry: HashTimerEntry | any) => {\r\n        if (HashTimerEntry._hashTimerEntries.length < MAX_POOL_SIZE) {\r\n            entry.timers = entry.target = entry.currentTimer = null;\r\n            HashTimerEntry._hashTimerEntries.push(entry);\r\n        }\r\n    }\r\n\r\n    private static _hashTimerEntries: HashTimerEntry[] = [];\r\n\r\n    public timers: any;\r\n    public target: ISchedulable;\r\n    public timerIndex: number;\r\n    public currentTimer: any;\r\n    public currentTimerSalvaged: any;\r\n    public paused: any;\r\n\r\n    constructor (timers: any, target: ISchedulable, timerIndex: number, currentTimer: any, currentTimerSalvaged: any, paused: any) {\r\n        this.timers = timers;\r\n        this.target = target;\r\n        this.timerIndex = timerIndex;\r\n        this.currentTimer = currentTimer;\r\n        this.currentTimerSalvaged = currentTimerSalvaged;\r\n        this.paused = paused;\r\n    }\r\n}\r\n\r\n/*\r\n * Light weight timer\r\n */\r\nclass CallbackTimer {\r\n    public static _timers: CallbackTimer[] = [];\r\n    public static get = () => CallbackTimer._timers.pop() || new CallbackTimer()\r\n    public static put = (timer: CallbackTimer | any) => {\r\n        if (CallbackTimer._timers.length < MAX_POOL_SIZE && !timer._lock) {\r\n            timer._scheduler = timer._target = timer._callback = null;\r\n            CallbackTimer._timers.push(timer);\r\n        }\r\n    }\r\n\r\n    private _lock: boolean;\r\n    private _scheduler: any;\r\n    private _elapsed: number;\r\n    private _runForever: boolean;\r\n    private _useDelay: boolean;\r\n    private _timesExecuted: number;\r\n    private _repeat: number;\r\n    private _delay: number;\r\n    private  _interval: number;\r\n    private _target: ISchedulable | null;\r\n    private _callback: (dt?: number) => void | null;\r\n\r\n    constructor () {\r\n        this._lock = false;\r\n        this._scheduler = null;\r\n        this._elapsed = -1;\r\n        this._runForever = false;\r\n        this._useDelay = false;\r\n        this._timesExecuted = 0;\r\n        this._repeat = 0;\r\n        this._delay = 0;\r\n        this._interval = 0;\r\n\r\n        this._target = null;\r\n        this._callback = null!;\r\n    }\r\n\r\n    public initWithCallback (scheduler: any, callback: any, target: ISchedulable, seconds: number, repeat: number, delay: number) {\r\n        this._lock = false;\r\n        this._scheduler = scheduler;\r\n        this._target = target;\r\n        this._callback = callback;\r\n\r\n        this._elapsed = -1;\r\n        this._interval = seconds;\r\n        this._delay = delay;\r\n        this._useDelay = (this._delay > 0);\r\n        this._repeat = repeat;\r\n        this._runForever = (this._repeat === legacyCC.macro.REPEAT_FOREVER);\r\n        return true;\r\n    }\r\n    /**\r\n     * @return returns interval of timer\r\n     */\r\n    public getInterval () {\r\n        return this._interval;\r\n    }\r\n    /**\r\n     * @en Set interval in seconds\r\n     * @zh 以秒为单位设置时间间隔\r\n     */\r\n    public setInterval (interval) {\r\n        this._interval = interval;\r\n    }\r\n\r\n    /**\r\n     * @en Update function which triggers the timer\r\n     * @zh 计时更新函数，用来触发计时器\r\n     * @param dt delta time\r\n     */\r\n    public update (dt: number) {\r\n        if (this._elapsed === -1) {\r\n            this._elapsed = 0;\r\n            this._timesExecuted = 0;\r\n        } else {\r\n            this._elapsed += dt;\r\n            if (this._runForever && !this._useDelay) { // standard timer usage\r\n                if (this._elapsed >= this._interval) {\r\n                    this.trigger();\r\n                    this._elapsed = 0;\r\n                }\r\n            } else { // advanced usage\r\n                if (this._useDelay) {\r\n                    if (this._elapsed >= this._delay) {\r\n                        this.trigger();\r\n\r\n                        this._elapsed -= this._delay;\r\n                        this._timesExecuted += 1;\r\n                        this._useDelay = false;\r\n                    }\r\n                } else if (this._elapsed >= this._interval) {\r\n                    this.trigger();\r\n\r\n                    this._elapsed = 0;\r\n                    this._timesExecuted += 1;\r\n                }\r\n\r\n                // @ts-expect-error Notes written for over eslint\r\n                if (this._callback && !this._runForever && this._timesExecuted > this._repeat) {\r\n                    this.cancel();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public getCallback () {\r\n        return this._callback;\r\n    }\r\n\r\n    public trigger () {\r\n        if (this._target && this._callback) {\r\n            this._lock = true;\r\n            this._callback.call(this._target, this._elapsed);\r\n            this._lock = false;\r\n        }\r\n    }\r\n\r\n    public cancel () {\r\n        // override\r\n        this._scheduler.unschedule(this._callback, this._target);\r\n    }\r\n}\r\n\r\n/**\r\n * @en\r\n * Scheduler is responsible of triggering the scheduled callbacks.<br>\r\n * You should not use NSTimer. Instead use this class.<br>\r\n * <br>\r\n * There are 2 different types of callbacks (selectors):<br>\r\n *     - update callback: the 'update' callback will be called every frame. You can customize the priority.<br>\r\n *     - custom callback: A custom callback will be called every frame, or with a custom interval of time<br>\r\n * <br>\r\n * The 'custom selectors' should be avoided when possible. It is faster,<br>\r\n * and consumes less memory to use the 'update callback'. *\r\n * @zh\r\n * Scheduler 是负责触发回调函数的类。<br>\r\n * 通常情况下，建议使用 `director.getScheduler()` 来获取系统定时器。<br>\r\n * 有两种不同类型的定时器：<br>\r\n *     - update 定时器：每一帧都会触发。您可以自定义优先级。<br>\r\n *     - 自定义定时器：自定义定时器可以每一帧或者自定义的时间间隔触发。<br>\r\n * 如果希望每帧都触发，应该使用 update 定时器，使用 update 定时器更快，而且消耗更少的内存。\r\n */\r\nexport class Scheduler extends System {\r\n    public static ID = 'scheduler';\r\n\r\n    private _timeScale: number;\r\n    private _updatesNegList: any[];\r\n    private _updates0List: any[];\r\n    private _updatesPosList: any[];\r\n    private _hashForUpdates: any;\r\n    private _hashForTimers: any;\r\n    private _currentTarget: any;\r\n    private _currentTargetSalvaged: boolean;\r\n    private _updateHashLocked: boolean;\r\n    private _arrayForTimers: any;\r\n\r\n    /**\r\n     * @en This method should be called for any target which needs to schedule tasks, and this method should be called before any scheduler API usage.\r\n     * This method will add a `id` property if it doesn't exist.\r\n     * @zh 任何需要用 Scheduler 管理任务的对象主体都应该调用这个方法，并且应该在调用任何 Scheduler API 之前调用这个方法。\r\n     * 这个方法会给对象添加一个 `id` 属性，如果这个属性不存在的话。\r\n     * @param target\r\n     */\r\n    public static enableForTarget (target: ISchedulable) {\r\n        let found = false;\r\n        if (target.uuid) {\r\n            found = true;\r\n        } else if (target.id) {\r\n            found = true;\r\n        }\r\n        if (!found) {\r\n            // @ts-expect-error Notes written for over eslint\r\n            if (target.__instanceId) {\r\n                warnID(1513);\r\n            } else {\r\n                target.id = idGenerator.getNewId();\r\n            }\r\n        }\r\n    }\r\n\r\n    constructor () {\r\n        super();\r\n        this._timeScale = 1.0;\r\n        this._updatesNegList = [];  // list of priority < 0\r\n        this._updates0List = [];    // list of priority == 0\r\n        this._updatesPosList = [];  // list of priority > 0\r\n        this._hashForUpdates = createMap(true);  // hash used to fetch quickly the list entries for pause, delete, etc\r\n        this._hashForTimers = createMap(true);   // Used for \"selectors with interval\"\r\n        this._currentTarget = null;\r\n        this._currentTargetSalvaged = false;\r\n        this._updateHashLocked = false; // If true unschedule will not remove anything from a hash. Elements will only be marked for deletion.\r\n\r\n        this._arrayForTimers = [];  // Speed up indexing\r\n        // this._arrayForUpdates = [];   // Speed up indexing\r\n    }\r\n\r\n    // -----------------------public method-------------------------\r\n\r\n    /**\r\n     * @en\r\n     * Modifies the time of all scheduled callbacks.<br>\r\n     * You can use this property to create a 'slow motion' or 'fast forward' effect.<br>\r\n     * Default is 1.0. To create a 'slow motion' effect, use values below 1.0.<br>\r\n     * To create a 'fast forward' effect, use values higher than 1.0.<br>\r\n     * Note：It will affect EVERY scheduled selector / action.\r\n     * @zh\r\n     * 设置时间间隔的缩放比例。<br>\r\n     * 您可以使用这个方法来创建一个 “slow motion（慢动作）” 或 “fast forward（快进）” 的效果。<br>\r\n     * 默认是 1.0。要创建一个 “slow motion（慢动作）” 效果,使用值低于 1.0。<br>\r\n     * 要使用 “fast forward（快进）” 效果，使用值大于 1.0。<br>\r\n     * 注意：它影响该 Scheduler 下管理的所有定时器。\r\n     * @param timeScale\r\n     */\r\n    public setTimeScale (timeScale) {\r\n        this._timeScale = timeScale;\r\n    }\r\n\r\n    /**\r\n     * @en Returns time scale of scheduler.\r\n     * @zh 获取时间间隔的缩放比例。\r\n     */\r\n    public getTimeScale (): number {\r\n        return this._timeScale;\r\n    }\r\n\r\n    /**\r\n     * @en 'update' the scheduler. (You should NEVER call this method, unless you know what you are doing.)\r\n     * @zh update 调度函数。(不应该直接调用这个方法，除非完全了解这么做的结果)\r\n     * @param dt delta time\r\n     */\r\n    public update (dt) {\r\n        this._updateHashLocked = true;\r\n        if (this._timeScale !== 1) {\r\n            dt *= this._timeScale;\r\n        }\r\n\r\n        let i: number;\r\n        let list;\r\n        let len: number;\r\n        let entry;\r\n\r\n        for (i = 0, list = this._updatesNegList, len = list.length; i < len; i++) {\r\n            entry = list[i];\r\n            if (!entry.paused && !entry.markedForDeletion) {\r\n                entry.target.update(dt);\r\n            }\r\n        }\r\n\r\n        for (i = 0, list = this._updates0List, len = list.length; i < len; i++) {\r\n            entry = list[i];\r\n            if (!entry.paused && !entry.markedForDeletion) {\r\n                entry.target.update(dt);\r\n            }\r\n        }\r\n\r\n        for (i = 0, list = this._updatesPosList, len = list.length; i < len; i++) {\r\n            entry = list[i];\r\n            if (!entry.paused && !entry.markedForDeletion) {\r\n                entry.target.update(dt);\r\n            }\r\n        }\r\n\r\n        // Iterate over all the custom selectors\r\n        let elt;\r\n        const arr = this._arrayForTimers;\r\n        for (i = 0; i < arr.length; i++) {\r\n            elt = <HashTimerEntry> arr[i];\r\n            this._currentTarget = elt;\r\n            this._currentTargetSalvaged = false;\r\n\r\n            if (!elt.paused) {\r\n                // The 'timers' array may change while inside this loop\r\n                for (elt.timerIndex = 0; elt.timerIndex < elt.timers.length; ++(elt.timerIndex)) {\r\n                    elt.currentTimer = elt.timers[elt.timerIndex];\r\n                    elt.currentTimerSalvaged = false;\r\n\r\n                    elt.currentTimer.update(dt);\r\n                    elt.currentTimer = null;\r\n                }\r\n            }\r\n\r\n            // only delete currentTarget if no actions were scheduled during the cycle (issue #481)\r\n            if (this._currentTargetSalvaged && this._currentTarget.timers.length === 0) {\r\n                this._removeHashElement(this._currentTarget);\r\n                --i;\r\n            }\r\n        }\r\n\r\n        // delete all updates that are marked for deletion\r\n        // updates with priority < 0\r\n        for (i = 0, list = this._updatesNegList; i < list.length;) {\r\n            entry = list[i];\r\n            if (entry.markedForDeletion) {\r\n                this._removeUpdateFromHash(entry);\r\n            } else {\r\n                i++;\r\n            }\r\n        }\r\n\r\n        for (i = 0, list = this._updates0List; i < list.length;) {\r\n            entry = list[i];\r\n            if (entry.markedForDeletion) {\r\n                this._removeUpdateFromHash(entry);\r\n            } else {\r\n                i++;\r\n            }\r\n        }\r\n\r\n        for (i = 0, list = this._updatesPosList; i < list.length;) {\r\n            entry = list[i];\r\n            if (entry.markedForDeletion) {\r\n                this._removeUpdateFromHash(entry);\r\n            } else {\r\n                i++;\r\n            }\r\n        }\r\n\r\n        this._updateHashLocked = false;\r\n        this._currentTarget = null;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * <p>\r\n     *   The scheduled method will be called every 'interval' seconds.<br/>\r\n     *   If paused is YES, then it won't be called until it is resumed.<br/>\r\n     *   If 'interval' is 0, it will be called every frame, but if so, it recommended to use 'scheduleUpdateForTarget:' instead.<br/>\r\n     *   If the callback function is already scheduled, then only the interval parameter will be updated without re-scheduling it again.<br/>\r\n     *   repeat let the action be repeated repeat + 1 times, use `macro.REPEAT_FOREVER` to let the action run continuously<br/>\r\n     *   delay is the amount of time the action will wait before it'll start. Unit: s<br/>\r\n     * </p>\r\n     * @zh\r\n     * 指定回调函数，调用对象等信息来添加一个新的定时器。<br/>\r\n     * 如果 paused 值为 true，那么直到 resume 被调用才开始计时。<br/>\r\n     * 当时间间隔达到指定值时，设置的回调函数将会被调用。<br/>\r\n     * 如果 interval 值为 0，那么回调函数每一帧都会被调用，但如果是这样，\r\n     * 建议使用 scheduleUpdateForTarget 代替。<br/>\r\n     * 如果回调函数已经被定时器使用，那么只会更新之前定时器的时间间隔参数，不会设置新的定时器。<br/>\r\n     * repeat 值可以让定时器触发 repeat + 1 次，使用 `macro.REPEAT_FOREVER`\r\n     * 可以让定时器一直循环触发。<br/>\r\n     * delay 值指定延迟时间，定时器会在延迟指定的时间之后开始计时，单位: 秒。\r\n     * @param callback\r\n     * @param target\r\n     * @param interval\r\n     * @param [repeat]\r\n     * @param [delay=0]\r\n     * @param [paused=fasle]\r\n     */\r\n    public schedule (callback: (dt?: number) => void, target: ISchedulable, interval: number, repeat?: number, delay?: number, paused?: boolean) {\r\n        if (typeof callback !== 'function') {\r\n            const tmp = callback;\r\n            // @ts-expect-error Notes written for over eslint\r\n            callback = target;\r\n            target = tmp;\r\n        }\r\n        // selector, target, interval, repeat, delay, paused\r\n        // selector, target, interval, paused\r\n        if (arguments.length === 3 || arguments.length === 4 || arguments.length === 5) {\r\n            paused = !!repeat;\r\n            repeat = legacyCC.macro.REPEAT_FOREVER;\r\n            delay = 0;\r\n        }\r\n\r\n        assertID(target, 1502);\r\n\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n        let element = <HashTimerEntry> this._hashForTimers[targetId];\r\n        if (!element) {\r\n            // Is this the 1st element ? Then set the pause level to all the callback_fns of this target\r\n            element = HashTimerEntry.get(null, target, 0, null, null, paused);\r\n            this._arrayForTimers.push(element);\r\n            this._hashForTimers[targetId] = element;\r\n        } else if (element.paused !== paused) {\r\n            warnID(1511);\r\n        }\r\n\r\n        let timer;\r\n        let i;\r\n        if (element.timers == null) {\r\n            element.timers = [];\r\n        } else {\r\n            for (i = 0; i < element.timers.length; ++i) {\r\n                timer = element.timers[i];\r\n                if (timer && callback === timer._callback) {\r\n                    logID(1507, timer.getInterval(), interval);\r\n                    timer._interval = interval;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        timer = CallbackTimer.get();\r\n        timer.initWithCallback(this, callback, target, interval, repeat, delay);\r\n        element.timers.push(timer);\r\n\r\n        if (this._currentTarget === element && this._currentTargetSalvaged) {\r\n            this._currentTargetSalvaged = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Schedules the update callback for a given target,\r\n     * During every frame after schedule started, the \"update\" function of target will be invoked.\r\n     * @zh\r\n     * 使用指定的优先级为指定的对象设置 update 定时器。<br>\r\n     * update 定时器每一帧都会被触发，触发时自动调用指定对象的 \"update\" 函数。<br>\r\n     * 优先级的值越低，定时器被触发的越早。\r\n     * @param target\r\n     * @param priority\r\n     * @param paused\r\n     */\r\n    public scheduleUpdate (target: ISchedulable, priority: number, paused: boolean) {\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n        const hashElement = this._hashForUpdates[targetId];\r\n        if (hashElement && hashElement.entry) {\r\n            // check if priority has changed\r\n            if (hashElement.entry.priority !== priority) {\r\n                if (this._updateHashLocked) {\r\n                    logID(1506);\r\n                    hashElement.entry.markedForDeletion = false;\r\n                    hashElement.entry.paused = paused;\r\n                    return;\r\n                } else {\r\n                    // will be added again outside if (hashElement).\r\n                    this.unscheduleUpdate(target);\r\n                }\r\n            } else {\r\n                hashElement.entry.markedForDeletion = false;\r\n                hashElement.entry.paused = paused;\r\n                return;\r\n            }\r\n        }\r\n\r\n        const listElement = ListEntry.get(target, priority, paused, false);\r\n        let ppList;\r\n\r\n        // most of the updates are going to be 0, that's way there\r\n        // is an special list for updates with priority 0\r\n        if (priority === 0) {\r\n            ppList = this._updates0List;\r\n            this._appendIn(ppList, listElement);\r\n        } else {\r\n            ppList = priority < 0 ? this._updatesNegList : this._updatesPosList;\r\n            this._priorityIn(ppList, listElement, priority);\r\n        }\r\n\r\n        // update hash entry for quick access\r\n        this._hashForUpdates[targetId] = HashUpdateEntry.get(ppList, listElement, target, null);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Unschedules a callback for a callback and a given target.\r\n     * If you want to unschedule the \"update\", use `unscheduleUpdate()`\r\n     * @zh\r\n     * 取消指定对象定时器。\r\n     * 如果需要取消 update 定时器，请使用 unscheduleUpdate()。\r\n     * @param callback The callback to be unscheduled\r\n     * @param target The target bound to the callback.\r\n     */\r\n    public unschedule (callback, target:ISchedulable) {\r\n        // callback, target\r\n\r\n        // explicity handle nil arguments when removing an object\r\n        if (!target || !callback) {\r\n            return;\r\n        }\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n\r\n        const element = this._hashForTimers[targetId];\r\n        if (element) {\r\n            const timers = element.timers;\r\n            for (let i = 0, li = timers.length; i < li; i++) {\r\n                const timer = timers[i];\r\n                if (callback === timer._callback) {\r\n                    if ((timer === element.currentTimer) && (!element.currentTimerSalvaged)) {\r\n                        element.currentTimerSalvaged = true;\r\n                    }\r\n                    timers.splice(i, 1);\r\n                    CallbackTimer.put(timer);\r\n                    // update timerIndex in case we are in tick;, looping over the actions\r\n                    if (element.timerIndex >= i) {\r\n                        element.timerIndex--;\r\n                    }\r\n\r\n                    if (timers.length === 0) {\r\n                        if (this._currentTarget === element) {\r\n                            this._currentTargetSalvaged = true;\r\n                        } else {\r\n                            this._removeHashElement(element);\r\n                        }\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Unschedules the update callback for a given target.\r\n     * @zh 取消指定对象的 update 定时器。\r\n     * @param target The target to be unscheduled.\r\n     */\r\n    public unscheduleUpdate (target:ISchedulable) {\r\n        if (!target) {\r\n            return;\r\n        }\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n\r\n        const element = this._hashForUpdates[targetId];\r\n        if (element) {\r\n            if (this._updateHashLocked) {\r\n                element.entry.markedForDeletion = true;\r\n            } else {\r\n                this._removeUpdateFromHash(element.entry);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Unschedules all scheduled callbacks for a given target.\r\n     * This also includes the \"update\" callback.\r\n     * @zh 取消指定对象的所有定时器，包括 update 定时器。\r\n     * @param target The target to be unscheduled.\r\n     */\r\n    public unscheduleAllForTarget (target) {\r\n        // explicit nullptr handling\r\n        if (!target) {\r\n            return;\r\n        }\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n\r\n        // Custom Selectors\r\n        const element = this._hashForTimers[targetId];\r\n        if (element) {\r\n            const timers = element.timers;\r\n            if (timers.indexOf(element.currentTimer) > -1\r\n                && (!element.currentTimerSalvaged)) {\r\n                element.currentTimerSalvaged = true;\r\n            }\r\n            for (let i = 0, l = timers.length; i < l; i++) {\r\n                CallbackTimer.put(timers[i]);\r\n            }\r\n            timers.length = 0;\r\n\r\n            if (this._currentTarget === element) {\r\n                this._currentTargetSalvaged = true;\r\n            } else {\r\n                this._removeHashElement(element);\r\n            }\r\n        }\r\n\r\n        // update selector\r\n        this.unscheduleUpdate(target);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Unschedules all scheduled callbacks from all targets including the system callbacks.<br/>\r\n     * You should NEVER call this method, unless you know what you are doing.\r\n     * @zh\r\n     * 取消所有对象的所有定时器，包括系统定时器。<br/>\r\n     * 不要调用此函数，除非你确定你在做什么。\r\n     */\r\n    public unscheduleAll () {\r\n        this.unscheduleAllWithMinPriority(System.Priority.SCHEDULER);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Unschedules all callbacks from all targets with a minimum priority.<br/>\r\n     * You should only call this with `PRIORITY_NON_SYSTEM_MIN` or higher.\r\n     * @zh\r\n     * 取消所有优先级的值大于指定优先级的定时器。<br/>\r\n     * 你应该只取消优先级的值大于 PRIORITY_NON_SYSTEM_MIN 的定时器。\r\n     * @param minPriority The minimum priority of selector to be unscheduled. Which means, all selectors which\r\n     *        priority is higher than minPriority will be unscheduled.\r\n     */\r\n    public unscheduleAllWithMinPriority (minPriority: number) {\r\n        // Custom Selectors\r\n        let i;\r\n        let element;\r\n        const arr = this._arrayForTimers;\r\n        for (i = arr.length - 1; i >= 0; i--) {\r\n            element = <HashTimerEntry> arr[i];\r\n            this.unscheduleAllForTarget(element.target);\r\n        }\r\n\r\n        // Updates selectors\r\n        let entry;\r\n        let temp_length = 0;\r\n        if (minPriority < 0) {\r\n            for (i = 0; i < this._updatesNegList.length;) {\r\n                temp_length = this._updatesNegList.length;\r\n                entry = this._updatesNegList[i];\r\n                if (entry && entry.priority >= minPriority) {\r\n                    this.unscheduleUpdate(entry.target);\r\n                }\r\n                if (temp_length === this._updatesNegList.length) {\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (minPriority <= 0) {\r\n            for (i = 0; i < this._updates0List.length;) {\r\n                temp_length = this._updates0List.length;\r\n                entry = this._updates0List[i];\r\n                if (entry) {\r\n                    this.unscheduleUpdate(entry.target);\r\n                }\r\n                if (temp_length === this._updates0List.length) {\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (i = 0; i < this._updatesPosList.length;) {\r\n            temp_length = this._updatesPosList.length;\r\n            entry = this._updatesPosList[i];\r\n            if (entry && entry.priority >= minPriority) {\r\n                this.unscheduleUpdate(entry.target);\r\n            }\r\n            if (temp_length === this._updatesPosList.length) {\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Checks whether a callback for a given target is scheduled.\r\n     * @zh 检查指定的回调函数和回调对象组合是否存在定时器。\r\n     * @param callback The callback to check.\r\n     * @param target The target of the callback.\r\n     * @return True if the specified callback is invoked, false if not.\r\n     */\r\n    public isScheduled (callback, target:ISchedulable) : boolean {\r\n        // key, target\r\n        // selector, target\r\n        assertID(callback, 1508);\r\n        assertID(target, 1509);\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return false;\r\n        }\r\n\r\n        const element = this._hashForTimers[targetId];\r\n\r\n        if (!element) {\r\n            return false;\r\n        }\r\n\r\n        if (element.timers == null) {\r\n            return false;\r\n        } else {\r\n            const timers = element.timers;\r\n\r\n            for (let i = 0; i < timers.length; ++i) {\r\n                const timer =  timers[i];\r\n                if (callback === timer._callback) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Pause all selectors from all targets.<br/>\r\n     * You should NEVER call this method, unless you know what you are doing.\r\n     * @zh\r\n     * 暂停所有对象的所有定时器。<br/>\r\n     * 不要调用这个方法，除非你知道你正在做什么。\r\n     */\r\n    public pauseAllTargets () {\r\n        return this.pauseAllTargetsWithMinPriority(System.Priority.SCHEDULER);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Pause all selectors from all targets with a minimum priority. <br/>\r\n     * You should only call this with kCCPriorityNonSystemMin or higher.\r\n     * @zh\r\n     * 暂停所有优先级的值大于指定优先级的定时器。<br/>\r\n     * 你应该只暂停优先级的值大于 PRIORITY_NON_SYSTEM_MIN 的定时器。\r\n     * @param minPriority\r\n     */\r\n    public pauseAllTargetsWithMinPriority (minPriority: number) {\r\n        const idsWithSelectors: ISchedulable[] = [];\r\n\r\n        let element: HashTimerEntry;\r\n        const locArrayForTimers = this._arrayForTimers;\r\n        let i;\r\n        let li;\r\n        // Custom Selectors\r\n        for (i = 0, li = locArrayForTimers.length; i < li; i++) {\r\n            element = locArrayForTimers[i];\r\n            if (element) {\r\n                element.paused = true;\r\n                idsWithSelectors.push(element.target);\r\n            }\r\n        }\r\n\r\n        let entry;\r\n        if (minPriority < 0) {\r\n            for (i = 0; i < this._updatesNegList.length; i++) {\r\n                entry = this._updatesNegList[i];\r\n                if (entry) {\r\n                    if (entry.priority >= minPriority) {\r\n                        entry.paused = true;\r\n                        idsWithSelectors.push(entry.target);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (minPriority <= 0) {\r\n            for (i = 0; i < this._updates0List.length; i++) {\r\n                entry = this._updates0List[i];\r\n                if (entry) {\r\n                    entry.paused = true;\r\n                    idsWithSelectors.push(entry.target);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (i = 0; i < this._updatesPosList.length; i++) {\r\n            entry = this._updatesPosList[i];\r\n            if (entry) {\r\n                if (entry.priority >= minPriority) {\r\n                    entry.paused = true;\r\n                    idsWithSelectors.push(entry.target);\r\n                }\r\n            }\r\n        }\r\n\r\n        return idsWithSelectors;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Resume selectors on a set of targets.<br/>\r\n     * This can be useful for undoing a call to pauseAllCallbacks.\r\n     * @zh\r\n     * 恢复指定数组中所有对象的定时器。<br/>\r\n     * 这个函数是 pauseAllCallbacks 的逆操作。\r\n     * @param targetsToResume\r\n     */\r\n    public resumeTargets (targetsToResume) {\r\n        if (!targetsToResume) {\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < targetsToResume.length; i++) {\r\n            this.resumeTarget(targetsToResume[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Pauses the target.<br/>\r\n     * All scheduled selectors/update for a given target won't be 'ticked' until the target is resumed.<br/>\r\n     * If the target is not present, nothing happens.\r\n     * @zh\r\n     * 暂停指定对象的定时器。<br/>\r\n     * 指定对象的所有定时器都会被暂停。<br/>\r\n     * 如果指定的对象没有定时器，什么也不会发生。\r\n     * @param target\r\n     */\r\n    public pauseTarget (target:ISchedulable) {\r\n        assertID(target, 1503);\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n\r\n        // customer selectors\r\n        const element = this._hashForTimers[targetId];\r\n        if (element) {\r\n            element.paused = true;\r\n        }\r\n\r\n        // update callback\r\n        const elementUpdate = this._hashForUpdates[targetId];\r\n        if (elementUpdate) {\r\n            elementUpdate.entry.paused = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Resumes the target.<br/>\r\n     * The 'target' will be unpaused, so all schedule selectors/update will be 'ticked' again.<br/>\r\n     * If the target is not present, nothing happens.\r\n     * @zh\r\n     * 恢复指定对象的所有定时器。<br/>\r\n     * 指定对象的所有定时器将继续工作。<br/>\r\n     * 如果指定的对象没有定时器，什么也不会发生。\r\n     * @param target\r\n     */\r\n    public resumeTarget (target:ISchedulable) {\r\n        assertID(target, 1504);\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return;\r\n        }\r\n\r\n        // custom selectors\r\n        const element = this._hashForTimers[targetId];\r\n        if (element) {\r\n            element.paused = false;\r\n        }\r\n\r\n        // update callback\r\n        const elementUpdate = this._hashForUpdates[targetId];\r\n        if (elementUpdate) {\r\n            elementUpdate.entry.paused = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Returns whether or not the target is paused.\r\n     * @zh 返回指定对象的定时器是否处于暂停状态。\r\n     * @param target\r\n     */\r\n    public isTargetPaused (target:ISchedulable) {\r\n        assertID(target, 1505);\r\n        const targetId = target.uuid || target.id;\r\n        if (!targetId) {\r\n            errorID(1510);\r\n            return false;\r\n        }\r\n\r\n        // Custom selectors\r\n        const element = <HashTimerEntry> this._hashForTimers[targetId];\r\n        if (element) {\r\n            return <boolean>element.paused;\r\n        }\r\n        const elementUpdate = this._hashForUpdates[targetId];\r\n        if (elementUpdate) {\r\n            return <boolean>elementUpdate.entry.paused;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // -----------------------private method----------------------\r\n    private _removeHashElement (element) {\r\n        const targetId = element.target.uuid || element.target.id;\r\n        delete this._hashForTimers[targetId];\r\n        const arr = this._arrayForTimers;\r\n        for (let i = 0, l = arr.length; i < l; i++) {\r\n            if (arr[i] === element) {\r\n                arr.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n        HashTimerEntry.put(element);\r\n    }\r\n\r\n    private _removeUpdateFromHash (entry) {\r\n        const targetId = entry.target.uuid || entry.target.id;\r\n        const element = this._hashForUpdates[targetId];\r\n        if (element) {\r\n            // Remove list entry from list\r\n            const list = element.list;\r\n            const listEntry = element.entry;\r\n            for (let i = 0, l = list.length; i < l; i++) {\r\n                if (list[i] === listEntry) {\r\n                    list.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            delete this._hashForUpdates[targetId];\r\n            ListEntry.put(listEntry);\r\n            HashUpdateEntry.put(element);\r\n        }\r\n    }\r\n\r\n    private _priorityIn (ppList, listElement, priority) {\r\n        for (let i = 0; i < ppList.length; i++) {\r\n            if (priority < ppList[i].priority) {\r\n                ppList.splice(i, 0, listElement);\r\n                return;\r\n            }\r\n        }\r\n        ppList.push(listElement);\r\n    }\r\n\r\n    private _appendIn (ppList, listElement) {\r\n        ppList.push(listElement);\r\n    }\r\n}\r\n\r\nlegacyCC.Scheduler = Scheduler;\r\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { Root } from '../../root';\nimport { Node } from '../../scene-graph';\nimport { Camera } from '../scene/camera';\nimport { DirectionalLight } from '../scene/directional-light';\nimport { Model } from '../scene/model';\nimport { SphereLight } from '../scene/sphere-light';\nimport { SpotLight } from '../scene/spot-light';\nimport { TransformBit } from '../../scene-graph/node-enum';\nimport { DrawBatch2D } from '../../../2d/renderer/draw-batch';\n\nexport interface IRenderSceneInfo {\n    name: string;\n}\n\nexport interface ISceneNodeInfo {\n    name: string;\n    isStatic?: boolean;\n    // parent: Node;\n}\n\n/**\n * @en The result of one raycast operation\n * @zh 一次射线检测的结果\n */\nexport interface IRaycastResult {\n    node: Node;\n    distance: number;\n}\n\n/**\n * @en The render scene which is created by the [[Root]] and provides all basic render scene elements for the render process.\n * It manages:\n * 1. [[Camera]]s\n * 2. [[Light]]s\n * 3. Renderable objects: [[renderer.Model]]s and `DrawBatchs`\n * @zh 渲染场景，由 [[Root]] 创建，并提供用于渲染流程的所有场景基础元素。它管理：\n * 1. [[Camera]]s：相机\n * 2. [[Light]]s：光源\n * 3. 渲染元素：[[renderer.Model]]s 和 `DrawBatchs`\n */\nexport class RenderScene {\n    /**\n     * @en The root manager of the renderer\n     * @zh 基础渲染管理器\n     */\n    get root (): Root {\n        return this._root;\n    }\n\n    /**\n     * @en The name of the render scene\n     * @zh 渲染场景的名称\n     */\n    get name (): string {\n        return this._name;\n    }\n\n    /**\n     * @en All cameras of the render scene\n     * @zh 渲染场景管理的所有相机\n     */\n    get cameras (): Camera[] {\n        return this._cameras;\n    }\n\n    /**\n     * @en The main directional light source of the render scene\n     * @zh 渲染场景管理的主方向光源\n     */\n    get mainLight (): DirectionalLight | null {\n        return this._mainLight;\n    }\n\n    /**\n     * @en All sphere light sources of the render scene\n     * @zh 渲染场景管理的所有球面光源\n     */\n    get sphereLights (): SphereLight[] {\n        return this._sphereLights;\n    }\n\n    /**\n     * @en All spot light sources of the render scene\n     * @zh 渲染场景管理的所有聚光灯光源\n     */\n    get spotLights (): SpotLight[] {\n        return this._spotLights;\n    }\n\n    /**\n     * @en All active models of the render scene\n     * @zh 渲染场景管理的所有模型\n     */\n    get models (): Model[] {\n        return this._models;\n    }\n\n    /**\n     * @en All active 2d draw batches of the render scene\n     * @zh 渲染场景管理的所有 2D 渲染批次对象\n     */\n    get batches () {\n        return this._batches;\n    }\n\n    private _root: Root;\n    private _name = '';\n    private _cameras: Camera[] = [];\n    private _models: Model[] = [];\n    private _batches: DrawBatch2D[] = [];\n    private _directionalLights: DirectionalLight[] = [];\n    private _sphereLights: SphereLight[] = [];\n    private _spotLights: SpotLight[] = [];\n    private _mainLight: DirectionalLight | null = null;\n    private _modelId = 0;\n\n    /**\n     * Register the creation function of the render scene to root.\n     * @internal\n     */\n    public static registerCreateFunc (root: Root) {\n        root._createSceneFun = (_root: Root): RenderScene => new RenderScene(_root);\n    }\n\n    constructor (root: Root) {\n        this._root = root;\n    }\n\n    /**\n     * @en Initialize the render scene\n     * @zh 初始化渲染场景\n     * @returns Successful\n     */\n    public initialize (info: IRenderSceneInfo): boolean {\n        this._name = info.name;\n        return true;\n    }\n\n    /**\n     * @en The update process of the render scene, it updates all rendering related data for the lights and the models.\n     * @zh 渲染场景的更新流程，会更新所有光源和模型的渲染相关数据。\n     * @param stamp The update time stamp\n     * @returns void\n     */\n    public update (stamp: number) {\n        const mainLight = this._mainLight;\n        if (mainLight) {\n            mainLight.update();\n        }\n\n        const sphereLights = this._sphereLights;\n        for (let i = 0; i < sphereLights.length; i++) {\n            const light = sphereLights[i];\n            light.update();\n        }\n\n        const spotLights = this._spotLights;\n        for (let i = 0; i < spotLights.length; i++) {\n            const light = spotLights[i];\n            light.update();\n        }\n\n        const models = this._models;\n        for (let i = 0; i < models.length; i++) {\n            const model = models[i];\n\n            if (model.enabled) {\n                model.updateTransform(stamp);\n                model.updateUBOs(stamp);\n            }\n        }\n    }\n\n    /**\n     * @en Destroy the render scene, dangerous, please do not invoke manually.\n     * @zh 销毁渲染场景，请不要手动销毁，会造成未知行为。\n     */\n    public destroy () {\n        this.removeCameras();\n        this.removeSphereLights();\n        this.removeSpotLights();\n        this.removeModels();\n    }\n\n    /**\n     * @en Attach a camera to the render scene\n     * @zh 向渲染场景挂载一个相机\n     */\n    public addCamera (cam: Camera) {\n        cam.attachToScene(this);\n        this._cameras.push(cam);\n    }\n\n    /**\n     * @en Detach a camera to the render scene\n     * @zh 从渲染场景移除一个相机\n     */\n    public removeCamera (camera: Camera) {\n        for (let i = 0; i < this._cameras.length; ++i) {\n            if (this._cameras[i] === camera) {\n                this._cameras.splice(i, 1);\n                camera.detachFromScene();\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Detach all cameras to the render scene\n     * @zh 从渲染场景移除所有相机\n     */\n    public removeCameras () {\n        for (const camera of this._cameras) {\n            camera.detachFromScene();\n        }\n        this._cameras.splice(0);\n    }\n\n    /**\n     * @en Sets the main light source for the render scene\n     * @zh 给渲染场景设置主光源\n     * @param dl The main directional light source\n     */\n    public setMainLight (dl: DirectionalLight | null) {\n        this._mainLight = dl;\n    }\n\n    /**\n     * @en Remove the main light source from the render scene\n     * @zh 从渲染场景移除主光源\n     * @param dl The main directional light source, if it's not the actual main light, nothing happens.\n     */\n    public unsetMainLight (dl: DirectionalLight) {\n        if (this._mainLight === dl) {\n            const dlList = this._directionalLights;\n            if (dlList.length) {\n                this.setMainLight(dlList[dlList.length - 1]);\n                if (this._mainLight.node) { // trigger update\n                    this._mainLight.node.hasChangedFlags |= TransformBit.ROTATION;\n                }\n                return;\n            }\n            this.setMainLight(null);\n        }\n    }\n\n    /**\n     * @en Add a directional light source, only one directional light is active and act as the main light source.\n     * @zh 增加一个方向光源，场景中只会有一个方向光是起效的，并且会作为主光源。\n     * @param dl The directional light.\n     */\n    public addDirectionalLight (dl: DirectionalLight) {\n        dl.attachToScene(this);\n        this._directionalLights.push(dl);\n    }\n\n    /**\n     * @en Remove a directional light source.\n     * @zh 删除一个方向光源。\n     * @param dl The directional light.\n     */\n    public removeDirectionalLight (dl: DirectionalLight) {\n        for (let i = 0; i < this._directionalLights.length; ++i) {\n            if (this._directionalLights[i] === dl) {\n                dl.detachFromScene();\n                this._directionalLights.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Add a sphere light source.\n     * @zh 增加一个球面光源。\n     * @param pl The sphere light.\n     */\n    public addSphereLight (pl: SphereLight) {\n        pl.attachToScene(this);\n        this._sphereLights.push(pl);\n    }\n\n    /**\n     * @en Remove a sphere light source.\n     * @zh 删除一个球面光源。\n     * @param pl The sphere light.\n     */\n    public removeSphereLight (pl: SphereLight) {\n        for (let i = 0; i < this._sphereLights.length; ++i) {\n            if (this._sphereLights[i] === pl) {\n                pl.detachFromScene();\n                this._sphereLights.splice(i, 1);\n\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Add a spot light source.\n     * @zh 增加一个聚光灯光源。\n     * @param sl The spot light.\n     */\n    public addSpotLight (sl: SpotLight) {\n        sl.attachToScene(this);\n        this._spotLights.push(sl);\n    }\n\n    /**\n     * @en Remove a spot light source.\n     * @zh 删除一个聚光灯光源。\n     * @param sl The spot light.\n     */\n    public removeSpotLight (sl: SpotLight) {\n        for (let i = 0; i < this._spotLights.length; ++i) {\n            if (this._spotLights[i] === sl) {\n                sl.detachFromScene();\n                this._spotLights.splice(i, 1);\n\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Remove all sphere light sources.\n     * @zh 删除所有球面光源。\n     */\n    public removeSphereLights () {\n        for (let i = 0; i < this._sphereLights.length; ++i) {\n            this._sphereLights[i].detachFromScene();\n        }\n        this._sphereLights.length = 0;\n    }\n\n    /**\n     * @en Remove all spot light sources.\n     * @zh 删除所有聚光灯光源。\n     */\n    public removeSpotLights () {\n        for (let i = 0; i < this._spotLights.length; ++i) {\n            this._spotLights[i].detachFromScene();\n        }\n        this._spotLights = [];\n    }\n\n    /**\n     * @en Add a model, all models attached to the render scene will be submitted for rendering.\n     * @zh 增加一个模型，渲染场景上挂载的所有模型都会被提交渲染。\n     * @param m The model.\n     */\n    public addModel (m: Model) {\n        m.attachToScene(this);\n        this._models.push(m);\n    }\n\n    /**\n     * @en Remove a model, model removed will no longer be submitted for rendering.\n     * @zh 删除一个模型，移除的模型将不再被提交渲染。\n     * @param m The model.\n     */\n    public removeModel (model: Model) {\n        for (let i = 0; i < this._models.length; ++i) {\n            if (this._models[i] === model) {\n                model.detachFromScene();\n                this._models.splice(i, 1);\n\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Remove all models.\n     * @zh 删除所有模型。\n     */\n    public removeModels () {\n        for (const m of this._models) {\n            m.detachFromScene();\n            m.destroy();\n        }\n        this._models.length = 0;\n    }\n\n    /**\n     * @en Add a draw batch of 2d objects, all draw batches attached to the render scene will be submitted for rendering.\n     * @zh 增加一个 2D 渲染批次，渲染场景上挂载的所有 2D 渲染批次都会被提交渲染。\n     * @param batch The draw batch.\n     * @internal\n     * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n     */\n    public addBatch (batch: DrawBatch2D) {\n        this._batches.push(batch);\n    }\n\n    /**\n     * @en Remove a draw batch of 2d objects, draw batch removed will no longer be submitted for rendering.\n     * @zh 删除一个 2D 渲染批次，移除的 2D 渲染批次将不再被提交渲染。\n     * @param batch The draw batch.\n     * @internal\n     * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n     */\n    public removeBatch (batch: DrawBatch2D) {\n        for (let i = 0; i < this._batches.length; ++i) {\n            if (this._batches[i] === batch) {\n                this._batches.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Remove all 2d draw batches.\n     * @zh 删除所有 2D 渲染批次。\n     * @internal\n     * @deprecated since v3.6.0, this is an engine private interface that will be removed in the future.\n     */\n    public removeBatches () {\n        this._batches.length = 0;\n    }\n\n    /**\n     * @en Notify all models that the global pipeline state have been updated so that they can update their render data and states.\n     * @zh 通知所有模型全局管线状态已更新，需要更新自身状态。\n     */\n    public onGlobalPipelineStateChanged () {\n        for (const m of this._models) {\n            m.onGlobalPipelineStateChanged();\n        }\n    }\n\n    /**\n     * @en Generate a new model id.\n     * @zh 生成一个新的模型 ID\n     * @returns The model id\n     */\n    public generateModelId (): number {\n        return this._modelId++;\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\nimport { JSB } from 'internal:constants';\nimport { screenAdapter } from 'pal/screen-adapter';\nimport { Orientation } from '../../../../pal/screen-adapter/enum-type';\nimport {\n    TextureType, TextureUsageBit, Format, RenderPass, Texture, Framebuffer,\n    RenderPassInfo, Device, TextureInfo, FramebufferInfo, Swapchain, SurfaceTransform,\n} from '../../gfx';\nimport { Root } from '../../root';\nimport { Camera } from '../scene';\n\nexport interface IRenderWindowInfo {\n    title?: string;\n    width: number;\n    height: number;\n    renderPassInfo: RenderPassInfo;\n    swapchain?: Swapchain;\n}\n\nconst orientationMap: Record<Orientation, SurfaceTransform> = {\n    [Orientation.PORTRAIT]: SurfaceTransform.IDENTITY,\n    [Orientation.LANDSCAPE_RIGHT]: SurfaceTransform.ROTATE_90,\n    [Orientation.PORTRAIT_UPSIDE_DOWN]: SurfaceTransform.ROTATE_180,\n    [Orientation.LANDSCAPE_LEFT]: SurfaceTransform.ROTATE_270,\n};\n\n/**\n * @en The render window represents the render target, it could be an off screen frame buffer or the on screen buffer.\n * @zh 渲染窗口代表了一个渲染目标，可以是离屏的帧缓冲，也可以是屏幕缓冲\n */\nexport class RenderWindow {\n    /**\n     * @en Get window width. Pre-rotated (i.e. rotationally invariant, always in identity/portrait mode) if possible.\n     * If you want to get oriented size instead, you should use [[renderer.scene.Camera.width]] which corresponds to the current screen rotation.\n     * @zh 获取窗口宽度。如果支持交换链预变换，返回值将始终处于单位旋转（竖屏）坐标系下。如果需要获取旋转后的尺寸，请使用 [[renderer.scene.Camera.width]]。\n     */\n    get width (): number {\n        return this._width;\n    }\n\n    /**\n     * @en Get window height. Pre-rotated (i.e. rotationally invariant, always in identity/portrait mode) if possible.\n     * If you want to get oriented size instead, you should use [[renderer.scene.Camera.width]] which corresponds to the current screen rotation.\n     * @zh 获取窗口高度。如果支持交换链预变换，返回值将始终处于单位旋转（竖屏）坐标系下。如果需要获取旋转后的尺寸，请使用 [[renderer.scene.Camera.height]]。\n     */\n    get height (): number {\n        return this._height;\n    }\n\n    /**\n     * @en Get the swapchain for this window, if there is one\n     * @zh 如果存在的话，获取此窗口的交换链\n     */\n    get swapchain () {\n        return this._swapchain;\n    }\n\n    /**\n     * @en Get window frame buffer.\n     * @zh 帧缓冲对象。\n     */\n    get framebuffer (): Framebuffer {\n        return this._framebuffer!;\n    }\n\n    get cameras () {\n        return this._cameras;\n    }\n\n    protected _title = '';\n    protected _width = 1;\n    protected _height = 1;\n    protected _swapchain: Swapchain = null!;\n    protected _renderPass: RenderPass | null = null;\n    protected _colorTextures: Texture[] = [];\n    protected _depthStencilTexture: Texture | null = null;\n    protected _cameras: Camera[] = [];\n    protected _hasOnScreenAttachments = false;\n    protected _hasOffScreenAttachments = false;\n    protected _framebuffer: Framebuffer | null = null;\n    protected _device: Device | null = null;\n\n    /**\n     * @private\n     */\n    public static registerCreateFunc (root: Root) {\n        root._createWindowFun = (_root: Root): RenderWindow => new RenderWindow(_root);\n    }\n\n    private constructor (root: Root) {}\n\n    public initialize (device: Device, info: IRenderWindowInfo): boolean {\n        if (info.title !== undefined) {\n            this._title = info.title;\n        }\n\n        if (info.swapchain !== undefined) {\n            this._swapchain = info.swapchain;\n        }\n\n        this._width = info.width;\n        this._height = info.height;\n        this._device = device;\n        this._renderPass = device.createRenderPass(info.renderPassInfo);\n\n        if (info.swapchain) {\n            this._swapchain = info.swapchain;\n            this._colorTextures.push(info.swapchain.colorTexture);\n            this._depthStencilTexture = info.swapchain.depthStencilTexture;\n        } else {\n            for (let i = 0; i < info.renderPassInfo.colorAttachments.length; i++) {\n                this._colorTextures.push(device.createTexture(new TextureInfo(\n                    TextureType.TEX2D,\n                    TextureUsageBit.COLOR_ATTACHMENT | TextureUsageBit.SAMPLED | TextureUsageBit.TRANSFER_SRC,\n                    info.renderPassInfo.colorAttachments[i].format,\n                    this._width,\n                    this._height,\n                )));\n            }\n            if (info.renderPassInfo.depthStencilAttachment.format !== Format.UNKNOWN) {\n                this._depthStencilTexture = device.createTexture(new TextureInfo(\n                    TextureType.TEX2D,\n                    TextureUsageBit.DEPTH_STENCIL_ATTACHMENT | TextureUsageBit.SAMPLED,\n                    info.renderPassInfo.depthStencilAttachment.format,\n                    this._width,\n                    this._height,\n                ));\n                this._hasOffScreenAttachments = true;\n            }\n        }\n        this._framebuffer = device.createFramebuffer(new FramebufferInfo(\n            this._renderPass,\n            this._colorTextures,\n            this._depthStencilTexture,\n        ));\n\n        return true;\n    }\n\n    public destroy () {\n        this.clearCameras();\n\n        if (this._framebuffer) {\n            this._framebuffer.destroy();\n            this._framebuffer = null;\n        }\n\n        if (this._depthStencilTexture) {\n            this._depthStencilTexture.destroy();\n            this._depthStencilTexture = null;\n        }\n\n        for (let i = 0; i < this._colorTextures.length; i++) {\n            const colorTexture = this._colorTextures[i];\n            if (colorTexture) {\n                colorTexture.destroy();\n            }\n        }\n        this._colorTextures.length = 0;\n        this._device = null;\n    }\n\n    /**\n     * @en Resize window.\n     * @zh 重置窗口大小。\n     * @param width The new width.\n     * @param height The new height.\n     */\n    public resize (width: number, height: number) {\n        if (this._swapchain) {\n            this._swapchain.resize(width, height, orientationMap[screenAdapter.orientation]);\n            this._width = this._swapchain.width;\n            this._height = this._swapchain.height;\n        } else {\n            for (let i = 0; i < this._colorTextures.length; i++) {\n                this._colorTextures[i].resize(width, height);\n            }\n            if (this._depthStencilTexture) {\n                this._depthStencilTexture.resize(width, height);\n            }\n            this._width = width;\n            this._height = height;\n        }\n\n        if (this.framebuffer) {\n            this.framebuffer.destroy();\n            this._framebuffer = this._device!.createFramebuffer(new FramebufferInfo(\n                this._renderPass!,\n                this._colorTextures,\n                this._depthStencilTexture,\n            ));\n        }\n\n        for (const camera of this._cameras) {\n            camera.resize(width, height);\n        }\n    }\n\n    /**\n     * @en Extract all render cameras attached to the render window to the output cameras list\n     * @zh 将所有挂载到当前渲染窗口的摄像机存储到输出列表参数中\n     * @param cameras @en The output cameras list, should be empty before invoke this function\n     *                @zh 输出相机列表参数，传入时应该为空\n     */\n    public extractRenderCameras (cameras: Camera[]) {\n        for (let j = 0; j < this._cameras.length; j++) {\n            const camera = this._cameras[j];\n            if (camera.enabled) {\n                camera.update();\n                cameras.push(camera);\n            }\n        }\n    }\n\n    /**\n     * @en Attach a new camera to the render window\n     * @zh 添加渲染相机\n     * @param camera @en The camera to attach @zh 要挂载的相机\n     */\n    public attachCamera (camera: Camera) {\n        for (let i = 0; i < this._cameras.length; i++) {\n            if (this._cameras[i] === camera) {\n                return;\n            }\n        }\n        this._cameras.push(camera);\n        this.sortCameras();\n    }\n\n    /**\n     * @en Detach a camera from the render window\n     * @zh 移除场景中的渲染相机\n     * @param camera @en The camera to detach @zh 要移除的相机\n     */\n    public detachCamera (camera: Camera) {\n        for (let i = 0; i < this._cameras.length; ++i) {\n            if (this._cameras[i] === camera) {\n                this._cameras.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Clear all attached cameras\n     * @zh 清空全部渲染相机\n     */\n    public clearCameras () {\n        this._cameras.length = 0;\n    }\n\n    /**\n     * @en Sort all attached cameras with priority\n     * @zh 按照优先级对所有挂载的相机排序\n     */\n    public sortCameras () {\n        this._cameras.sort((a: Camera, b: Camera) => a.priority - b.priority);\n    }\n}\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { DEV, HTML5, TEST } from 'internal:constants';\nimport { Pool } from './memop';\nimport { RenderPipeline, createDefaultPipeline, DeferredPipeline } from './pipeline';\nimport { DebugView } from './pipeline/debug-view';\nimport { Camera, Light, Model } from './renderer/scene';\nimport type { DataPoolManager } from '../3d/skeletal-animation/data-pool-manager';\nimport { LightType } from './renderer/scene/light';\nimport { IRenderSceneInfo, RenderScene } from './renderer/core/render-scene';\nimport { DirectionalLight } from './renderer/scene/directional-light';\nimport { SphereLight } from './renderer/scene/sphere-light';\nimport { SpotLight } from './renderer/scene/spot-light';\nimport { legacyCC } from './global-exports';\nimport { RenderWindow, IRenderWindowInfo } from './renderer/core/render-window';\nimport { ColorAttachment, DepthStencilAttachment, RenderPassInfo, StoreOp, Device, Swapchain, Feature, deviceManager } from './gfx';\nimport { warn, warnID } from './platform/debug';\nimport { Pipeline, PipelineRuntime } from './pipeline/custom/pipeline';\nimport { Batcher2D } from '../2d/renderer/batcher-2d';\nimport { IPipelineEvent } from './pipeline/pipeline-event';\nimport { settings, Settings } from './settings';\nimport { localDescriptorSetLayout_ResizeMaxJoints } from './pipeline/define';\nimport { macro } from './platform/macro';\n\n/**\n * @en Initialization information for the Root\n * @zh Root 初始化描述信息\n */\nexport interface IRootInfo {\n    enableHDR?: boolean;\n}\n\n/**\n * @en Creation information for the Root\n * @zh 场景创建描述信息\n */\nexport interface ISceneInfo {\n    name: string;\n}\n\n/**\n * @en The root manager of the renderer which manages all device resources and the render pipeline.\n * @zh 基础渲染器管理类，管理所有设备相关的资源创建以及渲染管线。\n */\nexport class Root {\n    /**\n     * @en The GFX device\n     * @zh GFX 设备\n     */\n    public get device (): Device {\n        return this._device;\n    }\n\n    /**\n     * @en The main window\n     * @zh 主窗口\n     */\n    public get mainWindow (): RenderWindow | null {\n        return this._mainWindow;\n    }\n\n    /**\n     * @en The current active window\n     * @zh 当前激活的窗口\n     */\n    public set curWindow (window: RenderWindow | null) {\n        this._curWindow = window;\n    }\n\n    public get curWindow (): RenderWindow | null {\n        return this._curWindow;\n    }\n\n    /**\n     * @e The temporary window for data transmission\n     * @zh 临时窗口（用于数据传输）\n     * @internal\n     */\n    public set tempWindow (window: RenderWindow | null) {\n        this._tempWindow = window;\n    }\n\n    public get tempWindow (): RenderWindow | null {\n        return this._tempWindow;\n    }\n\n    /**\n     * @en The windows list\n     * @zh 窗口列表\n     */\n    public get windows (): RenderWindow[] {\n        return this._windows;\n    }\n\n    /**\n     * @zh\n     * 启用自定义渲染管线\n     */\n    public get usesCustomPipeline (): boolean {\n        return this._usesCustomPipeline && macro.CUSTOM_PIPELINE_NAME !== '';\n    }\n\n    /**\n     * @en The render pipeline\n     * @zh 渲染管线\n     */\n    public get pipeline (): PipelineRuntime {\n        return this._pipeline!;\n    }\n\n    /**\n     * @en The custom render pipeline\n     * @zh 自定义渲染管线\n     */\n    public get customPipeline (): Pipeline {\n        return this._customPipeline!;\n    }\n\n    /**\n     * @en The pipeline events\n     * @zh 渲染管线事件\n     */\n    public get pipelineEvent (): IPipelineEvent {\n        return this._pipelineEvent!;\n    }\n\n    /**\n     * @en The draw batch manager for 2D UI, for engine internal usage, user do not need to use this.\n     * @zh 2D UI 渲染合批管理器，引擎内部使用，用户无需使用此接口\n     */\n    public get batcher2D (): Batcher2D {\n        return this._batcher as Batcher2D;\n    }\n\n    /**\n     * @en Render scenes list\n     * @zh 渲染场景列表\n     */\n    public get scenes (): RenderScene[] {\n        return this._scenes;\n    }\n\n    /**\n     * @en The debug view manager for rendering\n     * @zh 渲染调试管理器\n     */\n    public get debugView (): DebugView {\n        return this._debugView;\n    }\n\n    /**\n     * @en The time cumulated in seconds since the game began running.\n     * @zh 累计时间（秒）。\n     */\n    public get cumulativeTime (): number {\n        return this._cumulativeTime;\n    }\n\n    /**\n     * @en The current frame time in seconds.\n     * @zh 帧时间（秒）。\n     */\n    public get frameTime (): number {\n        return this._frameTime;\n    }\n\n    /**\n     * @en The frame count during the last second\n     * @zh 一秒内的累计帧数\n     */\n    public get frameCount (): number {\n        return this._frameCount;\n    }\n\n    /**\n     * @en The recent frame rate for the last second\n     * @zh 当前每秒帧率\n     */\n    public get fps (): number {\n        return this._fps;\n    }\n\n    /**\n     * @en The wanted frame rate set by user\n     * @zh 每秒设定帧率\n     */\n    public set fixedFPS (fps: number) {\n        if (fps > 0) {\n            this._fixedFPS = fps;\n            this._fixedFPSFrameTime = 1000.0 / fps;\n        } else {\n            this._fixedFPSFrameTime = 0;\n        }\n    }\n\n    public get fixedFPS (): number {\n        return this._fixedFPS;\n    }\n\n    /**\n     * @internal\n     */\n    public get dataPoolManager () {\n        return this._dataPoolMgr;\n    }\n\n    /**\n     * @en Whether the built-in deferred pipeline is used.\n     * @zh 是否启用内置延迟渲染管线\n     */\n    public get useDeferredPipeline () : boolean {\n        return this._useDeferredPipeline;\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _createSceneFun: (root: Root) => RenderScene = null!;\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _createWindowFun: (root: Root) => RenderWindow = null!;\n\n    private _device: Device;\n    private _windows: RenderWindow[] = [];\n    private _mainWindow: RenderWindow | null = null;\n    private _curWindow: RenderWindow | null = null;\n    private _tempWindow: RenderWindow | null = null;\n    private _usesCustomPipeline = true;\n    private _pipeline: PipelineRuntime | null = null;\n    private _pipelineEvent: IPipelineEvent | null = null;\n    private _classicPipeline: RenderPipeline | null = null;\n    private _customPipeline: Pipeline | null = null;\n    private _batcher: Batcher2D | null = null;\n    private _dataPoolMgr: DataPoolManager;\n    private _scenes: RenderScene[] = [];\n    private _modelPools = new Map<Constructor<Model>, Pool<Model>>();\n    private _cameraPool: Pool<Camera> | null = null;\n    private _lightPools = new Map<Constructor<Light>, Pool<Light>>();\n    private _debugView = new DebugView();\n    private _fpsTime = 0;\n    private _frameCount = 0;\n    private _fps = 0;\n    private _fixedFPS = 0;\n    private _useDeferredPipeline = false;\n    private _fixedFPSFrameTime = 0;\n    private _cumulativeTime = 0;\n    private _frameTime = 0;\n    private declare _naitveObj: any;\n\n    /**\n     * @en The constructor of the root, user shouldn't create the root instance, it's managed by the [[Director]].\n     * @zh 构造函数，用户不应该自己创建任何 Root 对象，它是由 [[Director]] 管理的。\n     * @param device GFX device\n     */\n    constructor (device: Device) {\n        this._device = device;\n        this._dataPoolMgr = legacyCC.internal.DataPoolManager && new legacyCC.internal.DataPoolManager(device) as DataPoolManager;\n\n        RenderScene.registerCreateFunc(this);\n        RenderWindow.registerCreateFunc(this);\n\n        this._cameraPool = new Pool(() => new Camera(this._device), 4, (cam) => cam.destroy());\n    }\n\n    /**\n     * @en The initialization function, user shouldn't initialize the root, it's managed by the [[Director]].\n     * @zh 初始化函数，用户不应该自己初始化 Root，它是由 [[Director]] 管理的。\n     * @param info Root initialization information\n     */\n    public initialize (info: IRootInfo) {\n        const swapchain: Swapchain = deviceManager.swapchain;\n        const colorAttachment = new ColorAttachment();\n        colorAttachment.format = swapchain.colorTexture.format;\n        const depthStencilAttachment = new DepthStencilAttachment();\n        depthStencilAttachment.format = swapchain.depthStencilTexture.format;\n        depthStencilAttachment.depthStoreOp = StoreOp.DISCARD;\n        depthStencilAttachment.stencilStoreOp = StoreOp.DISCARD;\n        const renderPassInfo = new RenderPassInfo([colorAttachment], depthStencilAttachment);\n\n        this._mainWindow = this.createWindow({\n            title: 'rootMainWindow',\n            width: swapchain.width,\n            height: swapchain.height,\n            renderPassInfo,\n            swapchain,\n        });\n        this._curWindow = this._mainWindow;\n        const customJointTextureLayouts = settings.querySettings(Settings.Category.ANIMATION, 'customJointTextureLayouts') || [];\n        this._dataPoolMgr?.jointTexturePool.registerCustomTextureLayouts(customJointTextureLayouts);\n        this._resizeMaxJointForDS();\n    }\n\n    /**\n     * @en Destroy the root, user shouldn't invoke this function, it will cause undefined behavior.\n     * @zh 销毁 Root，用户不应该调用此方法，会造成未知行为。\n     */\n    public destroy () {\n        this.destroyScenes();\n\n        if (this._pipeline) {\n            this._pipeline.destroy();\n            this._pipeline = null;\n            this._pipelineEvent = null;\n        }\n\n        if (this._batcher) {\n            this._batcher.destroy();\n            this._batcher = null;\n        }\n\n        this._curWindow = null;\n        this._mainWindow = null;\n        this.dataPoolManager.clear();\n    }\n\n    /**\n     * @en Resize the on-screen render windows.\n     * @zh 重置在屏窗口的大小。\n     * @param width The new width of the window.\n     * @param height The new height of the window.\n     */\n    public resize (width: number, height: number) {\n        for (const window of this._windows) {\n            if (window.swapchain) {\n                window.resize(width, height);\n            }\n        }\n    }\n\n    /**\n     * @en Setup the render pipeline\n     * @zh 设置渲染管线\n     * @param rppl The render pipeline\n     * @returns The setup is successful or not\n     */\n    public setRenderPipeline (rppl?: RenderPipeline): boolean {\n        //-----------------------------------------------\n        // prepare classic pipeline\n        //-----------------------------------------------\n        if (rppl instanceof DeferredPipeline) {\n            this._useDeferredPipeline = true;\n        }\n\n        let isCreateDefaultPipeline = false;\n        if (!rppl) {\n            rppl = createDefaultPipeline();\n            isCreateDefaultPipeline = true;\n        }\n\n        // now cluster just enabled in deferred pipeline\n        if (!this._useDeferredPipeline || !this.device.hasFeature(Feature.COMPUTE_SHADER)) {\n            // disable cluster\n            rppl.clusterEnabled = false;\n        }\n        rppl.bloomEnabled = false;\n\n        //-----------------------------------------------\n        // choose pipeline\n        //-----------------------------------------------\n        if (this.usesCustomPipeline && legacyCC.internal.createCustomPipeline) {\n            this._customPipeline = legacyCC.internal.createCustomPipeline();\n            isCreateDefaultPipeline = true;\n            this._pipeline = this._customPipeline!;\n        } else {\n            this._classicPipeline = rppl;\n            this._pipeline = this._classicPipeline;\n            this._pipelineEvent = this._classicPipeline;\n            this._usesCustomPipeline = false;\n        }\n\n        if (!this._pipeline.activate(this._mainWindow!.swapchain)) {\n            if (isCreateDefaultPipeline) {\n                this._pipeline.destroy();\n            }\n            this._classicPipeline = null;\n            this._customPipeline = null;\n            this._pipeline = null;\n            this._pipelineEvent = null;\n\n            return false;\n        }\n\n        //-----------------------------------------------\n        // pipeline initialization completed\n        //-----------------------------------------------\n        const scene = legacyCC.director.getScene();\n        if (scene) {\n            scene.globals.activate();\n        }\n\n        this.onGlobalPipelineStateChanged();\n        if (!this._batcher && legacyCC.internal.Batcher2D) {\n            this._batcher = new legacyCC.internal.Batcher2D(this);\n            if (!this._batcher!.initialize()) {\n                this.destroy();\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * @en Notify the pipeline and all scenes that the global pipeline state have been updated so that they can update their render data and states.\n     * @zh 通知渲染管线和所有场景全局管线状态已更新，需要更新自身状态。\n     */\n    public onGlobalPipelineStateChanged () {\n        for (let i = 0; i < this._scenes.length; i++) {\n            this._scenes[i].onGlobalPipelineStateChanged();\n        }\n\n        this._pipeline!.onGlobalPipelineStateChanged();\n    }\n\n    /**\n     * @en Active the render window as the [[curWindow]]\n     * @zh 激活指定窗口为当前窗口 [[curWindow]]\n     * @param window The render window to be activated\n     */\n    public activeWindow (window: RenderWindow) {\n        this._curWindow = window;\n    }\n\n    /**\n     * @en Reset the time cumulated\n     * @zh 重置累计时间\n     */\n    public resetCumulativeTime () {\n        this._cumulativeTime = 0;\n    }\n\n    /**\n     * @en The entry function of the render process for every frame.\n     * @zh 用于每帧执行渲染流程的入口函数\n     * @param deltaTime @en The delta time since last update. @zh 距离上一帧间隔时间\n     */\n    public frameMove (deltaTime: number) {\n        this._frameTime = deltaTime;\n\n        /*\n        if (this._fixedFPSFrameTime > 0) {\n\n            const elapsed = this._frameTime * 1000.0;\n            if (this._fixedFPSFrameTime > elapsed) {\n\n                setTimeout(function () {}, this._fixedFPSFrameTime - elapsed);\n            }\n        }\n        */\n\n        ++this._frameCount;\n        this._cumulativeTime += deltaTime;\n        this._fpsTime += deltaTime;\n        if (this._fpsTime > 1.0) {\n            this._fps = this._frameCount;\n            this._frameCount = 0;\n            this._fpsTime = 0.0;\n        }\n        for (let i = 0; i < this._scenes.length; ++i) {\n            this._scenes[i].removeBatches();\n        }\n\n        const windows = this._windows;\n        const cameraList: Camera[] = [];\n        for (let i = 0; i < windows.length; i++) {\n            const window = windows[i];\n            window.extractRenderCameras(cameraList);\n        }\n\n        if (this._pipeline && cameraList.length > 0) {\n            this._device.acquire([deviceManager.swapchain]);\n            const scenes = this._scenes;\n            const stamp = legacyCC.director.getTotalFrames();\n            if (this._batcher) {\n                this._batcher.update();\n                this._batcher.uploadBuffers();\n            }\n\n            for (let i = 0; i < scenes.length; i++) {\n                scenes[i].update(stamp);\n            }\n\n            legacyCC.director.emit(legacyCC.Director.EVENT_BEFORE_COMMIT);\n            cameraList.sort((a: Camera, b: Camera) => a.priority - b.priority);\n\n            for (let i = 0; i < cameraList.length; ++i) {\n                cameraList[i].geometryRenderer?.update();\n            }\n            this._pipeline.render(cameraList);\n            this._device.present();\n        }\n\n        if (this._batcher) this._batcher.reset();\n    }\n\n    /**\n     * @en Create a render window\n     * @zh 创建一个新的窗口\n     * @param info @en The window creation information @zh 窗口描述信息\n     */\n    public createWindow (info: IRenderWindowInfo): RenderWindow | null {\n        const window = this._createWindowFun(this);\n        window.initialize(this.device, info);\n        this._windows.push(window);\n        return window;\n    }\n\n    /**\n     * @en Destroy a render window\n     * @zh 销毁指定的窗口\n     * @param window The render window to be destroyed\n     */\n    public destroyWindow (window: RenderWindow) {\n        for (let i = 0; i < this._windows.length; ++i) {\n            if (this._windows[i] === window) {\n                window.destroy();\n                this._windows.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Destroy all render windows\n     * @zh 销毁全部窗口\n     */\n    public destroyWindows () {\n        for (const window of this._windows) {\n            window.destroy();\n        }\n        this._windows.length = 0;\n    }\n\n    /**\n     * @en Create a render scene\n     * @zh 创建渲染场景\n     * @param info @en The creation information for render scene @zh 渲染场景描述信息\n     */\n    public createScene (info: IRenderSceneInfo): RenderScene {\n        const scene: RenderScene = this._createSceneFun(this);\n        scene.initialize(info);\n        this._scenes.push(scene);\n        return scene;\n    }\n\n    /**\n     * @en Destroy the given render scene\n     * @zh 销毁指定的渲染场景\n     * @param scene @en The render scene to be destroyed. @zh 要销毁的渲染场景\n     */\n    public destroyScene (scene: RenderScene) {\n        for (let i = 0; i < this._scenes.length; ++i) {\n            if (this._scenes[i] === scene) {\n                scene.destroy();\n                this._scenes.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    /**\n     * @en Destroy all render scenes.\n     * @zh 销毁全部场景。\n     */\n    public destroyScenes () {\n        for (const scene of this._scenes) {\n            scene.destroy();\n        }\n        this._scenes.length = 0;\n    }\n\n    /**\n     * @en Create a model\n     * @zh 创建模型\n     * @param ModelCtor @en The class of the model @zh 模型的类\n     * @returns The model created\n     */\n    public createModel<T extends Model> (ModelCtor: typeof Model): T {\n        let p = this._modelPools.get(ModelCtor);\n        if (!p) {\n            this._modelPools.set(ModelCtor, new Pool(() => new ModelCtor(), 10, (obj) => obj.destroy()));\n            p = this._modelPools.get(ModelCtor)!;\n        }\n        const model = p.alloc() as T;\n        model.initialize();\n        return model;\n    }\n\n    /**\n     * @en Destroy the given model\n     * @zh 销毁指定的模型\n     * @param m @en The model to be destroyed @zh 要销毁的模型\n     */\n    public destroyModel (m: Model) {\n        const p = this._modelPools.get(m.constructor as Constructor<Model>);\n        if (p) {\n            p.free(m);\n            if (m.scene) {\n                m.scene.removeModel(m);\n            }\n        } else {\n            warnID(1300, m.constructor.name);\n        }\n        m.destroy();\n    }\n\n    /**\n     * @en Create a camera\n     * @zh 创建一个相机\n     * @returns The camera created.\n     */\n    public createCamera (): Camera {\n        return this._cameraPool!.alloc();\n    }\n\n    /**\n     * @en Create a light source\n     * @zh 创建光源\n     * @param LightCtor @en The class of the light @zh 光源的类\n     * @returns The light created\n     */\n    public createLight<T extends Light> (LightCtor: new () => T): T {\n        let l = this._lightPools.get(LightCtor);\n        if (!l) {\n            this._lightPools.set(LightCtor, new Pool<Light>(() => new LightCtor(), 4, (obj) => obj.destroy()));\n            l = this._lightPools.get(LightCtor)!;\n        }\n        const light = l.alloc() as T;\n        light.initialize();\n        return light;\n    }\n\n    /**\n     * @en Destroy the given light\n     * @zh 销毁指定的光源\n     * @param l @en The light to be destroyed @zh 要销毁的光源\n     */\n    public destroyLight (l: Light) {\n        if (l.scene) {\n            switch (l.type) {\n            case LightType.DIRECTIONAL:\n                l.scene.removeDirectionalLight(l as DirectionalLight);\n                break;\n            case LightType.SPHERE:\n                l.scene.removeSphereLight(l as SphereLight);\n                break;\n            case LightType.SPOT:\n                l.scene.removeSpotLight(l as SpotLight);\n                break;\n            default:\n                break;\n            }\n        }\n        l.destroy();\n    }\n\n    /**\n     * @en recycle the given light to light object pool\n     * @zh 回收指定的光源到对象池\n     * @param l @en The light to be recycled @zh 要回收的光源\n     */\n    public recycleLight (l: Light) {\n        const p = this._lightPools.get(l.constructor as Constructor<Light>);\n        if (p) {\n            p.free(l);\n            if (l.scene) {\n                switch (l.type) {\n                case LightType.DIRECTIONAL:\n                    l.scene.removeDirectionalLight(l as DirectionalLight);\n                    break;\n                case LightType.SPHERE:\n                    l.scene.removeSphereLight(l as SphereLight);\n                    break;\n                case LightType.SPOT:\n                    l.scene.removeSpotLight(l as SpotLight);\n                    break;\n                default:\n                    break;\n                }\n            }\n        }\n    }\n\n    private _resizeMaxJointForDS () {\n        let maxJoints = Math.floor((deviceManager.gfxDevice.capabilities.maxVertexUniformVectors - 38) / 3);\n        maxJoints = maxJoints < 256 ? maxJoints : 256;\n        localDescriptorSetLayout_ResizeMaxJoints(maxJoints);\n    }\n}\n\nlegacyCC.Root = Root;\n","import { assertIsTrue } from '../../cocos/core/data/utils/asserts';\n\nexport class Pacer {\n    private _rafHandle = 0;\n    private _stHandle = 0;\n    private _onTick: (() => void) | null = null;\n    private _targetFrameRate = 60;\n    private _frameTime = 0;\n    private _startTime = 0;\n    private _isPlaying = false;\n    private _rAF: typeof requestAnimationFrame;\n    private _cAF: typeof cancelAnimationFrame;\n    constructor () {\n        this._rAF = window.requestAnimationFrame\n        || window.webkitRequestAnimationFrame\n        || window.mozRequestAnimationFrame\n        || window.oRequestAnimationFrame\n        || window.msRequestAnimationFrame\n        || this._stTime.bind(this);\n        this._cAF = window.cancelAnimationFrame\n        || window.cancelRequestAnimationFrame\n        || window.msCancelRequestAnimationFrame\n        || window.mozCancelRequestAnimationFrame\n        || window.oCancelRequestAnimationFrame\n        || window.webkitCancelRequestAnimationFrame\n        || window.msCancelAnimationFrame\n        || window.mozCancelAnimationFrame\n        || window.webkitCancelAnimationFrame\n        || window.ocancelAnimationFrame\n        || this._ctTime.bind(this);\n    }\n\n    get targetFrameRate (): number {\n        return this._targetFrameRate;\n    }\n\n    set targetFrameRate (val: number) {\n        if (this._targetFrameRate !== val) {\n            assertIsTrue(val > 0);\n            this._targetFrameRate = val;\n            this._frameTime = 1000 / this._targetFrameRate;\n            if (this._isPlaying) {\n                this.stop();\n                this.start();\n            }\n        }\n    }\n\n    set onTick (val: (() => void) | null) {\n        this._onTick = val;\n    }\n\n    get onTick (): (() => void) | null {\n        return this._onTick;\n    }\n\n    start (): void {\n        if (this._isPlaying) return;\n        if (this._targetFrameRate === 60) {\n            const updateCallback = () => {\n                if (this._isPlaying) {\n                    this._rafHandle = this._rAF.call(window, updateCallback);\n                }\n                if (this._onTick) {\n                    this._onTick();\n                }\n            };\n            this._rafHandle = this._rAF.call(window, updateCallback);\n        } else {\n            const updateCallback = () => {\n                this._startTime = performance.now();\n                if (this._isPlaying) {\n                    this._stHandle = this._stTime(updateCallback);\n                }\n                if (this._onTick) {\n                    this._onTick();\n                }\n            };\n            this._startTime = performance.now();\n            this._stHandle = this._stTime(updateCallback);\n        }\n        this._isPlaying = true;\n    }\n\n    stop (): void {\n        if (!this._isPlaying) return;\n        this._cAF.call(window, this._rafHandle);\n        this._ctTime(this._stHandle);\n        this._rafHandle = this._stHandle = 0;\n        this._isPlaying = false;\n    }\n\n    private _stTime (callback: () => void) {\n        const currTime = performance.now();\n        const elapseTime = Math.max(0, (currTime - this._startTime));\n        const timeToCall = Math.max(0, this._frameTime - elapseTime);\n        const id = setTimeout(callback, timeToCall);\n        return id;\n    }\n\n    private _ctTime (id: number | undefined) {\n        clearTimeout(id);\n    }\n}\n","import { DEBUG } from 'internal:constants';\nimport { assert } from '../../core/platform/debug';\nimport { js } from '../../core/utils/js';\nimport { UIMeshRenderer } from '../components';\nimport { UIRenderer } from './ui-renderer';\n\nexport class UIRendererManager {\n    private _allRenderers: (UIRenderer | UIMeshRenderer)[] = [];\n    private _dirtyRenderers: (UIRenderer | UIMeshRenderer)[] = [];\n    private _dirtyVersion = 0;\n    public addRenderer (uiRenderer: UIRenderer | UIMeshRenderer) {\n        if (uiRenderer._internalId === -1) {\n            uiRenderer._internalId = this._allRenderers.length;\n            this._allRenderers.push(uiRenderer);\n        }\n    }\n\n    public removeRenderer (uiRenderer: UIRenderer | UIMeshRenderer) {\n        if (uiRenderer._internalId !== -1) {\n            if (DEBUG) {\n                assert(this._allRenderers[uiRenderer._internalId] === uiRenderer);\n            }\n            const id = uiRenderer._internalId;\n            this._allRenderers[this._allRenderers.length - 1]._internalId = id;\n            js.array.fastRemoveAt(this._allRenderers, id);\n            uiRenderer._internalId = -1;\n            if (uiRenderer._dirtyVersion === this._dirtyVersion) {\n                js.array.fastRemove(this._dirtyRenderers, uiRenderer);\n                uiRenderer._dirtyVersion = -1;\n            }\n        }\n    }\n\n    public markDirtyRenderer (uiRenderer: UIRenderer | UIMeshRenderer) {\n        if (uiRenderer._dirtyVersion !== this._dirtyVersion && uiRenderer._internalId !== -1) {\n            this._dirtyRenderers.push(uiRenderer);\n            uiRenderer._dirtyVersion = this._dirtyVersion;\n        }\n    }\n\n    public updateAllDirtyRenderers () {\n        const length = this._dirtyRenderers.length;\n        const dirtyRenderers = this._dirtyRenderers;\n        for (let i = 0; i < length; i++) {\n            if (DEBUG) {\n                assert(dirtyRenderers[i]._internalId !== -1);\n            }\n            dirtyRenderers[i].updateRenderer();\n        }\n        this._dirtyRenderers.length = 0;\n        this._dirtyVersion++;\n    }\n}\n\nexport const uiRendererManager = new UIRendererManager();\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/* spell-checker:words COORD, Quesada, INITED, Renerer */\n\nimport { DEBUG, EDITOR, BUILD, TEST } from 'internal:constants';\nimport { SceneAsset } from './assets/scene-asset';\nimport System from './components/system';\nimport { CCObject } from './data/object';\nimport { EventTarget } from './event';\nimport { input } from '../input';\nimport { Root } from './root';\nimport { Node, Scene } from './scene-graph';\nimport { ComponentScheduler } from './scene-graph/component-scheduler';\nimport NodeActivator from './scene-graph/node-activator';\nimport { Scheduler } from './scheduler';\nimport { js } from './utils/js';\nimport { legacyCC } from './global-exports';\nimport { errorID, error, assertID, warnID, debug } from './platform/debug';\nimport { containerManager } from './memop/container-manager';\nimport { uiRendererManager } from '../2d/framework/ui-renderer-manager';\nimport { deviceManager } from './gfx';\n\n// ----------------------------------------------------------------------------------------------------------------------\n\n/**\n * @en\n * ATTENTION: USE `director` INSTEAD OF `Director`.\n * `director` is a singleton object which manage your game's logic flow.\n * Since the `director` is a singleton, you don't need to call any constructor or create functions,\n * the standard way to use it is by calling:\n * `director.methodName();`\n * It creates and handle the main Window and manages how and when to execute the Scenes.\n *\n * @zh\n * 注意：用 `director` 代替 `Director`。\n * `director` 一个管理你的游戏的逻辑流程的单例对象。\n * 由于 `director` 是一个单例，你不需要调用任何构造函数或创建函数，\n * 使用它的标准方法是通过调用：\n * `director.methodName();`\n * 它创建和处理主窗口并且管理什么时候执行场景。\n */\nexport class Director extends EventTarget {\n    /**\n     * @en The event which will be triggered when the singleton of Director initialized.\n     * @zh Director 单例初始化时触发的事件\n     * @event Director.EVENT_INIT\n     */\n    /**\n     * @en The event which will be triggered when the singleton of Director initialized.\n     * @zh Director 单例初始化时触发的事件\n     */\n    public static readonly EVENT_INIT = 'director_init';\n\n    /**\n     * @en The event which will be triggered when the singleton of Director reset.\n     * @zh Director 单例重置时触发的事件\n     * @event Director.EVENT_RESET\n     */\n    /**\n     * @en The event which will be triggered when the singleton of Director reset.\n     * @zh Director 单例重置时触发的事件\n     */\n    public static readonly EVENT_RESET = 'director_reset';\n\n    /**\n     * @en The event which will be triggered before loading a new scene.\n     * @zh 加载新场景之前所触发的事件。\n     * @event Director.EVENT_BEFORE_SCENE_LOADING\n     * @param {String} sceneName - The loading scene name\n     */\n    /**\n     * @en The event which will be triggered before loading a new scene.\n     * @zh 加载新场景之前所触发的事件。\n     */\n    public static readonly EVENT_BEFORE_SCENE_LOADING = 'director_before_scene_loading';\n\n    /**\n     * @en The event which will be triggered before launching a new scene.\n     * @zh 运行新场景之前所触发的事件。\n     * @event Director.EVENT_BEFORE_SCENE_LAUNCH\n     * @param {String} sceneName - New scene which will be launched\n     */\n    /**\n     * @en The event which will be triggered before launching a new scene.\n     * @zh 运行新场景之前所触发的事件。\n     */\n    public static readonly EVENT_BEFORE_SCENE_LAUNCH = 'director_before_scene_launch';\n\n    /**\n     * @en The event which will be triggered after launching a new scene.\n     * @zh 运行新场景之后所触发的事件。\n     * @event Director.EVENT_AFTER_SCENE_LAUNCH\n     * @param {String} sceneName - New scene which is launched\n     */\n    /**\n     * @en The event which will be triggered after launching a new scene.\n     * @zh 运行新场景之后所触发的事件。\n     */\n    public static readonly EVENT_AFTER_SCENE_LAUNCH = 'director_after_scene_launch';\n\n    /**\n     * @en The event which will be triggered at the beginning of every frame.\n     * @zh 每个帧的开始时所触发的事件。\n     * @event Director.EVENT_BEFORE_UPDATE\n     */\n    /**\n     * @en The event which will be triggered at the beginning of every frame.\n     * @zh 每个帧的开始时所触发的事件。\n     */\n    public static readonly EVENT_BEFORE_UPDATE = 'director_before_update';\n\n    /**\n     * @en The event which will be triggered after engine and components update logic.\n     * @zh 将在引擎和组件 “update” 逻辑之后所触发的事件。\n     * @event Director.EVENT_AFTER_UPDATE\n     */\n    /**\n     * @en The event which will be triggered after engine and components update logic.\n     * @zh 将在引擎和组件 “update” 逻辑之后所触发的事件。\n     */\n    public static readonly EVENT_AFTER_UPDATE = 'director_after_update';\n\n    /**\n     * @en The event which will be triggered before the rendering process.\n     * @zh 渲染过程之前所触发的事件。\n     * @event Director.EVENT_BEFORE_DRAW\n     */\n    public static readonly EVENT_BEFORE_DRAW = 'director_before_draw';\n\n    /**\n     * @en The event which will be triggered after the rendering process.\n     * @zh 渲染过程之后所触发的事件。\n     * @event Director.EVENT_AFTER_DRAW\n     */\n    public static readonly EVENT_AFTER_DRAW = 'director_after_draw';\n\n    /**\n     * @en The event which will be triggered before the pipeline render commit.\n     * @zh 当前渲染帧提交前所触发的事件。\n     * @event Director.EVENT_BEFORE_COMMIT\n     */\n    public static readonly EVENT_BEFORE_COMMIT = 'director_before_commit';\n\n    /**\n     * @en The event which will be triggered before the physics process.<br/>\n     * @zh 物理过程之前所触发的事件。\n     * @event Director.EVENT_BEFORE_PHYSICS\n     */\n    public static readonly EVENT_BEFORE_PHYSICS = 'director_before_physics';\n\n    /**\n     * @en The event which will be triggered after the physics process.<br/>\n     * @zh 物理过程之后所触发的事件。\n     * @event Director.EVENT_AFTER_PHYSICS\n     */\n    public static readonly EVENT_AFTER_PHYSICS = 'director_after_physics';\n\n    /**\n     * @en The event which will be triggered at the frame begin.<br/>\n     * @zh 一帧开始时所触发的事件。\n     * @event Director.EVENT_BEGIN_FRAME\n     */\n    public static readonly EVENT_BEGIN_FRAME = 'director_begin_frame';\n\n    /**\n     * @en The event which will be triggered at the frame end.<br/>\n     * @zh 一帧结束之后所触发的事件。\n     * @event Director.EVENT_END_FRAME\n     */\n    public static readonly EVENT_END_FRAME = 'director_end_frame';\n\n    public static instance: Director;\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _compScheduler: ComponentScheduler;\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _nodeActivator: NodeActivator;\n    private _invalid: boolean;\n    private _paused: boolean;\n    private _root: Root | null;\n    private _loadingScene: string;\n    private _scene: Scene | null;\n    private _totalFrames: number;\n    private _scheduler: Scheduler;\n    private _systems: System[];\n    private _persistRootNodes = {};\n\n    constructor () {\n        super();\n\n        this._invalid = false;\n        // paused?\n        this._paused = false;\n\n        // root\n        this._root = null;\n\n        // scenes\n        this._loadingScene = '';\n        this._scene = null;\n\n        // FPS\n        this._totalFrames = 0;\n\n        // Scheduler for user registration update\n        this._scheduler = new Scheduler();\n        // Scheduler for life-cycle methods in component\n        this._compScheduler = new ComponentScheduler();\n        // Node activator\n        this._nodeActivator = new NodeActivator();\n\n        this._systems = [];\n    }\n\n    /**\n     * @en Calculates delta time since last time it was called, the result is saved to an internal property.\n     * @zh 计算从上一帧到现在的时间间隔，结果保存在私有属性中\n     * @deprecated since v3.3.0 no need to use it anymore\n     */\n    public calculateDeltaTime (now) {}\n\n    /**\n     * @en End the life of director in the next frame\n     * @zh 执行完当前帧后停止 director 的执行\n     */\n    public end () {\n        this.once(Director.EVENT_END_FRAME, () => {\n            this.purgeDirector();\n        });\n    }\n\n    /**\n     * @en Pause the director's ticker, only involve the game logic execution.<br>\n     * It won't pause the rendering process nor the event manager.<br>\n     * If you want to pause the entire game including rendering, audio and event,<br>\n     * please use `game.pause`.\n     * @zh 暂停正在运行的场景，该暂停只会停止游戏逻辑执行，但是不会停止渲染和 UI 响应。<br>\n     * 如果想要更彻底得暂停游戏，包含渲染，音频和事件，请使用 `game.pause` 。\n     */\n    public pause () {\n        if (this._paused) {\n            return;\n        }\n        this._paused = true;\n    }\n\n    /**\n     * @en Purge the `director` itself, including unschedule all schedule,<br>\n     * remove all event listeners, clean up and exit the running scene, stops all animations, clear cached data.\n     * @zh 清除 `director` 本身，包括停止所有的计时器，<br>\n     * 移除所有的事件监听器，清理并退出当前运行的场景，停止所有动画，清理缓存数据。\n     */\n    public purgeDirector () {\n        // cleanup scheduler\n        this._scheduler.unscheduleAll();\n        this._compScheduler.unscheduleAll();\n\n        this._nodeActivator.reset();\n\n        if (!EDITOR) {\n            if (legacyCC.isValid(this._scene)) {\n                this._scene!.destroy();\n            }\n            this._scene = null;\n        }\n\n        this.stopAnimation();\n\n        // Clear all caches\n        legacyCC.assetManager.releaseAll();\n    }\n\n    /**\n     * @en Reset the director, can be used to restart the director after purge\n     * @zh 重置此 Director，可用于在清除后重启 Director。\n     */\n    public reset () {\n        this.purgeDirector();\n\n        for (const id in this._persistRootNodes) {\n            this.removePersistRootNode(this._persistRootNodes[id]);\n        }\n\n        // Clear scene\n        this.getScene()?.destroy();\n\n        this.emit(Director.EVENT_RESET);\n\n        this.startAnimation();\n    }\n\n    /**\n     * @en\n     * Run a scene. Replaces the running scene with a new one or enter the first scene.<br>\n     * The new scene will be launched immediately.\n     * @zh 运行指定场景。将正在运行的场景替换为（或重入为）新场景。新场景将立即启动。\n     * @param scene - The need run scene.\n     * @param onBeforeLoadScene - The function invoked at the scene before loading.\n     * @param onLaunched - The function invoked at the scene after launch.\n     */\n    public runSceneImmediate (scene: Scene|SceneAsset, onBeforeLoadScene?: Director.OnBeforeLoadScene, onLaunched?: Director.OnSceneLaunched) {\n        if (scene instanceof SceneAsset) scene = scene.scene!;\n        assertID(scene instanceof Scene, 1216);\n\n        if (BUILD && DEBUG) {\n            console.time('InitScene');\n        }\n        // @ts-expect-error run private method\n        scene._load();  // ensure scene initialized\n        if (BUILD && DEBUG) {\n            console.timeEnd('InitScene');\n        }\n        // Re-attach or replace persist nodes\n        if (BUILD && DEBUG) {\n            console.time('AttachPersist');\n        }\n        const persistNodeList = Object.keys(this._persistRootNodes).map((x) => this._persistRootNodes[x] as Node);\n        for (let i = 0; i < persistNodeList.length; i++) {\n            const node = persistNodeList[i];\n            node.emit(Node.EventType.SCENE_CHANGED_FOR_PERSISTS, scene.renderScene);\n            const existNode = scene.uuid === node._originalSceneId && scene.getChildByUuid(node.uuid);\n            if (existNode) {\n                // scene also contains the persist node, select the old one\n                const index = existNode.getSiblingIndex();\n                // restore to the old saving flag\n                node.hideFlags &= ~CCObject.Flags.DontSave;\n                node.hideFlags |= CCObject.Flags.DontSave & existNode.hideFlags;\n                existNode._destroyImmediate();\n                scene.insertChild(node, index);\n            } else {\n                node.hideFlags |= CCObject.Flags.DontSave;\n                // @ts-expect-error insert to new scene\n                node.parent = scene;\n            }\n        }\n        if (BUILD && DEBUG) {\n            console.timeEnd('AttachPersist');\n        }\n        const oldScene = this._scene;\n\n        // unload scene\n        if (BUILD && DEBUG) {\n            console.time('Destroy');\n        }\n        if (legacyCC.isValid(oldScene)) {\n            oldScene!.destroy();\n        }\n        if (!EDITOR) {\n            // auto release assets\n            if (BUILD && DEBUG) {\n                console.time('AutoRelease');\n            }\n            legacyCC.assetManager._releaseManager._autoRelease(oldScene, scene, this._persistRootNodes);\n            if (BUILD && DEBUG) {\n                console.timeEnd('AutoRelease');\n            }\n        }\n\n        this._scene = null;\n\n        // purge destroyed nodes belongs to old scene\n        CCObject._deferredDestroy();\n        if (BUILD && DEBUG) { console.timeEnd('Destroy'); }\n\n        if (onBeforeLoadScene) {\n            onBeforeLoadScene();\n        }\n        this.emit(Director.EVENT_BEFORE_SCENE_LAUNCH, scene);\n\n        // Run an Entity Scene\n        this._scene = scene;\n\n        if (BUILD && DEBUG) {\n            console.time('Activate');\n        }\n        // @ts-expect-error run private method\n        scene._activate();\n        if (BUILD && DEBUG) {\n            console.timeEnd('Activate');\n        }\n        // start scene\n        if (this._root) {\n            this._root.resetCumulativeTime();\n        }\n        this.startAnimation();\n        if (onLaunched) {\n            onLaunched(null, scene);\n        }\n        this.emit(Director.EVENT_AFTER_SCENE_LAUNCH, scene);\n    }\n\n    /**\n     * @en\n     * Run a scene. Replaces the running scene with a new one or enter the first scene.<br>\n     * The new scene will be launched at the end of the current frame.<br>\n     * @zh 运行指定场景。\n     * @param scene - The need run scene.\n     * @param onBeforeLoadScene - The function invoked at the scene before loading.\n     * @param onLaunched - The function invoked at the scene after launch.\n     * @private\n     */\n    public runScene (scene: Scene | SceneAsset, onBeforeLoadScene?: Director.OnBeforeLoadScene, onLaunched?: Director.OnSceneLaunched) {\n        if (scene instanceof SceneAsset) scene = scene.scene!;\n        assertID(scene, 1205);\n        assertID(scene instanceof Scene, 1216);\n\n        // Delay run / replace scene to the end of the frame\n        this.once(Director.EVENT_END_FRAME, () => {\n            this.runSceneImmediate(scene, onBeforeLoadScene, onLaunched);\n        });\n    }\n\n    /**\n     * @en Loads the scene by its name.\n     * @zh 通过场景名称进行加载场景。\n     *\n     * @param sceneName - The name of the scene to load.\n     * @param onLaunched - callback, will be called after scene launched.\n     * @return if error, return false\n     */\n    public loadScene (sceneName: string, onLaunched?: Director.OnSceneLaunched, onUnloaded?: Director.OnUnload) {\n        if (this._loadingScene) {\n            warnID(1208, sceneName, this._loadingScene);\n            return false;\n        }\n        const bundle = legacyCC.assetManager.bundles.find((bundle) => !!bundle.getSceneInfo(sceneName));\n        if (bundle) {\n            this.emit(Director.EVENT_BEFORE_SCENE_LOADING, sceneName);\n            this._loadingScene = sceneName;\n            console.time(`LoadScene ${sceneName}`);\n            bundle.loadScene(sceneName, (err, scene) => {\n                console.timeEnd(`LoadScene ${sceneName}`);\n                this._loadingScene = '';\n                if (err) {\n                    error(err);\n                    if (onLaunched) {\n                        onLaunched(err);\n                    }\n                } else {\n                    this.runSceneImmediate(scene, onUnloaded, onLaunched);\n                }\n            });\n            return true;\n        } else {\n            errorID(1209, sceneName);\n            return false;\n        }\n    }\n\n    /**\n     * @en\n     * Pre-loads the scene asset to reduces loading time. You can call this method at any time you want.<br>\n     * After calling this method, you still need to launch the scene by `director.loadScene`.<br>\n     * It will be totally fine to call `director.loadScene` at any time even if the preloading is not<br>\n     * yet finished, the scene will be launched after loaded automatically.\n     * @zh 预加载场景资源，你可以在任何时候调用这个方法。\n     * 调用完后，你仍然需要通过 `director.loadScene` 来启动场景，因为这个方法不会执行场景加载操作。<br>\n     * 就算预加载还没完成，你也可以直接调用 `director.loadScene`，加载完成后场景就会启动。\n     * @param sceneName @en The name of the scene to load @zh 场景名称。\n     * @param onLoaded @en Callback to execute once the scene is loaded @zh 加载回调。\n     */\n    public preloadScene (sceneName: string, onLoaded?: Director.OnSceneLoaded): void;\n\n    /**\n     * @en\n     * Pre-loads the scene to reduces loading time. You can call this method at any time you want.<br>\n     * After calling this method, you still need to launch the scene by `director.loadScene`.<br>\n     * It will be totally fine to call `director.loadScene` at any time even if the preloading is not<br>\n     * yet finished, the scene will be launched after loaded automatically.\n     * @zh 预加载场景，你可以在任何时候调用这个方法。\n     * 调用完后，你仍然需要通过 `director.loadScene` 来启动场景，因为这个方法不会执行场景加载操作。<br>\n     * 就算预加载还没完成，你也可以直接调用 `director.loadScene`，加载完成后场景就会启动。\n     * @param sceneName @en The name of scene to load @zh 场景名称。\n     * @param onProgress @en Callback to execute when the load progression change.  @zh 加载进度回调。\n     * @param onLoaded @en Callback to execute once the scene is loaded @zh 加载回调。\n     */\n    public preloadScene (sceneName: string, onProgress: Director.OnLoadSceneProgress, onLoaded: Director.OnSceneLoaded): void;\n\n    public preloadScene (\n        sceneName: string,\n        onProgress?: Director.OnLoadSceneProgress | Director.OnSceneLoaded,\n        onLoaded?: Director.OnSceneLoaded,\n    ) {\n        const bundle = legacyCC.assetManager.bundles.find((bundle) => !!bundle.getSceneInfo(sceneName));\n        if (bundle) {\n            bundle.preloadScene(sceneName, null, onProgress, onLoaded);\n        } else {\n            const err = `Can not preload the scene \"${sceneName}\" because it is not in the build settings.`;\n            if (onLoaded) {\n                onLoaded(new Error(err));\n            }\n            error(`preloadScene: ${err}`);\n        }\n    }\n\n    /**\n     * @en Resume game logic execution after pause, if the current scene is not paused, nothing will happen.\n     * @zh 恢复暂停场景的游戏逻辑，如果当前场景没有暂停将没任何事情发生。\n     */\n    public resume () {\n        if (!this._paused) {\n            return;\n        }\n        this._paused = false;\n    }\n\n    get root () {\n        return this._root;\n    }\n\n    /**\n     * @en Returns current logic Scene.\n     * @zh 获取当前逻辑场景。\n     * @example\n     * ```\n     * import { director } from 'cc';\n     * // This will help you to get the Canvas node in scene\n     * director.getScene().getChildByName('Canvas');\n     * ```\n     */\n    public getScene (): Scene | null {\n        return this._scene;\n    }\n\n    /**\n     * @en Returns the delta time since last frame.\n     * @zh 获取上一帧的增量时间。\n     * @deprecated since v3.3.0, please use game.deltaTime instead\n     */\n    public getDeltaTime () {\n        return legacyCC.game.deltaTime as number;\n    }\n\n    /**\n     * @en Returns the total passed time since game start, unit: ms\n     * @zh 获取从游戏开始到现在总共经过的时间，单位为 ms\n     * @deprecated since v3.3.0, please use game.totalTime instead\n     */\n    public getTotalTime () {\n        return legacyCC.game.totalTime as number;\n    }\n\n    /**\n     * @en Returns the current time.\n     * @zh 获取当前帧的时间。\n     * @deprecated since v3.3.0, please use game.frameStartTime instead\n     */\n    public getCurrentTime () {\n        return legacyCC.game.frameStartTime as number;\n    }\n\n    /**\n     * @en Returns how many frames were called since the director started.\n     * @zh 获取 director 启动以来游戏运行的总帧数。\n     */\n    public getTotalFrames () {\n        return this._totalFrames;\n    }\n\n    /**\n     * @en Returns whether or not the Director is paused.\n     * @zh 是否处于暂停状态。\n     */\n    public isPaused () {\n        return this._paused;\n    }\n\n    /**\n     * @en Returns the scheduler associated with this director.\n     * @zh 获取和 director 相关联的调度器。\n     */\n    public getScheduler () {\n        return this._scheduler;\n    }\n\n    /**\n     * @en Sets the scheduler associated with this director.\n     * @zh 设置和 director 相关联的调度器。\n     */\n    public setScheduler (scheduler: Scheduler) {\n        if (this._scheduler !== scheduler) {\n            this.unregisterSystem(this._scheduler);\n            this._scheduler = scheduler;\n            this.registerSystem(Scheduler.ID, scheduler, 200);\n        }\n    }\n\n    /**\n     * @en Register a system.\n     * @zh 注册一个系统。\n     */\n    public registerSystem (name: string, sys: System, priority: number) {\n        sys.id = name;\n        sys.priority = priority;\n        this._systems.push(sys);\n        this._systems.sort(System.sortByPriority);\n    }\n\n    public unregisterSystem (sys: System) {\n        js.array.fastRemove(this._systems, sys);\n        this._systems.sort(System.sortByPriority);\n    }\n\n    /**\n     * @en get a system.\n     * @zh 获取一个 system。\n     */\n    public getSystem (name: string) {\n        return this._systems.find((sys) => sys.id === name);\n    }\n\n    /**\n     * @en Returns the `AnimationManager` associated with this director. Please use getSystem(AnimationManager.ID)\n     * @zh 获取和 director 相关联的 `AnimationManager`（动画管理器）。请使用 getSystem(AnimationManager.ID) 来替代\n     * @deprecated since 3.0.0\n     */\n    public getAnimationManager (): any {\n        return this.getSystem(legacyCC.AnimationManager.ID);\n    }\n\n    // Loop management\n    /**\n     * @en Starts the director\n     * @zh 开始执行游戏逻辑\n     */\n    public startAnimation () {\n        this._invalid = false;\n    }\n\n    /**\n     * @en Stops the director\n     * @zh 停止执行游戏逻辑，每帧渲染会继续执行\n     */\n    public stopAnimation () {\n        this._invalid = true;\n    }\n\n    /**\n     * @en Run main loop of director\n     * @zh 运行主循环\n     * @deprecated Since v3.6, please use [tick] instead\n     */\n    public mainLoop (now: number) {\n        let dt;\n        if (EDITOR && !legacyCC.GAME_VIEW || TEST) {\n            dt = now;\n        } else {\n            dt = legacyCC.game._calculateDT(now);\n        }\n        this.tick(dt);\n    }\n\n    /**\n     * @en Run main loop of director\n     * @zh 运行主循环\n     * @param dt Delta time in seconds\n     */\n    public tick (dt: number) {\n        if (!this._invalid) {\n            this.emit(Director.EVENT_BEGIN_FRAME);\n            if (!EDITOR || legacyCC.GAME_VIEW) {\n                // @ts-expect-error _frameDispatchEvents is a private method.\n                input._frameDispatchEvents();\n            }\n            // Update\n            if (!this._paused) {\n                this.emit(Director.EVENT_BEFORE_UPDATE);\n                // Call start for new added components\n                this._compScheduler.startPhase();\n                // Update for components\n                this._compScheduler.updatePhase(dt);\n                // Update systems\n                for (let i = 0; i < this._systems.length; ++i) {\n                    this._systems[i].update(dt);\n                }\n                // Late update for components\n                this._compScheduler.lateUpdatePhase(dt);\n                // User can use this event to do things after update\n                this.emit(Director.EVENT_AFTER_UPDATE);\n                // Destroy entities that have been removed recently\n                CCObject._deferredDestroy();\n\n                // Post update systems\n                for (let i = 0; i < this._systems.length; ++i) {\n                    this._systems[i].postUpdate(dt);\n                }\n            }\n\n            this.emit(Director.EVENT_BEFORE_DRAW);\n            uiRendererManager.updateAllDirtyRenderers();\n            this._root!.frameMove(dt);\n            this.emit(Director.EVENT_AFTER_DRAW);\n\n            Node.resetHasChangedFlags();\n            Node.clearNodeArray();\n            containerManager.update(dt);\n            this.emit(Director.EVENT_END_FRAME);\n            this._totalFrames++;\n        }\n    }\n\n    /**\n     * @internal\n     */\n    public init () {\n        this._totalFrames = 0;\n        this._paused = false;\n        // Scheduler\n        // TODO: have a solid organization of priority and expose to user\n        this.registerSystem(Scheduler.ID, this._scheduler, 200);\n        this._root = new Root(deviceManager.gfxDevice);\n        const rootInfo = {};\n        this._root.initialize(rootInfo);\n        for (let i = 0; i < this._systems.length; i++) {\n            this._systems[i].init();\n        }\n        this.emit(Director.EVENT_INIT);\n    }\n\n    //  @ Persist root node section\n    /**\n     * @en\n     * Add a persistent root node to the game, the persistent node won't be destroyed during scene transition.<br>\n     * The target node must be placed in the root level of hierarchy, otherwise this API won't have any effect.\n     * @zh\n     * 声明常驻根节点，该节点不会在场景切换中被销毁。<br>\n     * 目标节点必须位于为层级的根节点，否则无效。\n     * @param node - The node to be made persistent\n     */\n    public addPersistRootNode (node: Node) {\n        if (!legacyCC.Node.isNode(node) || !node.uuid) {\n            warnID(3800);\n            return;\n        }\n        const id = node.uuid;\n        if (!this._persistRootNodes[id]) {\n            const scene = this._scene as any;\n            if (legacyCC.isValid(scene)) {\n                if (!node.parent) {\n                    node.parent = scene;\n                    node._originalSceneId = scene.uuid;\n                } else if (!(node.parent instanceof Scene)) {\n                    warnID(3801);\n                    return;\n                } else if (node.parent !== scene) {\n                    warnID(3802);\n                    return;\n                } else {\n                    node._originalSceneId = scene.uuid;\n                }\n            }\n            this._persistRootNodes[id] = node;\n            node._persistNode = true;\n            legacyCC.assetManager._releaseManager._addPersistNodeRef(node);\n        }\n    }\n\n    /**\n     * @en Remove a persistent root node.\n     * @zh 取消常驻根节点。\n     * @param node - The node to be removed from persistent node list\n     */\n    public removePersistRootNode (node: Node) {\n        const id = node.uuid || '';\n        if (node === this._persistRootNodes[id]) {\n            delete this._persistRootNodes[id];\n            node._persistNode = false;\n            node._originalSceneId = '';\n            legacyCC.assetManager._releaseManager._removePersistNodeRef(node);\n        }\n    }\n\n    /**\n     * @en Check whether the node is a persistent root node.\n     * @zh 检查节点是否是常驻根节点。\n     * @param node - The node to be checked\n     */\n    public isPersistRootNode (node: Node): boolean {\n        return !!node._persistNode;\n    }\n}\n\nexport declare namespace Director {\n    export type OnBeforeLoadScene = () => void;\n\n    export type OnUnload = () => void;\n\n    export type OnSceneLoaded = (error: null | Error, sceneAsset?: SceneAsset) => void;\n\n    export type OnSceneLaunched = (error: null | Error, scene?: Scene) => void;\n\n    /**\n     * @param completedCount - The number of the items that are already completed.\n     * @param totalCount - The total number of the items.\n     * @param item - The latest item which flow out the pipeline.\n     */\n    export type OnLoadSceneProgress = (completedCount: number, totalCount: number, item: any) => void;\n}\n\nlegacyCC.Director = Director;\n\n/**\n * @en Director of the game, used to control game update loop and scene management\n * @zh 游戏的导演，用于控制游戏更新循环与场景管理。\n */\nexport const director: Director = Director.instance = legacyCC.director = new Director();\n","/*\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n  worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n  not use Cocos Creator software for developing other software or tools that's\n  used for developing games. You are not granted to publish, distribute,\n  sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { BUILD, DEBUG, EDITOR, HTML5, JSB, NATIVE, PREVIEW, RUNTIME_BASED, TEST, WEBGPU } from 'internal:constants';\nimport { systemInfo } from 'pal/system-info';\nimport { findCanvas, loadJsFile } from 'pal/env';\nimport { Pacer } from 'pal/pacer';\nimport { ConfigOrientation } from 'pal/screen-adapter';\nimport assetManager, { IAssetManagerOptions } from './asset-manager/asset-manager';\nimport { EventTarget } from './event';\nimport { AsyncDelegate } from './event/async-delegate';\nimport { input } from '../input';\nimport * as debug from './platform/debug';\nimport { deviceManager } from './gfx';\nimport { sys } from './platform/sys';\nimport { macro } from './platform/macro';\nimport { legacyCC, VERSION } from './global-exports';\nimport { SplashScreen } from './splash-screen';\nimport { RenderPipeline } from './pipeline/render-pipeline';\nimport { Layers, Node } from './scene-graph';\nimport { garbageCollectionManager } from './data/garbage-collection';\nimport { screen } from './platform/screen';\nimport { builtinResMgr } from './builtin/builtin-res-mgr';\nimport { Settings, settings } from './settings';\nimport { Director, director } from './director';\nimport { bindingMappingInfo } from './pipeline/define';\nimport { assert } from './platform/debug';\nimport { IBundleOptions } from './asset-manager/shared';\nimport { ICustomJointTextureLayout } from '../3d/skeletal-animation/skeletal-animation-utils';\nimport { IPhysicsConfig } from '../physics/framework/physics-config';\n\n/**\n * @zh\n * 游戏配置。\n * @en\n * Game configuration.\n */\nexport interface IGameConfig {\n    /**\n     * @zh\n     * 引擎配置文件路径\n     * @en\n     * The path of settings.json\n     */\n    settingsPath?: string;\n\n    /**\n     * @zh\n     * 设置 debug 模式，在浏览器中这个选项会被忽略。\n     * @en\n     * Set debug mode, only valid in non-browser environment.\n     */\n    debugMode?: debug.DebugMode;\n\n    /**\n     * @zh\n     * 覆盖 settings 模块中的配置项, 用于控制引擎的启动和初始化，你可以在 game.init 中传入参数，也可以在 [game.onPostBaseInitDelegate] 事件回调中覆盖。\n     * 需要注意的是你需要在 application.js 模板中指定此选项和监听此事件。\n     * @en\n     * Overrides the settings module's some configuration, which is used to control the startup and initialization of the engine.\n     * You can pass in parameters in game.init or override them in the [game.onPostBaseInitDelegate] event callback.\n     * Note: you need to specify this option in the application.js template or add a delegate callback.\n     */\n    overrideSettings: Partial<{ [k in Settings.Category[keyof Settings.Category]]: Record<string, any> }>\n\n    /**\n     * @zh\n     * 当 showFPS 为 true 的时候界面的左下角将显示 fps 的信息，否则被隐藏。\n     * @en\n     * Left bottom corner fps information will show when \"showFPS\" equals true, otherwise it will be hide.\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.PROFILING: { \"showFPS\": true }}``` to set this.\n     */\n    showFPS?: boolean;\n\n    /**\n     * @zh\n     * 设置想要的帧率你的游戏，但真正的FPS取决于你的游戏实现和运行环境。\n     * @en\n     * Set the wanted frame rate for your game, but the real fps depends on your game implementation and the running environment.\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.SCREEN: { \"frameRate\": 60 }}``` to set this.\n     */\n    frameRate?: number;\n\n    /**\n     * @zh\n     * 渲染模式。\n     * 设置渲染器类型，仅适用于 web 端：\n     * - 0 - 通过引擎自动选择。\n     * - 1 - 强制使用 canvas 渲染。\n     * - 2 - 强制使用 WebGL 渲染，但是在部分 Android 浏览器中这个选项会被忽略。\n     * - 3 - 使用空渲染器，可以用于测试和服务器端环境，目前暂时用于 Cocos 内部测试使用\n     * @en\n     * Sets the renderer type, only useful on web:\n     * - 0 - Automatically chosen by engine.\n     * - 1 - Forced to use canvas renderer.\n     * - 2 - Forced to use WebGL renderer, but this will be ignored on mobile browsers.\n     * - 3 - Use Headless Renderer, which is useful in test or server env, only for internal use by cocos team for now\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.RENDERING: { \"renderMode\": 0 }}``` to set this.\n     */\n    renderMode?: 0 | 1 | 2 | 3;\n\n    /**\n     * @en\n     * Render pipeline resources\n     * @zh\n     * Render pipeline 资源\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.RENDERING: { \"renderPipeline\": '' }}``` to set this.\n     */\n    renderPipeline?: string;\n\n    /**\n     * @en\n     * Asset Manager initialization options\n     * @zh\n     * 资源管理器初始化设置\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.ASSETS: {}}``` to set this.\n     */\n    assetOptions?: IAssetManagerOptions;\n\n    /**\n     * @en\n     * GPU instancing options\n     * @zh\n     * GPU instancing 选项\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.ANIMATION: { customJointTextureLayouts: [] }}``` to set this.\n     */\n    customJointTextureLayouts?: ICustomJointTextureLayout[];\n\n    /**\n     * @en\n     * Physics system config\n     * @zh\n     * 物理系统设置\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.PHYSICS: {}}``` to set this.\n     */\n    physics?: IPhysicsConfig;\n\n    /**\n     * @en\n     * The orientation from the builder configuration.\n     * Available value can be 'auto', 'landscape', 'portrait'.\n     * @zh\n     * 屏幕旋转方向，可选 “自动”，“横屏”，“竖屏”\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.SCREEN: { 'orientation': 'auto' }}``` to set this.\n     */\n    orientation?: ConfigOrientation;\n\n    /**\n     * @en\n     * Determine whether the game frame exact fits the screen.\n     * Now it only works on Web platform.\n     * @zh\n     * 是否让游戏外框对齐到屏幕上，目前只在 web 平台生效\n     * @deprecated Since v3.6, Please use ```overrideSettings: { Settings.Category.SCREEN: { 'exactFitScreen': true }}``` to set this.\n     */\n    exactFitScreen: boolean,\n}\n\n/**\n * @en An object to boot the game.\n * @zh 包含游戏主体信息并负责驱动游戏的游戏对象。\n */\nexport class Game extends EventTarget {\n    /**\n     * @en Event triggered when game hide to background.<br>\n     * Please note that this event is not 100% guaranteed to be fired on Web platform,<br>\n     * on native platforms, it corresponds to enter background event, os status bar or notification center may not trigger this event.\n     * @zh 游戏进入后台时触发的事件。<br>\n     * 请注意，在 WEB 平台，这个事件不一定会 100% 触发，这完全取决于浏览器的回调行为。<br>\n     * 在原生平台，它对应的是应用被切换到后台事件，下拉菜单和上拉状态栏等不一定会触发这个事件，这取决于系统行为。\n     * @example\n     * ```ts\n     * import { game, audioEngine } from 'cc';\n     * game.on(Game.EVENT_HIDE, function () {\n     *     audioEngine.pauseMusic();\n     *     audioEngine.pauseAllEffects();\n     * });\n     * ```\n     */\n    public static readonly EVENT_HIDE = 'game_on_hide';\n\n    /**\n     * @en Event triggered when game back to foreground<br>\n     * Please note that this event is not 100% guaranteed to be fired on Web platform,<br>\n     * on native platforms, it corresponds to enter foreground event.\n     * @zh 游戏进入前台运行时触发的事件。<br>\n     * 请注意，在 WEB 平台，这个事件不一定会 100% 触发，这完全取决于浏览器的回调行为。<br>\n     * 在原生平台，它对应的是应用被切换到前台事件。\n     */\n    public static readonly EVENT_SHOW: string = 'game_on_show';\n\n    /**\n     * @en Event triggered when system in low memory status.<br>\n     * This event is only triggered on native iOS/Android platform.\n     * @zh 程序在内存不足时触发的事件。<br>\n     * 该事件只会在 iOS/Android 平台触发。\n     */\n    public static readonly EVENT_LOW_MEMORY: string = 'game_on_low_memory';\n\n    /**\n     * @en Event triggered after game inited, at this point all engine objects and game scripts are loaded\n     * @zh 游戏启动后的触发事件，此时加载所有的引擎对象和游戏脚本。\n     */\n    public static readonly EVENT_GAME_INITED = 'game_inited';\n\n    /**\n     * @en Event triggered after engine inited, at this point you will be able to use all engine classes.<br>\n     * It was defined as EVENT_RENDERER_INITED in cocos creator v1.x and renamed in v2.0.\n     * Since Cocos Creator v3.0, EVENT_RENDERER_INITED is a new event, look up define for details.\n     * @zh 在引擎初始化之后触发的事件，此时您能够使用引擎所有的类。<br>\n     * 它在 Cocos Creator v1.x 版本中名字为 EVENT_RENDERER_INITED，在 v2.0 更名为 EVENT_ENGINE_INITED\n     * 并在 Cocos Creator v3.0 中将 EVENT_RENDERER_INITED 用作为渲染器初始化的事件。\n     */\n    public static readonly EVENT_ENGINE_INITED = 'engine_inited';\n\n    /**\n     * @en Event triggered after renderer inited, at this point you will be able to use all gfx renderer feature.<br>\n     * @zh 在渲染器初始化之后触发的事件，此事件在 EVENT_ENGINE_INITED 之前触发，此时开始可使用 gfx 渲染框架。\n     */\n    public static readonly EVENT_RENDERER_INITED: string = 'renderer_inited';\n\n    /**\n     * @en Event triggered pre base module initialization, at this point you can not use pal/logging/sys/settings API.\n     * @zh 基础模块初始化之前的事件，在这个事件点你无法使用 pal/logging/sys/settings 的相关接口。\n     */\n    public static readonly EVENT_PRE_BASE_INIT = 'pre_base_init';\n    /**\n     * @en Event triggered post base module initialization, at this point you can use pal/logging/sys/settings API safely.\n     * @zh 基础模块初始化之后的事件，在这个事件点你可以安全使用 pal/logging/sys/settings 的相关接口。\n     */\n    public static readonly EVENT_POST_BASE_INIT = 'post_base_init';\n    /**\n     * @en Event triggered pre infrastructure initialization, at this point you can not use assetManager/gfx/screen/builtinResMgr/macro/Layer API.\n     * @zh 基础设施初始化之前的事件，在这个事件点你无法使用 assetManager/gfx/screen/builtinResMgr/macro/Layer 的相关接口。\n     */\n    public static readonly EVENT_PRE_INFRASTRUCTURE_INIT = 'pre_infrastructure_init';\n    /**\n     * @en Event triggered post infrastructure initialization, at this point you can use assetManager/gfx/screen/builtinResMgr/macro/Layer API safely.\n     * @zh 基础设施初始化之后的事件，在这个事件点你可以安全使用 assetManager/gfx/screen/builtinResMgr/macro/Layer 的相关接口。\n     */\n    public static readonly EVENT_POST_INFRASTRUCTURE_INIT = 'post_infrastructure_init';\n    /**\n     * @en Event triggered pre subsystem initialization, at this point you can not use physics/animation/rendering/tween/etc API.\n     * @zh 子系统初始化之前的事件，在这个事件点你无法使用 physics/animation/rendering/tween/etc 的相关接口。\n     */\n    public static readonly EVENT_PRE_SUBSYSTEM_INIT = 'pre_subsystem_init';\n    /**\n     * @en Event triggered post subsystem initialization, at this point you can use physics/animation/rendering/tween/etc API safely.\n     * @zh 子系统初始化之后的事件，在这个事件点你可以安全使用 physics/animation/rendering/tween/etc 的相关接口。\n     */\n    public static readonly EVENT_POST_SUBSYSTEM_INIT = 'post_subsystem_init';\n    /**\n     * @en Event triggered pre project data initialization,\n     * at this point you can not access project data using [resources.load]/[director.loadScene] API.\n     * @zh 项目数据初始化之前的事件，在这个事件点你无法使用访问项目数据的相关接口，例如 [resources.load]/[director.loadScene] 等 API。\n     */\n    public static readonly EVENT_PRE_PROJECT_INIT = 'pre_project_init';\n    /**\n     * @en Event triggered post project data initialization,\n     * at this point you can access project data using [resources.load]/[director.loadScene] API safely.\n     * @zh 项目数据初始化之后的事件，在这个事件点你可以安全使用访问项目数据的相关接口，例如 [resources.load]/[director.loadScene] 等 API。\n     */\n    public static readonly EVENT_POST_PROJECT_INIT = 'post_project_init';\n\n    /**\n     * @en Event triggered when game restart\n     * @zh 调用restart后，触发事件\n     */\n    public static readonly EVENT_RESTART = 'game_on_restart';\n\n    /**\n     * @en Web Canvas 2d API as renderer backend.\n     * @zh 使用 Web Canvas 2d API 作为渲染器后端。\n     */\n    public static readonly RENDER_TYPE_CANVAS = 0;\n    /**\n     * @en WebGL API as renderer backend.\n     * @zh 使用 WebGL API 作为渲染器后端。\n     */\n    public static readonly RENDER_TYPE_WEBGL = 1;\n    /**\n     * @en OpenGL API as renderer backend.\n     * @zh 使用 OpenGL API 作为渲染器后端。\n     */\n    public static readonly RENDER_TYPE_OPENGL = 2;\n\n    /**\n     * @en Headless Renderer, usually used in test or server env\n     * @zh 空渲染器，通常用于测试环境或服务器端模式\n     */\n    public static readonly RENDER_TYPE_HEADLESS = 3;\n\n    /**\n     * @en If delta time since last frame is more than this threshold in seconds,\n     * the game timer will consider user is debugging and adjust the delta time to [[frameTime]].\n     * @zh 如果距离上一帧的帧间隔超过了这个阈值（单位是 s），那么就会被认为正在调试，帧间隔会被自动调节为 [[frameTime]].\n     */\n    public static DEBUG_DT_THRESHOLD = 1;\n\n    /**\n     * @en The outer frame of the game canvas; parent of game container.\n     * @zh 游戏画布的外框，container 的父容器。\n     *\n     * @deprecated since 3.4.0, frame is a concept on web standard, please manager screens via the `screen` module.\n     */\n    public frame: HTMLDivElement | null = null;\n    /**\n     * @en The container of game canvas.\n     * @zh 游戏画布的容器。\n     *\n     * @deprecated since 3.4.0, container is a concept on web standard, please manager screens via the `screen` module.\n     */\n    public container: HTMLDivElement | null = null;\n    /**\n     * @en The canvas of the game.\n     * @zh 游戏的画布。\n     */\n    public canvas: HTMLCanvasElement | null = null;\n\n    /**\n     * @en The renderer backend of the game.\n     * @zh 游戏的渲染器类型。\n     */\n    public renderType = -1;\n\n    public eventTargetOn = super.on;\n    public eventTargetOnce = super.once;\n\n    /**\n     * @en\n     * The current game configuration,\n     * please be noticed any modification directly on this object after the game initialization won't take effect.\n     * @zh\n     * 当前的游戏配置\n     * 注意：请不要直接修改这个对象，它不会有任何效果。\n     */\n    public config: IGameConfig = {} as IGameConfig;\n\n    /**\n     * @en Callback when the scripts of engine have been load.\n     * @zh 当引擎完成启动后的回调函数。\n     * @method onStart\n     */\n    public onStart: Game.OnStart | null = null;\n\n    /**\n     * @en Indicates whether the engine and the renderer has been initialized\n     * @zh 引擎和渲染器是否以完成初始化\n     */\n    public get inited () {\n        return this._inited;\n    }\n\n    /**\n     * @en Expected frame rate of the game.\n     * @zh 游戏的设定帧率。\n     */\n    public get frameRate () {\n        return this._frameRate;\n    }\n    public set frameRate (frameRate: number | string) {\n        if (typeof frameRate !== 'number') {\n            frameRate = parseInt(frameRate, 10);\n            if (Number.isNaN(frameRate)) {\n                frameRate = 60;\n            }\n        }\n        this._frameRate = frameRate;\n        this.frameTime = 1000 / frameRate;\n        if (this._pacer) this._pacer.targetFrameRate = this._frameRate;\n    }\n\n    /**\n     * @en The delta time since last frame, unit: s.\n     * @zh 获取上一帧的增量时间，以秒为单位。\n     */\n    public get deltaTime () {\n        return this._deltaTime;\n    }\n\n    /**\n     * @en The total passed time since game start, unit: ms\n     * @zh 获取从游戏开始到现在总共经过的时间，以毫秒为单位\n     */\n    public get totalTime () {\n        return performance.now() - this._initTime;\n    }\n\n    /**\n     * @en The start time of the current frame in milliseconds.\n     * @zh 获取当前帧开始的时间（以 ms 为单位）。\n     */\n    public get frameStartTime () {\n        return this._startTime;\n    }\n\n    /**\n     * @en The expected delta time of each frame in milliseconds\n     * @zh 期望帧率对应的每帧时间（以 ms 为单位）\n     */\n    public frameTime = 1000 / 60;\n\n    // states\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _isCloning = false;    // deserializing or instantiating\n    private _inited = false;\n    private _engineInited = false; // whether the engine has inited\n    private _rendererInitialized = false;\n    private _paused = true;\n    // frame control\n    private _frameRate = 60;\n    private _pacer: Pacer | null = null;\n    private _initTime = 0;\n    private _startTime = 0;\n    private _deltaTime = 0.0;\n    private _shouldLoadLaunchScene = true;\n\n    /**\n     * @en The event delegate pre base module initialization. At this point you can not use pal/logging/sys/settings API.\n     * @zh 基础模块初始化之前的事件代理。在这个事件点你无法使用 pal/logging/sys/settings 的相关接口。\n     */\n    public readonly onPreBaseInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate post base module initialization. At this point you can use pal/logging/sys/settings API safely.\n     * @zh 基础模块初始化之后的事件代理。在这个事件点你可以安全使用 pal/logging/sys/settings 的相关接口。\n     */\n    public readonly onPostBaseInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate pre infrastructure module initialization.\n     * At this point you can not use assetManager/gfx/screen/builtinResMgr/macro/Layer API.\n     * @zh 基础设施模块初始化之前的事件代理。在这个事件点你无法使用 assetManager/gfx/screen/builtinResMgr/macro/Layer 的相关接口。\n     */\n    public readonly onPreInfrastructureInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate post infrastructure module initialization.\n     * At this point you can use assetManager/gfx/screen/builtinResMgr/macro/Layer API safely.\n     *\n     * @zh 基础设施模块初始化之后的事件代理。在这个事件点你可以安全使用 assetManager/gfx/screen/builtinResMgr/macro/Layer 的相关接口。\n     */\n    public readonly onPostInfrastructureInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate pre sub system module initialization. At this point you can not use physics/animation/rendering/tween/etc API.\n     * @zh 子系统模块初始化之前的事件代理。在这个事件点你无法使用 physics/animation/rendering/tween/etc 的相关接口。\n     */\n    public readonly onPreSubsystemInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate post sub system module initialization. At this point you can use physics/animation/rendering/tween/etc API safely.\n     * @zh 子系统模块初始化之后的事件代理。在这个事件点你可以安全使用 physics/animation/rendering/tween/etc 的相关接口。\n     */\n    public readonly onPostSubsystemInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate pre project data initialization.\n     * At this point you can not access project data using [resources.load]/[director.loadScene] API.\n     * @zh 项目数据初始化之前的事件代理。在这个事件点你无法使用访问项目数据的相关接口，例如 [resources.load]/[director.loadScene] 等 API。\n     */\n    public readonly onPreProjectInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n    /**\n     * @en The event delegate post project data initialization.\n     * at this point you can access project data using [resources.load]/[director.loadScene] API safely.\n     * @zh 项目数据初始化之后的事件代理。\n     * 在这个事件点你可以安全使用访问项目数据的相关接口，例如 [resources.load]/[director.loadScene] 等 API。\n     */\n    public readonly onPostProjectInitDelegate: AsyncDelegate<() => (Promise<void> | void)> = new AsyncDelegate();\n\n    // @Methods\n\n    //  @Game play control\n\n    /**\n     * @en Set frame rate of game.\n     * @zh 设置游戏帧率。\n     * @deprecated since v3.3.0 please use [[game.frameRate]]\n     */\n    public setFrameRate (frameRate: number | string) {\n        this.frameRate = frameRate;\n    }\n\n    /**\n     * @en Get frame rate set for the game, it doesn't represent the real frame rate.\n     * @zh 获取设置的游戏帧率（不等同于实际帧率）。\n     * @return frame rate\n     * @deprecated since v3.3.0 please use [[game.frameRate]]\n     */\n    public getFrameRate (): number {\n        return this.frameRate as number;\n    }\n\n    /**\n     * @en Run the game frame by frame with a fixed delta time correspond to frame rate.\n     * @zh 以固定帧间隔执行一帧游戏循环，帧间隔与设定的帧率匹配。\n     */\n    public step () {\n        director.tick(this.frameTime / 1000);\n    }\n\n    /**\n     * @en Pause the game main loop. This will pause:\n     * - game logic execution\n     * - rendering process\n     * - input event dispatching (excluding Web and Minigame platforms)\n     *\n     * This is different with `director.pause()` which only pause the game logic execution.\n     *\n     * @zh 暂停游戏主循环。包含：\n     * - 游戏逻辑\n     * - 渲染\n     * - 输入事件派发（Web 和小游戏平台除外）\n     *\n     * 这点和只暂停游戏逻辑的 `director.pause()` 不同。\n     */\n    public pause () {\n        if (this._paused) { return; }\n        this._paused = true;\n        this._pacer?.stop();\n    }\n\n    /**\n     * @en Resume the game from pause. This will resume:<br>\n     * game logic execution, rendering process, event manager, background music and all audio effects.<br>\n     * @zh 恢复游戏主循环。包含：游戏逻辑，渲染，事件处理，背景音乐和所有音效。\n     */\n    public resume () {\n        if (!this._paused) { return; }\n        // @ts-expect-error _clearEvents is a private method.\n        input._clearEvents();\n        this._paused = false;\n        this._pacer?.start();\n    }\n\n    /**\n     * @en Check whether the game is paused.\n     * @zh 判断游戏是否暂停。\n     */\n    public isPaused (): boolean {\n        return this._paused;\n    }\n\n    /**\n     * @en Restart game.\n     * @zh 重新开始游戏\n     */\n    public restart (): Promise<void> {\n        const endFramePromise = new Promise<void>((resolve) => { director.once(Director.EVENT_END_FRAME, () => resolve()); });\n        return endFramePromise.then(() => {\n            director.reset();\n            legacyCC.Object._deferredDestroy();\n            this.pause();\n            this.resume();\n            this._shouldLoadLaunchScene = true;\n            SplashScreen.instance.curTime = 0;\n            this._safeEmit(Game.EVENT_RESTART);\n        });\n    }\n\n    /**\n     * @en End game, it will close the game window\n     * @zh 退出游戏\n     */\n    public end () {\n        systemInfo.close();\n    }\n\n    /**\n     * @en\n     * Register an callback of a specific event type on the game object.<br>\n     * This type of event should be triggered via `emit`.<br>\n     * @zh\n     * 注册 game 的特定事件类型回调。这种类型的事件应该被 `emit` 触发。<br>\n     *\n     * @param type - A string representing the event type to listen for.\n     * @param callback - The callback that will be invoked when the event is dispatched.<br>\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\n     * @param target - The target (this object) to invoke the callback, can be null\n     * @param once - After the first invocation, whether the callback should be unregistered.\n     * @return - Just returns the incoming callback so you can save the anonymous function easier.\n     */\n    public on (type: string, callback: () => void, target?: any, once?: boolean): any {\n        // Make sure EVENT_ENGINE_INITED callbacks to be invoked\n        if ((this._engineInited && type === Game.EVENT_ENGINE_INITED)\n            || (this._inited && type === Game.EVENT_GAME_INITED)\n            || (this._rendererInitialized && type === Game.EVENT_RENDERER_INITED)) {\n            callback.call(target);\n        }\n        return this.eventTargetOn(type, callback, target, once);\n    }\n\n    /**\n     * @en\n     * Register an callback of a specific event type on the game object,<br>\n     * the callback will remove itself after the first time it is triggered.<br>\n     * @zh\n     * 注册 game 的特定事件类型回调，回调会在第一时间被触发后删除自身。\n     *\n     * @param type - A string representing the event type to listen for.\n     * @param callback - The callback that will be invoked when the event is dispatched.<br>\n     *                              The callback is ignored if it is a duplicate (the callbacks are unique).\n     * @param target - The target (this object) to invoke the callback, can be null\n     */\n    public once (type: string, callback: () => void, target?: any): any {\n        // Make sure EVENT_ENGINE_INITED callbacks to be invoked\n        if (this._engineInited && type === Game.EVENT_ENGINE_INITED) {\n            return callback.call(target);\n        }\n        return this.eventTargetOnce(type, callback, target);\n    }\n\n    /**\n     * @en Init game with configuration object. Initialization process like below:\n     * -PreBaseInitEvent\n     * -BaseModuleInitialization(logging, sys, settings)\n     * -PostBaseInitEvent\n     * -PreInfrastructureInitEvent\n     * -InfrastructureModuleInitialization(assetManager, builtinResMgr, gfxDevice, screen, Layer, macro)\n     * -PostInfrastructureInitEvent\n     * -PreSubsystemInitEvent\n     * -SubsystemModuleInitialization(animation, physics, tween, ui, middleware, etc)\n     * -PostSubsystemInitEvent\n     * -EngineInitedEvent\n     * -PreProjectDataInitEvent\n     * -ProjectDataInitialization(GamePlayScripts, resources, etc)\n     * -PostProjectDataInitEvent\n     * -GameInitedEvent\n     *\n     * @zh 使用指定的配置初始化引擎。初始化流程如下：\n     * -PreBaseInitEvent\n     * -BaseModuleInitialization(logging, sys, settings)\n     * -PostBaseInitEvent\n     * -PreInfrastructureInitEvent\n     * -InfrastructureModuleInitialization(assetManager, builtinResMgr, gfxDevice, screen, Layer, macro)\n     * -PostInfrastructureInitEvent\n     * -PreSubsystemInitEvent\n     * -SubsystemModuleInitialization(animation, physics, tween, ui, middleware, etc)\n     * -PostSubsystemInitEvent\n     * -EngineInitedEvent\n     * -PreProjectDataInitEvent\n     * -ProjectDataInitialization(GamePlayScripts, resources, etc)\n     * -PostProjectDataInitEvent\n     * -GameInitedEvent\n     * @param config - Pass configuration object\n     */\n    public init (config: IGameConfig) {\n        this._compatibleWithOldParams(config);\n        // DONT change the order unless you know what's you doing\n        return Promise.resolve()\n            // #region Base\n            .then(() => {\n                this.emit(Game.EVENT_PRE_BASE_INIT);\n                return this.onPreBaseInitDelegate.dispatch();\n            })\n            .then(() => {\n                if (DEBUG) {\n                    console.time('Init Base');\n                }\n                const debugMode = config.debugMode || debug.DebugMode.NONE;\n                debug._resetDebugSetting(debugMode);\n                sys.init();\n                this._initEvents();\n            })\n            .then(() => settings.init(config.settingsPath, config.overrideSettings))\n            .then(() => {\n                if (DEBUG) {\n                    console.timeEnd('Init Base');\n                }\n                this.emit(Game.EVENT_POST_BASE_INIT);\n                return this.onPostBaseInitDelegate.dispatch();\n            })\n            // #endregion Base\n            // #region Infrastructure\n            .then(() => {\n                this.emit(Game.EVENT_PRE_INFRASTRUCTURE_INIT);\n                return this.onPreInfrastructureInitDelegate.dispatch();\n            })\n            .then(() => {\n                if (DEBUG) {\n                    console.time('Init Infrastructure');\n                }\n                macro.init();\n                this._initXR();\n                const adapter = findCanvas();\n                if (adapter) {\n                    this.canvas = adapter.canvas;\n                    this.frame = adapter.frame;\n                    this.container = adapter.container;\n                }\n                screen.init();\n                garbageCollectionManager.init();\n                deviceManager.init(this.canvas, bindingMappingInfo);\n                assetManager.init();\n                builtinResMgr.init();\n                Layers.init();\n                this.initPacer();\n                if (DEBUG) {\n                    console.timeEnd('Init Infrastructure');\n                }\n            })\n            .then(() => {\n                this.emit(Game.EVENT_POST_INFRASTRUCTURE_INIT);\n                return this.onPostInfrastructureInitDelegate.dispatch();\n            })\n            // #endregion Infrastructure\n            // #region Subsystem\n            .then(() => {\n                this.emit(Game.EVENT_PRE_SUBSYSTEM_INIT);\n                return this.onPreSubsystemInitDelegate.dispatch();\n            })\n            .then(() => {\n                if (DEBUG) {\n                    console.time('Init SubSystem');\n                }\n                director.init();\n                return builtinResMgr.loadBuiltinAssets();\n            })\n            .then(() => {\n                if (DEBUG) {\n                    console.timeEnd('Init SubSystem');\n                }\n                this.emit(Game.EVENT_POST_SUBSYSTEM_INIT);\n                return this.onPostSubsystemInitDelegate.dispatch();\n            })\n            .then(() => {\n                debug.log(`Cocos Creator v${VERSION}`);\n                this.emit(Game.EVENT_ENGINE_INITED);\n                this._engineInited = true;\n            })\n            // #endregion Subsystem\n            // #region Project\n            .then(() => {\n                this.emit(Game.EVENT_PRE_PROJECT_INIT);\n                return this.onPreProjectInitDelegate.dispatch();\n            })\n            .then(() => {\n                if (DEBUG) {\n                    console.time('Init Project');\n                }\n                const jsList = settings.querySettings<string[]>(Settings.Category.PLUGINS, 'jsList');\n                let promise = Promise.resolve();\n                if (jsList) {\n                    const projectPath = settings.querySettings<string>(Settings.Category.PATH, 'projectPath') || '';\n                    jsList.forEach((jsListFile) => {\n                        promise = promise.then(() => loadJsFile(`${PREVIEW ? NATIVE ? projectPath : 'plugins' : 'src'}/${jsListFile}`));\n                    });\n                }\n                return promise;\n            })\n            .then(() => {\n                const scriptPackages = settings.querySettings<string[]>(Settings.Category.SCRIPTING, 'scriptPackages');\n                if (scriptPackages) {\n                    return Promise.all(scriptPackages.map((pack) => import(pack)));\n                }\n                return Promise.resolve([]);\n            })\n            .then(() => this._loadProjectBundles())\n            .then(() => this._loadCCEScripts())\n            .then(() => this._setupRenderPipeline())\n            .then(() => this._loadPreloadAssets())\n            .then(() => {\n                builtinResMgr.compileBuiltinMaterial();\n                return SplashScreen.instance.init();\n            })\n            .then(() => {\n                if (DEBUG) {\n                    console.timeEnd('Init Project');\n                }\n                this.emit(Game.EVENT_POST_PROJECT_INIT);\n                return this.onPostProjectInitDelegate.dispatch();\n            })\n            // #endregion Project\n            .then(() => {\n                this._inited = true;\n                this._safeEmit(Game.EVENT_GAME_INITED);\n            });\n    }\n\n    private _initXR () {\n        if (sys.isXR) {\n            // XrEntry must not be destroyed\n            xr.entry = xr.XrEntry.getInstance();\n\n            const xrMSAA = settings.querySettings(Settings.Category.RENDERING, 'msaa') ?? 1;\n            const xrRenderingScale = settings.querySettings(Settings.Category.RENDERING, 'renderingScale') ?? 1.0;\n            xr.entry.setMultisamplesRTT(xrMSAA);\n            xr.entry.setRenderingScale(xrRenderingScale);\n        }\n    }\n\n    private _compatibleWithOldParams (config: IGameConfig) {\n        const overrideSettings = config.overrideSettings = config.overrideSettings || {};\n        if ('showFPS' in config) {\n            overrideSettings.profiling = overrideSettings.profiling || {};\n            overrideSettings.profiling.showFPS = config.showFPS;\n        }\n        if ('frameRate' in config) {\n            overrideSettings.screen = overrideSettings.screen || {};\n            overrideSettings.screen.frameRate = config.frameRate;\n        }\n        if ('renderMode' in config) {\n            overrideSettings.rendering = overrideSettings.rendering || {};\n            overrideSettings.rendering.renderMode = config.renderMode;\n        }\n        if ('renderPipeline' in config) {\n            overrideSettings.rendering = overrideSettings.rendering || {};\n            overrideSettings.rendering.renderPipeline = config.renderPipeline;\n        }\n        if ('assetOptions' in config) {\n            overrideSettings.assets = overrideSettings.assets || {};\n            Object.assign(overrideSettings.assets, config.assetOptions);\n        }\n        if ('customJointTextureLayouts' in config) {\n            overrideSettings.animation = overrideSettings.animation || {};\n            overrideSettings.animation.customJointTextureLayouts = config.customJointTextureLayouts;\n        }\n        if ('physics' in config) {\n            overrideSettings.physics = overrideSettings.physics || {};\n            Object.assign(overrideSettings.physics, config.physics);\n        }\n        if ('orientation' in config) {\n            overrideSettings.screen = overrideSettings.screen || {};\n            overrideSettings.screen.orientation = config.orientation;\n        }\n        if ('exactFitScreen' in config) {\n            overrideSettings.screen = overrideSettings.screen || {};\n            overrideSettings.screen.exactFitScreen = config.exactFitScreen;\n        }\n    }\n\n    private _loadPreloadAssets () {\n        const preloadAssets = settings.querySettings<string[]>(Settings.Category.ASSETS, 'preloadAssets');\n        if (!preloadAssets) return Promise.resolve([]);\n        return Promise.all(preloadAssets.map((uuid) => new Promise<void>((resolve, reject) => {\n            assetManager.loadAny(uuid, (err) => {\n                if (err) {\n                    reject(err);\n                    return;\n                }\n                resolve();\n            });\n        })));\n    }\n\n    /**\n     * @internal only for browser preview\n     */\n    private _loadCCEScripts () {\n        return new Promise<void>((resolve, reject) => {\n            // Since there is no script in the bundle during preview, we need to load the user's script in the following way\n            if (PREVIEW && !TEST && !EDITOR && !NATIVE) {\n                const bundneName = 'cce:/internal/x/prerequisite-imports';\n                import(bundneName).then(() => resolve(), (reason) => reject(reason));\n            } else {\n                resolve();\n            }\n        });\n    }\n\n    /**\n     * @internal only for game-view\n     */\n    public _loadProjectBundles () {\n        const preloadBundles = settings.querySettings<{ bundle: string, version: string }[]>(Settings.Category.ASSETS, 'preloadBundles');\n        if (!preloadBundles) return Promise.resolve([]);\n        return Promise.all(preloadBundles.map(({ bundle, version }) => new Promise<void>((resolve, reject) => {\n            const opts: IBundleOptions = {};\n            if (version) opts.version = version;\n            assetManager.loadBundle(bundle, opts, (err) => {\n                if (err) {\n                    reject(err);\n                    return;\n                }\n                resolve();\n            });\n        })));\n    }\n\n    /**\n     * @en Run game with configuration object and onStart function.\n     * @zh 运行游戏，并且指定引擎配置和 onStart 的回调。\n     * @param onStart - function to be executed after game initialized\n     */\n    public run (onStart?: Game.OnStart) {\n        if (onStart) {\n            this.onStart = onStart;\n        }\n        if (!this._inited || (EDITOR && !legacyCC.GAME_VIEW)) {\n            return;\n        }\n        this.resume();\n    }\n\n    // @Methods\n\n    private _calculateDT () {\n        const now = performance.now();\n        this._deltaTime = now > this._startTime ? (now - this._startTime) / 1000 : 0;\n        if (this._deltaTime > Game.DEBUG_DT_THRESHOLD) {\n            this._deltaTime = this.frameTime / 1000;\n        }\n        this._startTime = now;\n        return this._deltaTime;\n    }\n\n    private _updateCallback () {\n        if (!this._inited) return;\n        if (!SplashScreen.instance.isFinished) {\n            SplashScreen.instance.update(this._calculateDT());\n        } else if (this._shouldLoadLaunchScene) {\n            this._shouldLoadLaunchScene = false;\n            const launchScene = settings.querySettings(Settings.Category.LAUNCH, 'launchScene');\n            if (launchScene) {\n                // load scene\n                director.loadScene(launchScene, () => {\n                    console.log(`Success to load scene: ${launchScene}`);\n                    this._initTime = performance.now();\n                    director.startAnimation();\n                    this.onStart?.();\n                });\n            } else {\n                this._initTime = performance.now();\n                director.startAnimation();\n                this.onStart?.();\n            }\n        } else {\n            director.tick(this._calculateDT());\n        }\n    }\n\n    private initPacer () {\n        const frameRate = settings.querySettings(Settings.Category.SCREEN, 'frameRate') ?? 60;\n        assert(typeof frameRate === 'number');\n        this._pacer = new Pacer();\n        this._pacer.onTick = this._updateCallback.bind(this);\n        this.frameRate = frameRate;\n    }\n\n    private _initEvents () {\n        systemInfo.on('show', this._onShow, this);\n        systemInfo.on('hide', this._onHide, this);\n    }\n\n    private _onHide () {\n        this.emit(Game.EVENT_HIDE);\n        this.pause();\n    }\n\n    private _onShow () {\n        this.emit(Game.EVENT_SHOW);\n        this.resume();\n    }\n\n    //  @ Persist root node section\n    /**\n     * @en\n     * Add a persistent root node to the game, the persistent node won't be destroyed during scene transition.<br>\n     * The target node must be placed in the root level of hierarchy, otherwise this API won't have any effect.\n     * @zh\n     * 声明常驻根节点，该节点不会在场景切换中被销毁。<br>\n     * 目标节点必须位于为层级的根节点，否则无效。\n     * @param node - The node to be made persistent\n     * @deprecated Since v3.6.0, please use director.addPersistRootNode instead.\n     */\n    public addPersistRootNode (node: Node) {\n        director.addPersistRootNode(node);\n    }\n\n    /**\n     * @en Remove a persistent root node.\n     * @zh 取消常驻根节点。\n     * @param node - The node to be removed from persistent node list\n     * @deprecated Since v3.6.0, please use director.removePersistRootNode instead.\n     */\n    public removePersistRootNode (node: Node) {\n        director.removePersistRootNode(node);\n    }\n\n    /**\n     * @en Check whether the node is a persistent root node.\n     * @zh 检查节点是否是常驻根节点。\n     * @param node - The node to be checked.\n     * @deprecated Since v3.6.0, please use director.isPersistRootNode instead.\n     */\n    public isPersistRootNode (node: Node): boolean {\n        return director.isPersistRootNode(node);\n    }\n\n    private _setupRenderPipeline () {\n        const renderPipeline = settings.querySettings(Settings.Category.RENDERING, 'renderPipeline');\n        if (!renderPipeline) {\n            return this._setRenderPipeline();\n        }\n        return new Promise<RenderPipeline>((resolve, reject) => {\n            assetManager.loadAny(renderPipeline, (err, asset) => ((err || !(asset instanceof RenderPipeline))\n                ? reject(err)\n                : resolve(asset)));\n        }).then((asset) => {\n            this._setRenderPipeline(asset);\n        }).catch((reason) => {\n            debug.warn(reason);\n            debug.warn(`Failed load render pipeline: ${renderPipeline}, engine failed to initialize, will fallback to default pipeline`);\n            this._setRenderPipeline();\n        });\n    }\n\n    private _setRenderPipeline (rppl?: RenderPipeline) {\n        if (!director.root!.setRenderPipeline(rppl)) {\n            this._setRenderPipeline();\n        }\n\n        this._rendererInitialized = true;\n        this._safeEmit(Game.EVENT_RENDERER_INITED);\n    }\n\n    private _safeEmit (event) {\n        if (EDITOR) {\n            try {\n                this.emit(event);\n            } catch (e) {\n                debug.warn(e);\n            }\n        } else {\n            this.emit(event);\n        }\n    }\n}\n\nexport declare namespace Game {\n    export type OnStart = () => void;\n}\n\nlegacyCC.Game = Game;\n\n/**\n * @en\n * This is a Game instance.\n * @zh\n * 这是一个 Game 类的实例，包含游戏主体信息并负责驱动游戏的游戏对象。\n */\nexport const game = legacyCC.game = new Game();\n","export function findCanvas (): { frame: HTMLDivElement, container: HTMLDivElement, canvas: HTMLCanvasElement } {\n    const frame = document.querySelector('#GameDiv') as HTMLDivElement;\n    const container = document.querySelector('#Cocos3dGameContainer') as HTMLDivElement;\n    const canvas = document.querySelector('#GameCanvas') as HTMLCanvasElement;\n\n    return { frame, container, canvas };\n}\n\nexport function loadJsFile (path: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n        let err;\n        function windowErrorListener (evt) {\n            if (evt.filename === path) {\n                err = evt.error;\n            }\n        }\n        window.addEventListener('error', windowErrorListener);\n        const script = document.createElement('script');\n        script.charset = 'utf-8';\n        script.async = true;\n        script.crossOrigin = 'anonymous';\n        script.addEventListener('error', () => {\n            window.removeEventListener('error', windowErrorListener);\n            reject(Error(`Error loading ${path}`));\n        });\n        script.addEventListener('load', () => {\n            window.removeEventListener('error', windowErrorListener);\n            document.head.removeChild(script);\n            // Note that if an error occurs that isn't caught by this if statement,\n            // that getRegister will return null and a \"did not instantiate\" error will be thrown.\n            if (err) {\n                reject(err);\n            } else {\n                resolve();\n            }\n        });\n        script.src = path.replace('#', '%23');\n        document.head.appendChild(script);\n    });\n}\n","/*\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport { Rect } from '../math';\nimport { legacyCC } from '../global-exports';\n\n/**\n * `visibleRect` is a singleton object which defines the actual visible rect of the current view\n */\nconst visibleRect = {\n    /**\n     * Top left coordinate of the screen related to the game scene.\n     */\n    topLeft: legacyCC.v2(0, 0),\n\n    /**\n     * Top right coordinate of the screen related to the game scene.\n     */\n    topRight: legacyCC.v2(0, 0),\n\n    /**\n     * Top center coordinate of the screen related to the game scene.\n     */\n    top: legacyCC.v2(0, 0),\n\n    /**\n     * Bottom left coordinate of the screen related to the game scene.\n     */\n    bottomLeft: legacyCC.v2(0, 0),\n\n    /**\n     * Bottom right coordinate of the screen related to the game scene.\n     */\n    bottomRight: legacyCC.v2(0, 0),\n\n    /**\n     * Bottom center coordinate of the screen related to the game scene.\n     */\n    bottom: legacyCC.v2(0, 0),\n\n    /**\n     * Center coordinate of the screen related to the game scene.\n     */\n    center: legacyCC.v2(0, 0),\n\n    /**\n     * Left center coordinate of the screen related to the game scene.\n     */\n    left: legacyCC.v2(0, 0),\n\n    /**\n     * Right center coordinate of the screen related to the game scene.\n     */\n    right: legacyCC.v2(0, 0),\n\n    /**\n     * Width of the screen.\n     */\n    width: 0,\n\n    /**\n     * Height of the screen.\n     */\n    height: 0,\n\n    /**\n     * initialize\n     */\n    init (visibleRect_: Rect) {\n        const w = this.width = visibleRect_.width;\n        const h = this.height = visibleRect_.height;\n        const l = visibleRect_.x;\n        const b = visibleRect_.y;\n        const t = b + h;\n        const r = l + w;\n\n        // top\n        this.topLeft.x = l;\n        this.topLeft.y = t;\n        this.topRight.x = r;\n        this.topRight.y = t;\n        this.top.x = l + w / 2;\n        this.top.y = t;\n\n        // bottom\n        this.bottomLeft.x = l;\n        this.bottomLeft.y = b;\n        this.bottomRight.x = r;\n        this.bottomRight.y = b;\n        this.bottom.x = l + w / 2;\n        this.bottom.y = b;\n\n        // center\n        this.center.x = l + w / 2;\n        this.center.y = b + h / 2;\n\n        // left\n        this.left.x = l;\n        this.left.y = b + h / 2;\n\n        // right\n        this.right.x = r;\n        this.right.y = b + h / 2;\n    },\n};\n\nlegacyCC.visibleRect = visibleRect;\nexport default visibleRect;\n","/*\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2017-2020 Xiamen Yaji Software Co., Ltd.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport '../data/class';\nimport { MINIGAME, JSB, RUNTIME_BASED, EDITOR } from 'internal:constants';\nimport { screenAdapter } from 'pal/screen-adapter';\nimport { Eventify, EventTarget } from '../event';\nimport { Rect, Size, Vec2 } from '../math';\nimport visibleRect from './visible-rect';\nimport { legacyCC } from '../global-exports';\nimport { errorID } from './debug';\nimport { screen } from './screen';\nimport { macro } from './macro';\nimport { Orientation } from '../../../pal/screen-adapter/enum-type';\nimport { director } from '../director';\nimport { System } from '../components';\nimport { Settings, settings } from '../settings';\n\n/**\n * @en View represents the game window.<br/>\n * It's main task include: <br/>\n *  - Apply the design resolution policy to the UI Canvas<br/>\n *  - Provide interaction with the window, like resize event on web, retina display support, etc...<br/>\n *  - Manage the scale and translation of canvas related to the frame on Web<br/>\n * <br/>\n * With [[view]] as its singleton initialized by the engine, you don't need to call any constructor or create functions,<br/>\n * the standard way to use it is by calling:<br/>\n *  - view.methodName(); <br/>\n * @zh View 代表游戏窗口视图，它的核心功能包括：\n *  - 对所有 UI Canvas 进行设计分辨率适配。\n *  - 提供窗口视图的交互，比如监听 resize 事件，控制 retina 屏幕适配，等等。\n *  - 控制 Canvas 节点相对于外层 DOM 节点的缩放和偏移。\n * 引擎会自动初始化它的单例对象 [[view]]，所以你不需要实例化任何 View，只需要直接使用 `view.methodName();`\n */\n\nconst localWinSize = new Size();\n\nconst orientationMap = {\n    [macro.ORIENTATION_AUTO]: Orientation.AUTO,\n    [macro.ORIENTATION_LANDSCAPE]: Orientation.LANDSCAPE,\n    [macro.ORIENTATION_PORTRAIT]: Orientation.PORTRAIT,\n};\n\nexport class View extends Eventify(System) {\n    public static instance: View;\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _designResolutionSize: Size;\n\n    private _scaleX: number;\n    private _scaleY: number;\n    private _viewportRect: Rect;\n    private _visibleRect: Rect;\n    private _autoFullScreen: boolean;\n    private _retinaEnabled: boolean;\n    private _resizeCallback: (() => void) | null;\n    private _resolutionPolicy: ResolutionPolicy;\n    private _rpExactFit: ResolutionPolicy;\n    private _rpShowAll: ResolutionPolicy;\n    private _rpNoBorder: ResolutionPolicy;\n    private _rpFixedHeight: ResolutionPolicy;\n    private _rpFixedWidth: ResolutionPolicy;\n\n    constructor () {\n        super();\n\n        const _strategyer = ContainerStrategy;\n        const _strategy = ContentStrategy;\n\n        // resolution size, it is the size appropriate for the app resources.\n        this._designResolutionSize = new Size(0, 0);\n        this._scaleX = 1;\n        this._scaleY = 1;\n        // Viewport is the container's rect related to content's coordinates in pixel\n        this._viewportRect = new Rect(0, 0, 0, 0);\n        // The visible rect in content's coordinate in point\n        this._visibleRect = new Rect(0, 0, 0, 0);\n        // Auto full screen disabled by default\n        this._autoFullScreen = false;\n        // Retina disabled by default\n        this._retinaEnabled = false;\n        // Custom callback for resize event\n        this._resizeCallback = null;\n\n        // Setup system default resolution policies\n        this._rpExactFit = new ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.EXACT_FIT);\n        this._rpShowAll = new ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.SHOW_ALL);\n        this._rpNoBorder = new ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.NO_BORDER);\n        this._rpFixedHeight = new ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.FIXED_HEIGHT);\n        this._rpFixedWidth = new ResolutionPolicy(_strategyer.EQUAL_TO_FRAME, _strategy.FIXED_WIDTH);\n        this._resolutionPolicy = this._rpShowAll;\n    }\n\n    // Call init at the time Game.EVENT_ENGINE_INITED\n    public init () {\n        const windowSize = screen.windowSize;\n        const w = windowSize.width;\n        const h = windowSize.height;\n        this._designResolutionSize.width = w;\n        this._designResolutionSize.height = h;\n        this._viewportRect.width = w;\n        this._viewportRect.height = h;\n        this._visibleRect.width = w;\n        this._visibleRect.height = h;\n\n        localWinSize.width = this._visibleRect.width;\n        localWinSize.height = this._visibleRect.height;\n        if (visibleRect) {\n            visibleRect.init(this._visibleRect);\n        }\n\n        if (!EDITOR) {\n            this.resizeWithBrowserSize(true);\n            const designResolution = settings.querySettings(Settings.Category.SCREEN, 'designResolution');\n            if (designResolution) {\n                this.setDesignResolutionSize(Number(designResolution.width), Number(designResolution.height),\n                    designResolution.policy || ResolutionPolicy.FIXED_HEIGHT);\n            }\n        }\n\n        // For now, the engine UI is adapted to resolution size, instead of window size.\n        screenAdapter.on('window-resize', this._updateAdaptResult, this);\n        screenAdapter.on('orientation-change', this._updateAdaptResult, this);\n        screenAdapter.on('fullscreen-change', this._updateAdaptResult, this);\n    }\n\n    /**\n     * @en\n     * Sets whether resize canvas automatically when browser's size changed.<br/>\n     * Useful only on web.\n     * @zh 设置当发现浏览器的尺寸改变时，是否自动调整 canvas 尺寸大小。\n     * 仅在 Web 模式下有效。\n     * @param enabled - Whether enable automatic resize with browser's resize event\n     */\n    public resizeWithBrowserSize (enabled: boolean) {\n        screenAdapter.handleResizeEvent = enabled;\n    }\n\n    /**\n     * @en\n     * Sets the callback function for `view`'s resize action,<br/>\n     * this callback will be invoked before applying resolution policy, <br/>\n     * so you can do any additional modifications within the callback.<br/>\n     * Useful only on web.\n     * @zh 设置 `view` 调整视窗尺寸行为的回调函数，\n     * 这个回调函数会在应用适配模式之前被调用，\n     * 因此你可以在这个回调函数内添加任意附加改变，\n     * 仅在 Web 平台下有效。\n     * @param callback - The callback function\n     */\n    public setResizeCallback (callback: (()=> void) | null) {\n        if (typeof callback === 'function' || callback == null) {\n            this._resizeCallback = callback;\n        }\n    }\n\n    /**\n     * @en\n     * Sets the orientation of the game, it can be landscape, portrait or auto.\n     * When set it to landscape or portrait, and screen w/h ratio doesn't fit,\n     * `view` will automatically rotate the game canvas using CSS.\n     * Note that this function doesn't have any effect in native,\n     * in native, you need to set the application orientation in native project settings\n     * @zh 设置游戏屏幕朝向，它能够是横版，竖版或自动。\n     * 当设置为横版或竖版，并且屏幕的宽高比例不匹配时，\n     * `view` 会自动用 CSS 旋转游戏场景的 canvas，\n     * 这个方法不会对 native 部分产生任何影响，对于 native 而言，你需要在应用设置中的设置排版。\n     * @param orientation - Possible values: macro.ORIENTATION_LANDSCAPE | macro.ORIENTATION_PORTRAIT | macro.ORIENTATION_AUTO\n     */\n    public setOrientation (orientation: number) {\n        screenAdapter.orientation = orientationMap[orientation];\n    }\n\n    /**\n     * @en\n     * Sets whether the engine modify the \"viewport\" meta in your web page.<br/>\n     * It's enabled by default, we strongly suggest you not to disable it.<br/>\n     * And even when it's enabled, you can still set your own \"viewport\" meta, it won't be overridden<br/>\n     * Only useful on web\n     * @zh 设置引擎是否调整 viewport meta 来配合屏幕适配。\n     * 默认设置为启动，我们强烈建议你不要将它设置为关闭。\n     * 即使当它启动时，你仍然能够设置你的 viewport meta，它不会被覆盖。\n     * 仅在 Web 模式下有效\n     * @param enabled - Enable automatic modification to \"viewport\" meta\n     * @deprecated since v3.3\n     */\n    public adjustViewportMeta (enabled: boolean) {\n        // DO NOTHING\n    }\n\n    /**\n     * @en\n     * Retina support is enabled by default for Apple device but disabled for other devices,<br/>\n     * it takes effect only when you called setDesignResolutionPolicy<br/>\n     * Only useful on web\n     * @zh 对于 Apple 这种支持 Retina 显示的设备上默认进行优化而其他类型设备默认不进行优化，\n     * 它仅会在你调用 setDesignResolutionPolicy 方法时有影响。\n     * 仅在 Web 模式下有效。\n     * @param enabled - Enable or disable retina display\n     *\n     * @deprecated since v3.4.0\n     */\n    public enableRetina (enabled: boolean) {\n        this._retinaEnabled = !!enabled;\n    }\n\n    /**\n     * @en\n     * Check whether retina display is enabled.<br/>\n     * Only useful on web\n     * @zh 检查是否对 Retina 显示设备进行优化。\n     * 仅在 Web 模式下有效。\n     *\n     * @deprecated since v3.4.0\n     */\n    public isRetinaEnabled (): boolean {\n        return this._retinaEnabled;\n    }\n\n    /**\n     * @en\n     * If enabled, the application will try automatically to enter full screen mode on mobile devices<br/>\n     * You can pass true as parameter to enable it and disable it by passing false.<br/>\n     * Only useful on web\n     * @zh 启动时，移动端游戏会在移动端自动尝试进入全屏模式。\n     * 你能够传入 true 为参数去启动它，用 false 参数来关闭它。\n     * @param enabled - Enable or disable auto full screen on mobile devices\n     *\n     * @deprecated since v3.3, please use screen.requestFullScreen() instead.\n     */\n    public enableAutoFullScreen (enabled: boolean) {\n        if (enabled === this._autoFullScreen) {\n            return;\n        }\n        this._autoFullScreen = enabled;\n        if (enabled) {\n            screen.requestFullScreen().catch((e) => {});\n        }\n    }\n\n    /**\n     * @en\n     * Check whether auto full screen is enabled.<br/>\n     * Only useful on web\n     * @zh 检查自动进入全屏模式是否启动。\n     * 仅在 Web 模式下有效。\n     * @return Auto full screen enabled or not\n     *\n     * @deprecated since v3.3\n     */\n    public isAutoFullScreenEnabled (): boolean {\n        return this._autoFullScreen;\n    }\n\n    /**\n     * @en Set the canvas size in CSS pixels on Web platform.\n     * This method is not supported on other platforms.\n     * @zh  Web 平台下，可以以 CSS 像素尺寸来设置 canvas 尺寸。\n     * 这个方法并不支持其他平台。\n     * @private\n     * @param {Number} width\n     * @param {Number} height\n     *\n     * @deprecated since v3.4.0, setting size in CSS pixels is not recommended, please use screen.windowSize instead.\n     */\n    public setCanvasSize (width: number, height: number) {\n        // set resolution scale to 1;\n        screenAdapter.resolutionScale = 1;\n\n        // set window size\n        const dpr = screenAdapter.devicePixelRatio;\n        const windowSize = new Size(width * dpr, height * dpr);\n        screen.windowSize = windowSize;\n    }\n\n    /**\n     * @en\n     * Returns the canvas size of the view.<br/>\n     * On native platforms, it returns the screen size since the view is a fullscreen view.<br/>\n     * On web, it returns the size of the canvas element.\n     * @zh 返回视图中 canvas 的尺寸。\n     * 在 native 平台下，它返回全屏视图下屏幕的尺寸。\n     * 在 Web 平台下，它返回 canvas 元素尺寸。\n     *\n     * @deprecated since v3.4.0, please use screen.windowSize instead.\n     */\n    public getCanvasSize (): Size {\n        return screen.windowSize;\n    }\n\n    /**\n     * @en\n     * Returns the frame size of the view in CSS pixels.<br/>\n     * On native platforms, it returns the screen size since the view is a fullscreen view.<br/>\n     * On web, it returns the size of the canvas's outer DOM element.\n     * @zh 以 CSS 像素尺寸返回视图中边框尺寸。\n     * 在 native 平台下，它返回全屏视图下屏幕的尺寸。\n     * 在 web 平台下，它返回 canvas 元素的外层 DOM 元素尺寸。\n     *\n     * @deprecated since v3.4.0, getting size in CSS pixels is not recommended, please use screen.windowSize instead.\n     */\n    public getFrameSize (): Size {\n        const dpr = screenAdapter.devicePixelRatio;\n        const sizeInCssPixels = screen.windowSize;\n        sizeInCssPixels.width /= dpr;\n        sizeInCssPixels.height /= dpr;\n        return sizeInCssPixels;\n    }\n\n    /**\n     * @en Setting the frame size of the view in CSS pixels.\n     * On native, it sets the frame size of view.<br/>\n     * On web, it sets the size of the canvas's outer DOM element.\n     * @zh 以 CSS 像素尺寸设置视图中边框尺寸。\n     * 在 native 平台下，设置视图框架尺寸。\n     * 在 web 平台下，设置 canvas 外层 DOM 元素尺寸。\n     * @param {Number} width\n     * @param {Number} height\n     *\n     * @deprecated since v3.4.0, setting size in CSS pixels is not recommended, please use screen.windowSize instead.\n     */\n    public setFrameSize (width: number, height: number) {\n        const dpr = screenAdapter.devicePixelRatio;\n        screen.windowSize = new Size(width * dpr, height * dpr);\n    }\n\n    /**\n     * @en Returns the visible area size of the view port.\n     * @zh 返回视图窗口可见区域尺寸。\n     */\n    public getVisibleSize (): Size {\n        return new Size(this._visibleRect.width, this._visibleRect.height);\n    }\n\n    /**\n     * @en Returns the visible area size of the view port.\n     * @zh 返回视图窗口可见区域像素尺寸。\n     */\n    public getVisibleSizeInPixel (): Size {\n        return new Size(this._visibleRect.width * this._scaleX,\n            this._visibleRect.height * this._scaleY);\n    }\n\n    /**\n     * @en Returns the visible origin of the view port.\n     * @zh 返回视图窗口可见区域原点。\n     */\n    public getVisibleOrigin (): Vec2 {\n        return new Vec2(this._visibleRect.x, this._visibleRect.y);\n    }\n\n    /**\n     * @en Returns the visible origin of the view port.\n     * @zh 返回视图窗口可见区域像素原点。\n     */\n    public getVisibleOriginInPixel (): Vec2 {\n        return new Vec2(this._visibleRect.x * this._scaleX,\n            this._visibleRect.y * this._scaleY);\n    }\n\n    /**\n     * @en Returns the current resolution policy\n     * @zh 返回当前分辨率方案\n     * @see [[ResolutionPolicy]]\n     */\n    public getResolutionPolicy (): ResolutionPolicy {\n        return this._resolutionPolicy;\n    }\n\n    private _updateResolutionPolicy (resolutionPolicy: ResolutionPolicy|number) {\n        if (resolutionPolicy instanceof ResolutionPolicy) {\n            this._resolutionPolicy = resolutionPolicy;\n        } else {\n            // Ensure compatibility with JSB\n            const _locPolicy = ResolutionPolicy;\n            if (resolutionPolicy === _locPolicy.EXACT_FIT) {\n                this._resolutionPolicy = this._rpExactFit;\n            }\n            if (resolutionPolicy === _locPolicy.SHOW_ALL) {\n                this._resolutionPolicy = this._rpShowAll;\n            }\n            if (resolutionPolicy === _locPolicy.NO_BORDER) {\n                this._resolutionPolicy = this._rpNoBorder;\n            }\n            if (resolutionPolicy === _locPolicy.FIXED_HEIGHT) {\n                this._resolutionPolicy = this._rpFixedHeight;\n            }\n            if (resolutionPolicy === _locPolicy.FIXED_WIDTH) {\n                this._resolutionPolicy = this._rpFixedWidth;\n            }\n        }\n    }\n    /**\n     * @en Sets the current resolution policy\n     * @zh 设置当前分辨率模式\n     * @see [[ResolutionPolicy]]\n     */\n    public setResolutionPolicy (resolutionPolicy: ResolutionPolicy|number) {\n        this._updateResolutionPolicy(resolutionPolicy);\n        const designedResolution = view.getDesignResolutionSize();\n        view.setDesignResolutionSize(designedResolution.width, designedResolution.height, resolutionPolicy);\n    }\n\n    /**\n     * @en Sets the resolution policy with designed view size in points.<br/>\n     * The resolution policy include: <br/>\n     * [1] ResolutionExactFit       Fill screen by stretch-to-fit: if the design resolution ratio of width to height is different from the screen resolution ratio, your game view will be stretched.<br/>\n     * [2] ResolutionNoBorder       Full screen without black border: if the design resolution ratio of width to height is different from the screen resolution ratio, two areas of your game view will be cut.<br/>\n     * [3] ResolutionShowAll        Full screen with black border: if the design resolution ratio of width to height is different from the screen resolution ratio, two black borders will be shown.<br/>\n     * [4] ResolutionFixedHeight    Scale the content's height to screen's height and proportionally scale its width<br/>\n     * [5] ResolutionFixedWidth     Scale the content's width to screen's width and proportionally scale its height<br/>\n     * [ResolutionPolicy]        [Web only feature] Custom resolution policy, constructed by ResolutionPolicy<br/>\n     * @zh 通过设置设计分辨率和匹配模式来进行游戏画面的屏幕适配。\n     * @param width Design resolution width.\n     * @param height Design resolution height.\n     * @param resolutionPolicy The resolution policy desired\n     */\n    public setDesignResolutionSize (width: number, height: number, resolutionPolicy: ResolutionPolicy|number) {\n        // Defensive code\n        if (!(width > 0 && height > 0)) {\n            errorID(2200);\n            return;\n        }\n\n        this._updateResolutionPolicy(resolutionPolicy);\n        const policy = this._resolutionPolicy;\n        if (policy) {\n            policy.preApply(this);\n        }\n\n        this._designResolutionSize.width = width;\n        this._designResolutionSize.height = height;\n\n        const result = policy.apply(this, this._designResolutionSize);\n\n        if (result.scale && result.scale.length === 2) {\n            this._scaleX = result.scale[0];\n            this._scaleY = result.scale[1];\n        }\n\n        if (result.viewport) {\n            const vp = this._viewportRect;\n            const vb = this._visibleRect;\n            const rv = result.viewport;\n\n            vp.x = rv.x;\n            vp.y = rv.y;\n            vp.width = rv.width;\n            vp.height = rv.height;\n\n            vb.x = 0;\n            vb.y = 0;\n            vb.width = rv.width / this._scaleX;\n            vb.height = rv.height / this._scaleY;\n        }\n\n        policy.postApply(this);\n        localWinSize.width = this._visibleRect.width;\n        localWinSize.height = this._visibleRect.height;\n\n        if (visibleRect) {\n            visibleRect.init(this._visibleRect);\n        }\n\n        this.emit('design-resolution-changed');\n    }\n\n    /**\n     * @en Returns the designed size for the view.\n     * @zh 返回视图的设计分辨率。\n     */\n    public getDesignResolutionSize (): Size {\n        return new Size(this._designResolutionSize.width, this._designResolutionSize.height);\n    }\n\n    /**\n     * @en Sets the container to desired pixel resolution and fit the game content to it.\n     * This function is very useful for adaptation in mobile browsers.\n     * In some HD android devices, the resolution is very high, but its browser performance may not be very good.\n     * In this case, enabling retina display is very costy and not suggested, and if retina is disabled, the image may be blurry.\n     * But this API can be helpful to set a desired pixel resolution which is in between.\n     * This API will do the following:\n     *     1. Set viewport's width to the desired width in pixel\n     *     2. Set body width to the exact pixel resolution\n     *     3. The resolution policy will be reset with designed view size in points.\n     * @zh 设置容器（container）需要的像素分辨率并且适配相应分辨率的游戏内容。\n     * @param width Design resolution width.\n     * @param height Design resolution height.\n     * @param resolutionPolicy The resolution policy desired\n     *\n     * @deprecated since v3.6.0\n     */\n    public setRealPixelResolution (width: number, height: number, resolutionPolicy: ResolutionPolicy|number) {\n        if (!JSB && !RUNTIME_BASED && !MINIGAME) {\n            // Set body width to the exact pixel resolution\n            document.documentElement.style.width = `${width}px`;\n            document.body.style.width = `${width}px`;\n            document.body.style.left = '0px';\n            document.body.style.top = '0px';\n        }\n\n        // Reset the resolution size and policy\n        this.setDesignResolutionSize(width, height, resolutionPolicy);\n    }\n\n    /**\n     * @en Returns the view port rectangle.\n     * @zh 返回视窗剪裁区域。\n     */\n    public getViewportRect (): Rect {\n        return this._viewportRect;\n    }\n\n    /**\n     * @en Returns scale factor of the horizontal direction (X axis).\n     * @zh 返回横轴的缩放比，这个缩放比是将画布像素分辨率放到设计分辨率的比例。\n     */\n    public getScaleX (): number {\n        return this._scaleX;\n    }\n\n    /**\n     * @en Returns scale factor of the vertical direction (Y axis).\n     * @zh 返回纵轴的缩放比，这个缩放比是将画布像素分辨率缩放到设计分辨率的比例。\n     */\n    public getScaleY (): number {\n        return this._scaleY;\n    }\n\n    /**\n     * @en Returns device pixel ratio for retina display.\n     * @zh 返回设备或浏览器像素比例。\n     *\n     * @deprecated since v3.4.0, please use screen.devicePixelRatio instead.\n     */\n    public getDevicePixelRatio (): number {\n        return screenAdapter.devicePixelRatio;\n    }\n\n    /**\n     * @en Returns the real location in view for a translation based on a related position\n     * @zh 将屏幕坐标转换为游戏视图下的坐标。\n     * @param tx - The X axis translation\n     * @param ty - The Y axis translation\n     * @param relatedPos - The related position object including \"left\", \"top\", \"width\", \"height\" informations\n     * @param out - The out object to save the conversion result\n     *\n     * @deprecated since v3.4.0\n     */\n    public convertToLocationInView (tx: number, ty: number, relatedPos: any, out: Vec2 = new Vec2()): Vec2 {\n        const x = screenAdapter.devicePixelRatio * (tx - relatedPos.left);\n        const y = screenAdapter.devicePixelRatio * ((relatedPos.top as number) + (relatedPos.height as number) - ty);\n        if (screenAdapter.isFrameRotated) {\n            out.x = screen.windowSize.width - y;\n            out.y = x;\n        } else {\n            out.x = x;\n            out.y = y;\n        }\n        return out;\n    }\n\n    // Convert location in Cocos screen coordinate to location in UI space\n    private _convertToUISpace (point) {\n        const viewport = this._viewportRect;\n        point.x = (point.x - viewport.x) / this._scaleX;\n        point.y = (point.y - viewport.y) / this._scaleY;\n    }\n\n    private _updateAdaptResult () {\n        legacyCC.director.root.resize(screen.windowSize.width, screen.windowSize.height);\n        // Frame size changed, do resize works\n        const width = this._designResolutionSize.width;\n        const height = this._designResolutionSize.height;\n\n        if (width > 0) {\n            this.setDesignResolutionSize(width, height, this._resolutionPolicy);\n        }\n\n        this.emit('canvas-resize');\n        this._resizeCallback?.();\n    }\n}\n\n/**\n * !en\n * Emit when design resolution changed.\n * !zh\n * 当设计分辨率改变时发送。\n * @event design-resolution-changed\n */\n\ninterface AdaptResult {\n    scale: number[];\n    viewport?: null | Rect;\n}\n\n/**\n * ContainerStrategy class is the root strategy class of container's scale strategy,\n * it controls the behavior of how to scale the cc.game.container and cc.game.canvas object\n */\nclass ContainerStrategy {\n    public static EQUAL_TO_FRAME: any;\n    public static PROPORTION_TO_FRAME: any;\n\n    public name = 'ContainerStrategy';\n\n    /**\n     * @en Manipulation before appling the strategy\n     * @zh 在应用策略之前的操作\n     * @param view - The target view\n     */\n    public preApply (_view: View) {\n    }\n\n    /**\n     * @en Function to apply this strategy\n     * @zh 策略应用方法\n     * @param view\n     * @param designedResolution\n     */\n    public apply (_view: View, designedResolution: Size) {\n    }\n\n    /**\n     * @en\n     * Manipulation after applying the strategy\n     * @zh 策略调用之后的操作\n     * @param view  The target view\n     */\n    public postApply (_view: View) {\n\n    }\n\n    protected _setupCanvas () {\n        // TODO: need to figure out why set width and height of canvas\n        const locCanvas = legacyCC.game.canvas;\n        if (locCanvas) {\n            const windowSize = screen.windowSize;\n            locCanvas.width = windowSize.width;\n            locCanvas.height = windowSize.height;\n        }\n    }\n}\n\n/**\n * @en\n * Emit when canvas resize.\n * @zh\n * 当画布大小改变时发送。\n * @event canvas-resize\n */\n\n/**\n * ContentStrategy class is the root strategy class of content's scale strategy,\n * it controls the behavior of how to scale the scene and setup the viewport for the game\n *\n * @class ContentStrategy\n */\nclass ContentStrategy {\n    public static EXACT_FIT: any;\n    public static SHOW_ALL: any;\n    public static NO_BORDER: any;\n    public static FIXED_HEIGHT: any;\n    public static FIXED_WIDTH: any;\n\n    public name = 'ContentStrategy';\n    private _result: AdaptResult;\n    constructor () {\n        this._result = {\n            scale: [1, 1],\n            viewport: null,\n        };\n    }\n\n    /**\n     * @en Manipulation before applying the strategy\n     * @zh 策略应用前的操作\n     * @param view - The target view\n     */\n    public preApply (_view: View) {\n    }\n\n    /**\n     * @en Function to apply this strategy\n     * The return value is {scale: [scaleX, scaleY], viewport: {new Rect}},\n     * The target view can then apply these value to itself, it's preferred not to modify directly its private variables\n     * @zh 调用策略方法\n     * @return The result scale and viewport rect\n     */\n    public apply (_view: View, designedResolution: Size): AdaptResult {\n        return { scale: [1, 1] };\n    }\n\n    /**\n     * @en Manipulation after applying the strategy\n     * @zh 策略调用之后的操作\n     * @param view - The target view\n     */\n    public postApply (_view: View) {\n    }\n\n    /**\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\n     */\n    public _buildResult (containerW, containerH, contentW, contentH, scaleX, scaleY): AdaptResult {\n        // Makes content fit better the canvas\n        if (Math.abs(containerW - contentW) < 2) {\n            contentW = containerW;\n        }\n        if (Math.abs(containerH - contentH) < 2) {\n            contentH = containerH;\n        }\n\n        const viewport = new Rect(Math.round((containerW - contentW) / 2),\n            Math.round((containerH - contentH) / 2),\n            contentW, contentH);\n\n        this._result.scale = [scaleX, scaleY];\n        this._result.viewport = viewport;\n        return this._result;\n    }\n}\n\n(() => {\n// Container scale strategys\n    /**\n     * @class EqualToFrame\n     * @extends ContainerStrategy\n     */\n    class EqualToFrame extends ContainerStrategy {\n        public name = 'EqualToFrame';\n        public apply (_view, designedResolution) {\n            screenAdapter.isProportionalToFrame = false;\n            this._setupCanvas();\n        }\n    }\n\n    /**\n     * @class ProportionalToFrame\n     * @extends ContainerStrategy\n     */\n    class ProportionalToFrame extends ContainerStrategy {\n        public name = 'ProportionalToFrame';\n        public apply (_view, designedResolution) {\n            screenAdapter.isProportionalToFrame = true;\n            this._setupCanvas();\n        }\n    }\n\n    // Alias: Strategy that makes the container's size equals to the frame's size\n    ContainerStrategy.EQUAL_TO_FRAME = new EqualToFrame();\n    // Alias: Strategy that scale proportionally the container's size to frame's size\n    ContainerStrategy.PROPORTION_TO_FRAME = new ProportionalToFrame();\n\n    // Content scale strategys\n    class ExactFit extends ContentStrategy {\n        public name = 'ExactFit';\n        public apply (_view: View, designedResolution: Size) {\n            const windowSize = screen.windowSize;\n            const containerW = windowSize.width;\n            const containerH = windowSize.height;\n            const scaleX = containerW / designedResolution.width;\n            const scaleY = containerH / designedResolution.height;\n\n            return this._buildResult(containerW, containerH, containerW, containerH, scaleX, scaleY);\n        }\n    }\n\n    class ShowAll extends ContentStrategy {\n        public name = 'ShowAll';\n        public apply (_view, designedResolution) {\n            const windowSize = screen.windowSize;\n            const containerW = windowSize.width;\n            const containerH = windowSize.height;\n            const designW = designedResolution.width;\n            const designH = designedResolution.height;\n            const scaleX = containerW / designW;\n            const scaleY = containerH / designH;\n            let scale = 0;\n            let contentW;\n            let contentH;\n\n            if (scaleX < scaleY) {\n                scale = scaleX;\n                contentW = containerW;\n                contentH = designH * scale;\n            } else {\n                scale = scaleY;\n                contentW = designW * scale;\n                contentH = containerH;\n            }\n\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\n        }\n    }\n\n    class NoBorder extends ContentStrategy {\n        public name = 'NoBorder';\n        public apply (_view, designedResolution) {\n            const windowSize = screen.windowSize;\n            const containerW = windowSize.width;\n            const containerH = windowSize.height;\n            const designW = designedResolution.width;\n            const designH = designedResolution.height;\n            const scaleX = containerW / designW;\n            const scaleY = containerH / designH;\n            let scale;\n            let contentW;\n            let contentH;\n\n            if (scaleX < scaleY) {\n                scale = scaleY;\n                contentW = designW * scale;\n                contentH = containerH;\n            } else {\n                scale = scaleX;\n                contentW = containerW;\n                contentH = designH * scale;\n            }\n\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\n        }\n    }\n\n    class FixedHeight extends ContentStrategy {\n        public name = 'FixedHeight';\n        public apply (_view, designedResolution) {\n            const windowSize = screen.windowSize;\n            const containerW = windowSize.width;\n            const containerH = windowSize.height;\n            const designH = designedResolution.height;\n            const scale = containerH / designH;\n            const contentW = containerW;\n            const contentH = containerH;\n\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\n        }\n    }\n\n    class FixedWidth extends ContentStrategy {\n        public name = 'FixedWidth';\n        public apply (_view, designedResolution) {\n            const windowSize = screen.windowSize;\n            const containerW = windowSize.width;\n            const containerH = windowSize.height;\n            const designW = designedResolution.width;\n            const scale = containerW / designW;\n            const contentW = containerW;\n            const contentH = containerH;\n\n            return this._buildResult(containerW, containerH, contentW, contentH, scale, scale);\n        }\n    }\n\n    // Alias: Strategy to scale the content's size to container's size, non proportional\n    ContentStrategy.EXACT_FIT = new ExactFit();\n    // Alias: Strategy to scale the content's size proportionally to maximum size and keeps the whole content area to be visible\n    ContentStrategy.SHOW_ALL = new ShowAll();\n    // Alias: Strategy to scale the content's size proportionally to fill the whole container area\n    ContentStrategy.NO_BORDER = new NoBorder();\n    // Alias: Strategy to scale the content's height to container's height and proportionally scale its width\n    ContentStrategy.FIXED_HEIGHT = new FixedHeight();\n    // Alias: Strategy to scale the content's width to container's width and proportionally scale its height\n    ContentStrategy.FIXED_WIDTH = new FixedWidth();\n})();\n\n/**\n * @en ResolutionPolicy class is the root strategy class of scale strategy,\n * its main task is to maintain the compatibility with Cocos2d-x.\n *\n * @zh ResolutionPolicy 类是适配策略的根策略类，它的主要任务是保持与 Cocos2d-x 的兼容性。\n */\nexport class ResolutionPolicy {\n    /**\n     * @en The entire application is visible in the specified area without trying to preserve the original aspect ratio.\n     * Distortion can occur, and the application may appear stretched or compressed.\n     *\n     * @zh 整个应用程序在指定区域可见，无需尝试保留原始纵横比，\n     * 可能会发生变形，出现画面拉伸或压缩。\n     */\n    public static EXACT_FIT = 0;\n    /**\n     * @en The entire application fills the specified area, without distortion but possibly with some cropping,\n     * while maintaining the original aspect ratio of the application.\n     *\n     * @zh 整个应用程序填充指定区域，没有变形，但可能有一些裁剪，\n     * 同时保持画面的原始纵横比。\n     */\n    public static NO_BORDER = 1;\n    /**\n     * @en The entire application is visible in the specified area without distortion while maintaining the original\n     * aspect ratio of the application. Borders can appear on two sides of the application.\n     *\n     * @zh 整个应用程序在指定区域可见，没有变形，同时保持原始纵横比，\n     * 边框可能出现在画面的旁侧。\n     */\n    public static SHOW_ALL = 2;\n    /**\n     * @en The application takes the height of the design resolution size and modifies the width of the internal\n     * canvas so that it fits the aspect ratio of the device\n     * no distortion will occur however you must make sure your application works on different\n     * aspect ratios\n     *\n     * @zh 该应用程序采用设计分辨率大小的高度并修改内部画布的宽度，使其适合设备的纵横比，不会发生变形，\n     * 但是您必须确保您的应用程序在不同的纵横比的设备下工作。\n     */\n    public static FIXED_HEIGHT = 3;\n    /**\n     * @en The application takes the width of the design resolution size and modifies the height of the internal\n     * canvas so that it fits the aspect ratio of the device\n     * no distortion will occur however you must make sure your application works on different\n     * aspect ratios\n     *\n     * @zh 该应用程序采用设计分辨率大小的宽度并修改内部画布的高度，使其适合设备的纵横比，不会发生变形\n     * 但是您必须确保您的应用程序在不同的纵横比的设备下工作。\n     */\n    public static FIXED_WIDTH = 4;\n    /**\n     * @en Unknown policy\n     *\n     * @zh 未知的策略\n     */\n    public static UNKNOWN = 5;\n    public static ContainerStrategy: typeof ContainerStrategy = ContainerStrategy;\n    public static ContentStrategy: typeof ContentStrategy = ContentStrategy;\n\n    public name = 'ResolutionPolicy';\n\n    private _containerStrategy: null | ContainerStrategy;\n    private _contentStrategy: null | ContentStrategy;\n\n    /**\n     * Constructor of ResolutionPolicy\n     * @param containerStg\n     * @param contentStg\n     */\n    constructor (containerStg: ContainerStrategy, contentStg: ContentStrategy) {\n        this._containerStrategy = null;\n        this._contentStrategy = null;\n        this.setContainerStrategy(containerStg);\n        this.setContentStrategy(contentStg);\n    }\n\n    get canvasSize () {\n        return screen.windowSize;\n    }\n\n    /**\n     * @en Manipulation before applying the resolution policy\n     * @zh 策略应用前的操作\n     * @param _view The target view\n     */\n    public preApply (_view: View) {\n        this._contentStrategy!.preApply(_view);\n    }\n\n    /**\n     * @en Function to apply this resolution policy\n     * The return value is {scale: [scaleX, scaleY], viewport: {new Rect}},\n     * The target view can then apply these value to itself, it's preferred not to modify directly its private variables\n     * @zh 调用策略方法\n     * @param _view - The target view\n     * @param designedResolution - The user defined design resolution\n     * @return An object contains the scale X/Y values and the viewport rect\n     */\n    public apply (_view: View, designedResolution: Size) {\n        this._containerStrategy!.apply(_view, designedResolution);\n        return this._contentStrategy!.apply(_view, designedResolution);\n    }\n\n    /**\n     * @en Manipulation after appyling the strategy\n     * @zh 策略应用之后的操作\n     * @param _view - The target view\n     */\n    public postApply (_view: View) {\n        this._contentStrategy!.postApply(_view);\n    }\n\n    /**\n     * @en Setup the container's scale strategy\n     * @zh 设置容器的适配策略\n     * @param containerStg The container strategy\n     */\n    public setContainerStrategy (containerStg: ContainerStrategy) {\n        if (containerStg instanceof ContainerStrategy) {\n            this._containerStrategy = containerStg;\n        }\n    }\n\n    /**\n     * @en Setup the content's scale strategy\n     * @zh 设置内容的适配策略\n     * @param contentStg The content strategy\n     */\n    public setContentStrategy (contentStg: ContentStrategy) {\n        if (contentStg instanceof ContentStrategy) {\n            this._contentStrategy = contentStg;\n        }\n    }\n}\nlegacyCC.ResolutionPolicy = ResolutionPolicy;\n\n/**\n * @en view is the singleton view object.\n * @zh view 是全局的视图单例对象。\n */\nexport const view = View.instance = legacyCC.view = new View();\ndirector.registerSystem('view', view, 0);\n\n/**\n * @en winSize is the alias object for the size of the current game window.\n * @zh winSize 为当前的游戏窗口的大小。\n *\n * @deprecated since v3.3, please use view.getVisibleSize() instead.\n */\nlegacyCC.winSize = localWinSize;\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\nimport { markAsWarning, removeProperty, replaceProperty } from '../utils';\nimport { sys } from './sys';\nimport { View } from './view';\nimport { legacyCC } from '../global-exports';\nimport { screen } from './screen';\n\n// #region deprecation on view\nremoveProperty(View.prototype, 'View.prototype', [\n    {\n        name: 'isAntiAliasEnabled',\n        suggest: 'The API of Texture2d have been largely modified, no alternative',\n    },\n    {\n        name: 'enableAntiAlias',\n        suggest: 'The API of Texture2d have been largely modified, no alternative',\n    },\n]);\nmarkAsWarning(View.prototype, 'View.prototype', [\n    {\n        name: 'adjustViewportMeta',\n    },\n    {\n        name: 'enableAutoFullScreen',\n        suggest: 'use screen.requestFullScreen() instead.',\n    },\n    {\n        name: 'isAutoFullScreenEnabled',\n    },\n    {\n        name: 'setCanvasSize',\n        suggest: 'setting size in CSS pixels is not recommended, please use screen.windowSize instead.',\n    },\n    {\n        name: 'getCanvasSize',\n        suggest: 'please use screen.windowSize instead.',\n    },\n    {\n        name: 'getFrameSize',\n        suggest: 'getting size in CSS pixels is not recommended, please use screen.windowSize instead.',\n    },\n    {\n        name: 'setFrameSize',\n        suggest: 'setting size in CSS pixels is not recommended, please use screen.windowSize instead.',\n    },\n    {\n        name: 'getDevicePixelRatio',\n        suggest: 'use screen.devicePixelRatio instead.',\n    },\n    {\n        name: 'convertToLocationInView',\n    },\n    {\n        name: 'enableRetina',\n    },\n    {\n        name: 'isRetinaEnabled',\n    },\n    {\n        name: 'setRealPixelResolution',\n    },\n]);\nmarkAsWarning(legacyCC, 'cc', [\n    {\n        name: 'winSize',\n        suggest: 'please use view.getVisibleSize() instead.',\n    },\n]);\n// #endregion deprecation on view\n// deprecate capabilities field\nmarkAsWarning(sys, 'sys', [\n    {\n        name: 'capabilities',\n        suggest: 'please use sys.hasFeature() method instead.',\n    },\n]);\n\n// deprecate languageCode field\nreplaceProperty(sys, 'sys',\n    ['UNKNOWN', 'ENGLISH', 'CHINESE', 'FRENCH', 'ITALIAN',\n        'GERMAN', 'SPANISH', 'DUTCH', 'RUSSIAN', 'KOREAN',\n        'JAPANESE', 'HUNGARIAN', 'PORTUGUESE', 'ARABIC', 'NORWEGIAN',\n        'POLISH', 'TURKISH', 'UKRAINIAN', 'ROMANIAN', 'BULGARIAN'].map((item) => ({\n        name: `LANGUAGE_${item}`,\n        newName: item,\n        target: sys.Language,\n        targetName: 'sys.Language',\n    })));\n\n// deprecate os field\nreplaceProperty(sys, 'sys',\n    ['UNKNOWN', 'IOS', 'ANDROID', 'WINDOWS', 'LINUX', 'OSX'].map((item) => ({\n        name: `OS_${item}`,\n        newName: item,\n        target: sys.OS,\n        targetName: 'sys.OS',\n    })));\n\n// deprecate browserType field\nreplaceProperty(sys, 'sys',\n    ['UNKNOWN', 'WECHAT', 'ANDROID', 'IE', 'EDGE', 'QQ', 'MOBILE_QQ',\n        'UC', 'UCBS', 'BAIDU_APP', 'BAIDU', 'MAXTHON', 'OPERA',\n        'OUPENG', 'MIUI', 'FIREFOX', 'SAFARI', 'CHROME', 'LIEBAO',\n        'QZONE', 'SOUGOU', 'HUAWEI'].map((item) => ({\n        name: `BROWSER_TYPE_${item}`,\n        newName: item,\n        target: sys.BrowserType,\n        targetName: 'sys.BrowserType',\n    })));\nreplaceProperty(sys, 'sys', [\n    {\n        name: 'BROWSER_TYPE_360',\n        newName: 'BROWSER_360',\n        target: sys.BrowserType,\n        targetName: 'sys.BrowserType',\n    },\n]);\n\n// deprecate platform field\nreplaceProperty(sys, 'sys',\n    ['UNKNOWN', 'EDITOR_PAGE', 'EDITOR_CORE', 'MOBILE_BROWSER', 'DESKTOP_BROWSER', 'WIN32', 'MACOS', 'IOS', 'ANDROID', 'OHOS',\n        'WECHAT_GAME', 'BAIDU_MINI_GAME', 'XIAOMI_QUICK_GAME', 'ALIPAY_MINI_GAME', 'BYTEDANCE_MINI_GAME',\n        'OPPO_MINI_GAME', 'VIVO_MINI_GAME', 'HUAWEI_QUICK_GAME', 'COCOSPLAY',  'LINKSURE_MINI_GAME', 'QTT_MINI_GAME'].map((item) => ({\n        name: item,\n        target: sys.Platform,\n        targetName: 'sys.Platform',\n    })));\n\n// remove platform field\nreplaceProperty(sys, 'sys', [\n    {\n        name: 'IPHONE',\n        newName: 'IOS',\n        target: sys.Platform,\n        targetName: 'sys.Platform',\n    },\n    {\n        name: 'IPAD',\n        newName: 'IOS',\n        target: sys.Platform,\n        targetName: 'sys.Platform',\n    },\n]);\nremoveProperty(sys, 'sys',\n    ['LINUX', 'BLACKBERRY', 'NACL', 'EMSCRIPTEN', 'TIZEN',\n        'WINRT', 'WP8', 'QQ_PLAY', 'FB_PLAYABLE_ADS'].map((item) => ({\n        name: item,\n    })));\nreplaceProperty(sys, 'sys', [\n    {\n        name: 'windowPixelResolution',\n        target: screen,\n        targetName: 'screen',\n        newName: 'windowSize',\n    },\n]);\n\n// deprecate screen API\nmarkAsWarning(screen, 'screen', [\n    {\n        name: 'autoFullScreen',\n        suggest: 'please use screen.requestFullScreen() instead.',\n    },\n    {\n        name: 'disableAutoFullScreen',\n    },\n]);\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n// Wasm Memory Page Size is 65536\nexport const pageSize = 65536; // 64KiB\n\n// How many pages of the wasm memory\n// TODO: let this can be canfiguable by user.\nexport const pageCount = 250;\n\n// How mush memory size of the wasm memory\nexport const memorySize = pageSize * pageCount; // 16 MiB\n\n// The import function used in c++ code, same as DLL Import\nexport const importFunc = {\n    syncPhysicsToGraphics (id: number) {\n        const bt = globalThis.Bullet;\n        const body = bt.CACHE.getWrapper(id, bt.BODY_CACHE_NAME);\n        body.syncPhysicsToGraphics();\n    },\n};\n","/*\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated engine source code (the \"Software\"), a limited,\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\n to use Cocos Creator solely to develop games on your target platforms. You shall\n not use Cocos Creator software for developing other software or tools that's\n used for developing games. You are not granted to publish, distribute,\n sublicense, and/or sell copies of Cocos Creator.\n\n The software or tools in this License Agreement are licensed, not sold.\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n */\n\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport bulletModule, { bulletType } from '@cocos/bullet';\nimport { WECHAT, RUNTIME_BASED } from 'internal:constants';\nimport { physics } from '../../../exports/physics-framework';\nimport { game } from '../../core/game';\nimport { sys } from '../../core/platform';\nimport { pageSize, pageCount, importFunc } from './bullet-env';\n\nlet bulletLibs: any = bulletModule;\nif (globalThis.BULLET) {\n    console.log('[Physics][Bullet]: Using the external Bullet libs.');\n    bulletLibs = globalThis.BULLET;\n}\n\ninterface instanceExt extends Bullet.instance {\n    CACHE: any,\n    BODY_CACHE_NAME: string,\n}\n\nexport const bt: instanceExt = {} as any;\nglobalThis.Bullet = bt;\nbt.BODY_CACHE_NAME = 'body';\n\nexport function waitForAmmoInstantiation () {\n    // refer https://stackoverflow.com/questions/47879864/how-can-i-check-if-a-browser-supports-webassembly\n    const supported = (() => {\n        // iOS 15.4 has some wasm memory issue, can not use wasm for bullet\n        const isiOS15_4 = (sys.os === sys.OS.IOS || sys.os === sys.OS.OSX) && sys.isBrowser\n        && /(OS 15_4)|(Version\\/15.4)/.test(window.navigator.userAgent);\n        if (isiOS15_4) {\n            return false;\n        }\n        try {\n            if (typeof WebAssembly === 'object'\n                && typeof WebAssembly.instantiate === 'function') {\n                const module = new WebAssembly.Module(new Uint8Array([0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00]));\n                if (module instanceof WebAssembly.Module) {\n                    return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n                }\n            }\n        } catch (e) {\n            return false;\n        }\n        return false;\n    })();\n    return Promise.resolve().then(() => {\n        if (bulletType === 'fallback') {\n            return (bulletModule as any)(supported) as string | typeof bulletModule;\n        }\n        return bulletLibs as string | typeof bulletModule;\n    }).then((module) => {\n        if (typeof module === 'string') {\n            console.info('[Physics][Bullet]: Using wasm Bullet libs.');\n            const infoReport = (msg: any) => { console.info(msg); };\n            const errorReport = (msg: any) => { console.error(msg); };\n            const memory = new WebAssembly.Memory({ initial: pageCount });\n            const importObject = {\n                cc: importFunc,\n                wasi_snapshot_preview1: { fd_close: infoReport, fd_seek: infoReport, fd_write: infoReport },\n                env: { memory },\n            };\n            return new Promise<void>((resolve, reject) => {\n                function instantiateWasm (buff: any) {\n                    WebAssembly.instantiate(buff, importObject).then((results) => {\n                        const btInstance = results.instance.exports as unknown as Bullet.instance;\n                        Object.assign(bt, btInstance);\n                        resolve();\n                    }, errorReport);\n                }\n\n                if (WECHAT || RUNTIME_BASED) {\n                    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n                    const wasmFilePath = `cocos-js/${module}` as any;\n                    instantiateWasm(wasmFilePath);\n                } else {\n                    fetch(module).then((response) => {\n                        response.arrayBuffer().then((buff) => {\n                            instantiateWasm(buff);\n                        }, errorReport);\n                    }, errorReport);\n                }\n            });\n        } else {\n            console.info('[Physics][Bullet]: Using asmjs Bullet libs.');\n            const env: any = importFunc;\n            const wasmMemory: any = {};\n            wasmMemory.buffer = new ArrayBuffer(pageSize * pageCount);\n            env.memory = wasmMemory;\n            const btInstance = module(env, wasmMemory);\n            Object.assign(bt, btInstance);\n            return new Promise<void>((resolve, reject) => { resolve(); });\n        }\n    });\n}\n\ngame.onPostInfrastructureInitDelegate.add(waitForAmmoInstantiation);\n"],"names":["from","to","value","a","b","Math","abs","prototype","attrs","forEach","key","Object","defineProperty","enumerable","target","format","offset","length","stride","out","Format","R32F","byteLength","info","FormatInfos","size","reader","_getDataViewType","componentBytesLength","count","nSeg","floor","isLittleEndian","sys","iSeg","x","iComponent","y","data","writer","onProgress","defaultProgressCallback","array","index","object","lerp","constructor","sMetadataTag","curve","RealCurve","assignSorted","interpolationMode","RealInterpolationMode","CUBIC","times","defaultLogTimes","checkList","_checkObsoleteByName","ccNamespace","_cachedProxy","Proxy","get","name","receiver","Reflect","EPSILON","max","min","randomRange","seed","pseudoRandomRange","INT_MAX","sign","v","log2","r","shift","popCount","countTrailingZeros","c","nextPow2","REVERSE_TABLE","Array","tab","i","s","mask","INT_BITS","n","z","t","_global","window","global","legacyCC","internal","engineVersion","CocosEngine","ENGINE_VERSION","cc","ERROR_MAP_URL","logList","ccLog","console","log","bind","ccWarn","ccError","ccAssert","condition","message","optionalParams","formatString","ccDebug","js","formatStr","apply","concat","warn","error","assert","debug","_resetDebugSetting","mode","DebugMode","NONE","ERROR","logToWebPage","msg","game","canvas","logDiv","document","createElement","setAttribute","height","logDivStyle","style","zIndex","position","top","left","logListStyle","backgroundColor","borderBottom","borderTopWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderLeftStyle","borderRightStyle","padding","margin","appendChild","parentNode","scrollTop","scrollHeight","ERROR_FOR_WEB_PAGE","INFO_FOR_WEB_PAGE","errorText","Error","INFO","VERBOSE","vendorDebug","_throw","error_","stack","getTypedFormatter","type","id","args","join","logFormatter","logID","warnFormatter","warnID","errorFormatter","errorID","assertFormatter","assertID","getError","errorId","param","isDisplayStats","profiler","isShowingStats","setDisplayStats","displayStats","showStats","hideStats","replaceProperty","removeProperty","markAsWarning","replacePropertyLog","markAsWarningLog","removePropertyLog","messageID","messageMap","Map","dp","n2","newp","f","item","logTimes","owner","ownerName","properties","set","undefined","newName","targetName","sameTarget","suggest","customFunction","call","this","arguments","customSetter","customGetter","hasSetter","hasGetter","deprecatedProp","descriptor","getOwnPropertyDescriptor","configurable","oldValue","writable","d","oldGet","oldSet","_defaultGetSet","topLevelDeprecateList","deprecateModuleExportedName","deprecateList","deprecateName","deprecateInfo","checkName","since","removed","MutableForwardIterator","remove","indexOf","removeAt","splice","fastRemove","fastRemoveAt","push","removeIf","predicate","findIndex","contains","removals","l","objects","len","cloned","IDGenerator","category","prefix","random","getNewId","tempCIDGenerator","aliasesTag","Symbol","classIdTag","isNumber","Number","isString","String","isEmptyObject","obj","propertyName","value_","getset","getter","setter","createMap","forceDictMode","map","create","getClassName","objOrCtor","hasOwnProperty","retval","toString","arr","str","charAt","exec","obsolete","obsoleted","newExpr","extractPropName","oldProp","newProp","obsoletes","objName","props","REGEXP_NUM_OR_STR","REGEXP_STR","subst","hasSubstitution","test","arg","regExpToTest","notReplaceFunction","replace","shiftArguments","getPropertyDescriptor","pd","getPrototypeOf","_copyprop","source","addon","sources","mixin","extend","cls","base","p","getSuper","proto","dunderProto","isChildClassOf","subclass","superclass","clear","keys","isTempClassId","startsWith","_idToClass","_nameToClass","setup","tag","table","allowExist","registered","_setClassId","doSetClassName","setClassName","className","setClassAlias","alias","nameRegistry","idRegistry","ok","classAliases","unregisterClass","constructors","classId","classname","aliases","iAlias","_getClassById","getClassById","getClassByName","_getClassId","allowTempId","getClassId","res","Pool","_0","_1","_pool","_cleanup","cleanupFunc","_get","cache","put","pool","resize","jsarray","assign","BitMask","lastIndex","val","isInteger","parseFloat","reverseKey","Enum","update","assertIsEnum","enumType","updateList","enums","__enums__","sort","ccenum","excepts","propertyNames","getOwnPropertyNames","isBitMask","BitMaskType","getList","BitMaskDef","__bitmask__","bitlist","isArray","isEnum","Category","ValueType","clone","equals","Settings","_settings","_override","init","path","overrides","categoryName","overrideSettings","Promise","resolve","reject","xhr","XMLHttpRequest","open","responseType","onload","_this","JSON","parse","response","onerror","send","querySettings","categorySettings","settings","macro","SUPPORT_TEXTURE_FORMATS","KEY","none","back","menu","backspace","enter","ctrl","alt","pause","capslock","escape","space","pageup","pagedown","end","home","up","right","down","select","insert","Delete","e","g","h","j","k","m","o","q","u","w","num0","num1","num2","num3","num4","num5","num6","num7","num8","num9","numdel","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","numlock","scrolllock","semicolon","equal","comma","dash","period","forwardslash","grave","openbracket","backslash","closebracket","quote","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter","RAD","PI","DEG","REPEAT_FOREVER","MAX_VALUE","FLT_EPSILON","ORIENTATION_PORTRAIT","ORIENTATION_LANDSCAPE","ORIENTATION_AUTO","ENABLE_TILEDMAP_CULLING","TOUCH_TIMEOUT","ENABLE_TRANSPARENT_CANVAS","ENABLE_WEBGL_ANTIALIAS","ENABLE_ANTIALIAS_FXAA","ENABLE_BLOOM","CLEANUP_IMAGE_CACHE","ENABLE_MULTI_TOUCH","MAX_LABEL_CANVAS_POOL_SIZE","ENABLE_WEBGL_HIGHP_STRUCT_VALUES","BATCHER2D_MEM_INCREMENT","CUSTOM_PIPELINE_NAME","defaultValues","ENGINE","BUILTIN_CLASSID_RE","values","charCodeAt","BASE64_VALUES","propertyDefine","ctor","sameNameGetSets","diffNameGetSets","define","np","propName","getterFunc","suffix","toUpperCase","slice","gs","pushToMap","pushFront","exists","refNode","otherNode","compareDocumentPosition","node","isDomNode","Node","nodeType","nodeName","callInNextTick","callback","p1","p2","setTimeout","isPlainEmptyObj_DEV","clampf","min_inclusive","max_inclusive","temp","degreesToRadians","angle","radiansToDegrees","misc","funcName","Function","DELIMETER","createAttrsSingle","superAttrs","createAttrs","getClassAttrs","superClass","chains","Class","getInheritanceChain","__attrs__","attr","ret","setClassAttr","PrimitiveType","defaultValue","CCInteger","Integer","CCFloat","Float","CCBoolean","Boolean","CCString","getTypeChecker_ET","attributeName","mainPropertyName","propInfo","mainPropAttrs","mainPropAttrsType","defaultVal","defaultType","type_lowerCase","toLowerCase","typeCtor","classCtor","mainPropName","defaultDef","getDefault","typename","SerializableAttrs","serializable","editorOnly","formerlySerializedAs","parseNotify","notify","newKey","newValue","canUsedInGet","parseType","_wrapOptions","isGetset","_default","_short","getFullFormOfProperty","options","PropertyStashInternalFlag","requiringFrames","peek","_RF","module","uuid","script","importMeta","exports","beh","pop","frameInfo","anykey","attributeUtils","CCCLASS_TAG","ENUM_TAG","BITMASK_TAG","defineProp","pushUnique","__props__","appendProp","parseAttributes","defineGetSet","CCClass","baseClass","Component","frame","RF","$super","doDefine","_sealed","fullForm","preprocessAttrs","__values__","filter","prop","declareProperties","editor","_registerEditorProps","isCCClassOrFastDefined","_constructor$hasOwnPr2","_isCCClass","_constructor$hasOwnPr","fastDefine","serializableFields","Attr","chain","PrimitiveTypes","attributes","propertyNamePrefix","initAttrs","normalizedSerializable","parseSimpleAttribute","expectType","__internalFlags","STANDALONE","IMPLICIT_SERIALIZABLE","range","escapeForJS","stringify","IDENTIFIER_RE","getNewValueTypeCode","clsName","_d2r","_r2d","approx","maxDiff","clamp","clamp01","ratio","toRadian","toDegree","pseudoRandom","repeat","pingPong","absMaxComponent","Vec4","copy","add","subtract","multiply","divide","ceil","round","multiplyScalar","scaleAndAdd","scale","distance","sqrt","squaredDistance","lengthSqr","negate","inverse","inverseSafe","normalize","dot","phi","cosTheta","sinTheta","cos","sin","transformMat4","m00","m04","m08","m12","m01","m05","m09","m13","m02","m06","m10","m14","m03","m07","m11","m15","transformAffine","transformQuat","_x","_y","_z","_w","ix","iy","iz","iw","toArray","ofs","fromArray","strictEquals","epsilon","other","equals4f","strictEquals4f","toFixed","minInclusive","maxInclusive","add4f","subtract4f","scalar","multiply4f","divide4f","negative","vector","cross","ax","ay","az","bx","by","bz","matrix","v4","ZERO","freeze","ONE","NEG_ONE","toFloat","Color","_val","fromHEX","toVec4","color","srgb8BitToLinear","fromVec4","linearToSrgb8Bit","hexString","substring","parseInt","substr","isNaN","hex","toCSS","opt","toHEX","fmt","toRGBValue","fromHSV","toHSV","hsv","delta","_set_r_unsafe","red","_set_g_unsafe","green","_set_b_unsafe","blue","_set_a_unsafe","alpha","RangeError","SRGB_8BIT_TO_LINEAR","TABLE","WHITE","GRAY","BLACK","TRANSPARENT","RED","GREEN","BLUE","CYAN","MAGENTA","YELLOW","Vec3","zero","invert","invertSafe","rhw","transformMat4Normal","transformMat3","transformRTS","transformInverseRTS","rotateX","rx","ry","rz","rotateY","rotateZ","a0","a1","a2","b0","b1","b2","v3_1","v3_2","cosine","acos","projectOnPlane","project","sqrLen","equals3f","strictEquals3f","add3f","subtract3f","multiply3f","divide3f","UNIT_X","UNIT_Y","UNIT_Z","RIGHT","UP","FORWARD","v3","Mat3","m20","m21","m22","identity","transpose","a01","a02","a12","a00","a10","a11","a20","a21","a22","b01","b11","b21","det","determinant","b00","b02","b10","b12","b20","b22","multiplyMat4","transform","rotate","rad","fromMat4","fromViewUp","view","fromTranslation","fromScaling","fromRotation","fromQuat","x2","y2","z2","xx","yx","yy","zx","zy","zz","wx","wy","wz","inverseTransposeMat4","a03","a13","a23","a30","a31","a32","a33","b03","b04","b05","b06","b07","b08","b09","multiplyScalarAndAdd","mat","vec","IDENTITY","Quat","rotationTo","fromAxisAngle","getAxisAngle","outAxis","bw","rotateAround","rot","axis","qt_1","rotateAroundLocal","calculateW","slerp","scale0","scale1","cosom","omega","sinom","sqlerp","qt_2","invDot","conjugate","fromAxes","xAxis","yAxis","zAxis","m3_1","fromMat3","trace","fromEuler","halfToRad","sx","cx","sy","cy","sz","cz","fromAngleZ","toAxisX","fy","fz","toAxisY","fx","toAxisZ","toEuler","outerZ","bank","heading","attitude","atan2","sqx","sqy","sqz","asin","getEulerAngles","quat","preTransforms","Mat4","m23","m30","m31","m32","m33","b3","translate","fromXRotation","fromYRotation","fromZRotation","fromRT","xy","xz","yz","getTranslation","getScaling","getRotation","S","toRTS","fromRTS","fromRTSOrigin","ox","oy","oz","frustum","bottom","near","far","rl","tb","nf","perspective","fov","aspect","isFOVY","minClipZ","projectionSignY","orientation","tan","preTransform","ortho","lr","bt","dx","dy","lookAt","eye","center","eyex","eyey","eyez","upx","upy","upz","z0","z1","x0","x1","y0","y1","inverseTranspose","getScale","mat4","Vec2","v2_1","v2_2","equals2f","strictEquals2f","add2f","subtract2f","multiply2f","divide2f","magSqr1","magSqr2","theta","signAngle","radians","v2","arg1","AffineTransform","tx","ty","affineTransform","t1","t2","transformVec2","point","transOrY","transformSize","width","transformRect","rect","or","ot","lbx","lby","rbx","rby","ltx","lty","rtx","rty","minX","maxX","minY","maxY","transformObb","out_bl","out_tl","out_tr","out_br","anAffineTransform","xa","xb","yc","yd","Size","Rect","fromMinMax","v1","intersection","one","axMin","ayMin","axMax","ayMax","bxMin","byMin","bxMax","byMax","union","bh","intersects","maxax","maxay","maxbx","maxby","containsRect","ol","ob","transformMat4ToPoints","out_lb","out_lt","out_rt","out_rb","ObjectType","Status","API","SurfaceTransform","Feature","FormatType","Type","BufferUsageBit","BufferFlagBit","MemoryAccessBit","MemoryUsageBit","TextureType","TextureUsageBit","TextureFlagBit","FormatFeatureBit","SampleCount","VsyncMode","Filter","Address","ComparisonFunc","StencilOp","BlendFactor","BlendOp","ColorMask","ShaderStageFlagBit","LoadOp","StoreOp","AccessFlagBit","ResolveMode","PipelineBindPoint","PrimitiveMode","PolygonMode","ShadeModel","CullMode","DynamicStateFlagBit","StencilFace","DescriptorType","QueueType","QueryType","CommandBufferType","ClearFlagBit","BarrierType","PassType","MATH_FLOAT_ARRAY","Float64Array","garbageCollectionManager","createFloatArray","_array","_finalizationRegistry","_gcObjects","WeakMap","registerGCObject","gcObject","finalizationRegistryCallback","token","destroy","unregister","GCObject","deepCopy","Ctor","AttributeName","DeviceCaps","maxVertexAttributes","maxVertexUniformVectors","maxFragmentUniformVectors","maxTextureUnits","maxImageUnits","maxVertexTextureUnits","maxColorRenderTargets","maxShaderStorageBufferBindings","maxShaderStorageBlockSize","maxUniformBufferBindings","maxUniformBlockSize","maxTextureSize","maxCubeMapTextureSize","uboOffsetAlignment","maxComputeSharedMemorySize","maxComputeWorkGroupInvocations","maxComputeWorkGroupSize","maxComputeWorkGroupCount","supportQuery","clipSpaceMinZ","screenSpaceSignY","clipSpaceSignY","DeviceOptions","enableBarrierDeduce","Offset","Extent","depth","TextureSubresLayers","mipLevel","baseArrayLayer","layerCount","TextureSubresRange","baseMipLevel","levelCount","TextureCopy","srcSubres","srcOffset","dstSubres","dstOffset","extent","TextureBlit","srcExtent","dstExtent","BufferTextureCopy","buffOffset","buffStride","buffTexHeight","texOffset","texExtent","texSubres","Viewport","minDepth","maxDepth","BindingMappingInfo","maxBlockCounts","maxSamplerTextureCounts","maxSamplerCounts","maxTextureCounts","maxBufferCounts","maxImageCounts","maxSubpassInputCounts","setIndices","SwapchainInfo","windowHandle","vsyncMode","ON","DeviceInfo","bindingMappingInfo","BufferInfo","usage","memUsage","flags","BufferViewInfo","buffer","DrawInfo","vertexCount","firstVertex","indexCount","firstIndex","vertexOffset","instanceCount","firstInstance","DispatchInfo","groupCountX","groupCountY","groupCountZ","indirectBuffer","indirectOffset","IndirectBuffer","drawInfos","TextureInfo","samples","externalRes","TEX2D","UNKNOWN","TextureViewInfo","texture","baseLevel","baseLayer","SamplerInfo","minFilter","magFilter","mipFilter","addressU","addressV","addressW","maxAnisotropy","cmpFunc","LINEAR","WRAP","ALWAYS","Uniform","UniformBlock","binding","members","UniformSamplerTexture","UniformSampler","UniformTexture","UniformStorageImage","memoryAccess","READ_WRITE","UniformStorageBuffer","UniformInputAttachment","ShaderStage","stage","Attribute","isNormalized","stream","isInstanced","location","ShaderInfo","stages","blocks","buffers","samplerTextures","samplers","textures","images","subpassInputs","InputAssemblerInfo","vertexBuffers","indexBuffer","ColorAttachment","sampleCount","loadOp","storeOp","barrier","isGeneralLayout","CLEAR","STORE","DepthStencilAttachment","depthLoadOp","depthStoreOp","stencilLoadOp","stencilStoreOp","SubpassInfo","inputs","colors","resolves","preserves","depthStencil","depthStencilResolve","depthResolveMode","stencilResolveMode","SubpassDependency","srcSubpass","dstSubpass","generalBarrier","bufferBarriers","bufferBarrierCount","textureBarriers","textureBarrierCount","RenderPassInfo","colorAttachments","depthStencilAttachment","subpasses","dependencies","GeneralBarrierInfo","prevAccesses","nextAccesses","FULL","TextureBarrierInfo","baseSlice","sliceCount","discardContents","srcQueue","dstQueue","BufferBarrierInfo","FramebufferInfo","renderPass","colorTextures","depthStencilTexture","DescriptorSetLayoutBinding","descriptorType","stageFlags","immutableSamplers","DescriptorSetLayoutInfo","bindings","DescriptorSetInfo","layout","PipelineLayoutInfo","setLayouts","InputState","CommandBufferInfo","queue","PRIMARY","QueueInfo","GRAPHICS","QueryPoolInfo","maxQueryObjects","forceWait","OCCLUSION","FormatInfo","hasAlpha","hasDepth","hasStencil","isCompressed","MemoryStatus","bufferSize","textureSize","DynamicStencilStates","writeMask","compareMask","reference","DynamicStates","viewport","scissor","blendConstant","lineWidth","depthBiasConstant","depthBiasClamp","depthBiasSlope","depthMinBounds","depthMaxBounds","stencilStatesFront","stencilStatesBack","GFXObject","objectType","_objectType","_objectID","_typedID","_idTable","COUNT","fill","UNORM","SNORM","UINT","INT","FLOAT","UFLOAT","DESCRIPTOR_BUFFER_TYPE","UNIFORM_BUFFER","DYNAMIC_UNIFORM_BUFFER","STORAGE_BUFFER","DYNAMIC_STORAGE_BUFFER","DESCRIPTOR_SAMPLER_TYPE","SAMPLER_TEXTURE","SAMPLER","TEXTURE","STORAGE_IMAGE","INPUT_ATTACHMENT","DESCRIPTOR_DYNAMIC_TYPE","DRAW_INFO_SIZE","IsPowerOf2","FormatSize","BC1","BC1_ALPHA","BC1_SRGB","BC1_SRGB_ALPHA","BC2","BC2_SRGB","BC3","BC3_SRGB","BC4","BC4_SNORM","BC6H_SF16","BC6H_UF16","BC7","BC7_SRGB","BC5","BC5_SNORM","ETC_RGB8","ETC2_RGB8","ETC2_SRGB8","ETC2_RGB8_A1","EAC_R11","EAC_R11SN","ETC2_RGBA8","ETC2_SRGB8_A1","EAC_RG11","EAC_RG11SN","PVRTC_RGB2","PVRTC_RGBA2","PVRTC2_2BPP","PVRTC_RGB4","PVRTC_RGBA4","PVRTC2_4BPP","ASTC_RGBA_4X4","ASTC_SRGBA_4X4","ASTC_RGBA_5X4","ASTC_SRGBA_5X4","ASTC_RGBA_5X5","ASTC_SRGBA_5X5","ASTC_RGBA_6X5","ASTC_SRGBA_6X5","ASTC_RGBA_6X6","ASTC_SRGBA_6X6","ASTC_RGBA_8X5","ASTC_SRGBA_8X5","ASTC_RGBA_8X6","ASTC_SRGBA_8X6","ASTC_RGBA_8X8","ASTC_SRGBA_8X8","ASTC_RGBA_10X5","ASTC_SRGBA_10X5","ASTC_RGBA_10X6","ASTC_SRGBA_10X6","ASTC_RGBA_10X8","ASTC_SRGBA_10X8","ASTC_RGBA_10X10","ASTC_SRGBA_10X10","ASTC_RGBA_12X10","ASTC_SRGBA_12X10","ASTC_RGBA_12X12","ASTC_SRGBA_12X12","FormatSurfaceSize","mips","_type2size","GetTypeSize","getTypedArrayConstructor","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","Float32Array","formatAlignment","alignTo","alignment","Buffer","BUFFER","_usage","_memUsage","_size","_stride","_count","_flags","_isBufferView","CommandBuffer","COMMAND_BUFFER","_queue","_type","_numDrawCalls","_numInstances","_numTris","Device","_gfxAPI","_renderer","_vendor","_features","_formatFeatures","_cmdBuff","_memoryStatus","_caps","_bindingMappingInfo","_samplers","_generalBarrierss","_textureBarriers","_bufferBarriers","hasFeature","feature","getFormatFeatures","Swapchain","SWAPCHAIN","_transform","_colorTexture","_depthStencilTexture","Framebuffer","FRAMEBUFFER","_renderPass","_colorTextures","getUint8ForString","getUint8ForArray","idx","murmurhash2_32_gc","input","getUint8","InputAssembler","INPUT_ASSEMBLER","_attributes","_attributesHash","_vertexBuffers","_indexBuffer","_indirectBuffer","_drawInfo","getVertexBuffer","computeAttributesHash","at","first","DescriptorSet","DESCRIPTOR_SET","_layout","_buffers","_textures","_isDirty","bindBuffer","bindingIndex","bindingIndices","descriptorIndex","descriptorIndices","bindSampler","sampler","bindTexture","getBuffer","getSampler","getTexture","DescriptorSetLayout","DESCRIPTOR_SET_LAYOUT","_bindings","_bindingIndices","_descriptorIndices","PipelineLayout","PIPELINE_LAYOUT","_setLayouts","RasterizerState","isDiscard","polygonMode","shadeModel","cullMode","isFrontFaceCCW","depthBiasEnabled","depthBias","depthBiasSlop","isDepthClip","isMultisample","FILL","GOURAND","BACK","reset","rs","DepthStencilState","depthTest","depthWrite","depthFunc","stencilTestFront","stencilFuncFront","stencilReadMaskFront","stencilWriteMaskFront","stencilFailOpFront","stencilZFailOpFront","stencilPassOpFront","stencilRefFront","stencilTestBack","stencilFuncBack","stencilReadMaskBack","stencilWriteMaskBack","stencilFailOpBack","stencilZFailOpBack","stencilPassOpBack","stencilRefBack","LESS","KEEP","dss","BlendTarget","blend","blendSrc","blendDst","blendEq","blendSrcAlpha","blendDstAlpha","blendAlphaEq","blendColorMask","ADD","ALL","BlendState","isA2C","isIndepend","blendColor","targets","setTarget","tg","PipelineStateInfo","shader","pipelineLayout","inputState","rasterizerState","depthStencilState","blendState","primitive","dynamicStates","bindPoint","TRIANGLE_LIST","PipelineState","PIPELINE_STATE","_shader","_pipelineLayout","_primitive","_is","_rs","_dss","_bs","_dynamicStates","Queue","QUEUE","RenderPass","RENDER_PASS","_colorInfos","_depthStencilInfo","_subpasses","_hash","computeHash","subpass","ia","ca","ds","Sampler","hash","_info","unpackFromHash","Shader","SHADER","_name","_stages","_blocks","Texture","_viewInfo","_isPowerOf2","_isTextureView","getLevelCount","GeneralBarrier","GLOBAL_BARRIER","TextureBarrier","TEXTURE_BARRIER","BufferBarrier","BUFFER_BARRIER","polyfills","defines","gfx","GFXDevice","GFXBuffer","GFXTexture","GFXSampler","GFXShader","GFXInputAssembler","GFXRenderPass","GFXFramebuffer","GFXPipelineState","GFXCommandBuffer","GFXQueue","GFXObjectType","GFXAttributeName","GFXType","GFXFormat","GFXBufferUsageBit","GFXMemoryUsageBit","GFXBufferFlagBit","GFXBufferAccessBit","GFXPrimitiveMode","GFXPolygonMode","GFXShadeModel","GFXCullMode","GFXComparisonFunc","GFXStencilOp","GFXBlendOp","GFXBlendFactor","GFXColorMask","GFXFilter","GFXAddress","GFXTextureType","GFXTextureUsageBit","GFXSampleCount","GFXTextureFlagBit","GFXShaderStageFlagBit","GFXDescriptorType","GFXCommandBufferType","GFXLoadOp","GFXStoreOp","GFXPipelineBindPoint","GFXDynamicStateFlagBit","GFXStencilFace","GFXQueueType","GFXRect","GFXViewport","GFXColor","GFXClearFlag","GFXOffset","GFXExtent","GFXTextureSubres","GFXTextureCopy","GFXBufferTextureCopy","GFXFormatType","GFXFormatInfo","GFXMemoryStatus","GFXFormatInfos","GFXFormatSize","GFXFormatSurfaceSize","GFXGetTypeSize","containerManager","_pools","_lastShrinkPassed","shrinkTimeSpan","addContainer","_poolHandle","removeContainer","tryShrink","dt","ScalableContainer","elementsPerBatch","dtor","_ctor","_elementsPerBatch","_nextAvail","_freepool","_dtor","alloc","free","freeArray","objs","readDtor","RecyclePool","fn","_fn","_data","_initSize","last","tmp","CachedArray","compareFn","_compareFn","editorExtrasTag","IsReplicated","objectsToDestroy","CCObject","_objFlags","_deferredDestroy","deleteCount","_destroyImmediate","_destruct","destruct","__destruct__","shouldSkipId","_BaseNode","idToSkip","propsToReset","propList","attrKey","func","statement","compileDestruct","_onPreDestroy","Flags","AllHideMasks","hideFlags","isCCObject","isValid","strictMode","Destroyed","_deserialize","DontSave","EditorOnly","Dirty","DontDestroy","PersistentMask","Destroying","Deactivating","LockedInEditor","HideInHierarchy","IsPreloadStarted","IsOnLoadStarted","IsOnLoadCalled","IsOnEnableCalled","IsStartCalled","IsEditorOnEnableCalled","IsPositionLocked","IsRotationLocked","IsScaleLocked","IsAnchorLocked","IsSizeLocked","empty","CallbackInfo","once","check","callbackInfoPool","CallbackList","callbackInfos","isInvoking","containCanceled","removeByCallback","cb","removeByTarget","cancel","cancelAll","purgeCanceled","callbackListPool","CallbacksInvoker","_callbackTable","_offCallback","on","hasEventListener","list","infos","removeAll","keyOrTarget","off","emit","arg0","arg2","arg3","arg4","rootInvoker","_registerOffCallback","Eventify","Eventified","targetOff","typeOrTarget","callbacksInvokerPrototype","propertyKeys","getOwnPropertySymbols","iPropertyKey","propertyKey","propertyDescriptor","EventTarget","BrowserType","Language","NetworkType","OS","Platform","AsyncDelegate","_delegates","includes","hasListener","dispatch","all","Orientation","SystemInfo","networkType","isNative","isBrowser","isMobile","platform","language","nativeLanguage","os","osVersion","osMainVersion","browserType","browserVersion","isXR","_battery","_featureMap","nav","navigator","ua","userAgent","getBattery","then","battery","LAN","MOBILE_BROWSER","DESKTOP_BROWSER","ArrayBuffer","DataView","setInt16","currLanguage","browserLanguage","split","ENGLISH","isAndroid","iOS","osMajorVersion","uaResult","maxTouchPoints","osName","appVersion","WINDOWS","IOS","OSX","LINUX","ANDROID","browserTypes","typeMap","micromessenger","WECHAT","wechat","weixin","trident","IE","edge","EDGE","BROWSER_360","mxbrowser","MAXTHON","OPERA","ubrowser","UC","huaweibrowser","HUAWEI","supportWebp","_tmpCanvas1","getContext","toDataURL","SAFARI","result","_$exec","supportImageBitmap","createImageBitmap","Blob","imageBitmap","close","supportTouch","documentElement","ontouchstart","EDITOR","supportMouse","onmouseup","WEBP","IMAGE_BITMAP","WEB_VIEW","VIDEO_PLAYER","SAFE_AREA","INPUT_TOUCH","EVENT_KEYBOARD","onkeyup","EVENT_MOUSE","EVENT_TOUCH","EVENT_ACCELEROMETER","DeviceMotionEvent","DeviceOrientationEvent","EVENT_GAMEPAD","getGamepads","webkitGetGamepads","EVENT_HANDLE","EVENT_HMD","_registerEvent","hiddenPropName","hidden","mozHidden","msHidden","webkitHidden","onHidden","_this2","onShown","changeList","addEventListener","event","visible","onfocus","getBatteryLevel","level","triggerGC","openURL","url","now","Date","restartJSVM","systemInfo","_PORTRAIT","_LEFT","WindowType","orientationMap","auto","AUTO","landscape","LANDSCAPE","portrait","PORTRAIT","ScreenAdapter","fnList","isFrameRotated","handleResizeEvent","_gameFrame","_gameContainer","_gameCanvas","_isProportionalToFrame","_cachedFrameStyle","_cachedContainerStyle","_cbToUpdateFrameBuffer","_supportFullScreen","_touchEventName","_onFullscreenChange","_onFullscreenError","_orientationChangeTimeoutId","_cachedFrameSize","_exactFitScreen","_fnGroup","_resolutionScale","_orientation","getElementById","insertBefore","fnGroup","requestFullscreen","cbToRebuildFrameBuffer","configOrientation","exactFitScreen","_resizeFrame","requestFullScreen","isFullScreen","windowSize","_doRequestFullScreen","fullscreenTarget","_getFullscreenTarget","capture","exitFullScreen","requestPromise","_this3","exitFullscreen","fullscreenerror","_this4","matchMedia","updateDPRChangeListener","dpr","devicePixelRatio","clearTimeout","_updateFrameState","fullscreenchange","_convertToSizeInCssPixels","clonedSize","sizeInCssPixels","display","_windowType","SubFrame","_updateContainer","winWidth","innerWidth","winHeight","innerHeight","transformOrigin","windowType","Fullscreen","fullscreenElement","body","_this5","isBrowserLandscape","isProportionalToFrame","containerW","containerH","designedResolution","getDesignResolutionSize","frameW","clientWidth","frameH","clientHeight","designW","designH","scaleX","scaleY","containerStyle","_windowSizeInCssPixels","resolutionScale","BrowserWindow","Unknown","screenAdapter","Screen","SCREEN","director","root","_director$root","pipeline","shadingScale","fullScreen","element","onFullScreenChange","onFullScreenError","err","autoFullScreen","disableAutoFullScreen","resolution","supportFullScreen","screen","LegacyRenderMode","RenderType","languageCode","windowPixelResolution","capabilities","opengl","webp","touches","mouse","keyboard","accelerometer","localStorage","getNetworkType","garbageCollect","isObjectValid","dump","renderType","RENDER_TYPE_WEBGL","setItem","removeItem","getItem","__isWebIOS14OrIPadOS14Env","restartVM","getSafeAreaRect","locView","safeAreaEdge","leftBottom","rightTop","_convertToUISpace","DeviceManager","initialized","_canvas","_renderType","renderMode","RENDERING","_determineRenderType","WEBGL","deviceInfo","useWebGL2","WebGL2RenderingContext","deviceCtors","WebGL2Device","WebGLDevice","EmptyDevice","_gfxDevice","initialize","HEADLESS","swapchainInfo","_swapchain","createSwapchain","oncontextmenu","CANVAS","supportRender","deviceManager","X","Y","Z","point_plane","plane_","pt_point_aabb","aabb_","halfExtents","pt_point_obb","obb_","dist","linePointA","linePointB","dir","dirSquaredLength","SHAPE_RAY","SHAPE_LINE","SHAPE_SPHERE","SHAPE_AABB","SHAPE_OBB","SHAPE_PLANE","SHAPE_TRIANGLE","SHAPE_FRUSTUM","SHAPE_FRUSTUM_ACCURATE","SHAPE_CAPSULE","SHAPE_SPLINE","Line","ex","ey","ez","fromPoints","start","Ray","dz","origin","computeHit","_v3_tmp","_offset","_min","_max","maxComponent","ERaycastMode","Sphere","_center","_radius","radius","minPos","maxPos","getBoundary","pos","translateAndRotate","setScale","mergePoint","half","mergePoints","points","mergeAABB","Triangle","pt","ab","ac","pvec","tvec","qvec","rayPlane","ray","plane","denom","rayTriangle","triangle","doubleSided","inv_det","raySphere","sphere","rSq","eSq","aLength","fSq","rayAABB","aabb","rayAABB2","t3","t4","t5","t6","tmin","tmax","tri","deOpt","minDis","fillResult","rayOBB","obb","rayCapsule","v3_0","v3_3","v3_4","v3_5","v3_6","sphere_0","capsule","radiusSqr","vRayNorm","A","ellipseCenter0","B","ellipseCenter1","BA","intersect","O","OA","VxBA","BO","OAxBA","ab2","iPos","iPosLen","tLimit","raySubMesh","Infinity","ANY","i0","i1","i2","CLOSEST","vertexIndex0","vertexIndex1","vertexIndex2","submesh","geometricInfo","positions","boundingBox","pm","primitiveMode","vb","ib","cnt","TRIANGLE_STRIP","rev","TRIANGLE_FAN","narrowphase","indices","rayMesh","mesh","renderingSubMeshes","struct","minPosition","maxPosition","sm","dis","subIndices","rayModel","modelRay","m4","model","wb","worldBounds","getWorldMatrix","subModels","subMesh","linePlane","line","lineTriangle","qp","ap","outPt","invDet","r_t","lineAABB","lineOBB","lineSphere","aMin","aMax","bMin","bMax","aabbWithAABB","aabb1","aabb2","getOBBVertices","a3","getInterval","vertices","projection","m3","absDot","aabbWithOBB","vertices2","getAABBVertices","aabbPlane","aabbFrustum","planes","aabbFrustumAccurate","out1","out2","obbPoint","obbPlane","obbFrustum","obbFrustumAccurate","obbWithOBB","obb1","obb2","obbCapsule","v3_verts8","v3_axis8","sphereOBB","axes","d0","d1","max_d","d_min","d_max","spherePlane","sphereFrustum","sphereFrustumAccurate","sphereWithSphere","sphere0","sphere1","sphereAABB","sphereCapsule","squaredR","capsuleWithCapsule","capsuleA","capsuleB","sN","tN","D","sD","tD","sc","tc","dP","aabbFrustumCompletelyInside","g1","g2","type1","type2","resolver","temp_mat","temp_vec4","Plane","nx","ny","nz","fromNormalAndPoint","normal","_v3_tmp2","_v3_tmp3","_v3_tmp4","_m3_tmp","transform_extent_m4","AABB","px","py","pz","hw","hh","hl","merge","toBoundingSphere","mergeFrustum","OBB","ox_1","ox_2","ox_3","oy_1","oy_2","oy_3","oz_1","oz_2","oz_3","transform_extent_m3","Capsule","halfHeight","rotation","updateCache","ws","halfWorldHeight","updateLocalCenter","_v","WrapModeMask","WrapMode","_nearTemp","_farTemp","_temp_v3","Frustum","createFromAABB","vec3_min","vec3_max","updatePlanes","camera","vertexes","inv","pl","invDist","binarySearchEpsilon","low","high","middle","createOrtho","halfWidth","Default","Normal","Reverse","Loop","PingPong","time","direction","stopped","iterations","frameIndex","iterator","ExtrapolationMode","TangentWeightMode","KeyframeCurve","_times","_values","next","done","keyframes","getKeyframeTime","getKeyframeValue","addKeyFrame","keyframeValue","_insertNewKeyframe","removeKeyframe","indexOfKeyframe","updateTime","setKeyframes","searchKeyframe","every","isSorted","nFrames","iNext","unshift","isZero","emptyDecorator","emptyDecoratorFn","emptySmartClassDecorator","makeSmartClassDecorator","decorate","makeEditorClassDecoratorFn","getClassCache","getSubDict","writeEditorClassProperty","CACHE_KEY","ccclass","decoratedProto","requireComponent","executionOrder","disallowMultiple","property","normalized","propertyStash","fullOptions","propertyRecord","setDefaultValue","mergePropertyOptions","getOrCreateClassStash","ccclassProto","getOrCreateEmptyPropertyStash","getOrCreatePropertyStash","classStash","classConstructor","initializer","getDefaultFromInitializer","actualDefaultValues","dummyObj","extractActualDefaultValues","setImplicitSerializable","uniquelyReferenced","executeInEditMode","playOnFocus","inspector","icon","help","editable","readOnly","displayName","tooltip","rangeMin","rangeStep","slide","displayOrder","disallowAnimation","integer","float","boolean","string","override","EditorExtendable","Cache","_map","has","find","Pipeline","funcs","_pipelineId","pipes","append","sync","task","isFinish","pipe","output","async","_flow","_weakMap","WeakRef","deref","weakRef","RequestType","assets","files","parsed","bundles","fetchPipeline","transformPipeline","assetsOverrideMap","BuiltinBundleName","presets","priority","preload","maxConcurrency","maxRequestsPerFrame","scene","bundle","remote","maxRetryCount","Task","_taskId","onComplete","onError","progress","_deadPool","param1","param2","param3","param4","recycle","MAX_DEAD_NUM","HexChars","_t","UuidTemplate","Indices","NaN","isFinite","decodeUuid","base64","lhs","rhs","_uuidRegex","getUuidFromURL","matches","getUrlWithUuid","__isNative__","nativeExt","ext","getAssetInfo","isScene","asset","SceneAsset","Scene","subTask","urls","requestItem","EXTNAME_RE","DIRNAME_RE","NORMALIZE_RE","segments","segment","extname","mainFileName","fileName","lastIndexOf","basename","extName","baseName","dirname","changeExtname","tempStr","changeBasename","isSameExt","_normalize","oldUrl","stripSep","getSeperator","Asset","loaded","_nativeUrl","_file","_ref","deserialize","nativeUrl","serialize","_setRawAsset","filename","inLibrary","_native","addRef","decRef","autoRelease","assetManager","_releaseManager","tryRelease","onLoaded","initDefault","_uuid","isDefault","validate","__nativeName__","createNode","Script","_Script","JavaScript","_JavaScript","TypeScript","_TypeScript","EventHandler","emitEvents","events","params","_genCompIdIfNeeded","compType","_componentId","comp","getComponent","handler","customEventData","_compName2Id","compName","_compId2Name","compId","_componentName","component","idGenerator","_sceneGetter","_id","_getRenderScene","renderScene","addComponent","typeOrClassName","getComponents","getComponentInChildren","getComponentsInChildren","_enabled","activeInHierarchy","_compScheduler","disableComp","unscheduleAllCallbacks","_nodeActivator","destroyComp","_removeComponent","_instantiate","instantiate","_clone","schedule","interval","delay","scheduler","getScheduler","paused","isTargetPaused","scheduleOnce","unschedule","callback_fn","unscheduleAllForTarget","trimLeft","compScheduler","enableComp","system","lateUpdate","__preload","onLoad","onEnable","onDisable","onDestroy","onFocusInEditor","onLostFocusInEditor","resetInEditor","_getLocalBounds","onRestore","_requireComponent","_executionOrder","reqComp","order","MissingScript","safeFindClass","reportMissingClass","_MissingScript","serializeTag","deserializeTag","CCON","chunks","_document","_chunks","parseCCONJson","json","cconPreface","decodeCCONBinary","bytes","InvalidCCONError","dataView","byteOffset","getUint32","version","chunksStart","jsonDataLength","jsonData","jsonString","TextDecoder","decode","globalThis","decodeJson","chunkDataLength","compileObjectTypeJit","accessorToSet","propNameLiteralToSet","assumeHavePropIfIsValue","ctorCode","_viewOrPaddings","_length","alignAs","align","remainder","counter","viewOrPadding","POSTFIX_DEFAULT","DELIMITER","POSTFIX_FORMERLY_SERIALIZED_AS","DeserializerPool","_js$Pool","deserializer","details","classFinder","customEnv","ignoreEditorOnly","_Deserializer","deserializedList","deserializedData","_ignoreEditorOnly","_classFinder","_reportMissingClass","_onDereferenced","onDereferenced","serializedData","jsonObj","fromCCON","_mainBinChunk","_serializedData","_context","serializedRootObject","_deserializeObject","serialized","globalIndex","__type__","_deserializeTypedArrayView","_deserializeTypedArrayViewRef","_deserializeTypeTaggedObject","_deserializeArray","_deserializePlainObject","constructorName","_deserializeAndAssignField","_fillPlainObject","klass","createObject","_deserializeInto","skipCustomized","content","_deserializeFireClass","_deserializeFastDefinedObject","_runCustomizedDeserialize","serializationInput","readProperty","serializedField","_deserializeObjectField","readThis","readSuper","superConstructor","__deserialize__","self","fastMode","accessorToGet","propNameToRead","userType","isPrimitiveType","compileDeserialize","rawDeserialize","deserialized","_$erialized","__id__","field","__uuid__","expectedType","__expectedType__","instance","BuiltinValueTypes","BuiltinValueTypeParsers_xyzw","BuiltinValueTypeSetters","Details","uuidObjList","uuidPropList","uuidList","uuidTypeList","deserializeCCObject","objectData","clazz","classTypeOffset","maskTypeOffset","MASK_CLASS","op","ASSIGNMENTS","deserializeCustomCCObject","assignInstanceRef","genArrayParser","parser","parseAssetRefByInnerObj","parseClass","getMissingClass","hasCustomFinder","doLookupClass","container","silent","actualClass","lookupClasses","customFinder","classes","klassLayout","cacheMasks","masks","borrowDetails","FileInfo","isCompiledJson","preprocessed","_version","_isCloning","instances","rootIndex","instanceTypes","instanceTypesLen","normalObjectCount","insIndex","typeIndex","eachData","parseInstances","refs","strings","dataLength","instanceOffset","keyIndex","dereference","sharedStrings","dependSharedUuids","dependObjs","dependKeys","dependUuids","parseResult","createAssetRefs","EDITOR_CORE","assignAssetsBy","EditorExtends","asAsset","deserializeDynamic","dict","DICT_JSON_LAYOUT","subKey","subType","subValue","packCustomObjData","hasNativeDep","StorageUnit","ElementType","objsToClearTmpVar","original","TypeError","doInstantiate","parent","enumerateObject","_iN$t","Klass","initValue","instantiateObj","enumerateCCClass","isView","isChildOf","combineStorageUnitElementType","unit","elementType","getElementTraits","BuiltinElementTypeTraits","getStorageConstructor","Uint8","Uint16","Uint32","Int8","Int16","Int32","Float32","Float64","lengthFor","requiredUnits","BYTES_PER_ELEMENT","compress","arrayBuffer","presumedByteOffset","elementTraits","storageConstructor","unitCount","storage","CompactValueTypeArray","_unitElement","_byteOffset","_unitCount","decompress","combined","storageUnit","Scalar","constant","linear","quadIn","quadOut","quadInOut","cubicIn","cubicOut","cubicInOut","quartIn","quartOut","quartInOut","quintIn","quintOut","quintInOut","sineIn","sineOut","sineInOut","expoIn","pow","expoOut","expoInOut","circIn","circOut","circInOut","elasticIn","elasticOut","elasticInOut","backIn","backOut","backInOut","bounceIn","bounceOut","bounceInOut","smooth","fade","_decorator","EasingMethod","quadOutIn","_makeOutIn","cubicOutIn","quartOutIn","quintOutIn","sineOutIn","expoOutIn","circOutIn","elasticOutIn","backOutIn","bounceOutIn","fnIn","fnOut","easingMethodFnMap","CONSTANT","easing","QUAD_IN","QUAD_OUT","QUAD_IN_OUT","QUAD_OUT_IN","CUBIC_IN","CUBIC_OUT","CUBIC_IN_OUT","CUBIC_OUT_IN","QUART_IN","QUART_OUT","QUART_IN_OUT","QUART_OUT_IN","QUINT_IN","QUINT_OUT","QUINT_IN_OUT","QUINT_OUT_IN","SINE_IN","SINE_OUT","SINE_IN_OUT","SINE_OUT_IN","EXPO_IN","EXPO_OUT","EXPO_IN_OUT","EXPO_OUT_IN","CIRC_IN","CIRC_OUT","CIRC_IN_OUT","CIRC_OUT_IN","ELASTIC_IN","ELASTIC_OUT","ELASTIC_IN_OUT","ELASTIC_OUT_IN","BACK_IN","BACK_OUT","BACK_IN_OUT","BACK_OUT_IN","BOUNCE_IN","BOUNCE_OUT","BOUNCE_IN_OUT","BOUNCE_OUT_IN","SMOOTH","FADE","getEasingFn","easingMethod","REAL_KEYFRAME_VALUE_DEFAULT_FLAGS","RealKeyframeValue","rightTangent","rightTangentWeight","leftTangent","leftTangentWeight","createRealKeyframeValue","realKeyframeValue","tangentWeightMode","editorExtras","KeyframeValueFlagMask","preExtrapolation","CLAMP","postExtrapolation","evaluate","firstTime","lastTime","preValue","linearTrend","LOOP","wrapRepeat","PING_PONG","wrapPingPong","preFrame","iPre","preTime","nextTime","prevTime","prevValue","nextValue","transformedRatio","ONE_THIRD","prevTangent","prevTangentWeightSpecified","prevTangentWeightEnabled","nextTangent","nextTangentWeightSpecified","nextTangentWeightEnabled","LEFT","prevTangentWeight","angle0","atan","tx0","ty0","nextTangentWeight","angle1","u0x","u1x","u0y","u1y","solutions","nSolutions","coeff0","coeff1","coeff2","coeff3","sqrA","cubicP","cbrt","sqrtD","sub","solveCubic","solutionsCount","iSolution","solution","getParamFromCubicSolution","bezierInterpolate","evalBetweenTwoKeyFrames","isConstant","tolerance","firstVal","context","toCCON","keyframeValues","nKeyframes","OVERFLOW_BYTES","FRAME_COUNT_BYTES","TIME_BYTES","REAL_KEY_FRAME_VALUE_MAX_SIZE","currentOffset","setUint8","setUint32","setFloat32","saveRealKeyFrameValue","writeProperty","keyframeValueEditorExtras","some","extras","writeThis","_","getFloat32","iKeyFrame","loadRealKeyFrameValue","DEFAULT_INTERPOLATION_MODE","DEFAULT_TANGENT_WEIGHT_MODE","DEFAULT_LEFT_TANGENT","DEFAULT_LEFT_TANGENT_WEIGHT","DEFAULT_RIGHT_TANGENT","DEFAULT_RIGHT_TANGENT_WEIGHT","KEY_FRAME_VALUE_FLAGS_BYTES","pFlags","INTERPOLATION_MODE","TANGENT_WEIGHT_MODE","LEFT_TANGENT","LEFT_TANGENT_WEIGHT","RIGHT_TANGENT","RIGHT_TANGENT_WEIGHT","p0","p3","bezier","C1","C2","C3","C4","QuatInterpolationMode","tau","crt","bezierByTime","controlPoints","percent","u1","x3","pa","pb","pa3","pb3","pc3","rd","r3","q2","discriminant","mp3","sd","cardano","p1y","QuatKeyframeValue","SLERP","createQuatKeyframeValue","interpolationModeRepeated","_index","firstKeyframeValue","interpolationModesSize","INTERPOLATION_MODE_BYTES","easingMethodsSize","reduce","EASING_METHOD_BYTES","EASING_METHOD_BEZIER_COMPONENT_BYTES","dataSize","FLAGS_BYTES","VALUE_BYTES","P","pQuat","EASING_METHOD_BEZIER_TAG","INTERPOLATION_MODES_START","pInterpolationMode","P_VALUES","iKeyframe","Keyframe","iSearch","iPrev","inTangent","outTangent","SplineMode","OptimizedKey","endTime","coefficient","T","coefs","AnimationCurve","keyFrames","cachedKey","_curve","legacyKeyframe","addKey","keyFrame","evaluate_slow","lastKeyframeIndex","keyFramesCount","wrappedTime","extrapolationMode","startTime","leftIndex","rightIndex","calcOptimizedKey","optKey","lhsTime","rhsTime","lhsValue","lhsOutTangent","rhsValue","rhsInTangent","d2","cachedIndex","currIndex","mid","legacyCurve","toLegacyWrapMode","fromLegacyWrapMode","legacyWrapMode","Clamp","defaultKF","SPLINE_WHOLE_INDEX","_v0","_v1","_v2","_v3","deprecatedClassMessage","oldClassName","newClassName","knots","CATMULL_ROM","_mode","_knots","Spline","setModeAndKnots","clearKnots","getKnotCount","addKnot","knot","insertKnot","removeKnot","setKnot","getKnot","getPoint","getSegments","deltaT","calcLinear","BEZIER","calcBezier","v0","calcCatmullRom","getPoints","num","layerList","IGNORE_RAYCAST","GIZMOS","UI_3D","SCENE_GIZMO","UI_2D","PROFILER","DEFAULT","Layers","userLayers","layer","addLayer","bit","makeMaskInclude","makeMaskExclude","excludes","bitNum","deleteLayer","nameToLayer","layerToName","RenderPassStage","RenderPriority","PIPELINE_FLOW_MAIN","PIPELINE_FLOW_FORWARD","PIPELINE_FLOW_SHADOW","PipelineGlobalBindings","globalDescriptorSetLayout","layouts","localDescriptorSetLayout","ModelLocalBindings","GLOBAL_UBO_COUNT","SAMPLER_SHADOWMAP","GLOBAL_SAMPLER_COUNT","SetIndex","LOCAL_UBO_COUNT","SAMPLER_JOINTS","LOCAL_SAMPLER_COUNT","STORAGE_REFLECTION","LOCAL_STORAGE_IMAGE_COUNT","UBOGlobal","SIZE","DEBUG_VIEW_COMPOSITE_PACK_3_OFFSET","DEBUG_VIEW_COMPOSITE_PACK_2_OFFSET","DEBUG_VIEW_COMPOSITE_PACK_1_OFFSET","DEBUG_VIEW_MODE_OFFSET","NATIVE_SIZE_OFFSET","SCREEN_SIZE_OFFSET","TIME_OFFSET","NAME","BINDING","UBO_GLOBAL","DESCRIPTOR","LAYOUT","GLOBAL","FLOAT4","UBOCamera","VIEW_PORT_OFFSET","NEAR_FAR_OFFSET","GLOBAL_FOG_ADD_OFFSET","GLOBAL_FOG_BASE_OFFSET","GLOBAL_FOG_COLOR_OFFSET","AMBIENT_GROUND_OFFSET","AMBIENT_SKY_OFFSET","MAIN_LIT_COLOR_OFFSET","MAIN_LIT_DIR_OFFSET","EXPOSURE_OFFSET","SCREEN_SCALE_OFFSET","SURFACE_TRANSFORM_OFFSET","CAMERA_POS_OFFSET","MAT_VIEW_PROJ_INV_OFFSET","MAT_VIEW_PROJ_OFFSET","MAT_PROJ_INV_OFFSET","MAT_PROJ_OFFSET","MAT_VIEW_INV_OFFSET","MAT_VIEW_OFFSET","UBO_CAMERA","MAT4","UBOShadow","PLANAR_NORMAL_DISTANCE_INFO_OFFSET","SHADOW_COLOR_OFFSET","SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET","SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET","SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET","SHADOW_PROJ_INFO_OFFSET","SHADOW_PROJ_DEPTH_INFO_OFFSET","SHADOW_INV_PROJ_DEPTH_INFO_OFFSET","MAT_LIGHT_VIEW_PROJ_OFFSET","MAT_LIGHT_VIEW_OFFSET","UBO_SHADOW","UBOCSM","CSM_LEVEL_COUNT","CSM_SPLITS_INFO_OFFSET","CSM_PROJ_INFO_OFFSET","CSM_PROJ_DEPTH_INFO_OFFSET","MAT_CSM_VIEW_PROJ_OFFSET","CSM_ATLAS_OFFSET","CSM_VIEW_DIR_2_OFFSET","CSM_VIEW_DIR_1_OFFSET","CSM_VIEW_DIR_0_OFFSET","UBO_CSM","UNIFORM_SHADOWMAP_BINDING","UNIFORM_SHADOWMAP_DESCRIPTOR","FRAGMENT","UNIFORM_SHADOWMAP_LAYOUT","SAMPLER2D","UNIFORM_ENVIRONMENT_BINDING","SAMPLER_ENVIRONMENT","UNIFORM_ENVIRONMENT_DESCRIPTOR","UNIFORM_ENVIRONMENT_LAYOUT","SAMPLER_CUBE","UNIFORM_DIFFUSEMAP_BINDING","SAMPLER_DIFFUSEMAP","UNIFORM_DIFFUSEMAP_DESCRIPTOR","UNIFORM_DIFFUSEMAP_LAYOUT","UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING","SAMPLER_SPOT_SHADOW_MAP","UNIFORM_SPOT_SHADOW_MAP_TEXTURE_DESCRIPTOR","UNIFORM_SPOT_SHADOW_MAP_TEXTURE_LAYOUT","UBOLocal","MAT_WORLD_OFFSET","MAT_WORLD_IT_OFFSET","LIGHTINGMAP_UVPARAM","LOCAL_SHADOW_BIAS","UBO_LOCAL","VERTEX","COMPUTE","LOCAL","UBOWorldBound","WORLD_BOUND_HALF_EXTENTS","WORLD_BOUND_CENTER","INST_MAT_WORLD","UBOLocalBatched","BATCHING_COUNT","MAT_WORLDS_OFFSET","UBOForwardLight","LIGHTS_PER_PASS","LIGHT_DIR_OFFSET","LIGHT_SIZE_RANGE_ANGLE_OFFSET","LIGHT_COLOR_OFFSET","LIGHT_POS_OFFSET","UBO_FORWARD_LIGHTS","UBODeferredLight","UBOSkinningTexture","JOINTS_TEXTURE_INFO_OFFSET","UBO_SKINNING_TEXTURE","UBOSkinningAnimation","JOINTS_ANIM_INFO_OFFSET","UBO_SKINNING_ANIMATION","INST_JOINT_ANIM_INFO","UBOSkinning","initLayout","capacity","_jointUniformCapacity","localDescriptorSetLayout_ResizeMaxJoints","maxCount","UBOMorph","MAX_MORPH_TARGET_COUNT","OFFSET_OF_WEIGHTS","OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH","OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT","OFFSET_OF_VERTICES_COUNT","COUNT_BASE_4_BYTES","UBO_MORPH","UBOUILocal","UBO_UI_LOCAL","UNIFORM_JOINT_TEXTURE_BINDING","UNIFORM_JOINT_TEXTURE_DESCRIPTOR","UNIFORM_JOINT_TEXTURE_LAYOUT","UNIFORM_REALTIME_JOINT_TEXTURE_BINDING","UNIFORM_REALTIME_JOINT_TEXTURE_DESCRIPTOR","UNIFORM_REALTIME_JOINT_TEXTURE_LAYOUT","UNIFORM_POSITION_MORPH_TEXTURE_BINDING","SAMPLER_MORPH_POSITION","UNIFORM_POSITION_MORPH_TEXTURE_DESCRIPTOR","UNIFORM_POSITION_MORPH_TEXTURE_LAYOUT","UNIFORM_NORMAL_MORPH_TEXTURE_BINDING","SAMPLER_MORPH_NORMAL","UNIFORM_NORMAL_MORPH_TEXTURE_DESCRIPTOR","UNIFORM_NORMAL_MORPH_TEXTURE_LAYOUT","UNIFORM_TANGENT_MORPH_TEXTURE_BINDING","SAMPLER_MORPH_TANGENT","UNIFORM_TANGENT_MORPH_TEXTURE_DESCRIPTOR","UNIFORM_TANGENT_MORPH_TEXTURE_LAYOUT","UNIFORM_LIGHTMAP_TEXTURE_BINDING","SAMPLER_LIGHTMAP","UNIFORM_LIGHTMAP_TEXTURE_DESCRIPTOR","UNIFORM_LIGHTMAP_TEXTURE_LAYOUT","UNIFORM_SPRITE_TEXTURE_BINDING","SAMPLER_SPRITE","UNIFORM_SPRITE_TEXTURE_DESCRIPTOR","UNIFORM_SPRITE_TEXTURE_LAYOUT","UNIFORM_REFLECTION_TEXTURE_BINDING","SAMPLER_REFLECTION","UNIFORM_REFLECTION_TEXTURE_DESCRIPTOR","UNIFORM_REFLECTION_TEXTURE_LAYOUT","UNIFORM_REFLECTION_STORAGE_BINDING","UNIFORM_REFLECTION_STORAGE_DESCRIPTOR","UNIFORM_REFLECTION_STORAGE_LAYOUT","IMAGE2D","CAMERA_DEFAULT_MASK","CAMERA_EDITOR_MASK","MODEL_ALWAYS_MASK","supportsR32FloatTexture","device","RENDER_TARGET","SAMPLED_TEXTURE","gfxAPI","R16F","typeMask","bindingMask","countMask","genHandle","getTypeFromHandle","handle","getBindingFromHandle","getCountFromHandle","getOffsetFromHandle","customizeType","type2reader","INT2","INT3","INT4","FLOAT2","FLOAT3","MAT3","type2writer","getDefaultFromType","BOOL","BOOL2","UINT2","BOOL4","UINT4","SAMPLER2D_ARRAY","SAMPLER3D","getStringFromType","overrideMacros","entries","isDifferent","_dsLayoutInfo","getBitCount","mapDefine","def","insertBuiltinBindings","tmpl","tmplInfo","outBindings","builtins","tempBlocks","bd","shaderInfo","tempSamplerTextures","getSize","block","dependencyCheck","ProgramLib","_templates","_cache","_templateInfos","register","effect","shaders","effectName","techniques","tech","passes","pass","propertyIndex","curTmpl","uber","constantMacros","statistics","samplerStartBinding","blockSizes","MATERIAL","samplerTexture","image","subpassInput","gfxAttributes","handleMap","uniform","genHandles","getTemplate","getTemplateInfo","getDescriptorSetLayout","isLocal","createDescriptorSetLayout","hasProgram","getKey","tmplDefs","tmplDef","mapped","destroyShaderByDefines","names","regexes","cur","RegExp","re","prog","getGFXShader","macros","descriptorSetLayout","createPipelineLayout","macroArray","defs","tDefs","prepareDefines","acc","src","glsl3","deviceShaderVersion","getDeviceShaderVersion","vert","frag","getActiveAttributes","getShaderInstanceName","createShader","GLES2","GLES3","WEBGL2","programLib","legacyBuiltinEffectNames","EffectAsset","_effects","_layoutValid","getAll","isLayoutValid","setLayoutValid","Game","EVENT_RENDERER_INITED","_precompile","combination","combinations","choices","gfxDevice","PixelFormat","R5G6B5","RGB5A1","RGBA4","RGB8","RGB32F","RGBA8","RGBA32F","A8","L8","LA8","CUSTOM_PIXEL_FORMAT","MIRROR","BORDER","POINT","TextureBase","_width","_height","_samplerInfo","_gfxSampler","_textureHash","_getGFXDevice","getId","getPixelFormat","_format","getAnisotropy","_anisotropy","setWrapMode","wrapS","wrapT","wrapR","_wrapS","_wrapT","_wrapR","setFilters","_minFilter","_magFilter","setMipFilter","_mipFilter","setAnisotropy","anisotropy","destroyed","_legacyCC$director$ro","batcher2D","_releaseDescriptorSetCache","getHash","getGFXTexture","getSamplerInfo","getGFXSampler","_serialize","fields","_getGFXFormat","_getGFXPixelFormat","_setGFXFormat","RGBA8888","RGBA_ETC1","RGB_ETC1","RGB_A_PVRTC_4BPPV1","RGB_PVRTC_4BPPV1","RGB_A_PVRTC_2BPPV1","RGB_PVRTC_2BPPV1","RGBA_ASTC_12x12","REPEAT","isImageBitmap","imageSource","ImageBitmap","ImageAsset","nativeAsset","_nativeData","_exportedExts","_compressed","HTMLElement","HTMLImageElement","fmtStr","extensionIDs","preferedExtensionIndex","SupportTextureFormats","extFormat","tmpExt","extnames","RGB_ETC2","RGBA_ETC2","_sharedPlaceHolderCanvas","fillStyle","fillRect","HTMLCanvasElement","dependMap","nativeDependMap","WeakSet","onLoadedInvokedMap","deserializeAsset","tdInfo","objList","typeList","depends","dependUuid","DependUtil","_depends","getNativeDep","depend","nativeDep","getDeps","deps","getDepsRecursively","exclude","_descend","rootInfo","_parseDepsFromAsset","_parseDepsFromJson","parsedFromExistAsset","_nativeDep","sharedUuids","parseUuidDependencies","_regions","isPOT","SimpleTexture","_gfxTexture","_gfxTextureView","_mipmapLevel","_textureWidth","_textureHeight","_baseLevel","_maxLevel","_tryDestroyTextureView","_tryDestroyTexture","updateImage","updateMipmaps","uploadData","arrayIndex","region","copyBuffersToTexture","copyTexImagesToTexture","_assignImage","_checkTextureLoaded","dependUtil","_textureReady","_setMipmapLevel","_setMipRange","maxLevel","setMipRange","textureView","_createTextureView","_getGfxTextureCreateInfo","_getGfxTextureViewCreateInfo","_tryReset","_createTexture","isUsingOfflineMipmaps","canGenerateMipmap","getMipLevel","GEN_MIPMAP","textureCreateInfo","SAMPLED","TRANSFER_DST","createTexture","textureViewCreateInfo","FaceIndex","MipmapMode","Texture2D","mipmaps","_mipmaps","mipLevels","mipmapLevel","minLod","maxLod","firstLevel","nUpdate","getHtmlElementObj","description","releaseTexture","mipmapUUID","presumed","texInfo","texViewInfo","imageAsset","mipmap","TextureCube","_mipmapMode","BAKED_CONVOLUTION_MAP","fromTexture2DArray","nMipmaps","front","mipmapAtlas","_mipmapAtlas","_forEachFace","face","faceIndex","isRGBE","rgbe","mipmapMode","mipmapLayout","atlas","imageAssetClassId","CUBE","imageAtlasAsset","faceAtlas","mip0Layout","ctx","layoutInfo","clearRect","drawImg","drawImage","rawData","getImageData","bufferAsset","Config","importBase","nativeBase","assetInfos","scenes","paths","uuids","types","realEntries","entry","packs","packId","packedIds","versions","folder","redirect","extensionMap","processOptions","_initUuid","_initPath","_initScene","_initPackage","_initVersion","_initRedirect","assetInfo","extension","getInfoWithPath","items","getDirWithPath","isMatchByWord","getSceneInfo","endsWith","pathList","isSubAsset","sceneList","sceneName","packageList","packUuid","pack","packedUuids","assetPacks","ver","nativeVer","visitAsset","visitComponent","visitNode","_components","_children","descendOpRef","dependAsset","refCount","_temp","ReleaseManager","_persistNodeDeps","_toDelete","_eventListener","_dontDestroyAssets","addIgnoredAsset","_addPersistNodeRef","_removePersistNodeRef","_autoRelease","oldScene","newScene","persistNodes","childs","autoReleaseAssets","persistDeps","sceneDeps","dep","force","_free","_freeAssets","checkCircularReference","clearRef","urlAppendTimestamp","retry","process","wait","getDepends","config","cacheAsset","errs","parseParameters","optionsOut","onProgressOut","onCompleteOut","isCallback","parseLoadResArgs","typeOut","isValidType","checkCircleReference","checked","asyncify","Bundle","_config","load","onProg","onComp","__requestType__","PATH","__outputAsArray__","loadAny","preloadAny","loadDir","DIR","preloadDir","loadScene","opts","preset","sceneAsset","preloadScene","release","releaseManager","releaseUnusedAssets","releaseAll","_destroy","resources","downloadDomImage","img","Image","loadCallback","removeEventListener","errorCallback","protocol","crossOrigin","downloadFile","errInfo","xhrResponseType","xhrWithCredentials","withCredentials","xhrMimeType","overrideMimeType","xhrTimeout","timeout","xhrHeader","header","setRequestHeader","status","onprogress","lengthComputable","total","ontimeout","onabort","downloaded","downloadScript","loadHandler","removeChild","errorHandler","scriptAsyncLoading","REGEX","downloadImage","allowImageBitmap","downloadBlob","onFileProgress","downloadJson","downloadArrayBuffer","downloadCCON","chunk","errChunk","chunkBuffer","ccon","downloadCCONB","downloadText","downloadBundle","nameOrUrl","bundleName","downloader","remoteBundles","remoteServerAddress","bundleVers","Downloader","appendTimeStamp","limited","retryInterval","downloadDomAudio","_downloaders","_downloading","_queueDirty","_totalNum","_totalNumThisPeriod","_lastDate","_checkNextPeriod","_remoteServerAddress","_maxInterval","download","file","downloadCallbacks","request","_updateTime","_handleQueueInNextFrame","callbacks","loadSubpackage","completeCallback","loadBundle","performance","deltaTime","_handleQueue","JsonAsset","TextAsset","text","BufferAsset","_buffer","bin","createImageAsset","_nativeAsset","createJsonAsset","createTextAsset","createBufferAsset","createAsset","createBundle","RESOURCES","Factory","_creating","_producers","reloadAsset","creating","_loading","_unpackers","unpackJson","unpackJSONs","sharedClasses","sharedMasks","sections","textureType","imageAssetType","datas","unpack","unpacker","err2","unpackedData","fetch","firstTask","finish","canInvoke","__exclude__","packManager","decreaseRef","plistParser","xmlTxt","plist","_parseXML","tagName","childNodes","_parseNode","_parseDict","_parseArray","firstChild","nodeValue","child","_parser","DOMParser","textxml","parseFromString","readBEUint16","Parser","_parsing","_parsers","parseImage","parsePVRTex","parsePKMTex","parseASTCTex","parsePlist","parseImport","premultiplyAlpha","dataOffset","headerLength","xdim","ydim","ASTC_HEADER_MAGIC","zdim","RGBA_ASTC_4x4","RGBA_ASTC_5x4","RGBA_ASTC_5x5","RGBA_ASTC_6x5","RGBA_ASTC_6x6","RGBA_ASTC_8x5","RGBA_ASTC_8x6","RGBA_ASTC_8x8","RGBA_ASTC_10x5","RGBA_ASTC_10x6","RGBA_ASTC_10x8","RGBA_ASTC_10x10","RGBA_ASTC_12x10","getASTCFormat","xsize","ASTC_HEADER_SIZE_X_BEGIN","ysize","ASTC_HEADER_SIZE_Y_BEGIN","ASTC_HEADER_SIZE_Z_BEGIN","parsedAsset","parsing","parseHandler","loadOneAssetPipeline","gatherAsset","repeatItem","assetsMap","placeHolder","setProperties","loadDepends","preprocess","subOptions","leftOptions","UUID","SCENE","URL","RequestItem","overrideUuid","_info2","replaceOverrideAsset","combine","generalNativeBase","generalImportBase","AssetManager","utils","helper","cacheManager","factory","preprocessPipe","fetchPipe","loadPipe","references","_files","_parsed","_parsePipeline","_projectBundles","server","ASSETS","assetsOverride","getBundle","removeBundle","requests","loadRemote","releaseAsset","loadWithJson","MAIN","phases","phaseNum","BatchingSchemes","BuiltinResMgr","_resources","_materialsToBeCompiled","blackValueView","emptyValueView","greyValueView","whiteValueView","normalValueView","defaultValueView","defaultSize","halfDefaultSize","blackMemImageSource","emptyMemImageSource","greyMemImageSource","whiteMemImageSource","normalMemImageSource","defaultMemImageSource","imgAsset","blackTexture","emptyImgAsset","emptyTexture","blackCubeTexture","NEAREST","greyImgAsset","greyTexture","greyCubeTexture","whiteImgAsset","whiteTexture","whiteCubeTexture","normalImgAsset","normalTexture","defaultImgAsset","defaultTexture","defaultCubeTexture","SpriteFrame","spriteFrame","addAsset","loadBuiltinAssets","builtinAssets","INTERNAL","Material","compileBuiltinMaterial","tryCompile","builtinResMgr","getPhaseID","phaseName","InstancedBuffer","hasPendingModels","dynamicOffsets","_device","subModel","passIdx","shaderImplant","instancedAttributeBlock","sourceIA","inputAssembler","lightingMap","descriptorSet","objectID","_sourceIA$indexBuffer","newSize","oldData","createBuffer","HOST","DEVICE","newAttr","iaInfo","createInputAssembler","uploadBuffers","cmdBuff","updateBuffer","BatchedBuffer","batches","batch","vbs","vbIdx","ubo","flatBuffers","vbSize","vbIdxSize","vbCount","isBatchExist","mergeCount","flatBuff","batchVB","vbBuf","vbDatas","vbIdxBuf","vbIdxData","uboData","worldMatrix","totalVBs","newVB","UNIFORM","_bufferInfo","_bufferViewInfo","_dsInfo","Pass","_rootBuffer","_descriptorSet","_passIndex","_propertyIndex","_programName","_dynamics","_propertyHandleMap","_rootBlock","_blocksInt","_shaderInfo","_defines","_properties","_priority","_stage","_phase","_batchingScheme","_instancedBuffers","_batchedBuffers","_root","_rootBufferDirty","fillPipelineInfo","phase","bs","bsInfo","getPassHash","program","serializeBlendState","serializeDepthStencilState","_doInit","resetUBOs","resetTextures","getHandle","targetType","getBinding","setUniform","_getBlockView","getUniform","setUniformArray","setDynamicState","state","dirty","overridePipelineStates","_setRootBufferDirty","getInstancedBuffer","extraKey","getBatchedBuffer","bb","resetUniform","resetTexture","texName","textureBase","samplerInfo","samplerHash","_syncBatchingScheme","getShaderVariant","patches","patch","beginChangeStatesSilently","endChangeStatesSilently","copyDefines","passIndex","stateOverrides","createDescriptorSet","startOffsets","lastSize","lastOffset","totalSize","bufferView","directHandleMap","indirectHandleMap","handleInfo","USE_INSTANCING","INSTANCED_ARRAYS","INSTANCING","USE_BATCHING","VB_MERGING","_initPassFromTarget","hashFactor","batchingScheme","_updatePassHash","PipelineStateManager","getOrCreatePipelineState","newHash","attributesHash","typedID","pso","_PSOHashMap","psoInfo","createPipelineState","profilerViewport","profilerScissor","SRGBToLinear","gamma","profilerCamera","renderProfiler","enabled","setViewport","setScissor","bindPipelineState","bindDescriptorSet","bindInputAssembler","draw","v4_1","_passes","material","_states","_props","_fillInfo","_update","_doDestroy","recompileShaders","resetUniforms","clearPasses","setProperty","success","_uploadProperty","getProperty","propsArray","_techIdx","_effectAsset","technique","effectAsset","_prepareInfo","states","patchArray","_createPasses","passNum","passInfo","propIdx","embeddedMacros","keepProps","totalPasses","SAMPLER1D","_pass$properties$name","_bindTexture","USE_COLOR","deepFlatten","strList","flattenCodeArray","setDefaultLogTimes","VAR","LOCAL_OBJ","DEFAULT_MODULE_CACHE","Declaration","varName","expression","mergeDeclaration","writeAssignment","codeArray","Assignments","targetExpression","_exps","_targetExp","writeCode","targetVar","LOCAL_TEMP_OBJ","pair","getPropAccessor","globalVariablesDeclaration","objsToClear_iN$t","funcModuleCache","globalVariables","globalVariableId","localVariableId","getFuncModule","globalVar","code","usedInNew","clsNameIsModule","getObjRef","setValueType","srcValue","assignments","fastDefinedProps","enumerateField","equalsToDefault","setObjProp","instantiateArray","arrayVar","instantiateTypedArray","createCode","_obj$node","NodeEventType","NodeUIProperties","_uiComp","_opacity","_localOpacity","colorDirty","_uiTransformComp","_node","applyOpacity","effectOpacity","markOpacityTree","IdGenerator","getConstructor","NodeSpace","TransformBit","BaseNode","_setScene","_updateScene","_findComponent","comps","_findComponents","components","_findChildComponent","children","_findChildComponents","_scene","_activeInHierarchy","_eventProcessor","NodeEventProcessor","_eventMask","_siblingIndex","_originalSceneId","_parent","getParent","setParent","keepWorldTransform","oldParent","newParent","_onSetParent","PARENT_CHANGED","_updateSiblingIndex","CHILD_REMOVED","CHILD_ADDED","_onHierarchyChanged","getChildByUuid","locChildren","getChildByName","getChildByPath","lastNode","childNode","addChild","insertChild","siblingIndex","setSiblingIndex","getSiblingIndex","siblings","oldIndex","_onSiblingIndexChanged","walk","preFunc","postFunc","curr","_stacks","_stackId","afterChildren","removeFromParent","removeAllChildren","reqComps","COMPONENT_ADDED","activateComp","removeComponent","componentInstance","useCapture","TRANSFORM_CHANGED","dispatchEvent","active","destroyAllChildren","COMPONENT_REMOVED","SIBLING_ORDER_CHANGED","_onPostActivated","_onBatchCreated","_onPreDestroyBase","_onHierarchyChangedBase","isSyncedNode","_prefab","_persistNode","removePersistRootNode","shouldActiveNow","_active","activateNode","destroyByParent","_registerIfAttached","childIndex","NODE_DESTROYED","isActive","ROTATION","SCALE","POSITION","TRS","v3_a","q_a","q_b","m3_scaling","m4_1","dirtyNodes","reserveContentsForAllSyncablePrefabTag","globalFlagChangeVersion","_uiProps","_static","_dirtyFlags","_eulerDirty","_flagChangeVersion","_hasChangedFlags","_pos","_rot","_scale","_mat","isNode","serializationOutput","updateWorldTransform","_lrot","_lpos","_lscale","invalidateChildren","eventProcessor","reattach","dontSyncChildPrefab","hasChangedFlags","_onBeforeSerialize","eulerAngles","setEnabled","uiComp","setNodeDirty","setTextureDirty","markForUpdateRenderData","trans","ns","WORLD","worldRotation","worldScale","worldRot","getWorldPosition","setWorldRotation","dirtyBit","childDirtyBit","dirtyBits","RS","setPosition","getPosition","setRotation","setRotationFromEuler","zOpt","_euler","inverseTransformPoint","setWorldPosition","local","setWorldRotationFromEuler","getWorldRotation","setWorldScale","getWorldScale","getWorldRS","getWorldRT","setRTS","pauseSystemEvents","recursive","resumeSystemEvents","resetHasChangedFlags","clearNodeArray","ClearFrame","ClearRound","getPathInHierarchy","curNode","_layer","LAYER_CHANGED","EventType","TransformDirtyBit","System","_executeInEditMode","sortByPriority","postUpdate","Priority","LOW","MEDIUM","HIGH","SCHEDULER","_colorAttachment","_depthStencilAttachment","DEPTH_STENCIL","CameraFOVAxis","CameraProjection","CameraAperture","CameraISO","CameraShutter","CameraType","TrackingType","_windowInfo","renderPassInfo","RenderTexture","_window","_initWindow","destroyWindow","framebuffer","title","getGeneralBarrier","FRAGMENT_SHADER_READ_TEXTURE","createWindow","readPixels","gfxTexture","needSize","bufferViews","regions","region0","copyTextureToBuffers","FSTOPS","SHUTTERS","ISOS","v_a","v_b","_tempMat1","SKYBOX_FLAG","STENCIL","correctionMatrices","Camera","isWindowSize","screenScale","_proj","_aspect","_orthoHeight","_fovAxis","VERTICAL","_fov","_nearClip","_farClip","_clearColor","_viewport","_orientedViewport","_curTransform","_isProjDirty","_matView","_matProj","_matProjInv","_matViewProj","_matViewProjInv","_frustum","_forward","_position","_aperture","F16_0","_apertureValue","_shutter","D125","_shutterValue","_iso","ISO100","_isoValue","_clearFlag","_clearDepth","_visibility","_exposure","_clearStencil","_geometryRenderer","_cameraType","_trackingType","NO_TRACKING","accurate","ySign","ROTATE_90","ROTATE_180","ROTATE_270","_updateAspect","oriented","swapchain","surfaceTransform","trackingType","cameraType","clearFlag","clearDepth","visibility","updateExposure","changeTargetWindow","detachFromScene","detachCamera","attachToScene","setFixedSize","syncCameraEditor","forceUpdate","viewProjDirty","_this$window","PERSPECTIVE","setViewportInOrientedSpace","_this$window2","initGeometryRenderer","GeometryRenderer","activate","win","mainWindow","attachCamera","screenPointToRay","cw","ch","isProj","screenToWorld","screenPos","worldToScreen","worldPos","worldMatrixToScreen","setExposure","ev100","vis","flag","stencil","nearClip","farClip","_temp_vec3_1","ProjectionType","FOVAxis","Aperture","Shutter","ISO","ClearFlag","SKYBOX","SOLID_COLOR","DEPTH_ONLY","DONT_CLEAR","_camera","_inEditorMode","_flows","_createCamera","_attachToScene","_detachFromScene","_targetTexture","convertToUINode","wpos","uiNode","cmp","designSize","getVisibleSize","xoffset","yoffset","getScaleX","getScaleY","convertToNodeSpaceAR","createCamera","_projection","tempWindow","_rect","fovAxis","orthoHeight","_near","_far","clearColor","_color","_depth","clearStencil","_stencil","_clearFlags","aperture","shutter","iso","_updateTargetTexture","removeCamera","addCamera","_checkTargetTextureEvent","old","projectionType","TARGET_TEXTURE_CHANGE","_screenScale","PassInstance","_owner","_dontNotify","parentBlock","paren","_onStateChange","defineOverrides","onPassStateChange","MaterialInstance","_subModelIdx","subModelIdx","passInfos","dontNotify","_onRebuildPSO","parentPasses","_matInsInfo","Renderer","_materialInstances","getMaterial","_materials","setMaterial","inst","_onMaterialModified","getMaterialInstance","instantiated","setMaterialInstance","matInst","curInst","getRenderMaterial","_clearMaterials","newLength","oldLength","ModelRenderer","_models","_collectModels","_updatePriority","_onVisibilityChange","_visFlags","CameraComponent","RenderableComponent","SystemEventType","InputEventType","Event","bubbles","currentTarget","eventPhase","propagationStopped","propagationImmediateStopped","unuse","NO_TYPE","reuse","isStopped","getCurrentTarget","getType","TOUCH","MOUSE","KEYBOARD","ACCELERATION","CAPTURING_PHASE","AT_TARGET","BUBBLING_PHASE","EventAcceleration","DEVICEMOTION","EventKeyboard","keyCode","eventType","KEY_DOWN","KEY_UP","rawEvent","_isPressed","EventMouse","prevLoc","movementX","movementY","preventSwallow","_eventType","_button","BUTTON_MISSING","_prevX","_prevY","_scrollX","_scrollY","setScrollData","scrollX","scrollY","getScrollX","getScrollY","setLocation","getLocation","getLocationInView","_designResolutionSize","getUILocation","getPreviousLocation","getUIPreviousLocation","getDelta","getDeltaX","getDeltaY","getUIDelta","getUIDeltaX","getUIDeltaY","setButton","button","getButton","getLocationX","getLocationY","getUILocationX","getViewportRect","getUILocationY","BUTTON_LEFT","BUTTON_RIGHT","BUTTON_MIDDLE","BUTTON_4","BUTTON_5","BUTTON_6","BUTTON_7","BUTTON_8","_vec2","EventTouch","changedTouches","touch","simulate","_eventCode","_touches","_allTouches","getEventCode","getTouches","getAllTouches","setTouchInfo","getID","getStartLocation","getUIStartLocation","MAX_TOUCHES","KeyCode","EventGamepad","gamepad","Acceleration","handleInputDevice","hmdInputDevice","timestamp","Touch","_point","_prevPoint","_lastModified","_startPoint","_startPointCaptured","getPreviousLocationInView","getStartLocationInView","setPoint","frameStartTime","setPrevPoint","DispatcherEventType","_cachedArray","_currentHovered","_touchEvents","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","_mouseEvents","MOUSE_DOWN","MOUSE_ENTER","MOUSE_MOVE","MOUSE_LEAVE","MOUSE_UP","MOUSE_WHEEL","claimedTouchIdList","maskList","cachedCameraPriority","previousMouseIn","bubblingTarget","capturingTarget","shouldHandleEventMouse","shouldHandleEventTouch","_dispatchingTouch","_isEnabled","_attachMask","callbacksInvoker","MARK_LIST_DIRTY","currentMaskList","_searchComponentsInParent","_maskComp","REMOVE_POINTER_EVENT_PROCESSOR","cancelEvent","_tryEmittingAddEvent","_newCallbacksInvoker","_hasTouchListeners","_hasMouseListeners","_hasPointerListeners","getCapturingTargets","getBubblingTargets","_parent$eventProcesso","_parent$eventProcesso2","_isTouchEvent","_isMouseEvent","typeToAdd","isTouchEvent","isMouseEvent","ADD_POINTER_EVENT_PROCESSOR","_handleEventMouse","eventMouse","_handleMouseDown","_handleMouseMove","_handleMouseUp","_handleMouseWheel","uiTransformComp","hitTest","_handleEventTouch","eventTouch","_handleTouchStart","_handleTouchMove","_handleTouchEnd","_handleTouchCancel","Ambient","_groundAlbedoHDR","_skyColorHDR","_skyIllumHDR","_groundAlbedoLDR","_skyColorLDR","_skyIllumLDR","_mipmapCount","ambientInfo","skyColorHDR","groundAlbedoHDR","skyIllumHDR","skyColorLDR","groundAlbedoLDR","skyIllumLDR","pipelineSceneData","isHDR","illum","SUN_ILLUM","SKY_ILLUM","ShadowSize","Low_256x256","Medium_512x512","High_1024x1024","Ultra_2048x2048","ShadowType","Planar","ShadowMap","PCFType","HARD","SOFT","SOFT_2X","SOFT_4X","CSMLevel","LEVEL_1","LEVEL_2","LEVEL_3","LEVEL_4","CSMOptimizationMode","RemoveDuplicates","DisableRotationFix","SHADOW_TYPE_NONE","Shadows","fixedSphere","maxReceived","_matLight","_material","_instancingMaterial","_distance","_normal","_shadowColor","_shadowMapDirty","getPlanarShader","getPlanarInstanceShader","shadowsInfo","planeDirection","planeHeight","shadowColor","shadowMapSize","_updatePlanarInfo","CC_SHADOW_TYPE","onGlobalPipelineStateChanged","MAX_FAR","COEFFICIENT_OF_EXPANSION","skybox_mesh","skybox_material","EnvironmentLightingType","HEMISPHERE_DIFFUSE","AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION","DIFFUSEMAP_WITH_REFLECTION","Skybox","_envmapLDR","_envmapHDR","_diffuseMapLDR","_diffuseMapHDR","_globalDSManager","_model","_useIBL","_useHDR","_useDiffuseMap","_editableMaterial","_activated","_reflectionHDR","_reflectionLDR","_rotationAngle","skyboxInfo","useIBL","applyDiffuseMap","useHDR","setEnvMaps","envmapHDR","envmapLDR","_updateGlobalBinding","_updatePipeline","setDiffuseMaps","diffuseMapHDR","diffuseMapLDR","setSkyboxMaterial","skyboxMat","USE_RGBE_CUBEMAP","setReflectionMaps","reflectionHDR","reflectionLDR","setRotationAngle","getRotationAngle","updateMaterialRenderInfo","globalDSManager","createModel","renderer","Model","envmap","createMesh","primitives","box","initSubModel","diffuseMap","useIBLValue","useDiffuseMapValue","useDiffuseMap","useHDRValue","useConvMapValue","useConvolutionMap","CC_USE_IBL","CC_USE_DIFFUSEMAP","CC_USE_HDR","CC_IBL_CONVOLUTED","setSubModelMaterial","_updateSubModes","reflectionMap","_v4","FogType","EXP","EXP_SQUARED","LAYERED","FOG_TYPE_NONE","Fog","_fogColor","_colorArray","_accurate","_fogDensity","_fogStart","_fogEnd","_fogAtten","_fogTop","_fogRange","fogInfo","fogColor","fogDensity","fogStart","fogEnd","fogAtten","fogTop","fogRange","accurateValue","CC_USE_FOG","CC_USE_ACCURATE_FOG","_up","_col","_qt","normalizeHDRColor","intensity","AmbientInfo","_resource","resource","skyColor","skyIllum","groundAlbedo","SkyboxInfo","envLightingType","_envLightingType","FogInfo","ShadowsInfo","setPlaneFromNode","_maxReceived","shadowMapDirty","DEFAULT_WORLD_MIN_POS","DEFAULT_WORLD_MAX_POS","DEFAULT_OCTREE_DEPTH","OctreeInfo","_minPos","_maxPos","SceneGlobals","sceneData","skybox","ambient","shadows","fog","octree","_skybox","SystemEvent","systemEvent","AccelerometerInputSource","_intervalInMileSeconds","_accelTimer","_eventTarget","_deviceEventName","_globalEventClass","_didAccelerateFunc","MOBILE_QQ","_didAccelerate","_unregisterEvent","eventAcceleration","accelerationIncludingGravity","deviceOrientationEvent","beta","tmpX","acceleration","requestPermission","stop","setInterval","intervalInMileSeconds","InputSource","InputSourceAxis1D","getValue","InputSourceAxis2D","InputSourceAxis3D","InputSourceQuat","CompositeInputSourceAxis1D","positive","positiveValue","negativeValue","CompositeInputSourceAxis2D","InputSourceButton","forward","backward","InputSourceDpad","InputSourceStick","InputSourceOrientation","InputSourcePosition","GamepadInputDevice","deviceId","_deviceId","_connected","_initInputSource","_init","_on","_removeInputDevice","removeIndex","_getOrCreateInputDevice","connected","_ensureDirectorDefined","_intervalId","Director","clearInterval","EVENT_BEGIN_FRAME","_scanGamepads","_cachedWebGamepads","GAMEPAD_CHANGE","webGamepads","_getWebGamePads","devices","webGamepad","cachedWebGamepad","cachedButtons","buttons","cachedButton","cachedAxes","cachedAxisValue","axisValue","GAMEPAD_INPUT","_getWebGamepad","_axisToButtons","_buttonNorth","_buttonEast","_buttonWest","_buttonSouth","_buttonL1","_buttonL2","_buttonL3","_buttonR1","_buttonR2","_buttonR3","_buttonShare","_buttonOptions","_dpad","leftStickUp","leftStickDown","leftStickLeft","leftStickRight","_leftStick","rightStickUp","rightStickDown","rightStickLeft","rightStickRight","_rightStick","_buttonStart","EventDispatcherPriority","HandleInputDevice","_buttonTriggerLeft","_buttonTriggerRight","_triggerLeft","_triggerRight","_gripLeft","_gripRight","_buttonLeftStick","_buttonRightStick","_handLeftPosition","_handLeftOrientation","_handRightPosition","_handRightOrientation","_aimLeftPosition","_aimLeftOrientation","_aimRightPosition","_aimRightOrientation","HMDInputDevice","_viewLeftPosition","_viewLeftOrientation","_viewRightPosition","_viewRightOrientation","_headMiddlePosition","_headMiddleOrientation","code2KeyCode","Backspace","BACKSPACE","Tab","TAB","Enter","ENTER","ShiftLeft","SHIFT_LEFT","ControlLeft","CTRL_LEFT","AltLeft","ALT_LEFT","ShiftRight","SHIFT_RIGHT","ControlRight","CTRL_RIGHT","AltRight","ALT_RIGHT","Pause","PAUSE","CapsLock","CAPS_LOCK","Escape","ESCAPE","Space","SPACE","PageUp","PAGE_UP","PageDown","PAGE_DOWN","End","END","Home","HOME","ArrowLeft","ARROW_LEFT","ArrowUp","ARROW_UP","ArrowRight","ARROW_RIGHT","ArrowDown","ARROW_DOWN","Insert","INSERT","DELETE","Digit0","DIGIT_0","Digit1","DIGIT_1","Digit2","DIGIT_2","Digit3","DIGIT_3","Digit4","DIGIT_4","Digit5","DIGIT_5","Digit6","DIGIT_6","Digit7","DIGIT_7","Digit8","DIGIT_8","Digit9","DIGIT_9","KeyA","KEY_A","KeyB","KEY_B","KeyC","KEY_C","KeyD","KEY_D","KeyE","KEY_E","KeyF","KEY_F","KeyG","KEY_G","KeyH","KEY_H","KeyI","KEY_I","KeyJ","KEY_J","KeyK","KEY_K","KeyL","KEY_L","KeyM","KEY_M","KeyN","KEY_N","KeyO","KEY_O","KeyP","KEY_P","KeyQ","KEY_Q","KeyR","KEY_R","KeyS","KEY_S","KeyT","KEY_T","KeyU","KEY_U","KeyV","KEY_V","KeyW","KEY_W","KeyX","KEY_X","KeyY","KEY_Y","KeyZ","KEY_Z","Numpad0","NUM_0","Numpad1","NUM_1","Numpad2","NUM_2","Numpad3","NUM_3","Numpad4","NUM_4","Numpad5","NUM_5","Numpad6","NUM_6","Numpad7","NUM_7","Numpad8","NUM_8","Numpad9","NUM_9","NumpadMultiply","NUM_MULTIPLY","NumpadAdd","NUM_PLUS","NumpadSubtract","NUM_SUBTRACT","NumpadDecimal","NUM_DECIMAL","NumpadDivide","NUM_DIVIDE","NumpadEnter","NUM_ENTER","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","NumLock","NUM_LOCK","ScrollLock","SCROLL_LOCK","Semicolon","SEMICOLON","Equal","EQUAL","Comma","COMMA","Minus","DASH","Period","PERIOD","Slash","SLASH","Backquote","BACK_QUOTE","BracketLeft","BRACKET_LEFT","Backslash","BACKSLASH","BracketRight","BRACKET_RIGHT","Quote","QUOTE","KeyboardInputSource","dispatchKeyboardDownEvent","nativeKeyboardEvent","_handleKeyboardDown","dispatchKeyboardUpEvent","_handleKeyboardUp","_getInputEvent","stopPropagation","preventDefault","keyPressingInputEvent","KEY_PRESSING","keyDownInputEvent","inputEvent","MouseInputSource","_pointLocked","_preMousePos","_createCallback","dispatchMouseDownEvent","nativeMouseEvent","dispatchMouseMoveEvent","dispatchMouseUpEvent","dispatchScrollEvent","_getCanvasRect","getBoundingClientRect","_getLocation","mouseEvent","canvasRect","clientX","clientY","_registerPointerLockEvent","lockChangeAlert","pointerLockElement","mozPointerLockElement","targetButton","focus","deltaX","deltaY","tempVec2","touchManager","_touchMap","_maxTouches","_cloneTouch","touchID","clonedTouch","_createTouch","_checkTouchMapSizeMoreThanMax","_updateTouch","releaseTouch","getTouch","maxSize","lastModified","TouchInputSource","handleTouches","changedTouch","identifier","InputEventDispatcher","inputEventTarget","_inputEventTarget","pointerEventTypeMap","Input","_dispatchImmediately","_touchInput","_mouseInput","_keyboardInput","_accelerometerInput","_handleInput","_hmdInput","_eventTouchList","_eventMouseList","_eventKeyboardList","_eventAccelerationList","_eventGamepadList","_eventHandleList","_eventHMDList","_needSimulateTouchMoveEvent","_inputEventDispatcher","_eventDispatcherList","_registerEventDispatcher","_dispatchMouseDownEvent","_dispatchMouseMoveEvent","_dispatchMouseUpEvent","_dispatchMouseScrollEvent","_dispatchKeyboardDownEvent","_dispatchKeyboardUpEvent","setAccelerometerEnabled","isEnable","setAccelerometerInterval","_simulateEventTouch","_dispatchOrPushEventTouch","eventDispatcher","_emitEvent","eventTouchList","eventMouseList","_dispatchOrPushEvent","eventKeyboardList","eventAccelerationList","eventGamepadList","eventHandleList","HANDLE_INPUT","HANDLE_POSE_INPUT","eventHMDList","HMD_POSE_INPUT","_clearEvents","eventList","touchEventList","touchesLength","_frameDispatchEvents","eventKeyboard","eventGamepad","eventHandle","eventHMD","isEnabled","anchorX","anchorY","anchorPoint","setAnchorPoint","contentSize","setContentSize","PrivateNode","createNodeWithPrefab","prefabInfo","_doInstantiate","generateTargetMap","targetMap","isRoot","curTargetMap","prefabInstance","_node$_prefab","fileId","__prefab","getTarget","localID","targetIter","applyMountedChildren","mountedChildren","childInfo","targetInfo","nodes","expandPrefabInstanceNode","applyMountedComponents","mountedComponents","componentsInfo","applyRemovedComponents","removedComponents","applyPropertyOverrides","propertyOverrides","propOverride","targetPropOwner","propertyPath","targetPropName","applyTargetOverrides","targetOverrides","_node$_prefab2","targetOverride","sourceInfo","sourceInstance","_targetOverride$sourc","_targetOverride$sourc2","targetInstance","_targetOverride$targe","_targetOverride$targe2","recursively","expanded","expandNestedPrefabInstanceNode","nestedPrefabInstanceRoots","instanceNode","dependAssets","_renderScene","_inited","_prefabSyncedInLiveReload","createScene","destroyScene","_load","_activate","_globals","referenceNode","getScene","sortedIndex","testOrder","testId","stableRemoveInactive","flagToClear","LifeCycleInvoker","invokeFunc","_zero","_neg","_invoke","Iterator","compareOrder","OneOffInvoker","cancelInactive","invoke","compsNeg","compsPos","ReusableInvoker","createInvokeImplJit","useDt","ensureFlag","fastPath","singleInvoke","createInvokeImpl","invokeStart","invokeUpdate","invokeLateUpdate","invokeOnEnable","_onEnabled","ComponentScheduler","_deferredComps","unscheduleAll","startInvoker","updateInvoker","lateUpdateInvoker","_updating","resumeTarget","_scheduleImmediate","_onDisabled","pauseTarget","invoker","startPhase","_startForNewComps","updatePhase","lateUpdatePhase","_deferredSchedule","UnsortedInvoker","invokePreload","invokeOnLoad","activateTasksPool","_componentCorrupted","NodeActivator","resetComp","_activatingStack","_activateNodeRecursively","_deactivateNodeRecursively","lastTask","ACTIVE_IN_HIERARCHY_CHANGED","preloadInvoker","onLoadInvoker","onEnableInvoker","originCount","TargetInfo","TargetOverrideInfo","CompPrefabInfo","PropertyOverrideInfo","isTarget","MountedChildrenInfo","MountedComponentsInfo","PrefabInstance","findPropertyOverride","removePropertyOverride","PrefabInfo","_PrefabInfo","applyNodeAndComponentId","rootId","_comp$__prefab","_child$_prefab","OptimizationPolicy","SINGLE_INSTANCE","MULTI_INSTANCE","Prefab","_createFunction","_instantiatedTimes","compileCreateFunction","rootToRedirect","optimizationPolicy","OptimizationPolicyThreshold","rootNode","_vec3","WorldNode3DToLocalNodeUI","mainCamera","WorldNode3DToWorldNodeUI","convertUtils","pipelineUtils","_tempVec3","_sphere","roPool","getRenderObject","worldPosition","ro","validPunctualLightsCulling","validPunctualLights","spotLights","light","baked","sphereLights","sceneCulling","mainLight","csmLayers","renderObjects","castShadowObjects","csmLayerObjects","layerObjects","pipelineUBO","updateShadowUBORange","models","castShadow","visFlags","LightType","_samplerLinearInfo","_samplerPointInfo","GlobalDSManager","_descriptorSetMap","_globalDescriptorSet","_descriptorSetLayout","_linearSampler","_pointSampler","regenLayout","it","getOrCreateDescriptorSet","globalDescriptorSet","shadowUBO","ColorTemperatureToRGB","rgb","kelvin","kSqr","nt2lm","Light","_baked","_colorTemp","_colorTempRGB","_useColorTemperature","colorTemperature","enable","DebugView","_singleMode","_compositeModeValue","_lightingWithAlbedo","_csmLayerColoration","_nativeConfig","isCompositeModeEnabled","enableCompositeMode","_enableCompositeMode","enableAllCompositeMode","_enableAllCompositeMode","_getType","useDebugView","CC_USE_DEBUG_VIEW","_matShadowView","_matShadowProj","_matShadowViewProj","_vec4ShadowInfo","_lightDir","PipelineUBO","_globalUBO","_cameraUBO","_shadowUBO","_csmUBO","updateGlobalUBOView","fv","shadingWidth","shadingHeight","cumulativeTime","frameTime","getTotalFrames","debugView","singleMode","lightingWithAlbedo","csmLayerColoration","updateCameraUBOView","shadowInfo","cv","exposure","standardExposureValue","shadowEnable","shadowEnabled","mainLightDir","useColorTemperature","colorTempRGB","colorTemperatureRGB","illuminance","_skybox$envmap","matView","matProj","matProjInv","matViewProj","matViewProjInv","getCombineSignY","colorArray","getPCFRadius","shadowPcf","updatePlanarNormalAndDistance","updateShadowUBOView","shadowBufferView","csmBufferView","sv","csmSupported","packing","shadowFixedArea","csmLevel","matShadowView","specialLayer","matShadowProj","matShadowViewProj","shadowNear","shadowFar","shadowSaturation","shadowNormalBias","layerThreshold","layers","csmAtlas","splitCameraFar","shadowDistance","shadowBias","updateShadowUBOLightView","cap","DIRECTIONAL","shadowCameraFar","splitCameraNear","SPOT","spotLight","_combineSignY","_initCombineSignY","_pipeline","globalUBO","cameraUBO","csmUBO","updateGlobalUBO","cmdBuffer","commandBuffers","updateCameraUBO","updateShadowUBO","shadowFrameBufferMap","updateShadowUBOLight","globalDS","RenderStage","_tag","flow","PipelineEventType","RenderFlow","render","CommonStagePriority","ForwardStagePriority","ForwardFlowPriority","DeferredStagePriority","DeferredFlowPriority","RenderFlowTag","PipelineEventProcessor","eventTargetOn","eventTargetOnce","tmpRect","tmpViewport","BloomRenderData","prefiterTex","downsampleTexs","upsampleTexs","combineTex","prefilterFramebuffer","downsampleFramebuffers","upsampleFramebuffers","combineFramebuffer","PipelineInputAssemblerData","quadIB","quadVB","quadIA","RenderPipeline","_quadIB","_quadVBOnscreen","_quadVBOffscreen","_quadIAOnscreen","_quadIAOffscreen","_commandBuffers","_pipelineUBO","_macros","_constantMacros","_profiler","_pipelineRenderData","_renderPasses","_lastUsedRenderArea","_clusterEnabled","_bloomEnabled","getPipelineRenderData","flows","createRenderPass","clearFlags","colorFmt","depthFmt","colorAttachment","DISCARD","COLOR","LOAD","COLOR_ATTACHMENT_WRITE","DEPTH","DEPTH_STENCIL_ATTACHMENT_WRITE","getRenderPass","fbo","fbHash","hashFrameBuffer","newFramebufferByRatio","dyingFramebuffer","colorTexArr","newFramebuffer","createFramebuffer","generateRenderArea","vp","generateViewport","generateScissor","getMacroString","getMacroInt","getMacroBool","setMacroString","setMacroInt","setMacroBool","_generateConstantMacros","_pipelineSceneData","_ensureEnoughSize","cameras","updateGeometryRenderer","begin","RENDER_FRAME_BEGIN","decideProfilerCamera","RENDER_CAMERA_BEGIN","RENDER_CAMERA_END","RENDER_FRAME_END","submit","_destroyQuadInputAssembler","_destroyBloomData","bloom","_genQuadVertexData","renderArea","vbData","_createQuadInputAssembler","inputAssemblerData","vbStride","ibStride","ibSize","INDEX","RG32F","updateQuadVertexData","cachedArea","offData","onData","INPUT_ATTACHMENT_BENEFIT","JOINT_UNIFORM_CAPACITY","geometryRenderer","generateBloomRenderData","curWidth","curHeight","COLOR_ATTACHMENT","linearSampler","ATTACHMENT_SCALE_CAHNGED","RenderQueueSortMode","RenderTextureConfig","ColorDesc","DepthStencilDesc","RenderQueueDesc","FRONT_TO_BACK","opaqueCompareFn","shaderId","transparentCompareFn","RenderQueue","desc","_passDesc","_passPool","sortFunc","insertRenderPass","renderObj","isTransparent","rp","recordCommandBuffer","convertRenderQueue","sortMode","BACK_TO_FRONT","renderQueueClearFunc","rq","renderQueueSortFunc","ModelType","RenderBatchedQueue","Set","boundPSO","RenderInstancedQueue","_renderQueue","lastPSO","SubModel","_shaders","_subMesh","_patches","_inputAssembler","_worldBoundDescriptorSet","_planarInstanceShader","_planarShader","_reflectionTex","_reflectionSampler","_instancedAttributeBlock","views","_instancedWorldMatrixIndex","localSetLayout","occlusionPass","getOcclusionQueryPass","occlusionDSInfo","_flushPassInfo","genFlatBuffers","texWidth","texHeight","minSize","STORAGE","TRANSFER_SRC","initPlanarShadowShader","initPlanarShadowInstanceShader","onPipelineStateChanged","onMacroPatchesStateChanged","onGeometryChanged","drawInfo","dirtyDrawInfo","getInstancedAttributeIndex","updateInstancedWorldMatrix","UpdateInstancedAttributes","instancedWorldMatrixIndex","attribute","typeViewArray","shadowMapPatches","lightMapPatches","lightmapSamplerHash","lightmapSamplerWithMipHash","Octree","isDynamicBatching","_worldBounds","_modelBounds","_subModels","_descriptorSetCount","_updateStamp","_localDataUpdated","_localData","_localBuffer","_lightmap","_lightmapUVParam","_worldBoundBuffer","_receiveShadow","_castShadow","_shadowBias","_shadowNormalBias","updateTransform","updateWorldBound","updateUBOs","stamp","hasNonInstancingPass","createBoundingShape","_createSubModel","subMeshData","getMacroPatches","_updateAttributesAndBinding","setSubModelMesh","initLightingmap","uvParam","updateLightingmap","updateLocalShadowBias","receiveShadow","subModelIndex","_initLocalDescriptors","_updateLocalDescriptors","_initWorldBoundDescriptors","worldBoundDescriptorSet","_updateWorldBoundDescriptors","_updateInstancedAttributes","octreeInfo","_dir","_illuminanceHDR","_illuminanceLDR","_shadowEnabled","_shadowPcf","_shadowSaturation","_shadowDistance","_shadowInvisibleOcclusionRange","_csmLevel","_csmNeedUpdate","_csmLayerLambda","_csmOptimizationMode","_shadowFixedArea","_shadowNear","_shadowFar","_shadowOrthoSize","CC_DIR_LIGHT_SHADOW_TYPE","CC_DIR_SHADOW_PCF_TYPE","illuminanceHDR","illuminanceLDR","_needUpdate","_range","_luminanceHDR","_luminanceLDR","_aabb","SPHERE","luminanceHDR","luminanceLDR","_lightPassPool","_spotAngle","_angle","lights","_vec4Array","_dynamicOffsets","_lightIndices","cullSphereLight","cullSpotLight","_phaseID","_lightPassIndices","getLightPassIndices","lightPassIndices","hasValidLightPass","lightPassIndex","RenderAdditiveLightQueue","_lightPasses","_instancedLightPassPool","_batchedLightPassPool","_lightBufferCount","_lightBufferStride","_lightBufferElementCount","_lightBuffer","_firstLightBufferView","_lightBufferData","_instancedQueue","_batchedQueue","_lightMeterScale","lp","descriptorSetMap","gatherLightPasses","_updateUBOs","_updateLightDescriptorSet","_lightCulling","lightPassIdx","_addRenderQueue","matDS","localDS","isCulled","isNeedCulling","isInstancedOrBatched","lightIdx","matShadowInvProj","_shadowFrameBufferMap","tempRGB","luminance","spotAngle","_ab","PlanarShadowQueue","_pendingSubModels","_castModels","gatherShadowPasses","shadowVisible","instancedBuffer","instancingMaterial","matLight","planarShader","UIPhase","ForwardStage","_renderQueues","_renderArea","additiveInstanceQueues","_uiPhase","addRenderInstancedQueue","removeRenderInstancedQueue","renderQueues","_additiveLightQueue","_planarQueue","batchedBuffer","beginRenderPass","endRenderPass","initInfo","ForwardFlow","forwardStage","getShadowPassIndex","RenderShadowMapBatchedQueue","_subModelsArray","_passArray","_shaderArray","dirLight","dirLightFrustum","validFrustum","dirShadowObjects","shadowObjects","csmLayerObject","csmOptimizationMode","shadowCulling","shadowPassIdx","ShadowStage","_shadowFrameBuffer","_light","_globalDS","_level","setUsage","shadowFrameBuffer","_additiveShadowQueue","clearFramebuffer","_validLights","ShadowFlow","_shadowRenderPass","shadowMapStage","CC_SHADOWMAP_FORMAT","isLinear","CC_SHADOWMAP_USE_LINEAR_DEPTH","CC_SUPPORT_CASCADED_SHADOW_MAP","resizeShadowMap","_initShadowFrameBuffer","_renderStage","clearShadowMap","shadowFrameBuffers","frameBuffer","renderTargets","renderTarget","shadowRenderTargets","DEPTH_STENCIL_ATTACHMENT","shadowStage","validLights","shadowRenderPass","newFrameBuffer","SHADOW","_typeMap","mapBuffer","isOwnerOfIndexBuffer","subMeshIdx","_flatBuffers","_jointMappedBuffers","_jointMappedBufferIndices","_vertexIdChannel","_geometricInfo","_primitiveMode","_iaInfo","_isOwnerOfIndexBuffer","invalidateGeometricInfo","idxCount","prim","indexView","vertexBundelIndices","bundleIdx","vertexBundle","vertexBundles","sharedView","ibView","readIndices","subarray","enableVertexIdChannel","streamIndex","attributeIndex","vertexIdBuffer","_allocVertexIdBuffer","vertexIds","iVertex","readAttribute","ATTR_POSITION","pAttri","conut","jointFormat","jointOffset","jointMaps","jointMapIndex","ATTR_JOINTS","idxMap","AntiAliasing","_mat4Trans","_matShadowTrans","_matShadowViewProjArbitaryPos","_matShadowViewProjArbitaryPosInv","_focus","_projPos","_texelSize","_projSnap","_snap","_maxVec3","_minVec3","_shadowPos","_maxLayerPosz","_maxLayerFarPlane","ShadowLayerVolume","_shadowObjects","_shadowCameraFar","_validFrustum","_splitFrustum","_lightViewFrustum","_castLightViewBoundingBox","copyToValidFrustum","calculateValidFrustumOrtho","calculateSplitFrustum","createMatrix","shadowMapWidth","onlyForCulling","invisibleOcclusionRange","shadowInvisibleOcclusionRange","orthoSizeWidth","orthoSizeHeight","shadowViewArbitaryPos","alignFarPlaneDist","halfOrthoSizeWidth","halfOrthoSizeHeight","invActualSize","modX","modY","CSMShadowLayer","_splitCameraNear","_splitCameraFar","_csmAtlas","_calculateAtlas","CSMLayers","_castShadowObjects","_layerObjects","_layers","_levelCount","_specialLayer","_updateFixedArea","csmNeedUpdate","_splitFrustumLevels","_calculateCSM","shadowOrthoSize","nd","fd","lambda","csmLayerLambda","si","preNear","nextFar","_getCameraWorldMatrix","csmLayer","cameraNode","PipelineSceneData","_geometryRendererMaterials","_geometryRendererPasses","_geometryRendererShaders","_occlusionQueryVertexBuffer","_occlusionQueryIndicesBuffer","_occlusionQueryInputAssembler","_occlusionQueryMaterial","_occlusionQueryShader","_isHDR","_shadingScale","_csmSupported","initGeometryRendererMaterials","initOcclusionQuery","_createOcclusionQueryIA","updatePipelineSceneData","ForwardPipeline","_postRenderPass","shadowFlow","forwardFlow","CC_PIPELINE_TYPE","_activeRenderer","newWidth","newHeight","_destroyUBOs","rpIter","rpRes","commandBuffer","shadowMapSampler","pointSampler","GbufferStage","gbufferFrameBuffer","GBUFFER","LightingStage","_deferredLitsBufs","_maxDeferredLights","gatherLights","elementLen","fieldLen","_createStageDescriptor","deferredLitsBufView","_localUBO","_deferredMaterial","deferredLightingMaterial","deferredData","gbufferRenderTargets","outputDepth","outputFrameBuffer","quadIAOffscreen","LIGHTING","PostProcessStage","_stageDesc","_postProcessMaterial","postprocessMaterial","renderData","bloomEnabled","outputRenderTargets","quadIAOnscreen","POST_PROCESS","DeferredPipelineSceneData","_antiAliasing","updatePipelinePassInfo","updateBloomPass","_bloomMaterial","prefilterPass","downsamplePass","upsamplePass","BLOOM_DOWNSAMPLEPASS_INDEX","combinePass","BLOOM_UPSAMPLEPASS_INDEX","updatePostProcessPass","passPost","initPipelinePassInfo","deferredMat","_deferredLightingMaterial","bloomMat","postMat","FXAA","ANTIALIAS_TYPE","_postprocessMaterial","updateDeferredPassInfo","updateDeferredLightPass","CC_RECEIVE_SHADOW","passLit","renderMat","UBOBloom","TEXTURE_SIZE_OFFSET","BloomStage","threshold","_bloomUBO","bloomMaterial","_camera$window","MAX_BLOOM_FILTER_PASS_NUM","_prefilterPass","_downsamplePass","_upsamplePass","_combinePass","bloomData","builtinBloomProcess","BLOOM","MainFlow","gbufferStage","lightingStage","bloomStage","postProcessStage","DeferredRenderData","DeferredPipeline","_gbufferRenderPass","_lightingRenderPass","mainFlow","_destroyDeferredData","_generateDeferredRenderData","inputAssemblerDataOffscreen","inputAssemblerDataOnscreen","colorAttachment0","RGBA16F","colorAttachment1","colorAttachment2","createDefaultPipeline","rppl","v2_0","SplashScreen","_curTime","SPLASH_SCREEN","totalTime","base64src","displayRatio","displayWatermark","preInit","initWarterMark","logoImage","initLogo","clearColors","verts","indicesBuffers","IAInfo","quadAssmebler","dw","dh","refW","u_p","logoTW","logoTexture","logoTH","logoW","logoMat","watermarkMat","wartermarkW","wartermarkTW","watermarkTexture","wartemarkImg","font","textBaseline","textAlign","textMetrics","measureText","fillText","xr","isRenderAllowable","renderSize","xrEye","renderLoopStart","acquire","logoPass","logoPso","wartermarkPass","watermarkPso","flushCommands","present","renderLoopEnd","_ins","ListEntry","markedForDeletion","_listEntries","HashUpdateEntry","_hashUpdateEntries","HashTimerEntry","timers","timerIndex","currentTimer","currentTimerSalvaged","_hashTimerEntries","CallbackTimer","_lock","_scheduler","_elapsed","_runForever","_useDelay","_timesExecuted","_repeat","_delay","_interval","_target","_callback","initWithCallback","seconds","trigger","getCallback","_timers","timer","Scheduler","_timeScale","_updatesNegList","_updates0List","_updatesPosList","_hashForUpdates","_hashForTimers","_currentTarget","_currentTargetSalvaged","_updateHashLocked","_arrayForTimers","enableForTarget","found","__instanceId","setTimeScale","timeScale","getTimeScale","elt","_removeHashElement","_removeUpdateFromHash","targetId","scheduleUpdate","hashElement","unscheduleUpdate","ppList","listElement","_appendIn","_priorityIn","li","unscheduleAllWithMinPriority","minPriority","temp_length","isScheduled","pauseAllTargets","pauseAllTargetsWithMinPriority","idsWithSelectors","locArrayForTimers","resumeTargets","targetsToResume","elementUpdate","listEntry","ID","RenderScene","_cameras","_batches","_directionalLights","_sphereLights","_spotLights","_mainLight","_modelId","registerCreateFunc","_createSceneFun","removeCameras","removeSphereLights","removeSpotLights","removeModels","cam","setMainLight","dl","unsetMainLight","dlList","addDirectionalLight","removeDirectionalLight","addSphereLight","removeSphereLight","addSpotLight","sl","removeSpotLight","addModel","removeModel","addBatch","removeBatch","removeBatches","generateModelId","LANDSCAPE_RIGHT","PORTRAIT_UPSIDE_DOWN","LANDSCAPE_LEFT","RenderWindow","_title","_hasOnScreenAttachments","_hasOffScreenAttachments","_framebuffer","_createWindowFun","colorTexture","clearCameras","extractRenderCameras","sortCameras","Root","_windows","_mainWindow","_curWindow","_tempWindow","_usesCustomPipeline","_pipelineEvent","_classicPipeline","_customPipeline","_batcher","_dataPoolMgr","_scenes","_modelPools","_cameraPool","_lightPools","_debugView","_fpsTime","_frameCount","_fps","_fixedFPS","_useDeferredPipeline","_fixedFPSFrameTime","_cumulativeTime","_frameTime","DataPoolManager","customJointTextureLayouts","ANIMATION","jointTexturePool","registerCustomTextureLayouts","_resizeMaxJointForDS","destroyScenes","dataPoolManager","setRenderPipeline","isCreateDefaultPipeline","COMPUTE_SHADER","clusterEnabled","usesCustomPipeline","createCustomPipeline","globals","Batcher2D","activeWindow","resetCumulativeTime","frameMove","windows","cameraList","EVENT_BEFORE_COMMIT","destroyWindows","ModelCtor","destroyModel","createLight","LightCtor","destroyLight","recycleLight","maxJoints","fps","Pacer","_rafHandle","_stHandle","_onTick","_targetFrameRate","_startTime","_isPlaying","_rAF","_cAF","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","_stTime","cancelAnimationFrame","cancelRequestAnimationFrame","msCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","webkitCancelRequestAnimationFrame","msCancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","ocancelAnimationFrame","_ctTime","updateCallback","currTime","elapseTime","timeToCall","UIRendererManager","_allRenderers","_dirtyRenderers","_dirtyVersion","addRenderer","uiRenderer","_internalId","removeRenderer","markDirtyRenderer","updateAllDirtyRenderers","dirtyRenderers","updateRenderer","uiRendererManager","_invalid","_paused","_loadingScene","_totalFrames","_systems","_persistRootNodes","calculateDeltaTime","EVENT_END_FRAME","purgeDirector","stopAnimation","EVENT_RESET","startAnimation","runSceneImmediate","onBeforeLoadScene","onLaunched","persistNodeList","SCENE_CHANGED_FOR_PERSISTS","existNode","EVENT_BEFORE_SCENE_LAUNCH","EVENT_AFTER_SCENE_LAUNCH","runScene","onUnloaded","EVENT_BEFORE_SCENE_LOADING","timeEnd","resume","getDeltaTime","getTotalTime","getCurrentTime","isPaused","setScheduler","unregisterSystem","registerSystem","getSystem","getAnimationManager","AnimationManager","mainLoop","_calculateDT","tick","EVENT_BEFORE_UPDATE","EVENT_AFTER_UPDATE","EVENT_BEFORE_DRAW","EVENT_AFTER_DRAW","EVENT_INIT","addPersistRootNode","isPersistRootNode","EVENT_BEFORE_PHYSICS","EVENT_AFTER_PHYSICS","onStart","_engineInited","_rendererInitialized","_frameRate","_pacer","_initTime","_deltaTime","_shouldLoadLaunchScene","onPreBaseInitDelegate","onPostBaseInitDelegate","onPreInfrastructureInitDelegate","onPostInfrastructureInitDelegate","onPreSubsystemInitDelegate","onPostSubsystemInitDelegate","onPreProjectInitDelegate","onPostProjectInitDelegate","setFrameRate","frameRate","getFrameRate","step","restart","curTime","_safeEmit","EVENT_RESTART","EVENT_ENGINE_INITED","EVENT_GAME_INITED","_compatibleWithOldParams","EVENT_PRE_BASE_INIT","debugMode","_initEvents","settingsPath","EVENT_POST_BASE_INIT","EVENT_PRE_INFRASTRUCTURE_INIT","_initXR","adapter","querySelector","initPacer","EVENT_POST_INFRASTRUCTURE_INIT","EVENT_PRE_SUBSYSTEM_INIT","EVENT_POST_SUBSYSTEM_INIT","VERSION","EVENT_PRE_PROJECT_INIT","jsList","PLUGINS","promise","jsListFile","windowErrorListener","evt","charset","head","scriptPackages","SCRIPTING","_loadProjectBundles","_loadCCEScripts","_setupRenderPipeline","_loadPreloadAssets","EVENT_POST_PROJECT_INIT","XrEntry","getInstance","xrMSAA","xrRenderingScale","setMultisamplesRTT","setRenderingScale","profiling","showFPS","rendering","renderPipeline","assetOptions","animation","physics","preloadAssets","preloadBundles","run","DEBUG_DT_THRESHOLD","_updateCallback","isFinished","launchScene","LAUNCH","onTick","_onShow","_onHide","EVENT_HIDE","EVENT_SHOW","_setRenderPipeline","reason","targetFrameRate","EVENT_LOW_MEMORY","RENDER_TYPE_CANVAS","RENDER_TYPE_OPENGL","RENDER_TYPE_HEADLESS","visibleRect","topLeft","topRight","bottomLeft","bottomRight","visibleRect_","localWinSize","View","_scaleX","_scaleY","_viewportRect","_visibleRect","_autoFullScreen","_retinaEnabled","_resizeCallback","_resolutionPolicy","_rpExactFit","_rpShowAll","_rpNoBorder","_rpFixedHeight","_rpFixedWidth","_strategyer","ContainerStrategy","_strategy","ContentStrategy","ResolutionPolicy","EQUAL_TO_FRAME","EXACT_FIT","SHOW_ALL","NO_BORDER","FIXED_HEIGHT","FIXED_WIDTH","resizeWithBrowserSize","designResolution","setDesignResolutionSize","policy","_updateAdaptResult","setResizeCallback","setOrientation","adjustViewportMeta","enableRetina","isRetinaEnabled","enableAutoFullScreen","isAutoFullScreenEnabled","setCanvasSize","getCanvasSize","getFrameSize","setFrameSize","getVisibleSizeInPixel","getVisibleOrigin","getVisibleOriginInPixel","getResolutionPolicy","_updateResolutionPolicy","resolutionPolicy","_locPolicy","setResolutionPolicy","preApply","rv","postApply","setRealPixelResolution","getDevicePixelRatio","convertToLocationInView","relatedPos","_setupCanvas","locCanvas","PROPORTION_TO_FRAME","_result","_buildResult","contentW","contentH","EqualToFrame","ProportionalToFrame","ExactFit","_view","ShowAll","NoBorder","FixedHeight","FixedWidth","containerStg","contentStg","_containerStrategy","_contentStrategy","setContainerStrategy","setContentStrategy","winSize","importFunc","syncPhysicsToGraphics","Bullet","CACHE","getWrapper","BODY_CACHE_NAME","BULLET","waitForAmmoInstantiation","supported","WebAssembly","Module","Instance","bulletModule","infoReport","errorReport","memory","Memory","initial","importObject","wasi_snapshot_preview1","fd_close","fd_seek","fd_write","env","buff","results","btInstance","instantiateWasm","wasmMemory","pageSize"],"mappings":"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"}